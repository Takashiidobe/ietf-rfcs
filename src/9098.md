  RFC 9098       IPv6 Extension Headers   September 2021
  -------------- ------------------------ ----------------
  Gont, et al.   Informational            \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9098](https://www.rfc-editor.org/rfc/rfc9098){.eref}

Category:
:   Informational

Published:
:   September 2021

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    F. Gont
    :::

    ::: org
    SI6 Networks
    :::
    :::

    ::: author
    ::: author-name
    N. Hilliard
    :::

    ::: org
    INEX
    :::
    :::

    ::: author
    ::: author-name
    G. Doering
    :::

    ::: org
    SpaceNet AG
    :::
    :::

    ::: author
    ::: author-name
    W. Kumari
    :::

    ::: org
    Google
    :::
    :::

    ::: author
    ::: author-name
    G. Huston
    :::

    ::: org
    APNIC
    :::
    :::

    ::: author
    ::: author-name
    W. Liu
    :::

    ::: org
    Huawei Technologies
    :::
    :::
:::

# RFC 9098 {#rfcnum}

# Operational Implications of IPv6 Packets with Extension Headers {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document summarizes the operational implications of IPv6 extension
headers specified in the IPv6 protocol specification (RFC 8200) and
attempts to analyze reasons why packets with IPv6 extension headers are
often dropped in the public Internet.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This document is not an Internet Standards Track specification; it is
published for informational
purposes.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Not all documents approved
by the IESG are candidates for any level of Internet Standard; see
Section 2 of RFC 7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9098>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2021 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Terminology](#name-terminology){.xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Disclaimer](#name-disclaimer){.xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Background
    Information](#name-background-information){.xref}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Previous Work on IPv6 Extension
    Headers](#name-previous-work-on-ipv6-exten){.xref}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Packet-Forwarding Engine
    Constraints](#name-packet-forwarding-engine-co){.xref}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.xref}.  [Recirculation](#name-recirculation){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Requirement to Process Layer 3 / Layer 4
    Information in Intermediate
    Systems](#name-requirement-to-process-laye){.xref}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [ECMP and Hash-Based Load
        Sharing](#name-ecmp-and-hash-based-load-sh){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [Enforcing Infrastructure
        ACLs](#name-enforcing-infrastructure-ac){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.3}
        [7.3](#section-7.3){.xref}.  [DDoS Management and Customer
        Requests for
        Filtering](#name-ddos-management-and-custome){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.4}
        [7.4](#section-7.4){.xref}.  [Network Intrusion Detection and
        Prevention](#name-network-intrusion-detection){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.5}
        [7.5](#section-7.5){.xref}.  [Firewalling](#name-firewalling){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Operational and Security
    Implications](#name-operational-and-security-im){.xref}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Inability to Find Layer 4
        Information](#name-inability-to-find-layer-4-i){.xref}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Route-Processor
        Protection](#name-route-processor-protection){.xref}
        :::

    -   ::: {#section-toc.1-1.8.2.3}
        [8.3](#section-8.3){.xref}.  [Inability to Perform Fine-Grained
        Filtering](#name-inability-to-perform-fine-g){.xref}
        :::

    -   ::: {#section-toc.1-1.8.2.4}
        [8.4](#section-8.4){.xref}.  [Security Concerns Associated with
        IPv6 Extension
        Headers](#name-security-concerns-associate){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [Security
    Considerations](#name-security-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.xref}. [References](#name-references){.xref}

    -   ::: {#section-toc.1-1.11.2.1}
        [11.1](#section-11.1){.xref}.  [Normative
        References](#name-normative-references){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.2}
        [11.2](#section-11.2){.xref}.  [Informative
        References](#name-informative-references){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.12}
    [](#appendix-A){.xref}[Acknowledgements](#name-acknowledgements){.xref}
    :::

-   ::: {#section-toc.1-1.13}
    [](#appendix-B){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}
    :::
:::
:::

::: {#intro}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

IPv6 extension headers (EHs) allow for the extension of the IPv6
protocol and provide support for core functionality such as IPv6
fragmentation. However, common implementation limitations suggest that
EHs present a challenge for IPv6 packet routing equipment and
middleboxes, and evidence exists that IPv6 packets with EHs are
intentionally dropped in the public Internet in some
circumstances.[¶](#section-1-1){.pilcrow}

This document has the following goals:[¶](#section-1-2){.pilcrow}

-   [Raise awareness about the operational and security implications of
    IPv6 extension headers specified in \[[RFC8200](#RFC8200){.xref}\]
    and present reasons why some networks resort to intentionally
    dropping packets containing IPv6 extension
    headers.[¶](#section-1-3.1){.pilcrow}]{#section-1-3.1}
-   [Highlight areas where current IPv6 support by networking devices
    may be suboptimal, such that the aforementioned support is
    improved.[¶](#section-1-3.2){.pilcrow}]{#section-1-3.2}
-   [Highlight operational issues associated with IPv6 extension
    headers, such that those issues are considered in IETF
    standardization
    efforts.[¶](#section-1-3.3){.pilcrow}]{#section-1-3.3}

[Section 4](#background){.xref} of this document provides background
information about the IPv6 packet structure and associated implications.
[Section 5](#previous-work){.xref} summarizes previous work that has
been carried out in the area of IPv6 extension headers. [Section
6](#pfe-constraints){.xref} discusses packet-forwarding engine
constraints in contemporary routers. [Section 7](#inability){.xref}
discusses why intermediate systems may need to access Layer 4
information to make a forwarding decision. Finally, [Section
8](#operational-implications){.xref} discusses operational implications
of IPv6 EHs.[¶](#section-1-4){.pilcrow}
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

This document uses the term \"intermediate system\" to describe both
routers and middleboxes when there is no need to distinguish between the
two and where the important issue is that the device being discussed
forwards packets.[¶](#section-2-1){.pilcrow}
:::

::: {#disclaimer}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Disclaimer](#name-disclaimer){.section-name .selfRef} {#name-disclaimer}

This document analyzes the operational challenges represented by packets
that employ IPv6 extension headers and documents some of the operational
reasons why these packets are often dropped in the public Internet. This
document is not a recommendation to drop such packets, but rather an
analysis of why they are currently dropped.[¶](#section-3-1){.pilcrow}
:::
:::

::: {#background}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Background Information](#name-background-information){.section-name .selfRef} {#name-background-information}

It is useful to compare the basic structure of IPv6 packets against that
of IPv4 packets and analyze the implications of the two different packet
structures.[¶](#section-4-1){.pilcrow}

IPv4 packets have a variable-length header size that allows for the use
of IPv4 \"options\" \-- optional information that may be of use to nodes
processing IPv4 packets. The IPv4 header length is specified in the
\"Internet Header Length\" (IHL) field of the mandatory IPv4 header and
must be in the range of 20 octets (the minimum IPv4 header size) to 60
octets, accommodating at most 40 octets of options. The upper-layer
protocol type is specified via the \"Protocol\" field of the mandatory
IPv4 header.[¶](#section-4-2){.pilcrow}

[]{#name-ipv4-packet-structure}

::: {#ipv4-packet}
::: {#section-4-3.1 .artwork .art-text .alignLeft}
                   Protocol, IHL
                        +--------+
                        |        |
                        |        v
                   +------//-----+------------------------+
                   |             |                        |
                   |    IPv4     |       Upper-Layer      |
                   |    Header   |       Protocol         |
                   |             |                        |
                   +-----//------+------------------------+

                   variable length
                   <------------->
:::

[Figure 1](#figure-1){.selfRef}: [IPv4 Packet
Structure](#name-ipv4-packet-structure){.selfRef}
:::

IPv6 took a different approach to the IPv6 packet structure. Rather than
employing a variable-length header as IPv4 does, IPv6 employs a packet
structure similar to a linked list, where a mandatory fixed-length IPv6
header is followed by an arbitrary number of optional extension headers,
with the upper-layer header being the last header in the IPv6 header
chain. Each extension header typically specifies its length (unless it
is implicit from the extension header type) and the \"next header\" (NH)
type that follows in the IPv6 header chain.[¶](#section-4-4){.pilcrow}

[]{#name-ipv6-packet-structure}

::: {#ipv6-packet}
::: {#section-4-5.1 .artwork .art-text .alignLeft}
           NH          NH, EH-length      NH, EH-length
            +-------+      +------+            +-------+
            |       |      |      |            |       |
            |       v      |      v            |       v
      +-------------+-------------+-//-+---------------+--------------+
      |             |             |    |               |              |
      |    IPv6     |    Ext.     |    |     Ext.      |  Upper-Layer |
      |    header   |    Header   |    |     Header    |  Protocol    |
      |             |             |    |               |              |
      +-------------+-------------+-//-+---------------+--------------+

       fixed length    variable number of EHs & length
      <------------> <-------------------------------->
:::

[Figure 2](#figure-2){.selfRef}: [IPv6 Packet
Structure](#name-ipv6-packet-structure){.selfRef}
:::

This packet structure has the following
implications:[¶](#section-4-6){.pilcrow}

-   [\[[RFC8200](#RFC8200){.xref}\] requires the entire IPv6 header
    chain to be contained in the first fragment of a packet, therefore
    limiting the IPv6 header chain to the size of the path
    MTU.[¶](#section-4-7.1){.pilcrow}]{#section-4-7.1}
-   [Other than the path MTU constraints, there are no other limits to
    the number of IPv6 EHs that may be present in a packet. Therefore,
    there is no upper limit regarding how deep into the IPv6 packet the
    upper-layer protocol header may be
    found.[¶](#section-4-7.2){.pilcrow}]{#section-4-7.2}
-   [The only way for a node to obtain the upper-layer protocol type or
    find the upper-layer protocol header is to parse and process the
    entire IPv6 header chain, in sequence, starting from the mandatory
    IPv6 header until the last header in the IPv6 header chain is
    found.[¶](#section-4-7.3){.pilcrow}]{#section-4-7.3}
:::
:::

::: {#previous-work}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Previous Work on IPv6 Extension Headers](#name-previous-work-on-ipv6-exten){.section-name .selfRef} {#name-previous-work-on-ipv6-exten}

Some of the operational and security implications of IPv6 extension
headers have been discussed in the IETF:[¶](#section-5-1){.pilcrow}

-   [\[[OPERATORS](#I-D.taylor-v6ops-fragdrop){.xref}\] discusses a
    rationale for which operators drop IPv6
    fragments.[¶](#section-5-2.1){.pilcrow}]{#section-5-2.1}
-   [\[[HEADERS](#I-D.wkumari-long-headers){.xref}\] discusses possible
    issues arising from \"long\" IPv6 header
    chains.[¶](#section-5-2.2){.pilcrow}]{#section-5-2.2}
-   [\[[PARSING](#I-D.kampanakis-6man-ipv6-eh-parsing){.xref}\]
    describes how inconsistencies in the way IPv6 packets with extension
    headers are parsed by different implementations could result in
    evasion of security controls and presents guidelines for parsing
    IPv6 extension headers, with the goal of providing a common and
    consistent parsing methodology for IPv6
    implementations.[¶](#section-5-2.3){.pilcrow}]{#section-5-2.3}
-   [\[[IPV6-EH](#I-D.ietf-opsec-ipv6-eh-filtering){.xref}\] analyzes
    the security implications of IPv6 EHs, as well as the operational
    implications of dropping packets that employ IPv6 EHs and associated
    options.[¶](#section-5-2.4){.pilcrow}]{#section-5-2.4}
-   [\[[RFC7113](#RFC7113){.xref}\] discusses how some popular Router
    Advertisement Guard (RA-Guard) implementations are subject to
    evasion by means of IPv6 extension
    headers.[¶](#section-5-2.5){.pilcrow}]{#section-5-2.5}
-   [\[[RFC8900](#RFC8900){.xref}\] analyzes the fragility introduced by
    IP fragmentation.[¶](#section-5-2.6){.pilcrow}]{#section-5-2.6}

A number of recent RFCs have discussed issues related to IPv6 extension
headers and have specified updates to RFC 2460
\[[RFC2460](#RFC2460){.xref}\] (an earlier version of the IPv6
standard). Many of these updates have now been incorporated into the
current IPv6 core standard \[[RFC8200](#RFC8200){.xref}\] or the IPv6
node requirements \[[RFC8504](#RFC8504){.xref}\].
Namely,[¶](#section-5-3){.pilcrow}

-   [\[[RFC5095](#RFC5095){.xref}\] discusses the security implications
    of Routing Header Type 0 (RHT0) and deprecates
    it.[¶](#section-5-4.1){.pilcrow}]{#section-5-4.1}
-   [\[[RFC5722](#RFC5722){.xref}\] analyzes the security implications
    of overlapping fragments and provides recommendations in this
    area.[¶](#section-5-4.2){.pilcrow}]{#section-5-4.2}
-   [\[[RFC7045](#RFC7045){.xref}\] clarifies how intermediate nodes
    should deal with IPv6 extension
    headers.[¶](#section-5-4.3){.pilcrow}]{#section-5-4.3}
-   [\[[RFC7112](#RFC7112){.xref}\] discusses the issues arising in a
    specific fragmentation case where the IPv6 header chain is
    fragmented into two or more fragments and formally forbids such
    fragmentation.[¶](#section-5-4.4){.pilcrow}]{#section-5-4.4}
-   [\[[RFC6946](#RFC6946){.xref}\] discusses a flawed (but common)
    processing of the so-called IPv6 \"atomic fragments\" and specifies
    improved processing of such
    packets.[¶](#section-5-4.5){.pilcrow}]{#section-5-4.5}
-   [\[[RFC8021](#RFC8021){.xref}\] deprecates the generation of IPv6
    atomic fragments.[¶](#section-5-4.6){.pilcrow}]{#section-5-4.6}
-   [\[[RFC8504](#RFC8504){.xref}\] clarifies processing rules for
    packets with extension headers and also allows hosts to enforce
    limits on the number of options included in IPv6
    EHs.[¶](#section-5-4.7){.pilcrow}]{#section-5-4.7}
-   [\[[RFC7739](#RFC7739){.xref}\] discusses the security implications
    of predictable fragment Identification values and provides
    recommendations for the generation of these
    values.[¶](#section-5-4.8){.pilcrow}]{#section-5-4.8}
-   [\[[RFC6980](#RFC6980){.xref}\] analyzes the security implications
    of employing IPv6 fragmentation with Neighbor Discovery for IPv6 and
    formally recommends against such
    usage.[¶](#section-5-4.9){.pilcrow}]{#section-5-4.9}

Additionally, \[[RFC8200](#RFC8200){.xref}\] has relaxed the requirement
that \"all nodes must examine and process the Hop-by-Hop Options
header\" from \[[RFC2460](#RFC2460){.xref}\], by specifying that only
nodes that have been explicitly configured to process the Hop-by-Hop
Options header are required to do so.[¶](#section-5-5){.pilcrow}

A number of studies have measured the extent to which packets employing
IPv6 extension headers are dropped in the public
Internet:[¶](#section-5-6){.pilcrow}

-   [\[[PMTUD-Blackholes](#PMTUD-Blackholes){.xref}\] and
    \[[Linkova-Gont-IEPG90](#Linkova-Gont-IEPG90){.xref}\] present some
    preliminary measurements regarding the extent to which packets
    containing IPv6 EHs are dropped in the public
    Internet.[¶](#section-5-7.1){.pilcrow}]{#section-5-7.1}
-   [\[[RFC7872](#RFC7872){.xref}\] presents more comprehensive results
    and documents the methodology used to obtain these
    results.[¶](#section-5-7.2){.pilcrow}]{#section-5-7.2}
-   [\[[Huston-2017](#Huston-2017){.xref}\] and
    \[[Huston-2020](#Huston-2020){.xref}\] measure packet drops
    resulting from IPv6 fragmentation when communicating with DNS
    servers.[¶](#section-5-7.3){.pilcrow}]{#section-5-7.3}
:::
:::

::: {#pfe-constraints}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Packet-Forwarding Engine Constraints](#name-packet-forwarding-engine-co){.section-name .selfRef} {#name-packet-forwarding-engine-co}

Most contemporary carrier-grade routers use dedicated hardware, e.g.,
Application-Specific Integrated Circuits (ASICs) or Network Processing
Units (NPUs), to determine how to forward packets across their internal
fabrics (see \[[IEPG94-Scudder](#IEPG94-Scudder){.xref}\] and
\[[APNIC-Scudder](#APNIC-Scudder){.xref}\] for details). One common
method of handling next-hop lookups is to send a small portion of the
ingress packet to a lookup engine with specialized hardware, e.g.,
ternary content-addressable memory (TCAM) or reduced latency dynamic
random-access memory (RLDRAM), to determine the packet\'s next hop.
Technical constraints mean that there is a trade-off between the amount
of data sent to the lookup engine and the overall packet-forwarding rate
of the lookup engine. If more data is sent, the lookup engine can
inspect further into the packet, but the overall packet-forwarding rate
of the system will be reduced. If less data is sent, the overall
packet-forwarding rate of the router will be increased, but the packet
lookup engine may not be able to inspect far enough into a packet to
determine how it should be handled.[¶](#section-6-1){.pilcrow}

NOTE:[¶](#section-6-2.1){.pilcrow}

For example, some contemporary high-end routers are known to inspect up
to 192 bytes, while others are known to parse up to 384 bytes of
header.[¶](#section-6-2.2){.pilcrow}

If a hardware-forwarding engine on a contemporary router cannot make a
forwarding decision about a packet because critical information is not
sent to the lookup engine, then the router will normally drop the
packet. [Section 7](#inability){.xref} discusses some of the reasons for
which a contemporary router might need to access Layer 4 information to
make a forwarding decision.[¶](#section-6-3){.pilcrow}

Historically, some packet-forwarding engines punted packets of this kind
to the control plane for more in-depth analysis, but this is unfeasible
on most contemporary router architectures as a result of the vast
difference between the hardware-based forwarding capacity of the router
and the processing capacity of the control plane and the size of the
management link that connects the control plane to the forwarding plane.
Other platforms may have a separate software-based forwarding plane that
is distinct both from the hardware-based forwarding plane and the
control plane. However, the limited CPU resources of this software-based
forwarding plane, as well as the limited bandwidth of the associated
link, results in similar throughput
constraints.[¶](#section-6-4){.pilcrow}

If an IPv6 header chain is sufficiently long such that it exceeds the
packet lookup capacity of the router, the router might be unable to
determine how the packet should be handled and thus could resort to
dropping the packet.[¶](#section-6-5){.pilcrow}

::: {#recirculation}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [Recirculation](#name-recirculation){.section-name .selfRef} {#name-recirculation}

Although type-length-value (TLV) chains are amenable to iterative
processing on architectures that have packet lookup engines with deep
inspection capabilities, some packet-forwarding engines manage IPv6
header chains using recirculation. This approach processes extension
headers one at a time: when processing on one extension header is
completed, the packet is looped back through the processing engine
again. This recirculation process continues repeatedly until there are
no more extension headers left to be
processed.[¶](#section-6.1-1){.pilcrow}

Recirculation is typically used on packet-forwarding engines with
limited lookup capability, because it allows arbitrarily long header
chains to be processed without the complexity and cost associated with
packet-forwarding engines, which have deep lookup capabilities. However,
recirculation can impact the forwarding capacity of hardware, as each
packet will pass through the processing engine multiple times. Depending
on configuration, the type of packets being processed, and the hardware
capabilities of the packet-forwarding engine, the data-plane throughput
performance on the router might be negatively
affected.[¶](#section-6.1-2){.pilcrow}
:::
:::
:::
:::

::: {#inability}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Requirement to Process Layer 3 / Layer 4 Information in Intermediate Systems](#name-requirement-to-process-laye){.section-name .selfRef} {#name-requirement-to-process-laye}

The following subsections discuss some of the reasons for which
intermediate systems may need to process Layer 3 / Layer 4 information
to make a forwarding decision.[¶](#section-7-1){.pilcrow}

::: {#ecmp-load-balancing}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [ECMP and Hash-Based Load Sharing](#name-ecmp-and-hash-based-load-sh){.section-name .selfRef} {#name-ecmp-and-hash-based-load-sh}

In the case of Equal Cost Multipath (ECMP) load sharing, the
intermediate system needs to make a decision regarding which of its
interfaces to use to forward a given packet. Since round-robin usage of
the links is usually avoided to prevent packet reordering, forwarding
engines need to use a mechanism that will consistently forward the same
data streams down the same forwarding paths. Most forwarding engines
achieve this by calculating a simple hash using an n-tuple gleaned from
a combination of Layer 2 through to Layer 4 protocol header information.
This n-tuple will typically use the src/dst Media Access Control (MAC)
addresses, src/dst IP addresses, and, if possible, further Layer 4
src/dst port information.[¶](#section-7.1-1){.pilcrow}

In the IPv6 world, flows are expected to be identified by means of the
IPv6 \"Flow Label\" \[[RFC6437](#RFC6437){.xref}\]. Thus, ECMP and
hash-based load sharing should be possible without the need to process
the entire IPv6 header chain to obtain upper-layer information to
identify flows. \[[RFC7098](#RFC7098){.xref}\] discusses how the IPv6
Flow Label can be used to enhance Layer 3/4 load distribution and
balancing for large server farms.[¶](#section-7.1-2){.pilcrow}

Historically, many IPv6 implementations failed to set the Flow Label,
and hash-based ECMP/load-sharing devices also did not employ the Flow
Label for performing their task. While support of
\[[RFC6437](#RFC6437){.xref}\] is currently widespread for current
versions of all popular host implementations, there is still only
marginal usage of the IPv6 Flow Label for ECMP and load balancing
\[[Almeida-2020](#Almeida-2020){.xref}\]. A contributing factor could be
the issues that have been found in host implementations and middleboxes
\[[Jaeggli-2018](#Jaeggli-2018){.xref}\].[¶](#section-7.1-3){.pilcrow}

Clearly, widespread support of \[[RFC6437](#RFC6437){.xref}\] would
relieve intermediate systems from having to process the entire IPv6
header chain, making Flow Label-based ECMP and load sharing
\[[RFC6438](#RFC6438){.xref}\] feasible.[¶](#section-7.1-4){.pilcrow}

If an intermediate system cannot determine consistent n-tuples for
calculating flow hashes, data streams are more likely to end up being
distributed unequally across ECMP and load-shared links. This may lead
to packet drops or reduced performance.[¶](#section-7.1-5){.pilcrow}
:::
:::

::: {#enforcing-infrastructure-acls}
::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [Enforcing Infrastructure ACLs](#name-enforcing-infrastructure-ac){.section-name .selfRef} {#name-enforcing-infrastructure-ac}

Infrastructure Access Control Lists (iACLs) drop unwanted packets
destined to a network\'s infrastructure. Typically, iACLs are deployed
because external direct access to a network\'s infrastructure addresses
is operationally unnecessary and can be used for attacks of different
sorts against router control planes. To this end, traffic usually needs
to be differentiated on the basis of Layer 3 or Layer 4 criteria to
achieve a useful balance of protection and functionality. For example,
an infrastructure may be configured with the following
policy:[¶](#section-7.2-1){.pilcrow}

-   [Permit some amount of ICMP echo (ping) traffic towards a router\'s
    addresses for
    troubleshooting.[¶](#section-7.2-2.1){.pilcrow}]{#section-7.2-2.1}
-   [Permit BGP sessions on the shared network of an exchange point
    (potentially differentiating between the amount of packets/second
    permitted for established sessions and for connection
    establishment), but do not permit other traffic from the same peer
    IP addresses.[¶](#section-7.2-2.2){.pilcrow}]{#section-7.2-2.2}

If a forwarding router cannot determine consistent n-tuples for
calculating flow hashes, data streams are more likely to end up being
distributed unequally across ECMP and load-shared links. This may lead
to packet drops or reduced performance.[¶](#section-7.2-3){.pilcrow}

If a network cannot deploy infrastructure ACLs, then the security of the
network may be compromised as a result of the increased attack
surface.[¶](#section-7.2-4){.pilcrow}
:::
:::

::: {#ddos-management}
::: {#section-7.3 .section}
### [7.3.](#section-7.3){.section-number .selfRef} [DDoS Management and Customer Requests for Filtering](#name-ddos-management-and-custome){.section-name .selfRef} {#name-ddos-management-and-custome}

The case of customer Distributed Denial-of-Service (DDoS) protection and
edge-to-core customer protection filters is similar in nature to the
iACL protection. Similar to iACL protection, Layer 4 ACLs generally need
to be applied as close to the edge of the network as possible, even
though the intent is usually to protect the customer edge rather than
the provider core. Application of Layer 4 DDoS protection to a network
edge is often automated using BGP Flowspec
\[[RFC8955](#RFC8955){.xref}\]
\[[RFC8956](#RFC8956){.xref}\].[¶](#section-7.3-1){.pilcrow}

For example, a website that normally only handles traffic on TCP ports
80 and 443 could be subject to a volumetric DDoS attack using NTP and
DNS packets with a randomized source IP address, thereby rendering
source-based remote triggered black hole \[[RFC5635](#RFC5635){.xref}\]
mechanisms useless. In this situation, ACLs that provide DDoS protection
could be configured to block all UDP traffic at the network edge without
impairing the web server functionality in any way. Thus, being able to
block arbitrary protocols at the network edge can avoid DDoS-related
problems both in the provider network and on the customer edge
link.[¶](#section-7.3-2){.pilcrow}
:::
:::

::: {#nids}
::: {#section-7.4 .section}
### [7.4.](#section-7.4){.section-number .selfRef} [Network Intrusion Detection and Prevention](#name-network-intrusion-detection){.section-name .selfRef} {#name-network-intrusion-detection}

Network Intrusion Detection Systems (NIDS) examine network traffic and
try to identify traffic patterns that can be correlated to network-based
attacks. These systems generally attempt to inspect application-layer
traffic (if possible) but, at the bare minimum, inspect Layer 4 flows.
When attack activity is inferred, the operator is notified of the
potential intrusion attempt.[¶](#section-7.4-1){.pilcrow}

Network Intrusion Prevention Systems (IPS) operate similarly to NIDSs,
but they can also prevent intrusions by reacting to detected attack
attempts by e.g., triggering packet filtering policies at firewalls and
other devices.[¶](#section-7.4-2){.pilcrow}

Use of extension headers can be problematic for NIDS/IPS,
since:[¶](#section-7.4-3){.pilcrow}

-   [Extension headers increase the complexity of resulting traffic and
    the associated work and system requirements to process
    it.[¶](#section-7.4-4.1){.pilcrow}]{#section-7.4-4.1}
-   [Use of unknown extension headers can prevent a NIDS or IPS from
    processing Layer 4
    information.[¶](#section-7.4-4.2){.pilcrow}]{#section-7.4-4.2}
-   [Use of IPv6 fragmentation requires a stateful fragment-reassembly
    operation, even for decoy traffic employing forged source addresses
    (see, e.g.,
    \[[nmap](#nmap){.xref}\]).[¶](#section-7.4-4.3){.pilcrow}]{#section-7.4-4.3}

As a result, in order to increase the efficiency or effectiveness of
these systems, packets employing IPv6 extension headers are often
dropped at the network ingress point(s) of networks that deploy these
systems.[¶](#section-7.4-5){.pilcrow}
:::
:::

::: {#firewalls}
::: {#section-7.5 .section}
### [7.5.](#section-7.5){.section-number .selfRef} [Firewalling](#name-firewalling){.section-name .selfRef} {#name-firewalling}

Firewalls enforce security policies by means of packet filtering. These
systems usually inspect Layer 3 and Layer 4 traffic but can often also
examine application-layer traffic flows.[¶](#section-7.5-1){.pilcrow}

As with a NIDS or IPS ([Section 7.4](#nids){.xref}), use of IPv6
extension headers can represent a challenge to network firewalls,
since:[¶](#section-7.5-2){.pilcrow}

-   [Extension headers increase the complexity of resulting traffic and
    the associated work and system requirements to process it, as
    outlined in
    \[[Zack-FW-Benchmark](#Zack-FW-Benchmark){.xref}\].[¶](#section-7.5-3.1){.pilcrow}]{#section-7.5-3.1}
-   [Use of unknown extension headers can prevent firewalls from
    processing Layer 4
    information.[¶](#section-7.5-3.2){.pilcrow}]{#section-7.5-3.2}
-   [Use of IPv6 fragmentation requires a stateful fragment-reassembly
    operation, even for decoy traffic employing forged source addresses
    (see, e.g.,
    \[[nmap](#nmap){.xref}\]).[¶](#section-7.5-3.3){.pilcrow}]{#section-7.5-3.3}

Additionally, a common firewall filtering policy is the so-called
\"default deny\", where all traffic is blocked (by default), and only
expected traffic is added to an \"allow/accept
list\".[¶](#section-7.5-4){.pilcrow}

As a result, packets employing IPv6 extension headers are often dropped
by network firewalls, either because of the challenges represented by
extension headers or because the use of IPv6 extension headers has not
been explicitly allowed.[¶](#section-7.5-5){.pilcrow}

Note that although the data presented in
\[[Zack-FW-Benchmark](#Zack-FW-Benchmark){.xref}\] was several years old
at the time of publication of this document, many contemporary firewalls
use comparable hardware and software architectures; consequently, the
conclusions of this benchmark are still relevant, despite its
age.[¶](#section-7.5-6){.pilcrow}
:::
:::
:::
:::

::: {#operational-implications}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Operational and Security Implications](#name-operational-and-security-im){.section-name .selfRef} {#name-operational-and-security-im}

::: {#inability-layer-4-info}
::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Inability to Find Layer 4 Information](#name-inability-to-find-layer-4-i){.section-name .selfRef} {#name-inability-to-find-layer-4-i}

As discussed in [Section 7](#inability){.xref}, intermediate systems
that need to find the Layer 4 header must process the entire IPv6 header
chain. When such devices are unable to obtain the required information,
the forwarding device has the option to drop the packet unconditionally,
forward the packet unconditionally, or process the packet outside the
normal forwarding path. Forwarding packets unconditionally will usually
allow for the circumvention of security controls (see, e.g., [Section
7.5](#firewalls){.xref}), while processing packets outside of the normal
forwarding path will usually open the door to Denial-of-Service (DoS)
attacks (see, e.g., [Section 6](#pfe-constraints){.xref}). Thus, in
these scenarios, devices often simply resort to dropping such packets
unconditionally.[¶](#section-8.1-1){.pilcrow}
:::
:::

::: {#route-processor-protection}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Route-Processor Protection](#name-route-processor-protection){.section-name .selfRef} {#name-route-processor-protection}

Most contemporary carrier-grade routers have a fast hardware-assisted
forwarding plane and a loosely coupled control plane, connected together
with a link that has much less capacity than the forwarding plane could
handle. Traffic differentiation cannot be performed by the control plane
because this would overload the internal link connecting the forwarding
plane to the control plane.[¶](#section-8.2-1){.pilcrow}

The Hop-by-Hop Options header has been particularly challenging since,
in most circumstances, the corresponding packet is punted to the control
plane for processing. As a result, many operators drop IPv6 packets
containing this extension header \[[RFC7872](#RFC7872){.xref}\].
\[[RFC6192](#RFC6192){.xref}\] provides advice regarding protection of a
router\'s control plane.[¶](#section-8.2-2){.pilcrow}
:::
:::

::: {#finer-grained}
::: {#section-8.3 .section}
### [8.3.](#section-8.3){.section-number .selfRef} [Inability to Perform Fine-Grained Filtering](#name-inability-to-perform-fine-g){.section-name .selfRef} {#name-inability-to-perform-fine-g}

Some intermediate systems do not have support for fine-grained filtering
of IPv6 extension headers. For example, an operator that wishes to drop
packets containing RHT0 may only be able to filter on the extension
header type (Routing Header). This could result in an operator enforcing
a coarser filtering policy (e.g., \"drop all packets containing a
Routing Header\" vs. \"only drop packets that contain a Routing Header
Type 0\").[¶](#section-8.3-1){.pilcrow}
:::
:::

::: {#security-implications}
::: {#section-8.4 .section}
### [8.4.](#section-8.4){.section-number .selfRef} [Security Concerns Associated with IPv6 Extension Headers](#name-security-concerns-associate){.section-name .selfRef} {#name-security-concerns-associate}

The security implications of IPv6 extension headers generally fall into
one or more of these categories:[¶](#section-8.4-1){.pilcrow}

-   [Evasion of security
    controls[¶](#section-8.4-2.1){.pilcrow}]{#section-8.4-2.1}
-   [DoS due to processing
    requirements[¶](#section-8.4-2.2){.pilcrow}]{#section-8.4-2.2}
-   [DoS due to implementation
    errors[¶](#section-8.4-2.3){.pilcrow}]{#section-8.4-2.3}
-   [Issues specific to the extension header
    type[¶](#section-8.4-2.4){.pilcrow}]{#section-8.4-2.4}

Unlike IPv4 packets where the upper-layer protocol can be trivially
found by means of the IHL field of the IPv4 header, the structure of
IPv6 packets is more flexible and complex. This can represent a
challenge for devices that need to find this information, since locating
upper-layer protocol information requires that all IPv6 extension
headers be examined. In turn, this presents implementation difficulties,
since some packet-filtering mechanisms that require upper-layer
information (even if just the upper-layer protocol type) can be
trivially circumvented by inserting IPv6 extension headers between the
main IPv6 header and the upper-layer protocol header.
\[[RFC7113](#RFC7113){.xref}\] describes this issue for the RA-Guard
case, but the same techniques could be employed to circumvent other IPv6
firewall and packet-filtering mechanisms. Additionally, implementation
inconsistencies in packet-forwarding engines can result in evasion of
security controls
\[[PARSING](#I-D.kampanakis-6man-ipv6-eh-parsing){.xref}\]
\[[Atlasis2014](#Atlasis2014){.xref}\]
\[[BH-EU-2014](#BH-EU-2014){.xref}\].[¶](#section-8.4-3){.pilcrow}

Sometimes, packets with IPv6 extension headers can impact throughput
performance on intermediate systems. Unless appropriate mitigations are
put in place (e.g., packet dropping and/or rate limiting), an attacker
could simply send a large amount of IPv6 traffic employing IPv6
extension headers with the purpose of performing a DoS attack (see
Sections [6.1](#recirculation){.xref} and
[8](#operational-implications){.xref} for further details). The extent
to which performance is affected on these devices is implementation
dependent.[¶](#section-8.4-4){.pilcrow}

NOTE:[¶](#section-8.4-5.1){.pilcrow}

In the most trivial case, a packet that includes a Hop-by-Hop Options
header might go through the slow forwarding path, to be processed by the
router\'s CPU. Alternatively, a router configured to enforce an ACL
based on upper-layer information (e.g., upper-layer protocol type or TCP
Destination Port) may need to process the entire IPv6 header chain in
order to find the required information, thereby causing the packet to be
processed in the slow path \[[Cisco-EH-Cons](#Cisco-EH-Cons){.xref}\].
We note that, for obvious reasons, the aforementioned performance issues
can affect devices such as firewalls, NIDSs, etc.
\[[Zack-FW-Benchmark](#Zack-FW-Benchmark){.xref}\].[¶](#section-8.4-5.2){.pilcrow}

IPv6 implementations, like all other software, tend to mature with time
and wide-scale deployment. While the IPv6 protocol itself has existed
for over 20 years, serious bugs related to IPv6 extension header
processing continue to be discovered (see, e.g.,
\[[Cisco-Frag](#Cisco-Frag){.xref}\],
\[[Microsoft-SA](#Microsoft-SA){.xref}\], and
\[[FreeBSD-SA](#FreeBSD-SA){.xref}\]). Because there is currently little
operational reliance on IPv6 extension headers, the corresponding code
paths are rarely exercised, and there is the potential for bugs that
still remain to be discovered in some
implementations.[¶](#section-8.4-6){.pilcrow}

The IPv6 Fragment Header is employed for the fragmentation and
reassembly of IPv6 packets. While many of the security implications of
the fragmentation/reassembly mechanism are known from the IPv4 world,
several related issues have crept into IPv6 implementations. These range
from DoS attacks to information leakages, as discussed in
\[[RFC7739](#RFC7739){.xref}\],
\[[Bonica-NANOG58](#Bonica-NANOG58){.xref}\], and
\[[Atlasis2012](#Atlasis2012){.xref}\].[¶](#section-8.4-7){.pilcrow}
:::
:::
:::
:::

::: {#iana-cons}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-9-1){.pilcrow}
:::
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

The security implications of IPv6 extension headers are discussed in
[Section 8.4](#security-implications){.xref}. This document does not
introduce any new security issues.[¶](#section-10-1){.pilcrow}
:::

::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-11.1 .section}
### [11.1.](#section-11.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC5095\]
:   [Abley, J.]{.refAuthor}, [Savola, P.]{.refAuthor}, and [G.
    Neville-Neil]{.refAuthor}, [\"Deprecation of Type 0 Routing Headers
    in IPv6\"]{.refTitle}, [RFC 5095]{.seriesInfo}, [DOI
    10.17487/RFC5095]{.seriesInfo}, December 2007,
    \<<https://www.rfc-editor.org/info/rfc5095>\>.
:   

\[RFC5722\]
:   [Krishnan, S.]{.refAuthor}, [\"Handling of Overlapping IPv6
    Fragments\"]{.refTitle}, [RFC 5722]{.seriesInfo}, [DOI
    10.17487/RFC5722]{.seriesInfo}, December 2009,
    \<<https://www.rfc-editor.org/info/rfc5722>\>.
:   

\[RFC6946\]
:   [Gont, F.]{.refAuthor}, [\"Processing of IPv6 \"Atomic\"
    Fragments\"]{.refTitle}, [RFC 6946]{.seriesInfo}, [DOI
    10.17487/RFC6946]{.seriesInfo}, May 2013,
    \<<https://www.rfc-editor.org/info/rfc6946>\>.
:   

\[RFC6980\]
:   [Gont, F.]{.refAuthor}, [\"Security Implications of IPv6
    Fragmentation with IPv6 Neighbor Discovery\"]{.refTitle}, [RFC
    6980]{.seriesInfo}, [DOI 10.17487/RFC6980]{.seriesInfo}, August
    2013, \<<https://www.rfc-editor.org/info/rfc6980>\>.
:   

\[RFC7112\]
:   [Gont, F.]{.refAuthor}, [Manral, V.]{.refAuthor}, and [R.
    Bonica]{.refAuthor}, [\"Implications of Oversized IPv6 Header
    Chains\"]{.refTitle}, [RFC 7112]{.seriesInfo}, [DOI
    10.17487/RFC7112]{.seriesInfo}, January 2014,
    \<<https://www.rfc-editor.org/info/rfc7112>\>.
:   

\[RFC8021\]
:   [Gont, F.]{.refAuthor}, [Liu, W.]{.refAuthor}, and [T.
    Anderson]{.refAuthor}, [\"Generation of IPv6 Atomic Fragments
    Considered Harmful\"]{.refTitle}, [RFC 8021]{.seriesInfo}, [DOI
    10.17487/RFC8021]{.seriesInfo}, January 2017,
    \<<https://www.rfc-editor.org/info/rfc8021>\>.
:   

\[RFC8200\]
:   [Deering, S.]{.refAuthor} and [R. Hinden]{.refAuthor}, [\"Internet
    Protocol, Version 6 (IPv6) Specification\"]{.refTitle}, [STD
    86]{.seriesInfo}, [RFC 8200]{.seriesInfo}, [DOI
    10.17487/RFC8200]{.seriesInfo}, July 2017,
    \<<https://www.rfc-editor.org/info/rfc8200>\>.
:   

\[RFC8504\]
:   [Chown, T.]{.refAuthor}, [Loughney, J.]{.refAuthor}, and [T.
    Winters]{.refAuthor}, [\"IPv6 Node Requirements\"]{.refTitle}, [BCP
    220]{.seriesInfo}, [RFC 8504]{.seriesInfo}, [DOI
    10.17487/RFC8504]{.seriesInfo}, January 2019,
    \<<https://www.rfc-editor.org/info/rfc8504>\>.
:   
:::

::: {#section-11.2 .section}
### [11.2.](#section-11.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[Almeida-2020\]
:   [Almeida, R.]{.refAuthor}, [Cunha, I.]{.refAuthor},
    [Teixeira, R.]{.refAuthor}, [Veitch, D.]{.refAuthor}, and [C.
    Diot]{.refAuthor}, [\"Classification of Load Balancing in the
    Internet\"]{.refTitle}, [IEEE INFOCOM 2020]{.refContent}, [DOI
    10.1109/INFOCOM41043.2020.9155387]{.seriesInfo}, July 2020,
    \<<https://homepages.dcc.ufmg.br/~cunha/papers/almeida20infocom-mca.pdf>\>.
:   

\[APNIC-Scudder\]
:   [Scudder, J.]{.refAuthor}, [\"Modern router architecture and
    IPv6\"]{.refTitle}, [APNIC Blog]{.refContent}, June 2020,
    \<<https://blog.apnic.net/2020/06/04/modern-router-architecture-and-ipv6/>\>.
:   

\[Atlasis2012\]
:   [Atlasis, A.]{.refAuthor}, [\"Attacking IPv6 Implementation Using
    Fragmentation\"]{.refTitle}, [Black Hat Europe 2012]{.refContent},
    March 2012,
    \<<https://void.gr/kargig/ipv6/bh-eu-12-Atlasis-Attacking_IPv6-Slides.pdf>\>.
:   

\[Atlasis2014\]
:   [Atlasis, A.]{.refAuthor}, [\"A Novel Way of Abusing IPv6 Extension
    Headers to Evade IPv6 Security Devices\"]{.refTitle}, May 2014,
    \<[http://www.insinuator.net/2014/05/a-novel-way-of-abusing-ipv6-extension-headers-to-evade-ipv6-security-devices/](https://www.insinuator.net/2014/05/a-novel-way-of-abusing-ipv6-extension-headers-to-evade-ipv6-security-devices/)\>.
:   

\[BH-EU-2014\]
:   [Atlasis, A.]{.refAuthor}, [Rey, E.]{.refAuthor}, and [R.
    Schaefer]{.refAuthor}, [\"Evasion of High-End IDPS Devices at the
    IPv6 Era\"]{.refTitle}, [Black Hat Europe 2014]{.refContent}, 2014,
    \<<https://www.ernw.de/download/eu-14-Atlasis-Rey-Schaefer-briefings-Evasion-of-HighEnd-IPS-Devices-wp.pdf>\>.
:   

\[Bonica-NANOG58\]
:   [Bonica, R.]{.refAuthor}, [\"IPv6 Fragmentation: The Case For
    Deprecation\"]{.refTitle}, [NANOG 58]{.refContent}, June 2013,
    \<<https://www.nanog.org/sites/default/files/mon.general.fragmentation.bonica.pdf>\>.
:   

\[Cisco-EH-Cons\]
:   [Cisco]{.refAuthor}, [\"IPv6 Extension Headers Review and
    Considerations\"]{.refTitle}, October 2006,
    \<[http://www.cisco.com/en/US/technologies/tk648/tk872/technologies_white_paper0900aecd8054d37d.pdf](https://www.cisco.com/en/US/technologies/tk648/tk872/technologies_white_paper0900aecd8054d37d.pdf)\>.
:   

\[Cisco-Frag\]
:   [Cisco]{.refAuthor}, [\"Cisco IOS XR Software Crafted IPv6 Packet
    Denial of Service Vulnerability\"]{.refTitle}, June 2015,
    \<[http://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20150611-iosxr](https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20150611-iosxr)\>.
:   

\[FreeBSD-SA\]
:   [The FreeBSD Project]{.refAuthor}, [\"IPv6 Hop-by-Hop options
    use-after-free bug\"]{.refTitle}, September 2020,
    \<<https://www.freebsd.org/security/advisories/FreeBSD-SA-20:24.ipv6.asc>\>.
:   

\[HEADERS\]
:   [Kumari, W.]{.refAuthor}, [Jaeggli, J.]{.refAuthor}, [Bonica, R.
    P.]{.refAuthor}, and [J. Linkova]{.refAuthor}, [\"Operational Issues
    Associated With Long IPv6 Header Chains\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-wkumari-long-headers-03]{.seriesInfo}, 16 June 2015,
    \<<https://datatracker.ietf.org/doc/html/draft-wkumari-long-headers-03>\>.
:   

\[Huston-2017\]
:   [Huston, G.]{.refAuthor}, [\"Dealing with IPv6 fragmentation in the
    DNS\"]{.refTitle}, [APNIC Blog]{.refContent}, August 2017,
    \<<https://blog.apnic.net/2017/08/22/dealing-ipv6-fragmentation-dns/>\>.
:   

\[Huston-2020\]
:   [Huston, G.]{.refAuthor}, [\"Measurement of IPv6 Extension Header
    Support\"]{.refTitle}, [NPS/CAIDA 2020 Virtual IPv6
    Workshop]{.refContent}, June 2020,
    \<<https://www.cmand.org/workshops/202006-v6/slides/2020-06-16-xtn-hdrs.pdf>\>.
:   

\[IEPG94-Scudder\]
:   [Petersen, B.]{.refAuthor} and [J. Scudder]{.refAuthor}, [\"Modern
    Router Architecture for Protocol Designers\"]{.refTitle}, [IEPG
    94]{.refContent}, November 2015,
    \<<http://www.iepg.org/2015-11-01-ietf94/IEPG-RouterArchitecture-jgs.pdf>\>.
:   

\[IPV6-EH\]
:   [Gont, F.]{.refAuthor} and [W. Liu]{.refAuthor}, [\"Recommendations
    on the Filtering of IPv6 Packets Containing IPv6 Extension Headers
    at Transit Routers\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft,
    draft-ietf-opsec-ipv6-eh-filtering-08]{.seriesInfo}, 3 June 2021,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-opsec-ipv6-eh-filtering-08>\>.
:   

\[Jaeggli-2018\]
:   [Jaeggli, J.]{.refAuthor}, [\"IPv6 flow label: misuse in
    hashing\"]{.refTitle}, [APNIC Blog]{.refContent}, January 2018,
    \<<https://blog.apnic.net/2018/01/11/ipv6-flow-label-misuse-hashing/>\>.
:   

\[Linkova-Gont-IEPG90\]
:   [Linkova, J.]{.refAuthor} and [F. Gont]{.refAuthor}, [\"IPv6
    Extension Headers in the Real World v2.0\"]{.refTitle}, [IEPG
    90]{.refContent}, July 2014,
    \<<http://www.iepg.org/2014-07-20-ietf90/iepg-ietf90-ipv6-ehs-in-the-real-world-v2.0.pdf>\>.
:   

\[Microsoft-SA\]
:   [Microsoft]{.refAuthor}, [\"Windows TCP/IP Remote Code Execution
    Vulnerability\"]{.refTitle}, [CVE-2021-24094]{.refContent}, February
    2021,
    \<<https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-24094>\>.
:   

\[nmap\]
:   [Lyon, G.]{.refAuthor}, [\"Firewall/IDS Evasion and
    Spoofing\"]{.refTitle}, [Chapter 15. Nmap Reference
    Guide]{.refContent},
    \<<https://nmap.org/book/man-bypass-firewalls-ids.html>\>.
:   

\[OPERATORS\]
:   [Jaeggli, J.]{.refAuthor}, [Colitti, L.]{.refAuthor},
    [Kumari, W.]{.refAuthor}, [Vyncke, E.]{.refAuthor},
    [Kaeo, M.]{.refAuthor}, and [T. Taylor, Ed.]{.refAuthor}, [\"Why
    Operators Filter Fragments and What It Implies\"]{.refTitle}, [Work
    in Progress]{.refContent}, [Internet-Draft,
    draft-taylor-v6ops-fragdrop-02]{.seriesInfo}, 3 December 2013,
    \<<https://datatracker.ietf.org/doc/html/draft-taylor-v6ops-fragdrop-02>\>.
:   

\[PARSING\]
:   [Kampanakis, P.]{.refAuthor}, [\"Implementation Guidelines for
    Parsing IPv6 Extension Headers\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-kampanakis-6man-ipv6-eh-parsing-01]{.seriesInfo}, 5 August
    2014,
    \<<https://datatracker.ietf.org/doc/html/draft-kampanakis-6man-ipv6-eh-parsing-01>\>.
:   

\[PMTUD-Blackholes\]
:   [De Boer, M.]{.refAuthor} and [J. Bosma]{.refAuthor}, [\"Discovering
    Path MTU black holes on the Internet using RIPE Atlas\"]{.refTitle},
    [University of Amsterdam, MSc. Systems & Network
    Engineering]{.refContent}, July 2012,
    \<[http://www.nlnetlabs.nl/downloads/publications/pmtu-black-holes-msc-thesis.pdf](https://www.nlnetlabs.nl/downloads/publications/pmtu-black-holes-msc-thesis.pdf)\>.
:   

\[RFC2460\]
:   [Deering, S.]{.refAuthor} and [R. Hinden]{.refAuthor}, [\"Internet
    Protocol, Version 6 (IPv6) Specification\"]{.refTitle}, [RFC
    2460]{.seriesInfo}, [DOI 10.17487/RFC2460]{.seriesInfo}, December
    1998, \<<https://www.rfc-editor.org/info/rfc2460>\>.
:   

\[RFC5635\]
:   [Kumari, W.]{.refAuthor} and [D. McPherson]{.refAuthor}, [\"Remote
    Triggered Black Hole Filtering with Unicast Reverse Path Forwarding
    (uRPF)\"]{.refTitle}, [RFC 5635]{.seriesInfo}, [DOI
    10.17487/RFC5635]{.seriesInfo}, August 2009,
    \<<https://www.rfc-editor.org/info/rfc5635>\>.
:   

\[RFC6192\]
:   [Dugal, D.]{.refAuthor}, [Pignataro, C.]{.refAuthor}, and [R.
    Dunn]{.refAuthor}, [\"Protecting the Router Control
    Plane\"]{.refTitle}, [RFC 6192]{.seriesInfo}, [DOI
    10.17487/RFC6192]{.seriesInfo}, March 2011,
    \<<https://www.rfc-editor.org/info/rfc6192>\>.
:   

\[RFC6437\]
:   [Amante, S.]{.refAuthor}, [Carpenter, B.]{.refAuthor},
    [Jiang, S.]{.refAuthor}, and [J. Rajahalme]{.refAuthor}, [\"IPv6
    Flow Label Specification\"]{.refTitle}, [RFC 6437]{.seriesInfo},
    [DOI 10.17487/RFC6437]{.seriesInfo}, November 2011,
    \<<https://www.rfc-editor.org/info/rfc6437>\>.
:   

\[RFC6438\]
:   [Carpenter, B.]{.refAuthor} and [S. Amante]{.refAuthor}, [\"Using
    the IPv6 Flow Label for Equal Cost Multipath Routing and Link
    Aggregation in Tunnels\"]{.refTitle}, [RFC 6438]{.seriesInfo}, [DOI
    10.17487/RFC6438]{.seriesInfo}, November 2011,
    \<<https://www.rfc-editor.org/info/rfc6438>\>.
:   

\[RFC7045\]
:   [Carpenter, B.]{.refAuthor} and [S. Jiang]{.refAuthor},
    [\"Transmission and Processing of IPv6 Extension
    Headers\"]{.refTitle}, [RFC 7045]{.seriesInfo}, [DOI
    10.17487/RFC7045]{.seriesInfo}, December 2013,
    \<<https://www.rfc-editor.org/info/rfc7045>\>.
:   

\[RFC7098\]
:   [Carpenter, B.]{.refAuthor}, [Jiang, S.]{.refAuthor}, and [W.
    Tarreau]{.refAuthor}, [\"Using the IPv6 Flow Label for Load
    Balancing in Server Farms\"]{.refTitle}, [RFC 7098]{.seriesInfo},
    [DOI 10.17487/RFC7098]{.seriesInfo}, January 2014,
    \<<https://www.rfc-editor.org/info/rfc7098>\>.
:   

\[RFC7113\]
:   [Gont, F.]{.refAuthor}, [\"Implementation Advice for IPv6 Router
    Advertisement Guard (RA-Guard)\"]{.refTitle}, [RFC
    7113]{.seriesInfo}, [DOI 10.17487/RFC7113]{.seriesInfo}, February
    2014, \<<https://www.rfc-editor.org/info/rfc7113>\>.
:   

\[RFC7739\]
:   [Gont, F.]{.refAuthor}, [\"Security Implications of Predictable
    Fragment Identification Values\"]{.refTitle}, [RFC
    7739]{.seriesInfo}, [DOI 10.17487/RFC7739]{.seriesInfo}, February
    2016, \<<https://www.rfc-editor.org/info/rfc7739>\>.
:   

\[RFC7872\]
:   [Gont, F.]{.refAuthor}, [Linkova, J.]{.refAuthor},
    [Chown, T.]{.refAuthor}, and [W. Liu]{.refAuthor}, [\"Observations
    on the Dropping of Packets with IPv6 Extension Headers in the Real
    World\"]{.refTitle}, [RFC 7872]{.seriesInfo}, [DOI
    10.17487/RFC7872]{.seriesInfo}, June 2016,
    \<<https://www.rfc-editor.org/info/rfc7872>\>.
:   

\[RFC8900\]
:   [Bonica, R.]{.refAuthor}, [Baker, F.]{.refAuthor},
    [Huston, G.]{.refAuthor}, [Hinden, R.]{.refAuthor},
    [Troan, O.]{.refAuthor}, and [F. Gont]{.refAuthor}, [\"IP
    Fragmentation Considered Fragile\"]{.refTitle}, [BCP
    230]{.seriesInfo}, [RFC 8900]{.seriesInfo}, [DOI
    10.17487/RFC8900]{.seriesInfo}, September 2020,
    \<<https://www.rfc-editor.org/info/rfc8900>\>.
:   

\[RFC8955\]
:   [Loibl, C.]{.refAuthor}, [Hares, S.]{.refAuthor},
    [Raszuk, R.]{.refAuthor}, [McPherson, D.]{.refAuthor}, and [M.
    Bacher]{.refAuthor}, [\"Dissemination of Flow Specification
    Rules\"]{.refTitle}, [RFC 8955]{.seriesInfo}, [DOI
    10.17487/RFC8955]{.seriesInfo}, December 2020,
    \<<https://www.rfc-editor.org/info/rfc8955>\>.
:   

\[RFC8956\]
:   [Loibl, C., Ed.]{.refAuthor}, [Raszuk, R., Ed.]{.refAuthor}, and [S.
    Hares, Ed.]{.refAuthor}, [\"Dissemination of Flow Specification
    Rules for IPv6\"]{.refTitle}, [RFC 8956]{.seriesInfo}, [DOI
    10.17487/RFC8956]{.seriesInfo}, December 2020,
    \<<https://www.rfc-editor.org/info/rfc8956>\>.
:   

\[Zack-FW-Benchmark\]
:   [Zack, E.]{.refAuthor}, [\"Firewall Security Assessment and
    Benchmarking IPv6 Firewall Load Tests\"]{.refTitle}, [IPv6 Hackers
    Meeting #1]{.refContent}, June 2013,
    \<<https://www.ipv6hackers.org/files/meetings/ipv6-hackers-1/zack-ipv6hackers1-firewall-security-assessment-and-benchmarking.pdf>\>.
:   
:::
:::

::: {#appendix-A .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The authors would like to thank (in alphabetical order) [Mikael
Abrahamsson]{.contact-name}, [Fred Baker]{.contact-name}, [Dale W.
Carder]{.contact-name}, [Brian Carpenter]{.contact-name}, [Tim
Chown]{.contact-name}, [Owen DeLong]{.contact-name}, [Gorry
Fairhurst]{.contact-name}, [Guillermo Gont]{.contact-name}, [Tom
Herbert]{.contact-name}, [Lee Howard]{.contact-name}, [Tom
Petch]{.contact-name}, [Sander Steffann]{.contact-name}, [Eduard
Vasilenko]{.contact-name}, [Éric Vyncke]{.contact-name}, [Rob
Wilton]{.contact-name}, [Jingrong Xie]{.contact-name}, and [Andrew
Yourtchenko]{.contact-name} for providing valuable comments on earlier
draft versions of this document.[¶](#appendix-A-1){.pilcrow}

[Fernando Gont]{.contact-name} would like to thank [Jan
Zorz]{.contact-name} / Go6 Lab \<<https://go6lab.si/>\>, [Jared
Mauch]{.contact-name}, and [Sander Steffann]{.contact-name}
\<<https://steffann.nl/>\> for providing access to systems and networks
that were employed to perform experiments and measurements involving
packets with IPv6 extension headers.[¶](#appendix-A-2){.pilcrow}
:::

::: {#authors-addresses}
::: {#appendix-B .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Fernando Gont]{.fn .nameRole}
:::

::: {.left dir="auto"}
[SI6 Networks]{.org}
:::

::: {.left dir="auto"}
[Segurola y Habana 4310, 7mo Piso]{.street-address}
:::

::: {.left dir="auto"}
[Villa Devoto]{.locality}
:::

::: {.left dir="auto"}
[Ciudad Autonoma de Buenos Aires]{.region}
:::

::: {.left dir="auto"}
[Argentina]{.country-name}
:::

::: email
Email: <fgont@si6networks.com>
:::

::: url
URI: <https://www.si6networks.com>
:::

::: {.left dir="auto"}
[Nick Hilliard]{.fn .nameRole}
:::

::: {.left dir="auto"}
[INEX]{.org}
:::

::: {.left dir="auto"}
[4027 Kingswood Road]{.street-address}
:::

::: {.left dir="auto"}
[Dublin]{.locality}
:::

::: {.left dir="auto"}
[24]{.postal-code}
:::

::: {.left dir="auto"}
[Ireland]{.country-name}
:::

::: email
Email: <nick@inex.ie>
:::

::: {.left dir="auto"}
[Gert Doering]{.fn .nameRole}
:::

::: {.left dir="auto"}
[SpaceNet AG]{.org}
:::

::: {.left dir="auto"}
[Joseph-Dollinger-Bogen 14]{.street-address}
:::

::: {.left dir="auto"}
[D-80807]{.postal-code} [Muenchen]{.locality}
:::

::: {.left dir="auto"}
[Germany]{.country-name}
:::

::: email
Email: <gert@space.net>
:::

::: {.left dir="auto"}
[Warren Kumari]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google]{.org}
:::

::: {.left dir="auto"}
[1600 Amphitheatre Parkway]{.street-address}
:::

::: {.left dir="auto"}
[Mountain View]{.locality}, [CA]{.region} [94043]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <warren@kumari.net>
:::

::: {.left dir="auto"}
[Geoff Huston]{.fn .nameRole}
:::

::: email
Email: <gih@apnic.net>
:::

::: url
URI: <https://www.apnic.net>
:::

::: {.left dir="auto"}
[Will (Shucheng) Liu]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Huawei Technologies]{.org}
:::

::: {.left dir="auto"}
[Bantian, Longgang District]{.street-address}
:::

::: {.left dir="auto"}
[Shenzhen]{.locality}
:::

::: {.left dir="auto"}
[518129]{.postal-code}
:::

::: {.left dir="auto"}
[China]{.country-name}
:::

::: email
Email: <liushucheng@huawei.com>
:::
:::
:::
