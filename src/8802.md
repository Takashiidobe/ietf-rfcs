  RFC 8802         The Quality for Service (Q4S) Protocol   July 2020
  ---------------- ---------------------------------------- -----------
  Aranda, et al.   Informational                            \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Independent Submission

RFC:
:   [8802](https://www.rfc-editor.org/rfc/rfc8802){.eref}

Category:
:   Informational

Published:
:   July 2020

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    J.J. Aranda
    :::

    ::: org
    Nokia
    :::
    :::

    ::: author
    ::: author-name
    M. Cortés
    :::

    ::: org
    Nokia
    :::
    :::

    ::: author
    ::: author-name
    J. Salvachúa
    :::

    ::: org
    Univ. Politecnica de Madrid
    :::
    :::

    ::: author
    ::: author-name
    M. Narganes
    :::

    ::: org
    Tecnalia
    :::
    :::

    ::: author
    ::: author-name
    I. Martínez-Sarriegui
    :::

    ::: org
    Optiva Media
    :::
    :::
:::

# RFC 8802 {#rfcnum}

# The Quality for Service (Q4S) Protocol {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This memo describes an application-level protocol for the communication
of end-to-end QoS compliance information based on the HyperText Transfer
Protocol (HTTP) and the Session Description Protocol (SDP). The Quality
for Service (Q4S) protocol provides a mechanism to negotiate and monitor
latency, jitter, bandwidth, and packet loss, and to alert whenever one
of the negotiated conditions is
violated.[¶](#section-abstract-1){.pilcrow}

Implementation details on the actions to be triggered upon
reception/detection of QoS alerts exchanged by the protocol are out of
scope of this document; it is either application dependent (e.g., act to
increase quality or reduce bit-rate) or network dependent (e.g., change
connection\'s quality profile).[¶](#section-abstract-2){.pilcrow}

This protocol specification is the product of research conducted over a
number of years; it is presented here as a permanent record and to offer
a foundation for future similar work. It does not represent a standard
protocol and does not have IETF
consensus.[¶](#section-abstract-3){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This document is not an Internet Standards Track specification; it is
published for informational
purposes.[¶](#section-boilerplate.1-1){.pilcrow}

This is a contribution to the RFC Series, independently of any other RFC
stream. The RFC Editor has chosen to publish this document at its
discretion and makes no statement about its value for implementation or
deployment. Documents approved for publication by the RFC Editor are not
candidates for any level of Internet Standard; see Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8802>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2020 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Scope](#name-scope){.xref}[¶](#section-toc.1-1.1.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.2}
        [1.2](#section-1.2){.xref}.  [Motivation](#name-motivation){.xref}[¶](#section-toc.1-1.1.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.3}
        [1.3](#section-1.3){.xref}.  [Summary of
        Features](#name-summary-of-features){.xref}[¶](#section-toc.1-1.1.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.4}
        [1.4](#section-1.4){.xref}.  [Differences from
        OWAMP/TWAMP](#name-differences-from-owamp-twam){.xref}[¶](#section-toc.1-1.1.2.4.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Terminology](#name-terminology){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Overview of
    Operation](#name-overview-of-operation){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Q4S
    Messages](#name-q4s-messages){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [Requests](#name-requests){.xref}[¶](#section-toc.1-1.4.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [Responses](#name-responses){.xref}[¶](#section-toc.1-1.4.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [Header
        Fields](#name-header-fields){.xref}[¶](#section-toc.1-1.4.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.3.2.1}
            [4.3.1](#section-4.3.1){.xref}.  [Common Q4S Header
            Fields](#name-common-q4s-header-fields){.xref}[¶](#section-toc.1-1.4.2.3.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.3.2.2}
            [4.3.2](#section-4.3.2){.xref}.  [Specific Q4S Request
            Header
            Fields](#name-specific-q4s-request-header){.xref}[¶](#section-toc.1-1.4.2.3.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.3.2.3}
            [4.3.3](#section-4.3.3){.xref}.  [Specific Q4S Response
            Header
            Fields](#name-specific-q4s-response-heade){.xref}[¶](#section-toc.1-1.4.2.3.2.3.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.xref}.  [Bodies](#name-bodies){.xref}[¶](#section-toc.1-1.4.2.4.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.4.2.1}
            [4.4.1](#section-4.4.1){.xref}.  [Encoding](#name-encoding){.xref}[¶](#section-toc.1-1.4.2.4.2.1.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Q4S Method
    Definitions](#name-q4s-method-definitions){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [BEGIN](#name-begin){.xref}[¶](#section-toc.1-1.5.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [READY](#name-ready){.xref}[¶](#section-toc.1-1.5.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.xref}.  [PING](#name-ping){.xref}[¶](#section-toc.1-1.5.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.4}
        [5.4](#section-5.4){.xref}.  [BWIDTH](#name-bwidth){.xref}[¶](#section-toc.1-1.5.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.5}
        [5.5](#section-5.5){.xref}.  [Q4S-ALERT](#name-q4s-alert){.xref}[¶](#section-toc.1-1.5.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.6}
        [5.6](#section-5.6){.xref}.  [Q4S-RECOVERY](#name-q4s-recovery){.xref}[¶](#section-toc.1-1.5.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.7}
        [5.7](#section-5.7){.xref}.  [CANCEL](#name-cancel){.xref}[¶](#section-toc.1-1.5.2.7.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Response
    Codes](#name-response-codes){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.xref}.  [100
        Trying](#name-100-trying){.xref}[¶](#section-toc.1-1.6.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.6.2.2}
        [6.2](#section-6.2){.xref}.  [Success
        2xx](#name-success-2xx){.xref}[¶](#section-toc.1-1.6.2.2.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.2.2.1}
            [6.2.1](#section-6.2.1){.xref}.  [200
            OK](#name-200-ok){.xref}[¶](#section-toc.1-1.6.2.2.2.1.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.3}
        [6.3](#section-6.3){.xref}.  [Redirection
        3xx](#name-redirection-3xx){.xref}[¶](#section-toc.1-1.6.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.6.2.4}
        [6.4](#section-6.4){.xref}.  [Request Failure
        4xx](#name-request-failure-4xx){.xref}[¶](#section-toc.1-1.6.2.4.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.4.2.1}
            [6.4.1](#section-6.4.1){.xref}.  [400 Bad
            Request](#name-400-bad-request){.xref}[¶](#section-toc.1-1.6.2.4.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.2}
            [6.4.2](#section-6.4.2){.xref}.  [404 Not
            Found](#name-404-not-found){.xref}[¶](#section-toc.1-1.6.2.4.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.3}
            [6.4.3](#section-6.4.3){.xref}.  [405 Method Not
            Allowed](#name-405-method-not-allowed){.xref}[¶](#section-toc.1-1.6.2.4.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.4}
            [6.4.4](#section-6.4.4){.xref}.  [406 Not
            Acceptable](#name-406-not-acceptable){.xref}[¶](#section-toc.1-1.6.2.4.2.4.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.5}
            [6.4.5](#section-6.4.5){.xref}.  [408 Request
            Timeout](#name-408-request-timeout){.xref}[¶](#section-toc.1-1.6.2.4.2.5.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.6}
            [6.4.6](#section-6.4.6){.xref}.  [413 Request Entity Too
            Large](#name-413-request-entity-too-larg){.xref}[¶](#section-toc.1-1.6.2.4.2.6.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.7}
            [6.4.7](#section-6.4.7){.xref}.  [414 Request-URI Too
            Long](#name-414-request-uri-too-long){.xref}[¶](#section-toc.1-1.6.2.4.2.7.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.8}
            [6.4.8](#section-6.4.8){.xref}.  [415 Unsupported Media
            Type](#name-415-unsupported-media-type){.xref}[¶](#section-toc.1-1.6.2.4.2.8.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.9}
            [6.4.9](#section-6.4.9){.xref}.  [416 Unsupported URI
            Scheme](#name-416-unsupported-uri-scheme){.xref}[¶](#section-toc.1-1.6.2.4.2.9.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.5}
        [6.5](#section-6.5){.xref}.  [Server Failure
        5xx](#name-server-failure-5xx){.xref}[¶](#section-toc.1-1.6.2.5.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.5.2.1}
            [6.5.1](#section-6.5.1){.xref}.  [500 Server Internal
            Error](#name-500-server-internal-error){.xref}[¶](#section-toc.1-1.6.2.5.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.5.2.2}
            [6.5.2](#section-6.5.2){.xref}.  [501 Not
            Implemented](#name-501-not-implemented){.xref}[¶](#section-toc.1-1.6.2.5.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.5.2.3}
            [6.5.3](#section-6.5.3){.xref}.  [503 Service
            Unavailable](#name-503-service-unavailable){.xref}[¶](#section-toc.1-1.6.2.5.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.5.2.4}
            [6.5.4](#section-6.5.4){.xref}.  [504 Server
            Time-Out](#name-504-server-time-out){.xref}[¶](#section-toc.1-1.6.2.5.2.4.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.5.2.5}
            [6.5.5](#section-6.5.5){.xref}.  [505 Version Not
            Supported](#name-505-version-not-supported){.xref}[¶](#section-toc.1-1.6.2.5.2.5.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.5.2.6}
            [6.5.6](#section-6.5.6){.xref}.  [513 Message Too
            Large](#name-513-message-too-large){.xref}[¶](#section-toc.1-1.6.2.5.2.6.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.6}
        [6.6](#section-6.6){.xref}.  [Global Failures
        6xx](#name-global-failures-6xx){.xref}[¶](#section-toc.1-1.6.2.6.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.6.2.1}
            [6.6.1](#section-6.6.1){.xref}.  [600 Session Does Not
            Exist](#name-600-session-does-not-exist){.xref}[¶](#section-toc.1-1.6.2.6.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.6.2.2}
            [6.6.2](#section-6.6.2){.xref}.  [601 Quality Level Not
            Allowed](#name-601-quality-level-not-allow){.xref}[¶](#section-toc.1-1.6.2.6.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.6.2.3}
            [6.6.3](#section-6.6.3){.xref}.  [603 Session Not
            Allowed](#name-603-session-not-allowed){.xref}[¶](#section-toc.1-1.6.2.6.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.6.2.4}
            [6.6.4](#section-6.6.4){.xref}.  [604 Authorization Not
            Allowed](#name-604-authorization-not-allow){.xref}[¶](#section-toc.1-1.6.2.6.2.4.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Protocol](#name-protocol){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Protocol
        Phases](#name-protocol-phases){.xref}[¶](#section-toc.1-1.7.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [SDP
        Structure](#name-sdp-structure){.xref}[¶](#section-toc.1-1.7.2.2.1){.pilcrow}

        -   ::: {#section-toc.1-1.7.2.2.2.1}
            [7.2.1](#section-7.2.1){.xref}.  [\"qos-level\"
            Attribute](#name-qos-level-attribute){.xref}[¶](#section-toc.1-1.7.2.2.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.2}
            [7.2.2](#section-7.2.2){.xref}.  [\"alerting-mode\"
            Attribute](#name-alerting-mode-attribute){.xref}[¶](#section-toc.1-1.7.2.2.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.3}
            [7.2.3](#section-7.2.3){.xref}.  [\"alert-pause\"
            Attribute](#name-alert-pause-attribute){.xref}[¶](#section-toc.1-1.7.2.2.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.4}
            [7.2.4](#section-7.2.4){.xref}.  [\"recovery-pause\"
            Attribute](#name-recovery-pause-attribute){.xref}[¶](#section-toc.1-1.7.2.2.2.4.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.5}
            [7.2.5](#section-7.2.5){.xref}.  [\"public-address\"
            Attributes](#name-public-address-attributes){.xref}[¶](#section-toc.1-1.7.2.2.2.5.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.6}
            [7.2.6](#section-7.2.6){.xref}.  [\"latency\"
            Attribute](#name-latency-attribute){.xref}[¶](#section-toc.1-1.7.2.2.2.6.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.7}
            [7.2.7](#section-7.2.7){.xref}.  [\"jitter\"
            Attribute](#name-jitter-attribute){.xref}[¶](#section-toc.1-1.7.2.2.2.7.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.8}
            [7.2.8](#section-7.2.8){.xref}.  [\"bandwidth\"
            Attribute](#name-bandwidth-attribute){.xref}[¶](#section-toc.1-1.7.2.2.2.8.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.9}
            [7.2.9](#section-7.2.9){.xref}.  [\"packetloss\"
            Attribute](#name-packetloss-attribute){.xref}[¶](#section-toc.1-1.7.2.2.2.9.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.10}
            [7.2.10](#section-7.2.10){.xref}. [\"flow\"
            Attributes](#name-flow-attributes){.xref}[¶](#section-toc.1-1.7.2.2.2.10.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.11}
            [7.2.11](#section-7.2.11){.xref}. [\"measurement\"
            Attributes](#name-measurement-attributes){.xref}[¶](#section-toc.1-1.7.2.2.2.11.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.12}
            [7.2.12](#section-7.2.12){.xref}. [\"max-content-length\"
            Attribute](#name-max-content-length-attribut){.xref}[¶](#section-toc.1-1.7.2.2.2.12.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.7.2.3}
        [7.3](#section-7.3){.xref}.  [Measurements](#name-measurements){.xref}[¶](#section-toc.1-1.7.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.7.2.3.2.1}
            [7.3.1](#section-7.3.1){.xref}.  [Latency](#name-latency){.xref}[¶](#section-toc.1-1.7.2.3.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.3.2.2}
            [7.3.2](#section-7.3.2){.xref}.  [Jitter](#name-jitter){.xref}[¶](#section-toc.1-1.7.2.3.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.3.2.3}
            [7.3.3](#section-7.3.3){.xref}.  [Bandwidth](#name-bandwidth){.xref}[¶](#section-toc.1-1.7.2.3.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.3.2.4}
            [7.3.4](#section-7.3.4){.xref}.  [Packet
            Loss](#name-packet-loss){.xref}[¶](#section-toc.1-1.7.2.3.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.7.2.4}
        [7.4](#section-7.4){.xref}.  [Handshake
        Phase](#name-handshake-phase){.xref}[¶](#section-toc.1-1.7.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.5}
        [7.5](#section-7.5){.xref}.  [Negotiation
        Phase](#name-negotiation-phase){.xref}[¶](#section-toc.1-1.7.2.5.1){.pilcrow}

        -   ::: {#section-toc.1-1.7.2.5.2.1}
            [7.5.1](#section-7.5.1){.xref}.  [Stage 0: Measurement of
            Latencies and
            Jitter](#name-stage-0-measurement-of-late){.xref}[¶](#section-toc.1-1.7.2.5.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.5.2.2}
            [7.5.2](#section-7.5.2){.xref}.  [Stage 1: Measurement of
            Bandwidth and Packet
            Loss](#name-stage-1-measurement-of-band){.xref}[¶](#section-toc.1-1.7.2.5.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.5.2.3}
            [7.5.3](#section-7.5.3){.xref}.  [Quality Constraints Not
            Reached](#name-quality-constraints-not-rea){.xref}[¶](#section-toc.1-1.7.2.5.2.3.1){.pilcrow}

            -   ::: {#section-toc.1-1.7.2.5.2.3.2.1}
                [7.5.3.1](#section-7.5.3.1){.xref}.  [Actuator
                Role](#name-actuator-role){.xref}[¶](#section-toc.1-1.7.2.5.2.3.2.1.1){.pilcrow}
                :::

            -   ::: {#section-toc.1-1.7.2.5.2.3.2.2}
                [7.5.3.2](#section-7.5.3.2){.xref}.  [Policy Server
                Role](#name-policy-server-role){.xref}[¶](#section-toc.1-1.7.2.5.2.3.2.2.1){.pilcrow}
                :::
            :::

        -   ::: {#section-toc.1-1.7.2.5.2.4}
            [7.5.4](#section-7.5.4){.xref}.  [\"qos-level\"
            Changes](#name-qos-level-changes){.xref}[¶](#section-toc.1-1.7.2.5.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.7.2.6}
        [7.6](#section-7.6){.xref}.  [Continuity
        Phase](#name-continuity-phase){.xref}[¶](#section-toc.1-1.7.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.7}
        [7.7](#section-7.7){.xref}.  [Termination
        Phase](#name-termination-phase){.xref}[¶](#section-toc.1-1.7.2.7.1){.pilcrow}

        -   ::: {#section-toc.1-1.7.2.7.2.1}
            [7.7.1](#section-7.7.1){.xref}.  [Sanity Check of Quality
            Sessions](#name-sanity-check-of-quality-ses){.xref}[¶](#section-toc.1-1.7.2.7.2.1.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.7.2.8}
        [7.8](#section-7.8){.xref}.  [Dynamic Constraints and
        Flows](#name-dynamic-constraints-and-flo){.xref}[¶](#section-toc.1-1.7.2.8.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.9}
        [7.9](#section-7.9){.xref}.  [\"qos-level\" Upgrade and
        Downgrade
        Operation](#name-qos-level-upgrade-and-downg){.xref}[¶](#section-toc.1-1.7.2.9.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [General User Agent
    Behavior](#name-general-user-agent-behavior){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Roles in Peer-to-Peer
        Scenarios](#name-roles-in-peer-to-peer-scena){.xref}[¶](#section-toc.1-1.8.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Multiple Quality Sessions in
        Parallel](#name-multiple-quality-sessions-i){.xref}[¶](#section-toc.1-1.8.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.3}
        [8.3](#section-8.3){.xref}.  [General Client
        Behavior](#name-general-client-behavior){.xref}[¶](#section-toc.1-1.8.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.8.2.3.2.1}
            [8.3.1](#section-8.3.1){.xref}.  [Generating
            Requests](#name-generating-requests){.xref}[¶](#section-toc.1-1.8.2.3.2.1.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.8.2.4}
        [8.4](#section-8.4){.xref}.  [General Server
        Behavior](#name-general-server-behavior){.xref}[¶](#section-toc.1-1.8.2.4.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [Implementation
    Recommendations](#name-implementation-recommendati){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [Default Client
        Constraints](#name-default-client-constraints){.xref}[¶](#section-toc.1-1.9.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [Latency and Jitter
        Measurements](#name-latency-and-jitter-measurem){.xref}[¶](#section-toc.1-1.9.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.3}
        [9.3](#section-9.3){.xref}.  [Bandwidth
        Measurements](#name-bandwidth-measurements){.xref}[¶](#section-toc.1-1.9.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.4}
        [9.4](#section-9.4){.xref}.  [Packet Loss Measurement
        Resolution](#name-packet-loss-measurement-res){.xref}[¶](#section-toc.1-1.9.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.5}
        [9.5](#section-9.5){.xref}.  [Measurements and
        Reactions](#name-measurements-and-reactions){.xref}[¶](#section-toc.1-1.9.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.6}
        [9.6](#section-9.6){.xref}.  [Instability
        Treatments](#name-instability-treatments){.xref}[¶](#section-toc.1-1.9.2.6.1){.pilcrow}

        -   ::: {#section-toc.1-1.9.2.6.2.1}
            [9.6.1](#section-9.6.1){.xref}.  [Loss of Control
            Packets](#name-loss-of-control-packets){.xref}[¶](#section-toc.1-1.9.2.6.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.9.2.6.2.2}
            [9.6.2](#section-9.6.2){.xref}.  [Outlier
            Samples](#name-outlier-samples){.xref}[¶](#section-toc.1-1.9.2.6.2.2.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.9.2.7}
        [9.7](#section-9.7){.xref}.  [Scenarios](#name-scenarios){.xref}[¶](#section-toc.1-1.9.2.7.1){.pilcrow}

        -   ::: {#section-toc.1-1.9.2.7.2.1}
            [9.7.1](#section-9.7.1){.xref}.  [Client to
            ACP](#name-client-to-acp){.xref}[¶](#section-toc.1-1.9.2.7.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.9.2.7.2.2}
            [9.7.2](#section-9.7.2){.xref}.  [Client to
            Client](#name-client-to-client){.xref}[¶](#section-toc.1-1.9.2.7.2.2.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [Confidentiality
        Issues](#name-confidentiality-issues){.xref}[¶](#section-toc.1-1.10.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Integrity of Measurements and
        Authentication](#name-integrity-of-measurements-a){.xref}[¶](#section-toc.1-1.10.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.3}
        [10.3](#section-10.3){.xref}.  [Privacy of
        Measurements](#name-privacy-of-measurements){.xref}[¶](#section-toc.1-1.10.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.4}
        [10.4](#section-10.4){.xref}.  [Availability
        Issues](#name-availability-issues){.xref}[¶](#section-toc.1-1.10.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.5}
        [10.5](#section-10.5){.xref}.  [Bandwidth Occupancy
        Issues](#name-bandwidth-occupancy-issues){.xref}[¶](#section-toc.1-1.10.2.5.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.xref}. [Future Code Point
    Requirements](#name-future-code-point-requireme){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}

    -   ::: {#section-toc.1-1.11.2.1}
        [11.1](#section-11.1){.xref}.  [Service
        Port](#name-service-port){.xref}[¶](#section-toc.1-1.11.2.1.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.12}
    [12](#section-12){.xref}. [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.13}
    [13](#section-13){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}

    -   ::: {#section-toc.1-1.13.2.1}
        [13.1](#section-13.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.13.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.13.2.2}
        [13.2](#section-13.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.13.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.14}
    [](#section-appendix.a){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.14.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.15}
    [](#section-appendix.b){.xref}[Contributors](#name-contributors){.xref}[¶](#section-toc.1-1.15.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.16}
    [](#section-appendix.c){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.16.1){.pilcrow}
    :::
:::
:::

::: {#sec-1}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

The World Wide Web (WWW) is a distributed hypermedia system that has
gained widespread acceptance among Internet users. Although WWW browsers
support other, preexisting Internet application protocols, the primary
protocol used between WWW clients and servers became the HyperText
Transfer Protocol (HTTP) (\[[RFC7230](#RFC7230){.xref}\],
\[[RFC7231](#RFC7231){.xref}\], \[[RFC7232](#RFC7232){.xref}\],
\[[RFC7233](#RFC7233){.xref}\], \[[RFC7234](#RFC7234){.xref}\], and
\[[RFC7235](#RFC7235){.xref}\]). Since then, HTTP over TLS (known as
HTTPS and described in \[[RFC2818](#RFC2818){.xref}\]) has become an
imperative for providing secure and authenticated WWW access. The
mechanisms described in this document are equally applicable to HTTP and
HTTPS.[¶](#section-1-1){.pilcrow}

The ease of use of the Web has prompted its widespread employment as a
client/server architecture for many applications. Many of such
applications require the client and the server to be able to communicate
with each other and exchange information with certain quality
constraints.[¶](#section-1-2){.pilcrow}

Quality in communications at the application level consists of four
measurable parameters:[¶](#section-1-3){.pilcrow}

[]{.break}

Latency:
:   The time a message takes to travel from source to destination. It
    may be approximated as RTT/2 (round-trip time), assuming the
    networks are symmetrical. In this context, we will consider the
    statistical median formula.[¶](#section-1-4.2){.pilcrow}
:   

Jitter:
:   Latency variation. There are some formulas to calculate jitter, and
    in this context, we will consider the arithmetic mean
    formula.[¶](#section-1-4.4){.pilcrow}
:   

Bandwidth:
:   Bit rate of communication. To ensure quality, a protocol must ensure
    the availability of the bandwidth needed by the
    application.[¶](#section-1-4.6){.pilcrow}
:   

Packet loss:
:   The percentage of packet loss is closely related to bandwidth and
    jitter. Packet loss affects bandwidth because a high packet loss
    sometimes implies retransmissions that also consumes extra
    bandwidth, other times the retransmissions are not achieved (for
    example, in video streaming over UDP), and the information received
    is less than the required bandwidth. In terms of jitter, a packet
    loss sometimes is seen by the destination as a larger time between
    arrivals, causing a jitter growth.[¶](#section-1-4.8){.pilcrow}
:   

Any other communication parameter, such as throughput, is not a network
parameter because it depends on protocol window size and other
implementation-dependent aspects.[¶](#section-1-5){.pilcrow}

The Q4S protocol provides a mechanism for quality monitoring based on an
HTTP syntax and the Session Description Protocol (SDP) in order to be
easily integrated in the WWW, but it may be used by any type of
application, not only those based on HTTP. Quality requirements may be
needed by any type of application that communicates using any kind of
protocol, especially those with real-time constraints. Depending on the
nature of each application, the constraints may be different, leading to
different parameter thresholds that need to be
met.[¶](#section-1-6){.pilcrow}

Q4S is an application-level client/server protocol that continuously
measures session quality for a given flow (or set of flows), end-to-end
(e2e) and in real time; raising alerts if quality parameters are below a
given negotiated threshold and sending recoveries when quality
parameters are restored. Q4S describes when these notifications, alerts,
and recoveries need to be sent and the entity receiving them. The
actions undertaken by the receiver of the alert are out of scope of the
protocol.[¶](#section-1-7){.pilcrow}

Q4S is session-independent from the application flows to minimize the
impact on them. To perform the measurements, two control flows are
created on both communication paths (forward and reverse
directions).[¶](#section-1-8){.pilcrow}

This protocol specification is the product of research conducted over a
number of years and is presented here as a permanent record and to offer
a foundation for future similar work. It does not represent a standard
protocol and does not have IETF consensus.[¶](#section-1-9){.pilcrow}

::: {#sec-1.1}
::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Scope](#name-scope){.section-name .selfRef} {#name-scope}

The purpose of Q4S is to measure end-to-end network quality in real
time. Q4S does not transport any application data. This means that Q4S
is designed to be used jointly with other transport protocols such as
Real-time Transport Protocol (RTP) \[[RFC3550](#RFC3550){.xref}\],
Transmission Control Protocol (TCP) \[[RFC0793](#RFC0793){.xref}\], QUIC
\[[QUIC](#I-D.ietf-quic-transport){.xref}\], HTTP
\[[RFC7230](#RFC7230){.xref}\], etc.[¶](#section-1.1-1){.pilcrow}

Some existent transport protocols are focused on real-time media
transport and certain connection metrics are available, which is the
case of RTP and RTP Control Protocol (RTCP)
\[[RFC3550](#RFC3550){.xref}\]. Other protocols such as QUIC provide low
connection latencies as well as advanced congestion control. These
protocols transport data efficiently and provide a lot of
functionalities. However, there are currently no other quality
measurement protocols offering the same level of function as Q4S. See
[Section 1.4](#sec-1.4){.xref} for a discussion of the IETF\'s quality
measurement protocols, One-Way Active Measurement Protocol (OWAMP) and
Two-Way Active Measurement Protocol
(TWAMP).[¶](#section-1.1-2){.pilcrow}

Q4S enables applications to become reactive under e2e network quality
changes. To achieve it, an independent Q4S stack application must run in
parallel with the target application. Then, Q4S metrics may be used to
trigger actions on the target application, such as speed adaptation to
latency in multiuser games, bitrate control at streaming services,
intelligent commutation of delivery node at Content Delivery Networks,
and whatever the target application allows.[¶](#section-1.1-3){.pilcrow}
:::
:::

::: {#sec-1.2}
::: {#section-1.2 .section}
### [1.2.](#section-1.2){.section-number .selfRef} [Motivation](#name-motivation){.section-name .selfRef} {#name-motivation}

Monitoring quality of service (QoS) in computer networks is useful for
several reasons:[¶](#section-1.2-1){.pilcrow}

-   [It enables real-time services and applications to verify whether
    network resources achieve a certain QoS level. This helps real-time
    services and applications to run over the Internet, allowing the
    existence of Application Content Providers (ACPs), which offer
    guaranteed real-time services to the end
    users.[¶](#section-1.2-2.1){.pilcrow}]{#section-1.2-2.1}

-   [Real-time monitoring allows applications to adapt themselves to
    network conditions (application-based QoS) and/or request more
    network quality from the Internet Service Provider (ISP) (if the ISP
    offers this
    possibility).[¶](#section-1.2-2.2){.pilcrow}]{#section-1.2-2.2}

-   [Monitoring may also be required by peer-to-peer (P2P) real-time
    applications for which Q4S can be
    used.[¶](#section-1.2-2.3){.pilcrow}]{#section-1.2-2.3}

-   [Monitoring enables ISPs to offer QoS to any ACP or end user
    application in an accountable
    way.[¶](#section-1.2-2.4){.pilcrow}]{#section-1.2-2.4}

-   ::: {#section-1.2-2.5}
    Monitoring enables e2e negotiation of QoS parameters, independently
    of the ISPs of both endpoints.[¶](#section-1.2-2.5.1){.pilcrow}
    :::

A protocol to monitor QoS must address the following
issues:[¶](#section-1.2-3){.pilcrow}

-   [Must be ready to be used in conjunction with current standard
    protocols and applications, without forcing a change on
    them.[¶](#section-1.2-4.1){.pilcrow}]{#section-1.2-4.1}
-   [Must have a formal and compact way to specify quality constraints
    desired by the application to
    run.[¶](#section-1.2-4.2){.pilcrow}]{#section-1.2-4.2}
-   [Must have measurement mechanisms that avoid application disruption
    and minimize network resources
    consumption.[¶](#section-1.2-4.3){.pilcrow}]{#section-1.2-4.3}
-   [Must have specific messages to alert about the violation of quality
    constraints in different directions (forward and reverse) because
    network routing may not be symmetrical, and of course, quality
    constraints may not be
    symmetrical.[¶](#section-1.2-4.4){.pilcrow}]{#section-1.2-4.4}
-   [After having alerted about the violation of quality constraints,
    must have specific messages to inform about the recovery of quality
    constraints in corresponding directions (forward and
    reverse).[¶](#section-1.2-4.5){.pilcrow}]{#section-1.2-4.5}
-   [Must protect the data (constraints, measurements, QoS levels
    demanded from the network) in order to avoid the injection of
    malicious data in the
    measurements.[¶](#section-1.2-4.6){.pilcrow}]{#section-1.2-4.6}
:::
:::

::: {#sec-1.3}
::: {#section-1.3 .section}
### [1.3.](#section-1.3){.section-number .selfRef} [Summary of Features](#name-summary-of-features){.section-name .selfRef} {#name-summary-of-features}

The Quality for Service (Q4S) protocol is a message-oriented
communication protocol that can be used in conjunction with any other
application-level protocol. Q4S is a measurement protocol. Any action
taken derived from its measurements are out of scope of the protocol.
These actions depend on the application provider and may be
application-level adaptive reactions, may involve requests to the ISP,
or whatever the application provider
decides.[¶](#section-1.3-1){.pilcrow}

The benefits in quality measurements provided by Q4S can be used by any
type of application that uses any type of protocol for data transport.
It provides a quality monitoring scheme for any communication that takes
place between the client and the server, not only for the Q4S
communication itself.[¶](#section-1.3-2){.pilcrow}

Q4S does not establish multimedia sessions, and it does not transport
application data. It monitors the fulfillment of the quality
requirements of the communication between the client and the server;
therefore, it does not impose any restrictions on the type of
application, protocol, or usage of the monitored quality
connection.[¶](#section-1.3-3){.pilcrow}

Some applications may vary their quality requirements dynamically for
any given quality parameter. Q4S is able to adapt to the changing
application needs, modifying the parameter thresholds to the new values
and monitoring the network quality according to the new quality
constraints. It will raise alerts if the new constraints are
violated.[¶](#section-1.3-4){.pilcrow}

The Q4S session lifetime is composed of four phases with different
purposes: Handshake, Negotiation, Continuity, and Termination.
Negotiation and Continuity phases perform network parameter measurements
per a negotiated measurement procedure. Different measurement procedures
could be used inside Q4S, although one default measurement mechanism is
needed for compatibility reasons and is the one defined in this
document. Basically, Q4S defines how to transport application quality
requirements and measurement results between a client and server and how
to provide monitoring and alerting, too.[¶](#section-1.3-5){.pilcrow}

Q4S must be executed just before starting a client-server application
that needs a quality connection in terms of latency, jitter, bandwidth,
and/or packet loss. Once the client and server have succeeded in
establishing communication under quality constraints, the application
can start, and Q4S continues measuring and alerting if
necessary.[¶](#section-1.3-6){.pilcrow}

The quality parameters can be suggested by the client in the first
message of the Handshake phase, but it is the server that accepts these
parameter values or forces others. The server is in charge of deciding
the final values of quality connection.[¶](#section-1.3-7){.pilcrow}
:::
:::

::: {#sec-1.4}
::: {#section-1.4 .section}
### [1.4.](#section-1.4){.section-number .selfRef} [Differences from OWAMP/TWAMP](#name-differences-from-owamp-twam){.section-name .selfRef} {#name-differences-from-owamp-twam}

OWAMP \[[RFC4656](#RFC4656){.xref}\] and TWAMP
\[[RFC5357](#RFC5357){.xref}\] are two protocols to measure network
quality in terms of RTT, but they have a different goal than Q4S. The
main difference is the scope: Q4S is designed to assist reactive
applications, whereas OWAMP/TWAMP is designed to measure just network
delay.[¶](#section-1.4-1){.pilcrow}

The differences can be summarized in the following
points:[¶](#section-1.4-2){.pilcrow}

-   [OWAMP and TWAMP are not intended for measuring availability of
    resources (certain bandwidth availability, for example) but only
    RTT. However, Q4S is intended for measuring required bandwidth,
    packet loss, jitter, and latency in both directions. Available
    bandwidth is not measured by Q4S, but bandwidth required for a
    specific application
    is.[¶](#section-1.4-3.1){.pilcrow}]{#section-1.4-3.1}
-   [OWAMP and TWAMP do not have responsivity control (which defines the
    speed of protocol reactions under network quality changes) because
    these protocols are designed to measure network performance, not to
    assist reactive applications, and do not detect the fluctuations of
    quality within certain time intervals to take reactive actions.
    However, responsivity control is a key feature of
    Q4S.[¶](#section-1.4-3.2){.pilcrow}]{#section-1.4-3.2}
-   [OWAMP and TWAMP are not intended to run in parallel with reactive
    applications, but the Q4S protocol\'s goal is to run in parallel and
    assist reactive applications in making decisions based on Q4S-ALERT
    packets, which may trigger
    actions.[¶](#section-1.4-3.3){.pilcrow}]{#section-1.4-3.3}
:::
:::
:::
:::

::: {#sec-2}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::
:::

::: {#sec-3}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Overview of Operation](#name-overview-of-operation){.section-name .selfRef} {#name-overview-of-operation}

This section introduces the basic operation of Q4S using simple
examples. This section is of a tutorial nature and does not contain any
normative statements.[¶](#section-3-1){.pilcrow}

The first example shows the basic functions of Q4S: communication
establishment between a client and a server, quality requirement
negotiations for the requested application, application start and
continuous quality parameter measurements, and finally communication
termination.[¶](#section-3-2){.pilcrow}

The client triggers the establishment of the communication by requesting
a specific service or application from the server. This first message
must have a special URI \[[RFC3986](#RFC3986){.xref}\], which may force
the use of the Q4S protocol if it is implemented in a standard web
browser. This message consists of a Q4S BEGIN method, which can
optionally include a proposal for the communication quality requirements
in an SDP body. This option gives the client a certain negotiation
capacity about quality requirements, but it will be the server who
finally decides the stated requirements.[¶](#section-3-3){.pilcrow}

This request is answered by the server with a Q4S 200 OK response
letting the client know that it accepts the request. This response
message must contain an SDP body with the
following:[¶](#section-3-4){.pilcrow}

-   [The assigned Q4S
    sess-id.[¶](#section-3-5.1){.pilcrow}]{#section-3-5.1}

-   [The quality constraints required by the requested
    application.[¶](#section-3-5.2){.pilcrow}]{#section-3-5.2}

-   [The measurement procedure to
    use.[¶](#section-3-5.3){.pilcrow}]{#section-3-5.3}

-   ::: {#section-3-5.4}
    \"alerting-mode\" attribute: There are two different scenarios for
    sending alerts that trigger actions either on the network or in the
    application when measurements identify violated quality constraints.
    In both cases, alerts are triggered by the
    server.[¶](#section-3-5.4.1){.pilcrow}

    []{.break}

    \(a\)

    :   Q4S-aware-network scenario: The network is Q4S aware and reacts
        by itself to these alerts. In this scenario, Q4S-ALERT messages
        are sent by the server to the client, and network elements
        inspect and process these alert messages. The alerting mode in
        this scenario is called Q4S-aware-network alerting
        mode.[¶](#section-3-5.4.2.1.1){.pilcrow}

    :   

    \(b\)

    :   Reactive scenario: As shown in [Figure
        1](#ref-reactive-scenario){.xref}, the network is not Q4S aware.
        In this scenario, alert notifications are sent to a specific
        node, called an Actuator, which is in charge of making decisions
        regarding what actions to trigger: either to change application
        behavior to adapt it to network conditions and/or invoke a
        network policy server in order to reconfigure the network and
        request better quality for application
        flows.[¶](#section-3-5.4.2.2.1){.pilcrow}

        []{#name-reactive-scenario}

        ::: {#ref-reactive-scenario}
        ::: {#section-3-5.4.2.2.2.1 .artwork .art-text .alignLeft}
                     +------+                           +-----------+
                     |  App |<----- app flows---------->|Application|
                     |Client|                           +-----------+
                     +------+                                 A
                                                              |
                     +------+             +------+       +--------+
                     | Q4S  |<----Q4S---->| Q4S  |<----->|Actuator|
                     |Client|             |Server|       +--------+
                     +------+             +------+            |
                                                              V
                                                       +-------------+
                                                       |policy server|
                                                       +-------------+
        :::

        [Figure 1](#figure-1){.selfRef}: [Reactive
        Scenario](#name-reactive-scenario){.selfRef}
        :::

        The format of messages exchanged between the server stack and
        the Actuator doesn\'t follow Q4S codification rules; their
        format will be implementation dependent. In this way, we will
        call the messages sent from the server stack to the Actuator
        \"notifications\" (e.g., alert notifications) and the messages
        sent from the Actuator to the server stack in response to
        notifications \"acknowledges\" (e.g., alert
        acknowledges).[¶](#section-3-5.4.2.2.3){.pilcrow}

    :   
    :::

```{=html}
<!-- -->
```
-   [\"alert-pause\" attribute: The amount of time between consecutive
    alerts. In the Q4S-aware-network scenario, the server has to wait
    this period of time between Q4S-ALERT messages sent to the client.
    In the Reactive scenario, the server stack has to wait this period
    of time between alert notifications sent to the Actuator.
    Measurements are not stopped in Negotiation or Continuity phases
    during this period of time, but no alerts are sent, even with
    violated network quality constraints, in order to leave time for
    network reconfiguration or for application
    adjustments.[¶](#section-3-6.1){.pilcrow}]{#section-3-6.1}
-   [\"recovery-pause\" attribute: The amount of time the Q4S server
    waits before trying to recover the initial \"qos-level\" ([Section
    7.2.1](#sec-7.2.1){.xref}). After having detected violation of
    quality constraints several times, the \"qos-level\" will have been
    increased accordingly. If this violation detection finally stops,
    the server waits for a period of time (recovery time), and if the
    situation persists, it tries to recover to previous \"qos-level\"
    values gradually by sending Q4S-RECOVERY messages to the client in
    the Q4S-aware-network scenario, or recovery notifications to the
    Actuator in the Reactive scenario ([Section
    7.9](#sec-7.9){.xref}).[¶](#section-3-6.2){.pilcrow}]{#section-3-6.2}

It is important to highlight that any Q4S 200 OK response sent by the
server to the client at any time during the life of a quality session
may contain an SDP body with new values of quality constraints required
by the application. Depending on the phase and the state of the
measurement procedure within the specific phase, the client will react
accordingly to take into account the new quality constraints in the
measurement procedure.[¶](#section-3-7){.pilcrow}

Once the communication has been established (i.e., the Handshake phase
is finished), the protocol will verify that the communication path
between the client and the server meets the quality constraints in both
directions, from and to the server (Negotiation phase). This Negotiation
phase requires taking measurements of the quality parameters: latencies,
jitter, bandwidth, and packet loss. This phase is initiated with a
client message containing a Q4S READY method, which will be answered by
the server with a Q4S 200 OK response.[¶](#section-3-8){.pilcrow}

Negotiation measurements are achieved in two sequential
stages:[¶](#section-3-9){.pilcrow}

[]{.break}

Stage 0:
:   latency and jitter measurements[¶](#section-3-10.2){.pilcrow}
:   

Stage 1:
:   bandwidth and packet loss measurements[¶](#section-3-10.4){.pilcrow}
:   

Stage 0 measurements are taken through Q4S PING messages sent from both
the client and the server. All Q4S PING requests will be answered by Q4S
200 OK messages to allow for bidirectional
measurements.[¶](#section-3-11){.pilcrow}

Different client and server implementations may send a different number
of PING messages for measuring, although at least 255 messages should be
considered to perform the latency measurement. The Stage 0 measurements
only may be considered ended when neither client nor server receive new
PING messages after an implementation-dependent guard time. Only after
Stage 0 has ended, can the client send a \"READY 1\"
message.[¶](#section-3-12){.pilcrow}

After a pre-agreed number of measurements have been performed,
determined by the measurement procedure sent by the server, three
scenarios may be possible:[¶](#section-3-13){.pilcrow}

[]{.break}

\(a\)
:   Measurements do not meet the requirements: in this case, the stage 0
    is repeated after sending an alert from the server to the client or
    from the server stack to the Actuator, depending on the alerting
    mode defined in the Handshake phase. Notice that measurements
    continue to be taken but no alerts are sent during the
    \"alert-pause\" time. In the Reactive scenario, the Actuator will
    decide either to forward the alert notification to the network
    policy server or to the application, depending on where
    reconfiguration actions have to be
    taken.[¶](#section-3-14.1){.pilcrow}
:   

\(b\)
:   Measurements do meet the requirements: in this case, client moves to
    stage 1 by sending a new READY
    message.[¶](#section-3-14.2){.pilcrow}
:   

\(c\)
:   At any time during the measurement procedure, the Q4S 200 OK message
    sent by the server to the client, in response to a Q4S PING message,
    contains an SDP body with new values of quality constraints required
    by the application. This means the application has varied their
    quality requirements dynamically; therefore, quality thresholds used
    while monitoring quality parameters have to be changed to the new
    constraints. In this case, the client moves to the beginning of
    Stage 0 for initiating the negotiation measurements
    again.[¶](#section-3-14.3){.pilcrow}
:   

Stage 1 is optional. Its purpose is to measure the availability of
application-needed bandwidth. If the \"bandwidth\" attribute is set to
zero kbps in the SDP, the client can skip stage 1 by sending a \"READY
2\" message after completion of stage 0. Stage 1 measurements are
achieved through Q4S BWIDTH messages sent from both the client and the
server. Unlike PING messages, Q4S BWIDTH requests will not be
answered.[¶](#section-3-15){.pilcrow}

If Stage 0 and 1 meet the application quality constraints, the
application may start. Q4S will enter the Continuity phase by measuring
the network quality parameters through the Q4S PING message exchange on
both connection paths and raising alerts in case of
violation.[¶](#section-3-16){.pilcrow}

Once the client wants to terminate the quality session, it sends a Q4S
CANCEL message, which will be acknowledged by the server with another
Q4S CANCEL message. Termination of quality sessions are always initiated
by the client because Q4S TCP requests follow the client/server
schema.[¶](#section-3-17){.pilcrow}

[Figure 2](#ref-successful-q4s-message-exchange){.xref} depicts the
message exchange in a successful scenario.[¶](#section-3-18){.pilcrow}

[]{#name-successful-q4s-message-exch}

::: {#ref-successful-q4s-message-exchange}
::: {#section-3-19.1 .artwork .art-text .alignLeft}
                +-------------------------------------------+
                |                                           |
                | Client                             Server |
                |                                           |
    Handshake   |     --------- Q4S BEGIN ----------->      |
                |     <-------- Q4S 200 OK -----------      |
                |                                           |
    Negotiation |                                           |
    (Stage 0)   |     --------- Q4S READY 0---------->      |
                |     <-------- Q4S 200 OK -----------      |
                |                                           |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S 200 OK -----------      |
                |     <-------- Q4S PING -------------      |
                |      -------- Q4S 200 OK ---------->      |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S PING -------------      |
                |     --------- Q4S 200 OK ---------->      |
                |     <-------- Q4S 200 OK -----------      |
                |                    ...                    |
    Negotiation |                                           |
    (Stage 1)   |     --------- Q4S READY 1---------->      |
                |     <-------- Q4S 200 OK -----------      |
                |                                           |
                |     --------- Q4S BWITDH ---------->      |
                |     <-------- Q4S BWIDTH------------      |
                |     --------- Q4S BWITDH ---------->      |
                |     <-------- Q4S BWIDTH------------      |
                |                    ...                    |
    Continuity  |     --------- Q4S READY 2 --------->      |
                |     <-------- Q4S 200 OK -----------      | app start
                |                                           |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S 200 OK -----------      |
                |     <-------- Q4S PING -------------      |
                |      -------- Q4S 200 OK ---------->      |
                |                                           |
    Termination |     --------- Q4S CANCEL ---------->      | app end
                |     <-------- Q4S CANCEL -----------      |
                |                                           |
                +-------------------------------------------+
:::

[Figure 2](#figure-2){.selfRef}: [Successful Q4S Message
Exchange](#name-successful-q4s-message-exch){.selfRef}
:::

Both client and server measurements are included in the PING and BWIDTH
messages, allowing both sides of the communication channel to be aware
of all measurements in both directions.[¶](#section-3-20){.pilcrow}

The following two examples show the behavior of the Q4S protocol when
quality constraints are violated, and alerts are generated; and, later
on, when the violation of quality constraints stops leading to the
execution of the recovery process. The first example ([Figure
3](#ref-q4s-aware-network-alerting-mode){.xref}) shows the
Q4S-aware-network alerting mode scenario:[¶](#section-3-21){.pilcrow}

[]{#name-q4s-aware-network-alerting-}

::: {#ref-q4s-aware-network-alerting-mode}
::: {#section-3-22.1 .artwork .art-text .alignLeft}
                +-------------------------------------------+
                |                                           |
                | Client                             Server |
                |                                           |
    Handshake   |     --------- Q4S BEGIN ----------->      |
                |     <-------- Q4S 200 OK -----------      |
                |                                           |
    Negotiation |                                           |
    (Stage 0)   |     --------- Q4S READY 0---------->      |
                |     <-------- Q4S 200 OK -----------      |
                |                                           |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S 200 OK -----------      |
                |     <-------- Q4S PING -------------      |
                |      -------- Q4S 200 OK ---------->      |
                |                    ...                    |
                |                                           |
                |     <-------- Q4S-ALERT ------------      |
                |     -------- Q4S-ALERT ------------>      |
                |          (alert-pause start)              |
    Repetition  |                                           |
    of Stage 0  |     --------- Q4S READY 0---------->      |
                |     <-------- Q4S 200 OK -----------      |
                |                                           |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S 200 OK -----------      |
                |     <-------- Q4S PING -------------      |
                |                    ...                    |
    Negotiation |                                           |
    (Stage 1)   |     --------- Q4S READY 1---------->      |
                |     <-------- Q4S 200 OK -----------      |
                |                                           |
                |     --------- Q4S BWITDH ---------->      |
                |     <-------- Q4S BWIDTH------------      |
                |                    ...                    |
                |                                           |
    Continuity  |     --------- Q4S READY 2 --------->      |
                |     <-------- Q4S 200 OK -----------      | app start
                |                                           |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S 200 OK -----------      |
                |     <-------- Q4S PING -------------      |
                |      -------- Q4S 200 OK ---------->      |
                |                    ...                    |
                |(alert-pause expires &                     |
                |                   violated constraints)   |
                |     <-------- Q4S-ALERT ------------      |
                |     --------- Q4S-ALERT ----------->      |
                |                                           |
                |           (alert-pause start)             |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S 200 OK -----------      |
                |     <-------- Q4S PING -------------      |
                |     --------- Q4S 200 OK ---------->      |
                |                    ...                    |
                |(alert-pause expires &                     |
                |                   violated constraints)   |
                |     <-------- Q4S-ALERT ------------      |
                |     --------- Q4S-ALERT ----------->      |
                |           (alert-pause)                   |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S 200 OK -----------      |
                |     <-------- Q4S PING -------------      |
                |      -------- Q4S 200 OK ---------->      |
                |                    ...                    |
                |(alert-pause expires &                     |
                |                 Fulfilled constraints)    |
                |                                           |
                |           (recovery-pause start)          |
                |                                           |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S 200 OK -----------      |
                |     <-------- Q4S PING -------------      |
                |      -------- Q4S 200 OK ---------->      |
                |                    ...                    |
                |(recovery-pause expires &                  |
                |                 Fulfilled constraints)    |
                |     <--------- Q4S-RECOVERY ---------     |
                |     -------- Q4S-RECOVERY ----------->    |
                |                                           |
                |          (recovery-pause start)           |
                |     --------- Q4S PING ------------>      |
                |     <-------- Q4S 200 OK -----------      |
                |     <-------- Q4S PING -------------      |
                |      -------- Q4S 200 OK ---------->      |
                |                    ...                    |
                |                                           |
    Termination |     --------- Q4S CANCEL ---------->      | app end
                |     <-------- Q4S CANCEL -----------      |
                |                                           |
                +-------------------------------------------+
:::

[Figure 3](#figure-3){.selfRef}: [Q4S-Aware-Network Alerting
Mode](#name-q4s-aware-network-alerting-){.selfRef}
:::

In this Q4S-aware-network alerting mode scenario, the server may send
Q4S alerts to the client at any time upon detection of violated quality
constraints. This alerting exchange must not interrupt the continuity
quality parameter measurements between client and
server.[¶](#section-3-23){.pilcrow}

The second example depicted in [Figure
4](#ref-reactive-alerting-mode){.xref} represents the Reactive scenario,
in which alert notifications are sent from the server stack to the
Actuator, which is in charge of deciding to act over application
behavior and/or to invoke a network policy server. The Actuator is an
entity that has a defined set of different quality levels and decides
how to act depending on the actions stated for each of these levels; it
can take actions for making adjustments on the application, or it can
send a request to the policy server for acting on the network. The
policy server also has a defined set of different quality levels
previously agreed upon between the Application Content Provider and the
ISP. The Reactive alerting mode is the default
mode.[¶](#section-3-24){.pilcrow}

[]{#name-reactive-alerting-mode}

::: {#ref-reactive-alerting-mode}
::: {#section-3-25.1 .artwork .art-text .alignLeft}
                +-------------------------------------------+
                |                                           |
                | Client               Server      Actuator |
    Handshake   |   ----- Q4S BEGIN ----->                  |
                |   <---- Q4S 200 OK -----                  |
                |                                           |
    Negotiation |                                           |
    (Stage 0)   |   ----- Q4S READY 0---->                  |
                |   <---- Q4S 200 OK -----                  |
                |                                           |
                |   ----- Q4S PING ------>                  |
                |   <---- Q4S 200 OK -----                  |
                |   <---- Q4S PING -------                  |
                |    ---- Q4S 200 OK ---->                  |
                |              ...                          |
                |  (alert-pause start)                      |
                |                          --alert          |
                |                         notification-->   |
                |                                           |
                |                         <--alert          |
                |                          acknowledge---   |
                |                                           |
    Repetition  |                                           |
    of Stage 0  |   ----- Q4S READY 0---->                  |
                |   <---- Q4S 200 OK -----                  |
                |                                           |
                |   ----- Q4S PING ------>                  |
                |   <---- Q4S 200 OK -----                  |
                |   <---- Q4S PING -------                  |
                |              ...                          |
                |(alert-pause expires &                     |
                |                   violated constraints)   |
                |                                           |
                |                         --alert           |
                |                         notification-->   |
                |                                           |
                |                         <--alert          |
                |                          acknowledge---   |
                |                                           |
                |   ----- Q4S PING ------>                  |
                |   <---- Q4S 200 OK -----                  |
                |   <---- Q4S PING -------                  |
                |              ...                          |
    Negotiation |                                           |
    (Stage 1)   |   ----- Q4S READY 1---->                  |
                |   <---- Q4S 200 OK -----                  |
                |                                           |
                |   ----- Q4S BWITDH ---->                  |
                |   <---- Q4S BWIDTH------                  |
                |              ...                          |
    Continuity  |   ----- Q4S READY 2 --->                  |
                |   <---- Q4S 200 OK -----                  | app start
                |                                           |
                |(alert-pause expires &                     |
                |                  fulfilled constraints)   |
                |                                           |
                |(recovery-pause start)                     |
                |   ----- Q4S PING ------>                  |
                |   <---- Q4S 200 OK -----                  |
                |   <---- Q4S PING -------                  |
                |   ----- Q4S PING ------>                  |
                |                                           |
                |(recovery-pause expires &                  |
                |                  fulfilled constraints)   |
                |                                           |
                |                         --recovery        |
                |                         notification-->   |
                |                                           |
                |                         <--recovery       |
                |                          acknowledge---   |
                |                                           |
                |(recovery-pause start)                     |
                |   <---- Q4S 200 OK -----                  |
                |   <---- Q4S PING -------                  |
                |   ----- Q4S 200 OK ---->                  |
                |   ----- Q4S PING ------>                  |
                |              ...                          |
                |                                           |
    Termination |   ----- Q4S CANCEL ---->                  | app end
                |                          --cancel         |
                |                          notification-->  |
                |                                           |
                |                          <--cancel        |
                |                           acknowledge--   |
                |   <---- Q4S CANCEL -----                  |
                |                                           |
                +-------------------------------------------+
:::

[Figure 4](#figure-4){.selfRef}: [Reactive Alerting
Mode](#name-reactive-alerting-mode){.selfRef}
:::

At the end of any stage of the Negotiation phase, the server sends an
alert notification to the Actuator if quality constraints are violated.
During the period of time defined by the \"alert-pause\" attribute, no
further alert notifications are sent, but measurements are not
interrupted. This way, both the client and the server will detect
network improvements as soon as possible. In a similar way during the
Continuity phase, the server may send alert notifications at any time to
the Actuator upon detection of violated quality constraints. This
alerting exchange must not interrupt the continuity measurements between
client and server.[¶](#section-3-26){.pilcrow}

Finally, in the Termination phase, Q4S CANCEL messages sent from the
client to the server must be forwarded from the server to the Actuator
in order to release possible assigned resources for the
session.[¶](#section-3-27){.pilcrow}
:::
:::

::: {#sec-4}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Q4S Messages](#name-q4s-messages){.section-name .selfRef} {#name-q4s-messages}

Q4S is a text-based protocol and uses the UTF-8 charset
\[[RFC3629](#RFC3629){.xref}\]. A Q4S message is either a request or a
response.[¶](#section-4-1){.pilcrow}

Both request and response messages use the basic format of Internet
Message Format \[[RFC5322](#RFC5322){.xref}\]. Both types of messages
consist of a start-line, one or more header fields, an empty line
indicating the end of the header fields, and an optional message-body.
This document uses ABNF notation \[[RFC5234](#RFC5234){.xref}\] for the
definitions of the syntax of messages.[¶](#section-4-2){.pilcrow}

The start-line, each message-header line, and the empty line
[MUST]{.bcp14} be terminated by a carriage-return line-feed sequence
(CRLF). Note that the empty line [MUST]{.bcp14} be present even if the
message-body is not.[¶](#section-4-3){.pilcrow}

::: {#section-4-4}
``` {.sourcecode .lang-abnf}
      generic-message  =  start-line CRLF
                          *message-header CRLF
                          CRLF
                          [ message-body ]
      start-line       =  Request-Line / Status-Line
```

[¶](#section-4-4){.pilcrow}
:::

Much of Q4S\'s messages and header field syntax are identical to
HTTP/1.1. However, Q4S is not an extension of
HTTP.[¶](#section-4-5){.pilcrow}

::: {#sec-4.1}
::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [Requests](#name-requests){.section-name .selfRef} {#name-requests}

Q4S requests are distinguished by having a Request-Line for a
start-line. A Request-Line contains a method name, a Request-URI, and
the protocol version separated by a single space (SP)
character.[¶](#section-4.1-1){.pilcrow}

The Request-Line ends with CRLF. No CR or LF are allowed except in the
end-of-line CRLF sequence. No linear whitespace (LWSP) is allowed in any
of the elements.[¶](#section-4.1-2){.pilcrow}

::: {#section-4.1-3}
``` {.sourcecode .lang-abnf}
   Request-Line  =  Method SP Request-URI SP Q4S-Version CRLF
```

[¶](#section-4.1-3){.pilcrow}
:::

[]{.break}

Method:
:   This specification defines seven methods: BEGIN for starting and
    negotiating quality sessions, READY for synchronization of
    measurements, PING and BWIDTH for quality measurements purposes,
    CANCEL for terminating sessions, Q4S-ALERT for reporting quality
    violations, and Q4S-RECOVERY for reporting quality
    recovery.[¶](#section-4.1-4.2){.pilcrow}
:   

Request-URI:
:   The Request-URI is a Q4S URI \[[RFC3986](#RFC3986){.xref}\] as
    described in [Section 7.4](#sec-7.4){.xref}. The Request-URI [MUST
    NOT]{.bcp14} contain unescaped spaces or control characters and
    [MUST NOT]{.bcp14} be enclosed in
    \"\<\>\".[¶](#section-4.1-4.4){.pilcrow}
:   

Q4S-Version:
:   Both request and response messages include the version of Q4S in
    use. To be compliant with this specification, applications sending
    Q4S messages [MUST]{.bcp14} include a Q4S-Version of \"Q4S/1.0\".
    The Q4S-Version string is case insensitive, but implementations
    [MUST]{.bcp14} send uppercase. Unlike HTTP/1.1, Q4S treats the
    version number as a literal string. In practice, this should make no
    difference.[¶](#section-4.1-4.6){.pilcrow}
:   
:::
:::

::: {#sec-4.2}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [Responses](#name-responses){.section-name .selfRef} {#name-responses}

Q4S responses are distinguished from requests by having a Status-Line as
their start-line. A Status-Line consists of the protocol version
followed by a numeric Status-Code and its associated textual phrase,
with each element separated by a single SP character. No CR or LF is
allowed except in the final CRLF sequence.[¶](#section-4.2-1){.pilcrow}

::: {#section-4.2-2}
``` {.sourcecode .lang-abnf}
   Status-Line  =  Q4S-Version SP Status-Code SP Reason-Phrase CRLF
```

[¶](#section-4.2-2){.pilcrow}
:::

The Status-Code is a 3-digit integer result code that indicates the
outcome of an attempt to understand and satisfy a request. The
Reason-Phrase is intended to give a short textual description of the
Status-Code. The Status-Code is intended for use by automata, whereas
the Reason-Phrase is intended for the human user. A client is not
required to examine or display the
Reason-Phrase.[¶](#section-4.2-3){.pilcrow}

While this specification suggests specific wording for the
Reason-Phrase, implementations [MAY]{.bcp14} choose other text, for
example, in the language indicated in the Accept-Language header field
of the request.[¶](#section-4.2-4){.pilcrow}

The first digit of the Status-Code defines the class of response. The
last two digits do not have any categorization role. For this reason,
any response with a status code between 100 and 199 is referred to as a
\"1xx response\", any response with a status code between 200 and 299 as
a \"2xx response\", and so on. Q4S/1.0 allows following values for the
first digit:[¶](#section-4.2-5){.pilcrow}

[]{.break}

1xx:
:   Provisional \-- request received, continuing to process the
    request;[¶](#section-4.2-6.2){.pilcrow}
:   

2xx:
:   Success \-- the action was successfully received, understood, and
    accepted;[¶](#section-4.2-6.4){.pilcrow}
:   

3xx:
:   Redirection \-- further action needs to be taken in order to
    complete the request;[¶](#section-4.2-6.6){.pilcrow}
:   

4xx:
:   Request Failure \-- the request contains bad syntax or cannot be
    fulfilled at this server;[¶](#section-4.2-6.8){.pilcrow}
:   

5xx:
:   Server Error \-- the server failed to fulfill an apparently valid
    request;[¶](#section-4.2-6.10){.pilcrow}
:   

6xx:
:   Global Failure \-- the request cannot be fulfilled at any
    server.[¶](#section-4.2-6.12){.pilcrow}
:   

The status codes are the same as described in HTTP
\[[RFC7231](#RFC7231){.xref}\]. In the same way as HTTP, Q4S
applications are not required to understand the meaning of all
registered status codes, though such understanding is obviously
desirable. However, applications [MUST]{.bcp14} understand the class of
any status code, as indicated by the first digit, and treat any
unrecognized response as being equivalent to the x00 status code of that
class.[¶](#section-4.2-7){.pilcrow}

The Q4S-ALERT, Q4S-RECOVERY, and CANCEL requests do not have to be
responded to. However, after receiving a Q4S-ALERT, Q4S-RECOVERY, or
CANCEL request, the server [SHOULD]{.bcp14} send a Q4S-ALERT,
Q4S-RECOVERY, or CANCEL request to the
client.[¶](#section-4.2-8){.pilcrow}
:::
:::

::: {#sec-4.3}
::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [Header Fields](#name-header-fields){.section-name .selfRef} {#name-header-fields}

Q4S header fields are identical to HTTP header fields in both syntax and
semantics.[¶](#section-4.3-1){.pilcrow}

Some header fields only make sense in requests or responses. These are
called request header fields and response header fields, respectively.
If a header field appears in a message that does not match its category
(such as a request header field in a response), it [MUST]{.bcp14} be
ignored.[¶](#section-4.3-2){.pilcrow}

::: {#sec-4.3.1}
::: {#section-4.3.1 .section}
#### [4.3.1.](#section-4.3.1){.section-number .selfRef} [Common Q4S Header Fields](#name-common-q4s-header-fields){.section-name .selfRef} {#name-common-q4s-header-fields}

These fields may appear in request and response
messages.[¶](#section-4.3.1-1){.pilcrow}

[]{.break}

Session-Id:
:   the value for this header field is the same sess-id used in SDP
    (embedded in the SDP \"o=\" line) and is assigned by the server. The
    messages without SDP [MUST]{.bcp14} include this header field. If a
    message has an SDP body, this header field is optional. The method
    of sess-id allocation is up to the creating tool, but it is
    suggested that a UTC timestamp be used to ensure
    uniqueness.[¶](#section-4.3.1-2.2){.pilcrow}
:   

Sequence-Number:
:   sequential and cyclic positive integer number assigned to PING and
    BWIDTH messages and acknowledged in 200 OK
    responses.[¶](#section-4.3.1-2.4){.pilcrow}
:   

Timestamp:
:   this optional header field contains the system time (with the best
    possible accuracy). It indicates the time in which the PING request
    was sent. If this header field is present in PING messages, then the
    200 OK response messages [MUST]{.bcp14} include this
    value.[¶](#section-4.3.1-2.6){.pilcrow}
:   

Stage:
:   this is used in the client\'s READY requests and the server\'s 200
    OK responses during the Negotiation and Continuity phases in order
    to synchronize the initiation of the measurements. Example: Stage:
    0[¶](#section-4.3.1-2.8){.pilcrow}
:   
:::
:::

::: {#sec-4.3.2}
::: {#section-4.3.2 .section}
#### [4.3.2.](#section-4.3.2){.section-number .selfRef} [Specific Q4S Request Header Fields](#name-specific-q4s-request-header){.section-name .selfRef} {#name-specific-q4s-request-header}

In addition to HTTP header fields, these are the specific Q4S request
header fields:[¶](#section-4.3.2-1){.pilcrow}

[]{.break}

User-Agent:
:   this header field contains information about the implementation of
    the user agent. This is for statistical purposes, the tracing of
    protocol violations, and the automated recognition of user agents
    for the sake of tailoring responses to avoid particular user agent
    limitations. User agents [SHOULD]{.bcp14} include this field with
    requests. The field [MAY]{.bcp14} contain multiple product tokens
    and comments identifying the agent and any sub-products that form a
    significant part of the user agent. By convention, the product
    tokens are listed in order of their significance for identifying the
    application.[¶](#section-4.3.2-2.2){.pilcrow}
:   

Signature:

:   this header field contains a digital signature that can be used by
    the network, Actuator, or policy server to validate the SDP,
    preventing security attacks. The Signature is an optional header
    field generated by the server according to the pre-agreed security
    policies between the Application Content Provider and the ISP. For
    example, a hash algorithm and encryption method such as SHA256
    \[[RFC6234](#RFC6234){.xref}\] and RSA
    \[[RFC8017](#RFC8017){.xref}\] based on the server certificate could
    be used. This certificate is supposed to be delivered by a
    Certification Authority (CA) or policy owner to the server. The
    signature is applied to the SDP
    body.[¶](#section-4.3.2-2.4.1){.pilcrow}

    ::: {#section-4.3.2-2.4.2}
    ``` {.sourcecode .lang-abnf}
          Signature= RSA ( SHA256 (<sdp>), <certificate> )
    ```

    [¶](#section-4.3.2-2.4.2){.pilcrow}
    :::

    If the Signature header field is not present, other validation
    mechanisms [MAY]{.bcp14} be implemented in order to provide assured
    quality with security and
    control.[¶](#section-4.3.2-2.4.3){.pilcrow}

:   

Measurements:

:   this header field carries the measurements of the quality parameters
    in PING and BWIDTH requests. The format
    is:[¶](#section-4.3.2-2.6.1){.pilcrow}

    ::: {#section-4.3.2-2.6.2}
    ``` {.sourcecode .lang-abnf}
      Measurements: "l=" " "|[0..9999] ", j=" " "|[0..9999] ", pl="
      " "|[0.00 .. 100.00] ", bw=" " "|[0..999999]
    ```

    [¶](#section-4.3.2-2.6.2){.pilcrow}
    :::

    Where \"l\" stands for latency followed by the measured value (in
    milliseconds) or an empty space, \"j\" stands for jitter followed by
    the measured value (in milliseconds) or an empty space, \"pl\"
    stands for packet loss followed by the measured value (in percentage
    with two decimals) or an empty space, and \"bw\" stands for
    bandwidth followed by the measured value (in kbps) or an empty
    space.[¶](#section-4.3.2-2.6.3){.pilcrow}

:   
:::
:::

::: {#sec-4.3.3}
::: {#section-4.3.3 .section}
#### [4.3.3.](#section-4.3.3){.section-number .selfRef} [Specific Q4S Response Header Fields](#name-specific-q4s-response-heade){.section-name .selfRef} {#name-specific-q4s-response-heade}

[]{.break}

Expires:

:   its purpose is to provide a sanity check and allow the server to
    close inactive sessions. If the client does not send a new request
    before the expiration time, the server [MAY]{.bcp14} close the
    session. The value [MUST]{.bcp14} be an integer, and the measurement
    units are milliseconds.[¶](#section-4.3.3-1.2.1){.pilcrow}

    In order to keep the session open, the server [MUST]{.bcp14} send a
    Q4S alert before the session expiration (Expires header field), with
    the same quality levels and an alert cause of \"keep-alive\". The
    purpose of this alert is to avoid TCP sockets, which were opened
    with READY message, from being closed, specially in NAT
    scenarios.[¶](#section-4.3.3-1.2.2){.pilcrow}

:   
:::
:::
:::
:::

::: {#sec-4.4}
::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [Bodies](#name-bodies){.section-name .selfRef} {#name-bodies}

Requests, including new requests defined in extensions to this
specification, [MAY]{.bcp14} contain message bodies unless otherwise
noted. The interpretation of the body depends on the request
method.[¶](#section-4.4-1){.pilcrow}

For response messages, the request method and the response status code
determine the type and interpretation of any message body. All responses
[MAY]{.bcp14} include a body.[¶](#section-4.4-2){.pilcrow}

The Internet media type of the message body [MUST]{.bcp14} be given by
the Content-Type header field.[¶](#section-4.4-3){.pilcrow}

::: {#sec-4.4.1}
::: {#section-4.4.1 .section}
#### [4.4.1.](#section-4.4.1){.section-number .selfRef} [Encoding](#name-encoding){.section-name .selfRef} {#name-encoding}

The body [MUST NOT]{.bcp14} be compressed. This mechanism is valid for
other protocols such as HTTP and SIP \[[RFC3261](#RFC3261){.xref}\], but
a compression/coding scheme will limit the way the request is parsed to
certain logical implementations, thus making the protocol concept more
implementation dependent. In addition, the bandwidth calculation may not
be valid if compression is used. Therefore, the HTTP Accept-Encoding
request header field cannot be used in Q4S with values different from
\"identity\", and if it is present in a request, the server
[MUST]{.bcp14} ignore it. In addition, the response header field
Content-Encoding is optional, but if present, the unique permitted value
is \"identity\".[¶](#section-4.4.1-1){.pilcrow}

The body length in bytes [MUST]{.bcp14} be provided by the
Content-Length header field. The \"chunked\" transfer encoding of
HTTP/1.1 [MUST NOT]{.bcp14} be used for
Q4S.[¶](#section-4.4.1-2){.pilcrow}

Note: The chunked encoding modifies the body of a message in order to
transfer it as a series of chunks, each one with its own size
indicator.[¶](#section-4.4.1-3.1){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#sec-5}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Q4S Method Definitions](#name-q4s-method-definitions){.section-name .selfRef} {#name-q4s-method-definitions}

The Method token indicates the method to be performed on the resource
identified by the Request-URI. The method is case
sensitive.[¶](#section-5-1){.pilcrow}

::: {#section-5-2}
``` {.sourcecode .lang-abnf}
 Method  = "BEGIN" | "READY" | "PING" | "BWIDTH" |
           "Q4S-ALERT" | "Q4S-RECOVERY" | "CANCEL" | extension-method

 extension-method = token
```

[¶](#section-5-2){.pilcrow}
:::

The list of methods allowed by a resource can be specified in an Allow
header field \[[RFC7231](#RFC7231){.xref}\]. The return code of the
response always notifies the client when a method is currently allowed
on a resource, since the set of allowed methods can change dynamically.
Any server application [SHOULD]{.bcp14} return the status code 405
(Method Not Allowed) if the method is known, but not allowed for the
requested resource, and 501 (Not Implemented) if the method is
unrecognized or not implemented by the
server.[¶](#section-5-3){.pilcrow}

::: {#sec-5.1}
::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [BEGIN](#name-begin){.section-name .selfRef} {#name-begin}

The BEGIN method requests information from a resource identified by a
Q4S URI. The purpose of this method is to start the quality
session.[¶](#section-5.1-1){.pilcrow}

This method is used only during the Handshake phase to retrieve the SDP
containing the sess-id and all quality and operation parameters for the
desired application to run.[¶](#section-5.1-2){.pilcrow}

When a BEGIN message is received by the server, any current quality
session [MUST]{.bcp14} be canceled, and a new session should be
created.[¶](#section-5.1-3){.pilcrow}

The response to a Q4S BEGIN request is not
cacheable.[¶](#section-5.1-4){.pilcrow}
:::
:::

::: {#sec-5.2}
::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [READY](#name-ready){.section-name .selfRef} {#name-ready}

The READY method is used to synchronize the starting time for the
sending of PING and BWIDTH messages over UDP between clients and
servers. Including the Stage header field in this method is
mandatory.[¶](#section-5.2-1){.pilcrow}

This message is used only in Negotiation and Continuity phases, and only
just before making a measurement. Otherwise (outside of this context),
the server [MUST]{.bcp14} ignore this
method.[¶](#section-5.2-2){.pilcrow}
:::
:::

::: {#sec-5.3}
::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [PING](#name-ping){.section-name .selfRef} {#name-ping}

This message is used during the Negotiation and Continuity phases to
measure the RTT and jitter of a session. The message [MUST]{.bcp14} be
sent only over UDP ports.[¶](#section-5.3-1){.pilcrow}

The fundamental difference between the PING and BWIDTH requests is
reflected in the different measurements achieved with them. PING is a
short message, and it [MUST]{.bcp14} be answered in order to measure RTT
and jitter, whereas BWIDTH is a long message and [MUST NOT]{.bcp14} be
answered.[¶](#section-5.3-2){.pilcrow}

PING is a request method that can be originated by either the client or
the server. The client [MUST]{.bcp14} also answer the server PING
messages, assuming a \"server role\" for these messages during the
measurement process.[¶](#section-5.3-3){.pilcrow}

Including the Measurements header field in this method is mandatory, and
provides updated measurements values for latency, jitter, and packet
loss to the counterpart.[¶](#section-5.3-4){.pilcrow}
:::
:::

::: {#sec-5.4}
::: {#section-5.4 .section}
### [5.4.](#section-5.4){.section-number .selfRef} [BWIDTH](#name-bwidth){.section-name .selfRef} {#name-bwidth}

This message is used only during the Negotiation phase to measure the
bandwidth and packet loss of a session. The message [MUST]{.bcp14} be
sent only over UDP ports.[¶](#section-5.4-1){.pilcrow}

BWIDTH is a request method that can be originated by either the client
or the server. Both client and server [MUST NOT]{.bcp14} answer BWIDTH
messages.[¶](#section-5.4-2){.pilcrow}

Including the Measurements header field in this method is mandatory and
provides updated measurements values for bandwidth and packet loss to
the counterpart.[¶](#section-5.4-3){.pilcrow}
:::
:::

::: {#sec-5.5}
::: {#section-5.5 .section}
### [5.5.](#section-5.5){.section-number .selfRef} [Q4S-ALERT](#name-q4s-alert){.section-name .selfRef} {#name-q4s-alert}

This is the request message that Q4S generates when the measurements
indicate that quality constraints are being violated. It is used during
the Negotiation and Continuity phases.[¶](#section-5.5-1){.pilcrow}

This informative message indicates that the user experience is being
degraded and includes the details of the problem (bandwidth, jitter,
packet loss measurements). The Q4S-ALERT message does not contain any
detail on the actions to be taken, which depend on the agreements
between all involved parties.[¶](#section-5.5-2){.pilcrow}

Unless there is an error condition, an answer to a Q4S-ALERT request is
optional and is formatted as a request Q4S-ALERT message. If there is an
error condition, then a response message is sent. The response to a
Q4S-ALERT request is not cacheable.[¶](#section-5.5-3){.pilcrow}

This method [MUST]{.bcp14} be initiated by the server in both alerting
modes. In the Q4S-aware-network alerting mode, the Q4S-ALERT messages
are sent by the server to the client, advising the network to react by
itself. In the Reactive alerting mode, alert notifications are triggered
by the server stack and sent to the Actuator (see [Figure
1](#ref-reactive-scenario){.xref}, \"Reactive
Scenario\").[¶](#section-5.5-4){.pilcrow}

::: {#section-5.5-5 .artwork .art-text .alignLeft}
    Client----q4s----SERVER STACK--->ACTUATOR-->APP OR POLICY SERVER

[¶](#section-5.5-5){.pilcrow}
:::

The way in which the server stack notifies the Actuator is
implementation dependent, and the communication between the Actuator and
the network policy server is defined by the protocol and API that the
policy server implements.[¶](#section-5.5-6){.pilcrow}
:::
:::

::: {#sec-5.6}
::: {#section-5.6 .section}
### [5.6.](#section-5.6){.section-number .selfRef} [Q4S-RECOVERY](#name-q4s-recovery){.section-name .selfRef} {#name-q4s-recovery}

This is the request message that Q4S generates when the measurements
indicate that quality constraints, which had been violated, have been
fulfilled during a period of time (\"recovery-pause\"). It is used
during the Negotiation and Continuity
phases.[¶](#section-5.6-1){.pilcrow}

This informative message indicates that the \"qos-level\" could be
increased gradually until the initial \"qos-level\" is recovered (the
\"qos-level\" established at the beginning of the session that was
decreased during violation of constraints. See [Section
7.9](#sec-7.9){.xref}). The Q4S-RECOVERY message does not contain any
detail on the actions to be taken, which depends on the agreements
between all involved parties.[¶](#section-5.6-2){.pilcrow}

The answer to a Q4S-RECOVERY request is formatted as a request
Q4S-RECOVERY message. A Q4S-RECOVERY request [MUST NOT]{.bcp14} be
answered with a response message unless there is an error condition. The
response to a Q4S-RECOVERY request is not
cacheable.[¶](#section-5.6-3){.pilcrow}

Like the Q4S-ALERT message, the Q4S-RECOVERY method is always initiated
by the server in both alerting modes. In the Q4S-aware-network alerting
mode, the Q4S-RECOVERY messages are sent by the server to the client,
advising the network to react by itself. In the Reactive alerting mode,
recovery notifications are triggered by the server stack and sent to the
Actuator (see [Figure 1](#ref-reactive-scenario){.xref}, \"Reactive
Scenario\").[¶](#section-5.6-4){.pilcrow}
:::
:::

::: {#sec-5.7}
::: {#section-5.7 .section}
### [5.7.](#section-5.7){.section-number .selfRef} [CANCEL](#name-cancel){.section-name .selfRef} {#name-cancel}

The purpose of the CANCEL message is the release of the Q4S Session-Id
and the possible resources assigned to the session. This message could
be triggered by the Q4S stack or by the application using the stack
(through an implementation-dependent API).[¶](#section-5.7-1){.pilcrow}

In the same way as Q4S-ALERT, CANCEL must not be answered with a
response message, but with an answer formatted as a request Q4S-CANCEL
message.[¶](#section-5.7-2){.pilcrow}

In the Reactive scenario, the server stack [MUST]{.bcp14} react to the
Q4S CANCEL messages received from the client by forwarding a cancel
notification to the Actuator, in order to release possible assigned
resources for the session (at the application or at the policy server).
The Actuator [MUST]{.bcp14} answer the cancel notification with a cancel
acknowledge towards the server stack, acknowledging the
reception.[¶](#section-5.7-3){.pilcrow}
:::
:::
:::
:::

::: {#sec-6}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Response Codes](#name-response-codes){.section-name .selfRef} {#name-response-codes}

Q4S response codes are used for TCP and UDP. However, in UDP, only the
response code 200 is used.[¶](#section-6-1){.pilcrow}

The receiver of an unknown response code must take a generic action for
the received error group (1xx, 2xx, 3xx, 4xx, 5xx, 6xx). In case of an
unknown error group, the expected action should be the same as with the
6xx error group.[¶](#section-6-2){.pilcrow}

::: {#sec-6.1}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [100 Trying](#name-100-trying){.section-name .selfRef} {#name-100-trying}

This response indicates that the request has been received by the
next-hop server and that some unspecified action is being taken on
behalf of this request (for example, a database is being consulted).
This response, like all other provisional responses, stops
retransmissions of a Q4S-ALERT during the \"alert-pause\"
time.[¶](#section-6.1-1){.pilcrow}
:::
:::

::: {#sec-6.2}
::: {#section-6.2 .section}
### [6.2.](#section-6.2){.section-number .selfRef} [Success 2xx](#name-success-2xx){.section-name .selfRef} {#name-success-2xx}

2xx responses give information about the success of a
request.[¶](#section-6.2-1){.pilcrow}

::: {#sec-6.2.1}
::: {#section-6.2.1 .section}
#### [6.2.1.](#section-6.2.1){.section-number .selfRef} [200 OK](#name-200-ok){.section-name .selfRef} {#name-200-ok}

The request has succeeded.[¶](#section-6.2.1-1){.pilcrow}
:::
:::
:::
:::

::: {#sec-6.3}
::: {#section-6.3 .section}
### [6.3.](#section-6.3){.section-number .selfRef} [Redirection 3xx](#name-redirection-3xx){.section-name .selfRef} {#name-redirection-3xx}

3xx responses give information about the user\'s new location or about
alternative services that might be able to satisfy the
request.[¶](#section-6.3-1){.pilcrow}

The requesting client [SHOULD]{.bcp14} retry the request at the new
address(es) given by the Location header
field.[¶](#section-6.3-2){.pilcrow}
:::
:::

::: {#sec-6.4}
::: {#section-6.4 .section}
### [6.4.](#section-6.4){.section-number .selfRef} [Request Failure 4xx](#name-request-failure-4xx){.section-name .selfRef} {#name-request-failure-4xx}

4xx responses are definite failure responses from a particular server.
The client [SHOULD NOT]{.bcp14} retry the same request without
modification (for example, adding appropriate header fields or SDP
values). However, the same request to a different server might be
successful.[¶](#section-6.4-1){.pilcrow}

::: {#sec-6.4.1}
::: {#section-6.4.1 .section}
#### [6.4.1.](#section-6.4.1){.section-number .selfRef} [400 Bad Request](#name-400-bad-request){.section-name .selfRef} {#name-400-bad-request}

The request could not be understood due to malformed syntax. The
Reason-Phrase [SHOULD]{.bcp14} identify the syntax problem in more
detail, for example, \"Missing Sequence-Number header
field\".[¶](#section-6.4.1-1){.pilcrow}
:::
:::

::: {#sec-6.4.2}
::: {#section-6.4.2 .section}
#### [6.4.2.](#section-6.4.2){.section-number .selfRef} [404 Not Found](#name-404-not-found){.section-name .selfRef} {#name-404-not-found}

The server has definitive information that the user does not exist at
the domain specified in the Request-URI. This status is also returned if
the domain in the Request-URI does not match any of the domains handled
by the recipient of the request.[¶](#section-6.4.2-1){.pilcrow}
:::
:::

::: {#sec-6.4.3}
::: {#section-6.4.3 .section}
#### [6.4.3.](#section-6.4.3){.section-number .selfRef} [405 Method Not Allowed](#name-405-method-not-allowed){.section-name .selfRef} {#name-405-method-not-allowed}

The method specified in the Request-Line is understood, but not allowed
for the address identified by the
Request-URI.[¶](#section-6.4.3-1){.pilcrow}

The response [MUST]{.bcp14} include an Allow header field containing a
list of valid methods for the indicated
address.[¶](#section-6.4.3-2){.pilcrow}
:::
:::

::: {#sec-6.4.4}
::: {#section-6.4.4 .section}
#### [6.4.4.](#section-6.4.4){.section-number .selfRef} [406 Not Acceptable](#name-406-not-acceptable){.section-name .selfRef} {#name-406-not-acceptable}

The resource identified by the request is only able to generate response
entities that have content characteristics that are not acceptable
according to the Accept header field sent in the
request.[¶](#section-6.4.4-1){.pilcrow}
:::
:::

::: {#sec-6.4.5}
::: {#section-6.4.5 .section}
#### [6.4.5.](#section-6.4.5){.section-number .selfRef} [408 Request Timeout](#name-408-request-timeout){.section-name .selfRef} {#name-408-request-timeout}

The server could not produce a response within a suitable amount of
time, and the client [MAY]{.bcp14} repeat the request without
modifications at any later time.[¶](#section-6.4.5-1){.pilcrow}
:::
:::

::: {#sec-6.4.6}
::: {#section-6.4.6 .section}
#### [6.4.6.](#section-6.4.6){.section-number .selfRef} [413 Request Entity Too Large](#name-413-request-entity-too-larg){.section-name .selfRef} {#name-413-request-entity-too-larg}

The server is refusing to process a request because the request
entity-body is larger than the one that the server is willing or able to
process. The server [MAY]{.bcp14} close the connection to prevent the
client from continuing the request.[¶](#section-6.4.6-1){.pilcrow}
:::
:::

::: {#sec-6.4.7}
::: {#section-6.4.7 .section}
#### [6.4.7.](#section-6.4.7){.section-number .selfRef} [414 Request-URI Too Long](#name-414-request-uri-too-long){.section-name .selfRef} {#name-414-request-uri-too-long}

The server is refusing to process the request because the Request-URI is
longer than the one that the server
accepts.[¶](#section-6.4.7-1){.pilcrow}
:::
:::

::: {#sec-6.4.8}
::: {#section-6.4.8 .section}
#### [6.4.8.](#section-6.4.8){.section-number .selfRef} [415 Unsupported Media Type](#name-415-unsupported-media-type){.section-name .selfRef} {#name-415-unsupported-media-type}

The server is refusing to process the request because the message body
of the request is in a format not supported by the server for the
requested method. The server [MUST]{.bcp14} return a list of acceptable
formats using the Accept, Accept-Encoding, or Accept-Language header
field, depending on the specific problem with the
content.[¶](#section-6.4.8-1){.pilcrow}
:::
:::

::: {#sec-6.4.9}
::: {#section-6.4.9 .section}
#### [6.4.9.](#section-6.4.9){.section-number .selfRef} [416 Unsupported URI Scheme](#name-416-unsupported-uri-scheme){.section-name .selfRef} {#name-416-unsupported-uri-scheme}

The server cannot process the request because the scheme of the URI in
the Request-URI is unknown to the server.[¶](#section-6.4.9-1){.pilcrow}
:::
:::
:::
:::

::: {#sec-6.5}
::: {#section-6.5 .section}
### [6.5.](#section-6.5){.section-number .selfRef} [Server Failure 5xx](#name-server-failure-5xx){.section-name .selfRef} {#name-server-failure-5xx}

5xx responses are failure responses given when a server itself is having
trouble.[¶](#section-6.5-1){.pilcrow}

::: {#sec-6.5.1}
::: {#section-6.5.1 .section}
#### [6.5.1.](#section-6.5.1){.section-number .selfRef} [500 Server Internal Error](#name-500-server-internal-error){.section-name .selfRef} {#name-500-server-internal-error}

The server encountered an unexpected condition that prevented it from
fulfilling the request. The client [MAY]{.bcp14} display the specific
error condition and [MAY]{.bcp14} retry the request after several
seconds.[¶](#section-6.5.1-1){.pilcrow}
:::
:::

::: {#sec-6.5.2}
::: {#section-6.5.2 .section}
#### [6.5.2.](#section-6.5.2){.section-number .selfRef} [501 Not Implemented](#name-501-not-implemented){.section-name .selfRef} {#name-501-not-implemented}

The server does not support the functionality required to fulfill the
request. This is the appropriate response when a server does not
recognize the request method, and it is not capable of supporting it for
any user.[¶](#section-6.5.2-1){.pilcrow}

Note that a 405 (Method Not Allowed) is sent when the server recognizes
the request method, but that method is not allowed or
supported.[¶](#section-6.5.2-2){.pilcrow}
:::
:::

::: {#sec-6.5.3}
::: {#section-6.5.3 .section}
#### [6.5.3.](#section-6.5.3){.section-number .selfRef} [503 Service Unavailable](#name-503-service-unavailable){.section-name .selfRef} {#name-503-service-unavailable}

The server is temporarily unable to process the request due to a
temporary overloading or maintenance of the server. The server
[MAY]{.bcp14} indicate when the client should retry the request in a
Retry-After header field. If no Retry-After is given, the client
[MUST]{.bcp14} act as if it had received a 500 (Server Internal Error)
response.[¶](#section-6.5.3-1){.pilcrow}

A client receiving a 503 (Service Unavailable) [SHOULD]{.bcp14} attempt
to forward the request to an alternate server. It [SHOULD NOT]{.bcp14}
forward any other requests to that server for the duration specified in
the Retry-After header field, if present.[¶](#section-6.5.3-2){.pilcrow}

Servers [MAY]{.bcp14} refuse the connection or drop the request instead
of responding with 503 (Service
Unavailable).[¶](#section-6.5.3-3){.pilcrow}
:::
:::

::: {#sec-6.5.4}
::: {#section-6.5.4 .section}
#### [6.5.4.](#section-6.5.4){.section-number .selfRef} [504 Server Time-Out](#name-504-server-time-out){.section-name .selfRef} {#name-504-server-time-out}

The server did not receive a timely response from an external server it
accessed in attempting to process the
request.[¶](#section-6.5.4-1){.pilcrow}
:::
:::

::: {#sec-6.5.5}
::: {#section-6.5.5 .section}
#### [6.5.5.](#section-6.5.5){.section-number .selfRef} [505 Version Not Supported](#name-505-version-not-supported){.section-name .selfRef} {#name-505-version-not-supported}

The server does not support, or refuses to support, the Q4S protocol
version that was used in the request. The server is indicating that it
is unable or unwilling to complete the request using the same major
version as the client, other than with this error
message.[¶](#section-6.5.5-1){.pilcrow}

In the case that the Q4S version is not supported, this error may be
sent by the server in the Handshake phase just after receiving the first
BEGIN message from client.[¶](#section-6.5.5-2){.pilcrow}
:::
:::

::: {#sec-6.5.6}
::: {#section-6.5.6 .section}
#### [6.5.6.](#section-6.5.6){.section-number .selfRef} [513 Message Too Large](#name-513-message-too-large){.section-name .selfRef} {#name-513-message-too-large}

The server was unable to process the request because the message length
exceeded its capabilities.[¶](#section-6.5.6-1){.pilcrow}
:::
:::
:::
:::

::: {#sec-6.6}
::: {#section-6.6 .section}
### [6.6.](#section-6.6){.section-number .selfRef} [Global Failures 6xx](#name-global-failures-6xx){.section-name .selfRef} {#name-global-failures-6xx}

6xx responses indicate that a server has definitive information about a
particular policy not satisfied for processing the
request.[¶](#section-6.6-1){.pilcrow}

::: {#sec-6.6.1}
::: {#section-6.6.1 .section}
#### [6.6.1.](#section-6.6.1){.section-number .selfRef} [600 Session Does Not Exist](#name-600-session-does-not-exist){.section-name .selfRef} {#name-600-session-does-not-exist}

The Session-Id is not valid.[¶](#section-6.6.1-1){.pilcrow}
:::
:::

::: {#sec-6.6.2}
::: {#section-6.6.2 .section}
#### [6.6.2.](#section-6.6.2){.section-number .selfRef} [601 Quality Level Not Allowed](#name-601-quality-level-not-allow){.section-name .selfRef} {#name-601-quality-level-not-allow}

The \"qos-level\" requested is not allowed for the client/server
pair.[¶](#section-6.6.2-1){.pilcrow}
:::
:::

::: {#sec-6.6.3}
::: {#section-6.6.3 .section}
#### [6.6.3.](#section-6.6.3){.section-number .selfRef} [603 Session Not Allowed](#name-603-session-not-allowed){.section-name .selfRef} {#name-603-session-not-allowed}

The session is not allowed due to some policy (the number of sessions
allowed for the server is exceeded, or the time band of the Q4S-ALERT is
not allowed for the client/server pair,
etc.).[¶](#section-6.6.3-1){.pilcrow}
:::
:::

::: {#sec-6.6.4}
::: {#section-6.6.4 .section}
#### [6.6.4.](#section-6.6.4){.section-number .selfRef} [604 Authorization Not Allowed](#name-604-authorization-not-allow){.section-name .selfRef} {#name-604-authorization-not-allow}

The policy server does not authorize the Q4S-ALERT quality session
improvement operation due to an internal or external
reason.[¶](#section-6.6.4-1){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#sec-7}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Protocol](#name-protocol){.section-name .selfRef} {#name-protocol}

This section describes the measurement procedures, the SDP structure of
the Q4S messages, the different Q4S protocol phases, and the messages
exchanged in them.[¶](#section-7-1){.pilcrow}

::: {#sec-7.1}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Protocol Phases](#name-protocol-phases){.section-name .selfRef} {#name-protocol-phases}

All elements of the IP network contribute to quality in terms of
latency, jitter, bandwidth, and packet loss. All these elements have
their own quality policies in terms of priorities, traffic mode, etc.,
and each element has its own way to manage the quality. The purpose of a
quality connection is to establish end-to-end communication with enough
quality for the application to function
flawlessly.[¶](#section-7.1-1){.pilcrow}

To monitor quality constraints of the application, four phases are
defined and can be seen in [Figure
5](#ref-session-lifetime-phases){.xref}:[¶](#section-7.1-2){.pilcrow}

[]{#name-session-lifetime-phases}

::: {#ref-session-lifetime-phases}
::: {#section-7.1-3.1 .artwork .art-text .alignLeft}
    +---------------------------------------------------------------+
    |                                                               |
    |                                                               |
    | Handshake ---> Negotiation -+--> Continuity ----> Termination |
    |                   A         |    (app start) |    (app end)   |
    |                   |         V        A       V       A        |
    |                   |     violated     |     violated  |        |
    |                   |    constraints   |   constraints |        |
    |                   |      |     |     |_______|   ____|        |
    |                   |      |     |     +-------+       |        |
    |                   |      |     |                     |        |
    |                   +------+     +---------------------+        |
    |                                                               |
    +---------------------------------------------------------------+
:::

[Figure 5](#figure-5){.selfRef}: [Session Lifetime
Phases](#name-session-lifetime-phases){.selfRef}
:::

[]{.break}

Handshake phase:
:   in which the server is contacted by the client, and in the answer
    message, the quality constraints for the application are
    communicated in the embedded SDP.[¶](#section-7.1-4.2){.pilcrow}
:   

Negotiation phase:
:   in which the quality of the connection is measured in both
    directions (latency, jitter, bandwidth, and packet loss), and Q4S
    messages may be sent in order to alert if the measured quality does
    not meet the constraints. This phase is iterative until quality
    constraints are reached, or the session is canceled after a number
    of measurement cycles with consistent violation of the quality
    constraints. The number of measurement cycles executed depends on
    the \"qos-level\", which is incremented in each cycle until a
    maximum \"qos-level\" value is reached. Just after reaching the
    quality requirements, Q4S provides a simple optional mechanism using
    HTTP to start the application.[¶](#section-7.1-4.4){.pilcrow}
:   

Continuity phase:
:   in which quality is continuously measured. In this phase, the
    measurements [MUST]{.bcp14} avoid disturbing the application by
    consuming network resources. If quality constraints are not met, the
    server stack will notify the Actuator with an alert notification. If
    later the quality improves, the server stack will notify the
    Actuator, in this case with a recovery notification. After several
    alert notifications with no quality improvements, the Q4S stack
    [SHOULD]{.bcp14} move to the Termination
    phase.[¶](#section-7.1-4.6){.pilcrow}
:   

Termination phase:
:   in which the Q4S session is terminated. The application may be
    closed also or may not start.[¶](#section-7.1-4.8){.pilcrow}
:   
:::
:::

::: {#sec-7.2}
::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [SDP Structure](#name-sdp-structure){.section-name .selfRef} {#name-sdp-structure}

The original goal of SDP was to announce necessary information for the
participants and multicast MBONE (Multicast Backbone) applications.
Right now, its use has been extended to the announcement and the
negotiation of multimedia sessions. The purpose of Q4S is not to
establish media stream sessions, but to monitor a quality connection.
This connection may be later used to establish any type of session
including media sessions; Q4S does not impose any conditions on the type
of communication requiring quality
parameters.[¶](#section-7.2-1){.pilcrow}

SDP will be used by Q4S to exchange quality constraints and will
therefore always have all the media descriptions (\"m=\") set to
zero.[¶](#section-7.2-2){.pilcrow}

The SDP embedded in the messages is the container of the quality
parameters. As these may vary depending on the direction of the
communication (to and from the client), all quality parameters need to
specify the uplink and downlink values: \<uplink> / \<downlink> (see
[Section 7.5.3](#sec-7.5.3){.xref} for an example). When one or both of
these values are empty, it [MUST]{.bcp14} be understood as needing no
constraint on that parameter and/or that
direction.[¶](#section-7.2-3){.pilcrow}

The uplink direction [MUST]{.bcp14} be considered as being the
communication from the client to the server. The downlink direction
[MUST]{.bcp14} be considered as being the communication from the server
to the client.[¶](#section-7.2-4){.pilcrow}

The SDP information can comprise all or some of the following parameters
shown in the example below. This is an example of an SDP message used by
Q4S included in the 200 OK response to a Q4S BEGIN
request.[¶](#section-7.2-5){.pilcrow}

::: {#section-7.2-6}
``` {.sourcecode .lang-sdp}
v=0
o=q4s-UA 53655765 2353687637 IN IP4 192.0.2.33
s=Q4S
i=Q4S parameters
t=0 0
a=qos-level:0/0
a=alerting-mode:Reactive
a=alert-pause:5000
a=public-address:client IP4 198.51.100.51
a=public-address:server IP4 198.51.100.58
a=measurement:procedure default(50/50,75/75,5000,40/80,100/256)
a=latency:40
a=jitter:10/10
a=bandwidth:20/6000
a=packetloss:0.50/0.50
a=flow:app clientListeningPort TCP/10000-20000
a=flow:app clientListeningPort UDP/15000-18000
a=flow:app serverListeningPort TCP/56000
a=flow:app serverListeningPort UDP/56000
a=flow:q4s clientListeningPort UDP/55000
a=flow:q4s clientListeningPort TCP/55001
a=flow:q4s serverListeningPort UDP/56000
a=flow:q4s serverListeningPort TCP/56001
```

[¶](#section-7.2-6){.pilcrow}
:::

As quality constraints may be changed by applications at any time during
the Q4S session lifetime, any Q4S 200 OK response sent by the server to
the client in the Negotiation and Continuity phases could also include
an SDP body with the new quality requirements stated by the applications
from then on. Therefore, in response to any PING request sent by the
client to the server, the server could send a Q4S 200 OK with an
embedded SDP message that specifies new quality constraints requested by
the application.[¶](#section-7.2-7){.pilcrow}

::: {#sec-7.2.1}
::: {#section-7.2.1 .section}
#### [7.2.1.](#section-7.2.1){.section-number .selfRef} [\"qos-level\" Attribute](#name-qos-level-attribute){.section-name .selfRef} {#name-qos-level-attribute}

The \"qos-level\" attribute contains the QoS level for uplink and
downlink. Default values are 0 for both directions. The meaning of each
level is out of scope of Q4S, but a higher level [SHOULD]{.bcp14}
correspond to a better service quality.[¶](#section-7.2.1-1){.pilcrow}

Appropriate attribute values: \[0..9\] \"/\"
\[0..9\][¶](#section-7.2.1-2){.pilcrow}

The \"qos-level\" attribute may be changed during the session lifetime,
raising or lowering the value as necessary following the network
measurements and the application needs.[¶](#section-7.2.1-3){.pilcrow}
:::
:::

::: {#sec-7.2.2}
::: {#section-7.2.2 .section}
#### [7.2.2.](#section-7.2.2){.section-number .selfRef} [\"alerting-mode\" Attribute](#name-alerting-mode-attribute){.section-name .selfRef} {#name-alerting-mode-attribute}

The \"alerting-mode\" attribute specifies the player in charge of
triggering Q4S alerts in the case of constraint violation. There are two
possible values:[¶](#section-7.2.2-1){.pilcrow}

Appropriate attribute values:
\<\"Q4S-aware-network\"\|\"Reactive\"\>[¶](#section-7.2.2-2){.pilcrow}

[]{.break}

Q4S-aware-network:
:   Q4S-ALERT messages are triggered by the server to the client. In
    this case, the network is supposed to be Q4S aware, and reacts by
    itself to these alerts.[¶](#section-7.2.2-3.2){.pilcrow}
:   

Reactive:
:   alert notifications are sent by the server stack to the Actuator. In
    this case, the network is not Q4S aware, and a specific node
    (Actuator) is in charge of triggering tuning mechanisms, either on
    the network or in the application.[¶](#section-7.2.2-3.4){.pilcrow}
:   

The \"alerting-mode\" attribute is optional, and if not present,
Reactive alerting mode is assumed.[¶](#section-7.2.2-4){.pilcrow}
:::
:::

::: {#sec-7.2.3}
::: {#section-7.2.3 .section}
#### [7.2.3.](#section-7.2.3){.section-number .selfRef} [\"alert-pause\" Attribute](#name-alert-pause-attribute){.section-name .selfRef} {#name-alert-pause-attribute}

In the Q4S-aware-network scenario, the \"alert-pause\" attribute
specifies the amount of time (in milliseconds) the server waits between
consecutive Q4S-ALERT messages sent to the client. In the Reactive
scenario, the \"alert-pause\" attribute specifies the amount of time (in
milliseconds) the server stack waits between consecutive alert
notifications sent to the Actuator. Measurements are not stopped in
Negotiation or Continuity phases during this period of time, but no
Q4S-ALERT messages or alert notifications are fired, even with violated
quality constraints, allowing for either network reconfigurations or
application adjustments.[¶](#section-7.2.3-1){.pilcrow}

Appropriate attribute values:
\[0..60000\][¶](#section-7.2.3-2){.pilcrow}
:::
:::

::: {#sec-7.2.4}
::: {#section-7.2.4 .section}
#### [7.2.4.](#section-7.2.4){.section-number .selfRef} [\"recovery-pause\" Attribute](#name-recovery-pause-attribute){.section-name .selfRef} {#name-recovery-pause-attribute}

In the Q4S-aware-network scenario, the \"recovery-pause\" attribute
specifies the amount of time (in milliseconds) the server waits for
initiating the \"qos-level\" recovery process. Once the recovery process
has started, the \"recovery-pause\" attribute also states the amount of
time (in milliseconds) between consecutive Q4S-RECOVERY messages sent by
the server to the client (in the Q4S-aware-network scenario) or between
recovery notifications sent by the server stack to the Actuator (in the
Reactive scenario).[¶](#section-7.2.4-1){.pilcrow}

Appropriate attribute values:
\[0..60000\][¶](#section-7.2.4-2){.pilcrow}
:::
:::

::: {#sec-7.2.5}
::: {#section-7.2.5 .section}
#### [7.2.5.](#section-7.2.5){.section-number .selfRef} [\"public-address\" Attributes](#name-public-address-attributes){.section-name .selfRef} {#name-public-address-attributes}

This attribute contains the public IP address of the client and the
server. The server fills these attributes with its own public IP address
and the public IP address of the first message received from the client
in the Handshake phase.[¶](#section-7.2.5-1){.pilcrow}

The purpose of these attributes is to make available the addressing
information to the network policy server or other external entities in
charge of processing Q4S-ALERT messages.[¶](#section-7.2.5-2){.pilcrow}

Appropriate attribute values: \<\"client\"\|\"server\"\>
\<\"IP4\"\|\"IP6\"\> \<value of IP
address>[¶](#section-7.2.5-3){.pilcrow}
:::
:::

::: {#sec-7.2.6}
::: {#section-7.2.6 .section}
#### [7.2.6.](#section-7.2.6){.section-number .selfRef} [\"latency\" Attribute](#name-latency-attribute){.section-name .selfRef} {#name-latency-attribute}

The maximum latency (considered equal for uplink and downlink) tolerance
is specified in the \"latency\" attribute, expressed in milliseconds. In
the Q4S-aware-network scenario, if the latency constraints are not met,
a Q4S-ALERT method will be sent to the client. In the Reactive scenario,
if the latency constraints are not met, an alert notification will be
sent to the Actuator. If the \"latency\" attribute is not present or has
a 0 value, no latency constraints need to be met, and no measurements
[MAY]{.bcp14} be taken.[¶](#section-7.2.6-1){.pilcrow}

Appropriate attribute values: \[0..9999\][¶](#section-7.2.6-2){.pilcrow}
:::
:::

::: {#sec-7.2.7}
::: {#section-7.2.7 .section}
#### [7.2.7.](#section-7.2.7){.section-number .selfRef} [\"jitter\" Attribute](#name-jitter-attribute){.section-name .selfRef} {#name-jitter-attribute}

The maximum uplink and downlink jitter tolerance is specified in the
\"jitter\" attribute, expressed in milliseconds. In the
Q4S-aware-network scenario, if the jitter constraints are not met, a
Q4S-ALERT method will be sent to the client. In the Reactive scenario,
if the latency constraints are not met, an alert notification will be
sent to the Actuator. If the \"jitter\" attribute is not present or has
a 0 value, no jitter constraints need to be met, and no measurements
[MAY]{.bcp14} be taken.[¶](#section-7.2.7-1){.pilcrow}

Appropriate attribute values: \[0..9999\] \"/\"
\[0..9999\][¶](#section-7.2.7-2){.pilcrow}
:::
:::

::: {#sec-7.2.8}
::: {#section-7.2.8 .section}
#### [7.2.8.](#section-7.2.8){.section-number .selfRef} [\"bandwidth\" Attribute](#name-bandwidth-attribute){.section-name .selfRef} {#name-bandwidth-attribute}

The minimum uplink and downlink bandwidth is specified in the
\"bandwidth\" attribute, expressed in kbps. In the Q4S-aware-network
scenario, if the bandwidth constraints are not met, a Q4S-ALERT method
will be sent to the client. In the Reactive scenario, an alert
notification will be sent to the Actuator. If the \"bandwidth\"
attribute is not present or has a 0 value, no bandwidth constraints need
to be met, and no measurements [MAY]{.bcp14} be
taken.[¶](#section-7.2.8-1){.pilcrow}

Appropriate attribute values: \[0..99999\] \"/\"
\[0..99999\][¶](#section-7.2.8-2){.pilcrow}
:::
:::

::: {#sec-7.2.9}
::: {#section-7.2.9 .section}
#### [7.2.9.](#section-7.2.9){.section-number .selfRef} [\"packetloss\" Attribute](#name-packetloss-attribute){.section-name .selfRef} {#name-packetloss-attribute}

The maximum uplink and downlink packet loss tolerance is specified in
the \"packetloss\" attribute expressed in percentage (two decimal
accuracy). In the Q4S-aware-network scenario, if the packetloss
constraints are not met, a Q4S-ALERT method will be sent to the client.
In the Reactive scenario, an alert notification will be sent to the
Actuator. If the \"packetloss\" attribute is not present or has a 0
value, no packet loss constraints need to be met, and no measurements
[MAY]{.bcp14} be taken.[¶](#section-7.2.9-1){.pilcrow}

Appropriate attribute values: \[0.00 ..100.00\] \"/\"\[0.00
..100.00\][¶](#section-7.2.9-2){.pilcrow}
:::
:::

::: {#sec-7.2.10}
::: {#section-7.2.10 .section}
#### [7.2.10.](#section-7.2.10){.section-number .selfRef} [\"flow\" Attributes](#name-flow-attributes){.section-name .selfRef} {#name-flow-attributes}

These attributes specify the flows (protocol, destination IP/ports) of
data over TCP and UDP ports to be used in uplink and downlink
communications.[¶](#section-7.2.10-1){.pilcrow}

Several \"flow\" attributes can be defined. These flows identify the
listening port (client or server), the protocol (TCP
\[[RFC0793](#RFC0793){.xref}\] or UDP \[[RFC0768](#RFC0768){.xref}\])
with the range of ports that are going to be used by the application
and, of course, by the Q4S protocol (for quality measurements). All
defined flows (\"app\" and \"q4s\") will be considered within the same
quality profile, which is determined by the \"qos-level\" attribute in
each direction. This allows us to assume that measurements on \"q4s\"
flows are the same as experienced by the application, which is using
\"app\" flows.[¶](#section-7.2.10-2){.pilcrow}

During Negotiation and Continuity phases, the specified Q4S ports in the
\"flow:q4s\" attributes of SDP will be used for Q4S
messages.[¶](#section-7.2.10-3){.pilcrow}

The Q4S flows comprise two UDP flows and two TCP flows (one uplink and
one downlink for each one), whereas application traffic [MAY]{.bcp14}
consist of many flows, depending on its nature. The Handshake phase
takes place through the Q4S Contact URI, using the standard Q4S TCP
port. However, the Negotiation and Continuity phases will take place on
the Q4S ports (UDP and TCP) specified in the
SDP.[¶](#section-7.2.10-4){.pilcrow}

The \"clientListeningPort\" is a port on which the client listens for
server requests and [MUST]{.bcp14} be used as the origin port of client
responses. The \"serverListeningPort\" is a port on which the server is
listening for incoming messages from the client. The origin port of
server responses may be different than the \"serverListeningPort\"
value.[¶](#section-7.2.10-5){.pilcrow}

If \"clientListeningPort\" is zero (\"a=flow:q4s clientListeningPort
TCP/0\"), the client [MAY]{.bcp14} choose one randomly per OS standard
rules. Client ports inside the SDP must always be matched against actual
received port values on the server side in order to deal with NAT/NAPT
devices. If a zero value or incorrect value is present, the server must
set the value to the received origin port in the next message with SDP
(200 OK, ALERT, and CANCEL messages).[¶](#section-7.2.10-6){.pilcrow}

::: {#section-7.2.10-7}
``` {.sourcecode .lang-abnf}
Attribute values:
   <"q4s"|"app"> <"serverListeningPort"|"clientListeningPort">
<"UDP"|"TCP"> <0..65535> [ "-" [0..65535]]
```

[¶](#section-7.2.10-7){.pilcrow}
:::
:::
:::

::: {#sec-7.2.11}
::: {#section-7.2.11 .section}
#### [7.2.11.](#section-7.2.11){.section-number .selfRef} [\"measurement\" Attributes](#name-measurement-attributes){.section-name .selfRef} {#name-measurement-attributes}

These attributes contain the measurement procedure and the results of
the quality measurements.[¶](#section-7.2.11-1){.pilcrow}

Measurement parameters are included using the session attribute
\"measurement\". The first measurement parameter is the procedure. Q4S
provides a \"default\" procedure for measurements, but others like
RTP/RTCP might be used and defined later. This document will only define
and explain the \"default\" procedure.[¶](#section-7.2.11-2){.pilcrow}

In the initial client request, a set of measurement procedures can be
sent to the server for negotiation. One measurement procedure line
[MUST]{.bcp14} be included in the SDP message for each proposed method.
The server [MUST]{.bcp14} answer with only one line with the chosen
procedure.[¶](#section-7.2.11-3){.pilcrow}

For each procedure, a set of values of parameters separated by \",\" can
be included in the same attribute line. The amount and type of
parameters depends on the procedure
type.[¶](#section-7.2.11-4){.pilcrow}

In the following example, the \"default\" procedure type is
chosen:[¶](#section-7.2.11-5){.pilcrow}

::: {#section-7.2.11-6}
``` {.sourcecode .lang-sdp}
   a=measurement:procedure default(50/50,75/75,5000,40/80,100/256)
```

[¶](#section-7.2.11-6){.pilcrow}
:::

In the \"default\" procedure, the meaning of these parameters is the
following:[¶](#section-7.2.11-7){.pilcrow}

-   [The first parameter is the interval of time (in milliseconds)
    between PING requests during the Negotiation phase. Uplink and
    downlink values from the client\'s point of view are separated by
    \"/\". This allows different responsiveness values depending on the
    control resources used in each
    direction.[¶](#section-7.2.11-8.1){.pilcrow}]{#section-7.2.11-8.1}
-   [The second parameter is the time interval (in milliseconds) between
    PING requests during the Continuity phase. Uplink and downlink
    values are separated by \"/\". This allows two different
    responsiveness values depending on the control resources used in
    each
    direction.[¶](#section-7.2.11-8.2){.pilcrow}]{#section-7.2.11-8.2}
-   [The third parameter is the time interval to be used to measure
    bandwidth during the Negotiation
    phase.[¶](#section-7.2.11-8.3){.pilcrow}]{#section-7.2.11-8.3}
-   [The fourth parameter indicates the window size for jitter and
    latency calculations. Uplink and downlink values are separated by
    \"/\".[¶](#section-7.2.11-8.4){.pilcrow}]{#section-7.2.11-8.4}
-   [The fifth parameter indicates the window size for packet loss
    calculations. Uplink and downlink values are separated by
    \"/\".[¶](#section-7.2.11-8.5){.pilcrow}]{#section-7.2.11-8.5}

There are four more \"measurement\"
attributes:[¶](#section-7.2.11-9){.pilcrow}

::: {#section-7.2.11-10}
``` {.sourcecode .lang-sdp}
a=measurement:latency 45
a=measurement:jitter 3/12
a=measurement:bandwidth 200/9800
a=measurement:packetloss 0.00/1.00
```

[¶](#section-7.2.11-10){.pilcrow}
:::

The \"measurement:latency\", \"measurement:jitter\",
\"measurement:bandwidth\", and \"measurement:packetloss\" attributes
contain the values measured for each of these quality parameters in
uplink and downlink directions. Notice that latency is considered equal
for uplink and downlink directions. Quality parameter values in these
\"measurement\" attributes provide a snapshot of the quality reached and
[MUST]{.bcp14} only be included in Q4S-ALERT messages in the SDP body
such that they can be protected from malicious attacks as these alerts
include a signature of the SDP body in the header. The rest of the
messages will include the measured values in the Measurements header
field.[¶](#section-7.2.11-11){.pilcrow}

In the case of the \"default\" procedure, the valid values are as
follows:[¶](#section-7.2.11-12){.pilcrow}

::: {#section-7.2.11-13}
``` {.sourcecode .lang-abnf}
a=measurement:procedure default,[0..999]"/" [0..999]  "," [0..999]
"/" [0..999] "," [0..9999] "," [0..999]/[0..999] ","
[0..999]/[0..999]
```

[¶](#section-7.2.11-13){.pilcrow}
:::
:::
:::

::: {#sec-7.2.12}
::: {#section-7.2.12 .section}
#### [7.2.12.](#section-7.2.12){.section-number .selfRef} [\"max-content-length\" Attribute](#name-max-content-length-attribut){.section-name .selfRef} {#name-max-content-length-attribut}

The adaptation of measurement traffic to approximate the actual data
streams\' characteristics is convenient to accurately estimate the
expected QoS for applications. Particularly, packet size can have a
remarkable effect on bandwidth estimations. Moreover, this can produce
problems depending on the MTU of the end hosts and links along the
path.[¶](#section-7.2.12-1){.pilcrow}

Therefore, the maximum content length [MAY]{.bcp14} be set in an
attribute denoted as \"max-content-length\". Its value [MUST]{.bcp14} be
given in bytes and [MUST NOT]{.bcp14} include application, transport,
network, or link layer headers, i.e., size of the content length at the
application layer. If not set, the value [MUST]{.bcp14} be 1000
bytes.[¶](#section-7.2.12-2){.pilcrow}

Furthermore, this attribute [MAY]{.bcp14} be used to communicate MTU
limits in endpoints, hence reducing possible bias as a result of
network-layer fragmentation.[¶](#section-7.2.12-3){.pilcrow}

For instance:[¶](#section-7.2.12-4){.pilcrow}

a=max-content-length:1300[¶](#section-7.2.12-5){.pilcrow}
:::
:::
:::
:::

::: {#sec-7.3}
::: {#section-7.3 .section}
### [7.3.](#section-7.3){.section-number .selfRef} [Measurements](#name-measurements){.section-name .selfRef} {#name-measurements}

This section describes the way quality parameters are measured as
defined by the \"default\" procedure. Measurements [MUST]{.bcp14} be
taken for any quality parameter with constraints, that is, specified in
the SDP attributes with non-zero values. For absent attributes,
measurements [MAY]{.bcp14} be omitted.[¶](#section-7.3-1){.pilcrow}

::: {#sec-7.3.1}
::: {#section-7.3.1 .section}
#### [7.3.1.](#section-7.3.1){.section-number .selfRef} [Latency](#name-latency){.section-name .selfRef} {#name-latency}

Latency measurements will be performed if the \"latency\" attribute
and/or the \"a=measurement:latency\" attribute are present and have
non-zero values.[¶](#section-7.3.1-1){.pilcrow}

Q4S defines a PING method in order to exchange packets between the
client and the server. Based on this PING exchange, the client and the
server are able to calculate the round-trip time (RTT). The RTT is the
sum of downlink latency (normally named \"reverse latency\") and uplink
latency (normally named \"forward
latency\").[¶](#section-7.3.1-2){.pilcrow}

At least 255 samples of RTT [MUST]{.bcp14} be taken by the client and
server. As the forward and reverse latencies are impossible to measure,
the client and server will assume that both latencies are identical
(symmetric network assumption). The latency will therefore be calculated
as the statistical median value of all the RTT samples divided by
2.[¶](#section-7.3.1-3){.pilcrow}
:::
:::

::: {#sec-7.3.2}
::: {#section-7.3.2 .section}
#### [7.3.2.](#section-7.3.2){.section-number .selfRef} [Jitter](#name-jitter){.section-name .selfRef} {#name-jitter}

Jitter measurements will be performed if the \"jitter\" attribute and/or
the \"a=measurement:jitter\" attribute are present and have non-zero
values.[¶](#section-7.3.2-1){.pilcrow}

The jitter can be calculated independently by the client and by the
server. The downlink jitter is calculated by the client taking into
account the time interval between PING requests as defined by the
\"measurement:procedure\" attribute in the first or second parameter
depending on the Q4S protocol phase. The client and the server
[MUST]{.bcp14} send these PING requests at the specified intervals. The
client measures the downlink jitter, whereas the server measures the
uplink jitter. Note that PING responses are not taken into account when
calculating jitter values.[¶](#section-7.3.2-2){.pilcrow}

Every time a PING request is received by an endpoint (either server or
client), the corresponding jitter value is updated with the statistical
jitter value, which is the arithmetic mean of the absolute values of
elapsed times calculated on the first 255 packets
received.[¶](#section-7.3.2-3){.pilcrow}

Each endpoint sends a PING periodically with a fixed interval, and each
value of \"elapsed time\" (ET) should be very close to this interval. If
a PING message is lost, the ET value is doubled. Identifying lost PING
messages, however, is not an issue because all PING messages are labeled
with a Sequence-Number header field. Therefore, the receiver can discard
this ET value.[¶](#section-7.3.2-4){.pilcrow}

In order to have the first jitter sample, the receiver [MUST]{.bcp14}
wait until it receives 3 PING requests, because each ET is the time
between two PINGs, and a jitter measurement needs at least two
ET.[¶](#section-7.3.2-5){.pilcrow}

The client measures the values of RTT and downlink jitter, and the
server measures RTT and uplink jitter, but all measurements are shared
with the counterpart by means of the Measurements header field of the
PING message.[¶](#section-7.3.2-6){.pilcrow}
:::
:::

::: {#sec-7.3.3}
::: {#section-7.3.3 .section}
#### [7.3.3.](#section-7.3.3){.section-number .selfRef} [Bandwidth](#name-bandwidth){.section-name .selfRef} {#name-bandwidth}

Bandwidth measurements will be performed if the \"bandwidth\" attribute
and/or the \"a=measurement:bandwidth\" attribute is present and has
non-zero values.[¶](#section-7.3.3-1){.pilcrow}

In order to measure the available bandwidth, both the client and the
server [MUST]{.bcp14} start sending BWIDTH messages simultaneously using
the UDP control ports exchanged during the Handshake phase in the SDP
message at the needed rate to verify the availability of the bandwidth
constraint in each direction. The messages are sent during the period of
time defined in the third parameter of the SDP \"measurement:procedure
default\" attribute in milliseconds.[¶](#section-7.3.3-2){.pilcrow}

[]{#name-bandwidth-and-packet-loss-m}

::: {#ref-bandwidth-and-packet-loss-measurements}
::: {#section-7.3.3-3.1 .artwork .art-text .alignLeft}
    a=measurement:procedure default(50/50,75/75,5000,256/256,256/256)

            +------------------------------------------------+
            |             Rate                               |
            |              A                                 |
            |              |                                 |
            |downlink rate-|-------------------+ <-- traffic |
            |              |                   |     sent by |
            |              |                   |     server  |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |              |                   |             |
            |  uplink rate-|-------------------+ <-- traffic |
            |              |                   |     sent by |
            |              |                   |     client  |
            |              |                   |             |
            |              |                   |             |
            |              |---|---|---|---|---|----> time   |
            |              0   1   2   3   4   5     (sec.)  |
            |                                                |
            +------------------------------------------------+
:::

[Figure 6](#figure-6){.selfRef}: [Bandwidth and Packet Loss
Measurements](#name-bandwidth-and-packet-loss-m){.selfRef}
:::

The goal of these measurements is not to identify the available
bandwidth of the communication path, but to determine if the required
bandwidth is available, meeting the application\'s constraints.
Therefore, the requested bandwidth [MUST]{.bcp14} be measured sending
only the highest bitrate required by the bandwidth attribute. This is
illustrated in [Figure
6](#ref-bandwidth-and-packet-loss-measurements){.xref}.[¶](#section-7.3.3-4){.pilcrow}

ALERTS are not expected during bandwidth measurement, but only at the
end of the measurement time.[¶](#section-7.3.3-5){.pilcrow}

When measuring bandwidth, all BWIDTH requests sent [MUST]{.bcp14} be 1
kilobyte in length (UDP payload length by default), they [MUST]{.bcp14}
include a Sequence-Number header field with a sequential number starting
at 0, and their content [MUST]{.bcp14} consist of randomly generated
values to minimize the effect of compression elements along the path.
The Sequence-Number [MUST]{.bcp14} be incremented by 1 with each BWIDTH
packet sent. If any measurement stage needs to be repeated, the sequence
number [MUST]{.bcp14} start at zero again. BWIDTH requests [MUST
NOT]{.bcp14} be answered. Examples:[¶](#section-7.3.3-6){.pilcrow}

::: {#section-7.3.3-7 .artwork .art-text .alignLeft}
    Client message:
    =========================
           BWIDTH q4s://www.example.com Q4S/1.0
           User-Agent: q4s-ua-experimental-1.0
           Session-Id: 53655765
           Sequence-Number: 0
           Content-Type: text
           Content-Length: XXXX
           Measurements: l=22, j=10, pl=0.00, bw=3000

           VkZaU1FrNVZNVlZSV0doT1ZrZ (to complete up to "max-content-
                                     length" bytes UDP payload length)
    =========================

[¶](#section-7.3.3-7){.pilcrow}
:::

The client [MUST]{.bcp14} send BWIDTH packets to the server to allow the
server to measure the uplink bandwidth. The server [MUST]{.bcp14} send
BWIDTH packets to the client to allow the client to measure the downlink
bandwidth.[¶](#section-7.3.3-8){.pilcrow}

::: {#section-7.3.3-9 .artwork .art-text .alignLeft}
    Server message:
    =========================
           BWIDTH q4s://www.example.com Q4S/1.0
           Session-Id: 53655765
           Sequence-Number: 0
           Content-Type: text
           Content-Length: XXXX
           Measurements: l=22, j=7, pl=0.00, bw=200

           ZY0VaT1ZURlZVVmhyUFE9PQ (to complete up to max-content-
                                   length UDP payload length)
    =========================

[¶](#section-7.3.3-9){.pilcrow}
:::
:::
:::

::: {#sec-7.3.4}
::: {#section-7.3.4 .section}
#### [7.3.4.](#section-7.3.4){.section-number .selfRef} [Packet Loss](#name-packet-loss){.section-name .selfRef} {#name-packet-loss}

Packet loss and bandwidth are measured simultaneously using the BWIDTH
packets sent by both the client and the server. Because the BWIDTH
packets contain a Sequence-Number header field incremented sequentially
with each sent packet, lost packets can be easily identified. The lost
packets [MUST]{.bcp14} be counted during the measurement
time.[¶](#section-7.3.4-1){.pilcrow}
:::
:::
:::
:::

::: {#sec-7.4}
::: {#section-7.4 .section}
### [7.4.](#section-7.4){.section-number .selfRef} [Handshake Phase](#name-handshake-phase){.section-name .selfRef} {#name-handshake-phase}

The first phase consists of a Q4S BEGIN method issued from the client to
the server as shown in [Figure
7](#ref-handshake-phase){.xref}.[¶](#section-7.4-1){.pilcrow}

The first Q4S message [MUST]{.bcp14} have a special URI
\[[RFC3986](#RFC3986){.xref}\], which forces the use of the Q4S protocol
if it is implemented in a standard web
browser.[¶](#section-7.4-2){.pilcrow}

This URI, named \"Contact URI\", is used to request the start of a
session. Its scheme [MUST]{.bcp14} be:[¶](#section-7.4-3){.pilcrow}

::: {#section-7.4-4}
``` {.sourcecode .lang-abnf}
      "q4s:" "//" host [":" port] [path["?" query]
```

[¶](#section-7.4-4){.pilcrow}
:::

Optionally, the client can send the desired quality parameters enclosed
in the body of the message as an SDP document. The server [MAY]{.bcp14}
take them into account when building the answer message with the final
values in the SDP body, following a request/response schema
\[[RFC3264](#RFC3264){.xref}\].[¶](#section-7.4-5){.pilcrow}

If the request is accepted, the server [MUST]{.bcp14} answer it with a
Q4S 200 OK message, which [MUST]{.bcp14} contain an SDP body
\[[RFC4566](#RFC4566){.xref}\] with the assigned sess-id (embedded in
the SDP \"o=\" line), the IP addresses to be used, the flow ports to be
used, the measurement procedure to be followed, and information about
the required quality constraints. Additionally, the \"alerting-mode\"
and \"alert-pause\" time attributes may be included. Q4S responses
should use the protocol designator
\"Q4S/1.0\".[¶](#section-7.4-6){.pilcrow}

After these two messages are exchanged, the first phase is completed.
The quality parameter thresholds have been sent to the client. The next
step is to measure the actual quality of the communication path between
the client and the server and alert if the Service Level Agreement (SLA)
is being violated.[¶](#section-7.4-7){.pilcrow}

[]{#name-handshake-phase-2}

::: {#ref-handshake-phase}
::: {#section-7.4-8.1 .artwork .art-text .alignLeft}
            +------------------------------------------------+
            |                                                |
            | Client                            Server       |
            |                                                |
            |     ------- Q4S BEGIN ------------>            |
            |                                                |
            |     <------ Q4S 200 OK ------------            |
            |                                                |
            |                                                |
            +------------------------------------------------+
:::

[Figure 7](#figure-7){.selfRef}: [Handshake
Phase](#name-handshake-phase-2){.selfRef}
:::

The following is an example of a client request and a server
answer:[¶](#section-7.4-9){.pilcrow}

::: {#section-7.4-10 .artwork .art-text .alignLeft}
    Client Request:
    =========================
    BEGIN q4s://www.example.com Q4S/1.0
    Content-Type: application/sdp
    User-Agent: q4s-ua-experimental-1.0
    Content-Length: 142

    (SDP not shown)
    =========================

    Server Answer:
    =========================
    Q4S/1.0 200 OK
    Date: Mon, 10 Jun 2010 10:00:01 GMT
    Content-Type: application/sdp
    Expires: 3000
    Signature: 6ec1ba40e2adf2d783de530ae254acd4f3477ac4
    Content-Length: 131

    (SDP not shown)
    =========================

[¶](#section-7.4-10){.pilcrow}
:::

The header fields used are explained in [Section
4.3](#sec-4.3){.xref}.[¶](#section-7.4-11){.pilcrow}
:::
:::

::: {#sec-7.5}
::: {#section-7.5 .section}
### [7.5.](#section-7.5){.section-number .selfRef} [Negotiation Phase](#name-negotiation-phase){.section-name .selfRef} {#name-negotiation-phase}

The Negotiation phase is in charge of measuring the quality parameters
and verifying that the communication paths meet the required quality
constraints in both directions as specified in the SDP
body.[¶](#section-7.5-1){.pilcrow}

The measured parameters will be compared with the quality constraints
specified in the SDP body. If the quality session is compliant with all
the quality constraints, the application can
start.[¶](#section-7.5-2){.pilcrow}

If the quality constraints are not met, a higher quality service level
will be demanded. Depending on the scenario, this quality upgrade will
be managed as follows:[¶](#section-7.5-3){.pilcrow}

[]{.break}

In the Q4S-aware-network scenario:
:   a Q4S-ALERT method will be triggered by the server to the client,
    and the client will answer with the same Q4S-ALERT method. After
    receiving the same Q4S-ALERT from the counterpart, no other alerts
    will be triggered by the server during the \"alert-pause\" period of
    time in order to allow the network to react, but measurements will
    continue to be taken to achieve early detection of improved network
    quality conditions and a fast application
    start.[¶](#section-7.5-4.2){.pilcrow}
:   

In the Reactive scenario:
:   an alert notification will be sent by the server stack to the
    Actuator, and the Actuator will answer with an alert
    acknowledgement. After receiving the alert acknowledgement from the
    Actuator, the server stack will not send other alert notifications
    during the \"alert-pause\" period of time in order to allow the
    Actuator to react and trigger actions on the application or on the
    policy server, but measurements will continue to be taken to achieve
    early detection of improved network quality conditions and a fast
    application start.[¶](#section-7.5-4.4){.pilcrow}
:   

In both scenarios stated above, if after several measurement cycles, the
network constraints cannot be met, the quality session is terminated.
Concretely when, under all possible actions taken by Actuator, the
quality remains below requirements, the session must be
terminated.[¶](#section-7.5-5){.pilcrow}

The steps to be taken in this phase depend on the measurement procedure
exchanged during the Handshake phase. This document only describes the
\"default\" procedure, but others can be used, like RTP/RTCP
\[[RFC3550](#RFC3550){.xref}\].[¶](#section-7.5-6){.pilcrow}

Measurements of latency and jitter are made by calculating the
differences in the arrival times of packets and can be achieved with
little bandwidth consumption. The bandwidth measurement, on the other
hand, involves higher bandwidth consumption in both directions (uplink
and downlink).[¶](#section-7.5-7){.pilcrow}

To avoid wasting unnecessary network resources, these two types of
measurements will be performed in two separate stages. If the required
latencies and jitters cannot be reached, it makes no sense to waste
network resources measuring bandwidth. In addition, if achieving the
required latency and jitter thresholds implies upgrading the quality
session level, the chance of obtaining compliant bandwidth measurements
without retries is higher, saving network traffic again. Therefore, the
\"default\" procedure determines that the measurements are taken in two
stages:[¶](#section-7.5-8){.pilcrow}

[]{.break}

Stage 0:
:   Measurement of latencies, jitters, and packet
    loss[¶](#section-7.5-9.2){.pilcrow}
:   

Stage 1:
:   Measurement of bandwidths and packet
    loss[¶](#section-7.5-9.4){.pilcrow}
:   

Notice that packet loss can be measured in both stages, as all messages
exchanged include a Sequence-Number header field that allows for easy
packet loss detection.[¶](#section-7.5-10){.pilcrow}

The client starts the Negotiation phase by sending a READY request using
the TCP Q4S ports defined in the SDP. This READY request includes a
Stage header field that indicates the measurement
stage.[¶](#section-7.5-11){.pilcrow}

If either jitter, latency, or both are specified, the Negotiation phase
begins with the measurement of latencies and jitters (stage 0). If none
of those attributes is specified, stage 0 is
skipped.[¶](#section-7.5-12){.pilcrow}

::: {#sec-7.5.1}
::: {#section-7.5.1 .section}
#### [7.5.1.](#section-7.5.1){.section-number .selfRef} [Stage 0: Measurement of Latencies and Jitter](#name-stage-0-measurement-of-late){.section-name .selfRef} {#name-stage-0-measurement-of-late}

The Stage 0 [MUST]{.bcp14} start with a synchronization message exchange
initiated with the client\'s READY
message.[¶](#section-7.5.1-1){.pilcrow}

::: {#section-7.5.1-2 .artwork .art-text .alignLeft}
    Client Request, READY message:
    =========================
           READY q4s://www.example.com Q4S/1.0
           Stage: 0
           Session-Id: 53655765
           User-Agent: q4s-ua-experimental-1.0
           Content-Length: 0
    =========================

    Server Response:
    =========================
      Q4S/1.0 200 OK
           Session-Id: 53655765
           Stage:0
           Content-Length: 0
    =========================

[¶](#section-7.5.1-2){.pilcrow}
:::

This triggers the exchange of a sequence of PING requests and responses
that will lead to the calculation of RTT (latency), jitter, and packet
loss.[¶](#section-7.5.1-3){.pilcrow}

After receiving a 200 OK, the client must send the first PING message,
and the server will wait to send PINGs until the reception of this first
client PING.[¶](#section-7.5.1-4){.pilcrow}

The client and server [MUST]{.bcp14} send PING requests to each other.
The Sequence-Number header field of the first PING [MUST]{.bcp14} be set
to 0. The client and server will manage their own sequence
numbers.[¶](#section-7.5.1-5){.pilcrow}

[]{#name-simultaneous-exchange-of-pi}

::: {#ref-simultaneous-exchange-of-ping-request-and-responses}
::: {#section-7.5.1-6.1 .artwork .art-text .alignLeft}
            +------------------------------------------------+
            |                                                |
            | Client                                Server   |
            |                                                |
            |      --------- Q4S READY 0 --------->          |
            |      <-------- Q4S 200 OK -----------          |
            |                                                |
            |      --------- Q4S PING ------------>          |
            |      <-------- Q4S 200 OK -----------          |
            |      <-------- Q4S PING -------------          |
            |       -------- Q4S 200 OK ---------->          |
            |      --------- Q4S PING ------------>          |
            |      <-------- Q4S PING -------------          |
            |      --------- Q4S 200 OK ---------->          |
            |      <-------- Q4S 200 OK -----------          |
            |                     ...                        |
            |                                                |
            +------------------------------------------------+
:::

[Figure 8](#figure-8){.selfRef}: [Simultaneous Exchange of PING Request
and Responses](#name-simultaneous-exchange-of-pi){.selfRef}
:::

The following is an example of the PING request sent from the client and
the server\'s response:[¶](#section-7.5.1-7){.pilcrow}

::: {#section-7.5.1-8 .artwork .art-text .alignLeft}
    Client Request:
    =========================
           PING q4s://www.example.com Q4S/1.0
           Session-Id: 53655765
           Sequence-Number: 0
           User-Agent: q4s-ua-experimental-1.0
           Measurements: l=22, j=12, pl=0.20, bw=
           Content-Length: 0
    =========================

    Server Response:
    =========================
      Q4S/1.0 200 OK
           Session-Id: 53655765
           Sequence-Number: 0
           Content-Length: 0
    =========================

[¶](#section-7.5.1-8){.pilcrow}
:::

The function of the PING method is similar to the ICMP echo request
message \[[RFC0792](#RFC0792){.xref}\]. The server [MUST]{.bcp14} answer
as soon as it receives the message.[¶](#section-7.5.1-9){.pilcrow}

Both endpoints [MUST]{.bcp14} send Q4S PING messages with the
periodicity specified in the first parameter of SDP
\"measurement:procedure\" attribute, always using the same UDP ports and
incrementing the Sequence-Number with each
message.[¶](#section-7.5.1-10){.pilcrow}

In the following example, the value of the first parameter of the SDP
\"measurement:procedure\" attribute is 50 milliseconds (from the client
to the server) and 60 ms (from the server to the
client):[¶](#section-7.5.1-11){.pilcrow}

::: {#section-7.5.1-12}
``` {.sourcecode .lang-sdp}
a=measurement:procedure default(50/60,50/50,5000,256/256,256/256)
```

[¶](#section-7.5.1-12){.pilcrow}
:::

They [MUST NOT]{.bcp14} wait for a response to send the next PING
request. The Sequence-Number header field value is incremented
sequentially and [MUST]{.bcp14} start at zero. If this stage is
repeated, the initial Sequence-Number [MUST]{.bcp14} start at zero
again.[¶](#section-7.5.1-13){.pilcrow}

All PING requests [MUST]{.bcp14} contain a Measurements header field
with the values of the latency, jitter, and packet loss measured by each
entity up to that moment. The client will send its measurements to the
server, and the server will send its measurements to the client.
Example:[¶](#section-7.5.1-14){.pilcrow}

::: {#section-7.5.1-15 .artwork .art-text .alignLeft}
          Measurements: l=22, j=13, pl=0.10, bw=

[¶](#section-7.5.1-15){.pilcrow}
:::

Where \"l\" stands for latency, \"j\" for jitter, \"pl\" for packet
loss, and \"bw\" for bandwidth. The bandwidth value is omitted, as it is
not measured at this stage.[¶](#section-7.5.1-16){.pilcrow}

Optionally the PING request can include a Timestamp header field with
the time in which the message has been sent. In the case that the header
field is present, the server [MUST]{.bcp14} include the header field in
the response without changing the value.[¶](#section-7.5.1-17){.pilcrow}

A minimum number of PING messages [MUST]{.bcp14} be exchanged in order
to be able to measure latency, jitter, and packet loss with certain
accuracy (at least 256 samples are [RECOMMENDED]{.bcp14} to get an
accurate packet loss measurement). Both the client and the server
calculate the respective measured parameter values. The mechanisms to
calculate the different parameters are described in [Section
7.3](#sec-7.3){.xref}.[¶](#section-7.5.1-18){.pilcrow}

At the end of this stage 0, there are three
possibilities:[¶](#section-7.5.1-19){.pilcrow}

-   [The latency, jitter, and packetloss constraints are reached in both
    directions[¶](#section-7.5.1-20.1){.pilcrow}]{#section-7.5.1-20.1}
-   [The latency, jitter, and packetloss constraints are not reached in
    one or both
    directions[¶](#section-7.5.1-20.2){.pilcrow}]{#section-7.5.1-20.2}

In the first case, Stage 0 is finished. The client and server are ready
for Stage 1: bandwidth and packet loss measurement. The client moves to
stage 1 by sending a READY message that includes the header field,
\"Stage: 1\".[¶](#section-7.5.1-21){.pilcrow}

If the bandwidth constraints are either empty or have a value of zero,
the Negotiation phase [MUST]{.bcp14} terminate, and both client and
server may initiate the Continuity phase. In this case, client moves to
the Continuity phase by sending a READY message that includes the header
field, \"Stage: 2\".[¶](#section-7.5.1-22){.pilcrow}

The second case, in which one or more quality constraints have not been
met, is detailed in [Section
7.5.4](#sec-7.5.4){.xref}.[¶](#section-7.5.1-23){.pilcrow}
:::
:::

::: {#sec-7.5.2}
::: {#section-7.5.2 .section}
#### [7.5.2.](#section-7.5.2){.section-number .selfRef} [Stage 1: Measurement of Bandwidth and Packet Loss](#name-stage-1-measurement-of-band){.section-name .selfRef} {#name-stage-1-measurement-of-band}

This stage begins in a similar way to stage 0, sending a READY request
over TCP. The value of the READY message\'s Stage header field is 1. The
server answers with a Q4S 200 OK message to synchronize the initiation
of the measurements as shown in [Figure
9](#ref-starting-bandwidth-and-packet-loss-measurement){.xref}.[¶](#section-7.5.2-1){.pilcrow}

[]{#name-starting-bandwidth-and-pack}

::: {#ref-starting-bandwidth-and-packet-loss-measurement}
::: {#section-7.5.2-2.1 .artwork .art-text .alignLeft}
            +------------------------------------------------+
            |                                                |
            | Client                                Server   |
            |                                                |
            |      --------- Q4S READY 1 ----------->        |
            |      <-------- Q4S 200 OK -------------        |
            |                                                |
            |      --------- Q4S BWIDTH  ----------->        |
            |      <-------- Q4S BWIDTH  ------------        |
            |      --------- Q4S BWIDTH  ----------->        |
            |      <-------- Q4S BWIDTH  ------------        |
            |                  ...                           |
            |                                                |
            +------------------------------------------------+
:::

[Figure 9](#figure-9){.selfRef}: [Starting Bandwidth and Packet Loss
Measurement](#name-starting-bandwidth-and-pack){.selfRef}
:::

::: {#section-7.5.2-3 .artwork .art-text .alignLeft}
    Client Request:
    =========================
           READY q4s://www.example.com Q4S/1.0
           User-Agent: q4s-ua-experimental-1.0
           Stage: 1
           Session-Id: 53655765
           Content-Length: 0

    =========================

    Server Response:
    =========================
      Q4S/1.0 200 OK
           Session-Id: 53655765
           Stage: 1
           Content-Length: 0

    =========================

[¶](#section-7.5.2-3){.pilcrow}
:::

Just after receiving the 200 OK, both the client and the server
[MUST]{.bcp14} start sending BWIDTH messages simultaneously using the
UDP \"q4s\" ports. [Section 7.3.3](#sec-7.3.3){.xref} describes the
bandwidth measurement in detail.[¶](#section-7.5.2-4){.pilcrow}

At the end of this stage 1, there are three
possibilities:[¶](#section-7.5.2-5){.pilcrow}

-   [The bandwidth and packetloss constraints are reached in both
    directions.[¶](#section-7.5.2-6.1){.pilcrow}]{#section-7.5.2-6.1}
-   [The bandwidth and packetloss constraints are not reached in one or
    both
    directions.[¶](#section-7.5.2-6.2){.pilcrow}]{#section-7.5.2-6.2}

In the first case, Stage 1 is finished. The client and server are ready
for the Continuity phase. The client moves to this phase by sending a
READY message that includes the header field, \"Stage: 2\". The server
answer [MUST]{.bcp14} be 200 OK as shown in [Figure
10](#ref-trigger-the-application-using-http-uri){.xref}.[¶](#section-7.5.2-7){.pilcrow}

[]{#name-trigger-the-application-usi}

::: {#ref-trigger-the-application-using-http-uri}
::: {#section-7.5.2-8.1 .artwork .art-text .alignLeft}
            +------------------------------------------------+
            |                                                |
            | Client                                Server   |
            |                                                |
            |     ---------  Q4S READY 2 -------------->     |
            |     <---- Q4S 200 OK with trigger URI-----     |
            |                                                |
            |     ---------   HTTP GET ---------------->     |
            |                                                |
            |            (Application starts)                |
            |                                                |
            +------------------------------------------------+
:::

[Figure 10](#figure-10){.selfRef}: [Trigger the Application Using HTTP
URI](#name-trigger-the-application-usi){.selfRef}
:::

::: {#section-7.5.2-9 .artwork .art-text .alignLeft}
    Client Request:
    =========================
    READY q4s://www.example.com Q4S/1.0
    User-Agent: q4s-ua-experimental-1.0
    Stage: 2
    Session-Id: 53655765
    Content-Length: 0

    =========================

    Server Answer:
    =========================
    Q4S/1.0 200 OK
    Date: Mon, 10 Jun 2010 10:00:01 GMT
    Session-Id: 53655765
    Trigger-URI: http://www.example.com/app_start
    Expires: 3000
    Content-Type: application/sdp
    Signature: 6ec1ba40e2adf2d783de530ae254acd4f3477ac4
    Content-Length: 131

    (SDP not shown)
    =========================

[¶](#section-7.5.2-9){.pilcrow}
:::

If the Trigger-URI header field is present, the client [SHOULD]{.bcp14}
send an HTTP request to this URI.[¶](#section-7.5.2-10){.pilcrow}

The second case, with violated network constraints, is explained in
[Section 7.5.4](#sec-7.5.4){.xref}.[¶](#section-7.5.2-11){.pilcrow}
:::
:::

::: {#sec-7.5.3}
::: {#section-7.5.3 .section}
#### [7.5.3.](#section-7.5.3){.section-number .selfRef} [Quality Constraints Not Reached](#name-quality-constraints-not-rea){.section-name .selfRef} {#name-quality-constraints-not-rea}

After finishing Stage 1 of the Negotiation phase, the client and the
server have each other\'s measured parameter values as these have been
exchanged in the Measurements header fields of the PING and BWIDTH
messages. If there is one or more parameters that do not comply with the
uplink or downlink application constraints required, both the server and
the client are aware of it.[¶](#section-7.5.3-1){.pilcrow}

If there is any quality parameter that does not meet the uplink or
downlink quality constraints specified in the SDP message, two scenarios
are possible depending on the specified alerting mode (if not present,
the default value is Reactive alerting
mode):[¶](#section-7.5.3-2){.pilcrow}

[]{.break}

\(a\)

:   Q4S-aware-network alerting mode: the server [MUST]{.bcp14} send a
    Q4S-ALERT message to the client including the digital Signature
    header field, and the client [MUST]{.bcp14} answer with the same
    Q4S-ALERT message. The Signature header field contains the signed
    hash value of the SDP body in order to protect all the SDP data, and
    therefore it [MUST]{.bcp14} contain the \"measurement\" parameters
    in the body.[¶](#section-7.5.3-3.1.1){.pilcrow}

    ::: {#section-7.5.3-3.1.2 .artwork .art-text .alignLeft}
        Server request
        =========================
        Q4S-ALERT q4s://www.example.com Q4S/1.0
        Host: www.example.com
        User-Agent: q4s-ua-experimental-1.0
        Session-Id: 53655765
        Content-Type: application/sdp
        Content-Length: 142

        v=0
        o=q4s-UA 53655765 2353687637 IN IP4 192.0.2.33
        s=Q4S
        i=Q4S parameters
        t=0 0
        a=qos-level:1/2
        a=alerting-mode: Q4S-aware-network
        a=alert-pause:5000
        a=public-address:client IP4 198.51.100.51
        a=public-address:server IP4 198.51.100.58
        a=latency:40
        a=jitter:10/10
        a=bandwidth:20/6000
        a=packetloss:0.50/0.50
        a=flow:app downlink TCP/10000-20000
        a=flow:app uplink TCP/56000
        a=flow:q4s downlink UDP/55000
        a=flow:q4s downlink TCP/55001
        a=flow:q4s uplink UDP/56000
        a=flow:q4s uplink TCP/56001
        a=measurement:procedure default(50/50,50/50,5000,256/256,256/256)
        a=measurement:latency 30
        a=measurement:jitter 6/4
        a=measurement:bandwidth 200/4000
        a=measurement:packetloss 0.20/0.33
        =========================

    [¶](#section-7.5.3-3.1.2){.pilcrow}
    :::

    At this point, both the client and server keep on measuring but
    without sending new Q4S-ALERT messages during the \"alert-pause\"
    milliseconds.[¶](#section-7.5.3-3.1.3){.pilcrow}

:   

\(b\)
:   Reactive alerting mode: the server stack [MUST]{.bcp14} send an
    alert notification to the Actuator, and the Actuator [MUST]{.bcp14}
    answer with an acknowledgement to the received alert notification.
    The alert notification sent to the Actuator by the server stack
    doesn\'t follow Q4S message style but should have all the
    information the Actuator will need for the actions to be taken,
    which will be implementation
    dependent.[¶](#section-7.5.3-3.2){.pilcrow}
:   

At this point during Negotiation phase, both the client and server keep
on measuring without sending new alert notifications to the Actuator
during the \"alert-pause\" milliseconds specified in the SDP. This way,
both client and server will detect any improvement in network conditions
as soon as the network reacts. The application can start as soon as the
number of measurements indicated in the \"measurement:procedure\"
attribute indicates that the quality parameters are
met.[¶](#section-7.5.3-4){.pilcrow}

The same applies to Continuity phase: the measurement dialog between
client and server must not be interrupted by any possible ALERT
message.[¶](#section-7.5.3-5){.pilcrow}

::: {#sec-7.5.3.1}
::: {#section-7.5.3.1 .section}
##### [7.5.3.1.](#section-7.5.3.1){.section-number .selfRef} [Actuator Role](#name-actuator-role){.section-name .selfRef} {#name-actuator-role}

The actuator receives notifications of unmet requirements from the Q4S
server stack and acts upon the application or the network policy server,
according to logic out of scope of this
protocol.[¶](#section-7.5.3.1-1){.pilcrow}

The Actuator logic activates mechanisms at the application level and/or
the network level based on a quality level dictionary, in which the
meaning of each level is implementation dependent, and each level
involves different actions based on rules to keep a certain user
experience quality.[¶](#section-7.5.3.1-2){.pilcrow}

The type of actions that an Actuator can take at the application level
are application dependent and [MAY]{.bcp14}
involve:[¶](#section-7.5.3.1-3){.pilcrow}

-   [Reduction of application functionalities, such as limitation of
    application speed or application
    options.[¶](#section-7.5.3.1-4.1){.pilcrow}]{#section-7.5.3.1-4.1}
-   [Reduction of application resources usage, such as reduction of
    frames per second in a video application or any other parameter
    modification in order to adapt to network
    conditions.[¶](#section-7.5.3.1-4.2){.pilcrow}]{#section-7.5.3.1-4.2}

Apart from actions at the application level, the Actuator [MAY]{.bcp14}
act at the network level if a network policy server is
available.[¶](#section-7.5.3.1-5){.pilcrow}
:::
:::

::: {#sec-7.5.3.2}
::: {#section-7.5.3.2 .section}
##### [7.5.3.2.](#section-7.5.3.2){.section-number .selfRef} [Policy Server Role](#name-policy-server-role){.section-name .selfRef} {#name-policy-server-role}

A network policy server may be part of the Reactive scenario, and it is
in charge of managing network quality provision. A network policy server
may implement all or some of these features (but implementation is not
exclusive to):[¶](#section-7.5.3.2-1){.pilcrow}

-   [Server validation in terms of quality
    constraints[¶](#section-7.5.3.2-2.1){.pilcrow}]{#section-7.5.3.2-2.1}

-   [Authentication (Signature validation) and security (blocking of
    malicious
    clients)[¶](#section-7.5.3.2-2.2){.pilcrow}]{#section-7.5.3.2-2.2}

-   ::: {#section-7.5.3.2-2.3}
    Policy rules (the following rules are only
    examples):[¶](#section-7.5.3.2-2.3.1){.pilcrow}

    -   [Maximum quality level allowed for the
        ACP[¶](#section-7.5.3.2-2.3.2.1){.pilcrow}]{#section-7.5.3.2-2.3.2.1}
    -   [Time bands allowed for providing quality
        sessions[¶](#section-7.5.3.2-2.3.2.2){.pilcrow}]{#section-7.5.3.2-2.3.2.2}
    -   [Number of simultaneous quality sessions
        allowed[¶](#section-7.5.3.2-2.3.2.3){.pilcrow}]{#section-7.5.3.2-2.3.2.3}
    -   [Maximum time used by allowed quality
        sessions[¶](#section-7.5.3.2-2.3.2.4){.pilcrow}]{#section-7.5.3.2-2.3.2.4}
    -   [Etc.[¶](#section-7.5.3.2-2.3.2.5){.pilcrow}]{#section-7.5.3.2-2.3.2.5}
    :::

If any of the policy rules fail, a Q4S-ALERT message [MUST]{.bcp14} be
answered by a 6xx error indicating the
cause.[¶](#section-7.5.3.2-3){.pilcrow}
:::
:::
:::
:::

::: {#sec-7.5.4}
::: {#section-7.5.4 .section}
#### [7.5.4.](#section-7.5.4){.section-number .selfRef} [\"qos-level\" Changes](#name-qos-level-changes){.section-name .selfRef} {#name-qos-level-changes}

If any constraint was violated, the server [MAY]{.bcp14} trigger a
Q4S-ALERT asking for a higher \"qos-level\" attribute. The maximum
\"qos-level\" allowed is 9 for both uplink and
downlink.[¶](#section-7.5.4-1){.pilcrow}

If the \"qos-level\" has reached the maximum value for the downlink or
uplink without matching the constraints, then a CANCEL request
[MUST]{.bcp14} be sent by the client using the TCP port determined in
the Handshake phase in order to release the session. In reaction to the
reception of the CANCEL request, the server [MUST]{.bcp14} send a CANCEL
request, too. If no CANCEL request is received, the expiration time
cancels the session on the server side.[¶](#section-7.5.4-2){.pilcrow}

::: {#section-7.5.4-3 .artwork .art-text .alignLeft}
    Client Request:
    =========================
    CANCEL q4s://www.example.com Q4S/1.0
    User-Agent: q4s-ua-experimental-1.0
    Session-Id: 53655765
    Content-Type: application/sdp
    Content-Length: 142

    (SDP not shown)
    =========================

    Server Request in reaction to Client Request:
    =========================
    CANCEL q4s://www.example.com Q4S/1.0
    Session-Id: 53655765
    Expires: 0
    Content-Type: application/sdp
    Signature: 6ec1ba40e2adf2d783de530ae254acd4f3477ac4
    Content-Length: 131

    (SDP not shown)
    =========================

[¶](#section-7.5.4-3){.pilcrow}
:::
:::
:::
:::
:::

::: {#sec-7.6}
::: {#section-7.6 .section}
### [7.6.](#section-7.6){.section-number .selfRef} [Continuity Phase](#name-continuity-phase){.section-name .selfRef} {#name-continuity-phase}

During the Negotiation phase, latency, jitter, bandwidth, and packet
loss have been measured. During the Continuity phase, bandwidth will not
be measured again because bandwidth measurements may disturb application
performance.[¶](#section-7.6-1){.pilcrow}

This phase is supposed to be executed at the same time as the real-time
application is being used.[¶](#section-7.6-2){.pilcrow}

This document only covers the \"default\" procedure. The continuity
operation with the \"default\" procedure is based on a sliding window of
samples. The number of samples involved in the sliding window may be
different for jitter and latency than for packet loss calculations
according to the fifth and sixth parameters of the
\"measurement:procedure\" attribute. In the example, shown in [Figure
11](#ref-sliding-samples-window){.xref}, the jitter and latency sliding
window comprises 40 samples, whereas the size of the packet loss sliding
window is 100 samples:[¶](#section-7.6-3){.pilcrow}

::: {#section-7.6-4}
``` {.sourcecode .lang-sdp}
a=measurement:procedure default(50/50,75/75,5000,40/40,100/100)
```

[¶](#section-7.6-4){.pilcrow}
:::

In addition, the sizes of these windows are configurable per direction:
uplink and downlink values may differ.[¶](#section-7.6-5){.pilcrow}

PING requests are sent continuously (in both directions), and when the
Sequence-Number header field reaches the maximum value, the client
continues sending PING messages with the Sequence-Number header field
starting again at zero. When the server PING Sequence-Number header
field reaches the maximum value, it does the same, starting again from
zero.[¶](#section-7.6-6){.pilcrow}

On the client side, the measured values of downlink jitter, downlink
packet loss, and latency are calculated using the last samples,
discarding older ones, in a sliding window
schema.[¶](#section-7.6-7){.pilcrow}

[]{#name-sliding-samples-window}

::: {#ref-sliding-samples-window}
::: {#section-7.6-8.1 .artwork .art-text .alignLeft}
           +--------------------------------------------------+
           |                                                  |
           | 55 56 57 . . . 253 254 255 0 1 2 . . . 55 56     |
           |        A                                   A     |
           |        |                                   |     |
           |        +-----------------------------------+     |
           |                                                  |
           +--------------------------------------------------+
:::

[Figure 11](#figure-11){.selfRef}: [Sliding Samples
Window](#name-sliding-samples-window){.selfRef}
:::

Only if the server detects that the measured values (downlink or uplink
jitter, packet loss, or latency) are not reaching the quality
constraints, a Q4S-ALERT is triggered and sent either to the client or
to the Actuator, depending on the alerting mode, and the \"alert-pause\"
timer is started.[¶](#section-7.6-9){.pilcrow}

In the Q4S-aware-network alerting mode shown in [Figure
12](#ref-continuity-in-q4s-aware-network-alerting-mode){.xref}, if the
client receives a Q4S-ALERT message, it [MUST]{.bcp14} answer by sending
the Q4S-ALERT request message including the SDP (with its corresponding
digital signature) back to the server.[¶](#section-7.6-10){.pilcrow}

Both client and server will keep performing measurements, but Q4S-ALERT
messages [MUST NOT]{.bcp14} be sent during \"alert-pause\" milliseconds.
The operations needed to act on the network and the agents in charge of
them are out of scope of this document.[¶](#section-7.6-11){.pilcrow}

[]{#name-continuity-in-q4s-aware-net}

::: {#ref-continuity-in-q4s-aware-network-alerting-mode}
::: {#section-7.6-12.1 .artwork .art-text .alignLeft}
            +------------------------------------------------+
            |                                                |
            | Client                      Server             |
            |                                                |
            |               ...                              |
            |   ----------- PING ---------->                 |
            |   <--------- 200 OK ----------                 |
            |   <------- Q4S-ALERT ---------                 |
            |   -------- Q4S-ALERT -------->                 |
            |   <---------- PING -----------                 |
            |   ---------- 200 OK --------->                 |
            |   ----------- PING ---------->                 |
            |   <--------- 200 OK ----------                 |
            |   <---------- PING -----------                 |
            |   ---------- 200 OK --------->                 |
            |        ...                                     |
            |                                                |
            +------------------------------------------------+
:::

[Figure 12](#figure-12){.selfRef}: [Continuity in Q4S-Aware-Network
Alerting Mode](#name-continuity-in-q4s-aware-net){.selfRef}
:::

In the Reactive scenario shown in [Figure
13](#ref-continuity-in-reactive-alerting-mode){.xref}, if the server
detects that the measured values (downlink or uplink jitter, packet
loss, or latency) are not reaching the quality constraints, an alert
notification is triggered and sent to the Actuator. The Actuator
[MUST]{.bcp14} then answer to the server stack with an alert
acknowledgement.[¶](#section-7.6-13){.pilcrow}

The measurement dialog between the client and the server [MUST
NOT]{.bcp14} be interrupted by any possible ALERT
message.[¶](#section-7.6-14){.pilcrow}

[]{#name-continuity-in-reactive-aler}

::: {#ref-continuity-in-reactive-alerting-mode}
::: {#section-7.6-15.1 .artwork .art-text .alignLeft}
            +------------------------------------------------+
            |                                                |
            | Client             Server             Actuator |
            |        ...                                     |
            |   --- PING ---------->                         |
            |   <-- 200 OK----------                         |
            |   <----- PING --------                         |
            |   <--- 200 OK -------- ---- alert              |
            |                            notification -->    |
            |                                                |
            |   --- PING ----------> <--- alert              |
            |                             acknowledge ---    |
            |   <-- 200 OK----------                         |
            |   <----- PING --------                         |
            |   --- 200 OK -------->                         |
            |        ...                                     |
            |                                                |
            +------------------------------------------------+
:::

[Figure 13](#figure-13){.selfRef}: [Continuity in Reactive Alerting
Mode](#name-continuity-in-reactive-aler){.selfRef}
:::
:::
:::

::: {#sec-7.7}
::: {#section-7.7 .section}
### [7.7.](#section-7.7){.section-number .selfRef} [Termination Phase](#name-termination-phase){.section-name .selfRef} {#name-termination-phase}

The Termination phase is the endpoint for the established Q4S session
that is reached in the following cases:[¶](#section-7.7-1){.pilcrow}

-   [A CANCEL message has been received. The client sends a CANCEL
    message due to the network\'s inability to meet the required quality
    constraints. The client and server application will be notified by
    their respective Q4S
    stacks.[¶](#section-7.7-2.1){.pilcrow}]{#section-7.7-2.1}
-   [Session expires: if after the Expires time, no client or server
    activity is detected, that end cancels the
    session.[¶](#section-7.7-2.2){.pilcrow}]{#section-7.7-2.2}
-   [A BEGIN message has been received by the server. The pre-existing
    Q4S quality session is canceled, and a new session will be
    initiated.[¶](#section-7.7-2.3){.pilcrow}]{#section-7.7-2.3}

The meaning of the Termination phase in terms of the release of
resources or accounting is application dependent and out of scope of the
Q4S protocol.[¶](#section-7.7-3){.pilcrow}

In the Reactive alerting mode, Q4S CANCEL messages received by the Q4S
server must cause the server stack to send cancel notifications to the
Actuator in order to release possible assigned resources for the
session.[¶](#section-7.7-4){.pilcrow}

::: {#sec-7.7.1}
::: {#section-7.7.1 .section}
#### [7.7.1.](#section-7.7.1){.section-number .selfRef} [Sanity Check of Quality Sessions](#name-sanity-check-of-quality-ses){.section-name .selfRef} {#name-sanity-check-of-quality-ses}

A session may finish due to several reasons (client shutdown, client
CANCEL request, constraints not reached, etc.), and any session finished
[MUST]{.bcp14} release the assigned
resources.[¶](#section-7.7.1-1){.pilcrow}

In order to release the assigned server resources for the session, the
Expires header field indicates the maximum interval of time without
exchanging any Q4S message.[¶](#section-7.7.1-2){.pilcrow}
:::
:::
:::
:::

::: {#sec-7.8}
::: {#section-7.8 .section}
### [7.8.](#section-7.8){.section-number .selfRef} [Dynamic Constraints and Flows](#name-dynamic-constraints-and-flo){.section-name .selfRef} {#name-dynamic-constraints-and-flo}

Depending on the nature of the application, the quality constraints to
be reached may evolve, changing some or all quality constraint values in
any direction.[¶](#section-7.8-1){.pilcrow}

The client [MUST]{.bcp14} be able to deal with this possibility. When
the server sends an SDP document attached to a response (200 OK or
Q4S-ALERT, etc.), the client [MUST]{.bcp14} take all the new received
values, overriding any previous value in
use.[¶](#section-7.8-2){.pilcrow}

The dynamic changes on the quality constraints can be a result of two
possibilities:[¶](#section-7.8-3){.pilcrow}

-   [The application communicates to the Q4S server a change in the
    constraints. In this case, the application requirements can evolve,
    and the Q4S server will be aware of
    them.[¶](#section-7.8-4.1){.pilcrow}]{#section-7.8-4.1}
-   [The application uses TCP flows. In that case, in order to guarantee
    a constant throughput, the nature of TCP behavior forces the use of
    a composite constraint function, which depends on RTT, packet loss,
    and a window control mechanism implemented in each TCP
    stack.[¶](#section-7.8-4.2){.pilcrow}]{#section-7.8-4.2}

TCP throughput can be less than actual bandwidth if the Bandwidth-Delay
Product (BDP) is large, or if the network suffers from a high packet
loss rate. In both cases, TCP congestion control algorithms may result
in a suboptimal performance.[¶](#section-7.8-5){.pilcrow}

Different TCP congestion control implementations like Reno
\[[RENO](#RENO){.xref}\], High Speed TCP \[[RFC3649](#RFC3649){.xref}\],
CUBIC \[[CUBIC](#I-D.rhee-tcpm-cubic){.xref}\], Compound TCP (CTCP)
\[[CTCP](#I-D.sridharan-tcpm-ctcp){.xref}\], etc., reach different
throughputs under the same network conditions of RTT and packet loss. In
all cases, depending on the RTT-measured value, the Q4S server could
dynamically change the packetloss constraints (defined in the SDP) in
order to make it possible to reach a required throughput or vice versa
(using \"measurement:packetloss\" to change dynamically the latency
constraints).[¶](#section-7.8-6){.pilcrow}

A general guideline for calculating the packet loss constraint and the
RTT constraint consists of approximating the throughput by using a
simplified formula, which should take into account the TCP stack
implementation of the receiver, in addition to the RTT and packet
loss:[¶](#section-7.8-7){.pilcrow}

::: {#section-7.8-8}
``` {.sourcecode .lang-pseudocode}
          Th= Function( RTT, packet loss, ...)
```

[¶](#section-7.8-8){.pilcrow}
:::

Then, depending on RTT-measured values, set dynamically the packet loss
constraint.[¶](#section-7.8-9){.pilcrow}

It is possible to easily calculate a worst-case boundary for the Reno
algorithm, which should ensure for all algorithms that the target
throughput is actually achieved, except that high-speed algorithms will
then have even larger throughput if more bandwidth is
available.[¶](#section-7.8-10){.pilcrow}

For the Reno algorithm, the Mathis formula may be used
\[[RENO](#RENO){.xref}\] for the upper bound on the
throughput:[¶](#section-7.8-11){.pilcrow}

::: {#section-7.8-12}
``` {.sourcecode .lang-pseudocode}
          Th <= (MSS/RTT)*(1 / sqrt{p})
```

[¶](#section-7.8-12){.pilcrow}
:::

In the absence of packet loss, a practical limit for the TCP throughput
is the receiver_window_size divided by the RTT. However, if the TCP
implementation uses a window scale option, this limit can reach the
available bandwidth value.[¶](#section-7.8-13){.pilcrow}
:::
:::

::: {#sec-7.9}
::: {#section-7.9 .section}
### [7.9.](#section-7.9){.section-number .selfRef} [\"qos-level\" Upgrade and Downgrade Operation](#name-qos-level-upgrade-and-downg){.section-name .selfRef} {#name-qos-level-upgrade-and-downg}

Each time the server detects a violation of constraints, the alert
mechanism is triggered, the \"alert-pause\" timer is started, and the
\"qos-level\" is increased. When this happens repeatedly, and the
\"qos-level\" reaches its maximum value (value 9), the session is
canceled. But when the violation of constraints stops before reaching
\"qos-level\" maximum value, the recovery mechanism allows for the
\"qos-level\" upgrade gradually.[¶](#section-7.9-1){.pilcrow}

This downgrade and upgrade of \"qos-level\" is explained with the
following example:[¶](#section-7.9-2){.pilcrow}

1.  [A Q4S session is initiated successfully with
    \"qos-level=0\".[¶](#section-7.9-3.1){.pilcrow}]{#section-7.9-3.1}
2.  [During the Continuity phase, violation of constraints is detected;
    the \"qos-level\" is increased to 1, a Q4S-ALERT is sent by the
    server to the client, and an \"alert-pause\" timer is
    started.[¶](#section-7.9-3.2){.pilcrow}]{#section-7.9-3.2}
3.  [The \"alert-pause\" timer expires, and still a violation of
    constraints is detected; the \"qos-level\" is increased to 2, a
    Q4S-ALERT is sent by the server to the client, and an
    \"alert-pause\" timer is
    started.[¶](#section-7.9-3.3){.pilcrow}]{#section-7.9-3.3}
4.  [The \"alert-pause\" timer expires, but the violation of constraints
    has stopped; the \"recovery-pause\" timer is
    started.[¶](#section-7.9-3.4){.pilcrow}]{#section-7.9-3.4}
5.  [The \"recovery-pause\" timer expires, and no violation of
    constraints has been detected. Meanwhile, the \"qos-level\" is
    decreased to 1, a Q4S-RECOVERY is sent by the server to the client,
    and the \"recovery-pause\" timer is started
    again.[¶](#section-7.9-3.5){.pilcrow}]{#section-7.9-3.5}
6.  [The \"recovery-pause\" timer expires again, and no violation of
    constraints has been detected. Meanwhile, the \"qos-level\" is
    decreased to 0, and a Q4S-RECOVERY is sent by the server to the
    client. The \"recovery-pause\" timer is not started this time as the
    \"qos-level\" has reached its initial
    value.[¶](#section-7.9-3.6){.pilcrow}]{#section-7.9-3.6}

When the network configuration allows for the possibility of managing
Q4S flows and application flows independently (either is a network-based
QoS or a Q4S-aware network), the \"qos-level\" downgrade process could
be managed more efficiently using a strategy that allows for carrying
out \"qos-level\" downgrades excluding application flows from SDP
dynamically. The Q4S flows would be downgraded to allow for measurements
on a lower quality level without interference of the application flows.
A Q4S client [MUST]{.bcp14} allow this kind of SDP modification by the
server.[¶](#section-7.9-4){.pilcrow}

Periodically (every several minutes, depending on the implementation) a
Q4S-ALERT could be triggered, in which the level is downgraded for Q4S
flows, excluding application flows from the embedded SDP of that
request.[¶](#section-7.9-5){.pilcrow}

This mechanism allows the measurement at lower levels of quality while
application flows continue using a higher \"qos-level\"
value.[¶](#section-7.9-6){.pilcrow}

-   [If the measurements in the lower level meet the quality
    constraints, then a Q4S-RECOVERY message to this lower \"qos-level\"
    may be triggered, in which the SDP includes the application flows in
    addition to the Q4S
    flows.[¶](#section-7.9-7.1){.pilcrow}]{#section-7.9-7.1}
-   [If the measurements in the lower level do not meet the constraints,
    then a new Q4S-ALERT to the previous \"qos-level\" [MUST]{.bcp14} be
    triggered, in which the SDP includes only the Q4S
    flows.[¶](#section-7.9-7.2){.pilcrow}]{#section-7.9-7.2}

[]{#name-possible-evolution-of-qos-l}

::: {#ref-possible-evolution-of-qos-level}
::: {#section-7.9-8.1 .artwork .art-text .alignLeft}
            +------------------------------------------------+
            |                                                |
            | qos-level                                      |
            |   A                                            |
            |   |                                            |
            |  4|                                            |
            |   |                                            |
            |  3|             +------+                       |
            |   |             |      |                       |
            |  2|        +----+      +----+     +---         |
            |   |        |                |     |            |
            |  1|   +----+                +-----+            |
            |   |   |                                        |
            |  0+---+---------------------------------> time |
            |                                                |
            +------------------------------------------------+
:::

[Figure 14](#figure-14){.selfRef}: [Possible Evolution of
\"qos-level\"](#name-possible-evolution-of-qos-l){.selfRef}
:::

This mechanism, illustrated in [Figure
14](#ref-possible-evolution-of-qos-level){.xref}, avoids the risk of
disturbing the application while the measurements are being run in lower
levels. However, this optional optimization of resources [MUST]{.bcp14}
be used carefully.[¶](#section-7.9-9){.pilcrow}

The chosen period to measure a lower \"qos-level\" is implementation
dependent. Therefore, it is not included as a \"measurement:procedure\"
parameter. It is [RECOMMENDED]{.bcp14} to use a large value, such as 20
minutes.[¶](#section-7.9-10){.pilcrow}
:::
:::
:::
:::

::: {#sec-8}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [General User Agent Behavior](#name-general-user-agent-behavior){.section-name .selfRef} {#name-general-user-agent-behavior}

::: {#sec-8.1}
::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Roles in Peer-to-Peer Scenarios](#name-roles-in-peer-to-peer-scena){.section-name .selfRef} {#name-roles-in-peer-to-peer-scena}

In order to allow peer-to-peer applications, a Q4S User Agent (UA)
[MUST]{.bcp14} be able to assume both the client and server role. The
role assumed depends on who sends the first
message.[¶](#section-8.1-1){.pilcrow}

In a communication between two UAs, the UA that first sends the Q4S
BEGIN request to start the Handshake phase shall assume the client
role.[¶](#section-8.1-2){.pilcrow}

If both UAs send the BEGIN request at the same time, they will wait for
a random time to restart again as shown in [Figure
15](#ref-p2p-roles){.xref}.[¶](#section-8.1-3){.pilcrow}

Otherwise, an UA may be configured to act only as server (e.g., content
provider\'s side).[¶](#section-8.1-4){.pilcrow}

[]{#name-p2p-roles}

::: {#ref-p2p-roles}
::: {#section-8.1-5.1 .artwork .art-text .alignLeft}
            +-----------------------------------------------+
            |                                               |
            | UA(Client)                         UA(Server) |
            |                                               |
            |     -------- Q4S BEGIN ------------->         |
            |     <------- Q4S BEGIN --------------         |
            |                                               |
            |     ------- Q4S BEGIN -------------->         |
            |     <------ Q4S 200 OK --------------         |
            |                                               |
            |                                               |
            +-----------------------------------------------+
:::

[Figure 15](#figure-15){.selfRef}: [P2P
Roles](#name-p2p-roles){.selfRef}
:::
:::
:::

::: {#sec-8.2}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Multiple Quality Sessions in Parallel](#name-multiple-quality-sessions-i){.section-name .selfRef} {#name-multiple-quality-sessions-i}

A Q4S session is intended to be used for an application. This means that
for using the application, the client [MUST]{.bcp14} establish only one
Q4S session against the server. Indeed, the relation between the
Session-Id and the application is 1 to 1.[¶](#section-8.2-1){.pilcrow}

If a user wants to participate in several independent Q4S sessions
simultaneously against different servers (or against the same server),
it can execute different Q4S clients to establish separately different
Q4S sessions, but it is [NOT RECOMMENDED]{.bcp14}
because:[¶](#section-8.2-2){.pilcrow}

-   [The establishment of a new Q4S session may affect other running
    applications over other Q4S sessions during bandwidth
    measurement.[¶](#section-8.2-3.1){.pilcrow}]{#section-8.2-3.1}
-   [If the Negotiation phase is executed separately before running any
    application, the summation of bandwidth requirements could not be
    met when the applications are running in
    parallel.[¶](#section-8.2-3.2){.pilcrow}]{#section-8.2-3.2}
:::
:::

::: {#sec-8.3}
::: {#section-8.3 .section}
### [8.3.](#section-8.3){.section-number .selfRef} [General Client Behavior](#name-general-client-behavior){.section-name .selfRef} {#name-general-client-behavior}

A Q4S client has different behaviors. We will use letters X, Y, and Z to
designate each different behavior (follow the letters in [Figure
16](#ref-phases-client-behaviors){.xref} and their descriptions
below).[¶](#section-8.3-1){.pilcrow}

[]{.break}

X\)
:   When it sends messages over TCP (methods BEGIN, READY, Q4S-ALERT,
    Q4S-RECOVERY, and CANCEL), it behaves strictly like a state machine
    that sends requests and waits for responses. Depending on the
    response type, it enters into a new
    state.[¶](#section-8.3-2.2){.pilcrow}
:   

When it sends UDP messages (methods PING and BWIDTH), a Q4S client is
not strictly a state machine that sends messages and waits for responses
because of the following:[¶](#section-8.3-3){.pilcrow}

[]{.break}

Y\)
:   During the measurement of latency, jitter, and packet loss, the PING
    requests are sent periodically, not just after receiving the
    response to the previous request. In addition, the client
    [MUST]{.bcp14} answer the PING requests coming from the server,
    therefore the client assumes temporarily the role of a
    server.[¶](#section-8.3-4.2){.pilcrow}
:   

[]{.break}

Z\)
:   During the bandwidth and packet loss measurement stage, the client
    does not expect to receive responses when sending BWIDTH requests to
    the server. In addition, it [MUST]{.bcp14} receive and process all
    server messages in order to achieve the downlink
    measurement.[¶](#section-8.3-5.2){.pilcrow}
:   

The Q4S-ALERT and CANCEL may have a conventional answer if an error is
produced, otherwise the corresponding answer is formatted as a request
message.[¶](#section-8.3-6){.pilcrow}

[]{#name-phases-and-client-behaviors}

::: {#ref-phases-client-behaviors}
::: {#section-8.3-7.1 .artwork .art-text .alignLeft}
      +-----------+------------------------+-----------+-----------+
      | Handshake |    Negotiation         |Continuity |Termination|
      |   Phase   |      Phase             |   Phase   |  Phase    |
      |           |                        |           |           |
      | X ---------> Y --> X --> Z --> X ---> Y --> X ---> X       |
      |           |  A     |     A     |   |  A     |  |           |
      |           |  |     |     |     |   |  |     |  |           |
      |           |  +-----+     +-----+   |  +-----+  |           |
      |           |                        |           |           |
      +------------------------------------------------+-----------+
:::

[Figure 16](#figure-16){.selfRef}: [Phases and Client
Behaviors](#name-phases-and-client-behaviors){.selfRef}
:::

::: {#sec-8.3.1}
::: {#section-8.3.1 .section}
#### [8.3.1.](#section-8.3.1){.section-number .selfRef} [Generating Requests](#name-generating-requests){.section-name .selfRef} {#name-generating-requests}

A valid Q4S request formulated by a client [MUST]{.bcp14}, at a minimum,
contain the following header fields:[¶](#section-8.3.1-1){.pilcrow}

[]{.break}

If no SDP is included:
:   the header fields Session-Id and Sequence-Number are
    mandatory.[¶](#section-8.3.1-2.2){.pilcrow}
:   

If SDP is included:
:   the Session-Id is embedded into the SDP, therefore the inclusion of
    the Session-Id header field is optional, but if present, must have
    the same value. Measurements are embedded into the SDP only for
    Q4S-ALERT messages in order to be
    signed.[¶](#section-8.3.1-2.4){.pilcrow}
:   

At any time, if the server sends new SDP with updated values, the client
[MUST]{.bcp14} take it into account.[¶](#section-8.3.1-3){.pilcrow}
:::
:::
:::
:::

::: {#sec-8.4}
::: {#section-8.4 .section}
### [8.4.](#section-8.4){.section-number .selfRef} [General Server Behavior](#name-general-server-behavior){.section-name .selfRef} {#name-general-server-behavior}

If a server does not understand a header field in a request (that is,
the header field is not defined in this specification or in any
supported extension), the server [MUST]{.bcp14} ignore that header field
and continue processing the message.[¶](#section-8.4-1){.pilcrow}

The role of the server is changed at Negotiation and Continuity phases,
in which the server [MUST]{.bcp14} send packets to measure jitter,
latency, and bandwidth. Therefore, the different behaviors of the server
are (follow the letters in [Figure
17](#ref-phases-server-behaviours){.xref} and their descriptions
below):[¶](#section-8.4-2){.pilcrow}

[]{.break}

R\)
:   When the client sends messages over TCP (methods BEGIN, READY
    Q4S-ALERT, Q4S-RECOVERY, and CANCEL), it behaves strictly like a
    state machine that receives messages and sends
    responses.[¶](#section-8.4-3.2){.pilcrow}
:   

When the client begins to send UDP messages (methods PING and BWIDTH), a
Q4S server is not strictly a state machine that receives messages and
sends responses because of the following:[¶](#section-8.4-4){.pilcrow}

[]{.break}

S\)
:   During the measurement of latency, jitter, and packet loss, the PING
    requests are sent periodically by the client and also by the server.
    In this case, the server behaves as a server answering client
    requests but also behaves temporarily as a client, sending PING
    requests toward the client and receiving
    responses.[¶](#section-8.4-5.2){.pilcrow}
:   

[]{.break}

T\)
:   During bandwidth and packet loss measurement, the server sends
    BWIDTH requests to the client. In addition, it [MUST]{.bcp14}
    receive and process client messages in order to achieve the uplink
    measurement.[¶](#section-8.4-6.2){.pilcrow}
:   

The Q4S-ALERT and CANCEL may have a conventional answer if an error is
produced, otherwise the corresponding answer is formatted as a request
message.[¶](#section-8.4-7){.pilcrow}

[]{#name-phases-and-server-behaviors}

::: {#ref-phases-server-behaviours}
::: {#section-8.4-8.1 .artwork .art-text .alignLeft}
      +-----------+------------------------+-----------+-----------+
      | Handshake |    Negotiation         |Continuity |Termination|
      |   Phase   |      Phase             |   Phase   |  Phase    |
      |           |                        |           |           |
      | R ---------> S --> R --> T --> R ---> S --> R ---> R       |
      |           |  A     |     A     |   |  A     |  |           |
      |           |  |     |     |     |   |  |     |  |           |
      |           |  +-----+     +-----+   |  +-----+  |           |
      |           |                        |           |           |
      +------------------------------------------------+-----------+
:::

[Figure 17](#figure-17){.selfRef}: [Phases and Server
Behaviors](#name-phases-and-server-behaviors){.selfRef}
:::
:::
:::
:::
:::

::: {#sec-9}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Implementation Recommendations](#name-implementation-recommendati){.section-name .selfRef} {#name-implementation-recommendati}

::: {#sec-9.1}
::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Default Client Constraints](#name-default-client-constraints){.section-name .selfRef} {#name-default-client-constraints}

To provide a default configuration, it would be good if the client had a
configurable set of quality headers in the implementation settings menu.
Otherwise, these quality headers will not be present in the first
message.[¶](#section-9.1-1){.pilcrow}

Different business models (out of scope of this proposal) may be
achieved: depending on who pays for the quality session, the server can
accept certain client parameters sent in the first message, or force
billing parameters on the server side.[¶](#section-9.1-2){.pilcrow}
:::
:::

::: {#sec-9.2}
::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Latency and Jitter Measurements](#name-latency-and-jitter-measurem){.section-name .selfRef} {#name-latency-and-jitter-measurem}

Different client and server implementations may send a different number
of PING messages for measuring, although at least 255 messages should be
considered to perform the latency measurement. The Stage 0 measurements
may be considered ended only when neither the client nor server receive
new PING messages after an implementation-dependent guard time. Only
after, the client can send a \"READY 1\"
message.[¶](#section-9.2-1){.pilcrow}

In execution systems, where the timers are not accurate, a recommended
approach consists of including the optional Timestamp header field in
the PING request with the time in which the message has been sent. This
allows an accurate measurement of the jitter even with no identical
intervals of time between PINGs.[¶](#section-9.2-2){.pilcrow}
:::
:::

::: {#sec-9.3}
::: {#section-9.3 .section}
### [9.3.](#section-9.3){.section-number .selfRef} [Bandwidth Measurements](#name-bandwidth-measurements){.section-name .selfRef} {#name-bandwidth-measurements}

In programming languages or operating systems with limited timers or
clock resolution, it is recommended to use an approach based on several
intervals to send messages of 1KB (= 8000 bits) in order to reach the
required bandwidth consumption, using a rate as close as possible to a
constant rate.[¶](#section-9.3-1){.pilcrow}

For example, if the resolution is 1 millisecond, and the bandwidth to
reach is 11 Mbps, a good approach consists of
sending:[¶](#section-9.3-2){.pilcrow}

::: {#section-9.3-3 .artwork .art-text .alignLeft}
          1 message of 1KB every 1 millisecond +

          1 message of 1KB every 3 milliseconds +

          1 message of 1KB every 23 milliseconds

[¶](#section-9.3-3){.pilcrow}
:::

The number of intervals depends on the required bandwidth and accuracy
that the programmer wants to achieve.[¶](#section-9.3-4){.pilcrow}

Considering messages of 1KB (= 8000 bits), a general approach to
determine these intervals is the following:[¶](#section-9.3-5){.pilcrow}

[]{.break}

\(1\)
:   Compute target bandwidth / 8000 bits. In the example above, it is 11
    Mbps / 8000 = 1375 messages per
    second.[¶](#section-9.3-6.1){.pilcrow}
:   

\(2\)
:   Divide the number of messages per second by 1000 to determine the
    number of messages per millisecond: 1375 / 1000 = 1.375. The integer
    value is the number of messages per millisecond (in this case, one).
    The pending bandwidth is now 375 messages per
    second.[¶](#section-9.3-6.2){.pilcrow}
:   

\(3\)

:   To achieve the 375 messages per second, use a submultiple of 1000,
    which must be less than 375:[¶](#section-9.3-6.3.1){.pilcrow}

    ::: {#section-9.3-6.3.2 .artwork .art-text .alignLeft}
              1000 / 2 = 500 > 375

              1000 / 3 = 333 < 375

    [¶](#section-9.3-6.3.2){.pilcrow}
    :::

    In this case, a message every 3 ms is suitable. The new pending
    target bandwidth is 375 - 333 = 42 messages per
    second.[¶](#section-9.3-6.3.3){.pilcrow}

:   

\(4\)

:   Repeat the same strategy as point 3 to reach the pending bandwidth.
    In this case, 23 ms is suitable because of the
    following:[¶](#section-9.3-6.4.1){.pilcrow}

    ::: {#section-9.3-6.4.2 .artwork .art-text .alignLeft}
              1000 / 22 = 45 > 42

              1000 / 23 = 43 > 42

              1000 / 24 = 41.6 < 42

    [¶](#section-9.3-6.4.2){.pilcrow}
    :::

:   

We can choose 24 ms, but then we need to cover an additional 0.4
messages per second (42 - 41.6 = 0.4), and 43 is a number higher than 42
but very close to it.[¶](#section-9.3-7){.pilcrow}

In execution systems where the timers are not accurate, a recommended
approach consists of checking at each interval the number of packets
that should have been sent at this timestamp since origin and send the
needed number of packets in order to reach the required
bandwidth.[¶](#section-9.3-8){.pilcrow}

The shorter the packets used, the more constant the rate of bandwidth
measurement. However, this may stress the execution system in charge of
receiving and processing packets. As a consequence, some packets may be
lost because of stack overflows. To deal with this potential issue, a
larger packet is [RECOMMENDED]{.bcp14} (2KB or more), taking into
account the overhead produced by the chunks\'
headers.[¶](#section-9.3-9){.pilcrow}
:::
:::

::: {#sec-9.4}
::: {#section-9.4 .section}
### [9.4.](#section-9.4){.section-number .selfRef} [Packet Loss Measurement Resolution](#name-packet-loss-measurement-res){.section-name .selfRef} {#name-packet-loss-measurement-res}

Depending on the application nature and network conditions, a packet
loss resolution less than 1% may be needed. In such cases, there is no
limit to the number of samples used for this calculation. A trade-off
between time and resolution should be reached in each case. For example,
in order to have a resolution of 1/10000, the last 10000 samples should
be considered in the packet loss measured
value.[¶](#section-9.4-1){.pilcrow}

The problem of this approach is the reliability of old samples. If the
interval used between PING messages is 50 ms, then to have a resolution
of 1/1000, it takes 50 seconds, and a resolution of 1/10000 takes 500
seconds (more than 8 minutes). The reliability of a packet loss
calculation based on a sliding window of 8 minutes depends on how fast
network conditions evolve.[¶](#section-9.4-2){.pilcrow}
:::
:::

::: {#sec-9.5}
::: {#section-9.5 .section}
### [9.5.](#section-9.5){.section-number .selfRef} [Measurements and Reactions](#name-measurements-and-reactions){.section-name .selfRef} {#name-measurements-and-reactions}

Q4S can be used as a mechanism to measure and trigger network tuning and
application-level actions (i.e. lowering video bit-rate, reducing
multiplayer interaction speed, etc.) in real time in order to reach the
application constraints, addressing measured possible network
degradation.[¶](#section-9.5-1){.pilcrow}
:::
:::

::: {#sec-9.6}
::: {#section-9.6 .section}
### [9.6.](#section-9.6){.section-number .selfRef} [Instability Treatments](#name-instability-treatments){.section-name .selfRef} {#name-instability-treatments}

There are two scenarios in which Q4S can be affected by network
problems: loss of Q4S packets and outlier
samples.[¶](#section-9.6-1){.pilcrow}

::: {#sec-9.6.1}
::: {#section-9.6.1 .section}
#### [9.6.1.](#section-9.6.1){.section-number .selfRef} [Loss of Control Packets](#name-loss-of-control-packets){.section-name .selfRef} {#name-loss-of-control-packets}

Lost UDP packets (PING or BWIDTH messages) don\'t cause any problems for
the Q4S state machine, but if TCP packets are delivered too late (which
we will consider as \"lost\"), some undesirable consequences could
arise.[¶](#section-9.6.1-1){.pilcrow}

Q4S does have protection mechanisms to overcome these situations.
Examples:[¶](#section-9.6.1-2){.pilcrow}

-   [If a BEGIN packet or its corresponding answer is lost, after a
    certain timeout, the client [SHOULD]{.bcp14} resend another BEGIN
    packet, resetting the
    session[¶](#section-9.6.1-3.1){.pilcrow}]{#section-9.6.1-3.1}
-   [If a READY packet is lost, after a certain timeout, the client
    [SHOULD]{.bcp14} resend another READY
    packet.[¶](#section-9.6.1-3.2){.pilcrow}]{#section-9.6.1-3.2}
-   [If a Q4S-ALERT request or its corresponding answer is lost, after a
    certain timeout, the originator [SHOULD]{.bcp14} resend another
    Q4S-ALERT
    packet.[¶](#section-9.6.1-3.3){.pilcrow}]{#section-9.6.1-3.3}
-   [If a CANCEL request or its corresponding answer is lost, after a
    certain timeout, the originator [SHOULD]{.bcp14} resend another
    CANCEL packet.[¶](#section-9.6.1-3.4){.pilcrow}]{#section-9.6.1-3.4}
:::
:::

::: {#sec-9.6.2}
::: {#section-9.6.2 .section}
#### [9.6.2.](#section-9.6.2){.section-number .selfRef} [Outlier Samples](#name-outlier-samples){.section-name .selfRef} {#name-outlier-samples}

Outlier samples are those jitter or latency values far from the
general/average values of most samples.[¶](#section-9.6.2-1){.pilcrow}

Hence, the Q4S default measurement method uses the statistical median
formula for latency calculation, and the outlier samples are
neutralized. This is a very common filter for noise or errors on signal
and image processing.[¶](#section-9.6.2-2){.pilcrow}
:::
:::
:::
:::

::: {#sec-9.7}
::: {#section-9.7 .section}
### [9.7.](#section-9.7){.section-number .selfRef} [Scenarios](#name-scenarios){.section-name .selfRef} {#name-scenarios}

Q4S could be used in two scenarios:[¶](#section-9.7-1){.pilcrow}

-   [client to ACP[¶](#section-9.7-2.1){.pilcrow}]{#section-9.7-2.1}
-   [client to client (peer-to-peer
    scenario)[¶](#section-9.7-2.2){.pilcrow}]{#section-9.7-2.2}

::: {#sec-9.7.1}
::: {#section-9.7.1 .section}
#### [9.7.1.](#section-9.7.1){.section-number .selfRef} [Client to ACP](#name-client-to-acp){.section-name .selfRef} {#name-client-to-acp}

One server:[¶](#section-9.7.1-1){.pilcrow}

It is the common scenario in which the client contacts the server to
establish a Q4S session.[¶](#section-9.7.1-2){.pilcrow}

N servers:[¶](#section-9.7.1-3){.pilcrow}

In Content Delivery Networks and in general applications where delivery
of contents can be achieved by different delivery nodes, two working
mechanisms can be defined:[¶](#section-9.7.1-4){.pilcrow}

[]{.break}

Starting mode:
:   the end user may run Q4S against several delivery nodes and after
    some seconds choose the best one to start the multimedia
    session.[¶](#section-9.7.1-5.2){.pilcrow}
:   

Prevention mode:
:   during a streaming session, the user keeps several Q4S dialogs
    against different alternative delivery nodes. In case of congestion,
    the end user [MAY]{.bcp14} change to the best alternative delivery
    node.[¶](#section-9.7.1-5.4){.pilcrow}
:   
:::
:::

::: {#sec-9.7.2}
::: {#section-9.7.2 .section}
#### [9.7.2.](#section-9.7.2){.section-number .selfRef} [Client to Client](#name-client-to-client){.section-name .selfRef} {#name-client-to-client}

In order to solve the client-to-client scenario, a Q4S register function
[MUST]{.bcp14} be implemented. This allows clients to contact each other
for sending the BEGIN message. In this scenario, the Register server
would be used by peers to publish their Q4S-Resource-Server header and
their public IP address to enable the assumption of the server
role.[¶](#section-9.7.2-1){.pilcrow}

The register function is out of scope of this protocol version because
different HTTP mechanisms can be used, and Q4S [MUST NOT]{.bcp14} force
any.[¶](#section-9.7.2-2){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#sec-10}
::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

::: {#sec-10.1}
::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [Confidentiality Issues](#name-confidentiality-issues){.section-name .selfRef} {#name-confidentiality-issues}

Because Q4S does not transport any application data, Q4S does not
jeopardize the security of application data. However, other certain
considerations may take place, like identity impersonation and
measurements privacy and integrity.[¶](#section-10.1-1){.pilcrow}
:::
:::

::: {#sec-10.2}
::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Integrity of Measurements and Authentication](#name-integrity-of-measurements-a){.section-name .selfRef} {#name-integrity-of-measurements-a}

Identity impersonation could potentially produce anomalous Q4S
measurements. If this attack is based on spoofing of the server IP
address, it can be avoided using the digital signature mechanism
included in the SDP. The network can easily validate this digital
signature using the public key of the server
certificate.[¶](#section-10.2-1){.pilcrow}

Integrity of Q4S measurements under any malicious manipulation (such as
a Man-in-the-Middle (MITM) attack) relies on the same mechanism, the SDP
signature.[¶](#section-10.2-2){.pilcrow}

The Signature header field contains the signed hash value of the SDP
body in order to protect all the SDP data, including the measurements.
This signature not only protects the integrity of data but also
authenticates the server.[¶](#section-10.2-3){.pilcrow}
:::
:::

::: {#sec-10.3}
::: {#section-10.3 .section}
### [10.3.](#section-10.3){.section-number .selfRef} [Privacy of Measurements](#name-privacy-of-measurements){.section-name .selfRef} {#name-privacy-of-measurements}

This protocol could be supported over IPsec. Q4S relies on UDP and TCP,
and IPsec supports both. If Q4S is used for application-based QoS, then
IPsec is operationally valid; however, if Q4S is used to trigger
network-based actions, then measurements could be incorrect unless the
IPsec ports can be a target of potential action over the network (such
as prioritizing IPsec flows to measure the new, upgraded state of
certain application flows).[¶](#section-10.3-1){.pilcrow}
:::
:::

::: {#sec-10.4}
::: {#section-10.4 .section}
### [10.4.](#section-10.4){.section-number .selfRef} [Availability Issues](#name-availability-issues){.section-name .selfRef} {#name-availability-issues}

Any loss of connectivity may interrupt the availability of the Q4S
service and may result in higher packet loss measurements, which is just
the desired behavior in these situations.[¶](#section-10.4-1){.pilcrow}

In order to mitigate availability issues caused by malicious attacks
(such as DoS and DDoS), a good practice is to enable the Q4S service
only for authenticated users. Q4S can be launched after the user is
authenticated by the application. At this moment, the user\'s IP address
is known, and the Q4S service may be enabled for this IP address.
Otherwise, the Q4S service should appear
unreachable.[¶](#section-10.4-2){.pilcrow}
:::
:::

::: {#sec-10.5}
::: {#section-10.5 .section}
### [10.5.](#section-10.5){.section-number .selfRef} [Bandwidth Occupancy Issues](#name-bandwidth-occupancy-issues){.section-name .selfRef} {#name-bandwidth-occupancy-issues}

Q4S bandwidth measurement is limited to the application needs. It means
that all available bandwidth is not measured, but only the fraction
required by the application. This allows other applications to use the
rest of available bandwidth normally.[¶](#section-10.5-1){.pilcrow}

However, a malicious Q4S client could restart Q4S sessions just after
finishing the Negotiation phase. The consequence would be to waste
bandwidth for nothing.[¶](#section-10.5-2){.pilcrow}

In order to mitigate this possible anomalous behavior, it is
[RECOMMENDED]{.bcp14} to configure the server to reject sessions from
the same endpoint when this situation is
detected.[¶](#section-10.5-3){.pilcrow}
:::
:::
:::
:::

::: {#sec-11}
::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [Future Code Point Requirements](#name-future-code-point-requireme){.section-name .selfRef} {#name-future-code-point-requireme}

If the ideas described in this document are pursued to become a protocol
specification, then the code points described in this document will need
to be assigned by IANA.[¶](#section-11-1){.pilcrow}

::: {#sec-11.1}
::: {#section-11.1 .section}
### [11.1.](#section-11.1){.section-number .selfRef} [Service Port](#name-service-port){.section-name .selfRef} {#name-service-port}

An assigned port would make possible a future Q4S-aware network capable
of reacting by itself to Q4S alerts. A specific port would simplify the
identification of the protocol by network elements in charge of making
possible reactive decisions. Therefore, the need for a port assignment
by IANA may be postponed until there is the need for a future Q4S-aware
network.[¶](#section-11.1-1){.pilcrow}

Service Name: Q4S[¶](#section-11.1-2){.pilcrow}

Transport Protocol(s): TCP[¶](#section-11.1-3){.pilcrow}

[]{.break}

Assignee:

:   Name: Jose Javier Garcia Aranda[¶](#section-11.1-4.2.1){.pilcrow}

    Email:
    jose_javier.garcia_aranda\@nokia.com[¶](#section-11.1-4.2.2){.pilcrow}

:   

Contact:

:   Name: Jose Javier Garcia Aranda[¶](#section-11.1-4.4.1){.pilcrow}

    Email:
    jose_javier.garcia_aranda\@nokia.com[¶](#section-11.1-4.4.2){.pilcrow}

:   

[]{.break}

Description:
:   The service associated with this request is in charge of the
    establishment of new Q4S sessions, and during the session, manages
    the handoff to a new protocol phase (Handshake, Negotiation and
    Continuity) as well as sends alerts when measurements do not meet
    the requirements.[¶](#section-11.1-5.2){.pilcrow}
:   

Reference:
:   This document. This service does not use IP-layer broadcast,
    multicast, or anycast communication.[¶](#section-11.1-5.4){.pilcrow}
:   
:::
:::
:::
:::

::: {#sec-12}
::: {#section-12 .section}
## [12.](#section-12){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-12-1){.pilcrow}
:::
:::

::: {#section-13 .section}
## [13.](#section-13){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-13.1 .section}
### [13.1.](#section-13.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC7230\]
:   [Fielding, R., Ed.]{.refAuthor}[ and J. Reschke, Ed.]{.refAuthor},
    [\"Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and
    Routing\"]{.refTitle}, [RFC 7230]{.seriesInfo}, [DOI
    10.17487/RFC7230]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7230>\>.
:   

\[RFC7231\]
:   [Fielding, R., Ed.]{.refAuthor}[ and J. Reschke, Ed.]{.refAuthor},
    [\"Hypertext Transfer Protocol (HTTP/1.1): Semantics and
    Content\"]{.refTitle}, [RFC 7231]{.seriesInfo}, [DOI
    10.17487/RFC7231]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7231>\>.
:   

\[RFC7232\]
:   [Fielding, R., Ed.]{.refAuthor}[ and J. Reschke, Ed.]{.refAuthor},
    [\"Hypertext Transfer Protocol (HTTP/1.1): Conditional
    Requests\"]{.refTitle}, [RFC 7232]{.seriesInfo}, [DOI
    10.17487/RFC7232]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7232>\>.
:   

\[RFC7233\]
:   [Fielding, R., Ed.]{.refAuthor}[, Lafon, Y., Ed.]{.refAuthor}[,
    and J. Reschke, Ed.]{.refAuthor}, [\"Hypertext Transfer Protocol
    (HTTP/1.1): Range Requests\"]{.refTitle}, [RFC 7233]{.seriesInfo},
    [DOI 10.17487/RFC7233]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7233>\>.
:   

\[RFC7234\]
:   [Fielding, R., Ed.]{.refAuthor}[, Nottingham, M., Ed.]{.refAuthor}[,
    and J. Reschke, Ed.]{.refAuthor}, [\"Hypertext Transfer Protocol
    (HTTP/1.1): Caching\"]{.refTitle}, [RFC 7234]{.seriesInfo}, [DOI
    10.17487/RFC7234]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7234>\>.
:   

\[RFC7235\]
:   [Fielding, R., Ed.]{.refAuthor}[ and J. Reschke, Ed.]{.refAuthor},
    [\"Hypertext Transfer Protocol (HTTP/1.1):
    Authentication\"]{.refTitle}, [RFC 7235]{.seriesInfo}, [DOI
    10.17487/RFC7235]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7235>\>.
:   

\[RFC2818\]
:   [Rescorla, E.]{.refAuthor}, [\"HTTP Over TLS\"]{.refTitle}, [RFC
    2818]{.seriesInfo}, [DOI 10.17487/RFC2818]{.seriesInfo}, May 2000,
    \<<https://www.rfc-editor.org/info/rfc2818>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC3986\]
:   [Berners-Lee, T.]{.refAuthor}[, Fielding, R.]{.refAuthor}[, and L.
    Masinter]{.refAuthor}, [\"Uniform Resource Identifier (URI): Generic
    Syntax\"]{.refTitle}, [STD 66]{.seriesInfo}, [RFC
    3986]{.seriesInfo}, [DOI 10.17487/RFC3986]{.seriesInfo}, January
    2005, \<<https://www.rfc-editor.org/info/rfc3986>\>.
:   

\[RFC3629\]
:   [Yergeau, F.]{.refAuthor}, [\"UTF-8, a transformation format of ISO
    10646\"]{.refTitle}, [STD 63]{.seriesInfo}, [RFC 3629]{.seriesInfo},
    [DOI 10.17487/RFC3629]{.seriesInfo}, November 2003,
    \<<https://www.rfc-editor.org/info/rfc3629>\>.
:   

\[RFC5322\]
:   [Resnick, P., Ed.]{.refAuthor}, [\"Internet Message
    Format\"]{.refTitle}, [RFC 5322]{.seriesInfo}, [DOI
    10.17487/RFC5322]{.seriesInfo}, October 2008,
    \<<https://www.rfc-editor.org/info/rfc5322>\>.
:   

\[RFC5234\]
:   [Crocker, D., Ed.]{.refAuthor}[ and P. Overell]{.refAuthor},
    [\"Augmented BNF for Syntax Specifications: ABNF\"]{.refTitle}, [STD
    68]{.seriesInfo}, [RFC 5234]{.seriesInfo}, [DOI
    10.17487/RFC5234]{.seriesInfo}, January 2008,
    \<<https://www.rfc-editor.org/info/rfc5234>\>.
:   

\[RFC6234\]
:   [Eastlake 3rd, D.]{.refAuthor}[ and T. Hansen]{.refAuthor}, [\"US
    Secure Hash Algorithms (SHA and SHA-based HMAC and
    HKDF)\"]{.refTitle}, [RFC 6234]{.seriesInfo}, [DOI
    10.17487/RFC6234]{.seriesInfo}, May 2011,
    \<<https://www.rfc-editor.org/info/rfc6234>\>.
:   

\[RFC8017\]
:   [Moriarty, K., Ed.]{.refAuthor}[, Kaliski, B.]{.refAuthor}[,
    Jonsson, J.]{.refAuthor}[, and A. Rusch]{.refAuthor}, [\"PKCS #1:
    RSA Cryptography Specifications Version 2.2\"]{.refTitle}, [RFC
    8017]{.seriesInfo}, [DOI 10.17487/RFC8017]{.seriesInfo}, November
    2016, \<<https://www.rfc-editor.org/info/rfc8017>\>.
:   

\[RFC3264\]
:   [Rosenberg, J.]{.refAuthor}[ and H. Schulzrinne]{.refAuthor}, [\"An
    Offer/Answer Model with Session Description Protocol
    (SDP)\"]{.refTitle}, [RFC 3264]{.seriesInfo}, [DOI
    10.17487/RFC3264]{.seriesInfo}, June 2002,
    \<<https://www.rfc-editor.org/info/rfc3264>\>.
:   

\[RFC4566\]
:   [Handley, M.]{.refAuthor}[, Jacobson, V.]{.refAuthor}[, and C.
    Perkins]{.refAuthor}, [\"SDP: Session Description
    Protocol\"]{.refTitle}, [RFC 4566]{.seriesInfo}, [DOI
    10.17487/RFC4566]{.seriesInfo}, July 2006,
    \<<https://www.rfc-editor.org/info/rfc4566>\>.
:   
:::

::: {#section-13.2 .section}
### [13.2.](#section-13.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC3550\]
:   [Schulzrinne, H.]{.refAuthor}[, Casner, S.]{.refAuthor}[,
    Frederick, R.]{.refAuthor}[, and V. Jacobson]{.refAuthor}, [\"RTP: A
    Transport Protocol for Real-Time Applications\"]{.refTitle}, [STD
    64]{.seriesInfo}, [RFC 3550]{.seriesInfo}, [DOI
    10.17487/RFC3550]{.seriesInfo}, July 2003,
    \<<https://www.rfc-editor.org/info/rfc3550>\>.
:   

\[RFC0793\]
:   [Postel, J.]{.refAuthor}, [\"Transmission Control
    Protocol\"]{.refTitle}, [STD 7]{.seriesInfo}, [RFC
    793]{.seriesInfo}, [DOI 10.17487/RFC0793]{.seriesInfo}, September
    1981, \<<https://www.rfc-editor.org/info/rfc793>\>.
:   

\[RFC0792\]
:   [Postel, J.]{.refAuthor}, [\"Internet Control Message
    Protocol\"]{.refTitle}, [STD 5]{.seriesInfo}, [RFC
    792]{.seriesInfo}, [DOI 10.17487/RFC0792]{.seriesInfo}, September
    1981, \<<https://www.rfc-editor.org/info/rfc792>\>.
:   

\[QUIC\]
:   [Iyengar, J.]{.refAuthor}[ and M. Thomson]{.refAuthor}, [\"QUIC: A
    UDP-Based Multiplexed and Secure Transport\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-ietf-quic-transport-29]{.seriesInfo}, 9 June 2020,
    \<<https://tools.ietf.org/html/draft-ietf-quic-transport-29>\>.
:   

\[RFC4656\]
:   [Shalunov, S.]{.refAuthor}[, Teitelbaum, B.]{.refAuthor}[,
    Karp, A.]{.refAuthor}[, Boote, J.]{.refAuthor}[, and M.
    Zekauskas]{.refAuthor}, [\"A One-way Active Measurement Protocol
    (OWAMP)\"]{.refTitle}, [RFC 4656]{.seriesInfo}, [DOI
    10.17487/RFC4656]{.seriesInfo}, September 2006,
    \<<https://www.rfc-editor.org/info/rfc4656>\>.
:   

\[RFC5357\]
:   [Hedayat, K.]{.refAuthor}[, Krzanowski, R.]{.refAuthor}[,
    Morton, A.]{.refAuthor}[, Yum, K.]{.refAuthor}[, and J.
    Babiarz]{.refAuthor}, [\"A Two-Way Active Measurement Protocol
    (TWAMP)\"]{.refTitle}, [RFC 5357]{.seriesInfo}, [DOI
    10.17487/RFC5357]{.seriesInfo}, October 2008,
    \<<https://www.rfc-editor.org/info/rfc5357>\>.
:   

\[RFC3261\]
:   [Rosenberg, J.]{.refAuthor}[, Schulzrinne, H.]{.refAuthor}[,
    Camarillo, G.]{.refAuthor}[, Johnston, A.]{.refAuthor}[,
    Peterson, J.]{.refAuthor}[, Sparks, R.]{.refAuthor}[,
    Handley, M.]{.refAuthor}[, and E. Schooler]{.refAuthor}, [\"SIP:
    Session Initiation Protocol\"]{.refTitle}, [RFC 3261]{.seriesInfo},
    [DOI 10.17487/RFC3261]{.seriesInfo}, June 2002,
    \<<https://www.rfc-editor.org/info/rfc3261>\>.
:   

\[RFC0768\]
:   [Postel, J.]{.refAuthor}, [\"User Datagram Protocol\"]{.refTitle},
    [STD 6]{.seriesInfo}, [RFC 768]{.seriesInfo}, [DOI
    10.17487/RFC0768]{.seriesInfo}, August 1980,
    \<<https://www.rfc-editor.org/info/rfc768>\>.
:   

\[RENO\]
:   [Mathis, M.]{.refAuthor}[, Semke, J.]{.refAuthor}[,
    Mahdavi, J.]{.refAuthor}[, and T. Ott]{.refAuthor}, [\"The
    Macroscopic Behavior of the TCP Congestion Avoidance
    Algorithm\"]{.refTitle}, [ACM SIGCOMM Computer Communication Review,
    pp. 67-82]{.refContent}, [DOI 10.1145/263932.264023]{.seriesInfo},
    July 1997, \<<https://doi.org/10.1145/263932.264023>\>.
:   

\[RFC3649\]
:   [Floyd, S.]{.refAuthor}, [\"HighSpeed TCP for Large Congestion
    Windows\"]{.refTitle}, [RFC 3649]{.seriesInfo}, [DOI
    10.17487/RFC3649]{.seriesInfo}, December 2003,
    \<<https://www.rfc-editor.org/info/rfc3649>\>.
:   

\[CUBIC\]
:   [Rhee, I.]{.refAuthor}[, Xu, L.]{.refAuthor}[, and S.
    Ha]{.refAuthor}, [\"CUBIC for Fast Long-Distance
    Networks\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-rhee-tcpm-cubic-02]{.seriesInfo}, 26 August
    2008, \<<https://tools.ietf.org/html/draft-rhee-tcpm-cubic-02>\>.
:   

\[CTCP\]
:   [Sridharan, M.]{.refAuthor}[, Tan, K.]{.refAuthor}[,
    Bansal, D.]{.refAuthor}[, and D. Thaler]{.refAuthor}, [\"Compound
    TCP: A New TCP Congestion Control for High-Speed and Long Distance
    Networks\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-sridharan-tcpm-ctcp-02]{.seriesInfo}, 11
    November 2008,
    \<<https://tools.ietf.org/html/draft-sridharan-tcpm-ctcp-02>\>.
:   
:::
:::

::: {#sec-13}
::: {#section-appendix.a .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

Many people have made comments and suggestions contributing to this
document. In particular, we would like to
thank:[¶](#section-appendix.a-1){.pilcrow}

[Victor Villagra]{.contact-name}, [Sonia Herranz]{.contact-name}, [Clara
Cubillo Pastor]{.contact-name}, [Francisco Duran Pina]{.contact-name},
[Michael Scharf]{.contact-name}, [Jesus Soto Viso]{.contact-name}, and
[Federico Guillen]{.contact-name}.[¶](#section-appendix.a-2){.pilcrow}

Additionally, we want to thank the Spanish Centre for the Development of
Industrial Technology (CDTI) as well as the Spanish Science and Tech
Ministry, which funds this initiative through their innovation
programs.[¶](#section-appendix.a-3){.pilcrow}
:::
:::

::: {#sec-14}
::: {#section-appendix.b .section}
## [Contributors](#name-contributors){.section-name .selfRef} {#name-contributors}

::: {.left dir="auto"}
[Jacobo Perez Lajo]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nokia Spain]{.org}
:::

::: email
Email: <jacobo.perez@nokia.com>
:::

::: {.left dir="auto"}
[Luis Miguel Diaz Vizcaino]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nokia Spain]{.org}
:::

::: email
Email: <Luismi.Diaz@nokia.com>
:::

::: {.left dir="auto"}
[Gonzalo Munoz Fernandez]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nokia Spain]{.org}
:::

::: email
Email: <gonzalo.munoz_fernandez.ext@nokia.com>
:::

::: {.left dir="auto"}
[Manuel Alarcon Granero]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nokia Spain]{.org}
:::

::: email
Email: <manuel.alarcon_granero.ext@nokia.com>
:::

::: {.left dir="auto"}
[Francisco Jose Juan Quintanilla]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nokia Spain]{.org}
:::

::: email
Email: <francisco_jose.juan_quintanilla.ext@nokia.com>
:::

::: {.left dir="auto"}
[Carlos Barcenilla]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Universidad Politecnica de Madrid]{.org}
:::

::: {.left dir="auto"}
[Juan Quemada]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Universidad Politecnica de Madrid]{.org}
:::

::: email
Email: <jquemada@dit.upm.es>
:::

::: {.left dir="auto"}
[Ignacio Maestro]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Tecnalia Research & Innovation]{.org}
:::

::: email
Email: <ignacio.maestro@tecnalia.com>
:::

::: {.left dir="auto"}
[Lara Fajardo Ibañez]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Optiva Media]{.org}
:::

::: email
Email: <lara.fajardo@optivamedia.com>
:::

::: {.left dir="auto"}
[Pablo López Zapico]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Optiva Media]{.org}
:::

::: email
Email: <Pablo.lopez@optivamedia.com>
:::

::: {.left dir="auto"}
[David Muelas Recuenco]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Universidad Autonoma de Madrid]{.org}
:::

::: email
Email: <dav.muelas@uam.es>
:::

::: {.left dir="auto"}
[Jesus Molina Merchan]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Universidad Autonoma de Madrid]{.org}
:::

::: email
Email: <jesus.molina@uam.es>
:::

::: {.left dir="auto"}
[Jorge E. Lopez de Vergara Mendez]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Universidad Autonoma de Madrid]{.org}
:::

::: email
Email: <jorge.lopez_vergara@uam.es>
:::

::: {.left dir="auto"}
[Victor Manuel Maroto Ortega]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Optiva Media]{.org}
:::

::: email
Email: <victor.maroto@optivamedia.com>
:::
:::
:::

::: {#authors-addresses}
::: {#section-appendix.c .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Jose Javier Garcia Aranda]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nokia]{.org}
:::

::: {.left dir="auto"}
[María Tubau 9]{.street-address}
:::

::: {.left dir="auto"}
[28050]{.postal-code} [Madrid]{.locality}
:::

::: {.left dir="auto"}
[Spain]{.country-name}
:::

::: tel
Phone: [+34 91 330 4348](tel:+34%2091%20330%204348){.tel}
:::

::: email
Email: <jose_javier.garcia_aranda@nokia.com>
:::

::: {.left dir="auto"}
[Mónica Cortés]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nokia]{.org}
:::

::: {.left dir="auto"}
[María Tubau 9]{.street-address}
:::

::: {.left dir="auto"}
[28050]{.postal-code} [Madrid]{.locality}
:::

::: {.left dir="auto"}
[Spain]{.country-name}
:::

::: email
Email: <monica.cortes_sack@nokia.com>
:::

::: {.left dir="auto"}
[Joaquín Salvachúa]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Universidad Politecnica de Madrid]{.org}
:::

::: {.left dir="auto"}
[Avenida Complutense 30]{.street-address}
:::

::: {.left dir="auto"}
[28040]{.postal-code} [Madrid]{.locality}
:::

::: {.left dir="auto"}
[Spain]{.country-name}
:::

::: tel
Phone: [+34 91 0672134](tel:+34%2091%200672134){.tel}
:::

::: email
Email: <Joaquin.salvachua@upm.es>
:::

::: {.left dir="auto"}
[Maribel Narganes]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Tecnalia Research & Innovation]{.org}
:::

::: {.left dir="auto"}
[Parque Científico y Tecnológico de Bizkaia]{.extended-address}
:::

::: {.left dir="auto"}
[Astondo Bidea, Edificio 700]{.street-address}
:::

::: {.left dir="auto"}
[E-48160]{.postal-code} [Derio]{.locality} [Bizkaia]{.region}
:::

::: {.left dir="auto"}
[Spain]{.country-name}
:::

::: tel
Phone: [+34 946 430 850](tel:+34%20946%20430%20850){.tel}
:::

::: email
Email: <maribel.narganes@tecnalia.com>
:::

::: {.left dir="auto"}
[Iñaki Martínez-Sarriegui]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Optiva Media]{.org}
:::

::: {.left dir="auto"}
[Edificio Europa II,\
Calle Musgo 2, 1G,\
28023 Madrid\
Spain]{.street-address}
:::

::: tel
Phone: [+34 91 297 7271](tel:+34%2091%20297%207271){.tel}
:::

::: email
Email: <inaki.martinez@optivamedia.com>
:::
:::
:::
