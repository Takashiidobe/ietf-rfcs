  RFC 8823   ACME for S/MIME   April 2021
  ---------- ----------------- ------------
  Melnikov   Informational     \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8823](https://www.rfc-editor.org/rfc/rfc8823){.eref}

Category:
:   Informational

Published:
:   April 2021

ISSN:
:   2070-1721

Author:

:   ::: author
    ::: author-name
    A. Melnikov
    :::

    ::: org
    Isode Ltd
    :::
    :::
:::

# RFC 8823 {#rfcnum}

# Extensions to Automatic Certificate Management Environment for End-User S/MIME Certificates {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document specifies identifiers and challenges required to enable
the Automated Certificate Management Environment (ACME) to issue
certificates for use by email users that want to use
S/⁠MIME.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This document is not an Internet Standards Track specification; it is
published for informational
purposes.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Not all documents approved
by the IESG are candidates for any level of Internet Standard; see
Section 2 of RFC 7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8823>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2021 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Conventions Used in This
    Document](#name-conventions-used-in-this-do){.xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Use of ACME for Issuing End-User S/MIME
    Certificates](#name-use-of-acme-for-issuing-end){.xref}

    -   ::: {#section-toc.1-1.3.2.1}
        [3.1](#section-3.1){.xref}.  [ACME \"Challenge\"
        Email](#name-acme-challenge-email){.xref}
        :::

    -   ::: {#section-toc.1-1.3.2.2}
        [3.2](#section-3.2){.xref}.  [ACME \"Response\"
        Email](#name-acme-response-email){.xref}
        :::

    -   ::: {#section-toc.1-1.3.2.3}
        [3.3](#section-3.3){.xref}.  [Generating Encryption-Only or
        Signing-Only S/MIME
        Certificates](#name-generating-encryption-only-){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Internationalization
    Considerations](#name-internationalization-consid){.xref}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [ACME Identifier
        Type](#name-acme-identifier-type){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [ACME Challenge
        Type](#name-acme-challenge-type){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [References](#name-references){.xref}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Normative
        References](#name-normative-references){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [Informative
        References](#name-informative-references){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [](#section-appendix.a){.xref}[Acknowledgements](#name-acknowledgements){.xref}
    :::

-   ::: {#section-toc.1-1.9}
    [](#section-appendix.b){.xref}[Author\'s
    Address](#name-authors-address){.xref}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

ACME \[[RFC8555](#RFC8555){.xref}\] is a mechanism for automating
certificate management on the Internet. It enables administrative
entities to prove effective control over resources like domain names,
and it automates the process of generating and issuing
certificates.[¶](#section-1-1){.pilcrow}

This document describes an extension to ACME for use by S/MIME. [Section
3](#smime){.xref} defines extensions for issuing end-user S/MIME
\[[RFC8550](#RFC8550){.xref}\] certificates.[¶](#section-1-2){.pilcrow}

This document aims to support both:[¶](#section-1-3){.pilcrow}

1.  [A Mail User Agent (MUA) that has a built-in ACME client that is
    aware of the extension described in this document. (We will call
    such MUAs \"ACME-email-aware\".) Such an MUA can present a nice user
    interface to the user and automate certificate
    issuance.[¶](#section-1-4.1){.pilcrow}]{#section-1-4.1}
2.  [An MUA that is not ACME aware, with a separate ACME client
    implemented in a command-line tool or as a part of a website. While
    S/MIME certificate issuance is not going to be as painless as in the
    case of the ACME-email-aware MUA, the extra burden on a user is
    going to be minimal.[¶](#section-1-4.2){.pilcrow}]{#section-1-4.2}
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Conventions Used in This Document](#name-conventions-used-in-this-do){.section-name .selfRef} {#name-conventions-used-in-this-do}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::

::: {#smime}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Use of ACME for Issuing End-User S/MIME Certificates](#name-use-of-acme-for-issuing-end){.section-name .selfRef} {#name-use-of-acme-for-issuing-end}

ACME \[[RFC8555](#RFC8555){.xref}\] defines a \"dns\" identifier type
that is used to verify that a particular entity has control over a
domain or specific service associated with the domain. In order to be
able to issue end-user S/MIME certificates, ACME needs a new identifier
type that proves ownership of an email
address.[¶](#section-3-1){.pilcrow}

This document defines a new identifier type, \"email\", which
corresponds to an email address. The address can be all ASCII
\[[RFC5321](#RFC5321){.xref}\] or internationalized
\[[RFC6531](#RFC6531){.xref}\]; when an internationalized email address
is used, the domain part can contain both U-labels and A-labels
\[[RFC5890](#RFC5890){.xref}\]. This can be used with S/MIME or another
similar service that requires possession of a certificate tied to an
email address.[¶](#section-3-2){.pilcrow}

Any identifier of type \"email\" in a newOrder request [MUST
NOT]{.bcp14} have a wildcard (\"\*\") character in its
value.[¶](#section-3-3){.pilcrow}

A new challenge type, \"email-reply-00\", is used with the \"email\"
identifier type, which provides proof that an ACME client has control
over an email address.[¶](#section-3-4){.pilcrow}

The process of issuing an S/MIME certificate works as follows. Note that
the ACME client can be a standalone application (if the MUA is not
ACME-email-aware) or can be a component of the
MUA.[¶](#section-3-5){.pilcrow}

1.  [An end user initiates issuance of an S/MIME certificate for one of
    their email addresses. This might be done by using an email client
    UI, by running a command-line tool, by visiting a certificate
    authority web page, etc. This document doesn\'t prescribe a specific
    UI used to initiate S/MIME certificate issuance or where the ACME
    client is located.[¶](#section-3-6.1){.pilcrow}]{#section-3-6.1}

2.  [The ACME-email-aware client component begins the certificate
    issuance process by sending a POST request to the server\'s newOrder
    resource, including the identifier of type \"email\". See [Section
    7.4](https://www.rfc-editor.org/rfc/rfc8555#section-7.4){.relref} of
    \[[RFC8555](#RFC8555){.xref}\] for more
    details.[¶](#section-3-6.2){.pilcrow}]{#section-3-6.2}

3.  ::: {#section-3-6.3}
    The ACME server responds to the POST request, including an
    \"authorizations\" URL for the requested email address. The ACME
    client then retrieves information about the corresponding
    \"email-reply-00\" challenge, as specified in [Section
    7.5](https://www.rfc-editor.org/rfc/rfc8555#section-7.5){.relref} of
    \[[RFC8555](#RFC8555){.xref}\]. The \"token\" field of the
    corresponding challenge object (from the \"challenges\" array)
    contains token-part2. token-part2 should contain at least 128 bits
    of entropy. The \"type\" field of the challenge object is
    \"email-reply-00\". The challenge object also contains the \"from\"
    field, with the email address that would be used in the From header
    field of the \"challenge\" email message (see the next
    step).[¶](#section-3-6.3.1){.pilcrow}

    An example challenge object might look like
    this:[¶](#section-3-6.3.2){.pilcrow}

    ::: {#section-3-6.3.3}
    ``` sourcecode
        {
          "type": "email-reply-00",
          "url": "https://example.com/acme/chall/ABprV_B7yEyA4f",
          "from": "acme-challenge+2i211oi1204310@example.com",
          "token": "DGyRejmCefe7v4NfDGDKfA"
        }
    ```

    [¶](#section-3-6.3.3){.pilcrow}
    :::
    :::

4.  [After responding to the authorization request, the ACME server
    generates another token and a \"challenge\" email message with the
    subject \"ACME: \<token-part1>\", where \<token-part1> is the
    base64url-encoded \[[RFC4648](#RFC4648){.xref}\] form of the token.
    The ACME server [MUST]{.bcp14} generate a fresh token for each
    S/MIME issuance request (authorization request), and token-part1
    [MUST]{.bcp14} contain at least 128 bits of entropy. The
    \"challenge\" email message structure is described in more details
    in [Section
    3.1](#acme-smime-challenge-email){.xref}.[¶](#section-3-6.4){.pilcrow}]{#section-3-6.4}

5.  [The MUA retrieves and parses the \"challenge\" email message. If
    the MUA is ACME-email-aware, it ignores any \"challenge\" email that
    is not expected, e.g., if there is no ACME certificate issuance
    pending. The ACME-email-aware MUA also ignores any \"challenge\"
    email that has the Subject header field that indicates that it is an
    email reply, e.g., a subject starting with the reply prefix
    \"Re:\".[¶](#section-3-6.5){.pilcrow}]{#section-3-6.5}

6.  [The ACME client concatenates \"token-part1\" (received over email)
    and \"token-part2\" (received over HTTPS
    \[[RFC2818](#RFC2818){.xref}\]) to create the ACME \"token\" and
    calculates keyAuthorization (as per [Section
    8.1](https://www.rfc-editor.org/rfc/rfc8555#section-8.1){.relref} of
    \[[RFC8555](#RFC8555){.xref}\]). Then, it returns the
    base64url-encoded SHA-256 digest \[[RFC6234](#RFC6234){.xref}\] of
    the key authorization. The MUA returns the base64url-encoded SHA-256
    digest obtained from the ACME client in the body of a \"response\"
    email message. The \"response\" email message structure is described
    in more details in [Section 3.2](#acme-smime-response-email){.xref}.
    If the MUA is ACME-email-aware, it [MUST NOT]{.bcp14} respond to the
    same \"challenge\" email more than
    once.[¶](#section-3-6.6){.pilcrow}]{#section-3-6.6}

7.  [Once the MUA sends the \"response\" email, the ACME client notifies
    the ACME server by POST to the challenge URL (\"url\"
    field).[¶](#section-3-6.7){.pilcrow}]{#section-3-6.7}

8.  [The ACME client can start polling the authorization URL (using
    POST-as-GET requests) to see if the ACME server received and
    validated the \"response\" email message. (See [Section
    7.5.1](https://www.rfc-editor.org/rfc/rfc8555#section-7.5.1){.relref}
    of \[[RFC8555](#RFC8555){.xref}\] for more details.) If the
    \"status\" field of the challenge switches to \"valid\", then the
    ACME client can proceed with request finalization. The Certificate
    Signing Request (CSR) [MUST]{.bcp14} indicate the exact same set of
    requested identifiers as the initial newOrder request. For an
    identifier of type \"email\", the PKCS#10
    \[[RFC2986](#RFC2986){.xref}\] CSR [MUST]{.bcp14} contain the
    requested email address in an extensionRequest attribute
    \[[RFC2985](#RFC2985){.xref}\] requesting a subjectAltName
    extension. The email address [MUST]{.bcp14} also match the From
    header field value of the \"response\" email
    message.[¶](#section-3-6.8){.pilcrow}]{#section-3-6.8}

9.  [In order to request generation of signing-only or encryption-only
    S/MIME certificates (as opposed to requesting generation of S/MIME
    certificates suitable for both), the CSR needs to include the key
    usage extension (see [Section
    4.4.2](https://www.rfc-editor.org/rfc/rfc8550#section-4.4.2){.relref}
    of \[[RFC8550](#RFC8550){.xref}\]). This is described in more
    details in [Section
    3.3](#acme-smime-sign-or-encrypt-only){.xref}.[¶](#section-3-6.9){.pilcrow}]{#section-3-6.9}

10. [If a request to finalize an order is successful, the ACME server
    will return a 200 (OK) with an updated order object. If the
    certificate is issued successfully, i.e., if the order \"status\" is
    \"valid\", then the ACME client can download the issued S/MIME
    certificate from the URL specified in the \"certificate\"
    field.[¶](#section-3-6.10){.pilcrow}]{#section-3-6.10}

::: {#acme-smime-challenge-email}
::: {#section-3.1 .section}
### [3.1.](#section-3.1){.section-number .selfRef} [ACME \"Challenge\" Email](#name-acme-challenge-email){.section-name .selfRef} {#name-acme-challenge-email}

A \"challenge\" email message [MUST]{.bcp14} have the following
structure:[¶](#section-3.1-1){.pilcrow}

1.  [The Subject header field has the following syntax: \"ACME:
    \<token-part1>\", where the prefix \"ACME:\" is followed by folding
    white space (FWS; see \[[RFC5322](#RFC5322){.xref}\]) and then by
    \<token-part1>, which is the base64url-encoded first part of the
    ACME token that [MUST]{.bcp14} be at least 128 bits long after
    decoding. Due to the recommended 78-octet line-length limit in
    \[[RFC5322](#RFC5322){.xref}\], the subject line can be folded, so
    white spaces (if any) within the \<token-part1> [MUST]{.bcp14} be
    ignored. \[[RFC2231](#RFC2231){.xref}\] encoding of the Subject
    header field [MUST]{.bcp14} be supported, and, when used, only the
    \"UTF-8\" and \"US-ASCII\" charsets are allowed; other charsets
    [MUST NOT]{.bcp14} be used. The US-ASCII charset [SHOULD]{.bcp14} be
    used.[¶](#section-3.1-2.1){.pilcrow}]{#section-3.1-2.1}

2.  [The From header field [MUST]{.bcp14} be the same email address as
    specified in the \"from\" field of the challenge
    object.[¶](#section-3.1-2.2){.pilcrow}]{#section-3.1-2.2}

3.  [The To header field [MUST]{.bcp14} be the email address of the
    entity that requested the S/MIME certificate to be
    generated.[¶](#section-3.1-2.3){.pilcrow}]{#section-3.1-2.3}

4.  [The message [MAY]{.bcp14} contain a Reply-To and/or CC header
    field.[¶](#section-3.1-2.4){.pilcrow}]{#section-3.1-2.4}

5.  [The message [MUST]{.bcp14} include the Auto-Submitted header field
    with the value \"auto-generated\" \[[RFC3834](#RFC3834){.xref}\]. To
    aid in debugging (and, for some implementations, to make automated
    processing easier), the Auto-Submitted header field [SHOULD]{.bcp14}
    include the \"type=acme\" parameter. It [MAY]{.bcp14} include other
    optional parameters, as allowed by the syntax of the Auto-Submitted
    header field.[¶](#section-3.1-2.5){.pilcrow}]{#section-3.1-2.5}

6.  ::: {#section-3.1-2.6}
    In order to prove authenticity of a challenge message, it
    [MUST]{.bcp14} be signed using either DomainKeys Identified Mail
    (DKIM) \[[RFC6376](#RFC6376){.xref}\] or S/MIME
    \[[RFC8551](#RFC8551){.xref}\].[¶](#section-3.1-2.6.1){.pilcrow}

    -   [If DKIM signing is used, the resulting DKIM-Signature header
        field [MUST]{.bcp14} contain the \"h=\" tag that includes at
        least the From, Sender, Reply-To, To, CC, Subject, Date,
        In-Reply-To, References, Message-ID, Auto-Submitted,
        Content-Type, and Content-Transfer-Encoding header fields. The
        DKIM-Signature header field\'s \"h=\" tag [SHOULD]{.bcp14} also
        include the Resent-Date, Resent-From, Resent-To, Resent-Cc,
        List-Id, List-Help, List-Unsubscribe, List-Subscribe, List-Post,
        List-Owner, List-Archive, and List-Unsubscribe-Post header
        fields. The domain from the \"d=\" tag of the DKIM-Signature
        header field [MUST]{.bcp14} be the same as the domain from the
        From header field of the \"challenge\"
        email.[¶](#section-3.1-2.6.2.1){.pilcrow}]{#section-3.1-2.6.2.1}
    -   [If S/MIME signing is used, the certificate corresponding to the
        signer [MUST]{.bcp14} have an rfc822Name subjectAltName
        extension with the value equal to the From header field email
        address of the \"challenge\"
        email.[¶](#section-3.1-2.6.2.2){.pilcrow}]{#section-3.1-2.6.2.2}
    :::

7.  [The body of the challenge message is not used for automated
    processing, so it can be any media type. (However, there are extra
    requirements on S/MIME signing, if used. See below.) Typically, it
    is text/plain or text/html containing a human-readable explanation
    of the purpose of the message. If S/MIME signing is used to prove
    authenticity of the challenge message, then the multipart/signed or
    \"application/pkcs7-mime; smime-type=signed-data;\" media type
    should be used. Either way, it [MUST]{.bcp14} use S/MIME header
    protection.[¶](#section-3.1-2.7){.pilcrow}]{#section-3.1-2.7}

An email client compliant with this specification that detects that a
particular \"challenge\" email fails the validation described above
[MUST]{.bcp14} ignore the challenge and thus will not generate a
\"response\" email. To aid in debugging, such failed validations
[SHOULD]{.bcp14} be logged.[¶](#section-3.1-3){.pilcrow}

Here is an example of an ACME \"challenge\" email (note that, for
simplicity, DKIM-related header fields are not
included).[¶](#section-3.1-4){.pilcrow}

::: {#section-3.1-5.1 .artwork .art-text .alignLeft}
      Auto-Submitted: auto-generated; type=acme
      Date: Sat, 5 Dec 2020 10:08:55 +0100
      Message-ID: <A2299BB.FF7788@example.org>
      From: acme-generator@example.org
      To: alexey@example.com
      Subject: ACME: LgYemJLy3F1LDkiJrdIGbEzyFJyOyf6vBdyZ1TG3sME=
      Content-Type: text/plain
      MIME-Version: 1.0

      This is an automatically generated ACME challenge for email address
      "alexey@example.com". If you haven't requested an S/MIME
      certificate generation for this email address, be very afraid.
      If you did request it, your email client might be able to process
      this request automatically, or you might have to paste the first
      token part into an external program.
:::

[Figure 1](#figure-1){.selfRef}
:::
:::

::: {#acme-smime-response-email}
::: {#section-3.2 .section}
### [3.2.](#section-3.2){.section-number .selfRef} [ACME \"Response\" Email](#name-acme-response-email){.section-name .selfRef} {#name-acme-response-email}

A valid \"response\" email message [MUST]{.bcp14} have the following
structure:[¶](#section-3.2-1){.pilcrow}

1.  [The Subject header field is formed as a reply to the ACME
    \"challenge\" email (see [Section
    3.1](#acme-smime-challenge-email){.xref}). Its syntax is the same as
    that of the challenge message except that it may be prefixed by a
    US-ASCII reply prefix (typically \"Re:\") and FWS (see
    \[[RFC5322](#RFC5322){.xref}\]), as is normal in reply messages.
    When parsing the subject, ACME servers [MUST]{.bcp14} decode
    \[[RFC2231](#RFC2231){.xref}\] encoding (if any), and then they can
    ignore any prefix before the \"ACME:\"
    label.[¶](#section-3.2-2.1){.pilcrow}]{#section-3.2-2.1}

2.  [The From header field contains the email address of the user that
    is requesting S/MIME certificate
    issuance.[¶](#section-3.2-2.2){.pilcrow}]{#section-3.2-2.2}

3.  [The To header field of the response contains the value from the
    Reply-To header field from the challenge message (if set).
    Otherwise, it contains the value from the From header field of the
    challenge message.[¶](#section-3.2-2.3){.pilcrow}]{#section-3.2-2.3}

4.  [The Cc header field is ignored if present in the \"response\" email
    message.[¶](#section-3.2-2.4){.pilcrow}]{#section-3.2-2.4}

5.  [The In-Reply-To header field [SHOULD]{.bcp14} be set to the
    Message-ID header field of the challenge message according to rules
    in [Section
    3.6.4](https://www.rfc-editor.org/rfc/rfc5322#section-3.6.4){.relref}
    of
    \[[RFC5322](#RFC5322){.xref}\].[¶](#section-3.2-2.5){.pilcrow}]{#section-3.2-2.5}

6.  [List-\* header fields
    \[[RFC4021](#RFC4021){.xref}\]\[[RFC8058](#RFC8058){.xref}\]
    [MUST]{.bcp14} be absent (i.e., the reply can\'t come from a mailing
    list).[¶](#section-3.2-2.6){.pilcrow}]{#section-3.2-2.6}

7.  ::: {#section-3.2-2.7}
    The media type of the \"response\" email message is either
    text/plain or multipart/alternative \[[RFC2046](#RFC2046){.xref}\],
    containing text/plain as one of the alternatives. (Note that the
    requirement to support multipart/alternative is to allow use of
    ACME-unaware MUAs, which can\'t always generate pure text/plain,
    e.g., if they reply to a text/html). The text/plain body part
    (whether or not it is inside multipart/alternative) [MUST]{.bcp14}
    contain a block of lines starting with the line \"\-\-\-\--BEGIN
    ACME RESPONSE\-\-\-\--\", followed by one or more lines containing
    the base64url-encoded SHA-256 digest \[[RFC6234](#RFC6234){.xref}\]
    of the key authorization, calculated from concatenated token-part1
    (received over email) and token-part2 (received over HTTPS), as
    outlined in the 5th bullet in [Section 3](#smime){.xref}. (Note that
    each line of text/plain is terminated by CRLF. Bare LFs or bare CRs
    are not allowed.) Due to historical line-length limitations in
    email, line endings (CRLFs) can be freely inserted in the middle of
    the encoded digest, so they [MUST]{.bcp14} be ignored when
    processing it. The final line of the encoded digest is followed by a
    line containing:[¶](#section-3.2-2.7.1){.pilcrow}

    ::: {#section-3.2-2.7.2 .artwork .art-text .alignLeft}
        -----END ACME RESPONSE-----

    [¶](#section-3.2-2.7.2){.pilcrow}
    :::

    Any text before and after this block is ignored. For example, such
    text might explain what to do with it for ACME-unaware
    clients.[¶](#section-3.2-2.7.3){.pilcrow}
    :::

8.  [There is no need to use any Content-Transfer-Encoding other than
    7bit for the text/plain body part. Use of quoted-printable or base64
    in a \"response\" email message is not necessary and should be
    avoided, though it is
    permitted.[¶](#section-3.2-2.8){.pilcrow}]{#section-3.2-2.8}

9.  [In order to prove authenticity of a response message, it
    [MUST]{.bcp14} be DKIM \[[RFC6376](#RFC6376){.xref}\] signed. The
    resulting DKIM-Signature header field [MUST]{.bcp14} contain the
    \"h=\" tag that includes at least the From, Sender, Reply-To, To,
    CC, Subject, Date, In-Reply-To, References, Message-ID,
    Content-Type, and Content-Transfer-Encoding header fields. The
    DKIM-Signature header field\'s \"h=\" tag [SHOULD]{.bcp14} also
    include the Resent-Date, Resent-From, Resent-To, Resent-Cc, List-Id,
    List-Help, List-Unsubscribe, List-Subscribe, List-Post, List-Owner,
    List-Archive, and List-Unsubscribe-Post header fields. The domain
    from the \"d=\" tag of DKIM-Signature header field [MUST]{.bcp14} be
    the same as the domain from the From header field of the
    \"response\"
    email.[¶](#section-3.2-2.9){.pilcrow}]{#section-3.2-2.9}

Here is an example of an ACME \"response\" email (note that, for
simplicity, DKIM-related header fields are not
included).[¶](#section-3.2-3){.pilcrow}

::: {#section-3.2-4.1 .artwork .art-text .alignLeft}
       Date: Sat, 5 Dec 2020 12:01:45 +0100
       Message-ID: <111-22222-3333333@example.com>
       In-Reply-To: <A2299BB.FF7788@example.org>
       From: alexey@example.com
       To: acme-generator@example.org
       Subject: Re: ACME: LgYemJLy3F1LDkiJrdIGbEzyFJyOyf6vBdyZ1TG3sME=
       Content-Type: text/plain
       MIME-Version: 1.0

       -----BEGIN ACME RESPONSE-----
       LoqXcYV8q5ONbJQxbmR7SCTNo3tiAXDfowy
       jxAjEuX0=
       -----END ACME RESPONSE-----
:::

[Figure 2](#figure-2){.selfRef}
:::
:::

::: {#acme-smime-sign-or-encrypt-only}
::: {#section-3.3 .section}
### [3.3.](#section-3.3){.section-number .selfRef} [Generating Encryption-Only or Signing-Only S/MIME Certificates](#name-generating-encryption-only-){.section-name .selfRef} {#name-generating-encryption-only-}

ACME extensions specified in this document can be used to request
signing-only or encryption-only S/MIME
certificates.[¶](#section-3.3-1){.pilcrow}

In order to request signing-only S/MIME certificates, the CSR
[MUST]{.bcp14} include the key usage extension with digitalSignature
and/or nonRepudiation bits set and no other bits
set.[¶](#section-3.3-2){.pilcrow}

In order to request encryption-only S/MIME certificates, the CSR
[MUST]{.bcp14} include the key usage extension with keyEncipherment or
keyAgreement bits set and no other bits
set.[¶](#section-3.3-3){.pilcrow}

Presence of both of the above sets of key usage bits in the CSR, as well
as absence of the key usage extension in the CSR, signals to the ACME
server to issue an S/MIME certificate suitable for both signing and
encryption.[¶](#section-3.3-4){.pilcrow}
:::
:::
:::
:::

::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Internationalization Considerations](#name-internationalization-consid){.section-name .selfRef} {#name-internationalization-consid}

\[[RFC8616](#RFC8616){.xref}\] updated/clarified use of DKIM with
internationalized email addresses \[[RFC6531](#RFC6531){.xref}\]. Please
consult \[[RFC8616](#RFC8616){.xref}\] in regards to any changes that
need to be implemented.[¶](#section-4-1){.pilcrow}

Use of non-ASCII characters in left-hand sides of internationalized
email addresses requires putting internationalized email addresses in
X.509 certificates
\[[RFC8398](#RFC8398){.xref}\].[¶](#section-4-2){.pilcrow}
:::

::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [ACME Identifier Type](#name-acme-identifier-type){.section-name .selfRef} {#name-acme-identifier-type}

IANA has registered a new identifier type in the \"ACME Identifier
Types\" registry defined in [Section
9.7.7](https://www.rfc-editor.org/rfc/rfc8555#section-9.7.7){.relref} of
\[[RFC8555](#RFC8555){.xref}\] with Label \"email\" and a Reference to
this document, \[[RFC5321](#RFC5321){.xref}\], and
\[[RFC6531](#RFC6531){.xref}\]. The new identifier type corresponds to
an (all ASCII) email address \[[RFC5321](#RFC5321){.xref}\] or
internationalized email addresses
\[[RFC6531](#RFC6531){.xref}\].[¶](#section-5.1-1){.pilcrow}
:::

::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [ACME Challenge Type](#name-acme-challenge-type){.section-name .selfRef} {#name-acme-challenge-type}

IANA has registered a new entry in the \"ACME Validation Methods\"
registry defined in [Section
9.7.8](https://www.rfc-editor.org/rfc/rfc8555#section-9.7.8){.relref} of
\[[RFC8555](#RFC8555){.xref}\]. This entry is as
follows:[¶](#section-5.2-1){.pilcrow}

  Label            Identifier Type   ACME   Reference
  ---------------- ----------------- ------ -----------
  email-reply-00   email             Y      RFC 8823

  : [Table 1](#table-1){.selfRef}
:::
:::

::: {#seccons}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

Please see the Security Considerations section of
\[[RFC8555](#RFC8555){.xref}\] for general security considerations
related to the use of ACME. This challenge/response protocol
demonstrates that an entity that controls the private key (corresponding
to the public key in the certificate) also controls the named email
account. The ACME server is confirming that the requested email address
belongs to the entity that requested the certificate, but this makes no
claim to address correctness or fitness for purpose. If such claims are
needed, they must be obtained by some other
mechanism.[¶](#section-6-1){.pilcrow}

The security of the \"email-reply-00\" challenge type depends on the
security of the email system. A third party that can read and reply to
user\'s email messages (by possessing a user\'s password or a secret
derived from it that can give read and reply access, such as \"password
equivalent\" information, or by being given permissions to act on a
user\'s behalf using email delegation features common in some email
systems) can request S/MIME certificates using the protocol specified in
this document and is indistinguishable from the email account owner.
This has several possible implications:[¶](#section-6-2){.pilcrow}

1.  [An entity that compromised an email account would be able to
    request S/MIME certificates using the protocol specified in this
    document, and such entity couldn\'t be distinguished from the
    legitimate email account owner (unless some external sources of
    information are
    consulted).[¶](#section-6-3.1){.pilcrow}]{#section-6-3.1}
2.  [For email addresses with legitimate shared access/control by
    multiple users, any such user would be able to request S/MIME
    certificates using the protocol specified in this document; such
    requests can\'t be attributed to a specific user without consulting
    external systems (such as IMAP/SMTP access
    logs).[¶](#section-6-3.2){.pilcrow}]{#section-6-3.2}
3.  [The protocol specified in this document is not suitable for use
    with email addresses associated with mailing lists
    \[[RFC5321](#RFC5321){.xref}\]. While it is not always possible to
    guarantee that a particular S/MIME certificate request is not from a
    mailing list address, prohibition on inclusion of List-\* header
    fields helps certificate issuers to handle most common
    cases.[¶](#section-6-3.3){.pilcrow}]{#section-6-3.3}

An email system in its turn depends on DNS. A third party that can
manipulate DNS MX records for a domain might be able to redirect an
email and can get (at least temporary) read and reply access to it.
Similar considerations apply to DKIM TXT records in DNS. Use of DNSSEC
by email system administrators is recommended to avoid making it easy to
spoof DNS records affecting an email system. However, use of DNSSEC is
not ubiquitous at the time of publishing of this document, so it is not
required here. Also, many existing systems that rely on verification of
ownership of an email address \-- for example, 2-factor authentication
systems used by banks or traditional certificate issuance systems \--
send email messages to email addresses, expecting the owner to click on
the link supplied in them (or to reply to a message), without requiring
use of DNSSEC. So the risk of not requiring DNSSEC is presumed
acceptable in this document.[¶](#section-6-4){.pilcrow}

An ACME email challenge message can be forged by an attacker. As per
requirements on an ACME-email-aware MUA specified in [Section
3](#smime){.xref}, the MUA will not respond to requests it is not
expecting. Even if the attacker causes the erroneous \"response\" email
to go to an attacker-controlled email address, very little information
is leaked \-- the SHA-256 hash of the key authorization would be leaked,
not the key authorization itself, so no parts of the token or the
account key thumbprint are leaked.[¶](#section-6-5){.pilcrow}

An attacker that can read the \"response\" email has only one chance to
guess the token-part2. Even if the attacker can guess it right, it still
needs to know the ACME account key to be able to make use of the
intercepted SHA-256 hash of the key
authorization.[¶](#section-6-6){.pilcrow}

Also see the Security Considerations section of
\[[RFC6376](#RFC6376){.xref}\] for details on how DKIM depends on the
DNS and the respective vulnerabilities this dependence
has.[¶](#section-6-7){.pilcrow}
:::
:::

::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2046\]
:   [Freed, N.]{.refAuthor} and [N. Borenstein]{.refAuthor},
    [\"Multipurpose Internet Mail Extensions (MIME) Part Two: Media
    Types\"]{.refTitle}, [RFC 2046]{.seriesInfo}, [DOI
    10.17487/RFC2046]{.seriesInfo}, November 1996,
    \<<https://www.rfc-editor.org/info/rfc2046>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC2231\]
:   [Freed, N.]{.refAuthor} and [K. Moore]{.refAuthor}, [\"MIME
    Parameter Value and Encoded Word Extensions: Character Sets,
    Languages, and Continuations\"]{.refTitle}, [RFC 2231]{.seriesInfo},
    [DOI 10.17487/RFC2231]{.seriesInfo}, November 1997,
    \<<https://www.rfc-editor.org/info/rfc2231>\>.
:   

\[RFC2818\]
:   [Rescorla, E.]{.refAuthor}, [\"HTTP Over TLS\"]{.refTitle}, [RFC
    2818]{.seriesInfo}, [DOI 10.17487/RFC2818]{.seriesInfo}, May 2000,
    \<<https://www.rfc-editor.org/info/rfc2818>\>.
:   

\[RFC2985\]
:   [Nystrom, M.]{.refAuthor} and [B. Kaliski]{.refAuthor}, [\"PKCS #9:
    Selected Object Classes and Attribute Types Version
    2.0\"]{.refTitle}, [RFC 2985]{.seriesInfo}, [DOI
    10.17487/RFC2985]{.seriesInfo}, November 2000,
    \<<https://www.rfc-editor.org/info/rfc2985>\>.
:   

\[RFC2986\]
:   [Nystrom, M.]{.refAuthor} and [B. Kaliski]{.refAuthor}, [\"PKCS #10:
    Certification Request Syntax Specification Version
    1.7\"]{.refTitle}, [RFC 2986]{.seriesInfo}, [DOI
    10.17487/RFC2986]{.seriesInfo}, November 2000,
    \<<https://www.rfc-editor.org/info/rfc2986>\>.
:   

\[RFC3834\]
:   [Moore, K.]{.refAuthor}, [\"Recommendations for Automatic Responses
    to Electronic Mail\"]{.refTitle}, [RFC 3834]{.seriesInfo}, [DOI
    10.17487/RFC3834]{.seriesInfo}, August 2004,
    \<<https://www.rfc-editor.org/info/rfc3834>\>.
:   

\[RFC4648\]
:   [Josefsson, S.]{.refAuthor}, [\"The Base16, Base32, and Base64 Data
    Encodings\"]{.refTitle}, [RFC 4648]{.seriesInfo}, [DOI
    10.17487/RFC4648]{.seriesInfo}, October 2006,
    \<<https://www.rfc-editor.org/info/rfc4648>\>.
:   

\[RFC5321\]
:   [Klensin, J.]{.refAuthor}, [\"Simple Mail Transfer
    Protocol\"]{.refTitle}, [RFC 5321]{.seriesInfo}, [DOI
    10.17487/RFC5321]{.seriesInfo}, October 2008,
    \<<https://www.rfc-editor.org/info/rfc5321>\>.
:   

\[RFC5322\]
:   [Resnick, P., Ed.]{.refAuthor}, [\"Internet Message
    Format\"]{.refTitle}, [RFC 5322]{.seriesInfo}, [DOI
    10.17487/RFC5322]{.seriesInfo}, October 2008,
    \<<https://www.rfc-editor.org/info/rfc5322>\>.
:   

\[RFC5890\]
:   [Klensin, J.]{.refAuthor}, [\"Internationalized Domain Names for
    Applications (IDNA): Definitions and Document
    Framework\"]{.refTitle}, [RFC 5890]{.seriesInfo}, [DOI
    10.17487/RFC5890]{.seriesInfo}, August 2010,
    \<<https://www.rfc-editor.org/info/rfc5890>\>.
:   

\[RFC6234\]
:   [Eastlake 3rd, D.]{.refAuthor} and [T. Hansen]{.refAuthor}, [\"US
    Secure Hash Algorithms (SHA and SHA-based HMAC and
    HKDF)\"]{.refTitle}, [RFC 6234]{.seriesInfo}, [DOI
    10.17487/RFC6234]{.seriesInfo}, May 2011,
    \<<https://www.rfc-editor.org/info/rfc6234>\>.
:   

\[RFC6376\]
:   [Crocker, D., Ed.]{.refAuthor}, [Hansen, T., Ed.]{.refAuthor}, and
    [M. Kucherawy, Ed.]{.refAuthor}, [\"DomainKeys Identified Mail
    (DKIM) Signatures\"]{.refTitle}, [STD 76]{.seriesInfo}, [RFC
    6376]{.seriesInfo}, [DOI 10.17487/RFC6376]{.seriesInfo}, September
    2011, \<<https://www.rfc-editor.org/info/rfc6376>\>.
:   

\[RFC6531\]
:   [Yao, J.]{.refAuthor} and [W. Mao]{.refAuthor}, [\"SMTP Extension
    for Internationalized Email\"]{.refTitle}, [RFC 6531]{.seriesInfo},
    [DOI 10.17487/RFC6531]{.seriesInfo}, February 2012,
    \<<https://www.rfc-editor.org/info/rfc6531>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8398\]
:   [Melnikov, A., Ed.]{.refAuthor} and [W. Chuang, Ed.]{.refAuthor},
    [\"Internationalized Email Addresses in X.509
    Certificates\"]{.refTitle}, [RFC 8398]{.seriesInfo}, [DOI
    10.17487/RFC8398]{.seriesInfo}, May 2018,
    \<<https://www.rfc-editor.org/info/rfc8398>\>.
:   

\[RFC8550\]
:   [Schaad, J.]{.refAuthor}, [Ramsdell, B.]{.refAuthor}, and [S.
    Turner]{.refAuthor}, [\"Secure/Multipurpose Internet Mail Extensions
    (S/MIME) Version 4.0 Certificate Handling\"]{.refTitle}, [RFC
    8550]{.seriesInfo}, [DOI 10.17487/RFC8550]{.seriesInfo}, April 2019,
    \<<https://www.rfc-editor.org/info/rfc8550>\>.
:   

\[RFC8551\]
:   [Schaad, J.]{.refAuthor}, [Ramsdell, B.]{.refAuthor}, and [S.
    Turner]{.refAuthor}, [\"Secure/Multipurpose Internet Mail Extensions
    (S/MIME) Version 4.0 Message Specification\"]{.refTitle}, [RFC
    8551]{.seriesInfo}, [DOI 10.17487/RFC8551]{.seriesInfo}, April 2019,
    \<<https://www.rfc-editor.org/info/rfc8551>\>.
:   

\[RFC8555\]
:   [Barnes, R.]{.refAuthor}, [Hoffman-Andrews, J.]{.refAuthor},
    [McCarney, D.]{.refAuthor}, and [J. Kasten]{.refAuthor},
    [\"Automatic Certificate Management Environment
    (ACME)\"]{.refTitle}, [RFC 8555]{.seriesInfo}, [DOI
    10.17487/RFC8555]{.seriesInfo}, March 2019,
    \<<https://www.rfc-editor.org/info/rfc8555>\>.
:   

\[RFC8616\]
:   [Levine, J.]{.refAuthor}, [\"Email Authentication for
    Internationalized Mail\"]{.refTitle}, [RFC 8616]{.seriesInfo}, [DOI
    10.17487/RFC8616]{.seriesInfo}, June 2019,
    \<<https://www.rfc-editor.org/info/rfc8616>\>.
:   
:::

::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC4021\]
:   [Klyne, G.]{.refAuthor} and [J. Palme]{.refAuthor}, [\"Registration
    of Mail and MIME Header Fields\"]{.refTitle}, [RFC
    4021]{.seriesInfo}, [DOI 10.17487/RFC4021]{.seriesInfo}, March 2005,
    \<<https://www.rfc-editor.org/info/rfc4021>\>.
:   

\[RFC8058\]
:   [Levine, J.]{.refAuthor} and [T. Herkula]{.refAuthor}, [\"Signaling
    One-Click Functionality for List Email Headers\"]{.refTitle}, [RFC
    8058]{.seriesInfo}, [DOI 10.17487/RFC8058]{.seriesInfo}, January
    2017, \<<https://www.rfc-editor.org/info/rfc8058>\>.
:   
:::
:::

::: {#section-appendix.a .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

Thank you to [Andreas Schulze]{.contact-name}, [Gerd v.
Egidy]{.contact-name}, [James A. Baker]{.contact-name}, [Ben
Schwartz]{.contact-name}, [Peter Yee]{.contact-name}, [Hilarie
Orman]{.contact-name}, [Michael Jenkins]{.contact-name}, [Barry
Leiba]{.contact-name}, [Fraser Tweedale]{.contact-name}, [Daniel Kahn
Gillmor]{.contact-name}, and [Benjamin Kaduk]{.contact-name} for their
suggestions, comments, and corrections of this
document.[¶](#section-appendix.a-1){.pilcrow}
:::

::: {#authors-addresses}
::: {#section-appendix.b .section}
## [Author\'s Address](#name-authors-address){.section-name .selfRef} {#name-authors-address}

::: {.left dir="auto"}
[Alexey Melnikov]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Isode Ltd]{.org}
:::

::: {.left dir="auto"}
[14 Castle Mews]{.street-address}
:::

::: {.left dir="auto"}
[Hampton, Middlesex]{.locality}
:::

::: {.left dir="auto"}
[TW12 2NP]{.postal-code}
:::

::: {.left dir="auto"}
[United Kingdom]{.country-name}
:::

::: email
Email: <alexey.melnikov@isode.com>
:::
:::
:::
