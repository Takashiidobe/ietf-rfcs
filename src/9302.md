  RFC 9302          LISP Map-Versioning   October 2022
  ----------------- --------------------- --------------
  Iannone, et al.   Standards Track       \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9302](https://www.rfc-editor.org/rfc/rfc9302){.eref}

Obsoletes:
:   [6834](https://www.rfc-editor.org/rfc/rfc6834){.eref}

Category:
:   Standards Track

Published:
:   October 2022

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    L. Iannone
    :::

    ::: org
    Huawei Technologies France
    :::
    :::

    ::: author
    ::: author-name
    D. Saucez
    :::

    ::: org
    Inria
    :::
    :::

    ::: author
    ::: author-name
    O. Bonaventure
    :::

    ::: org
    Universite catholique de Louvain
    :::
    :::
:::

# RFC 9302 {#rfcnum}

# Locator/ID Separation Protocol (LISP) Map-Versioning {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document describes the Locator/ID Separation Protocol (LISP)
Map-Versioning mechanism, which provides in-packet information about
Endpoint-ID-to-Routing-Locator (EID-to-RLOC) mappings used to
encapsulate LISP data packets. This approach is based on associating a
version number to EID-to-RLOC mappings and transporting such a version
number in the LISP-specific header of LISP-encapsulated packets. LISP
Map-Versioning is particularly useful to inform communicating Ingress
Tunnel Routers (ITRs) and Egress Tunnel Routers (ETRs) about
modifications of the mappings used to encapsulate packets. The mechanism
is optional and transparent to implementations not supporting this
feature, since in the LISP-specific header and in the Map Records, bits
used for Map-Versioning can be safely ignored by ITRs and ETRs that do
not support or do not want to use the
mechanism.[¶](#section-abstract-1){.pilcrow}

This document obsoletes RFC 6834, which is the initial experimental
specifications of the mechanisms updated by this
document.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9302>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2022 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Revised BSD License text as described in Section 4.e of the Trust Legal
Provisions and are provided without warranty as described in the Revised
BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.auto .internal
    .xref}.  [Introduction](#name-introduction){.internal .xref}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.auto .internal .xref}.  [Requirements
    Notation](#name-requirements-notation){.internal .xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.auto .internal .xref}.  [Definitions of
    Terms](#name-definitions-of-terms){.internal .xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.auto .internal .xref}.  [LISP-Specific Header and
    Map-Version Numbers](#name-lisp-specific-header-and-ma){.internal
    .xref}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.auto .internal .xref}.  [Map Record and
    Map-Version](#name-map-record-and-map-version){.internal .xref}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.auto .internal .xref}.  [EID-to-RLOC Map-Version
    Number](#name-eid-to-rloc-map-version-num){.internal .xref}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.auto .internal .xref}.  [The Null
        Map-Version](#name-the-null-map-version){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.auto .internal .xref}.  [Dealing with Map-Version
    Numbers](#name-dealing-with-map-version-nu){.internal .xref}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.auto .internal .xref}.  [Handling Dest
        Map-Version Number](#name-handling-dest-map-version-n){.internal
        .xref}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.auto .internal .xref}.  [Handling Source
        Map-Version Number](#name-handling-source-map-version){.internal
        .xref}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.auto .internal .xref}.  [Security
    Considerations](#name-security-considerations){.internal .xref}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.auto .internal .xref}.  [Deployment
    Considerations](#name-deployment-considerations){.internal .xref}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.auto .internal .xref}. [IANA
    Considerations](#name-iana-considerations){.internal .xref}
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.auto .internal
    .xref}. [References](#name-references){.internal .xref}

    -   ::: {#section-toc.1-1.11.2.1}
        [11.1](#section-11.1){.auto .internal .xref}.  [Normative
        References](#name-normative-references){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.11.2.2}
        [11.2](#section-11.2){.auto .internal .xref}.  [Informative
        References](#name-informative-references){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.12}
    [Appendix A](#appendix-A){.auto .internal .xref}.  [Benefits and
    Case Studies for
    Map-Versioning](#name-benefits-and-case-studies-f){.internal .xref}

    -   ::: {#section-toc.1-1.12.2.1}
        [A.1](#appendix-A.1){.auto .internal .xref}.  [Map-Versioning
        and Unidirectional
        Traffic](#name-map-versioning-and-unidirec){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.12.2.2}
        [A.2](#appendix-A.2){.auto .internal .xref}.  [Map-Versioning
        and Interworking](#name-map-versioning-and-interwor){.internal
        .xref}

        -   ::: {#section-toc.1-1.12.2.2.2.1}
            [A.2.1](#appendix-A.2.1){.auto .internal
            .xref}.  [Map-Versioning and
            Proxy-ITRs](#name-map-versioning-and-proxy-it){.internal
            .xref}
            :::

        -   ::: {#section-toc.1-1.12.2.2.2.2}
            [A.2.2](#appendix-A.2.2){.auto .internal
            .xref}.  [Map-Versioning and
            LISP-NAT](#name-map-versioning-and-lisp-nat){.internal
            .xref}
            :::

        -   ::: {#section-toc.1-1.12.2.2.2.3}
            [A.2.3](#appendix-A.2.3){.auto .internal
            .xref}.  [Map-Versioning and
            Proxy-ETRs](#name-map-versioning-and-proxy-et){.internal
            .xref}
            :::
        :::

    -   ::: {#section-toc.1-1.12.2.3}
        [A.3](#appendix-A.3){.auto .internal .xref}.  [RLOC
        Shutdown/Withdraw](#name-rloc-shutdown-withdraw){.internal
        .xref}
        :::
    :::

-   ::: {#section-toc.1-1.13}
    [](#appendix-B){.auto .internal .xref}[Authors\'
    Addresses](#name-authors-addresses){.internal .xref}
    :::
:::
:::

::: {#intro}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

This document describes the Map-Versioning mechanism used to provide
information on changes in the Endpoint-ID-to-Routing-Locator
(EID-to-RLOC) mappings used in the Locator/ID Separation Protocol (LISP)
\[[RFC9300](#RFC9300){.cite .xref}\] \[[RFC9301](#RFC9301){.cite
.xref}\] context to perform packet encapsulation. The mechanism is
totally transparent to Ingress and Egress Tunnel Routers (xTRs) not
supporting or not using such functionality. The architecture of LISP is
described in \[[RFC9299](#RFC9299){.cite .xref}\]. The reader is
expected to be familiar with this introductory
document.[¶](#section-1-1){.pilcrow}

This document obsoletes \[[RFC6834](#RFC6834){.cite .xref}\], which is
the initial experimental specification that describes the mechanisms
updated by this document.[¶](#section-1-2){.pilcrow}

The basic mechanism is to associate a Map-Version number to each LISP
EID-to-RLOC mapping and transport such a version number in the
LISP-specific header. When a mapping changes, a new version number is
assigned to the updated mapping. A change in an EID-to-RLOC mapping can
be a modification in the RLOCs set, such as addition of, removal of, or
change in the priority or weight of one or more
RLOCs.[¶](#section-1-3){.pilcrow}

When Map-Versioning is used, LISP-encapsulated data packets contain the
version number of the two mappings used to select the RLOCs in the outer
header (i.e., both source and destination RLOCs). This information has
two uses:[¶](#section-1-4){.pilcrow}

1.  [Map-Versioning enables the Egress Tunnel Router (ETR) receiving the
    packet to know if the Ingress Tunnel Router (ITR) is using the
    latest mapping version for the destination EID. If this is not the
    case, the ETR can directly send a Map-Request containing the updated
    mapping to the ITR to notify it of the latest version. The ETR can
    also solicit the ITR to trigger a Map-Request to obtain the latest
    mapping by sending a Solicit Map-Request (SMR) message. Both options
    are defined in \[[RFC9301](#RFC9301){.cite
    .xref}\].[¶](#section-1-5.1){.pilcrow}]{#section-1-5.1}
2.  [Map-Versioning enables an ETR receiving the packet to know if it
    has in its EID-to-RLOC Map-Cache the latest mapping for the source
    EID. If this is not the case, a Map-Request can be
    sent.[¶](#section-1-5.2){.pilcrow}]{#section-1-5.2}

Considerations about the deployment of LISP Map-Versioning are discussed
in [Section 9](#considerations){.auto .internal
.xref}.[¶](#section-1-6){.pilcrow}

The benefits of Map-Versioning in some common LISP-related use cases are
discussed in [Appendix A](#benefits){.auto .internal
.xref}.[¶](#section-1-7){.pilcrow}
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Requirements Notation](#name-requirements-notation){.section-name .selfRef} {#name-requirements-notation}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.cite .xref}\]
\[[RFC8174](#RFC8174){.cite .xref}\] when, and only when, they appear in
all capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::

::: {#terms}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Definitions of Terms](#name-definitions-of-terms){.section-name .selfRef} {#name-definitions-of-terms}

This document uses terms already defined in the main LISP specifications
(\[[RFC9300](#RFC9300){.cite .xref}\] and \[[RFC9301](#RFC9301){.cite
.xref}\]). Here, we define the terms that are specific to the
Map-Versioning mechanism. Throughout the whole document, big-endian bit
ordering is used.[¶](#section-3-1){.pilcrow}

[]{.break}

Map-Version number:
:   An unsigned 12-bit integer is assigned to an EID-to-RLOC mapping,
    indicating its version number ([Section 6](#vnum){.auto .internal
    .xref}).[¶](#section-3-2.2){.pilcrow}
:   

Null Map-Version:
:   A Map-Version number with a value of 0x000 (zero), which is used to
    signal that the Map-Version feature is not used and no Map-Version
    number is assigned to the EID-to-RLOC mapping ([Section
    6.1](#sec_null){.auto .internal
    .xref}).[¶](#section-3-2.4){.pilcrow}
:   

Dest Map-Version number:
:   Map-Version of the mapping in the EID-to-RLOC Map-Cache used by the
    ITR to select the RLOC present in the \'Destination Routing
    Locator\' field of the outer IP header of LISP-encapsulated packets
    ([Section 7.1](#dmvn){.auto .internal
    .xref}).[¶](#section-3-2.6){.pilcrow}
:   

Source Map-Version number:
:   Map-Version of the mapping in the EID-to-RLOC Database used by the
    ITR to select the RLOC present in the \'Source Routing Locator\'
    field of the outer IP header of LISP-encapsulated packets ([Section
    7.2](#smvn){.auto .internal .xref}).[¶](#section-3-2.8){.pilcrow}
:   
:::
:::

::: {#lisphdr}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [LISP-Specific Header and Map-Version Numbers](#name-lisp-specific-header-and-ma){.section-name .selfRef} {#name-lisp-specific-header-and-ma}

In order for the versioning approach to work, the LISP-specific header
has to carry both the Source Map-Version number and Dest Map-Version
number. This is done by setting the V-bit in the LISP-specific header as
specified in \[[RFC9300](#RFC9300){.cite .xref}\] and shown in the
example in [Figure 1](#lispshimhdr){.auto .internal .xref}. All
permissible combinations of the flags when the V-bit is set to 1 are
described in \[[RFC9300](#RFC9300){.cite .xref}\]. Not all of the
LISP-encapsulated packets need to carry version numbers. When the V-bit
is set, the LISP-specific header has the following
encoding:[¶](#section-4-1){.pilcrow}

[]{#name-lisp-specific-header-exampl}

::: {#lispshimhdr}
::: {#section-4-2.1 .alignLeft .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |N|L|E|V|I|R|K|K|  Source Map-Version   |   Dest Map-Version    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                 Instance ID/Locator-Status-Bits               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:::

[Figure 1](#figure-1){.selfRef}: [LISP-Specific Header Example When
Map-Versioning Is in Use](#name-lisp-specific-header-exampl){.selfRef}
:::

[]{.break}

Source Map-Version number (12 bits):
:   See [Section 3](#terms){.auto .internal
    .xref}.[¶](#section-4-3.2){.pilcrow}
:   

Dest Map-Version number (12 bits):
:   See [Section 3](#terms){.auto .internal
    .xref}.[¶](#section-4-3.4){.pilcrow}
:   
:::
:::

::: {#vnumpkt}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Map Record and Map-Version](#name-map-record-and-map-version){.section-name .selfRef} {#name-map-record-and-map-version}

To accommodate the mechanism, the Map Records that are transported in
Map-Request/Map-Reply/Map-Register messages need to carry the
Map-Version number as well. For reference, the Map Record (specified in
\[[RFC9301](#RFC9301){.cite .xref}\]) is reported here as an example in
[Figure 2](#maprecord){.auto .internal .xref}. This memo does not change
the operation of Map-Request/Map-Reply/Map-Register messages; they
continue to be used as specified in \[[RFC9301](#RFC9301){.cite
.xref}\].[¶](#section-5-1){.pilcrow}

[]{#name-map-record-format-example}

::: {#maprecord}
::: {#section-5-2.1 .alignLeft .art-text .artwork}
         0                   1                   2                   3
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   |                          Record TTL                           |
    |   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    R   | Locator Count | EID mask-len  | ACT |A|      Reserved         |
    e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    c   | Rsvd  |  Map-Version Number   |       EID-Prefix-AFI          |
    o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    r   |                          EID-Prefix                           |
    d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
    | L +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | o |        Unused Flags     |L|p|R|           Loc-AFI             |
    | c +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  \|                             Locator                           |
    +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:::

[Figure 2](#figure-2){.selfRef}: [Map-Record Format
Example](#name-map-record-format-example){.selfRef}
:::

[]{.break}

Map-Version Number:
:   Map-Version of the mapping contained in the Record. As explained in
    [Section 6.1](#sec_null){.auto .internal .xref}, this field can be
    zero (0), meaning that no Map-Version is associated to the
    mapping.[¶](#section-5-3.2){.pilcrow}
:   

This packet format is backward compatible with xTRs that do not support
Map-Versioning, since they can simply ignore those
bits.[¶](#section-5-4){.pilcrow}

A Map-Server receiving a message with an unexpected Map-Version number,
for instance an old one, [MUST]{.bcp14} silently drop the message and an
appropriate log action [SHOULD]{.bcp14} be
taken.[¶](#section-5-5){.pilcrow}
:::
:::

::: {#vnum}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [EID-to-RLOC Map-Version Number](#name-eid-to-rloc-map-version-num){.section-name .selfRef} {#name-eid-to-rloc-map-version-num}

The EID-to-RLOC Map-Version number consists of an unsigned 12-bit
integer. The version number is assigned on a per-mapping basis, meaning
that different mappings have different version numbers, which are
updated independently. An update in the version number (i.e., a newer
version) [MUST]{.bcp14} consist of an increment of the older version
number (the only exception is for the Null Map-Version as explained in
at the end of [Section 6.1](#sec_null){.auto .internal
.xref}).[¶](#section-6-1){.pilcrow}

The space of version numbers has a circular order where half of the
version numbers are considered greater (i.e., newer) than the current
Map-Version number and the other half of the version numbers are
considered smaller (i.e., older) than the current Map-Version number.
This is basically a serial number on which the arithmetic described in
\[[RFC1982](#RFC1982){.cite .xref}\] applies. The ordering enables
different reactions to \"older\" and \"newer\" Map-Version numbers,
whereby \"older\" numbers are discarded and \"newer\" numbers trigger
Map-Requests (see [Section 7](#dealing){.auto .internal .xref} for
further details). In a formal way, assuming that we have two version
numbers (V1 and V2), both different from the special value Null
Map-Version (see [Section 6.1](#sec_null){.auto .internal .xref}), and
that the numbers are expressed on 12 bits, the following steps
[MUST]{.bcp14} be performed (in the same order shown below) to strictly
define their order:[¶](#section-6-2){.pilcrow}

1.  [V1 = V2 : The Map-Version numbers are the
    same.[¶](#section-6-3.1){.pilcrow}]{#section-6-3.1}

2.  ::: {#section-6-3.2}
    V2 > V1 : if and only if[¶](#section-6-3.2.1){.pilcrow}

    V2 > V1 AND (V2 - V1) \<= 2^(12-1)^[¶](#section-6-3.2.2){.pilcrow}

    OR[¶](#section-6-3.2.3){.pilcrow}

    V1 > V2 AND (V1 - V2) > 2^(12-1)^[¶](#section-6-3.2.4){.pilcrow}
    :::

3.  [V1 > V2 : otherwise.[¶](#section-6-3.3){.pilcrow}]{#section-6-3.3}

Using 12 bits and assuming a Map-Version value of 69, Map-Version
numbers in the range \[70; 69 + 2048\] are greater than 69, while
Map-Version numbers in the range \[69 + 2049; (69 + 4095) mod 4096\] are
smaller than 69.[¶](#section-6-4){.pilcrow}

The initial Map-Version number of a new EID-to-RLOC mapping
[SHOULD]{.bcp14} be assigned randomly, but it [MUST NOT]{.bcp14} be set
to the Null Map-Version value (0x000), because the Null Map-Version
number has a special meaning (see [Section 6.1](#sec_null){.auto
.internal .xref}). Optionally, the initial Map-version number may be
configured.[¶](#section-6-5){.pilcrow}

Upon reboot, an ETR will use mappings configured in its EID-to-RLOC
Database. If those mappings have a Map-Version number, it will be used
according to the mechanisms described in this document. ETRs [MUST
NOT]{.bcp14} automatically generate and assign Map-Version numbers to
mappings in the EID-to-RLOC Database.[¶](#section-6-6){.pilcrow}

::: {#sec_null}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [The Null Map-Version](#name-the-null-map-version){.section-name .selfRef} {#name-the-null-map-version}

The value 0x000 (zero) is a special Map-Version number indicating that
there is actually no version number associated to the EID-to-RLOC
mapping. Such a value is used for special purposes and is named the Null
Map-Version number.[¶](#section-6.1-1){.pilcrow}

Map Records that have a Null Map-Version number indicate that there is
no Map-Version number associated with the mapping. This means that
LISP-encapsulated packets destined to the EID-Prefix referred to by the
Map Record [MUST NOT]{.bcp14} contain any Map-Version numbers (V-bit set
to 0). If an ETR receives LISP-encapsulated packets with the V-bit set,
when the original mapping in the EID-to-RLOC Database has the version
number set to the Null Map-Version value, then those packets
[MUST]{.bcp14} be silently dropped.[¶](#section-6.1-2){.pilcrow}

The Null Map-Version may appear in the LISP-specific header as a Source
Map-Version number ([Section 7.2](#smvn){.auto .internal .xref}). When
the Source Map-Version number is set to the Null Map-Version value, it
means that no map version information is conveyed for the source site.
This means that if a mapping exists for the source EID in the
EID-to-RLOC Map-Cache, then the ETR [MUST NOT]{.bcp14} compare the
received Null Map-Version with the content of the EID-to-RLOC Map-Cache
([Section 7.2](#smvn){.auto .internal
.xref}).[¶](#section-6.1-3){.pilcrow}

The fact that the 0 value has a special meaning for the Map-Version
number implies that, when updating a Map-Version number because of a
change in the mapping, if the next value is 0, then the Map-Version
number [MUST]{.bcp14} be incremented by 2 (i.e., set to 1 (0x001), which
is the next valid value).[¶](#section-6.1-4){.pilcrow}
:::
:::
:::
:::

::: {#dealing}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Dealing with Map-Version Numbers](#name-dealing-with-map-version-nu){.section-name .selfRef} {#name-dealing-with-map-version-nu}

The main idea of using Map-Version numbers is that whenever there is a
change in the mapping (e.g., adding/removing RLOCs, a change in the
weights due to Traffic Engineering policies, or a change in the
priorities) or a LISP site realizes that one or more of its own RLOCs
are no longer reachable from a local perspective (e.g., through IGP or
policy changes), the LISP site updates the mapping and also assigns a
new Map-Version number. Only the latest Map-Version number has to be
considered valid. Mapping updates and their corresponding Map-Version
Number must be managed so that a very old version number will not be
confused as a new version number (because of the circular numbering
space). To this end, simple measures can be taken, like updating a
mapping only when all active traffic is using the latest version, or
waiting a sufficient amount of time to be sure that the mapping in LISP
caches expires, which means waiting at least as long as the mapping Time
To Live (TTL) (as defined in \[[RFC9301](#RFC9301){.cite
.xref}\]).[¶](#section-7-1){.pilcrow}

An ETR receiving a LISP packet with Map-Version numbers checks the
following predicates:[¶](#section-7-2){.pilcrow}

1.  [The ITR that has sent the packet has an up-to-date mapping in its
    EID-to-RLOC Map-Cache for the destination EID and is performing
    encapsulation correctly. See [Section 7.1](#dmvn){.auto .internal
    .xref} for details.[¶](#section-7-3.1){.pilcrow}]{#section-7-3.1}
2.  [In the case of bidirectional traffic, the mapping in the local ETR
    EID-to-RLOC Map-Cache for the source EID is up to date. See [Section
    7.2](#smvn){.auto .internal .xref} for
    details.[¶](#section-7-3.2){.pilcrow}]{#section-7-3.2}

::: {#dmvn}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Handling Dest Map-Version Number](#name-handling-dest-map-version-n){.section-name .selfRef} {#name-handling-dest-map-version-n}

When an ETR receives a packet, the Dest Map-Version number relates to
the mapping for the destination EID for which the ETR is an RLOC. This
mapping is part of the ETR EID-to-RLOC Database. Since the ETR is
authoritative for the mapping, it has the correct and up-to-date Dest
Map-Version number. A check on this version number [MUST]{.bcp14} be
done, where the following cases can arise:[¶](#section-7.1-1){.pilcrow}

1.  [The packet arrives with the same Dest Map-Version number stored in
    the EID-to-RLOC Database. This is the regular case. The ITR sending
    the packet has, in its EID-to-RLOC Map-Cache, an up-to-date mapping.
    No further actions are
    needed.[¶](#section-7.1-2.1){.pilcrow}]{#section-7.1-2.1}
2.  [The packet arrives with a Dest Map-Version number newer (as defined
    in [Section 6](#vnum){.auto .internal .xref}) than the one stored in
    the EID-to-RLOC Database. Since the ETR is authoritative on the
    mapping, meaning that the Map-Version number of its mapping is the
    correct one, the packet carries a version number that is not
    considered valid. Therefore, the packet [MUST]{.bcp14} be silently
    dropped and an appropriate log action [SHOULD]{.bcp14} be
    taken.[¶](#section-7.1-2.2){.pilcrow}]{#section-7.1-2.2}
3.  [The packet arrives with a Dest Map-Version number older (as defined
    in [Section 6](#vnum){.auto .internal .xref}) than the one stored in
    the EID-to-RLOC Database. This means that the ITR sending the packet
    has an old mapping in its EID-to-RLOC Map-Cache containing stale
    information. The ETR [MAY]{.bcp14} choose to normally process the
    encapsulated datagram according to \[[RFC9300](#RFC9300){.cite
    .xref}\]; however, the ITR sending the packet [MUST]{.bcp14} be
    informed that a newer mapping is available, respecting
    rate-limitation policies described in \[[RFC9301](#RFC9301){.cite
    .xref}\]. This is done with a Map-Request message sent back to the
    ITR, as specified in \[[RFC9301](#RFC9301){.cite .xref}\]. One
    feature introduced by Map-Version numbers is the possibility of
    blocking traffic not using the latest mapping. This can happen if an
    ITR is not updating the mapping for which the ETR is authoritative,
    or it might be some form of attack. According to the rate-limitation
    policy defined in \[[RFC9301](#RFC9301){.cite .xref}\] for
    Map-Request messages, after 10 retries, Map-Requests are sent every
    30 seconds; if after the first 10 retries the Dest Map-Version
    number in the packets is not updated, the ETR [SHOULD]{.bcp14} drop
    packets with a stale Map-Version number. Operators can configure
    exceptions to this recommendation, which are outside the scope of
    this document.[¶](#section-7.1-2.3){.pilcrow}]{#section-7.1-2.3}

The rule in the third case [MAY]{.bcp14} be more restrictive. If the
Record TTL of the previous mapping has already expired, all packets
arriving with an old Map-Version [MUST]{.bcp14} be silently dropped
right away without issuing any Map-Request. Such action is permitted
because, if the new mapping with the updated version number has been
unchanged for at least the same amount of time as the Record TTL of the
older mapping, all the entries in the EID-to-RLOC Map-Caches of ITRs
must have expired. Indeed, all ITRs sending traffic should have
refreshed the mapping according to \[[RFC9301](#RFC9301){.cite
.xref}\].[¶](#section-7.1-3){.pilcrow}

It is a protocol violation for LISP-encapsulated packets to contain a
Dest Map-Version number equal to the Null Map-Version number (see
[Section 6.1](#sec_null){.auto .internal
.xref}).[¶](#section-7.1-4){.pilcrow}
:::
:::

::: {#smvn}
::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [Handling Source Map-Version Number](#name-handling-source-map-version){.section-name .selfRef} {#name-handling-source-map-version}

When an ETR receives a packet, the Source Map-Version number relates to
the mapping for the source EID for which the ITR that sent the packet is
authoritative. If the ETR has an entry in its EID-to-RLOC Map-Cache for
the source EID, then a check [MUST]{.bcp14} be performed, and the
following cases can arise:[¶](#section-7.2-1){.pilcrow}

1.  [The packet arrives with the same Source Map-Version number as that
    stored in the EID-to-RLOC Map-Cache. This is the regular case. The
    ETR has in its EID-to-RLOC Map-Cache an up-to-date copy of the
    mapping. No further actions are
    needed.[¶](#section-7.2-2.1){.pilcrow}]{#section-7.2-2.1}
2.  [The packet arrives with a Source Map-Version number newer (as
    defined in [Section 6](#vnum){.auto .internal .xref}) than the one
    stored in the local EID-to-RLOC Map-Cache. This means that the ETR
    has in its EID-to-RLOC Map-Cache a mapping that is stale and needs
    to be updated. A Map-Request [MUST]{.bcp14} be sent to get the new
    mapping for the source EID, respecting rate-limitation policies
    described in \[[RFC9301](#RFC9301){.cite
    .xref}\].[¶](#section-7.2-2.2){.pilcrow}]{#section-7.2-2.2}
3.  [The packet arrives with a Source Map-Version number older (as
    defined in [Section 6](#vnum){.auto .internal .xref}) than the one
    stored in the local EID-to-RLOC Map-Cache. Note that if the mapping
    is already present in the EID-to-RLOC Map-Cache, this means that an
    explicit Map-Request has been sent and a Map-Reply has been received
    from an authoritative source. In this situation, the packet
    [SHOULD]{.bcp14} be silently dropped. Operators can configure
    exceptions to this recommendation, which are outside the scope of
    this document.[¶](#section-7.2-2.3){.pilcrow}]{#section-7.2-2.3}

If the ETR does not have an entry in the EID-to-RLOC Map-Cache for the
source EID, then the Source Map-Version number [MUST]{.bcp14} be
ignored. See [Appendix A.1](#utrf){.auto .internal .xref} for an example
of when this situation can arise.[¶](#section-7.2-3){.pilcrow}
:::
:::
:::
:::

::: {#security}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

This document builds on the specification and operation of the LISP
control and data planes. The Security Considerations of
\[[RFC9300](#RFC9300){.cite .xref}\] and \[[RFC9301](#RFC9301){.cite
.xref}\] apply. As such, Map-Versioning [MUST NOT]{.bcp14} be used over
the public Internet and [MUST]{.bcp14} only be used in trusted and
closed deployments. A thorough security analysis of LISP is documented
in \[[RFC7835](#RFC7835){.cite .xref}\].[¶](#section-8-1){.pilcrow}

Attackers can try to trigger a large number of Map-Requests by simply
forging packets with random Map-Versions. The Map-Requests are rate
limited as described in \[[RFC9301](#RFC9301){.cite .xref}\]. With
Map-Versioning, it is possible to filter packets carrying invalid
version numbers before triggering a Map-Request, thus helping to reduce
the effects of DoS attacks. However, it might not be enough to really
protect against a DDoS attack.[¶](#section-8-2){.pilcrow}

The present memo includes log action to be taken upon certain events. It
is recommended that implementations include mechanisms (which are beyond
the scope of this document) to avoid log resource exhaustion
attacks.[¶](#section-8-3){.pilcrow}

The specifications in the present memo are relatively conservative in
the sense that, in several cases, the packets are dropped. Such an
approach is the outcome of considerations made about the possible risks
that control plane actions that are triggered by the data plane can be
used to carry out attacks. There exists corner cases where, even with an
invalid Map-Version number, forwarding the packet might be potentially
considered safe; however, system manageability has been given priority
with respect to having to put in place more machinery to be able to
identify legitimate traffic.[¶](#section-8-4){.pilcrow}
:::
:::

::: {#considerations}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Deployment Considerations](#name-deployment-considerations){.section-name .selfRef} {#name-deployment-considerations}

LISP requires multiple ETRs within the same site to provide identical
mappings for a given EID-Prefix. Map-Versioning does not require
additional synchronization mechanisms. Clearly, all the ETRs have to
reply with the same mapping, including the same Map-Version number;
otherwise, there can be an inconsistency that creates additional control
traffic, instabilities, and traffic
disruptions.[¶](#section-9-1){.pilcrow}

There are two ways Map-Versioning is helpful with respect to
synchronization. On the one hand, assigning version numbers to mappings
helps in debugging, since quick checks on the consistency of the
mappings on different ETRs can be done by looking at the Map-Version
number. On the other hand, Map-Versioning can be used to control the
traffic toward ETRs that announce the latest
mapping.[¶](#section-9-2){.pilcrow}

As an example, let\'s consider the topology of [Figure
3](#vtraffic){.auto .internal .xref} where ITR A.1 of Domain A is
sending unidirectional traffic to Domain B, while A.2 of Domain A
exchanges bidirectional traffic with Domain B. In particular, ITR A.2
sends traffic to ETR B, and ETR A.2 receives traffic from ITR
B.[¶](#section-9-3){.pilcrow}

[]{#name-example-topology}

::: {#vtraffic}
::: {#section-9-4.1 .alignLeft .art-text .artwork}
     +-----------------+              +-----------------+
     | Domain A        |              | Domain B        |
     |       +---------+              |                 |
     |       | ITR A.1 |---           |                 |
     |       +---------+    \         +---------+       |
     |                 |      ------->| ETR B   |       |
     |                 |      ------->|         |       |
     |       +---------+    /         |         |       |
     |       | ITR A.2 |---      -----| ITR B   |       |
     |       |         |       /      +---------+       |
     |       | ETR A.2 |<-----        |                 |
     |       +---------+              |                 |
     |                 |              |                 |
     +-----------------+              +-----------------+
:::

[Figure 3](#figure-3){.selfRef}: [Example
Topology](#name-example-topology){.selfRef}
:::

Obviously, in the case of Map-Versioning, both ITR A.1 and ITR A.2 of
Domain A must use the same value; otherwise, the ETR of Domain B will
start to send Map-Requests.[¶](#section-9-5){.pilcrow}

The same problem can, however, arise without Map-Versioning, for
instance, if the two ITRs of Domain A send different
Locator-Status-Bits. In this case, either the traffic is disrupted if
ETR B does not verify reachability or if ETR B will start sending
Map-Requests to confirm each change in
reachability.[¶](#section-9-6){.pilcrow}

So far, LISP does not provide any specific synchronization mechanism but
assumes that synchronization is provided by configuring the different
xTRs consistently. The same applies for Map-Versioning. If in the future
any synchronization mechanism is provided, Map-Versioning will take
advantage of it automatically, since it is included in the Map Record
format, as described in [Section 5](#vnumpkt){.auto .internal
.xref}.[¶](#section-9-7){.pilcrow}
:::
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-10-1){.pilcrow}
:::

::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-11.1 .section}
### [11.1.](#section-11.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC9300\]
:   [Farinacci, D.]{.refAuthor}, [Fuller, V.]{.refAuthor},
    [Meyer, D.]{.refAuthor}, [Lewis, D.]{.refAuthor}, and [A. Cabellos,
    Ed.]{.refAuthor}, [\"The Locator/ID Separation Protocol
    (LISP)\"]{.refTitle}, [RFC 9300]{.seriesInfo}, [DOI
    10.17487/RFC9300]{.seriesInfo}, October 2022,
    \<<https://www.rfc-editor.org/info/rfc9300>\>.
:   

\[RFC9301\]
:   [Farinacci, D.]{.refAuthor}, [Maino, F.]{.refAuthor},
    [Fuller, V.]{.refAuthor}, and [A. Cabellos, Ed.]{.refAuthor},
    [\"Locator/ID Separation Protocol (LISP) Control
    Plane\"]{.refTitle}, [RFC 9301]{.seriesInfo}, [DOI
    10.17487/RFC9301]{.seriesInfo}, October 2022,
    \<<https://www.rfc-editor.org/info/rfc9301>\>.
:   
:::

::: {#section-11.2 .section}
### [11.2.](#section-11.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC1982\]
:   [Elz, R.]{.refAuthor} and [R. Bush]{.refAuthor}, [\"Serial Number
    Arithmetic\"]{.refTitle}, [RFC 1982]{.seriesInfo}, [DOI
    10.17487/RFC1982]{.seriesInfo}, August 1996,
    \<<https://www.rfc-editor.org/info/rfc1982>\>.
:   

\[RFC6832\]
:   [Lewis, D.]{.refAuthor}, [Meyer, D.]{.refAuthor},
    [Farinacci, D.]{.refAuthor}, and [V. Fuller]{.refAuthor},
    [\"Interworking between Locator/ID Separation Protocol (LISP) and
    Non-LISP Sites\"]{.refTitle}, [RFC 6832]{.seriesInfo}, [DOI
    10.17487/RFC6832]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6832>\>.
:   

\[RFC6834\]
:   [Iannone, L.]{.refAuthor}, [Saucez, D.]{.refAuthor}, and [O.
    Bonaventure]{.refAuthor}, [\"Locator/ID Separation Protocol (LISP)
    Map-Versioning\"]{.refTitle}, [RFC 6834]{.seriesInfo}, [DOI
    10.17487/RFC6834]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6834>\>.
:   

\[RFC7835\]
:   [Saucez, D.]{.refAuthor}, [Iannone, L.]{.refAuthor}, and [O.
    Bonaventure]{.refAuthor}, [\"Locator/ID Separation Protocol (LISP)
    Threat Analysis\"]{.refTitle}, [RFC 7835]{.seriesInfo}, [DOI
    10.17487/RFC7835]{.seriesInfo}, April 2016,
    \<<https://www.rfc-editor.org/info/rfc7835>\>.
:   

\[RFC9299\]
:   [Cabellos, A.]{.refAuthor} and [D. Saucez, Ed.]{.refAuthor}, [\"An
    Architectural Introduction to the Locator/ID Separation Protocol
    (LISP)\"]{.refTitle}, [RFC 9299]{.seriesInfo}, [DOI
    10.17487/RFC9299]{.seriesInfo}, October 2022,
    \<<https://www.rfc-editor.org/info/rfc9299>\>.
:   
:::
:::

::: {#benefits}
::: {#appendix-A .section}
## [Appendix A.](#appendix-A){.section-number .selfRef} [Benefits and Case Studies for Map-Versioning](#name-benefits-and-case-studies-f){.section-name .selfRef} {#name-benefits-and-case-studies-f}

In the following sections, we provide more discussion on various aspects
and uses of Map-Versioning. Security observations are grouped in
[Section 8](#security){.auto .internal
.xref}.[¶](#appendix-A-1){.pilcrow}

::: {#utrf}
::: {#appendix-A.1 .section}
### [A.1.](#appendix-A.1){.section-number .selfRef} [Map-Versioning and Unidirectional Traffic](#name-map-versioning-and-unidirec){.section-name .selfRef} {#name-map-versioning-and-unidirec}

When using Map-Versioning, the LISP-specific header carries two
Map-Version numbers for both source and destination mappings. This can
raise the question on what will happen in the case of unidirectional
flows, for instance, in the case presented in [Figure
4](#utraffic){.auto .internal .xref}, since the LISP specifications do
not mandate that the ETR have a mapping from the source
EID.[¶](#appendix-A.1-1){.pilcrow}

[]{#name-unidirectional-traffic-betw}

::: {#utraffic}
::: {#appendix-A.1-2.1 .alignLeft .art-text .artwork}
     +-----------------+            +-----------------+
     | Domain A        |            | Domain B        |
     |       +---------+            +---------+       |
     |       | ITR A   |----------->| ETR B   |       |
     |       +---------+            +---------+       |
     |                 |            |                 |
     +-----------------+            +-----------------+
:::

[Figure 4](#figure-4){.selfRef}: [Unidirectional Traffic between LISP
Domains](#name-unidirectional-traffic-betw){.selfRef}
:::

An ITR is able to put both the source and destination version numbers in
the LISP-specific header since the Source Map-Version number is in its
database, while the Dest Map-Version number is in its
cache.[¶](#appendix-A.1-3){.pilcrow}

The ETR checks only the Dest Map-Version number, ignoring the Source
Map-Version number as specified in the final sentence of [Section
7.2](#smvn){.auto .internal .xref}.[¶](#appendix-A.1-4){.pilcrow}
:::
:::

::: {#appendix-A.2 .section}
### [A.2.](#appendix-A.2){.section-number .selfRef} [Map-Versioning and Interworking](#name-map-versioning-and-interwor){.section-name .selfRef} {#name-map-versioning-and-interwor}

Map-Versioning is compatible with the LISP interworking between LISP and
non-LISP sites as defined in \[[RFC6832](#RFC6832){.cite .xref}\]. LISP
interworking defines three techniques to allow communication LISP sites
and non-LISP sites, namely: Proxy-ITR, LISP-NAT, and Proxy-ETR. The
following text describes how Map-Versioning relates to these three
mechanisms.[¶](#appendix-A.2-1){.pilcrow}

::: {#pitr}
::: {#appendix-A.2.1 .section}
#### [A.2.1.](#appendix-A.2.1){.section-number .selfRef} [Map-Versioning and Proxy-ITRs](#name-map-versioning-and-proxy-it){.section-name .selfRef} {#name-map-versioning-and-proxy-it}

The purpose of the Proxy-ITR (PITR) is to encapsulate traffic
originating in a non-LISP site in order to deliver the packet to one of
the ETRs of the LISP site (cf. [Figure 5](#fpitr){.auto .internal
.xref}). This case is very similar to the unidirectional traffic case
described in [Appendix A.1](#utrf){.auto .internal .xref}; hence,
similar rules apply.[¶](#appendix-A.2.1-1){.pilcrow}

[]{#name-unidirectional-traffic-from}

::: {#fpitr}
::: {#appendix-A.2.1-2.1 .alignLeft .art-text .artwork}
     +----------+                             +-------------+
     | LISP     |                             | non-LISP    |
     | Domain A |                             | Domain B    |
     |  +-------+        +-----------+        |             |
     |  | ETR A |<-------| Proxy-ITR |<-------|             |
     |  +-------+        +-----------+        |             |
     |          |                             |             |
     +----------+                             +-------------+
:::

[Figure 5](#figure-5){.selfRef}: [Unidirectional Traffic from Non-LISP
Domain to LISP Domain](#name-unidirectional-traffic-from){.selfRef}
:::

The main difference is that a Proxy-ITR does not have any mapping, since
it just encapsulates packets arriving from the non-LISP site, and thus
cannot provide a Source Map-Version. In this case, the Proxy-ITR will
just put the Null Map-Version value as the Source Map-Version number,
while the receiving ETR will ignore the
field.[¶](#appendix-A.2.1-3){.pilcrow}

With this setup, LISP Domain A is able to check whether the PITR is
using the latest mapping. In the Dest Map-Version Number of the
LISP-specific header, the Proxy-ITR will put the version number of the
mapping it is using for encapsulation; the ETR A can use such value as
defined in [Section 7.1](#dmvn){.auto .internal
.xref}.[¶](#appendix-A.2.1-4){.pilcrow}
:::
:::

::: {#lispnat}
::: {#appendix-A.2.2 .section}
#### [A.2.2.](#appendix-A.2.2){.section-number .selfRef} [Map-Versioning and LISP-NAT](#name-map-versioning-and-lisp-nat){.section-name .selfRef} {#name-map-versioning-and-lisp-nat}

The LISP-NAT mechanism is based on address translation from non-routable
EIDs to routable EIDs and does not involve any form of encapsulation. As
such, Map-Versioning does not apply in this
case.[¶](#appendix-A.2.2-1){.pilcrow}
:::
:::

::: {#petr}
::: {#appendix-A.2.3 .section}
#### [A.2.3.](#appendix-A.2.3){.section-number .selfRef} [Map-Versioning and Proxy-ETRs](#name-map-versioning-and-proxy-et){.section-name .selfRef} {#name-map-versioning-and-proxy-et}

The purpose of the Proxy-ETR (PETR) is to decapsulate traffic
originating in a LISP site in order to deliver the packet to the
non-LISP site (cf. [Figure 6](#fpetr){.auto .internal .xref}). One of
the main reasons to deploy PETRs is to bypass Unicast Reverse Path
Forwarding checks on the domain.[¶](#appendix-A.2.3-1){.pilcrow}

[]{#name-unidirectional-traffic-from-}

::: {#fpetr}
::: {#appendix-A.2.3-2.1 .alignLeft .art-text .artwork}
     +----------+                             +-------------+
     | LISP     |                             | non-LISP    |
     | Domain A |                             | Domain B    |
     |  +-------+        +-----------+        |             |
     |  | ITR A |------->| Proxy-ETR |------->|             |
     |  +-------+        +-----------+        |             |
     |          |                             |             |
     +----------+                             +-------------+
:::

[Figure 6](#figure-6){.selfRef}: [Unidirectional Traffic from LISP
Domain to Non-LISP Domain](#name-unidirectional-traffic-from-){.selfRef}
:::

A Proxy-ETR does not have any mapping, since it just decapsulates
packets arriving from the LISP site. In this case, the ITR can
interchangeably put a Map-Version value or the Null Map-Version value as
the Dest Map-Version number, since the receiving Proxy-ETR will ignore
the field.[¶](#appendix-A.2.3-3){.pilcrow}

With this setup, the Proxy-ETR, by looking at the Source Map-Version
Number, is able to check whether the mapping of the source EID has
changed. This is useful to perform source RLOC validation. In the
example above, traffic coming from the LISP domain has to be LISP
encapsulated with a source address being an RLOC of the domain. The
Proxy-ETR can retrieve the mapping associated to the LISP domain and
check if incoming LISP-encapsulated traffic is arriving from a valid
RLOC. A change in the RLOC-Set that can be used as source addresses can
be signaled via the version number, with the Proxy-ETR able to request
the latest mapping if necessary as described in [Section
7.2](#smvn){.auto .internal .xref}.[¶](#appendix-A.2.3-4){.pilcrow}
:::
:::
:::

::: {#shutdown}
::: {#appendix-A.3 .section}
### [A.3.](#appendix-A.3){.section-number .selfRef} [RLOC Shutdown/Withdraw](#name-rloc-shutdown-withdraw){.section-name .selfRef} {#name-rloc-shutdown-withdraw}

Map-Versioning can also be used to perform a graceful shutdown or to
withdraw a specific RLOC. This is achieved by simply issuing a new
mapping, with an updated Map-Version number where the specific RLOC to
be shut down is withdrawn or announced as unreachable (via the R-bit in
the Map Record; see \[[RFC9301](#RFC9301){.cite .xref}\]) but without
actually turning it off.[¶](#appendix-A.3-1){.pilcrow}

Upon updating the mapping, the RLOC will receive less and less traffic
because remote LISP sites will request the updated mapping and see that
it is disabled. At least one TTL, plus a little time for traffic
transit, after the mapping is updated, it should be safe to shut down
the RLOC gracefully, because all sites actively using the mapping should
have been updated.[¶](#appendix-A.3-2){.pilcrow}

Note that a change in ETR for a flow can result in the reordering of the
packet in the flow just as any other routing change could cause
reordering.[¶](#appendix-A.3-3){.pilcrow}
:::
:::
:::
:::

::: {#authors-addresses}
::: {#appendix-B .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Luigi Iannone]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Huawei Technologies France]{.org}
:::

::: email
Email: <luigi.iannone@huawei.com>
:::

::: {.left dir="auto"}
[Damien Saucez]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Inria]{.org}
:::

::: {.left dir="auto"}
[2004 route des Lucioles - BP 93]{.street-address}
:::

::: {.left dir="auto"}
[Sophia Antipolis]{.locality}
:::

::: {.left dir="auto"}
[France]{.country-name}
:::

::: email
Email: <damien.saucez@inria.fr>
:::

::: {.left dir="auto"}
[Olivier Bonaventure]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Universite catholique de Louvain]{.org}
:::

::: email
Email: <olivier.bonaventure@uclouvain.be>
:::
:::
:::
