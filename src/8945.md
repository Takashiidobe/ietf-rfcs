  RFC 8945         DNS TSIG          November 2020
  ---------------- ----------------- ---------------
  Dupont, et al.   Standards Track   \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8945](https://www.rfc-editor.org/rfc/rfc8945){.eref}

STD:
:   93

Obsoletes:
:   [2845](https://www.rfc-editor.org/rfc/rfc2845){.eref},
    [4635](https://www.rfc-editor.org/rfc/rfc4635){.eref}

Category:
:   Standards Track

Published:
:   November 2020

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    F. Dupont
    :::

    ::: org
    ISC
    :::
    :::

    ::: author
    ::: author-name
    S. Morris
    :::

    ::: org
    Unaffiliated
    :::
    :::

    ::: author
    ::: author-name
    P. Vixie
    :::

    ::: org
    Farsight
    :::
    :::

    ::: author
    ::: author-name
    D. Eastlake 3rd
    :::

    ::: org
    Futurewei
    :::
    :::

    ::: author
    ::: author-name
    O. Gudmundsson
    :::

    ::: org
    Cloudflare
    :::
    :::

    ::: author
    ::: author-name
    B. Wellington
    :::

    ::: org
    Akamai
    :::
    :::
:::

# RFC 8945 {#rfcnum}

# Secret Key Transaction Authentication for DNS (TSIG) {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document describes a protocol for transaction-level authentication
using shared secrets and one-way hashing. It can be used to authenticate
dynamic updates to a DNS zone as coming from an approved client or to
authenticate responses as coming from an approved name
server.[¶](#section-abstract-1){.pilcrow}

No recommendation is made here for distributing the shared secrets; it
is expected that a network administrator will statically configure name
servers and clients using some out-of-band
mechanism.[¶](#section-abstract-2){.pilcrow}

This document obsoletes RFCs 2845 and
4635.[¶](#section-abstract-3){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8945>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2020 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}

This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November 10,
2008. The person(s) controlling the copyright in some of this material
may not have granted the IETF Trust the right to allow modifications of
such material outside the IETF Standards Process. Without obtaining an
adequate license from the person(s) controlling the copyright in such
materials, this document may not be modified outside the IETF Standards
Process, and derivative works of it may not be created outside the IETF
Standards Process, except to format it for publication as an RFC or to
translate it into languages other than
English.[¶](#section-boilerplate.2-3){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Background](#name-background){.xref}[¶](#section-toc.1-1.1.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.2}
        [1.2](#section-1.2){.xref}.  [Protocol
        Overview](#name-protocol-overview){.xref}[¶](#section-toc.1-1.1.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.3}
        [1.3](#section-1.3){.xref}.  [Document
        History](#name-document-history){.xref}[¶](#section-toc.1-1.1.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Key
    Words](#name-key-words){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Assigned
    Numbers](#name-assigned-numbers){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [TSIG RR
    Format](#name-tsig-rr-format){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [TSIG RR
        Type](#name-tsig-rr-type){.xref}[¶](#section-toc.1-1.4.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [TSIG Record
        Format](#name-tsig-record-format){.xref}[¶](#section-toc.1-1.4.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [MAC
        Computation](#name-mac-computation){.xref}[¶](#section-toc.1-1.4.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.3.2.1}
            [4.3.1](#section-4.3.1){.xref}.  [Request
            MAC](#name-request-mac){.xref}[¶](#section-toc.1-1.4.2.3.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.3.2.2}
            [4.3.2](#section-4.3.2){.xref}.  [DNS
            Message](#name-dns-message){.xref}[¶](#section-toc.1-1.4.2.3.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.3.2.3}
            [4.3.3](#section-4.3.3){.xref}.  [TSIG
            Variables](#name-tsig-variables){.xref}[¶](#section-toc.1-1.4.2.3.2.3.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Protocol
    Details](#name-protocol-details){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [Generation of TSIG on
        Requests](#name-generation-of-tsig-on-reque){.xref}[¶](#section-toc.1-1.5.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [Server Processing of
        Request](#name-server-processing-of-reques){.xref}[¶](#section-toc.1-1.5.2.2.1){.pilcrow}

        -   ::: {#section-toc.1-1.5.2.2.2.1}
            [5.2.1](#section-5.2.1){.xref}.  [Key Check and Error
            Handling](#name-key-check-and-error-handlin){.xref}[¶](#section-toc.1-1.5.2.2.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.5.2.2.2.2}
            [5.2.2](#section-5.2.2){.xref}.  [MAC Check and Error
            Handling](#name-mac-check-and-error-handlin){.xref}[¶](#section-toc.1-1.5.2.2.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.5.2.2.2.3}
            [5.2.3](#section-5.2.3){.xref}.  [Time Check and Error
            Handling](#name-time-check-and-error-handli){.xref}[¶](#section-toc.1-1.5.2.2.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.5.2.2.2.4}
            [5.2.4](#section-5.2.4){.xref}.  [Truncation Check and Error
            Handling](#name-truncation-check-and-error-){.xref}[¶](#section-toc.1-1.5.2.2.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.xref}.  [Generation of TSIG on
        Answers](#name-generation-of-tsig-on-answe){.xref}[¶](#section-toc.1-1.5.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.5.2.3.2.1}
            [5.3.1](#section-5.3.1){.xref}.  [TSIG on TCP
            Connections](#name-tsig-on-tcp-connections){.xref}[¶](#section-toc.1-1.5.2.3.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.5.2.3.2.2}
            [5.3.2](#section-5.3.2){.xref}.  [Generation of TSIG on
            Error
            Returns](#name-generation-of-tsig-on-error){.xref}[¶](#section-toc.1-1.5.2.3.2.2.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.5.2.4}
        [5.4](#section-5.4){.xref}.  [Client Processing of
        Answer](#name-client-processing-of-answer){.xref}[¶](#section-toc.1-1.5.2.4.1){.pilcrow}

        -   ::: {#section-toc.1-1.5.2.4.2.1}
            [5.4.1](#section-5.4.1){.xref}.  [Key Error
            Handling](#name-key-error-handling){.xref}[¶](#section-toc.1-1.5.2.4.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.5.2.4.2.2}
            [5.4.2](#section-5.4.2){.xref}.  [MAC Error
            Handling](#name-mac-error-handling){.xref}[¶](#section-toc.1-1.5.2.4.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.5.2.4.2.3}
            [5.4.3](#section-5.4.3){.xref}.  [Time Error
            Handling](#name-time-error-handling){.xref}[¶](#section-toc.1-1.5.2.4.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.5.2.4.2.4}
            [5.4.4](#section-5.4.4){.xref}.  [Truncation Error
            Handling](#name-truncation-error-handling){.xref}[¶](#section-toc.1-1.5.2.4.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.5.2.5}
        [5.5](#section-5.5){.xref}.  [Special Considerations for
        Forwarding
        Servers](#name-special-considerations-for-){.xref}[¶](#section-toc.1-1.5.2.5.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Algorithms and
    Identifiers](#name-algorithms-and-identifiers){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [TSIG Truncation
    Policy](#name-tsig-truncation-policy){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Shared
    Secrets](#name-shared-secrets){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [Issue Fixed in This
        Document](#name-issue-fixed-in-this-documen){.xref}[¶](#section-toc.1-1.10.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Why Not
        DNSSEC?](#name-why-not-dnssec){.xref}[¶](#section-toc.1-1.10.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}

    -   ::: {#section-toc.1-1.11.2.1}
        [11.1](#section-11.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.11.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.11.2.2}
        [11.2](#section-11.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.11.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.12}
    [](#section-appendix.a){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.13}
    [](#section-appendix.b){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Background](#name-background){.section-name .selfRef} {#name-background}

The Domain Name System (DNS) (\[[RFC1034](#RFC1034){.xref}\]
\[[RFC1035](#RFC1035){.xref}\]) is a replicated hierarchical distributed
database system that provides information fundamental to Internet
operations, such as name-to-address translation and mail-handling
information.[¶](#section-1.1-1){.pilcrow}

This document specifies use of a message authentication code (MAC),
generated using certain keyed hash functions, to provide an efficient
means of point-to-point authentication and integrity checking for DNS
transactions. Such transactions include DNS update requests and
responses for which this can provide a lightweight alternative to the
secure DNS dynamic update protocol described by
\[[RFC3007](#RFC3007){.xref}\].[¶](#section-1.1-2){.pilcrow}

A further use of this mechanism is to protect zone transfers. In this
case, the data covered would be the whole zone transfer including any
glue records sent. The protocol described by DNSSEC
(\[[RFC4033](#RFC4033){.xref}\], \[[RFC4034](#RFC4034){.xref}\],
\[[RFC4035](#RFC4035){.xref}\]) does not protect glue records and
unsigned records.[¶](#section-1.1-3){.pilcrow}

The authentication mechanism proposed here provides a simple and
efficient authentication between clients and servers, by using shared
secret keys to establish a trust relationship between two entities. Such
keys must be protected in a manner similar to private keys, lest a third
party masquerade as one of the intended parties (by forging the MAC).
The proposal is unsuitable for general server-to-server authentication
and for servers that speak with many other servers, since key management
would become unwieldy with the number of shared keys going up
quadratically. But it is suitable for many resolvers on hosts that only
talk to a few recursive servers.[¶](#section-1.1-4){.pilcrow}
:::

::: {#section-1.2 .section}
### [1.2.](#section-1.2){.section-number .selfRef} [Protocol Overview](#name-protocol-overview){.section-name .selfRef} {#name-protocol-overview}

Secret Key Transaction Authentication makes use of signatures on
messages sent between the parties involved (e.g., resolver and server).
These are known as \"transaction signatures\", or TSIG. For historical
reasons, in this document, they are referred to as message
authentication codes (MACs).[¶](#section-1.2-1){.pilcrow}

Use of TSIG presumes prior agreement between the two parties involved
(e.g., resolver and server) as to any algorithm and key to be used. The
way that this agreement is reached is outside the scope of the
document.[¶](#section-1.2-2){.pilcrow}

A DNS message exchange involves the sending of a query and the receipt
of one of more DNS messages in response. For the query, the MAC is
calculated based on the hash of the contents and the agreed TSIG key.
The MAC for the response is similar but also includes the MAC of the
query as part of the calculation. Where a response comprises multiple
packets, the calculation of the MAC associated with the second and
subsequent packets includes in its inputs the MAC for the preceding
packet. In this way, it is possible to detect any interruption in the
packet sequence, although not its premature
termination.[¶](#section-1.2-3){.pilcrow}

The MAC is contained in a TSIG resource record included in the
additional section of the DNS message.[¶](#section-1.2-4){.pilcrow}
:::

::: {#section-1.3 .section}
### [1.3.](#section-1.3){.section-number .selfRef} [Document History](#name-document-history){.section-name .selfRef} {#name-document-history}

TSIG was originally specified by \[[RFC2845](#RFC2845){.xref}\]. In
2017, two name server implementations strictly following that document
(and the related \[[RFC4635](#RFC4635){.xref}\]) were discovered to have
security problems related to this feature
(\[[CVE-2017-3142](#CVE-2017-3142){.xref}\],
\[[CVE-2017-3143](#CVE-2017-3143){.xref}\],
\[[CVE-2017-11104](#CVE-2017-11104){.xref}\]). The implementations were
fixed, but to avoid similar problems in the future, the two documents
were updated and merged, producing this revised specification for
TSIG.[¶](#section-1.3-1){.pilcrow}

While TSIG implemented according to this RFC provides for enhanced
security, there are no changes in interoperability. TSIG on the wire is
still the same mechanism described in \[[RFC2845](#RFC2845){.xref}\];
only the checking semantics have been changed. See [Section
10.1](#issuesfixed){.xref} for further
details.[¶](#section-1.3-2){.pilcrow}
:::
:::

::: {#keywords}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Key Words](#name-key-words){.section-name .selfRef} {#name-key-words}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::
:::

::: {#numbers}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Assigned Numbers](#name-assigned-numbers){.section-name .selfRef} {#name-assigned-numbers}

This document defines the following Resource Record (RR) type and
associated value:[¶](#section-3-1){.pilcrow}

-   [TSIG (250)[¶](#section-3-2.1){.pilcrow}]{#section-3-2.1}

In addition, the document also defines the following DNS RCODEs and
associated names:[¶](#section-3-3){.pilcrow}

-   [16 (BADSIG)[¶](#section-3-4.1){.pilcrow}]{#section-3-4.1}
-   [17 (BADKEY)[¶](#section-3-4.2){.pilcrow}]{#section-3-4.2}
-   [18 (BADTIME)[¶](#section-3-4.3){.pilcrow}]{#section-3-4.3}
-   [22 (BADTRUNC)[¶](#section-3-4.4){.pilcrow}]{#section-3-4.4}

(See [Section
2.3](https://www.rfc-editor.org/rfc/rfc6895#section-2.3){.relref} of
\[[RFC6895](#RFC6895){.xref}\] concerning the assignment of the value 16
to BADSIG.)[¶](#section-3-5){.pilcrow}

These RCODES may appear within the \"Error\" field of a TSIG
RR.[¶](#section-3-6){.pilcrow}
:::
:::

::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [TSIG RR Format](#name-tsig-rr-format){.section-name .selfRef} {#name-tsig-rr-format}

::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [TSIG RR Type](#name-tsig-rr-type){.section-name .selfRef} {#name-tsig-rr-type}

To provide secret key authentication, we use an RR type whose mnemonic
is TSIG and whose type code is 250. TSIG is a meta-RR and [MUST
NOT]{.bcp14} be cached. TSIG RRs are used for authentication between DNS
entities that have established a shared secret key. TSIG RRs are
dynamically computed to cover a particular DNS transaction and are not
DNS RRs in the usual sense.[¶](#section-4.1-1){.pilcrow}

As the TSIG RRs are related to one DNS request/response, there is no
value in storing or retransmitting them; thus, the TSIG RR is discarded
once it has been used to authenticate a DNS
message.[¶](#section-4.1-2){.pilcrow}
:::

::: {#format}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [TSIG Record Format](#name-tsig-record-format){.section-name .selfRef} {#name-tsig-record-format}

The fields of the TSIG RR are described below. All multi-octet integers
in the record are sent in network byte order (see [Section
2.3.2](https://www.rfc-editor.org/rfc/rfc1035#section-2.3.2){.relref} of
\[[RFC1035](#RFC1035){.xref}\]).[¶](#section-4.2-1){.pilcrow}

[]{.break}

NAME:

:   The name of the key used, in domain name syntax. The name should
    reflect the names of the hosts and uniquely identify the key among a
    set of keys these two hosts may share at any given time. For
    example, if hosts A.site.example and B.example.net share a key,
    possibilities for the key name include \<id>.A.site.example,
    \<id>.B.example.net, and \<id>.A.site.example.B.example.net. It
    should be possible for more than one key to be in simultaneous use
    among a set of interacting hosts. This allows for periodic key
    rotation as per best operational practices, as well as algorithm
    agility as indicated by
    \[[RFC7696](#RFC7696){.xref}\].[¶](#section-4.2-2.2.1){.pilcrow}

    The name may be used as a local index to the key involved, but it is
    recommended that it be globally unique. Where a key is just shared
    between two hosts, its name actually need only be meaningful to
    them, but it is recommended that the key name be mnemonic and
    incorporate the names of participating agents or resources as
    suggested above.[¶](#section-4.2-2.2.2){.pilcrow}

:   

TYPE:
:   This [MUST]{.bcp14} be TSIG (250: Transaction
    SIGnature).[¶](#section-4.2-2.4){.pilcrow}
:   

CLASS:
:   This [MUST]{.bcp14} be ANY.[¶](#section-4.2-2.6){.pilcrow}
:   

TTL:
:   This [MUST]{.bcp14} be 0.[¶](#section-4.2-2.8){.pilcrow}
:   

RDLENGTH:
:   (variable)[¶](#section-4.2-2.10){.pilcrow}
:   

RDATA:
:   The RDATA for a TSIG RR consists of a number of fields, described
    below:[¶](#section-4.2-2.12){.pilcrow}
:   

::: {#section-4.2-3 .artwork .art-text .alignLeft}
                             1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        /                         Algorithm Name                        /
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                                                               |
        |          Time Signed          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                               |            Fudge              |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |          MAC Size             |                               /
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+             MAC               /
        /                                                               /
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |          Original ID          |            Error              |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |          Other Len            |                               /
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+           Other Data          /
        /                                                               /
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-4.2-3){.pilcrow}
:::

The contents of the RDATA fields are:[¶](#section-4.2-4){.pilcrow}

[]{.break}

Algorithm Name:
:   an octet sequence identifying the TSIG algorithm in the domain name
    syntax. (Allowed names are listed in [Table
    3](#allowed-algorithms){.xref}.) The name is stored in the DNS name
    wire format as described in \[[RFC1034](#RFC1034){.xref}\]. As per
    \[[RFC3597](#RFC3597){.xref}\], this name [MUST NOT]{.bcp14} be
    compressed.[¶](#section-4.2-5.2){.pilcrow}
:   

Time Signed:
:   an unsigned 48-bit integer containing the time the message was
    signed as seconds since 00:00 on 1970-01-01 UTC, ignoring leap
    seconds.[¶](#section-4.2-5.4){.pilcrow}
:   

Fudge:
:   an unsigned 16-bit integer specifying the allowed time difference in
    seconds permitted in the Time Signed
    field.[¶](#section-4.2-5.6){.pilcrow}
:   

MAC Size:
:   an unsigned 16-bit integer giving the length of the MAC field in
    octets. Truncation is indicated by a MAC Size less than the size of
    the keyed hash produced by the algorithm specified by the Algorithm
    Name.[¶](#section-4.2-5.8){.pilcrow}
:   

MAC:
:   a sequence of octets whose contents are defined by the TSIG
    algorithm used, possibly truncated as specified by the MAC Size. The
    length of this field is given by the MAC Size. Calculation of the
    MAC is detailed in [Section
    4.3](#mac_computation){.xref}.[¶](#section-4.2-5.10){.pilcrow}
:   

Original ID:
:   an unsigned 16-bit integer holding the message ID of the original
    request message. For a TSIG RR on a request, it is set equal to the
    DNS message ID. In a TSIG attached to a response \-- or in cases
    such as the forwarding of a dynamic update request \-- the field
    contains the ID of the original DNS
    request.[¶](#section-4.2-5.12){.pilcrow}
:   

Error:
:   in responses, an unsigned 16-bit integer containing the extended
    RCODE covering TSIG processing. In requests, this [MUST]{.bcp14} be
    zero.[¶](#section-4.2-5.14){.pilcrow}
:   

Other Len:
:   an unsigned 16-bit integer specifying the length of the Other Data
    field in octets.[¶](#section-4.2-5.16){.pilcrow}
:   

Other Data:
:   additional data relevant to the TSIG record. In responses, this will
    be empty (i.e., Other Len will be zero) unless the content of the
    Error field is BADTIME, in which case it will be a 48-bit unsigned
    integer containing the server\'s current time as the number of
    seconds since 00:00 on 1970-01-01 UTC, ignoring leap seconds (see
    [Section 5.2.3](#time_check){.xref}). This document assigns no
    meaning to its contents in requests.[¶](#section-4.2-5.18){.pilcrow}
:   
:::
:::

::: {#mac_computation}
::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [MAC Computation](#name-mac-computation){.section-name .selfRef} {#name-mac-computation}

When generating or verifying the contents of a TSIG record, the data
listed in the rest of this section are passed, in the order listed
below, as input to MAC computation. The data are passed in network byte
order or wire format, as appropriate and are fed into the hashing
function as a continuous octet sequence with no interfield separator or
padding.[¶](#section-4.3-1){.pilcrow}

::: {#section-4.3.1 .section}
#### [4.3.1.](#section-4.3.1){.section-number .selfRef} [Request MAC](#name-request-mac){.section-name .selfRef} {#name-request-mac}

Only included in the computation of a MAC for a response message (or the
first message in a multi-message response), the validated request MAC
[MUST]{.bcp14} be included in the MAC computation. If the request MAC
failed to validate, an unsigned error message [MUST]{.bcp14} be returned
instead ([Section
5.3.2](#on_error){.xref}).[¶](#section-4.3.1-1){.pilcrow}

The request\'s MAC, comprising the following fields, is digested in wire
format:[¶](#section-4.3.1-2){.pilcrow}

[]{#name-requests-mac}

::: {#mac-field}
  Field      Type                      Description
  ---------- ------------------------- ------------------------
  MAC Size   Unsigned 16-bit integer   in network byte order
  MAC Data   octet sequence            exactly as transmitted

  : [Table 1](#table-1){.selfRef}: [Request\'s
  MAC](#name-requests-mac){.selfRef}
:::

Special considerations apply to the TSIG calculation for the second and
subsequent messages in a response that consists of multiple DNS messages
(e.g., a zone transfer). These are described in [Section
5.3.1](#tcp){.xref}.[¶](#section-4.3.1-4){.pilcrow}
:::

::: {#section-4.3.2 .section}
#### [4.3.2.](#section-4.3.2){.section-number .selfRef} [DNS Message](#name-dns-message){.section-name .selfRef} {#name-dns-message}

In the MAC computation, the whole/complete DNS message in wire format is
used.[¶](#section-4.3.2-1){.pilcrow}

When creating an outgoing message, the TSIG is based on the message
content before the TSIG RR has been added to the additional section and
before the DNS Message Header\'s ARCOUNT has been incremented to include
the TSIG RR.[¶](#section-4.3.2-2){.pilcrow}

When verifying an incoming message, the TSIG is checked against the
message after the TSIG RR has been removed, the ARCOUNT decremented, and
the message ID replaced by the original message ID from the TSIG if
those IDs differ. (This could happen, for example, when forwarding a
dynamic update request.)[¶](#section-4.3.2-3){.pilcrow}
:::

::: {#section-4.3.3 .section}
#### [4.3.3.](#section-4.3.3){.section-number .selfRef} [TSIG Variables](#name-tsig-variables){.section-name .selfRef} {#name-tsig-variables}

Also included in the digest is certain information present in the TSIG
RR. Adding this data provides further protection against an attempt to
interfere with the message.[¶](#section-4.3.3-1){.pilcrow}

[]{#name-tsig-variables-2}

::: {#tisg-field-names}
  Source       Field Name       Notes
  ------------ ---------------- ------------------------------------
  TSIG RR      NAME             Key name, in canonical wire format
  TSIG RR      CLASS            [MUST]{.bcp14} be ANY
  TSIG RR      TTL              [MUST]{.bcp14} be 0
  TSIG RDATA   Algorithm Name   in canonical wire format
  TSIG RDATA   Time Signed      in network byte order
  TSIG RDATA   Fudge            in network byte order
  TSIG RDATA   Error            in network byte order
  TSIG RDATA   Other Len        in network byte order
  TSIG RDATA   Other Data       exactly as transmitted

  : [Table 2](#table-2){.selfRef}: [TSIG
  Variables](#name-tsig-variables-2){.selfRef}
:::

The RR RDLENGTH and RDATA MAC Size are not included in the input to MAC
computation, since they are not guaranteed to be knowable before the MAC
is generated.[¶](#section-4.3.3-3){.pilcrow}

The Original ID field is not included in this section, as it has already
been substituted for the message ID in the DNS header and
hashed.[¶](#section-4.3.3-4){.pilcrow}

For each label type, there must be a defined \"Canonical wire format\"
that specifies how to express a label in an unambiguous way. For label
type 00, this is defined in [Section
6.2](https://www.rfc-editor.org/rfc/rfc4034#section-6.2){.relref} of
\[[RFC4034](#RFC4034){.xref}\]. The use of label types other than 00 is
not defined for this specification.[¶](#section-4.3.3-5){.pilcrow}

::: {#section-4.3.3.1 .section}
##### [4.3.3.1.](#section-4.3.3.1){.section-number .selfRef} [Time Values Used in TSIG Calculations](#name-time-values-used-in-tsig-ca){.section-name .selfRef} {#name-time-values-used-in-tsig-ca}

The data digested includes the two timer values in the TSIG header in
order to defend against replay attacks. If this were not done, an
attacker could replay old messages but update the Time Signed and Fudge
fields to make the message look new. The two fields are collectively
named \"TSIG Timers\", and for the purpose of MAC calculation, they are
hashed in their wire format, in the following order: first Time Signed,
then Fudge.[¶](#section-4.3.3.1-1){.pilcrow}
:::
:::
:::
:::
:::

::: {#details}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Protocol Details](#name-protocol-details){.section-name .selfRef} {#name-protocol-details}

::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [Generation of TSIG on Requests](#name-generation-of-tsig-on-reque){.section-name .selfRef} {#name-generation-of-tsig-on-reque}

Once the outgoing record has been constructed, the client performs the
keyed hash (Hashed Message Authentication Code (HMAC)) computation,
appends a TSIG record with the calculated MAC to the additional section
(incrementing the ARCOUNT to reflect the additional RR), and transmits
the request to the server. This TSIG record [MUST]{.bcp14} be the only
TSIG RR in the message and [MUST]{.bcp14} be the last record in the
additional data section. The client [MUST]{.bcp14} store the MAC and the
key name from the request while awaiting an
answer.[¶](#section-5.1-1){.pilcrow}

The digest components for a request are:[¶](#section-5.1-2){.pilcrow}

-   [DNS Message
    (request)[¶](#section-5.1-3.1){.pilcrow}]{#section-5.1-3.1}
-   [TSIG Variables
    (request)[¶](#section-5.1-3.2){.pilcrow}]{#section-5.1-3.2}
:::

::: {#request_processing}
::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [Server Processing of Request](#name-server-processing-of-reques){.section-name .selfRef} {#name-server-processing-of-reques}

If an incoming message contains a TSIG record, it [MUST]{.bcp14} be the
last record in the additional section. Multiple TSIG records are not
allowed. If multiple TSIG records are detected or a TSIG record is
present in any other position, the DNS message is dropped and a response
with RCODE 1 (FORMERR) [MUST]{.bcp14} be returned. Upon receipt of a
message with exactly one correctly placed TSIG RR, a copy of the TSIG RR
is stored and the TSIG RR is removed from the DNS message and
decremented out of the DNS message header\'s
ARCOUNT.[¶](#section-5.2-1){.pilcrow}

If the TSIG RR cannot be interpreted, the server [MUST]{.bcp14} regard
the message as corrupt and return a FORMERR to the server. Otherwise,
the server is [REQUIRED]{.bcp14} to return a TSIG RR in the
response.[¶](#section-5.2-2){.pilcrow}

To validate the received TSIG RR, the server [MUST]{.bcp14} perform the
following checks in the following order:[¶](#section-5.2-3){.pilcrow}

1.  [Check key[¶](#section-5.2-4.1){.pilcrow}]{#section-5.2-4.1}
2.  [Check MAC[¶](#section-5.2-4.2){.pilcrow}]{#section-5.2-4.2}
3.  [Check time values[¶](#section-5.2-4.3){.pilcrow}]{#section-5.2-4.3}
4.  [Check truncation
    policy[¶](#section-5.2-4.4){.pilcrow}]{#section-5.2-4.4}

::: {#section-5.2.1 .section}
#### [5.2.1.](#section-5.2.1){.section-number .selfRef} [Key Check and Error Handling](#name-key-check-and-error-handlin){.section-name .selfRef} {#name-key-check-and-error-handlin}

If a non-forwarding server does not recognize the key or algorithm used
by the client (or recognizes the algorithm but does not implement it),
the server [MUST]{.bcp14} generate an error response with RCODE 9
(NOTAUTH) and TSIG ERROR 17 (BADKEY). This response [MUST]{.bcp14} be
unsigned as specified in [Section 5.3.2](#on_error){.xref}. The server
[SHOULD]{.bcp14} log the error. (Special considerations apply to
forwarding servers; see [Section
5.5](#forwarding){.xref}.)[¶](#section-5.2.1-1){.pilcrow}
:::

::: {#section-5.2.2 .section}
#### [5.2.2.](#section-5.2.2){.section-number .selfRef} [MAC Check and Error Handling](#name-mac-check-and-error-handlin){.section-name .selfRef} {#name-mac-check-and-error-handlin}

Using the information in the TSIG, the server [MUST]{.bcp14} verify the
MAC by doing its own calculation and comparing the result with the MAC
received. If the MAC fails to verify, the server [MUST]{.bcp14} generate
an error response as specified in [Section 5.3.2](#on_error){.xref} with
RCODE 9 (NOTAUTH) and TSIG ERROR 16 (BADSIG). This response
[MUST]{.bcp14} be unsigned, as specified in [Section
5.3.2](#on_error){.xref}. The server [SHOULD]{.bcp14} log the
error.[¶](#section-5.2.2-1){.pilcrow}

::: {#trunc}
::: {#section-5.2.2.1 .section}
##### [5.2.2.1.](#section-5.2.2.1){.section-number .selfRef} [MAC Truncation](#name-mac-truncation){.section-name .selfRef} {#name-mac-truncation}

When space is at a premium and the strength of the full length of a MAC
is not needed, it is reasonable to truncate the keyed hash and use the
truncated value for authentication. HMAC SHA-1 truncated to 96 bits is
an option available in several IETF protocols, including IPsec and TLS.
However, while this option is kept for backwards compatibility, it may
not provide a security level appropriate for all cases in the modern
environment. In these cases, it is preferable to use a hashing algorithm
such as SHA-256-128, SHA-384-192, or SHA-512-256
\[[RFC4868](#RFC4868){.xref}\].[¶](#section-5.2.2.1-1){.pilcrow}

Processing of a truncated MAC follows these
rules:[¶](#section-5.2.2.1-2){.pilcrow}

[]{.break}

If the MAC Size field is greater than the keyed hash output length:
:   This case [MUST NOT]{.bcp14} be generated and, if received,
    [MUST]{.bcp14} cause the DNS message to be dropped and RCODE 1
    (FORMERR) to be returned.[¶](#section-5.2.2.1-3.2){.pilcrow}
:   

If the MAC Size field equals the keyed hash output length:
:   The entire keyed hash output is present and
    used.[¶](#section-5.2.2.1-3.4){.pilcrow}
:   

If the MAC Size field is less than the larger of 10 (octets) and half the length of the hash function in use:
:   With the exception of certain TSIG error messages described in
    [Section 5.3.2](#on_error){.xref}, where it is permitted that the
    MAC Size be zero, this case [MUST NOT]{.bcp14} be generated and, if
    received, [MUST]{.bcp14} cause the DNS message to be dropped and
    RCODE 1 (FORMERR) to be returned.[¶](#section-5.2.2.1-3.6){.pilcrow}
:   

Otherwise:
:   This is sent when the signer has truncated the keyed hash output to
    an allowable length, as described in \[[RFC2104](#RFC2104){.xref}\],
    taking initial octets and discarding trailing octets. TSIG
    truncation can only be to an integral number of octets. On receipt
    of a DNS message with truncation thus indicated, the locally
    calculated MAC is similarly truncated, and only the truncated values
    are compared for authentication. The request MAC used when
    calculating the TSIG MAC for a reply is the truncated request
    MAC.[¶](#section-5.2.2.1-3.8){.pilcrow}
:   
:::
:::
:::

::: {#time_check}
::: {#section-5.2.3 .section}
#### [5.2.3.](#section-5.2.3){.section-number .selfRef} [Time Check and Error Handling](#name-time-check-and-error-handli){.section-name .selfRef} {#name-time-check-and-error-handli}

If the server time is outside the time interval specified by the request
(which is the Time Signed value plus/minus the Fudge value), the server
[MUST]{.bcp14} generate an error response with RCODE 9 (NOTAUTH) and
TSIG ERROR 18 (BADTIME). The server [SHOULD]{.bcp14} also cache the most
recent Time Signed value in a message generated by a key and
[SHOULD]{.bcp14} return BADTIME if a message received later has an
earlier Time Signed value. A response indicating a BADTIME error
[MUST]{.bcp14} be signed by the same key as the request. It
[MUST]{.bcp14} include the client\'s current time in the Time Signed
field, the server\'s current time (an unsigned 48-bit integer) in the
Other Data field, and 6 in the Other Len field. This is done so that the
client can verify a message with a BADTIME error without the
verification failing due to another BADTIME error. In addition, the
Fudge field [MUST]{.bcp14} be set to the fudge value received from the
client. The data signed is specified in [Section
5.3.2](#on_error){.xref}. The server [SHOULD]{.bcp14} log the
error.[¶](#section-5.2.3-1){.pilcrow}

Caching the most recent Time Signed value and rejecting requests with an
earlier one could lead to valid messages being rejected if transit
through the network led to UDP packets arriving in a different order to
the one in which they were sent. Implementations should be aware of this
possibility and be prepared to deal with it, e.g., by retransmitting the
rejected request with a new TSIG once outstanding requests have
completed or the time given by their Time Signed value plus the Fudge
value has passed. If implementations do retry requests in these cases, a
limit [SHOULD]{.bcp14} be placed on the maximum number of
retries.[¶](#section-5.2.3-2){.pilcrow}
:::
:::

::: {#trunc_check}
::: {#section-5.2.4 .section}
#### [5.2.4.](#section-5.2.4){.section-number .selfRef} [Truncation Check and Error Handling](#name-truncation-check-and-error-){.section-name .selfRef} {#name-truncation-check-and-error-}

If a TSIG is received with truncation that is permitted per [Section
5.2.2.1](#trunc){.xref} but the MAC is too short for the local policy in
force, an RCODE 9 (NOTAUTH) and TSIG ERROR 22 (BADTRUNC) [MUST]{.bcp14}
be returned. The server [SHOULD]{.bcp14} log the
error.[¶](#section-5.2.4-1){.pilcrow}
:::
:::
:::
:::

::: {#answers}
::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [Generation of TSIG on Answers](#name-generation-of-tsig-on-answe){.section-name .selfRef} {#name-generation-of-tsig-on-answe}

When a server has generated a response to a signed request, it signs the
response using the same algorithm and key. The server [MUST NOT]{.bcp14}
generate a signed response to a request if either the key is invalid
(e.g., key name or algorithm name are unknown) or the MAC fails
validation; see [Section 5.3.2](#on_error){.xref} for details of
responding in these cases.[¶](#section-5.3-1){.pilcrow}

It also [MUST NOT]{.bcp14} generate a signed response to an unsigned
request, except in the case of a response to a client\'s unsigned TKEY
request if the secret key is established on the server side after the
server processed the client\'s request. Signing responses to unsigned
TKEY requests [MUST]{.bcp14} be explicitly specified in the description
of an individual secret key establishment algorithm
\[[RFC3645](#RFC3645){.xref}\].[¶](#section-5.3-2){.pilcrow}

The digest components used to generate a TSIG on a response
are:[¶](#section-5.3-3){.pilcrow}

-   [Request MAC[¶](#section-5.3-4.1){.pilcrow}]{#section-5.3-4.1}
-   [DNS Message
    (response)[¶](#section-5.3-4.2){.pilcrow}]{#section-5.3-4.2}
-   [TSIG Variables
    (response)[¶](#section-5.3-4.3){.pilcrow}]{#section-5.3-4.3}

(This calculation is different for the second and subsequent message in
a multi-message answer; see below.)[¶](#section-5.3-5){.pilcrow}

If addition of the TSIG record will cause the message to be truncated,
the server [MUST]{.bcp14} alter the response so that a TSIG can be
included. This response contains only the question and a TSIG record,
has the TC bit set, and has an RCODE of 0 (NOERROR). At this point, the
client [SHOULD]{.bcp14} retry the request using TCP (as per [Section
4.2.2](https://www.rfc-editor.org/rfc/rfc1035#section-4.2.2){.relref} of
\[[RFC1035](#RFC1035){.xref}\]).[¶](#section-5.3-6){.pilcrow}

::: {#tcp}
::: {#section-5.3.1 .section}
#### [5.3.1.](#section-5.3.1){.section-number .selfRef} [TSIG on TCP Connections](#name-tsig-on-tcp-connections){.section-name .selfRef} {#name-tsig-on-tcp-connections}

A DNS TCP session, such as a zone transfer, can include multiple DNS
messages. Using TSIG on such a connection can protect the connection
from an attack and provide data integrity. The TSIG [MUST]{.bcp14} be
included on all DNS messages in the response. For backward
compatibility, a client that receives DNS messages and verifies TSIG
[MUST]{.bcp14} accept up to 99 intermediary messages without a TSIG and
[MUST]{.bcp14} verify that both the first and last message contain a
TSIG.[¶](#section-5.3.1-1){.pilcrow}

The first message is processed as a standard answer (see [Section
5.3](#answers){.xref}), but subsequent messages have the following
digest components:[¶](#section-5.3.1-2){.pilcrow}

-   [Prior MAC
    (running)[¶](#section-5.3.1-3.1){.pilcrow}]{#section-5.3.1-3.1}
-   [DNS Messages (any unsigned messages since the last
    TSIG)[¶](#section-5.3.1-3.2){.pilcrow}]{#section-5.3.1-3.2}
-   [TSIG Timers (current
    message)[¶](#section-5.3.1-3.3){.pilcrow}]{#section-5.3.1-3.3}

The \"Prior MAC\" is the MAC from the TSIG attached to the last message
containing a TSIG. \"DNS Messages\" comprises the concatenation (in
message order) of all messages after the last message that included a
TSIG and includes the current message. \"TSIG Timers\" comprises the
Time Signed and Fudge fields (in that order) pertaining to the message
for which the TSIG was created; this means that the successive TSIG
records in the stream will have non-decreasing Time Signed values. Note
that only the timers are included in the second and subsequent messages,
not all the TSIG variables.[¶](#section-5.3.1-4){.pilcrow}

This allows the client to rapidly detect when the session has been
altered; at which point, it can close the connection and retry. If a
client TSIG verification fails, the client [MUST]{.bcp14} close the
connection. If the client does not receive TSIG records frequently
enough (as specified above), it [SHOULD]{.bcp14} assume the connection
has been hijacked, and it [SHOULD]{.bcp14} close the connection. The
client [SHOULD]{.bcp14} treat this the same way as they would any other
interrupted transfer (although the exact behavior is not
specified).[¶](#section-5.3.1-5){.pilcrow}
:::
:::

::: {#on_error}
::: {#section-5.3.2 .section}
#### [5.3.2.](#section-5.3.2){.section-number .selfRef} [Generation of TSIG on Error Returns](#name-generation-of-tsig-on-error){.section-name .selfRef} {#name-generation-of-tsig-on-error}

When a server detects an error relating to the key or MAC in the
incoming request, the server [SHOULD]{.bcp14} send back an unsigned
error message (MAC Size == 0 and empty MAC). It [MUST NOT]{.bcp14} send
back a signed error message.[¶](#section-5.3.2-1){.pilcrow}

If an error is detected relating to the TSIG validity period or the MAC
is too short for the local policy, the server [SHOULD]{.bcp14} send back
a signed error message. The digest components
are:[¶](#section-5.3.2-2){.pilcrow}

-   [Request MAC (if the request MAC
    validated)[¶](#section-5.3.2-3.1){.pilcrow}]{#section-5.3.2-3.1}
-   [DNS Message
    (response)[¶](#section-5.3.2-3.2){.pilcrow}]{#section-5.3.2-3.2}
-   [TSIG Variables
    (response)[¶](#section-5.3.2-3.3){.pilcrow}]{#section-5.3.2-3.3}

The reason that the request MAC is not included in this MAC in some
cases is to make it possible for the client to verify the error. If the
error is not a TSIG error, the response [MUST]{.bcp14} be generated as
specified in [Section
5.3](#answers){.xref}.[¶](#section-5.3.2-4){.pilcrow}
:::
:::
:::
:::

::: {#client_proc_answer}
::: {#section-5.4 .section}
### [5.4.](#section-5.4){.section-number .selfRef} [Client Processing of Answer](#name-client-processing-of-answer){.section-name .selfRef} {#name-client-processing-of-answer}

When a client receives a response from a server and expects to see a
TSIG, it first checks if the TSIG RR is present in the response. If not,
the response is treated as having a format error and is
discarded.[¶](#section-5.4-1){.pilcrow}

If the TSIG RR is present, the client performs the same checks as
described in [Section 5.2](#request_processing){.xref}. If the TSIG RR
is unsigned as specified in [Section 5.3.2](#on_error){.xref} or does
not validate, the message [MUST]{.bcp14} be discarded unless the RCODE
is 9 (NOAUTH). In this case, the client [SHOULD]{.bcp14} attempt to
verify the response as if it were a TSIG error, as described in the
following subsections.[¶](#section-5.4-2){.pilcrow}

Regardless of the RCODE, a message containing a TSIG RR that is unsigned
as specified in [Section 5.3.2](#on_error){.xref} or that fails
verification [SHOULD NOT]{.bcp14} be considered an acceptable response,
as it may have been spoofed or manipulated. Instead, the client
[SHOULD]{.bcp14} log an error and continue to wait for a signed response
until the request times out.[¶](#section-5.4-3){.pilcrow}

::: {#section-5.4.1 .section}
#### [5.4.1.](#section-5.4.1){.section-number .selfRef} [Key Error Handling](#name-key-error-handling){.section-name .selfRef} {#name-key-error-handling}

If an RCODE on a response is 9 (NOTAUTH), but the response TSIG
validates and the TSIG key is recognized by the client but is different
from that used on the request, then this is a key-related error. The
client [MAY]{.bcp14} retry the request using the key specified by the
server. However, this should never occur, as a server [MUST NOT]{.bcp14}
sign a response with a different key to that used to sign the
request.[¶](#section-5.4.1-1){.pilcrow}
:::

::: {#section-5.4.2 .section}
#### [5.4.2.](#section-5.4.2){.section-number .selfRef} [MAC Error Handling](#name-mac-error-handling){.section-name .selfRef} {#name-mac-error-handling}

If the response RCODE is 9 (NOTAUTH) and TSIG ERROR is 16 (BADSIG), this
is a MAC-related error, and clients [MAY]{.bcp14} retry the request with
a new request ID, but it would be better to try a different shared key
if one is available. Clients [SHOULD]{.bcp14} keep track of how many MAC
errors are associated with each key. Clients [SHOULD]{.bcp14} log this
event.[¶](#section-5.4.2-1){.pilcrow}
:::

::: {#section-5.4.3 .section}
#### [5.4.3.](#section-5.4.3){.section-number .selfRef} [Time Error Handling](#name-time-error-handling){.section-name .selfRef} {#name-time-error-handling}

If the response RCODE is 9 (NOTAUTH) and the TSIG ERROR is 18 (BADTIME)
or the current time does not fall in the range specified in the TSIG
record, then this is a time-related error. This is an indication that
the client and server clocks are not synchronized. In this case, the
client [SHOULD]{.bcp14} log the event. DNS resolvers [MUST NOT]{.bcp14}
adjust any clocks in the client based on BADTIME errors, but the
server\'s time in the Other Data field [SHOULD]{.bcp14} be
logged.[¶](#section-5.4.3-1){.pilcrow}
:::

::: {#trunc_err}
::: {#section-5.4.4 .section}
#### [5.4.4.](#section-5.4.4){.section-number .selfRef} [Truncation Error Handling](#name-truncation-error-handling){.section-name .selfRef} {#name-truncation-error-handling}

If the response RCODE is 9 (NOTAUTH) and the TSIG ERROR is 22
(BADTRUNC), then this is a truncation-related error. The client
[MAY]{.bcp14} retry with a lesser truncation up to the full HMAC output
(no truncation), using the truncation used in the response as a hint for
what the server policy allowed ([Section 7](#trunc_pol){.xref}). Clients
[SHOULD]{.bcp14} log this event.[¶](#section-5.4.4-1){.pilcrow}
:::
:::
:::
:::

::: {#forwarding}
::: {#section-5.5 .section}
### [5.5.](#section-5.5){.section-number .selfRef} [Special Considerations for Forwarding Servers](#name-special-considerations-for-){.section-name .selfRef} {#name-special-considerations-for-}

A server acting as a forwarding server of a DNS message [SHOULD]{.bcp14}
check for the existence of a TSIG record. If the name on the TSIG is not
of a secret that the server shares with the originator, the server
[MUST]{.bcp14} forward the message unchanged including the TSIG. If the
name of the TSIG is of a key this server shares with the originator, it
[MUST]{.bcp14} process the TSIG. If the TSIG passes all checks, the
forwarding server [MUST]{.bcp14}, if possible, include a TSIG of its own
to the destination or the next forwarder. If no transaction security is
available to the destination and the message is a query, and if the
corresponding response has the AD flag (see
\[[RFC4035](#RFC4035){.xref}\]) set, the forwarder [MUST]{.bcp14} clear
the AD flag before adding the TSIG to the response and returning the
result to the system from which it received the
query.[¶](#section-5.5-1){.pilcrow}
:::
:::
:::
:::

::: {#algorithm_id}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Algorithms and Identifiers](#name-algorithms-and-identifiers){.section-name .selfRef} {#name-algorithms-and-identifiers}

The only message digest algorithm specified in the first version of
these specifications \[[RFC2845](#RFC2845){.xref}\] was \"HMAC-MD5\"
(see \[[RFC1321](#RFC1321){.xref}\] and \[[RFC2104](#RFC2104){.xref}\]).
Although a review of its security some years ago
\[[RFC6151](#RFC6151){.xref}\] concluded that \"it may not be urgent to
remove HMAC-MD5 from the existing protocols\", with the availability of
more secure alternatives, the opportunity has been taken to make the
implementation of this algorithm optional.[¶](#section-6-1){.pilcrow}

\[[RFC4635](#RFC4635){.xref}\] added mandatory support in TSIG for SHA-1
\[[FIPS180-4](#FIPS180-4){.xref}\] \[[RFC3174](#RFC3174){.xref}\]. SHA-1
collisions have been demonstrated
\[[SHA1SHAMBLES](#SHA1SHAMBLES){.xref}\], so the MD5 security
considerations described in [Section
2](https://www.rfc-editor.org/rfc/rfc6151#section-2){.relref} of
\[[RFC6151](#RFC6151){.xref}\] apply to SHA-1 in a similar manner.
Although support for hmac-sha1 in TSIG is still mandatory for
compatibility reasons, existing uses [SHOULD]{.bcp14} be replaced with
hmac-sha256 or other SHA-2 digest algorithms
(\[[FIPS180-4](#FIPS180-4){.xref}\], \[[RFC3874](#RFC3874){.xref}\],
\[[RFC6234](#RFC6234){.xref}\]).[¶](#section-6-2){.pilcrow}

Use of TSIG between two DNS agents is by mutual agreement. That
agreement can include the support of additional algorithms and criteria
as to which algorithms and truncations are acceptable, subject to the
restriction and guidelines in [Section 5.2.2.1](#trunc){.xref}. Key
agreement can be by the TKEY mechanism \[[RFC2930](#RFC2930){.xref}\] or
some other mutually agreeable method.[¶](#section-6-3){.pilcrow}

Implementations that support TSIG [MUST]{.bcp14} also implement HMAC
SHA1 and HMAC SHA256 and [MAY]{.bcp14} implement gss-tsig and the other
algorithms listed below. SHA-1 truncated to 96 bits (12 octets)
[SHOULD]{.bcp14} be implemented.[¶](#section-6-4){.pilcrow}

[]{#name-algorithms-for-implementati}

::: {#allowed-algorithms}
  Algorithm Name             Implementation   Use
  -------------------------- ---------------- ---------------------------
  HMAC-MD5.SIG-ALG.REG.INT   [MAY]{.bcp14}    [MUST NOT]{.bcp14}
  gss-tsig                   [MAY]{.bcp14}    [MAY]{.bcp14}
  hmac-sha1                  [MUST]{.bcp14}   [NOT RECOMMENDED]{.bcp14}
  hmac-sha224                [MAY]{.bcp14}    [MAY]{.bcp14}
  hmac-sha256                [MUST]{.bcp14}   [RECOMMENDED]{.bcp14}
  hmac-sha256-128            [MAY]{.bcp14}    [MAY]{.bcp14}
  hmac-sha384                [MAY]{.bcp14}    [MAY]{.bcp14}
  hmac-sha384-192            [MAY]{.bcp14}    [MAY]{.bcp14}
  hmac-sha512                [MAY]{.bcp14}    [MAY]{.bcp14}
  hmac-sha512-256            [MAY]{.bcp14}    [MAY]{.bcp14}

  : [Table 3](#table-3){.selfRef}: [Algorithms for Implementations
  Supporting TSIG](#name-algorithms-for-implementati){.selfRef}
:::
:::
:::

::: {#trunc_pol}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [TSIG Truncation Policy](#name-tsig-truncation-policy){.section-name .selfRef} {#name-tsig-truncation-policy}

As noted above, two DNS agents (e.g., resolver and server) must mutually
agree to use TSIG. Implicit in such an \"agreement\" are criteria as to
acceptable keys, algorithms, and (with the extensions in this document)
truncations. Local policies [MAY]{.bcp14} require the rejection of
TSIGs, even though they use an algorithm for which implementation is
mandatory.[¶](#section-7-1){.pilcrow}

When a local policy permits acceptance of a TSIG with a particular
algorithm and a particular non-zero amount of truncation, it
[SHOULD]{.bcp14} also permit the use of that algorithm with lesser
truncation (a longer MAC) up to the full keyed hash
output.[¶](#section-7-2){.pilcrow}

Regardless of a lower acceptable truncated MAC length specified by local
policy, a reply [SHOULD]{.bcp14} be sent with a MAC at least as long as
that in the corresponding request. Note, if the request specified a MAC
length longer than the keyed hash output, it will be rejected by
processing rules ([Section 5.2.2.1](#trunc){.xref}, case
1).[¶](#section-7-3){.pilcrow}

Implementations permitting multiple acceptable algorithms and/or
truncations [SHOULD]{.bcp14} permit this list to be ordered by presumed
strength and [SHOULD]{.bcp14} allow different truncations for the same
algorithm to be treated as separate entities in this list. When so
implemented, policies [SHOULD]{.bcp14} accept a presumed stronger
algorithm and truncation than the minimum strength required by the
policy.[¶](#section-7-4){.pilcrow}
:::
:::

::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Shared Secrets](#name-shared-secrets){.section-name .selfRef} {#name-shared-secrets}

Secret keys are very sensitive information and all available steps
should be taken to protect them on every host on which they are stored.
Generally, such hosts need to be physically protected. If they are
multi-user machines, great care should be taken so that unprivileged
users have no access to keying material. Resolvers often run
unprivileged, which means all users of a host would be able to see
whatever configuration data are used by the
resolver.[¶](#section-8-1){.pilcrow}

A name server usually runs privileged, which means its configuration
data need not be visible to all users of the host. For this reason, a
host that implements transaction-based authentication should probably be
configured with a \"stub resolver\" and a local caching and forwarding
name server. This presents a special problem for
\[[RFC2136](#RFC2136){.xref}\], which otherwise depends on clients to
communicate only with a zone\'s authoritative name
servers.[¶](#section-8-2){.pilcrow}

Use of strong, random shared secrets is essential to the security of
TSIG. See \[[RFC4086](#RFC4086){.xref}\] for a discussion of this issue.
The secret [SHOULD]{.bcp14} be at least as long as the keyed hash output
\[[RFC2104](#RFC2104){.xref}\].[¶](#section-8-3){.pilcrow}
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

IANA maintains a registry of algorithm names to be used as \"Algorithm
Names\", as defined in [Section 4.2](#format){.xref}
\[[IANA-TSIG](#IANA-TSIG){.xref}\]. Algorithm names are text strings
encoded using the syntax of a domain name. There is no structure to the
names, and algorithm names are compared as if they were DNS names, i.e.,
comparison is case insensitive. Previous specifications
(\[[RFC2845](#RFC2845){.xref}\] and \[[RFC4635](#RFC4635){.xref}\])
defined values for the HMAC-MD5 and some HMAC-SHA algorithms. IANA has
also registered \"gss-tsig\" as an identifier for TSIG authentication
where the cryptographic operations are delegated to the Generic Security
Service (GSS) \[[RFC3645](#RFC3645){.xref}\]. This document adds to the
allowed algorithms, and the registry has been updated with the names
listed in [Table
3](#allowed-algorithms){.xref}.[¶](#section-9-1){.pilcrow}

New algorithms are assigned using the IETF Review policy defined in
\[[RFC8126](#RFC8126){.xref}\]. The algorithm name
HMAC-MD5.SIG-ALG.REG.INT looks like a fully qualified domain name for
historical reasons; other algorithm names are simple, single-component
names.[¶](#section-9-2){.pilcrow}

IANA maintains a registry of RCODEs (error codes) (see
\[[IANA-RCODEs](#IANA-RCODEs){.xref}\], including \"TSIG Error values\"
to be used for \"Error\" values, as defined in [Section
4.2](#format){.xref}. This document defines the RCODEs as described in
[Section 3](#numbers){.xref}. New error codes are assigned and specified
as in \[[RFC6895](#RFC6895){.xref}\].[¶](#section-9-3){.pilcrow}
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

The approach specified here is computationally much less expensive than
the signatures specified in DNSSEC. As long as the shared secret key is
not compromised, strong authentication is provided between two DNS
systems, e.g., for the last hop from a local name server to the user
resolver or between primary and secondary name
servers.[¶](#section-10-1){.pilcrow}

Recommendations for choosing and maintaining secret keys can be found in
\[[RFC2104](#RFC2104){.xref}\]. If the client host has been compromised,
the server should suspend the use of all secrets known to that client.
If possible, secrets should be stored in an encrypted form. Secrets
should never be transmitted in the clear over any network. This document
does not address the issue on how to distribute secrets except that it
mentions the possibilities of manual configuration and the use of TKEY
\[[RFC2930](#RFC2930){.xref}\]. Secrets [SHOULD NOT]{.bcp14} be shared
by more than two entities; any such additional sharing would allow any
party knowing the key to impersonate any other such party to members of
the group.[¶](#section-10-2){.pilcrow}

This mechanism does not authenticate source data, only its transmission
between two parties who share some secret. The original source data can
come from a compromised zone master or can be corrupted during transit
from an authentic zone master to some \"caching forwarder\". However, if
the server is faithfully performing the full DNSSEC security checks,
then only security-checked data will be available to the
client.[¶](#section-10-3){.pilcrow}

A Fudge value that is too large may leave the server open to replay
attacks. A Fudge value that is too small may cause failures if machines
are not time synchronized or there are unexpected network delays. The
[RECOMMENDED]{.bcp14} value in most situations is 300
seconds.[¶](#section-10-4){.pilcrow}

To prevent cross-algorithm attacks, there [SHOULD]{.bcp14} only be one
algorithm associated with any given key
name.[¶](#section-10-5){.pilcrow}

In several cases where errors are detected, an unsigned error message
must be returned. This can allow for an attacker to spoof or manipulate
these responses. [Section 5.4](#client_proc_answer){.xref} recommends
logging these as errors and continuing to wait for a signed response
until the request times out.[¶](#section-10-6){.pilcrow}

Although the strength of an algorithm determines its security, there
have been some arguments that mild truncation can strengthen a MAC by
reducing the information available to an attacker. However, excessive
truncation clearly weakens authentication by reducing the number of bits
an attacker has to try to break the authentication by brute force
\[[RFC2104](#RFC2104){.xref}\].[¶](#section-10-7){.pilcrow}

Significant progress has been made recently in cryptanalysis of hash
functions of the types used here. While the results so far should not
affect HMAC, the stronger SHA-256 algorithm is being made mandatory as a
precaution.[¶](#section-10-8){.pilcrow}

See also the Security Considerations section of
\[[RFC2104](#RFC2104){.xref}\] from which the limits on truncation in
this RFC were taken.[¶](#section-10-9){.pilcrow}

::: {#issuesfixed}
::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [Issue Fixed in This Document](#name-issue-fixed-in-this-documen){.section-name .selfRef} {#name-issue-fixed-in-this-documen}

When signing a DNS reply message using TSIG, the MAC computation uses
the request message\'s MAC as an input to cryptographically relate the
reply to the request. The original TSIG specification
\[[RFC2845](#RFC2845){.xref}\] required that the time values be checked
before the request\'s MAC. If the time was invalid, some implementations
failed to carry out further checks and could use an invalid request MAC
in the signed reply.[¶](#section-10.1-1){.pilcrow}

This document makes it mandatory that the request MAC is considered to
be invalid until it has been validated; until then, any answer must be
unsigned. For this reason, the request MAC is now checked before the
time values.[¶](#section-10.1-2){.pilcrow}
:::
:::

::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Why Not DNSSEC?](#name-why-not-dnssec){.section-name .selfRef} {#name-why-not-dnssec}

DNS has been extended by DNSSEC (\[[RFC4033](#RFC4033){.xref}\],
\[[RFC4034](#RFC4034){.xref}\], and \[[RFC4035](#RFC4035){.xref}\]) to
provide for data origin authentication, and public key distribution, all
based on public key cryptography and public key based digital
signatures. To be practical, this form of security generally requires
extensive local caching of keys and tracing of authentication through
multiple keys and signatures to a pre-trusted locally configured
key.[¶](#section-10.2-1){.pilcrow}

One difficulty with the DNSSEC scheme is that common DNS implementations
include simple \"stub\" resolvers which do not have caches. Such
resolvers typically rely on a caching DNS server on another host. It is
impractical for these stub resolvers to perform general DNSSEC
authentication and they would naturally depend on their caching DNS
server to perform such services for them. To do so securely requires
secure communication of queries and responses. DNSSEC provides public
key transaction signatures to support this, but such signatures are very
expensive computationally to generate. In general, these require the
same complex public key logic that is impractical for
stubs.[¶](#section-10.2-2){.pilcrow}

A second area where use of straight DNSSEC public key based mechanisms
may be impractical is authenticating dynamic update
\[[RFC2136](#RFC2136){.xref}\] requests. DNSSEC provides for request
signatures but with DNSSEC they, like transaction signatures, require
computationally expensive public key cryptography and complex
authentication logic. Secure Domain Name System Dynamic Update
(\[[RFC3007](#RFC3007){.xref}\]) describes how different keys are used
in dynamically updated zones.[¶](#section-10.2-3){.pilcrow}
:::
:::

::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-11.1 .section}
### [11.1.](#section-11.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[FIPS180-4\]
:   [National Institute of Standards and Technology]{.refAuthor},
    [\"Secure Hash Standard (SHS)\"]{.refTitle}, [FIPS PUB
    180-4]{.seriesInfo}, [DOI 10.6028/NIST.FIPS.180-4]{.seriesInfo},
    August 2015, \<<https://doi.org/10.6028/NIST.FIPS.180-4>\>.
:   

\[RFC1034\]
:   [Mockapetris, P.]{.refAuthor}, [\"Domain names - concepts and
    facilities\"]{.refTitle}, [STD 13]{.seriesInfo}, [RFC
    1034]{.seriesInfo}, [DOI 10.17487/RFC1034]{.seriesInfo}, November
    1987, \<<https://www.rfc-editor.org/info/rfc1034>\>.
:   

\[RFC1035\]
:   [Mockapetris, P.]{.refAuthor}, [\"Domain names - implementation and
    specification\"]{.refTitle}, [STD 13]{.seriesInfo}, [RFC
    1035]{.seriesInfo}, [DOI 10.17487/RFC1035]{.seriesInfo}, November
    1987, \<<https://www.rfc-editor.org/info/rfc1035>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC2845\]
:   [Vixie, P.]{.refAuthor}[, Gudmundsson, O.]{.refAuthor}[, Eastlake
    3rd, D.]{.refAuthor}[, and B. Wellington]{.refAuthor}, [\"Secret Key
    Transaction Authentication for DNS (TSIG)\"]{.refTitle}, [RFC
    2845]{.seriesInfo}, [DOI 10.17487/RFC2845]{.seriesInfo}, May 2000,
    \<<https://www.rfc-editor.org/info/rfc2845>\>.
:   

\[RFC3597\]
:   [Gustafsson, A.]{.refAuthor}, [\"Handling of Unknown DNS Resource
    Record (RR) Types\"]{.refTitle}, [RFC 3597]{.seriesInfo}, [DOI
    10.17487/RFC3597]{.seriesInfo}, September 2003,
    \<<https://www.rfc-editor.org/info/rfc3597>\>.
:   

\[RFC4635\]
:   [Eastlake 3rd, D.]{.refAuthor}, [\"HMAC SHA (Hashed Message
    Authentication Code, Secure Hash Algorithm) TSIG Algorithm
    Identifiers\"]{.refTitle}, [RFC 4635]{.seriesInfo}, [DOI
    10.17487/RFC4635]{.seriesInfo}, August 2006,
    \<<https://www.rfc-editor.org/info/rfc4635>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   
:::

::: {#section-11.2 .section}
### [11.2.](#section-11.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[CVE-2017-11104\]
:   [Common Vulnerabilities and Exposures]{.refAuthor},
    [\"CVE-2017-11104: Improper TSIG validity period check can allow
    TSIG forgery\"]{.refTitle}, June 2017,
    \<<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11104>\>.
:   

\[CVE-2017-3142\]
:   [Common Vulnerabilities and Exposures]{.refAuthor},
    [\"CVE-2017-3142: An error in TSIG authentication can permit
    unauthorized zone transfers\"]{.refTitle}, June 2017,
    \<<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-3142>\>.
:   

\[CVE-2017-3143\]
:   [Common Vulnerabilities and Exposures]{.refAuthor},
    [\"CVE-2017-3143: An error in TSIG authentication can permit
    unauthorized dynamic updates\"]{.refTitle}, June 2017,
    \<<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-3143>\>.
:   

\[IANA-RCODEs\]
:   [IANA]{.refAuthor}, [\"DNS RCODEs\"]{.refTitle},
    \<<https://www.iana.org/assignments/dns-parameters/>\>.
:   

\[IANA-TSIG\]
:   [IANA]{.refAuthor}, [\"TSIG Algorithm Names\"]{.refTitle},
    \<<https://www.iana.org/assignments/tsig-algorithm-names/>\>.
:   

\[RFC1321\]
:   [Rivest, R.]{.refAuthor}, [\"The MD5 Message-Digest
    Algorithm\"]{.refTitle}, [RFC 1321]{.seriesInfo}, [DOI
    10.17487/RFC1321]{.seriesInfo}, April 1992,
    \<<https://www.rfc-editor.org/info/rfc1321>\>.
:   

\[RFC2104\]
:   [Krawczyk, H.]{.refAuthor}[, Bellare, M.]{.refAuthor}[, and R.
    Canetti]{.refAuthor}, [\"HMAC: Keyed-Hashing for Message
    Authentication\"]{.refTitle}, [RFC 2104]{.seriesInfo}, [DOI
    10.17487/RFC2104]{.seriesInfo}, February 1997,
    \<<https://www.rfc-editor.org/info/rfc2104>\>.
:   

\[RFC2136\]
:   [Vixie, P., Ed.]{.refAuthor}[, Thomson, S.]{.refAuthor}[,
    Rekhter, Y.]{.refAuthor}[, and J. Bound]{.refAuthor}, [\"Dynamic
    Updates in the Domain Name System (DNS UPDATE)\"]{.refTitle}, [RFC
    2136]{.seriesInfo}, [DOI 10.17487/RFC2136]{.seriesInfo}, April 1997,
    \<<https://www.rfc-editor.org/info/rfc2136>\>.
:   

\[RFC2930\]
:   [Eastlake 3rd, D.]{.refAuthor}, [\"Secret Key Establishment for DNS
    (TKEY RR)\"]{.refTitle}, [RFC 2930]{.seriesInfo}, [DOI
    10.17487/RFC2930]{.seriesInfo}, September 2000,
    \<<https://www.rfc-editor.org/info/rfc2930>\>.
:   

\[RFC3007\]
:   [Wellington, B.]{.refAuthor}, [\"Secure Domain Name System (DNS)
    Dynamic Update\"]{.refTitle}, [RFC 3007]{.seriesInfo}, [DOI
    10.17487/RFC3007]{.seriesInfo}, November 2000,
    \<<https://www.rfc-editor.org/info/rfc3007>\>.
:   

\[RFC3174\]
:   [Eastlake 3rd, D.]{.refAuthor}[ and P. Jones]{.refAuthor}, [\"US
    Secure Hash Algorithm 1 (SHA1)\"]{.refTitle}, [RFC
    3174]{.seriesInfo}, [DOI 10.17487/RFC3174]{.seriesInfo}, September
    2001, \<<https://www.rfc-editor.org/info/rfc3174>\>.
:   

\[RFC3645\]
:   [Kwan, S.]{.refAuthor}[, Garg, P.]{.refAuthor}[,
    Gilroy, J.]{.refAuthor}[, Esibov, L.]{.refAuthor}[,
    Westhead, J.]{.refAuthor}[, and R. Hall]{.refAuthor}, [\"Generic
    Security Service Algorithm for Secret Key Transaction Authentication
    for DNS (GSS-TSIG)\"]{.refTitle}, [RFC 3645]{.seriesInfo}, [DOI
    10.17487/RFC3645]{.seriesInfo}, October 2003,
    \<<https://www.rfc-editor.org/info/rfc3645>\>.
:   

\[RFC3874\]
:   [Housley, R.]{.refAuthor}, [\"A 224-bit One-way Hash Function:
    SHA-224\"]{.refTitle}, [RFC 3874]{.seriesInfo}, [DOI
    10.17487/RFC3874]{.seriesInfo}, September 2004,
    \<<https://www.rfc-editor.org/info/rfc3874>\>.
:   

\[RFC4033\]
:   [Arends, R.]{.refAuthor}[, Austein, R.]{.refAuthor}[,
    Larson, M.]{.refAuthor}[, Massey, D.]{.refAuthor}[, and S.
    Rose]{.refAuthor}, [\"DNS Security Introduction and
    Requirements\"]{.refTitle}, [RFC 4033]{.seriesInfo}, [DOI
    10.17487/RFC4033]{.seriesInfo}, March 2005,
    \<<https://www.rfc-editor.org/info/rfc4033>\>.
:   

\[RFC4034\]
:   [Arends, R.]{.refAuthor}[, Austein, R.]{.refAuthor}[,
    Larson, M.]{.refAuthor}[, Massey, D.]{.refAuthor}[, and S.
    Rose]{.refAuthor}, [\"Resource Records for the DNS Security
    Extensions\"]{.refTitle}, [RFC 4034]{.seriesInfo}, [DOI
    10.17487/RFC4034]{.seriesInfo}, March 2005,
    \<<https://www.rfc-editor.org/info/rfc4034>\>.
:   

\[RFC4035\]
:   [Arends, R.]{.refAuthor}[, Austein, R.]{.refAuthor}[,
    Larson, M.]{.refAuthor}[, Massey, D.]{.refAuthor}[, and S.
    Rose]{.refAuthor}, [\"Protocol Modifications for the DNS Security
    Extensions\"]{.refTitle}, [RFC 4035]{.seriesInfo}, [DOI
    10.17487/RFC4035]{.seriesInfo}, March 2005,
    \<<https://www.rfc-editor.org/info/rfc4035>\>.
:   

\[RFC4086\]
:   [Eastlake 3rd, D.]{.refAuthor}[, Schiller, J.]{.refAuthor}[, and S.
    Crocker]{.refAuthor}, [\"Randomness Requirements for
    Security\"]{.refTitle}, [BCP 106]{.seriesInfo}, [RFC
    4086]{.seriesInfo}, [DOI 10.17487/RFC4086]{.seriesInfo}, June 2005,
    \<<https://www.rfc-editor.org/info/rfc4086>\>.
:   

\[RFC4868\]
:   [Kelly, S.]{.refAuthor}[ and S. Frankel]{.refAuthor}, [\"Using
    HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512 with
    IPsec\"]{.refTitle}, [RFC 4868]{.seriesInfo}, [DOI
    10.17487/RFC4868]{.seriesInfo}, May 2007,
    \<<https://www.rfc-editor.org/info/rfc4868>\>.
:   

\[RFC6151\]
:   [Turner, S.]{.refAuthor}[ and L. Chen]{.refAuthor}, [\"Updated
    Security Considerations for the MD5 Message-Digest and the HMAC-MD5
    Algorithms\"]{.refTitle}, [RFC 6151]{.seriesInfo}, [DOI
    10.17487/RFC6151]{.seriesInfo}, March 2011,
    \<<https://www.rfc-editor.org/info/rfc6151>\>.
:   

\[RFC6234\]
:   [Eastlake 3rd, D.]{.refAuthor}[ and T. Hansen]{.refAuthor}, [\"US
    Secure Hash Algorithms (SHA and SHA-based HMAC and
    HKDF)\"]{.refTitle}, [RFC 6234]{.seriesInfo}, [DOI
    10.17487/RFC6234]{.seriesInfo}, May 2011,
    \<<https://www.rfc-editor.org/info/rfc6234>\>.
:   

\[RFC6895\]
:   [Eastlake 3rd, D.]{.refAuthor}, [\"Domain Name System (DNS) IANA
    Considerations\"]{.refTitle}, [BCP 42]{.seriesInfo}, [RFC
    6895]{.seriesInfo}, [DOI 10.17487/RFC6895]{.seriesInfo}, April 2013,
    \<<https://www.rfc-editor.org/info/rfc6895>\>.
:   

\[RFC7696\]
:   [Housley, R.]{.refAuthor}, [\"Guidelines for Cryptographic Algorithm
    Agility and Selecting Mandatory-to-Implement
    Algorithms\"]{.refTitle}, [BCP 201]{.seriesInfo}, [RFC
    7696]{.seriesInfo}, [DOI 10.17487/RFC7696]{.seriesInfo}, November
    2015, \<<https://www.rfc-editor.org/info/rfc7696>\>.
:   

\[RFC8126\]
:   [Cotton, M.]{.refAuthor}[, Leiba, B.]{.refAuthor}[, and T.
    Narten]{.refAuthor}, [\"Guidelines for Writing an IANA
    Considerations Section in RFCs\"]{.refTitle}, [BCP 26]{.seriesInfo},
    [RFC 8126]{.seriesInfo}, [DOI 10.17487/RFC8126]{.seriesInfo}, June
    2017, \<<https://www.rfc-editor.org/info/rfc8126>\>.
:   

\[SHA1SHAMBLES\]
:   [Leurent, G.]{.refAuthor}[ and T. Peyrin]{.refAuthor}, [\"SHA-1 is a
    Shambles\"]{.refTitle}, January 2020,
    \<<https://eprint.iacr.org/2020/014.pdf>\>.
:   
:::
:::

::: {#acks}
::: {#section-appendix.a .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The security problem addressed by this document was reported by [Clément
Berthaux]{.contact-name} from
Synacktiv.[¶](#section-appendix.a-1){.pilcrow}

[Peter van Dijk]{.contact-name}, [Benno Overeinder]{.contact-name},
[Willem Toroop]{.contact-name}, [Ondrej Sury]{.contact-name}, [Mukund
Sivaraman]{.contact-name}, and [Ralph Dolmans]{.contact-name}
participated in the discussions that prompted this document. [Mukund
Sivaraman]{.contact-name}, [Martin Hoffman]{.contact-name}, and [Tony
Finch]{.contact-name} made extremely helpful suggestions concerning the
structure and wording of the updated
document.[¶](#section-appendix.a-2){.pilcrow}

Stephen Morris would like to thank Internet Systems Consortium for its
support of his participation in the creation of this
document.[¶](#section-appendix.a-3){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#section-appendix.b .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Francis Dupont]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Internet Systems Consortium, Inc.]{.org}
:::

::: {.left dir="auto"}
[PO Box 360]{.street-address}
:::

::: {.left dir="auto"}
[Newmarket]{.locality}, [NH]{.region} [03857]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <Francis.Dupont@fdupont.fr>
:::

::: {.left dir="auto"}
[Stephen Morris]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Unaffiliated]{.org}
:::

::: {.left dir="auto"}
[United Kingdom]{.country-name}
:::

::: email
Email: <sa.morris8@gmail.com>
:::

::: {.left dir="auto"}
[Paul Vixie]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Farsight Security Inc]{.org}
:::

::: {.left dir="auto"}
[Suite 180]{.extended-address}
:::

::: {.left dir="auto"}
[177 Bovet Road]{.street-address}
:::

::: {.left dir="auto"}
[San Mateo]{.locality}, [CA]{.region} [94402]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <paul@redbarn.org>
:::

::: {.left dir="auto"}
[Donald E. Eastlake 3rd]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Futurewei Technologies]{.org}
:::

::: {.left dir="auto"}
[2386 Panoramic Circle]{.street-address}
:::

::: {.left dir="auto"}
[Apopka]{.locality}, [FL]{.region} [32703]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <d3e3e3@gmail.com>
:::

::: {.left dir="auto"}
[Olafur Gudmundsson]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cloudflare]{.org}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <olafur+ietf@cloudflare.com>
:::

::: {.left dir="auto"}
[Brian Wellington]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Akamai]{.org}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <bwelling@akamai.com>
:::
:::
:::
