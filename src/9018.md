  RFC 9018       Interoperable DNS Server Cookies   April 2021
  -------------- ---------------------------------- ------------
  Sury, et al.   Standards Track                    \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9018](https://www.rfc-editor.org/rfc/rfc9018){.eref}

Updates:
:   [7873](https://www.rfc-editor.org/rfc/rfc7873){.eref}

Category:
:   Standards Track

Published:
:   April 2021

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    O. Sury
    :::

    ::: org
    Internet Systems Consortium
    :::
    :::

    ::: author
    ::: author-name
    W. Toorop
    :::

    ::: org
    NLnet Labs
    :::
    :::

    ::: author
    ::: author-name
    D. Eastlake 3rd
    :::

    ::: org
    Futurewei Technologies
    :::
    :::

    ::: author
    ::: author-name
    M. Andrews
    :::

    ::: org
    Internet Systems Consortium
    :::
    :::
:::

# RFC 9018 {#rfcnum}

# Interoperable Domain Name System (DNS) Server Cookies {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

DNS Cookies, as specified in RFC 7873, are a lightweight DNS transaction
security mechanism that provide limited protection to DNS servers and
clients against a variety of denial-of-service amplification, forgery,
or cache-poisoning attacks by off-path
attackers.[¶](#section-abstract-1){.pilcrow}

This document updates RFC 7873 with precise directions for creating
Server Cookies so that an anycast server set including diverse
implementations will interoperate with standard clients, with
suggestions for constructing Client Cookies in a privacy-preserving
fashion, and with suggestions on how to update a Server Secret. An IANA
registry listing the methods and associated pseudorandom function
suitable for creating DNS Server Cookies has been created with the
method described in this document as the first and, as of the time of
publication, only entry.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9018>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2021 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Terminology and
        Definitions](#name-terminology-and-definitions){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Changes to RFC
    7873](#name-changes-to-rfc-7873){.xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Constructing a Client
    Cookie](#name-constructing-a-client-cooki){.xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Constructing a Server
    Cookie](#name-constructing-a-server-cooki){.xref}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [The Version
        Sub-Field](#name-the-version-sub-field){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [The Reserved
        Sub-Field](#name-the-reserved-sub-field){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [The Timestamp
        Sub-Field](#name-the-timestamp-sub-field){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.xref}.  [The Hash
        Sub-Field](#name-the-hash-sub-field){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Updating the Server
    Secret](#name-updating-the-server-secret){.xref}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Cookie
    Algorithms](#name-cookie-algorithms){.xref}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Security and Privacy
    Considerations](#name-security-and-privacy-consid){.xref}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Client Cookie
        Construction](#name-client-cookie-construction){.xref}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Server Cookie
        Construction](#name-server-cookie-construction){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [References](#name-references){.xref}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [Normative
        References](#name-normative-references){.xref}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [Informative
        References](#name-informative-references){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [Appendix A](#section-appendix.a){.xref}.  [Test
    Vectors](#name-test-vectors){.xref}

    -   ::: {#section-toc.1-1.10.2.1}
        [A.1](#section-a.1){.xref}.  [Learning a New Server
        Cookie](#name-learning-a-new-server-cooki){.xref}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [A.2](#section-a.2){.xref}.  [The Same Client Learning a Renewed
        (Fresh) Server Cookie](#name-the-same-client-learning-a-){.xref}
        :::

    -   ::: {#section-toc.1-1.10.2.3}
        [A.3](#section-a.3){.xref}.  [Another Client Learning a Renewed
        Server Cookie](#name-another-client-learning-a-r){.xref}
        :::

    -   ::: {#section-toc.1-1.10.2.4}
        [A.4](#section-a.4){.xref}.  [IPv6 Query with Rolled Over
        Secret](#name-ipv6-query-with-rolled-over){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [Appendix B](#section-appendix.b){.xref}.  [Implementation
    Status](#name-implementation-status){.xref}
    :::

-   ::: {#section-toc.1-1.12}
    [](#section-appendix.c){.xref}[Acknowledgements](#name-acknowledgements){.xref}
    :::

-   ::: {#section-toc.1-1.13}
    [](#section-appendix.d){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}
    :::
:::
:::

::: {#introduction}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

DNS Cookies, as specified in \[[RFC7873](#RFC7873){.xref}\], are a
lightweight DNS transaction security mechanism that provide limited
protection to DNS servers and clients against a variety of
denial-of-service amplification, forgery, or cache-poisoning attacks by
off-path attackers. This document specifies a means of producing
interoperable cookies so that an anycast server set including diverse
implementations can be easily configured to interoperate with standard
clients. Also, single-implementation or non-anycast services can benefit
from a well-studied standardized algorithm for which the behavioral and
security characteristics are more widely
known.[¶](#section-1-1){.pilcrow}

The threats considered for DNS Cookies and the properties of the DNS
Security features other than DNS Cookies are discussed in
\[[RFC7873](#RFC7873){.xref}\].[¶](#section-1-2){.pilcrow}

In [Section
6](https://www.rfc-editor.org/rfc/rfc7873#section-6){.relref} of
\[[RFC7873](#RFC7873){.xref}\], for simplicity, it is
\"[RECOMMENDED]{.bcp14} that the same Server Secret be used by each DNS
server in a set of anycast servers.\" However, how precisely a Server
Cookie is calculated from this Server Secret is left to the
implementation.[¶](#section-1-3){.pilcrow}

This guidance has led to a gallimaufry of DNS Cookie implementations,
calculating the Server Cookie in different ways. As a result, DNS
Cookies are impractical to deploy on multi-vendor anycast networks
because even when all DNS Software shares the same secret, as
[RECOMMENDED]{.bcp14} in [Section
6](https://www.rfc-editor.org/rfc/rfc7873#section-6){.relref} of
\[[RFC7873](#RFC7873){.xref}\], the Server Cookie constructed by one
implementation cannot generally be validated by
another.[¶](#section-1-4){.pilcrow}

There is no need for DNS client (resolver) Cookies to be interoperable
across different implementations. Each client need only be able to
recognize its own cookies. However, this document does contain
recommendations for constructing Client Cookies in a client-protecting
fashion.[¶](#section-1-5){.pilcrow}

::: {#terminology-and-definitions}
::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Terminology and Definitions](#name-terminology-and-definitions){.section-name .selfRef} {#name-terminology-and-definitions}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-1.1-1){.pilcrow}

Note: \"IP address\" is used herein as a length-independent term
covering both IPv4 and IPv6 addresses.[¶](#section-1.1-2){.pilcrow}
:::
:::
:::
:::

::: {#changes}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Changes to RFC 7873](#name-changes-to-rfc-7873){.section-name .selfRef} {#name-changes-to-rfc-7873}

Appendices
[A.1](https://www.rfc-editor.org/rfc/rfc7873#appendix-A.1){.relref} and
[B.1](https://www.rfc-editor.org/rfc/rfc7873#appendix-B.1){.relref} of
\[[RFC7873](#RFC7873){.xref}\] provide example \"simple\" algorithms for
computing Client and Server Cookies, respectively. These algorithms
[MUST NOT]{.bcp14} be used as the resulting cookies are too weak when
evaluated against modern security standards.[¶](#section-2-1){.pilcrow}

[Appendix
B.2](https://www.rfc-editor.org/rfc/rfc7873#appendix-B.2){.relref} of
\[[RFC7873](#RFC7873){.xref}\] provides an example \"more complex\"
server algorithm. This algorithm is replaced by the interoperable
specification in [Section 4](#serverCookie){.xref} of this document,
which [MUST]{.bcp14} be used by Server Cookie
implementations.[¶](#section-2-2){.pilcrow}

This document has suggestions on Client Cookie construction in [Section
3](#clientCookie){.xref}. The previous example in [Appendix
A.2](https://www.rfc-editor.org/rfc/rfc7873#appendix-A.2){.relref} of
\[[RFC7873](#RFC7873){.xref}\] is [NOT
RECOMMENDED]{.bcp14}.[¶](#section-2-3){.pilcrow}
:::
:::

::: {#clientCookie}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Constructing a Client Cookie](#name-constructing-a-client-cooki){.section-name .selfRef} {#name-constructing-a-client-cooki}

The Client Cookie acts as an identifier for a given client and its IP
address and needs to be unguessable. In order to provide minimal
authentication of the targeted server, a client [MUST]{.bcp14} use a
different Client Cookie for each different Server IP address. This
complicates a server\'s ability to spoof answers for other DNS servers.
The Client Cookie [SHOULD]{.bcp14} have 64 bits of
entropy.[¶](#section-3-1){.pilcrow}

When a server does not support DNS Cookies, the client [MUST
NOT]{.bcp14} send the same Client Cookie to that same server again.
Instead, it is recommended that the client does not send a Client Cookie
to that server for a certain period (for example, five minutes) before
it retries with a new Client Cookie.[¶](#section-3-2){.pilcrow}

When a server does support DNS Cookies, the client should store the
Client Cookie alongside the Server Cookie it registered for that
server.[¶](#section-3-3){.pilcrow}

Except for when the Client IP address changes, there is no need to
change the Client Cookie often. It is then reasonable to change the
Client Cookie only if it has been compromised or after a relatively long
implementation-defined period of time. The time period should be no
longer than a year, and in any case, Client Cookies are not expected to
survive a program restart.[¶](#section-3-4){.pilcrow}

::: {#section-3-5}
``` sourcecode
Client-Cookie = 64 bits of entropy
```

[¶](#section-3-5){.pilcrow}
:::

Previously, the recommended algorithm to compute the Client Cookie
included the Client IP address as an input to a hashing function.
However, when implementing the DNS Cookies, several DNS vendors found it
impractical to include the Client IP as the Client Cookie is typically
computed before the Client IP address is known. Therefore, the
requirement to put the Client IP address as input was
removed.[¶](#section-3-6){.pilcrow}

However, for privacy reasons, in order to prevent tracking of devices
across links and to not circumvent IPv6 Privacy Extensions
\[[RFC8981](#RFC8981){.xref}\], clients [MUST NOT]{.bcp14} reuse a
Client or Server Cookie after the Client IP address has
changed.[¶](#section-3-7){.pilcrow}

One way to satisfy this requirement for non-reuse is to register the
Client IP address alongside the Server Cookie when it receives the
Server Cookie. In subsequent queries to the server with that Server
Cookie, the socket [MUST]{.bcp14} be bound to the Client IP address that
was also used (and registered) when it received the Server Cookie.
Failure to bind [MUST]{.bcp14} then result in a new Client
Cookie.[¶](#section-3-8){.pilcrow}
:::
:::

::: {#serverCookie}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Constructing a Server Cookie](#name-constructing-a-server-cooki){.section-name .selfRef} {#name-constructing-a-server-cooki}

The Server Cookie is effectively a Message Authentication Code (MAC).
The Server Cookie, when it occurs in a COOKIE option in a request, is
intended to weakly assure the server that the request came from a client
that is both at the source IP address of the request and using the
Client Cookie included in the option. This assurance is provided by the
Server Cookie that the server (or any other server from the anycast set)
sent to that client in an earlier response and that appears as the
Server Cookie field in the weakly authenticated request (see [Section
5.2](https://www.rfc-editor.org/rfc/rfc7873#section-5.2){.relref} of
\[[RFC7873](#RFC7873){.xref}\]).[¶](#section-4-1){.pilcrow}

DNS Cookies do not provide protection against \"on-path\" adversaries
(see [Section
9](https://www.rfc-editor.org/rfc/rfc7873#section-9){.relref} of
\[[RFC7873](#RFC7873){.xref}\]). An on-path observer that has seen a
Server Cookie for a client can abuse that Server Cookie to spoof request
for that client within the time span a Server Cookie is valid (see
[Section 4.3](#timestampField){.xref}).[¶](#section-4-2){.pilcrow}

The Server Cookie is calculated from the Client Cookie, a series of
Sub-Fields specified below, the Client IP address, and a Server Secret
that is known only to the server or only to the set of servers at the
same anycast address.[¶](#section-4-3){.pilcrow}

For calculation of the Server Cookie, a pseudorandom function is
[RECOMMENDED]{.bcp14} with the property that an attacker that does not
know the Server Secret, cannot find (any information about) the Server
Secret, and cannot create a Server Cookie for any combination of the
Client Cookie, the series of Sub-Fields specified below, and the client
IP address, for which it has not seen a Server Cookie before. Because
DNS servers need to use the pseudorandom function in order to verify
Server Cookies, it is [RECOMMENDED]{.bcp14} that it be efficient to
calculate. The pseudorandom function described in
\[[SipHash-2-4](#SipHash-2-4){.xref}\] and introduced in [Section
4.4](#hashField){.xref} of this document fits these
recommendations.[¶](#section-4-4){.pilcrow}

Changing the Server Secret regularly is [RECOMMENDED]{.bcp14} but, when
a secure pseudorandom function is used, it need not be changed too
frequently. Once a month, for example, would be adequate. See [Section
5](#rollingSecret){.xref} on operator and implementation guidelines for
updating a Server Secret.[¶](#section-4-5){.pilcrow}

The 128-bit Server Cookie consists of the following Sub-Fields: a
1-octet Version Sub-Field, a 3-octet Reserved Sub-Field, a 4-octet
Timestamp Sub-Field, and an 8-octet Hash
Sub-Field.[¶](#section-4-6){.pilcrow}

::: {#section-4-7 .artwork .art-text .alignLeft .art-ascii-art}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Version    |                   Reserved                    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Timestamp                           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                             Hash                              |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-4-7){.pilcrow}
:::

::: {#the-version-sub-field}
::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [The Version Sub-Field](#name-the-version-sub-field){.section-name .selfRef} {#name-the-version-sub-field}

The Version Sub-Field prescribes the structure and Hash calculation
formula. This document defines Version 1 to be the structure and way to
calculate the Hash Sub-Field as defined in this
section.[¶](#section-4.1-1){.pilcrow}
:::
:::

::: {#the-reserved-sub-field}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [The Reserved Sub-Field](#name-the-reserved-sub-field){.section-name .selfRef} {#name-the-reserved-sub-field}

The value of the Reserved Sub-Field is reserved for future versions of
server-side cookie construction. On construction, it [MUST]{.bcp14} be
set to zero octets. On Server Cookie verification, the server [MUST
NOT]{.bcp14} enforce those fields to be zero, and the Hash should be
computed with the received value as described in [Section
4.4](#hashField){.xref}.[¶](#section-4.2-1){.pilcrow}
:::
:::

::: {#timestampField}
::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [The Timestamp Sub-Field](#name-the-timestamp-sub-field){.section-name .selfRef} {#name-the-timestamp-sub-field}

The Timestamp value prevents Replay Attacks and [MUST]{.bcp14} be
checked by the server to be within a defined period of time. The DNS
server [SHOULD]{.bcp14} allow cookies within a 1-hour period in the past
and a 5-minute period into the future to allow operation of low-volume
clients and some limited time skew between the DNS servers in the
anycast set.[¶](#section-4.3-1){.pilcrow}

The Timestamp value specifies a date and time in the form of a 32-bit
**unsigned** number of seconds elapsed since 1 January 1970 00:00:00
UTC, ignoring leap seconds, in network byte order. All comparisons
involving these fields [MUST]{.bcp14} use \"Serial number arithmetic\",
as defined in \[[RFC1982](#RFC1982){.xref}\].
\[[RFC1982](#RFC1982){.xref}\] specifies how the differences should be
handled. This handles any relative time window less than 68 years, at
any time in the future (2038, 2106, 2256, 22209, or
later.)[¶](#section-4.3-2){.pilcrow}

The DNS server [SHOULD]{.bcp14} generate a new Server Cookie at least if
the received Server Cookie from the client is more than half an hour
old, but it [MAY]{.bcp14} generate a new cookie more often than
that.[¶](#section-4.3-3){.pilcrow}
:::
:::

::: {#hashField}
::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [The Hash Sub-Field](#name-the-hash-sub-field){.section-name .selfRef} {#name-the-hash-sub-field}

It\'s important that all the DNS servers use the same algorithm for
computing the Server Cookie. This document defines the Version 1 of the
server-side algorithm to be:[¶](#section-4.4-1){.pilcrow}

::: {#section-4.4-2}
``` sourcecode
Hash = SipHash-2-4(
    Client Cookie | Version | Reserved | Timestamp | Client-IP,
    Server Secret )
```

[¶](#section-4.4-2){.pilcrow}
:::

where \"\|\" indicates concatenation.[¶](#section-4.4-3){.pilcrow}

Notice that Client-IP is used for hash generation even though it is not
included in the cookie value itself. Client-IP can be either 4 bytes for
IPv4 or 16 bytes for IPv6. The length of all the concatenated elements
(the input into \[[SipHash-2-4](#SipHash-2-4){.xref}\]) [MUST]{.bcp14}
be either precisely 20 bytes in case of an IPv4 Client-IP or precisely
32 bytes in case of an IPv6 Client-IP.[¶](#section-4.4-4){.pilcrow}

When a DNS server receives a Server Cookie version 1 for validation, the
length of the received COOKIE option [MUST]{.bcp14} be precisely 24
bytes: 8 bytes for the Client Cookie plus 16 bytes for the Server
Cookie. Verification of the length of the received COOKIE option is
[REQUIRED]{.bcp14} to guarantee the length of the input into
\[[SipHash-2-4](#SipHash-2-4){.xref}\] to be precisely 20 bytes in the
case of an IPv4 Client-IP and precisely 32 bytes in the case of an IPv6
Client-IP. This ensures that the input into
\[[SipHash-2-4](#SipHash-2-4){.xref}\] is an injective function of the
elements making up the input, and thereby prevents data substitution
attacks. More specifically, this prevents a 36-byte COOKIE option coming
from an IPv4 Client-IP to be validated as if it were coming from an IPv6
Client-IP.[¶](#section-4.4-5){.pilcrow}

The Server Secret [MUST]{.bcp14} be configurable to make sure that
servers in an anycast network return consistent
results.[¶](#section-4.4-6){.pilcrow}
:::
:::
:::
:::

::: {#rollingSecret}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Updating the Server Secret](#name-updating-the-server-secret){.section-name .selfRef} {#name-updating-the-server-secret}

Changing the Server Secret regularly is [RECOMMENDED]{.bcp14}. All
servers in an anycast set must be able to verify the Server Cookies
constructed by all other servers in that anycast set at all times.
Therefore, it is vital that the Server Secret is shared among all
servers before it is used to generate Server Cookies on any
server.[¶](#section-5-1){.pilcrow}

Also, to maximize maintaining established relationships between clients
and servers, an old Server Secret should be valid for verification
purposes for a specific period.[¶](#section-5-2){.pilcrow}

To facilitate this, deployment of a new Server Secret [MUST]{.bcp14} be
done in three stages:[¶](#section-5-3){.pilcrow}

[]{.break}

Stage 1

:   The new Server Secret is deployed on all the servers in an anycast
    set by the operator.[¶](#section-5-4.2.1){.pilcrow}

    Each server learns the new Server Secret but keeps using the
    previous Server Secret to generate Server
    Cookies.[¶](#section-5-4.2.2){.pilcrow}

    Server Cookies constructed with both the new Server Secret and the
    previous Server Secret are considered valid when
    verifying.[¶](#section-5-4.2.3){.pilcrow}

    After stage 1 is completed, all the servers in the anycast set have
    learned the new Server Secret and can verify Server Cookies
    constructed with it, but keep generating Server Cookies with the old
    Server Secret.[¶](#section-5-4.2.4){.pilcrow}

:   

Stage 2

:   This stage is initiated by the operator after the Server Cookie is
    present on all members in the anycast
    set.[¶](#section-5-4.4.1){.pilcrow}

    When entering Stage 2, servers start generating Server Cookies with
    the new Server Secret. The previous Server Secret is not yet
    removed/forgotten.[¶](#section-5-4.4.2){.pilcrow}

    Server Cookies constructed with both the new Server Secret and the
    previous Server Secret are considered valid when
    verifying.[¶](#section-5-4.4.3){.pilcrow}

:   

Stage 3

:   This stage is initiated by the operator when it can be assumed that
    most clients have obtained a Server Cookie derived from the new
    Server Secret.[¶](#section-5-4.6.1){.pilcrow}

    With this stage, the previous Server Secret can be removed and [MUST
    NOT]{.bcp14} be used anymore for
    verifying.[¶](#section-5-4.6.2){.pilcrow}

    It is [RECOMMENDED]{.bcp14} that the operator wait, after initiating
    Stage 2 and before initiating Stage 3, at least a period of time
    equal to the longest TTL in the zones served by the server plus 1
    hour.[¶](#section-5-4.6.3){.pilcrow}

    The operator [SHOULD]{.bcp14} wait at least longer than the period
    clients are allowed to use the same Server Cookie, which
    [SHOULD]{.bcp14} be 1 hour (see [Section
    4.3](#timestampField){.xref}).[¶](#section-5-4.6.4){.pilcrow}

:   
:::
:::

::: {#cookieAlgorithms}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Cookie Algorithms](#name-cookie-algorithms){.section-name .selfRef} {#name-cookie-algorithms}

\[[SipHash-2-4](#SipHash-2-4){.xref}\] is a pseudorandom function
suitable as a Message Authentication Code. It is [REQUIRED]{.bcp14} that
a compliant DNS server use SipHash-2-4 as a mandatory and default
algorithm for DNS Cookies to ensure interoperability between the DNS
Implementations.[¶](#section-6-1){.pilcrow}

The construction method and pseudorandom function used in calculating
and verifying the Server Cookies are determined by the initial version
byte and by the length of the Server Cookie. Additional pseudorandom or
construction algorithms for Server Cookies might be added in the
future.[¶](#section-6-2){.pilcrow}
:::
:::

::: {#ianaConsiderations}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

IANA has created a registry under the \"Domain Name System (DNS)
Parameters\" heading as follows:[¶](#section-7-1){.pilcrow}

[]{.break}

Registry Name:
:   DNS Server Cookie Methods[¶](#section-7-2.2){.pilcrow}
:   

Assignment Policy:
:   Expert Review[¶](#section-7-2.4){.pilcrow}
:   

Reference:
:   \[RFC9018\],
    \[[RFC7873](#RFC7873){.xref}\][¶](#section-7-2.6){.pilcrow}
:   

Note:
:   A Server Cookie method (construction and pseudorandom algorithm) is
    determined by the Version in the first byte of the cookie and by the
    cookie size. Server Cookie size is limited to the inclusive range of
    8 to 32 bytes.[¶](#section-7-2.8){.pilcrow}
:   

[]{#name-dns-server-cookie-methods}

  Version   Size    Method
  --------- ------- -----------------------------------------------------------
  0         8-32    Reserved
  1         8-15    Unassigned
  1         16      SipHash-2-4 \[RFC9018\] [Section 4](#serverCookie){.xref}
  1         17-32   Unassigned
  2-239     8-32    Unassigned
  240-254   8-32    Reserved for Private Use
  255       8-32    Reserved

  : [Table 1](#table-1){.selfRef}: [DNS Server Cookie
  Methods](#name-dns-server-cookie-methods){.selfRef}
:::
:::

::: {#securityConsiderations}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Security and Privacy Considerations](#name-security-and-privacy-consid){.section-name .selfRef} {#name-security-and-privacy-consid}

DNS Cookies provide limited protection to DNS servers and clients
against a variety of denial-of-service amplification, forgery, or
cache-poisoning attacks by off-path attackers. They provide no
protection against on-path adversaries that can observe the plaintext
DNS traffic. An on-path adversary that can observe a Server Cookie for a
client and server interaction can use that Server Cookie for
denial-of-service amplification, forgery, or cache-poisoning attacks
directed at that client for the lifetime of the Server
Cookie.[¶](#section-8-1){.pilcrow}

::: {#client-cookie-construction}
::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Client Cookie Construction](#name-client-cookie-construction){.section-name .selfRef} {#name-client-cookie-construction}

In \[[RFC7873](#RFC7873){.xref}\], it was [RECOMMENDED]{.bcp14} to
construct a Client Cookie by using a pseudorandom function of the Client
IP address, the Server IP address, and a secret quantity known only to
the client. The Client IP address was included to ensure that a client
could not be tracked if its IP address changes due to privacy mechanisms
or otherwise.[¶](#section-8.1-1){.pilcrow}

In this document, we changed Client Cookie construction to be just 64
bits of entropy newly created for each new upstream server the client
connects to. As a consequence, additional care needs to be taken to
prevent tracking of clients. To prevent tracking, a new Client Cookie
for a server [MUST]{.bcp14} be created whenever the Client IP address
changes.[¶](#section-8.1-2){.pilcrow}

Unfortunately, tracking Client IP address changes is impractical with
servers that do not support DNS Cookies. To prevent tracking of clients
with non-DNS Cookie-supporting servers, a client [MUST NOT]{.bcp14} send
a previously sent Client Cookie to a server not known to support DNS
Cookies. To prevent the creation of a new Client Cookie for each query
to a non-DNS Cookie-supporting server, it is [RECOMMENDED]{.bcp14} to
not send a Client Cookie to that server for a certain period, for
example five minutes.[¶](#section-8.1-3){.pilcrow}

Summarizing:[¶](#section-8.1-4){.pilcrow}

-   ::: {#section-8.1-5.1}
    In order to provide minimal authentication, a client [MUST]{.bcp14}
    use a different Client Cookie for each different Server IP
    address.[¶](#section-8.1-5.1.1){.pilcrow}
    :::

-   ::: {#section-8.1-5.2}
    To prevent tracking of clients, a new Client Cookie [MUST]{.bcp14}
    be created when the Client IP address
    changes.[¶](#section-8.1-5.2.1){.pilcrow}
    :::

-   ::: {#section-8.1-5.3}
    To prevent tracking of clients by a non-DNS Cookie-supporting
    server, a client [MUST NOT]{.bcp14} send a previously sent Client
    Cookie to a server in the absence of an associated Server
    Cookie.[¶](#section-8.1-5.3.1){.pilcrow}
    :::

Note that it is infeasible for a client to detect a change in the public
IP address when the client is behind a routing device performing Network
Address Translation (NAT). A server may track the public IP address of
that routing device performing the NAT. Preventing tracking of the
public IP of a NAT-performing routing device is beyond the scope of this
document.[¶](#section-8.1-6){.pilcrow}
:::
:::

::: {#server-cookie-construction}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Server Cookie Construction](#name-server-cookie-construction){.section-name .selfRef} {#name-server-cookie-construction}

\[[RFC7873](#RFC7873){.xref}\] did not give a precise recipe for
constructing Server Cookies, but it did recommend usage of a
pseudorandom function strong enough to prevent the guessing of cookies.
In this document, SipHash-2-4 is assigned as the pseudorandom function
to be used for version 1 Server Cookies. SipHash-2-4 is considered
sufficiently strong for the immediate future, but predictions about
future development in cryptography and cryptanalysis are beyond the
scope of this document.[¶](#section-8.2-1){.pilcrow}

The precise structure of version 1 Server Cookies is defined in this
document. A portion of the structure is made up of unhashed data
elements that are exposed in cleartext to an on-path observer. These
unhashed data elements are taken along as input to the SipHash-2-4
function of which the result is the other portion of the Server Cookie,
so the unhashed portion of the Server Cookie cannot be changed by an
on-path attacker without also recalculating the hashed portion for which
the Server Secret needs to be known.[¶](#section-8.2-2){.pilcrow}

One of the elements in the unhashed portion of version 1 Server Cookies
is a Timestamp used to prevent Replay Attacks. Servers verifying version
1 Server Cookies need to have access to a reliable time value, one that
cannot be altered by an attacker, to compare with the Timestamp value.
Furthermore, all servers participating in an anycast set that validate
version 1 Server Cookies need to have their clocks
synchronized.[¶](#section-8.2-3){.pilcrow}

For an on-path adversary observing a Server Cookie (as mentioned in the
first paragraph of [Section 8](#securityConsiderations){.xref}), the
cleartext Timestamp data element reveals the lifetime during which the
observed Server Cookie can be used to attack the
client.[¶](#section-8.2-4){.pilcrow}

In addition to the Security Considerations in this section, the Security
Considerations section of \[[RFC7873](#RFC7873){.xref}\] still
applies.[¶](#section-8.2-5){.pilcrow}
:::
:::
:::
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC1982\]
:   [Elz, R.]{.refAuthor} and [R. Bush]{.refAuthor}, [\"Serial Number
    Arithmetic\"]{.refTitle}, [RFC 1982]{.seriesInfo}, [DOI
    10.17487/RFC1982]{.seriesInfo}, August 1996,
    \<<https://www.rfc-editor.org/info/rfc1982>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC3339\]
:   [Klyne, G.]{.refAuthor} and [C. Newman]{.refAuthor}, [\"Date and
    Time on the Internet: Timestamps\"]{.refTitle}, [RFC
    3339]{.seriesInfo}, [DOI 10.17487/RFC3339]{.seriesInfo}, July 2002,
    \<<https://www.rfc-editor.org/info/rfc3339>\>.
:   

\[RFC7873\]
:   [Eastlake 3rd, D.]{.refAuthor} and [M. Andrews]{.refAuthor},
    [\"Domain Name System (DNS) Cookies\"]{.refTitle}, [RFC
    7873]{.seriesInfo}, [DOI 10.17487/RFC7873]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7873>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[SipHash-2-4\]
:   [Aumasson, J.]{.refAuthor} and [D. J. Bernstein]{.refAuthor},
    [\"SipHash: A Fast Short-Input PRF\"]{.refTitle}, [Progress in
    Cryptology - INDOCRYPT 2012]{.refContent}, [Lecture Notes in
    Computer Science, vol. 7668]{.refContent}, December 2012,
    \<<https://doi.org/10.1007/978-3-642-34931-7_28>\>.
:   
:::

::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC8981\]
:   [Gont, F.]{.refAuthor}, [Krishnan, S.]{.refAuthor},
    [Narten, T.]{.refAuthor}, and [R. Draves]{.refAuthor}, [\"Temporary
    Address Extensions for Stateless Address Autoconfiguration in
    IPv6\"]{.refTitle}, [RFC 8981]{.seriesInfo}, [DOI
    10.17487/RFC8981]{.seriesInfo}, February 2021,
    \<<https://www.rfc-editor.org/info/rfc8981>\>.
:   
:::
:::

::: {#testVectors}
::: {#section-appendix.a .section}
## [Appendix A.](#section-appendix.a){.section-number .selfRef} [Test Vectors](#name-test-vectors){.section-name .selfRef} {#name-test-vectors}

::: {#learning-a-new-server-cookie}
::: {#section-a.1 .section}
## [A.1.](#section-a.1){.section-number .selfRef} [Learning a New Server Cookie](#name-learning-a-new-server-cooki){.section-name .selfRef} {#name-learning-a-new-server-cooki}

A resolver (client) sending from IPv4 address 198.51.100.100 sends a
query for `example.com` to an authoritative server listening on
192.0.2.53 from which it has not yet learned the server
cookie.[¶](#section-a.1-1){.pilcrow}

The DNS requests and replies shown in this appendix are in a
\"dig\"-like format. The content of the DNS COOKIE Option is shown in
hexadecimal format after `; COOKIE:`.[¶](#section-a.1-2){.pilcrow}

::: {#section-a.1-3}
``` sourcecode
;; Sending:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 57406
;; flags:; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 2464c4abcf10c957
;; QUESTION SECTION:
;example.com.                IN      A

;; QUERY SIZE: 52
```

[¶](#section-a.1-3){.pilcrow}
:::

The authoritative nameserver (server) is configured with the following
secret: e5e973e5a6b2a43f48e7dc849e37bfcf (as hex
data).[¶](#section-a.1-4){.pilcrow}

It receives the query on Wed Jun 5 10:53:05 UTC
2019.[¶](#section-a.1-5){.pilcrow}

The content of the DNS COOKIE Option that the server will return is
shown below in hexadecimal format after
`; COOKIE:`.[¶](#section-a.1-6){.pilcrow}

The Timestamp field [Section 4.3](#timestampField){.xref} in the
returned Server Cookie has value 1559731985. In the format described in
\[[RFC3339](#RFC3339){.xref}\], this is 2019-06-05
10:53:05+00:00.[¶](#section-a.1-7){.pilcrow}

::: {#section-a.1-8}
``` sourcecode
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 57406
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 2464c4abcf10c957010000005cf79f111f8130c3eee29480 (good)
;; QUESTION SECTION:
;example.com.                IN      A

;; ANSWER SECTION:
example.com.         86400   IN      A       192.0.2.34

;; Query time: 6 msec
;; SERVER: 192.0.2.53#53(192.0.2.53)
;; WHEN: Wed Jun  5 10:53:05 UTC 2019
;; MSD SIZE  rcvd: 84
```

[¶](#section-a.1-8){.pilcrow}
:::
:::
:::

::: {#the-same-client-learning-a-renewed-fresh-server-cookie}
::: {#section-a.2 .section}
## [A.2.](#section-a.2){.section-number .selfRef} [The Same Client Learning a Renewed (Fresh) Server Cookie](#name-the-same-client-learning-a-){.section-name .selfRef} {#name-the-same-client-learning-a-}

40 minutes later, the same resolver (client) queries the same server for
`example.org`. It reuses the Server Cookie it learned in the previous
query.[¶](#section-a.2-1){.pilcrow}

The Timestamp field in that previously learned Server Cookie, which is
now sent along in the request, was and is 1559731985. In the format of
\[[RFC3339](#RFC3339){.xref}\], this is 2019-06-05
10:53:05+00:00.[¶](#section-a.2-2){.pilcrow}

::: {#section-a.2-3}
``` sourcecode
;; Sending:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 50939
;; flags:; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 2464c4abcf10c957010000005cf79f111f8130c3eee29480
;; QUESTION SECTION:
;example.org.                IN      A

;; QUERY SIZE: 52
```

[¶](#section-a.2-3){.pilcrow}
:::

The authoritative nameserver (server) now generates a new Server Cookie.
The server [SHOULD]{.bcp14} do this because it can see the Server Cookie
sent by the client is older than half an hour ([Section
4.3](#timestampField){.xref}), but it is also fine for a server to
generate a new Server Cookie sooner or even for every
answer.[¶](#section-a.2-4){.pilcrow}

The Timestamp field in the returned new Server Cookie has value
1559734385, which, in the format of \[[RFC3339](#RFC3339){.xref}\], is
2019-06-05 11:33:05+00:00.[¶](#section-a.2-5){.pilcrow}

::: {#section-a.2-6}
``` sourcecode
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 50939
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 2464c4abcf10c957010000005cf7a871d4a564a1442aca77 (good)
;; QUESTION SECTION:
;example.org.                IN      A

;; ANSWER SECTION:
example.org.         86400   IN      A       192.0.2.34

;; Query time: 6 msec
;; SERVER: 192.0.2.53#53(192.0.2.53)
;; WHEN: Wed Jun  5 11:33:05 UTC 2019
;; MSD SIZE  rcvd: 84
```

[¶](#section-a.2-6){.pilcrow}
:::
:::
:::

::: {#another-client-learning-a-renewed-server-cookie}
::: {#section-a.3 .section}
## [A.3.](#section-a.3){.section-number .selfRef} [Another Client Learning a Renewed Server Cookie](#name-another-client-learning-a-r){.section-name .selfRef} {#name-another-client-learning-a-r}

Another resolver (client) with IPv4 address 203.0.113.203 sends a
request to the same server with a valid Server Cookie that it learned
before (on Wed Jun 5 09:46:25 UTC 2019).[¶](#section-a.3-1){.pilcrow}

The Timestamp field of the Server Cookie in the request has value
1559727985, which, in the format of \[[RFC3339](#RFC3339){.xref}\], is
2019-06-05 09:46:25+00:00.[¶](#section-a.3-2){.pilcrow}

Note that the Server Cookie has Reserved bytes set but is still valid
with the configured secret; the Hash part is calculated taking along the
Reserved bytes.[¶](#section-a.3-3){.pilcrow}

::: {#section-a.3-4}
``` sourcecode
;; Sending:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 34736
;; flags:; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: fc93fc62807ddb8601abcdef5cf78f71a314227b6679ebf5
;; QUESTION SECTION:
;example.com.                IN      A

;; QUERY SIZE: 52
```

[¶](#section-a.3-4){.pilcrow}
:::

The authoritative nameserver (server) replies with a freshly generated
Server Cookie for this client conformant with this specification, i.e.,
with the Reserved bits set to zero.[¶](#section-a.3-5){.pilcrow}

The Timestamp field in the returned new Server Cookie has value
1559734700, which, in the format of \[[RFC3339](#RFC3339){.xref}\], is
2019-06-05 11:38:20+00:00.[¶](#section-a.3-6){.pilcrow}

::: {#section-a.3-7}
``` sourcecode
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 34736
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: fc93fc62807ddb86010000005cf7a9acf73a7810aca2381e (good)
;; QUESTION SECTION:
;example.com.                IN      A

;; ANSWER SECTION:
example.com.         86400   IN      A       192.0.2.34

;; Query time: 6 msec
;; SERVER: 192.0.2.53#53(192.0.2.53)
;; WHEN: Wed Jun  5 11:38:20 UTC 2019
;; MSD SIZE  rcvd: 84
```

[¶](#section-a.3-7){.pilcrow}
:::
:::
:::

::: {#ipv6-query-with-rolled-over-secret}
::: {#section-a.4 .section}
## [A.4.](#section-a.4){.section-number .selfRef} [IPv6 Query with Rolled Over Secret](#name-ipv6-query-with-rolled-over){.section-name .selfRef} {#name-ipv6-query-with-rolled-over}

The query below is from a client with IPv6 address
2001:db8:220:1:59de:d0f4:8769:82b8 to a server with IPv6 address
2001:db8:8f::53. The client has learned a valid Server Cookie before (on
Wed Jun 5 13:36:57 UTC 2019) when the Server had the secret:
dd3bdf9344b678b185a6f5cb60fca715. The server now uses a new secret, but
it can still validate the Server Cookie provided by the client as the
old secret has not expired yet.[¶](#section-a.4-1){.pilcrow}

The Timestamp field in the Server Cookie in the request has value
1559741817, which, in the format of \[[RFC3339](#RFC3339){.xref}\], is
2019-06-05 13:36:57+00:00.[¶](#section-a.4-2){.pilcrow}

::: {#section-a.4-3}
``` sourcecode
;; Sending:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 6774
;; flags:; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 22681ab97d52c298010000005cf7c57926556bd0934c72f8
;; QUESTION SECTION:
;example.net.                IN      A

;; QUERY SIZE: 52
```

[¶](#section-a.4-3){.pilcrow}
:::

The authoritative nameserver (server) replies with a freshly generated
server cookie for this client with its new secret:
445536bcd2513298075a5d379663c962.[¶](#section-a.4-4){.pilcrow}

The Timestamp field in the returned new Server Cookie has value
1559741961, which, in the format of \[[RFC3339](#RFC3339){.xref}\], is
2019-06-05 13:39:21+00:00.[¶](#section-a.4-5){.pilcrow}

::: {#section-a.4-6}
``` sourcecode
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 6774
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 22681ab97d52c298010000005cf7c609a6bb79d16625507a (good)
;; QUESTION SECTION:
;example.net.                IN      A

;; ANSWER SECTION:
example.net.         86400   IN      A       192.0.2.34

;; Query time: 6 msec
;; SERVER: 2001:db8:8f::53#53(2001:db8:8f::53)
;; WHEN: Wed Jun  5 13:36:57 UTC 2019
;; MSD SIZE  rcvd: 84
```

[¶](#section-a.4-6){.pilcrow}
:::
:::
:::
:::
:::

::: {#implementation-status}
::: {#section-appendix.b .section}
## [Appendix B.](#section-appendix.b){.section-number .selfRef} [Implementation Status](#name-implementation-status){.section-name .selfRef} {#name-implementation-status}

At the time of writing, BIND from version 9.16 and Knot DNS from version
2.9.0 create Server Cookies according to the recipe described in this
document. Unbound and NSD have a Proof-of-Concept implementation that
has been tested for interoperability during the hackathon at IETF 104 in
Prague. Construction of privacy maintaining Client Cookies according to
the directions in this document have been implemented in the getdns
library and will be in the upcoming getdns-1.6.1 release and in Stubby
version 0.3.1.[¶](#section-appendix.b-1){.pilcrow}
:::
:::

::: {#acknowledgements}
::: {#section-appendix.c .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

Thanks to [Witold Krecicki]{.contact-name} and [Pieter
Lexis]{.contact-name} for valuable input, suggestions, text, and above
all for implementing a prototype of an interoperable DNS Cookie in
Bind9, Knot, and PowerDNS during the hackathon at IETF 104 in Prague.
Thanks for valuable input and suggestions go to [Ralph
Dolmans]{.contact-name}, [Bob Harold]{.contact-name}, [Daniel
Salzman]{.contact-name}, [Martin Hoffmann]{.contact-name}, [Mukund
Sivaraman]{.contact-name}, [Petr Spacek]{.contact-name}, [Loganaden
Velvindron]{.contact-name}, [Bob Harold]{.contact-name}, [Philip
Homburg]{.contact-name}, [Tim Wicinski]{.contact-name}, and [Brian
Dickson]{.contact-name}.[¶](#section-appendix.c-1){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#section-appendix.d .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Ondrej Sury]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Internet Systems Consortium]{.org}
:::

::: {.left dir="auto"}
[Czechia]{.country-name}
:::

::: email
Email: <ondrej@isc.org>
:::

::: {.left dir="auto"}
[Willem Toorop]{.fn .nameRole}
:::

::: {.left dir="auto"}
[NLnet Labs]{.org}
:::

::: {.left dir="auto"}
[Science Park 400]{.street-address}
:::

::: {.left dir="auto"}
[1098 XH]{.postal-code} [Amsterdam]{.locality}
:::

::: {.left dir="auto"}
[Netherlands]{.country-name}
:::

::: email
Email: <willem@nlnetlabs.nl>
:::

::: {.left dir="auto"}
[Donald E. Eastlake 3rd]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Futurewei Technologies]{.org}
:::

::: {.left dir="auto"}
[2386 Panoramic Circle]{.street-address}
:::

::: {.left dir="auto"}
[Apopka]{.locality}, [FL 32703]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: tel
Phone: [+1-508-333-2270](tel:+1-508-333-2270){.tel}
:::

::: email
Email: <d3e3e3@gmail.com>
:::

::: {.left dir="auto"}
[Mark Andrews]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Internet Systems Consortium]{.org}
:::

::: {.left dir="auto"}
[950 Charter Street]{.street-address}
:::

::: {.left dir="auto"}
[Redwood City]{.locality}, [CA 94063]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <marka@isc.org>
:::
:::
:::
