  RFC 9148               EST-coaps         April 2022
  ---------------------- ----------------- ------------
  van der Stok, et al.   Standards Track   \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9148](https://www.rfc-editor.org/rfc/rfc9148){.eref}

Category:
:   Standards Track

Published:
:   April 2022

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    P. van der Stok
    :::

    ::: org
    Consultant
    :::
    :::

    ::: author
    ::: author-name
    P. Kampanakis
    :::

    ::: org
    Cisco Systems
    :::
    :::

    ::: author
    ::: author-name
    M. Richardson
    :::

    ::: org
    SSW
    :::
    :::

    ::: author
    ::: author-name
    S. Raza
    :::

    ::: org
    RISE Research Institutes of Sweden
    :::
    :::
:::

# RFC 9148 {#rfcnum}

# EST-coaps: Enrollment over Secure Transport with the Secure Constrained Application Protocol {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

Enrollment over Secure Transport (EST) is used as a certificate
provisioning protocol over HTTPS. Low-resource devices often use the
lightweight Constrained Application Protocol (CoAP) for message
exchanges. This document defines how to transport EST payloads over
secure CoAP (EST-coaps), which allows constrained devices to use
existing EST functionality for provisioning
certificates.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9148>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2022 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Revised BSD License text as described in Section 4.e of the Trust Legal
Provisions and are provided without warranty as described in the Revised
BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Terminology](#name-terminology){.xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [DTLS and Conformance to RFC 7925
    Profiles](#name-dtls-and-conformance-to-rfc){.xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Protocol
    Design](#name-protocol-design){.xref}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [Discovery and
        URIs](#name-discovery-and-uris){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [Mandatory/Optional EST
        Functions](#name-mandatory-optional-est-func){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [Payload
        Formats](#name-payload-formats){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.xref}.  [Message
        Bindings](#name-message-bindings){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.5}
        [4.5](#section-4.5){.xref}.  [CoAP Response
        Codes](#name-coap-response-codes){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.6}
        [4.6](#section-4.6){.xref}.  [Message
        Fragmentation](#name-message-fragmentation){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.7}
        [4.7](#section-4.7){.xref}.  [Delayed
        Responses](#name-delayed-responses){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.8}
        [4.8](#section-4.8){.xref}.  [Server-Side Key
        Generation](#name-server-side-key-generation){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [HTTPS-CoAPS
    Registrar](#name-https-coaps-registrar){.xref}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Parameters](#name-parameters){.xref}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Deployment
    Limitations](#name-deployment-limitations){.xref}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Content-Formats
        Registry](#name-content-formats-registry){.xref}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Resource Type
        Registry](#name-resource-type-registry){.xref}
        :::

    -   ::: {#section-toc.1-1.8.2.3}
        [8.3](#section-8.3){.xref}.  [Well-Known URIs
        Registry](#name-well-known-uris-registry){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [EST Server
        Considerations](#name-est-server-considerations){.xref}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [HTTPS-CoAPS Registrar
        Considerations](#name-https-coaps-registrar-consi){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [References](#name-references){.xref}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [Normative
        References](#name-normative-references){.xref}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Informative
        References](#name-informative-references){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [Appendix A](#appendix-A){.xref}.  [EST Messages to
    EST-coaps](#name-est-messages-to-est-coaps){.xref}

    -   ::: {#section-toc.1-1.11.2.1}
        [A.1](#appendix-A.1){.xref}.  [cacerts](#name-cacerts){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.2}
        [A.2](#appendix-A.2){.xref}.  [enroll /
        reenroll](#name-enroll-reenroll){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.3}
        [A.3](#appendix-A.3){.xref}.  [serverkeygen](#name-serverkeygen){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.4}
        [A.4](#appendix-A.4){.xref}.  [csrattrs](#name-csrattrs){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.12}
    [Appendix B](#appendix-B){.xref}.  [EST-coaps Block Message
    Examples](#name-est-coaps-block-message-exa){.xref}

    -   ::: {#section-toc.1-1.12.2.1}
        [B.1](#appendix-B.1){.xref}.  [cacerts](#name-cacerts-2){.xref}
        :::

    -   ::: {#section-toc.1-1.12.2.2}
        [B.2](#appendix-B.2){.xref}.  [enroll /
        reenroll](#name-enroll-reenroll-2){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.13}
    [Appendix C](#appendix-C){.xref}.  [Message Content
    Breakdown](#name-message-content-breakdown){.xref}

    -   ::: {#section-toc.1-1.13.2.1}
        [C.1](#appendix-C.1){.xref}.  [cacerts](#name-cacerts-3){.xref}
        :::

    -   ::: {#section-toc.1-1.13.2.2}
        [C.2](#appendix-C.2){.xref}.  [enroll /
        reenroll](#name-enroll-reenroll-3){.xref}
        :::

    -   ::: {#section-toc.1-1.13.2.3}
        [C.3](#appendix-C.3){.xref}.  [serverkeygen](#name-serverkeygen-2){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.14}
    [](#appendix-D){.xref}[Acknowledgements](#name-acknowledgements){.xref}
    :::

-   ::: {#section-toc.1-1.15}
    [](#appendix-E){.xref}[Contributors](#name-contributors){.xref}
    :::

-   ::: {#section-toc.1-1.16}
    [](#appendix-F){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}
    :::
:::
:::

::: {#intro}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

\"Classical\" Enrollment over Secure Transport (EST)
\[[RFC7030](#RFC7030){.xref}\] is used for authenticated/authorized
endpoint certificate enrollment (and optionally key provisioning)
through a Certification Authority (CA) or Registration Authority (RA).
EST transports messages over HTTPS.[¶](#section-1-1){.pilcrow}

This document defines a new transport for EST based on the Constrained
Application Protocol (CoAP) since some Internet of Things (IoT) devices
use CoAP instead of HTTP. Therefore, this specification utilizes DTLS
\[[RFC6347](#RFC6347){.xref}\] and CoAP \[[RFC7252](#RFC7252){.xref}\]
instead of TLS \[[RFC8446](#RFC8446){.xref}\] and HTTP
\[[RFC7230](#RFC7230){.xref}\].[¶](#section-1-2){.pilcrow}

EST responses can be relatively large, and for this reason, this
specification also uses CoAP Block-Wise Transfer
\[[RFC7959](#RFC7959){.xref}\] to offer a fragmentation mechanism of EST
messages at the CoAP layer.[¶](#section-1-3){.pilcrow}

This document also profiles the use of EST to support certificate-based
client authentication only. Neither HTTP Basic nor Digest authentication
(as described in [Section
3.2.3](https://www.rfc-editor.org/rfc/rfc7030#section-3.2.3){.relref} of
\[[RFC7030](#RFC7030){.xref}\]) is supported.[¶](#section-1-4){.pilcrow}
:::
:::

::: {#terminology}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}

Many of the concepts in this document are taken from
\[[RFC7030](#RFC7030){.xref}\]. Consequently, much text is directly
traceable to \[[RFC7030](#RFC7030){.xref}\].[¶](#section-2-2){.pilcrow}
:::
:::

::: {#profile7925}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [DTLS and Conformance to RFC 7925 Profiles](#name-dtls-and-conformance-to-rfc){.section-name .selfRef} {#name-dtls-and-conformance-to-rfc}

This section describes how EST-coaps conforms to the profiles of
low-resource devices described in \[[RFC7925](#RFC7925){.xref}\].
EST-coaps can transport certificates and private keys. Certificates are
responses to (re-)enrollment requests or requests for a trusted
certificate list. Private keys can be transported as responses to a
server-side key generation request as described in [Section
4.4](https://www.rfc-editor.org/rfc/rfc7030#section-4.4){.relref} of
\[[RFC7030](#RFC7030){.xref}\] (and subsections) and discussed in
[Section 4.8](#serverkey){.xref} of this
document.[¶](#section-3-1){.pilcrow}

EST-coaps depends on a secure transport mechanism that secures the
exchanged CoAP messages. DTLS is one such secure protocol. No other
changes are necessary regarding the secure transport of EST
messages.[¶](#section-3-2){.pilcrow}

[]{#name-est-coaps-protocol-layers}

::: {#est-coaps-layers}
::: {#section-3-3.1 .alignCenter .art-text .artwork}
    +------------------------------------------------+
    |    EST request/response messages               |
    +------------------------------------------------+
    |    CoAP for message transfer and signaling     |
    +------------------------------------------------+
    |    Secure Transport                            |
    +------------------------------------------------+
:::

[Figure 1](#figure-1){.selfRef}: [EST-coaps Protocol
Layers](#name-est-coaps-protocol-layers){.selfRef}
:::

In accordance with Sections
[3.3](https://www.rfc-editor.org/rfc/rfc7925#section-3.3){.relref} and
[4.4](https://www.rfc-editor.org/rfc/rfc7925#section-4.4){.relref} of
\[[RFC7925](#RFC7925){.xref}\], the mandatory cipher suite for DTLS in
EST-coaps is TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8
\[[RFC7251](#RFC7251){.xref}\]. Curve secp256r1 [MUST]{.bcp14} be
supported \[[RFC8422](#RFC8422){.xref}\]; this curve is equivalent to
the NIST P-256 curve. After the publication of
\[[RFC7748](#RFC7748){.xref}\], support for Curve25519 will likely be
required in the future by (D)TLS profiles for the Internet of Things
\[[RFC7925](#RFC7925){.xref}\].[¶](#section-3-4){.pilcrow}

DTLS 1.2 implementations must use the Supported Elliptic Curves and
Supported Point Formats Extensions in \[[RFC8422](#RFC8422){.xref}\].
Uncompressed point format must also be supported. DTLS 1.3
\[[RFC9147](#RFC9147){.xref}\] implementations differ from DTLS 1.2
because they do not support point format negotiation in favor of a
single point format for each curve. Thus, support for DTLS 1.3 does not
mandate point format extensions and negotiation. In addition, in DTLS
1.3, the Supported Elliptic Curves extension has been renamed to
Supported Groups.[¶](#section-3-5){.pilcrow}

CoAP was designed to avoid IP fragmentation. DTLS is used to secure CoAP
messages. However, fragmentation is still possible at the DTLS layer
during the DTLS handshake even when using Elliptic Curve Cryptography
(ECC) cipher suites. If fragmentation is necessary, \"DTLS provides a
mechanism for fragmenting a handshake message over a number of records,
each of which can be transmitted separately, thus avoiding IP
fragmentation\"
\[[RFC6347](#RFC6347){.xref}\].[¶](#section-3-6){.pilcrow}

The authentication of the EST-coaps server by the EST-coaps client is
based on certificate authentication in the DTLS handshake. The EST-coaps
client [MUST]{.bcp14} be configured with at least an Implicit Trust
Anchor database, which will enable the authentication of the server the
first time before updating its trust anchor (Explicit TA)
\[[RFC7030](#RFC7030){.xref}\].[¶](#section-3-7){.pilcrow}

The authentication of the EST-coaps client [MUST]{.bcp14} be with a
client certificate in the DTLS handshake. This can either
be:[¶](#section-3-8){.pilcrow}

-   [A previously issued client certificate (e.g., an existing
    certificate issued by the EST CA); this could be a common case for
    simple re-enrollment of
    clients.[¶](#section-3-9.1){.pilcrow}]{#section-3-9.1}
-   [A previously installed certificate (e.g., manufacturer IDevID
    \[[IEEE802.1AR](#IEEE802.1AR){.xref}\] or a certificate issued by
    some other party). IDevID\'s are expected to have a very long life,
    as long as the device, but under some conditions could expire. In
    that case, the server [MAY]{.bcp14} authenticate a client
    certificate against its trust store though the certificate is
    expired ([Section
    9](#sec){.xref}).[¶](#section-3-9.2){.pilcrow}]{#section-3-9.2}

EST-coaps supports the certificate types and TAs that are specified for
EST in [Section
3](https://www.rfc-editor.org/rfc/rfc7030#section-3){.relref} of
\[[RFC7030](#RFC7030){.xref}\].[¶](#section-3-10){.pilcrow}

As described in [Section
2.1](https://www.rfc-editor.org/rfc/rfc5272#section-2.1){.relref} of
\[[RFC5272](#RFC5272){.xref}\], proof-of-identity refers to a value that
can be used to prove that an end entity or client is in the possession
of and can use the private key corresponding to the certified public
key. Additionally, channel-binding information can link
proof-of-identity with an established connection. Connection-based
proof-of-possession is [OPTIONAL]{.bcp14} for EST-coaps clients and
servers. When proof-of-possession is desired, a set of actions are
required regarding the use of tls-unique, described in [Section
3.5](https://www.rfc-editor.org/rfc/rfc7030#section-3.5){.relref} of
\[[RFC7030](#RFC7030){.xref}\]. The tls-unique information consists of
the contents of the first Finished message in the (D)TLS handshake
between server and client \[[RFC5929](#RFC5929){.xref}\]. The client
adds the Finished message as a challengePassword in the attributes
section of the PKCS #10 CertificationRequest
\[[RFC5967](#RFC5967){.xref}\] to prove that the client is indeed in
control of the private key at the time of the (D)TLS session
establishment. In the case of handshake message fragmentation, if
proof-of-possession is desired, the Finished message added as the
challengePassword in the Certificate Signing Request (CSR) is calculated
as specified by (D)TLS. We summarize it here for convenience. For DTLS
1.2, in the event of handshake message fragmentation, the hash of the
handshake messages used in the Message Authentication Code (MAC)
calculation of the Finished message must be computed on each reassembled
message, as if each message had not been fragmented ([Section
4.2.6](https://www.rfc-editor.org/rfc/rfc6347#section-4.2.6){.relref} of
\[[RFC6347](#RFC6347){.xref}\]). The Finished message is calculated as
shown in [Section
7.4.9](https://www.rfc-editor.org/rfc/rfc5246#section-7.4.9){.relref} of
\[[RFC5246](#RFC5246){.xref}\].[¶](#section-3-11){.pilcrow}

For (D)TLS 1.3, [Appendix
C.5](https://www.rfc-editor.org/rfc/rfc8446#appendix-C.5){.relref} of
\[[RFC8446](#RFC8446){.xref}\] describes the lack of channel bindings
similar to tls-unique.
\[[TLS13-CHANNEL-BINDINGS](#I-D.ietf-kitten-tls-channel-bindings-for-tls13){.xref}\]
can be used instead to derive a 32-byte tls-exporter binding from the
(D)TLS 1.3 master secret by using a PRF negotiated in the (D)TLS 1.3
handshake, \"EXPORTER-Channel-Binding\" with no terminating NUL as the
label, the ClientHello.random and ServerHello.random, and a zero-length
context string. When proof-of-possession is desired, the client adds the
tls-exporter value as a challengePassword in the attributes section of
the PKCS #10 CertificationRequest \[[RFC5967](#RFC5967){.xref}\] to
prove that the client is indeed in control of the private key at the
time of the (D)TLS session establishment.[¶](#section-3-12){.pilcrow}

In a constrained CoAP environment, endpoints can\'t always afford to
establish a DTLS connection for every EST transaction. An EST-coaps DTLS
connection [MAY]{.bcp14} remain open for sequential EST transactions,
which was not the case with \[[RFC7030](#RFC7030){.xref}\]. For example,
if a /crts request is followed by a /sen request, both can use the same
authenticated DTLS connection. However, when a /crts request is included
in the set of sequential EST transactions, some additional security
considerations apply regarding the use of the Implicit and Explicit TA
database as explained in [Section
9.1](#sec-est){.xref}.[¶](#section-3-13){.pilcrow}

Given that after a successful enrollment, it is more likely that a new
EST transaction will not take place for a significant amount of time,
the DTLS connections [SHOULD]{.bcp14} only be kept alive for EST
messages that are relatively close to each other. These could include a
/sen immediately following a /crts when a device is getting
bootstrapped. In some cases, like NAT rebinding, keeping the state of a
connection is not possible when devices sleep for extended periods of
time. In such occasions, \[[RFC9146](#RFC9146){.xref}\] negotiates a
connection ID that can eliminate the need for a new handshake and its
additional cost; or, DTLS session resumption provides a less costly
alternative than redoing a full DTLS
handshake.[¶](#section-3-14){.pilcrow}
:::
:::

::: {#design}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Protocol Design](#name-protocol-design){.section-name .selfRef} {#name-protocol-design}

EST-coaps uses CoAP to transfer EST messages, aided by Block-Wise
Transfer \[[RFC7959](#RFC7959){.xref}\], to avoid IP fragmentation. The
use of blocks for the transfer of larger EST messages is specified in
[Section 4.6](#fragment){.xref}. [Figure 1](#est-coaps-layers){.xref}
shows the layered EST-coaps architecture.[¶](#section-4-1){.pilcrow}

The EST-coaps protocol design follows closely the EST design. The
supported message types in EST-coaps are:[¶](#section-4-2){.pilcrow}

-   [CA certificate retrieval needed to receive the complete set of CA
    certificates.[¶](#section-4-3.1){.pilcrow}]{#section-4-3.1}
-   [Simple enroll and re-enroll for a CA to sign client identity public
    keys.[¶](#section-4-3.2){.pilcrow}]{#section-4-3.2}
-   [Certificate Signing Request (CSR) attribute messages that informs
    the client of the fields to include in a
    CSR.[¶](#section-4-3.3){.pilcrow}]{#section-4-3.3}
-   [Server-side key generation messages to provide a client identity
    private key when the client chooses
    so.[¶](#section-4-3.4){.pilcrow}]{#section-4-3.4}

While \[[RFC7030](#RFC7030){.xref}\] permits a number of the EST
functions to be used without authentication, this specification requires
that the client [MUST]{.bcp14} be authenticated for all
functions.[¶](#section-4-4){.pilcrow}

::: {#discovery}
::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [Discovery and URIs](#name-discovery-and-uris){.section-name .selfRef} {#name-discovery-and-uris}

EST-coaps is targeted for low-resource networks with small packets. Two
types of installations are possible: (1) a rigid one, where the address
and the supported functions of the EST server(s) are known, and (2) a
flexible one, where the EST server and its supported functions need to
be discovered.[¶](#section-4.1-1){.pilcrow}

For both types of installations, saving header space is important and
short EST-coaps URIs are specified in this document. These URIs are
shorter than the ones in \[[RFC7030](#RFC7030){.xref}\]. Two example
EST-coaps resource path names are:[¶](#section-4.1-2){.pilcrow}

::: {#section-4.1-3 .alignLeft .art-text .artwork}
    coaps://example.com:<port>/.well-known/est/<short-est>
    coaps://example.com:<port>/.well-known/est/ArbitraryLabel/<short-est>

[¶](#section-4.1-3){.pilcrow}
:::

The short-est strings are defined in [Table 1](#est-uri){.xref}.
Arbitrary Labels are usually defined and used by EST CAs in order to
route client requests to the appropriate certificate profile.
Implementers should consider using short labels to minimize transmission
overhead.[¶](#section-4.1-4){.pilcrow}

The EST-coaps server URIs, obtained through discovery of the EST-coaps
resource(s) as shown below, are of the
form:[¶](#section-4.1-5){.pilcrow}

::: {#section-4.1-6 .alignLeft .art-text .artwork}
    coaps://example.com:<port>/<root-resource>/<short-est>
    coaps://example.com:<port>/<root-resource>/ArbitraryLabel/<short-est>

[¶](#section-4.1-6){.pilcrow}
:::

Figure 5 in [Section
3.2.2](https://www.rfc-editor.org/rfc/rfc7030#section-3.2.2){.relref} of
\[[RFC7030](#RFC7030){.xref}\] enumerates the operations and
corresponding paths that are supported by EST. [Table
1](#est-uri){.xref} provides the mapping from the EST URI path to the
shorter EST-coaps URI path.[¶](#section-4.1-7){.pilcrow}

[]{#name-short-est-coaps-uri-path}

::: {#est-uri}
  EST               EST-coaps
  ----------------- ------------------------------
  /cacerts          /crts
  /simpleenroll     /sen
  /simplereenroll   /sren
  /serverkeygen     /skg (PKCS #7)
  /serverkeygen     /skc (application/pkix-cert)
  /csrattrs         /att

  : [Table 1](#table-1){.selfRef}: [Short EST-coaps URI
  Path](#name-short-est-coaps-uri-path){.selfRef}
:::

The /skg message is the EST /serverkeygen equivalent where the client
requests a certificate in PKCS #7 format and a private key. If the
client prefers a single application/pkix-cert certificate instead of
PKCS #7, it will make an /skc request. In both cases (i.e., /skg, /skc),
a private key [MUST]{.bcp14} be returned.[¶](#section-4.1-9){.pilcrow}

Clients and servers [MUST]{.bcp14} support the short resource EST-coaps
URIs.[¶](#section-4.1-10){.pilcrow}

In the context of CoAP, the presence and location of (path to) the EST
resources are discovered by sending a GET request to
\"/.well-known/core\" including a resource type (RT) parameter with the
value \"ace.est\*\" \[[RFC6690](#RFC6690){.xref}\]. The example below
shows the discovery over CoAPS of the presence and location of EST-coaps
resources. Linefeeds are included only for
readability.[¶](#section-4.1-11){.pilcrow}

::: {#section-4.1-12}
``` {.lang-core-link-format .sourcecode}
  REQ: GET /.well-known/core?rt=ace.est*

  RES: 2.05 Content
</est/crts>;rt="ace.est.crts";ct="281 287",
</est/sen>;rt="ace.est.sen";ct="281 287",
</est/sren>;rt="ace.est.sren";ct="281 287",
</est/att>;rt="ace.est.att";ct=285,
</est/skg>;rt="ace.est.skg";ct=62,
</est/skc>;rt="ace.est.skc";ct=62
```

[¶](#section-4.1-12){.pilcrow}
:::

The first three lines, describing ace.est.crts, ace.est.sen, and
ace.est.sren, of the discovery response above [MUST]{.bcp14} be returned
if the server supports resource discovery. The last three lines are only
included if the corresponding EST functions are implemented (see [Table
2](#est-implementation){.xref}). The Content-Formats in the response
allow the client to request one that is supported by the server. These
are the values that would be sent in the client request with an Accept
Option.[¶](#section-4.1-13){.pilcrow}

Discoverable port numbers can be returned in the response payload. An
example response payload for non-default CoAPS server port 61617 follows
below. Linefeeds are included only for
readability.[¶](#section-4.1-14){.pilcrow}

::: {#section-4.1-15}
``` {.lang-core-link-format .sourcecode}
  REQ: GET /.well-known/core?rt=ace.est*

  RES: 2.05 Content
<coaps://[2001:db8:3::123]:61617/est/crts>;rt="ace.est.crts";
              ct="281 287",
<coaps://[2001:db8:3::123]:61617/est/sen>;rt="ace.est.sen";
              ct="281 287",
<coaps://[2001:db8:3::123]:61617/est/sren>;rt="ace.est.sren";
              ct="281 287",
<coaps://[2001:db8:3::123]:61617/est/att>;rt="ace.est.att";
              ct=285,
<coaps://[2001:db8:3::123]:61617/est/skg>;rt="ace.est.skg";
              ct=62,
<coaps://[2001:db8:3::123]:61617/est/skc>;rt="ace.est.skc";
              ct=62
```

[¶](#section-4.1-15){.pilcrow}
:::

The server [MUST]{.bcp14} support the default /.well-known/est root
resource. The server [SHOULD]{.bcp14} support resource discovery when it
supports non-default URIs (like /est or /est/ArbitraryLabel) or ports.
The client [SHOULD]{.bcp14} use resource discovery when it is unaware of
the available EST-coaps resources.[¶](#section-4.1-16){.pilcrow}

Throughout this document, the example root resource of /est is
used.[¶](#section-4.1-17){.pilcrow}
:::
:::

::: {#implementation}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [Mandatory/Optional EST Functions](#name-mandatory-optional-est-func){.section-name .selfRef} {#name-mandatory-optional-est-func}

This specification contains a set of required-to-implement functions,
optional functions, and not-specified functions. The unspecified
functions are deemed too expensive for low-resource devices in payload
and calculation times.[¶](#section-4.2-1){.pilcrow}

[Table 2](#est-implementation){.xref} specifies the
mandatory-to-implement or optional implementation of the EST-coaps
functions. Discovery of the existence of optional functions is described
in [Section 4.1](#discovery){.xref}.[¶](#section-4.2-2){.pilcrow}

[]{#name-list-of-est-coaps-functions}

::: {#est-implementation}
  EST Functions     EST-coaps Implementation
  ----------------- --------------------------
  /cacerts          [MUST]{.bcp14}
  /simpleenroll     [MUST]{.bcp14}
  /simplereenroll   [MUST]{.bcp14}
  /fullcmc          Not specified
  /serverkeygen     [OPTIONAL]{.bcp14}
  /csrattrs         [OPTIONAL]{.bcp14}

  : [Table 2](#table-2){.selfRef}: [List of EST-coaps
  Functions](#name-list-of-est-coaps-functions){.selfRef}
:::
:::
:::

::: {#format}
::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [Payload Formats](#name-payload-formats){.section-name .selfRef} {#name-payload-formats}

EST-coaps is designed for low-resource devices; hence, it does not need
to send Base64-encoded data. Simple binary is more efficient (30%
smaller payload for DER-encoded ASN.1) and well supported by CoAP. Thus,
the payload for a given media type follows the ASN.1 structure of the
media type and is transported in binary
format.[¶](#section-4.3-1){.pilcrow}

The Content-Format (HTTP Content-Type equivalent) of the CoAP message
determines which EST message is transported in the CoAP payload. The
media types specified in the HTTP Content-Type header field ([Section
3.2.4](https://www.rfc-editor.org/rfc/rfc7030#section-3.2.4){.relref} of
\[[RFC7030](#RFC7030){.xref}\]) are specified by the Content-Format
Option (12) of CoAP. The combination of URI-Path and Content-Format in
EST-coaps [MUST]{.bcp14} map to an allowed combination of URI and media
type in EST. The required Content-Formats for these requests and
response messages are defined in [Section 8.1](#Content-Formats){.xref}.
The CoAP response codes are defined in [Section
4.5](#codes){.xref}.[¶](#section-4.3-2){.pilcrow}

Content-Format 287 can be used in place of 281 to carry a single
certificate instead of a PKCS #7 container in a /crts, /sen, /sren, or
/skg response. Content-Format 281 [MUST]{.bcp14} be supported by
EST-coaps servers. Servers [MAY]{.bcp14} also support Content-Format
287. It is up to the client to support only Content-Format 281, 287 or
both. The client will use a CoAP Accept Option in the request to express
the preferred response Content-Format. If an Accept Option is not
included in the request, the client is not expressing any preference and
the server [SHOULD]{.bcp14} choose format
281.[¶](#section-4.3-3){.pilcrow}

Content-Format 286 is used in /sen, /sren, and /skg requests and 285 in
/att responses.[¶](#section-4.3-4){.pilcrow}

A representation with Content-Format identifier 62 contains a collection
of representations along with their respective Content-Format. The
Content-Format identifies the media type application/multipart-core
specified in \[[RFC8710](#RFC8710){.xref}\]. For example, a collection,
containing two representations in response to an EST-coaps server-side
key generation /skg request, could include a private key in PKCS #8
\[[RFC5958](#RFC5958){.xref}\] with Content-Format identifier 284
(0x011C) and a single certificate in a PKCS #7 container with
Content-Format identifier 281 (0x0119). Such a collection would look
like \[284,h\'0123456789abcdef\', 281,h\'fedcba9876543210\'\] in
diagnostic Concise Binary Object Representation (CBOR) notation. The
serialization of such CBOR content would
be:[¶](#section-4.3-5){.pilcrow}

[]{#name-multipart-skg-response-seri}

::: {#section-4.3-6.1}
``` {.lang-cbor-pretty .sourcecode}
   84                  # array(4)
   19 011C             # unsigned(284)
   48                  # bytes(8)
      0123456789ABCDEF # "\x01#Eg\x89\xAB\xCD\xEF"
   19 0119             # unsigned(281)
   48                  # bytes(8)
      FEDCBA9876543210 # "\xFE\xDC\xBA\x98vT2\x10"
```
:::

[Figure 2](#figure-2){.selfRef}: [Multipart /skg Response
Serialization](#name-multipart-skg-response-seri){.selfRef}

When the client makes an /skc request, the certificate returned with the
private key is a single X.509 certificate (not a PKCS #7 container) with
Content-Format identifier 287 (0x011F) instead of 281. In cases where
the private key is encrypted with Cryptographic Message Syntax (CMS) (as
explained in [Section 4.8](#serverkey){.xref}), the Content-Format
identifier is 280 (0x0118) instead of 284. The Content-Format used in
the response is summarized in [Table
3](#skg-skc){.xref}.[¶](#section-4.3-7){.pilcrow}

[]{#name-response-content-formats-fo}

::: {#skg-skc}
  Function   Response, Part 1   Response, Part 2
  ---------- ------------------ ------------------
  /skg       284                281
  /skc       280                287

  : [Table 3](#table-3){.selfRef}: [Response Content-Formats for /skg
  and /skc](#name-response-content-formats-fo){.selfRef}
:::

The key and certificate representations are DER-encoded ASN.1, in its
binary form. An example is shown in [Appendix
A.3](#appskg){.xref}.[¶](#section-4.3-9){.pilcrow}
:::
:::

::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [Message Bindings](#name-message-bindings){.section-name .selfRef} {#name-message-bindings}

The general EST-coaps message characteristics
are:[¶](#section-4.4-1){.pilcrow}

-   [EST-coaps servers sometimes need to provide delayed responses,
    which are preceded by an immediately returned empty ACK or an ACK
    containing response code 5.03 as explained in [Section
    4.7](#pending){.xref}. Thus, it is [RECOMMENDED]{.bcp14} for
    implementers to send EST-coaps requests in Confirmable (CON) CoAP
    messages.[¶](#section-4.4-2.1){.pilcrow}]{#section-4.4-2.1}
-   [The CoAP Options used are Uri-Host, Uri-Path, Uri-Port,
    Content-Format, Block1, Block2, and Accept. These CoAP Options are
    used to communicate the HTTP fields specified in the EST REST
    messages. The Uri-host and Uri-Port Options can be omitted from the
    CoAP message sent on the wire. When omitted, they are logically
    assumed to be the transport protocol destination address and port,
    respectively. Explicit Uri-Host and Uri-Port Options are typically
    used when an endpoint hosts multiple virtual servers and uses the
    Options to route the requests accordingly. Other CoAP Options should
    be handled in accordance with
    \[[RFC7252](#RFC7252){.xref}\].[¶](#section-4.4-2.2){.pilcrow}]{#section-4.4-2.2}
-   [EST URLs are HTTPS based (https://); in CoAP, these are assumed to
    be translated to CoAPS
    (coaps://).[¶](#section-4.4-2.3){.pilcrow}]{#section-4.4-2.3}

[Table 1](#est-uri){.xref} provides the mapping from the EST URI path to
the EST-coaps URI path. [Appendix A](#messagebindings){.xref} includes
some practical examples of EST messages translated to
CoAP.[¶](#section-4.4-3){.pilcrow}
:::

::: {#codes}
::: {#section-4.5 .section}
### [4.5.](#section-4.5){.section-number .selfRef} [CoAP Response Codes](#name-coap-response-codes){.section-name .selfRef} {#name-coap-response-codes}

[Section
5.9](https://www.rfc-editor.org/rfc/rfc7252#section-5.9){.relref} of
\[[RFC7252](#RFC7252){.xref}\] and [Section
7](https://www.rfc-editor.org/rfc/rfc8075#section-7){.relref} of
\[[RFC8075](#RFC8075){.xref}\] specify the mapping of HTTP response
codes to CoAP response codes. The success code in response to an
EST-coaps GET request (/crts, /att) is 2.05. Similarly, 2.04 is used in
successful response to EST-coaps POST requests (/sen, /sren, /skg,
/skc).[¶](#section-4.5-1){.pilcrow}

EST makes use of HTTP 204 or 404 responses when a resource is not
available for the client. In EST-coaps, 2.04 is used in response to a
POST (/sen, /sren, /skg, /skc). 4.04 is used when the resource is not
available for the client.[¶](#section-4.5-2){.pilcrow}

HTTP response code 202 with a Retry-After header field in
\[[RFC7030](#RFC7030){.xref}\] has no equivalent in CoAP. HTTP 202 with
Retry-After is used in EST for delayed server responses. [Section
4.7](#pending){.xref} specifies how EST-coaps handles delayed messages
with 5.03 responses with a Max-Age Option.[¶](#section-4.5-3){.pilcrow}

Additionally, EST\'s HTTP 400, 401, 403, 404, and 503 status codes have
their equivalent CoAP 4.00, 4.01, 4.03, 4.04, and 5.03 response codes in
EST-coaps. [Table 4](#estcoaps-codes){.xref} summarizes the EST-coaps
response codes.[¶](#section-4.5-4){.pilcrow}

[]{#name-est-coaps-response-codes}

::: {#estcoaps-codes}
  Operation                 EST-coaps Response Code   Description
  ------------------------- ------------------------- --------------------------------------------------
  /crts, /att               2.05                      Success. Certs included in the response payload.
                            4.xx / 5.xx               Failure.
  /sen, /skg, /sren, /skc   2.04                      Success. Cert included in the response payload.
                            5.03                      Retry in Max-Age Option time.
                            4.xx / 5.xx               Failure.

  : [Table 4](#table-4){.selfRef}: [EST-coaps Response
  Codes](#name-est-coaps-response-codes){.selfRef}
:::
:::
:::

::: {#fragment}
::: {#section-4.6 .section}
### [4.6.](#section-4.6){.section-number .selfRef} [Message Fragmentation](#name-message-fragmentation){.section-name .selfRef} {#name-message-fragmentation}

DTLS defines fragmentation only for the handshake and not for secure
data exchange (DTLS records). \[[RFC6347](#RFC6347){.xref}\] states that
to avoid using IP fragmentation, which involves error-prone datagram
reconstitution, invokers of the DTLS record layer should size DTLS
records so that they fit within any Path MTU estimates obtained from the
record layer. In addition, invokers residing on 6LoWPAN (IPv6 over
Low-Power Wireless Personal Area Networks) over IEEE 802.15.4 networks
\[[IEEE802.15.4](#IEEE802.15.4){.xref}\] are recommended to size CoAP
messages such that each DTLS record will fit within one or two IEEE
802.15.4 frames.[¶](#section-4.6-1){.pilcrow}

That is not always possible in EST-coaps. Even though ECC certificates
are small in size, they can vary greatly based on signature algorithms,
key sizes, and Object Identifier (OID) fields used. For 256-bit curves,
common Elliptic Curve Digital Signature Algorithm (ECDSA) cert sizes are
500-1000 bytes, which could fluctuate further based on the algorithms,
OIDs, Subject Alternative Names (SANs), and cert fields. For 384-bit
curves, ECDSA certificates increase in size and can sometimes reach
1.5KB. Additionally, there are times when the EST cacerts response from
the server can include multiple certificates that amount to large
payloads. [Section
4.6](https://www.rfc-editor.org/rfc/rfc7252#section-4.6){.relref} of
\[[RFC7252](#RFC7252){.xref}\] (CoAP) describes the possible payload
sizes: \"if nothing is known about the size of the headers, good upper
bounds are 1152 bytes for the message size and 1024 bytes for the
payload size\". [Section
4.6](https://www.rfc-editor.org/rfc/rfc7252#section-4.6){.relref} of
\[[RFC7252](#RFC7252){.xref}\] also suggests that IPv4 implementations
may want to limit themselves to more conservative IPv4 datagram sizes
such as 576 bytes. Even with ECC, EST-coaps messages can still exceed
MTU sizes on the Internet or 6LoWPAN \[[RFC4919](#RFC4919){.xref}\]
([Section 2](https://www.rfc-editor.org/rfc/rfc7959#section-2){.relref}
of \[[RFC7959](#RFC7959){.xref}\]). EST-coaps needs to be able to
fragment messages into multiple DTLS
datagrams.[¶](#section-4.6-2){.pilcrow}

To perform fragmentation in CoAP, \[[RFC7959](#RFC7959){.xref}\]
specifies the Block1 Option for fragmentation of the request payload and
the Block2 Option for fragmentation of the return payload of a CoAP
flow. As explained in [Section
1](https://www.rfc-editor.org/rfc/rfc7959#section-1){.relref} of
\[[RFC7959](#RFC7959){.xref}\], block-wise transfers should be used in
Confirmable CoAP messages to avoid the exacerbation of lost blocks.
EST-coaps servers [MUST]{.bcp14} implement Block1 and Block2. EST-coaps
clients [MUST]{.bcp14} implement Block2. EST-coaps clients
[MUST]{.bcp14} implement Block1 only if they are expecting to send
EST-coaps requests with a packet size that exceeds the path
MTU.[¶](#section-4.6-3){.pilcrow}

\[[RFC7959](#RFC7959){.xref}\] also defines Size1 and Size2 Options to
provide size information about the resource representation in a request
and response. The EST-coaps client and server [MAY]{.bcp14} support
Size1 and Size2 Options.[¶](#section-4.6-4){.pilcrow}

Examples of fragmented EST-coaps messages are shown in [Appendix
B](#blockexamples){.xref}.[¶](#section-4.6-5){.pilcrow}
:::
:::

::: {#pending}
::: {#section-4.7 .section}
### [4.7.](#section-4.7){.section-number .selfRef} [Delayed Responses](#name-delayed-responses){.section-name .selfRef} {#name-delayed-responses}

Server responses can sometimes be delayed. According to [Section
5.2.2](https://www.rfc-editor.org/rfc/rfc7252#section-5.2.2){.relref} of
\[[RFC7252](#RFC7252){.xref}\], a slow server can acknowledge the
request and respond later with the requested resource representation. In
particular, a slow server can respond to an EST-coaps enrollment request
with an empty ACK with code 0.00 before sending the certificate to the
client after a short delay. If the certificate response is large, the
server will need more than one Block2 block to transfer
it.[¶](#section-4.7-1){.pilcrow}

This situation is shown in [Figure 3](#fig-est-short-wait){.xref}. The
client sends an enrollment request that uses N1+1 Block1 blocks. The
server uses an empty 0.00 ACK to announce the delayed response, which is
provided later with 2.04 messages containing N2+1 Block2 Options. The
first 2.04 is a Confirmable message that is acknowledged by the client.
Onwards, the client acknowledges all subsequent Block2 blocks. The
notation of [Figure 3](#fig-est-short-wait){.xref} is explained in
[Appendix B.1](#cacertsblock){.xref}.[¶](#section-4.7-2){.pilcrow}

[]{#name-est-coaps-enrollment-with-s}

::: {#fig-est-short-wait}
::: {#section-4.7-3.1 .alignLeft .art-text .artwork}
    POST [2001:db8::2:1]:61616/est/sen (CON)(1:0/1/256)
                       {CSR (frag# 1)} -->
       <-- (ACK) (1:0/1/256) (2.31 Continue)
    POST [2001:db8::2:1]:61616/est/sen (CON)(1:1/1/256)
                       {CSR (frag# 2)} -->
       <-- (ACK) (1:1/1/256) (2.31 Continue)
                      .
                      .
                      .
    POST [2001:db8::2:1]:61616/est/sen(CON)(1:N1/0/256)
                       {CSR (frag# N1+1)}-->
       <-- (0.00 empty ACK)
                      |
       ... Short delay before the certificate is ready ...
                      |
       <-- (CON) (1:N1/0/256)(2:0/1/256)(2.04 Changed)
                       {Cert resp (frag# 1)}
                                                  (ACK)          -->
    POST [2001:db8::2:1]:61616/est/sen (CON)(2:1/0/256)          -->
       <-- (ACK) (2:1/1/256) (2.04 Changed) {Cert resp (frag# 2)}
                      .
                      .
                      .
    POST [2001:db8::2:1]:61616/est/sen (CON)(2:N2/0/256)          -->
       <-- (ACK) (2:N2/0/256) (2.04 Changed) {Cert resp (frag# N2+1)}
:::

[Figure 3](#figure-3){.selfRef}: [EST-coaps Enrollment with Short
Wait](#name-est-coaps-enrollment-with-s){.selfRef}
:::

If the server is very slow (for example, manual intervention is
required, which would take minutes), it [SHOULD]{.bcp14} respond with an
ACK containing response code 5.03 (Service unavailable) and a Max-Age
Option to indicate the time the client [SHOULD]{.bcp14} wait before
sending another request to obtain the content. After a delay of Max-Age,
the client [SHOULD]{.bcp14} resend the identical CSR to the server. As
long as the server continues to respond with response code 5.03 (Service
Unavailable) with a Max-Age Option, the client will continue to delay
for Max-Age and then resend the enrollment request until the server
responds with the certificate or the client abandons the request due to
policy or other reasons.[¶](#section-4.7-4){.pilcrow}

To demonstrate this scenario, [Figure 4](#fig-est-long-wait){.xref}
shows a client sending an enrollment request that uses N1+1 Block1
blocks to send the CSR to the server. The server needs N2+1 Block2
blocks to respond but also needs to take a long delay (minutes) to
provide the response. Consequently, the server uses a 5.03 ACK response
with a Max-Age Option. The client waits for a period of Max-Age as many
times as it receives the same 5.03 response and retransmits the
enrollment request until it receives a certificate in a fragmented 2.04
response.[¶](#section-4.7-5){.pilcrow}

[]{#name-est-coaps-enrollment-with-l}

::: {#fig-est-long-wait}
::: {#section-4.7-6.1 .alignLeft .art-text .artwork}
    POST [2001:db8::2:1]:61616/est/sen (CON)(1:0/1/256)
                       {CSR (frag# 1)}  -->
      <-- (ACK) (1:0/1/256) (2.31 Continue)
    POST [2001:db8::2:1]:61616/est/sen (CON)(1:1/1/256)
                       {CSR (frag# 2)}  -->
      <-- (ACK) (1:1/1/256) (2.31 Continue)
                      .
                      .
                      .
    POST [2001:db8::2:1]:61616/est/sen(CON)(1:N1/0/256)
                       {CSR (frag# N1+1)}-->
      <-- (ACK) (1:N1/0/256) (5.03 Service Unavailable) (Max-Age)
                      |
                      |
      ... Client tries again after Max-Age with identical payload ...
                      |
                      |
    POST [2001:db8::2:1]:61616/est/sen(CON)(1:0/1/256)
                       {CSR (frag# 1)}-->
      <-- (ACK) (1:0/1/256) (2.31 Continue)
    POST [2001:db8::2:1]:61616/est/sen (CON)(1:1/1/256)
                       {CSR (frag# 2)}  -->
      <-- (ACK) (1:1/1/256) (2.31 Continue)
                      .
                      .
                      .
    POST [2001:db8::2:1]:61616/est/sen(CON)(1:N1/0/256)
                       {CSR (frag# N1+1)}-->
                      |
       ... Immediate response when certificate is ready ...
                      |
      <-- (ACK) (1:N1/0/256) (2:0/1/256) (2.04 Changed)
                       {Cert resp (frag# 1)}
    POST [2001:db8::2:1]:61616/est/sen (CON)(2:1/0/256)           -->
      <-- (ACK) (2:1/1/256) (2.04 Changed) {Cert resp (frag# 2)}
                      .
                      .
                      .
    POST [2001:db8::2:1]:61616/est/sen (CON)(2:N2/0/256)          -->
      <-- (ACK) (2:N2/0/256) (2.04 Changed) {Cert resp (frag# N2+1)}
:::

[Figure 4](#figure-4){.selfRef}: [EST-coaps Enrollment with Long
Wait](#name-est-coaps-enrollment-with-l){.selfRef}
:::
:::
:::

::: {#serverkey}
::: {#section-4.8 .section}
### [4.8.](#section-4.8){.section-number .selfRef} [Server-Side Key Generation](#name-server-side-key-generation){.section-name .selfRef} {#name-server-side-key-generation}

Private keys can be generated on the server to support scenarios where
server-side key generation is needed. Such scenarios include those where
it is considered more secure to generate the long-lived, random private
key that identifies the client at the server, or where the resources
spent to generate a random private key at the client are considered
scarce, or where the security policy requires that the certificate
public and corresponding private keys are centrally generated and
controlled. As always, it is necessary to use proper random numbers in
various protocols such as (D)TLS ([Section
9.1](#sec-est){.xref}).[¶](#section-4.8-1){.pilcrow}

When requesting server-side key generation, the client asks for the
server or proxy to generate the private key and the certificate, which
are transferred back to the client in the server-side key generation
response. In all respects, the server treats the CSR as it would treat
any enroll or re-enroll CSR; the only distinction here is that the
server [MUST]{.bcp14} ignore the public key values and signature in the
CSR. These are included in the request only to allow reuse of existing
codebases for generating and parsing such
requests.[¶](#section-4.8-2){.pilcrow}

The client /skg request is for a certificate in a PKCS #7 container and
private key in two application/multipart-core elements. Respectively, an
/skc request is for a single application/pkix-cert certificate and a
private key. The private key Content-Format requested by the client is
indicated in the PKCS #10 CSR request. If the request contains
SMIMECapabilities and DecryptKeyIdentifier or
AsymmetricDecryptKeyIdentifier, the client is expecting Content-Format
280 for the private key. Then, this private key is encrypted
symmetrically or asymmetrically per \[[RFC7030](#RFC7030){.xref}\]. The
symmetric key or the asymmetric keypair establishment method is out of
scope of this specification. An /skg or /skc request with a CSR without
SMIMECapabilities expects an application/multipart-core with an
unencrypted PKCS #8 private key with Content-Format
284.[¶](#section-4.8-3){.pilcrow}

The EST-coaps server-side key generation response is returned with
Content-Format application/multipart-core \[[RFC8710](#RFC8710){.xref}\]
containing a CBOR array with four items ([Section 4.3](#format){.xref}).
The two representations (each consisting of two CBOR array items) do not
have to be in a particular order since each representation is preceded
by its Content-Format ID. Depending on the request, the private key can
be in unprotected PKCS #8 format \[[RFC5958](#RFC5958){.xref}\]
(Content-Format 284) or protected inside of CMS SignedData
(Content-Format 280). The SignedData, placed in the outermost container,
is signed by the party that generated the private key, which may be the
EST server or the EST CA. SignedData placed within the Enveloped Data
does not need additional signing as explained in [Section
4.4.2](https://www.rfc-editor.org/rfc/rfc7030#section-4.4.2){.relref} of
\[[RFC7030](#RFC7030){.xref}\]. In summary, the symmetrically encrypted
key is included in the encryptedKey attribute in a KEKRecipientInfo
structure. In the case where the asymmetric encryption key is suitable
for transport key operations, the generated private key is encrypted
with a symmetric key. The symmetric key itself is encrypted by the
client-defined (in the CSR) asymmetric public key and is carried in an
encryptedKey attribute in a KeyTransRecipientInfo structure. Finally, if
the asymmetric encryption key is suitable for key agreement, the
generated private key is encrypted with a symmetric key. The symmetric
key itself is encrypted by the client defined (in the CSR) asymmetric
public key and is carried in a recipientEncryptedKeys attribute in a
KeyAgreeRecipientInfo.[¶](#section-4.8-4){.pilcrow}

\[[RFC7030](#RFC7030){.xref}\] recommends the use of additional
encryption of the returned private key. For the context of this
specification, clients and servers that choose to support server-side
key generation [MUST]{.bcp14} support unprotected (PKCS #8) private keys
(Content-Format 284). Symmetric or asymmetric encryption of the private
key (CMS EnvelopedData, Content-Format 280) [SHOULD]{.bcp14} be
supported for deployments where end-to-end encryption is needed between
the client and a server. Such cases could include architectures where an
entity between the client and the CA terminates the DTLS connection
(Registrar in [Figure 5](#RAfig){.xref}). Though
\[[RFC7030](#RFC7030){.xref}\] strongly recommends that clients request
the use of CMS encryption on top of the TLS channel\'s protection, this
document does not make such a recommendation; CMS encryption can still
be used when mandated by the use case.[¶](#section-4.8-5){.pilcrow}
:::
:::
:::
:::

::: {#proxy}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [HTTPS-CoAPS Registrar](#name-https-coaps-registrar){.section-name .selfRef} {#name-https-coaps-registrar}

In real-world deployments, the EST server will not always reside within
the CoAP boundary. The EST server can exist outside the constrained
network, in which case it will support TLS/HTTP instead of CoAPS. In
such environments, EST-coaps is used by the client within the CoAP
boundary and TLS is used to transport the EST messages outside the CoAP
boundary. A Registrar at the edge is required to operate between the
CoAP environment and the external HTTP network as shown in [Figure
5](#RAfig){.xref}.[¶](#section-5-1){.pilcrow}

[]{#name-est-coaps-to-https-registra}

::: {#RAfig}
::: {#section-5-2.1 .alignCenter .art-text .artwork}
                                         Constrained Network
    .------.                         .----------------------------.
    |  CA  |                         |.--------------------------.|
    '------'                         ||                          ||
       |                             ||                          ||
    .------.  HTTP   .------------------.  CoAPS  .-----------.  ||
    | EST  |<------->|EST-coaps-to-HTTPS|<------->| EST Client|  ||
    |Server|over TLS |   Registrar      |         '-----------'  ||
    '------'         '------------------'                        ||
                                     ||                          ||
                                     |'--------------------------'|
                                     '----------------------------'
:::

[Figure 5](#figure-5){.selfRef}: [EST-coaps-to-HTTPS Registrar at the
CoAP Boundary](#name-est-coaps-to-https-registra){.selfRef}
:::

The EST-coaps-to-HTTPS Registrar [MUST]{.bcp14} terminate EST-coaps
downstream and initiate EST connections over TLS upstream. The Registrar
[MUST]{.bcp14} authenticate and optionally authorize the client requests
while it [MUST]{.bcp14} be authenticated by the EST server or CA. The
trust relationship between the Registrar and the EST server
[SHOULD]{.bcp14} be pre-established for the Registrar to proxy these
connections on behalf of various clients.[¶](#section-5-3){.pilcrow}

When enforcing Proof-of-Possession (POP) linking, the tls-unique or
tls-exporter value of the session for DTLS 1.2 and DTLS 1.3,
respectively, is used to prove that the private key corresponding to the
public key is in the possession of the client and was used to establish
the connection as explained in [Section 3](#profile7925){.xref}. The POP
linking information is lost between the EST-coaps client and the EST
server when a Registrar is present. The EST server becomes aware of the
presence of a Registrar from its TLS client certificate that includes
the id-kp-cmcRA extended key usage (EKU) extension
\[[RFC6402](#RFC6402){.xref}\]. As explained in [Section
3.7](https://www.rfc-editor.org/rfc/rfc7030#section-3.7){.relref} of
\[[RFC7030](#RFC7030){.xref}\], the \"EST server [SHOULD]{.bcp14} apply
authorization policy consistent with an RA client \... the EST server
could be configured to accept POP linking information that does not
match the current TLS session because the authenticated EST client RA
has verified this information when acting as an EST
server\".[¶](#section-5-4){.pilcrow}

[Table 1](#est-uri){.xref} contains the URI mappings between EST-coaps
and EST that the Registrar [MUST]{.bcp14} adhere to. [Section
4.5](#codes){.xref} of this specification and [Section
7](https://www.rfc-editor.org/rfc/rfc8075#section-7){.relref} of
\[[RFC8075](#RFC8075){.xref}\] define the mappings between EST-coaps and
HTTP response codes that determine how the Registrar [MUST]{.bcp14}
translate CoAP response codes from/to HTTP status codes. The mapping
from CoAP Content-Format to HTTP Content-Type is defined in [Section
8.1](#Content-Formats){.xref}. Additionally, a conversion from CBOR
major type 2 to Base64 encoding [MUST]{.bcp14} take place at the
Registrar. If CMS end-to-end encryption is employed for the private key,
the encrypted CMS EnvelopedData blob [MUST]{.bcp14} be converted at the
Registrar to binary CBOR type 2 downstream to the client. This is a
format conversion that does not require decryption of the CMS
EnvelopedData.[¶](#section-5-5){.pilcrow}

A deviation from the mappings in [Table 1](#est-uri){.xref} could take
place if clients that leverage server-side key generation preferred for
the enrolled keys to be generated by the Registrar in the case the CA
does not support server-side key generation. Such a Registrar is
responsible for generating a new CSR signed by a new key that will be
returned to the client along with the certificate from the CA. In these
cases, the Registrar [MUST]{.bcp14} use random number generation with
proper entropy.[¶](#section-5-6){.pilcrow}

Due to fragmentation of large messages into blocks, an EST-coaps-to-HTTP
Registrar [MUST]{.bcp14} reassemble the blocks before translating the
binary content to Base64 and consecutively relay the message
upstream.[¶](#section-5-7){.pilcrow}

The EST-coaps-to-HTTP Registrar [MUST]{.bcp14} support resource
discovery according to the rules in [Section
4.1](#discovery){.xref}.[¶](#section-5-8){.pilcrow}
:::
:::

::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Parameters](#name-parameters){.section-name .selfRef} {#name-parameters}

This section addresses transmission parameters described in Sections
[4.7](https://www.rfc-editor.org/rfc/rfc7252#section-4.7){.relref} and
[4.8](https://www.rfc-editor.org/rfc/rfc7252#section-4.8){.relref} of
\[[RFC7252](#RFC7252){.xref}\]. EST does not impose any unique values on
the CoAP parameters in \[[RFC7252](#RFC7252){.xref}\], but the setting
of the CoAP parameter values may have consequence for the setting of the
EST parameter values.[¶](#section-6-1){.pilcrow}

Implementations should follow the default CoAP configuration parameters
\[[RFC7252](#RFC7252){.xref}\]. However, depending on the implementation
scenario, retransmissions and timeouts can also occur on other
networking layers, governed by other configuration parameters. When a
change in a server parameter has taken place, the parameter values in
the communicating endpoints [MUST]{.bcp14} be adjusted as necessary.
Examples of how parameters could be adjusted include higher-layer
congestion protocols, provisioning agents, and configurations included
in firmware updates.[¶](#section-6-2){.pilcrow}

Some further comments about some specific parameters, mainly from Table
2 in \[[RFC7252](#RFC7252){.xref}\], include the
following:[¶](#section-6-3){.pilcrow}

[]{.break}

NSTART:
:   A parameter that controls the number of simultaneous outstanding
    interactions that a client maintains to a given server. An EST-coaps
    client is expected to control at most one interaction with a given
    server, which is the default NSTART value defined in
    \[[RFC7252](#RFC7252){.xref}\].[¶](#section-6-4.2){.pilcrow}
:   

DEFAULT_LEISURE:
:   A setting that is only relevant in multicast scenarios and is
    outside the scope of EST-coaps.[¶](#section-6-4.4){.pilcrow}
:   

PROBING_RATE:
:   A parameter that specifies the rate of resending Non-confirmable
    messages. In the rare situations that Non-confirmable messages are
    used, the default PROBING_RATE value defined in
    \[[RFC7252](#RFC7252){.xref}\] applies.[¶](#section-6-4.6){.pilcrow}
:   

Finally, the Table 3 parameters in \[[RFC7252](#RFC7252){.xref}\] are
mainly derived from Table 2. Directly changing parameters on one table
would affect parameters on the other.[¶](#section-6-5){.pilcrow}
:::

::: {#deploy-limit}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Deployment Limitations](#name-deployment-limitations){.section-name .selfRef} {#name-deployment-limitations}

Although EST-coaps paves the way for the utilization of EST by
constrained devices in constrained networks, some classes of devices
\[[RFC7228](#RFC7228){.xref}\] will not have enough resources to handle
the payloads that come with EST-coaps. The specification of EST-coaps is
intended to ensure that EST works for networks of constrained devices
that choose to limit their communications stack to DTLS/CoAP. It is up
to the network designer to decide which devices execute the EST protocol
and which do not.[¶](#section-7-1){.pilcrow}
:::
:::

::: {#iana}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

::: {#Content-Formats}
::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Content-Formats Registry](#name-content-formats-registry){.section-name .selfRef} {#name-content-formats-registry}

IANA has registered the following Content-Formats given in [Table
5](#Content-Format){.xref} in the \"CoAP Content-Formats\" subregistry
within the \"CoRE Parameters\" registry
\[[CORE-PARAMS](#CORE-PARAMS){.xref}\]. These have been registered in
the IETF Review or IESG Approval range
(256-9999).[¶](#section-8.1-1){.pilcrow}

[]{#name-new-coap-content-formats}

::: {#Content-Format}
  Media Type                                                ID    Reference
  --------------------------------------------------------- ----- ------------------------------------------------------------------------
  application/pkcs7-mime; smime-type=server-generated-key   280   \[[RFC7030](#RFC7030){.xref}\] \[[RFC8551](#RFC8551){.xref}\] RFC 9148
  application/pkcs7-mime; smime-type=certs-only             281   \[[RFC8551](#RFC8551){.xref}\] RFC 9148
  application/pkcs8                                         284   \[[RFC5958](#RFC5958){.xref}\] \[[RFC8551](#RFC8551){.xref}\] RFC 9148
  application/csrattrs                                      285   \[[RFC7030](#RFC7030){.xref}\] RFC 9148
  application/pkcs10                                        286   \[[RFC5967](#RFC5967){.xref}\] \[[RFC8551](#RFC8551){.xref}\] RFC 9148
  application/pkix-cert                                     287   \[[RFC2585](#RFC2585){.xref}\] RFC 9148

  : [Table 5](#table-5){.selfRef}: [New CoAP
  Content-Formats](#name-new-coap-content-formats){.selfRef}
:::
:::
:::

::: {#resource-type}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Resource Type Registry](#name-resource-type-registry){.section-name .selfRef} {#name-resource-type-registry}

IANA has registered the following Resource Type (rt=) Link Target
Attributes given in [Table 6](#rt-table){.xref} in the \"Resource Type
(rt=) Link Target Attribute Values\" subregistry under the \"Constrained
RESTful Environments (CoRE) Parameters\"
registry.[¶](#section-8.2-1){.pilcrow}

[]{#name-new-resource-type-rt-link-t}

::: {#rt-table}
  Value          Description                                                                                                                          Reference
  -------------- ------------------------------------------------------------------------------------------------------------------------------------ -----------
  ace.est.crts   This resource depicts the support of EST GET cacerts.                                                                                RFC 9148
  ace.est.sen    This resource depicts the support of EST simple enroll.                                                                              RFC 9148
  ace.est.sren   This resource depicts the support of EST simple reenroll.                                                                            RFC 9148
  ace.est.att    This resource depicts the support of EST GET CSR attributes.                                                                         RFC 9148
  ace.est.skg    This resource depicts the support of EST server-side key generation with the returned certificate in a PKCS #7 container.            RFC 9148
  ace.est.skc    This resource depicts the support of EST server-side key generation with the returned certificate in application/pkix-cert format.   RFC 9148

  : [Table 6](#table-6){.selfRef}: [New Resource Type (rt=) Link Target
  Attributes](#name-new-resource-type-rt-link-t){.selfRef}
:::
:::
:::

::: {#well-known-uris}
::: {#section-8.3 .section}
### [8.3.](#section-8.3){.section-number .selfRef} [Well-Known URIs Registry](#name-well-known-uris-registry){.section-name .selfRef} {#name-well-known-uris-registry}

IANA has added an additional reference to the est URI in the
\"Well-Known URIs\" registry:[¶](#section-8.3-1){.pilcrow}

[]{.break}

URI Suffix:
:   est[¶](#section-8.3-2.2){.pilcrow}
:   

Change Controller:
:   IETF[¶](#section-8.3-2.4){.pilcrow}
:   

References:
:   \[[RFC7030](#RFC7030){.xref}\] RFC
    9148[¶](#section-8.3-2.6){.pilcrow}
:   

Status:
:   permanent[¶](#section-8.3-2.8){.pilcrow}
:   

Related Information:

:   

:   

Date Registered:
:   2013-08-16[¶](#section-8.3-2.12){.pilcrow}
:   

Date Modified:
:   2020-04-29[¶](#section-8.3-2.14){.pilcrow}
:   
:::
:::
:::
:::

::: {#sec}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

::: {#sec-est}
::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [EST Server Considerations](#name-est-server-considerations){.section-name .selfRef} {#name-est-server-considerations}

The security considerations in [Section
6](https://www.rfc-editor.org/rfc/rfc7030#section-6){.relref} of
\[[RFC7030](#RFC7030){.xref}\] are only partially valid for the purposes
of this document. As HTTP Basic Authentication is not supported, the
considerations expressed for using passwords do not apply. The other
portions of the security considerations in
\[[RFC7030](#RFC7030){.xref}\] continue to
apply.[¶](#section-9.1-1){.pilcrow}

Modern security protocols require random numbers to be available during
the protocol run, for example, for nonces and ephemeral (EC)
Diffie-Hellman key generation. This capability to generate random
numbers is also needed when the constrained device generates the private
key (that corresponds to the public key enrolled in the CSR). When
server-side key generation is used, the constrained device depends on
the server to generate the private key randomly, but it still needs
locally generated random numbers for use in security protocols, as
explained in [Section
12](https://www.rfc-editor.org/rfc/rfc7925#section-12){.relref} of
\[[RFC7925](#RFC7925){.xref}\]. Additionally, the transport of keys
generated at the server is inherently risky. For those deploying
server-side key generation, analysis [SHOULD]{.bcp14} be done to
establish whether server-side key generation increases or decreases the
probability of digital identity theft.[¶](#section-9.1-2){.pilcrow}

It is important to note that, as pointed out in
\[[PsQs](#PsQs){.xref}\], sources contributing to the randomness pool
used to generate random numbers on laptops or desktop PCs, such as mouse
movement, timing of keystrokes, or air turbulence on the movement of
hard drive heads, are not available on many constrained devices. Other
sources have to be used or dedicated hardware has to be added. Selecting
hardware for an IoT device that is capable of producing high-quality
random numbers is therefore important
\[[RSA-FACT](#RSA-FACT){.xref}\].[¶](#section-9.1-3){.pilcrow}

As discussed in [Section
6](https://www.rfc-editor.org/rfc/rfc7030#section-6){.relref} of
\[[RFC7030](#RFC7030){.xref}\], it is[¶](#section-9.1-4){.pilcrow}

> [RECOMMENDED]{.bcp14} that the Implicit Trust Anchor database used for
> EST server authentication be carefully managed to reduce the chance of
> a third-party CA with poor certification practices from being trusted.
> Disabling the Implicit Trust Anchor database after successfully
> receiving the Distribution of CA certificates response
> (\[[RFC7030](#RFC7030){.xref}\], [Section
> 6](https://www.rfc-editor.org/rfc/rfc7030#section-6){.relref}) limits
> any vulnerability to the first TLS
> exchange.[¶](#section-9.1-5){.pilcrow}

Alternatively, in a case where a /sen request immediately follows a
/crts, a client [MAY]{.bcp14} choose to keep the connection
authenticated by the Implicit TA open for efficiency reasons ([Section
3](#profile7925){.xref}). A client that interleaves EST-coaps /crts
request with other requests in the same DTLS connection [SHOULD]{.bcp14}
revalidate the server certificate chain against the updated Explicit TA
from the /crts response before proceeding with the subsequent requests.
If the server certificate chain does not authenticate against the
database, the client [SHOULD]{.bcp14} close the connection without
completing the rest of the requests. The updated Explicit TA
[MUST]{.bcp14} continue to be used in new DTLS
connections.[¶](#section-9.1-6){.pilcrow}

In cases where the Initial Device Identifier (IDevID) used to
authenticate the client is expired, the server [MAY]{.bcp14} still
authenticate the client because IDevIDs are expected to live as long as
the device itself ([Section 3](#profile7925){.xref}). In such occasions,
checking the certificate revocation status or authorizing the client
using another method is important for the server to raise its confidence
that the client can be trusted.[¶](#section-9.1-7){.pilcrow}

In accordance with \[[RFC7030](#RFC7030){.xref}\], TLS cipher suites
that include \"\_EXPORT\_\" and \"\_DES\_\" in their names [MUST
NOT]{.bcp14} be used. More recommendations for secure use of TLS and
DTLS are included in
\[[BCP195](#BCP195){.xref}\].[¶](#section-9.1-8){.pilcrow}

As described in Certificate Management over CMS (CMC), [Section
6.7](https://www.rfc-editor.org/rfc/rfc5272#section-6.7){.relref} of
\[[RFC5272](#RFC5272){.xref}\], \"For keys that can be used as signature
keys, signing the certification request with the private key serves as a
POP on that key pair\". In (D)TLS 1.2, the inclusion of tls-unique in
the certificate request links the proof-of-possession to the (D)TLS
proof-of-identity. This implies but does not prove that only the
authenticated client currently has access to the private
key.[¶](#section-9.1-9){.pilcrow}

What\'s more, CMC POP linking uses tls-unique as it is defined in
\[[RFC5929](#RFC5929){.xref}\]. The 3SHAKE attack
\[[TRIPLESHAKE](#TRIPLESHAKE){.xref}\] poses a risk by allowing an
on-path active attacker to leverage session resumption and renegotiation
to inject itself between a client and server even when channel binding
is in use. Implementers should use the Extended Master Secret Extension
in DTLS \[[RFC7627](#RFC7627){.xref}\] to prevent such attacks. In the
context of this specification, an attacker could invalidate the purpose
of the POP linking challengePassword in the client request by resuming
an EST-coaps connection. Even though the practical risk of such an
attack to EST-coaps is not devastating, we would rather use a more
secure channel-binding mechanism. In this specification, we still depend
on the tls-unique mechanism defined in \[[RFC5929](#RFC5929){.xref}\]
for DTLS 1.2 because a 3SHAKE attack does not expose messages exchanged
with EST-coaps. But for DTLS 1.3,
\[[TLS13-CHANNEL-BINDINGS](#I-D.ietf-kitten-tls-channel-bindings-for-tls13){.xref}\]
is used instead to derive a 32-byte tls-exporter binding in place of the
tls-unique value in the CSR. That would alleviate the risks from the
3SHAKE attack
\[[TRIPLESHAKE](#TRIPLESHAKE){.xref}\].[¶](#section-9.1-10){.pilcrow}

Interpreters of ASN.1 structures should be aware of the use of invalid
ASN.1 length fields and should take appropriate measures to guard
against buffer overflows, stack overruns in particular, and malicious
content in general.[¶](#section-9.1-11){.pilcrow}
:::
:::

::: {#sec-proxy}
::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [HTTPS-CoAPS Registrar Considerations](#name-https-coaps-registrar-consi){.section-name .selfRef} {#name-https-coaps-registrar-consi}

The Registrar proposed in [Section 5](#proxy){.xref} must be deployed
with care and only when direct client-server connections are not
possible. When POP linking is used, the Registrar terminating the DTLS
connection establishes a new TLS connection with the upstream CA. Thus,
it is impossible for POP linking to be enforced end to end for the EST
transaction. The EST server could be configured to accept POP linking
information that does not match the current TLS session because the
authenticated EST Registrar is assumed to have verified POP linking
downstream to the client.[¶](#section-9.2-1){.pilcrow}

The introduction of an EST-coaps-to-HTTP Registrar assumes the client
can authenticate the Registrar using its implicit or explicit TA
database. It also assumes the Registrar has a trust relationship with
the upstream EST server in order to act on behalf of the clients. When a
client uses the Implicit TA database for certificate validation, it
[SHOULD]{.bcp14} confirm if the server is acting as an RA by the
presence of the id-kp-cmcRA EKU \[[RFC6402](#RFC6402){.xref}\] in the
server certificate.[¶](#section-9.2-2){.pilcrow}

In a server-side key generation case, if no end-to-end encryption is
used, the Registrar may be able see the private key as it acts as a man
in the middle. Thus, the client puts its trust on the Registrar not
exposing the private key.[¶](#section-9.2-3){.pilcrow}

Clients that leverage server-side key generation without end-to-end
encryption of the private key ([Section 4.8](#serverkey){.xref}) have no
knowledge as to whether the Registrar will be generating the private key
and enrolling the certificates with the CA or if the CA will be
responsible for generating the key. In such cases, the existence of a
Registrar requires the client to put its trust on the Registrar when it
is generating the private key.[¶](#section-9.2-4){.pilcrow}
:::
:::
:::
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC2585\]
:   [Housley, R.]{.refAuthor} and [P. Hoffman]{.refAuthor}, [\"Internet
    X.509 Public Key Infrastructure Operational Protocols: FTP and
    HTTP\"]{.refTitle}, [RFC 2585]{.seriesInfo}, [DOI
    10.17487/RFC2585]{.seriesInfo}, May 1999,
    \<<https://www.rfc-editor.org/info/rfc2585>\>.
:   

\[RFC5246\]
:   [Dierks, T.]{.refAuthor} and [E. Rescorla]{.refAuthor}, [\"The
    Transport Layer Security (TLS) Protocol Version 1.2\"]{.refTitle},
    [RFC 5246]{.seriesInfo}, [DOI 10.17487/RFC5246]{.seriesInfo}, August
    2008, \<<https://www.rfc-editor.org/info/rfc5246>\>.
:   

\[RFC5958\]
:   [Turner, S.]{.refAuthor}, [\"Asymmetric Key Packages\"]{.refTitle},
    [RFC 5958]{.seriesInfo}, [DOI 10.17487/RFC5958]{.seriesInfo}, August
    2010, \<<https://www.rfc-editor.org/info/rfc5958>\>.
:   

\[RFC5967\]
:   [Turner, S.]{.refAuthor}, [\"The application/pkcs10 Media
    Type\"]{.refTitle}, [RFC 5967]{.seriesInfo}, [DOI
    10.17487/RFC5967]{.seriesInfo}, August 2010,
    \<<https://www.rfc-editor.org/info/rfc5967>\>.
:   

\[RFC6347\]
:   [Rescorla, E.]{.refAuthor} and [N. Modadugu]{.refAuthor},
    [\"Datagram Transport Layer Security Version 1.2\"]{.refTitle}, [RFC
    6347]{.seriesInfo}, [DOI 10.17487/RFC6347]{.seriesInfo}, January
    2012, \<<https://www.rfc-editor.org/info/rfc6347>\>.
:   

\[RFC6690\]
:   [Shelby, Z.]{.refAuthor}, [\"Constrained RESTful Environments (CoRE)
    Link Format\"]{.refTitle}, [RFC 6690]{.seriesInfo}, [DOI
    10.17487/RFC6690]{.seriesInfo}, August 2012,
    \<<https://www.rfc-editor.org/info/rfc6690>\>.
:   

\[RFC7030\]
:   [Pritikin, M., Ed.]{.refAuthor}, [Yee, P., Ed.]{.refAuthor}, and [D.
    Harkins, Ed.]{.refAuthor}, [\"Enrollment over Secure
    Transport\"]{.refTitle}, [RFC 7030]{.seriesInfo}, [DOI
    10.17487/RFC7030]{.seriesInfo}, October 2013,
    \<<https://www.rfc-editor.org/info/rfc7030>\>.
:   

\[RFC7252\]
:   [Shelby, Z.]{.refAuthor}, [Hartke, K.]{.refAuthor}, and [C.
    Bormann]{.refAuthor}, [\"The Constrained Application Protocol
    (CoAP)\"]{.refTitle}, [RFC 7252]{.seriesInfo}, [DOI
    10.17487/RFC7252]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7252>\>.
:   

\[RFC7925\]
:   [Tschofenig, H., Ed.]{.refAuthor} and [T. Fossati]{.refAuthor},
    [\"Transport Layer Security (TLS) / Datagram Transport Layer
    Security (DTLS) Profiles for the Internet of Things\"]{.refTitle},
    [RFC 7925]{.seriesInfo}, [DOI 10.17487/RFC7925]{.seriesInfo}, July
    2016, \<<https://www.rfc-editor.org/info/rfc7925>\>.
:   

\[RFC7959\]
:   [Bormann, C.]{.refAuthor} and [Z. Shelby, Ed.]{.refAuthor},
    [\"Block-Wise Transfers in the Constrained Application Protocol
    (CoAP)\"]{.refTitle}, [RFC 7959]{.seriesInfo}, [DOI
    10.17487/RFC7959]{.seriesInfo}, August 2016,
    \<<https://www.rfc-editor.org/info/rfc7959>\>.
:   

\[RFC8075\]
:   [Castellani, A.]{.refAuthor}, [Loreto, S.]{.refAuthor},
    [Rahman, A.]{.refAuthor}, [Fossati, T.]{.refAuthor}, and [E.
    Dijk]{.refAuthor}, [\"Guidelines for Mapping Implementations: HTTP
    to the Constrained Application Protocol (CoAP)\"]{.refTitle}, [RFC
    8075]{.seriesInfo}, [DOI 10.17487/RFC8075]{.seriesInfo}, February
    2017, \<<https://www.rfc-editor.org/info/rfc8075>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8422\]
:   [Nir, Y.]{.refAuthor}, [Josefsson, S.]{.refAuthor}, and [M.
    Pegourie-Gonnard]{.refAuthor}, [\"Elliptic Curve Cryptography (ECC)
    Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and
    Earlier\"]{.refTitle}, [RFC 8422]{.seriesInfo}, [DOI
    10.17487/RFC8422]{.seriesInfo}, August 2018,
    \<<https://www.rfc-editor.org/info/rfc8422>\>.
:   

\[RFC8446\]
:   [Rescorla, E.]{.refAuthor}, [\"The Transport Layer Security (TLS)
    Protocol Version 1.3\"]{.refTitle}, [RFC 8446]{.seriesInfo}, [DOI
    10.17487/RFC8446]{.seriesInfo}, August 2018,
    \<<https://www.rfc-editor.org/info/rfc8446>\>.
:   

\[RFC8551\]
:   [Schaad, J.]{.refAuthor}, [Ramsdell, B.]{.refAuthor}, and [S.
    Turner]{.refAuthor}, [\"Secure/Multipurpose Internet Mail Extensions
    (S/MIME) Version 4.0 Message Specification\"]{.refTitle}, [RFC
    8551]{.seriesInfo}, [DOI 10.17487/RFC8551]{.seriesInfo}, April 2019,
    \<<https://www.rfc-editor.org/info/rfc8551>\>.
:   

\[RFC8710\]
:   [Fossati, T.]{.refAuthor}, [Hartke, K.]{.refAuthor}, and [C.
    Bormann]{.refAuthor}, [\"Multipart Content-Format for the
    Constrained Application Protocol (CoAP)\"]{.refTitle}, [RFC
    8710]{.seriesInfo}, [DOI 10.17487/RFC8710]{.seriesInfo}, February
    2020, \<<https://www.rfc-editor.org/info/rfc8710>\>.
:   

\[RFC9147\]
:   [Rescorla, E.]{.refAuthor}, [Tschofenig, H.]{.refAuthor}, and [N.
    Modadugu]{.refAuthor}, [\"The Datagram Transport Layer Security
    (DTLS) Protocol Version 1.3\"]{.refTitle}, [RFC 9147]{.seriesInfo},
    [DOI 10.17487/RFC9147]{.seriesInfo}, April 2022,
    \<<https://www.rfc-editor.org/info/rfc9147>\>.
:   
:::

::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[BCP195\]

:   ::: {#RFC7525 .refInstance}
    [Sheffer, Y.]{.refAuthor}, [Holz, R.]{.refAuthor}, and [P.
    Saint-Andre]{.refAuthor}, [\"Recommendations for Secure Use of
    Transport Layer Security (TLS) and Datagram Transport Layer Security
    (DTLS)\"]{.refTitle}, [BCP 195]{.seriesInfo}, [RFC
    7525]{.seriesInfo}, May 2015.
    :::

    \<<https://www.rfc-editor.org/info/bcp195>\>

:   

\[CORE-PARAMS\]
:   [IANA]{.refAuthor}, [\"Constrained RESTful Environments (CoRE)
    Parameters\"]{.refTitle},
    \<<https://www.iana.org/assignments/core-parameters/>\>.
:   

\[IEEE802.15.4\]
:   [IEEE]{.refAuthor}, [\"IEEE 802.15.4-2020 - IEEE Standard for
    Low-Rate Wireless Networks\"]{.refTitle}, May 2020.
:   

\[IEEE802.1AR\]
:   [IEEE]{.refAuthor}, [\"IEEE Standard for Local and metropolitan area
    networks - Secure Device Identity\"]{.refTitle}, December 2009.
:   

\[PKI-GUIDE\]
:   [Moskowitz, R.]{.refAuthor}, [Birkholz, H.]{.refAuthor},
    [Xia, L.]{.refAuthor}, and [M. Richardson]{.refAuthor}, [\"Guide for
    building an ECC pki\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-moskowitz-ecdsa-pki-10]{.seriesInfo}, 31
    January 2021,
    \<<https://datatracker.ietf.org/doc/html/draft-moskowitz-ecdsa-pki-10>\>.
:   

\[PsQs\]
:   [Heninger, N.]{.refAuthor}, [Durumeric, Z.]{.refAuthor},
    [Wustrow, E.]{.refAuthor}, and [J. Alex Halderman]{.refAuthor},
    [\"Mining Your Ps and Qs: Detection of Widespread Weak Keys in
    Network Devices\"]{.refTitle}, [USENIX Security Symposium
    2012]{.refContent}, [ISBN 978-931971-95-9]{.seriesInfo},
    August 2012.
:   

\[RFC4919\]
:   [Kushalnagar, N.]{.refAuthor}, [Montenegro, G.]{.refAuthor}, and [C.
    Schumacher]{.refAuthor}, [\"IPv6 over Low-Power Wireless Personal
    Area Networks (6LoWPANs): Overview, Assumptions, Problem Statement,
    and Goals\"]{.refTitle}, [RFC 4919]{.seriesInfo}, [DOI
    10.17487/RFC4919]{.seriesInfo}, August 2007,
    \<<https://www.rfc-editor.org/info/rfc4919>\>.
:   

\[RFC5272\]
:   [Schaad, J.]{.refAuthor} and [M. Myers]{.refAuthor}, [\"Certificate
    Management over CMS (CMC)\"]{.refTitle}, [RFC 5272]{.seriesInfo},
    [DOI 10.17487/RFC5272]{.seriesInfo}, June 2008,
    \<<https://www.rfc-editor.org/info/rfc5272>\>.
:   

\[RFC5929\]
:   [Altman, J.]{.refAuthor}, [Williams, N.]{.refAuthor}, and [L.
    Zhu]{.refAuthor}, [\"Channel Bindings for TLS\"]{.refTitle}, [RFC
    5929]{.seriesInfo}, [DOI 10.17487/RFC5929]{.seriesInfo}, July 2010,
    \<<https://www.rfc-editor.org/info/rfc5929>\>.
:   

\[RFC6402\]
:   [Schaad, J.]{.refAuthor}, [\"Certificate Management over CMS (CMC)
    Updates\"]{.refTitle}, [RFC 6402]{.seriesInfo}, [DOI
    10.17487/RFC6402]{.seriesInfo}, November 2011,
    \<<https://www.rfc-editor.org/info/rfc6402>\>.
:   

\[RFC7228\]
:   [Bormann, C.]{.refAuthor}, [Ersue, M.]{.refAuthor}, and [A.
    Keranen]{.refAuthor}, [\"Terminology for Constrained-Node
    Networks\"]{.refTitle}, [RFC 7228]{.seriesInfo}, [DOI
    10.17487/RFC7228]{.seriesInfo}, May 2014,
    \<<https://www.rfc-editor.org/info/rfc7228>\>.
:   

\[RFC7230\]
:   [Fielding, R., Ed.]{.refAuthor} and [J. Reschke, Ed.]{.refAuthor},
    [\"Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and
    Routing\"]{.refTitle}, [RFC 7230]{.seriesInfo}, [DOI
    10.17487/RFC7230]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7230>\>.
:   

\[RFC7251\]
:   [McGrew, D.]{.refAuthor}, [Bailey, D.]{.refAuthor},
    [Campagna, M.]{.refAuthor}, and [R. Dugal]{.refAuthor}, [\"AES-CCM
    Elliptic Curve Cryptography (ECC) Cipher Suites for
    TLS\"]{.refTitle}, [RFC 7251]{.seriesInfo}, [DOI
    10.17487/RFC7251]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7251>\>.
:   

\[RFC7299\]
:   [Housley, R.]{.refAuthor}, [\"Object Identifier Registry for the
    PKIX Working Group\"]{.refTitle}, [RFC 7299]{.seriesInfo}, [DOI
    10.17487/RFC7299]{.seriesInfo}, July 2014,
    \<<https://www.rfc-editor.org/info/rfc7299>\>.
:   

\[RFC7627\]
:   [Bhargavan, K., Ed.]{.refAuthor}, [Delignat-Lavaud, A.]{.refAuthor},
    [Pironti, A.]{.refAuthor}, [Langley, A.]{.refAuthor}, and [M.
    Ray]{.refAuthor}, [\"Transport Layer Security (TLS) Session Hash and
    Extended Master Secret Extension\"]{.refTitle}, [RFC
    7627]{.seriesInfo}, [DOI 10.17487/RFC7627]{.seriesInfo}, September
    2015, \<<https://www.rfc-editor.org/info/rfc7627>\>.
:   

\[RFC7748\]
:   [Langley, A.]{.refAuthor}, [Hamburg, M.]{.refAuthor}, and [S.
    Turner]{.refAuthor}, [\"Elliptic Curves for Security\"]{.refTitle},
    [RFC 7748]{.seriesInfo}, [DOI 10.17487/RFC7748]{.seriesInfo},
    January 2016, \<<https://www.rfc-editor.org/info/rfc7748>\>.
:   

\[RFC9146\]
:   [Rescorla, E., Ed.]{.refAuthor}, [Tschofenig, H., Ed.]{.refAuthor},
    [Fossati, T.]{.refAuthor}, and [A. Kraus]{.refAuthor}, [\"Connection
    Identifier for DTLS 1.2\"]{.refTitle}, [RFC 9146]{.seriesInfo}, [DOI
    10.17487/RFC9146]{.seriesInfo}, March 2022,
    \<<https://www.rfc-editor.org/info/rfc9146>\>.
:   

\[RSA-FACT\]
:   [Bernstein, D.]{.refAuthor}, [Chang, Y.]{.refAuthor},
    [Cheng, C.]{.refAuthor}, [Chou, L.]{.refAuthor},
    [Heninger, N.]{.refAuthor}, [Lange, T.]{.refAuthor}, and [N.
    Someren]{.refAuthor}, [\"Factoring RSA keys from certified smart
    cards: Coppersmith in the wild\"]{.refTitle}, [Advances in
    Cryptology - ASIACRYPT 2013]{.refContent}, August 2013.
:   

\[TLS13-CHANNEL-BINDINGS\]
:   [Whited, S.]{.refAuthor}, [\"Channel Bindings for TLS
    1.3\"]{.refTitle}, [Work in Progress]{.refContent}, [Internet-Draft,
    draft-ietf-kitten-tls-channel-bindings-for-tls13-15]{.seriesInfo}, 4
    March 2022,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-kitten-tls-channel-bindings-for-tls13-15>\>.
:   

\[TRIPLESHAKE\]
:   [Bhargavan, B.]{.refAuthor}, [Delignat-Lavaud, A.]{.refAuthor},
    [Fournet, C.]{.refAuthor}, [Pironti, A.]{.refAuthor}, and [P.
    Strub]{.refAuthor}, [\"Triple Handshakes and Cookie Cutters:
    Breaking and Fixing Authentication over TLS\"]{.refTitle}, [ISBN
    978-1-4799-4686-0]{.seriesInfo}, [DOI
    10.1109/SP.2014.14]{.seriesInfo}, May 2014,
    \<<https://doi.org/10.1109/SP.2014.14>\>.
:   
:::
:::

::: {#messagebindings}
::: {#appendix-A .section}
## [Appendix A.](#appendix-A){.section-number .selfRef} [EST Messages to EST-coaps](#name-est-messages-to-est-coaps){.section-name .selfRef} {#name-est-messages-to-est-coaps}

This section shows similar examples to the ones presented in [Appendix
A](https://www.rfc-editor.org/rfc/rfc7030#appendix-A){.relref} of
\[[RFC7030](#RFC7030){.xref}\]. The payloads in the examples are the
hex-encoded binary, generated with \'xxd -p\', of the PKI certificates
created following \[[PKI-GUIDE](#I-D.moskowitz-ecdsa-pki){.xref}\]. Hex
is used for visualization purposes because a binary representation
cannot be rendered well in text. The hexadecimal representations would
not be transported in hex, but in binary. The payloads are shown
unencrypted. In practice, the message content would be transferred over
an encrypted DTLS channel.[¶](#appendix-A-1){.pilcrow}

The certificate responses included in the examples contain
Content-Format 281 (application/pkcs7). If the client had requested
Content-Format 287 (application/pkix-cert), the server would respond
with a single DER binary certificate. That certificate would be in a
multipart-core container specifically in the case of a response to a
/est/skc query.[¶](#appendix-A-2){.pilcrow}

These examples assume a short resource path of \"/est\". Even though
omitted from the examples for brevity, before making the EST-coaps
requests, a client would learn about the server supported EST-coaps
resources with a GET request for /.well-known/core?rt=ace.est\* as
explained in [Section
4.1](#discovery){.xref}.[¶](#appendix-A-3){.pilcrow}

The corresponding CoAP headers are only shown in [Appendix
A.1](#cacerts){.xref}. Creating CoAP headers is assumed to be generally
understood.[¶](#appendix-A-4){.pilcrow}

The message content is presented in plain text in [Appendix
C](#cont_breakdown){.xref}.[¶](#appendix-A-5){.pilcrow}

::: {#cacerts}
::: {#appendix-A.1 .section}
### [A.1.](#appendix-A.1){.section-number .selfRef} [cacerts](#name-cacerts){.section-name .selfRef} {#name-cacerts}

In EST-coaps, a cacerts message can be the
following:[¶](#appendix-A.1-1){.pilcrow}

::: {#appendix-A.1-2 .alignLeft .art-text .artwork}
    GET example.com:9085/est/crts
    (Accept:  281)

[¶](#appendix-A.1-2){.pilcrow}
:::

The corresponding CoAP header fields are shown below. The use of block
and DTLS are shown in [Appendix
B](#blockexamples){.xref}.[¶](#appendix-A.1-3){.pilcrow}

::: {#appendix-A.1-4}
``` {.lang-coap .sourcecode}
  Ver = 1
  T = 0 (CON)
  Code = 0x01 (0.01 is GET)
  Token = 0x9a (client generated)
  Options
  Option (Uri-Host)
     Option Delta = 0x3  (option# 3)
     Option Length = 0xB
     Option Value = "example.com"
  Option (Uri-Port)
     Option Delta = 0x4  (option# 3+4=7)
     Option Length = 0x2
     Option Value = 9085
   Option (Uri-Path)
     Option Delta = 0x4   (option# 7+4=11)
     Option Length = 0x3
     Option Value = "est"
   Option (Uri-Path)
     Option Delta = 0x0   (option# 11+0=11)
     Option Length = 0x4
     Option Value = "crts"
   Option (Accept)
     Option Delta = 0x6   (option# 11+6=17)
     Option Length = 0x2
     Option Value = 281
  Payload = [Empty]
```

[¶](#appendix-A.1-4){.pilcrow}
:::

As specified in [Section
5.10.1](https://www.rfc-editor.org/rfc/rfc7252#section-5.10.1){.relref}
of \[[RFC7252](#RFC7252){.xref}\], the Uri-Host and Uri-Port Options can
be omitted if they coincide with the transport protocol destination
address and port, respectively.[¶](#appendix-A.1-5){.pilcrow}

A 2.05 Content response with a cert in EST-coaps will then be the
following:[¶](#appendix-A.1-6){.pilcrow}

::: {#appendix-A.1-7 .alignLeft .art-text .artwork}
    2.05 Content (Content-Format: 281)
       {payload with certificate in binary format}

[¶](#appendix-A.1-7){.pilcrow}
:::

With the following CoAP fields:[¶](#appendix-A.1-8){.pilcrow}

::: {#appendix-A.1-9}
``` {.lang-coap .sourcecode}
  Ver = 1
  T = 2 (ACK)
  Code = 0x45 (2.05 Content)
  Token = 0x9a   (copied from request by server)
  Options
    Option (Content-Format)
      Option Delta = 0xC  (option# 12)
      Option Length = 0x2
      Option Value = 281

  [ The hexadecimal representation below would NOT be transported
  in hex, but in binary. Hex is used because a binary representation
  cannot be rendered well in text. ]

  Payload =
3082027a06092a864886f70d010702a082026b308202670201013100300b
06092a864886f70d010701a082024d30820249308201efa0030201020208
0b8bb0fe604f6a1e300a06082a8648ce3d0403023067310b300906035504
0613025553310b300906035504080c024341310b300906035504070c024c
4131143012060355040a0c0b4578616d706c6520496e6331163014060355
040b0c0d63657274696669636174696f6e3110300e06035504030c07526f
6f74204341301e170d3139303133313131323730335a170d333930313236
3131323730335a3067310b3009060355040613025553310b300906035504
080c024341310b300906035504070c024c4131143012060355040a0c0b45
78616d706c6520496e6331163014060355040b0c0d636572746966696361
74696f6e3110300e06035504030c07526f6f742043413059301306072a86
48ce3d020106082a8648ce3d030107034200040c1b1e82ba8cc72680973f
97edb8a0c72ab0d405f05d4fe29b997a14ccce89008313d09666b6ce375c
595fcc8e37f8e4354497011be90e56794bd91ad951ab45a3818430818130
1d0603551d0e041604141df1208944d77b5f1d9dcb51ee244a523f3ef5de
301f0603551d230418301680141df1208944d77b5f1d9dcb51ee244a523f
3ef5de300f0603551d130101ff040530030101ff300e0603551d0f0101ff
040403020106301e0603551d110417301581136365727469667940657861
6d706c652e636f6d300a06082a8648ce3d040302034800304502202b891d
d411d07a6d6f621947635ba4c43165296b3f633726f02e51ecf464bd4002
2100b4be8a80d08675f041fbc719acf3b39dedc85dc92b3035868cb2daa8
f05db196a1003100
```

[¶](#appendix-A.1-9){.pilcrow}
:::

The payload is shown in plain text in [Appendix
C.1](#cacertsdis){.xref}.[¶](#appendix-A.1-10){.pilcrow}
:::
:::

::: {#appendix-A.2 .section}
### [A.2.](#appendix-A.2){.section-number .selfRef} [enroll / reenroll](#name-enroll-reenroll){.section-name .selfRef} {#name-enroll-reenroll}

During the (re-)enroll exchange, the EST-coaps client uses a CSR
(Content-Format 286) request in the POST request payload. The Accept
Option tells the server that the client is expecting Content-Format 281
(PKCS #7) in the response. As shown in [Appendix
C.2](#enrolldis){.xref}, the CSR contains a challengePassword, which is
used for POP linking ([Section
3](#profile7925){.xref}).[¶](#appendix-A.2-1){.pilcrow}

::: {#appendix-A.2-2 .alignLeft .art-text .artwork}
    POST [2001:db8::2:321]:61616/est/sen
    (Token: 0x45)
    (Accept: 281)
    (Content-Format: 286)

    [ The hexadecimal representation below would NOT be transported
    in hex, but in binary. Hex is used because a binary representation
    cannot be rendered well in text. ]

    3082018b30820131020100305c310b3009060355040613025553310b3009
    06035504080c024341310b300906035504070c024c413114301206035504
    0a0c0b6578616d706c6520496e63310c300a060355040b0c03496f54310f
    300d060355040513065774313233343059301306072a8648ce3d02010608
    2a8648ce3d03010703420004c8b421f11c25e47e3ac57123bf2d9fdc494f
    028bc351cc80c03f150bf50cff958d75419d81a6a245dffae790be95cf75
    f602f9152618f816a2b23b5638e59fd9a073303406092a864886f70d0109
    0731270c2576437630292a264a4b4a3bc3a2c280c2992f3e3c2e2c3d6b6e
    7634332323403d204e787e60303b06092a864886f70d01090e312e302c30
    2a0603551d1104233021a01f06082b06010505070804a013301106092b06
    010401b43b0a01040401020304300a06082a8648ce3d0403020348003045
    02210092563a546463bd9ecff170d0fd1f2ef0d3d012160e5ee90cffedab
    ec9b9a38920220179f10a3436109051abad17590a09bc87c4dce5453a6fc
    1135a1e84eed754377

[¶](#appendix-A.2-2){.pilcrow}
:::

After verification of the CSR by the server, a 2.04 Changed response
with the issued certificate will be returned to the
client.[¶](#appendix-A.2-3){.pilcrow}

::: {#appendix-A.2-4 .alignLeft .art-text .artwork}
    2.04 Changed
    (Token: 0x45)
    (Content-Format: 281)

    [ The hexadecimal representation below would NOT be transported
    in hex, but in binary. Hex is used because a binary representation
    cannot be rendered well in text. ]

    3082026e06092a864886f70d010702a082025f3082025b0201013100300b
    06092a864886f70d010701a08202413082023d308201e2a0030201020208
    7e7661d7b54e4632300a06082a8648ce3d040302305d310b300906035504
    0613025553310b300906035504080c02434131143012060355040a0c0b45
    78616d706c6520496e6331163014060355040b0c0d636572746966696361
    74696f6e3113301106035504030c0a3830322e3141522043413020170d31
    39303133313131323931365a180f39393939313233313233353935395a30
    5c310b3009060355040613025553310b300906035504080c024341310b30
    0906035504070c024c4131143012060355040a0c0b6578616d706c652049
    6e63310c300a060355040b0c03496f54310f300d06035504051306577431
    3233343059301306072a8648ce3d020106082a8648ce3d03010703420004
    c8b421f11c25e47e3ac57123bf2d9fdc494f028bc351cc80c03f150bf50c
    ff958d75419d81a6a245dffae790be95cf75f602f9152618f816a2b23b56
    38e59fd9a3818a30818730090603551d1304023000301d0603551d0e0416
    041496600d8716bf7fd0e752d0ac760777ad665d02a0301f0603551d2304
    183016801468d16551f951bfc82a431d0d9f08bc2d205b1160300e060355
    1d0f0101ff0404030205a0302a0603551d1104233021a01f06082b060105
    05070804a013301106092b06010401b43b0a01040401020304300a06082a
    8648ce3d0403020349003046022100c0d81996d2507d693f3c48eaa5ee94
    91bda6db214099d98117c63b361374cd86022100a774989f4c321a5cf25d
    832a4d336a08ad67df20f1506421188a0ade6d349236a1003100

[¶](#appendix-A.2-4){.pilcrow}
:::

The request and response is shown in plain text in [Appendix
C.2](#enrolldis){.xref}.[¶](#appendix-A.2-5){.pilcrow}
:::

::: {#appskg}
::: {#appendix-A.3 .section}
### [A.3.](#appendix-A.3){.section-number .selfRef} [serverkeygen](#name-serverkeygen){.section-name .selfRef} {#name-serverkeygen}

In a serverkeygen exchange, the CoAP POST request looks like the
following:[¶](#appendix-A.3-1){.pilcrow}

::: {#appendix-A.3-2 .alignLeft .art-text .artwork}
    POST 192.0.2.1:8085/est/skg
    (Token: 0xa5)
    (Accept: 62)
    (Content-Format: 286)

    [ The hexadecimal representation below would NOT be transported
    in hex, but in binary. Hex is used because a binary representation
    cannot be rendered well in text. ]

    3081d03078020100301631143012060355040a0c0b736b67206578616d70
    6c653059301306072a8648ce3d020106082a8648ce3d03010703420004c8
    b421f11c25e47e3ac57123bf2d9fdc494f028bc351cc80c03f150bf50cff
    958d75419d81a6a245dffae790be95cf75f602f9152618f816a2b23b5638
    e59fd9a000300a06082a8648ce3d040302034800304502207c553981b1fe
    349249d8a3f50a0346336b7dfaa099cf74e1ec7a37a0a760485902210084
    79295398774b2ff8e7e82abb0c17eaef344a5088fa69fd63ee611850c34b
    0a

[¶](#appendix-A.3-2){.pilcrow}
:::

The response would follow \[[RFC8710](#RFC8710){.xref}\] and could look
like the following:[¶](#appendix-A.3-3){.pilcrow}

::: {#appendix-A.3-4 .alignLeft .art-text .artwork}
    2.04 Changed
    (Token: 0xa5)
    (Content-Format: 62)

    [ The hexadecimal representations below would NOT be transported
    in hex, but in binary. Hex is used because a binary representation
    cannot be rendered well in text. ]

    84                                   # array(4)
    19 011C                              # unsigned(284)
    58 8A                                # bytes(138)
    308187020100301306072a8648ce3d020106082a8648ce3d030107046d30
    6b020101042061336a86ac6e7af4a96f632830ad4e6aa0837679206094d7
    679a01ca8c6f0c37a14403420004c8b421f11c25e47e3ac57123bf2d9fdc
    494f028bc351cc80c03f150bf50cff958d75419d81a6a245dffae790be95
    cf75f602f9152618f816a2b23b5638e59fd9
    19 0119                              # unsigned(281)
    59 01D3                              # bytes(467)
    308201cf06092a864886f70d010702a08201c0308201bc0201013100300b
    06092a864886f70d010701a08201a23082019e30820144a0030201020209
    00b3313e8f3fc9538e300a06082a8648ce3d040302301631143012060355
    040a0c0b736b67206578616d706c65301e170d3139303930343037343430
    335a170d3339303833303037343430335a301631143012060355040a0c0b
    736b67206578616d706c653059301306072a8648ce3d020106082a8648ce
    3d03010703420004c8b421f11c25e47e3ac57123bf2d9fdc494f028bc351
    cc80c03f150bf50cff958d75419d81a6a245dffae790be95cf75f602f915
    2618f816a2b23b5638e59fd9a37b307930090603551d1304023000302c06
    096086480186f842010d041f161d4f70656e53534c2047656e6572617465
    64204365727469666963617465301d0603551d0e0416041496600d8716bf
    7fd0e752d0ac760777ad665d02a0301f0603551d2304183016801496600d
    8716bf7fd0e752d0ac760777ad665d02a0300a06082a8648ce3d04030203
    48003045022100e95bfa25a08976652246f2d96143da39fce0dc4c9b26b9
    cce1f24164cc2b12b602201351fd8eea65764e3459d324e4345ff5b2a915
    38c04976111796b3698bf6379ca1003100

[¶](#appendix-A.3-4){.pilcrow}
:::

The private key in the response above is without CMS EnvelopedData and
has no additional encryption beyond DTLS ([Section
4.8](#serverkey){.xref}).[¶](#appendix-A.3-5){.pilcrow}

The request and response is shown in plain text in [Appendix
C.3](#disskgrequest){.xref}.[¶](#appendix-A.3-6){.pilcrow}
:::
:::

::: {#appendix-A.4 .section}
### [A.4.](#appendix-A.4){.section-number .selfRef} [csrattrs](#name-csrattrs){.section-name .selfRef} {#name-csrattrs}

The following is a csrattrs exchange:[¶](#appendix-A.4-1){.pilcrow}

::: {#appendix-A.4-2 .alignLeft .art-text .artwork}
    REQ:
    GET example.com:61616/est/att

    RES:
    2.05 Content
    (Content-Format: 285)

    [ The hexadecimal representation below would NOT be transported
    in hex, but in binary. Hex is used because a binary representation
    cannot be rendered well in text. ]

    307c06072b06010101011630220603883701311b131950617273652053455
    420617320322e3939392e31206461746106092a864886f70d010907302c06
    0388370231250603883703060388370413195061727365205345542061732
    0322e3939392e32206461746106092b240303020801010b06096086480165
    03040202

[¶](#appendix-A.4-2){.pilcrow}
:::

A 2.05 Content response should contain attributes that are relevant for
the authenticated client. This example is copied from [Appendix
A.2](https://www.rfc-editor.org/rfc/rfc7030#appendix-A.2){.relref} of
\[[RFC7030](#RFC7030){.xref}\], where the base64 representation is
replaced with a hexadecimal representation of the equivalent binary
format. The EST-coaps server returns attributes that the client can
ignore if they are unknown to the client.[¶](#appendix-A.4-3){.pilcrow}
:::
:::
:::

::: {#blockexamples}
::: {#appendix-B .section}
## [Appendix B.](#appendix-B){.section-number .selfRef} [EST-coaps Block Message Examples](#name-est-coaps-block-message-exa){.section-name .selfRef} {#name-est-coaps-block-message-exa}

Two examples are presented in this section:[¶](#appendix-B-1){.pilcrow}

1.  [A cacerts exchange shows the use of Block2 and the block
    headers.[¶](#appendix-B-2.1){.pilcrow}]{#appendix-B-2.1}
2.  [An enroll exchange shows the Block1 and Block2 size negotiation for
    request and response
    payloads.[¶](#appendix-B-2.2){.pilcrow}]{#appendix-B-2.2}

The payloads are shown unencrypted. In practice, the message contents
would be binary formatted and transferred over an encrypted DTLS tunnel.
The corresponding CoAP headers are only shown in [Appendix
B.1](#cacertsblock){.xref}. Creating CoAP headers is assumed to be
generally known.[¶](#appendix-B-3){.pilcrow}

::: {#cacertsblock}
::: {#appendix-B.1 .section}
### [B.1.](#appendix-B.1){.section-number .selfRef} [cacerts](#name-cacerts-2){.section-name .selfRef} {#name-cacerts-2}

This section provides a detailed example of the messages using DTLS and
CoAP Option Block2. The example block length is taken as 64, which gives
an SZX value of 2.[¶](#appendix-B.1-1){.pilcrow}

The following is an example of a cacerts exchange over DTLS. The content
length of the cacerts response in [Appendix
A.1](https://www.rfc-editor.org/rfc/rfc7030#appendix-A.1){.relref} of
\[[RFC7030](#RFC7030){.xref}\] contains 639 bytes in binary in this
example. The CoAP message adds around 10 bytes in this example, and the
DTLS record around 29 bytes. To avoid IP fragmentation, the CoAP Block
Option is used and an MTU of 127 is assumed to stay within one IEEE
802.15.4 packet. To stay below the MTU of 127, the payload is split in 9
packets with a payload of 64 bytes each, followed by a last tenth packet
of 63 bytes. The client sends an IPv6 packet containing a UDP datagram
with DTLS record protection that encapsulates a CoAP request 10 times
(one fragment of the request per block). The server returns an IPv6
packet containing a UDP datagram with the DTLS record that encapsulates
the CoAP response. The CoAP request-response exchange with block option
is shown below. Block Option is shown in a decomposed way
(block-option:NUM/M/size) indicating the kind of Block Option (2 in this
case) followed by a colon, and then the block number (NUM), the more bit
(M = 0 in Block2 response means it is last block), and block size with
exponent (2^(SZX+4)^) separated by slashes. The Length 64 is used with
SZX=2. The CoAP Request is sent Confirmable (CON), and the
Content-Format of the response, even though not shown, is 281
(application/pkcs7-mime; smime-type=certs-only). The transfer of the 10
blocks with partially filled block NUM=9 is shown
below.[¶](#appendix-B.1-2){.pilcrow}

::: {#appendix-B.1-3}
``` {.lang-coap .sourcecode}
   GET example.com:9085/est/crts (2:0/0/64)  -->
                 <--   (2:0/1/64) 2.05 Content
   GET example.com:9085/est/crts (2:1/0/64)  -->
                 <--   (2:1/1/64) 2.05 Content
                               |
                               |
                               |
   GET example.com:9085/est/crts (2:9/0/64) -->
                 <--   (2:9/0/64) 2.05 Content
```

[¶](#appendix-B.1-3){.pilcrow}
:::

The header of the GET request looks like the
following:[¶](#appendix-B.1-4){.pilcrow}

::: {#appendix-B.1-5}
``` {.lang-coap .sourcecode}
  Ver = 1
  T = 0 (CON)
  Code = 0x01 (0.1 GET)
  Token = 0x9a    (client generated)
  Options
   Option (Uri-Host)
     Option Delta = 0x3  (option# 3)
     Option Length = 0xB
     Option Value = "example.com"
   Option (Uri-Port)
     Option Delta = 0x4   (option# 3+4=7)
     Option Length = 0x2
     Option Value = 9085
   Option (Uri-Path)
     Option Delta = 0x4    (option# 7+4=11)
     Option Length = 0x3
     Option Value = "est"
   Option (Uri-Path)Uri-Path)
     Option Delta = 0x0    (option# 11+0=11)
     Option Length = 0x4
     Option Value = "crts"
   Option (Accept)
     Option Delta = 0x6   (option# 11+6=17)
     Option Length = 0x2
     Option Value = 281
  Payload = [Empty]
```

[¶](#appendix-B.1-5){.pilcrow}
:::

The Uri-Host and Uri-Port Options can be omitted if they coincide with
the transport protocol destination address and port, respectively.
Explicit Uri-Host and Uri-Port Options are typically used when an
endpoint hosts multiple virtual servers and uses the Options to route
the requests accordingly.[¶](#appendix-B.1-6){.pilcrow}

To provide further details on the CoAP headers, the first two and the
last blocks are written out below. The header of the first Block2
response looks like the following:[¶](#appendix-B.1-7){.pilcrow}

::: {#appendix-B.1-8}
``` {.lang-coap .sourcecode}
  Ver = 1
  T = 2 (ACK)
  Code = 0x45 (2.05 Content)
  Token = 0x9a     (copied from request by server)
  Options
    Option
      Option Delta = 0xC  (option# 12 Content-Format)
      Option Length = 0x2
      Option Value = 281
    Option
      Option Delta = 0xB  (option# 12+11=23 Block2)
      Option Length = 0x1
      Option Value = 0x0A (block#=0, M=1, SZX=2)

  [ The hexadecimal representation below would NOT be transported
  in hex, but in binary. Hex is used because a binary representation
  cannot be rendered well in text. ]

  Payload =
3082027b06092a864886f70d010702a082026c308202680201013100300b
06092a864886f70d010701a082024e3082024a308201f0a0030201020209
009189bc
```

[¶](#appendix-B.1-8){.pilcrow}
:::

The header of the second Block2 response looks like the
following:[¶](#appendix-B.1-9){.pilcrow}

::: {#appendix-B.1-10}
``` {.lang-coap .sourcecode}
  Ver = 1
  T = 2 (means ACK)
  Code = 0x45 (2.05 Content)
  Token = 0x9a     (copied from request by server)
  Options
    Option
      Option Delta = 0xC  (option# 12 Content-Format)
      Option Length = 0x2
      Option Value = 281
    Option
      Option Delta = 0xB  (option 12+11=23 Block2)
      Option Length = 0x1
      Option Value = 0x1A (block#=1, M=1, SZX=2)

  [ The hexadecimal representation below would NOT be transported
  in hex, but in binary. Hex is used because a binary representation
  cannot be rendered well in text. ]

  Payload =
df9c99244b300a06082a8648ce3d0403023067310b300906035504061302
5553310b300906035504080c024341310b300906035504070c024c413114
30120603
```

[¶](#appendix-B.1-10){.pilcrow}
:::

The header of the tenth and final Block2 response looks like the
following:[¶](#appendix-B.1-11){.pilcrow}

::: {#appendix-B.1-12}
``` {.lang-coap .sourcecode}
  Ver = 1
  T = 2 (means ACK)
  Code = 0x45      (2.05 Content)
  Token = 0x9a     (copied from request by server)
  Options
    Option
      Option Delta = 0xC  (option# 12 Content-Format)
      Option Length = 0x2
      Option Value = 281
    Option
      Option Delta = 0xB  (option# 12+11=23 Block2 )
      Option Length = 0x1
      Option Value = 0x92 (block#=9, M=0, SZX=2)

  [ The hexadecimal representation below would NOT be transported
  in hex, but in binary. Hex is used because a binary representation
  cannot be rendered well in text. ]

  Payload =
2ec0b4af52d46f3b7ecc9687ddf267bcec368f7b7f1353272f022047a28a
e5c7306163b3c3834bab3c103f743070594c089aaa0ac870cd13b902caa1
003100
```

[¶](#appendix-B.1-12){.pilcrow}
:::
:::
:::

::: {#enrollblock}
::: {#appendix-B.2 .section}
### [B.2.](#appendix-B.2){.section-number .selfRef} [enroll / reenroll](#name-enroll-reenroll-2){.section-name .selfRef} {#name-enroll-reenroll-2}

In this example, the requested Block2 size of 256 bytes, required by the
client, is transferred to the server in the very first request message.
The block size of 256 is equal to (2^(SZX+4)^), which gives SZX=4. The
notation for block numbering is the same as in [Appendix
B.1](#cacertsblock){.xref}. The header fields and the payload are
omitted for brevity.[¶](#appendix-B.2-1){.pilcrow}

[]{#name-est-coaps-enrollment-with-m}

::: {#fig-est-multiple-block}
::: {#appendix-B.2-2.1 .alignLeft .art-text .artwork}
    POST [2001:db8::2:1]:61616/est/sen (CON)(1:0/1/256)
                       {CSR (frag# 1)} -->

           <-- (ACK) (1:0/1/256) (2.31 Continue)
    POST [2001:db8::2:1]:61616/est/sen (CON)(1:1/1/256)
                       {CSR (frag# 2)} -->
           <-- (ACK) (1:1/1/256) (2.31 Continue)
                          .
                          .
                          .
    POST [2001:db8::2:1]:61616/est/sen (CON)(1:N1/0/256)
                       {CSR(frag# N1+1)}-->
                          |
        ...........Immediate response  .........
                          |
      <-- (ACK) (1:N1/0/256)(2:0/1/256)(2.04 Changed)
                       {Cert resp (frag# 1)}
    POST [2001:db8::2:1]:61616/est/sen (CON)(2:1/0/256)           -->
      <-- (ACK) (2:1/1/256)(2.04 Changed)
                       {Cert resp (frag# 2)}
                          .
                          .
                          .
    POST [2001:db8::2:321]:61616/est/sen (CON)(2:N2/0/256)          -->
      <-- (ACK) (2:N2/0/256) (2.04 Changed)
                       {Cert resp (frag# N2+1)}
:::

[Figure 6](#figure-6){.selfRef}: [EST-coaps Enrollment with Multiple
Blocks](#name-est-coaps-enrollment-with-m){.selfRef}
:::

N1+1 blocks have been transferred from client to server, and N2+1 blocks
have been transferred from server to
client.[¶](#appendix-B.2-3){.pilcrow}
:::
:::
:::
:::

::: {#cont_breakdown}
::: {#appendix-C .section}
## [Appendix C.](#appendix-C){.section-number .selfRef} [Message Content Breakdown](#name-message-content-breakdown){.section-name .selfRef} {#name-message-content-breakdown}

This appendix presents the hexadecimal dumps of the binary payloads in
plain text shown in [Appendix
A](#messagebindings){.xref}.[¶](#appendix-C-1){.pilcrow}

::: {#cacertsdis}
::: {#appendix-C.1 .section}
### [C.1.](#appendix-C.1){.section-number .selfRef} [cacerts](#name-cacerts-3){.section-name .selfRef} {#name-cacerts-3}

The cacerts response containing one root CA certificate is presented in
plain text in the following:[¶](#appendix-C.1-1){.pilcrow}

::: {#appendix-C.1-2}
``` {.lang-asn.1 .sourcecode}
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 831953162763987486 (0xb8bb0fe604f6a1e)
    Signature Algorithm: ecdsa-with-SHA256
        Issuer: C=US, ST=CA, L=LA, O=Example Inc,
                  OU=certification, CN=Root CA
        Validity
            Not Before: Jan 31 11:27:03 2019 GMT
            Not After : Jan 26 11:27:03 2039 GMT
        Subject: C=US, ST=CA, L=LA, O=Example Inc,
                     OU=certification, CN=Root CA
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub:
                    04:0c:1b:1e:82:ba:8c:c7:26:80:97:3f:97:ed:b8:
                    a0:c7:2a:b0:d4:05:f0:5d:4f:e2:9b:99:7a:14:cc:
                    ce:89:00:83:13:d0:96:66:b6:ce:37:5c:59:5f:cc:
                    8e:37:f8:e4:35:44:97:01:1b:e9:0e:56:79:4b:d9:
                    1a:d9:51:ab:45
                ASN1 OID: prime256v1
                NIST CURVE: P-256
        X509v3 extensions:
            X509v3 Subject Key Identifier:
1D:F1:20:89:44:D7:7B:5F:1D:9D:CB:51:EE:24:4A:52:3F:3E:F5:DE
            X509v3 Authority Key Identifier:
                  keyid:
1D:F1:20:89:44:D7:7B:5F:1D:9D:CB:51:EE:24:4A:52:3F:3E:F5:DE

            X509v3 Basic Constraints: critical
                CA:TRUE
            X509v3 Key Usage: critical
                Certificate Sign, CRL Sign
            X509v3 Subject Alternative Name:
                email:certify@example.com
    Signature Algorithm: ecdsa-with-SHA256
         30:45:02:20:2b:89:1d:d4:11:d0:7a:6d:6f:62:19:47:63:5b:
         a4:c4:31:65:29:6b:3f:63:37:26:f0:2e:51:ec:f4:64:bd:40:
         02:21:00:b4:be:8a:80:d0:86:75:f0:41:fb:c7:19:ac:f3:b3:
         9d:ed:c8:5d:c9:2b:30:35:86:8c:b2:da:a8:f0:5d:b1:96
```

[¶](#appendix-C.1-2){.pilcrow}
:::
:::
:::

::: {#enrolldis}
::: {#appendix-C.2 .section}
### [C.2.](#appendix-C.2){.section-number .selfRef} [enroll / reenroll](#name-enroll-reenroll-3){.section-name .selfRef} {#name-enroll-reenroll-3}

The enrollment request is presented in plain text in the
following:[¶](#appendix-C.2-1){.pilcrow}

::: {#appendix-C.2-2}
``` {.lang-asn.1 .sourcecode}
Certificate Request:
    Data:
        Version: 0 (0x0)
        Subject: C=US, ST=CA, L=LA, O=example Inc,
                    OU=IoT/serialNumber=Wt1234
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub:
                    04:c8:b4:21:f1:1c:25:e4:7e:3a:c5:71:23:bf:2d:
                    9f:dc:49:4f:02:8b:c3:51:cc:80:c0:3f:15:0b:f5:
                    0c:ff:95:8d:75:41:9d:81:a6:a2:45:df:fa:e7:90:
                    be:95:cf:75:f6:02:f9:15:26:18:f8:16:a2:b2:3b:
                    56:38:e5:9f:d9
                ASN1 OID: prime256v1
                NIST CURVE: P-256
        Attributes:
            challengePassword:   <256-bit POP linking value>
        Requested Extensions:
            X509v3 Subject Alternative Name:
                othername:<unsupported>
    Signature Algorithm: ecdsa-with-SHA256
         30:45:02:21:00:92:56:3a:54:64:63:bd:9e:cf:f1:70:d0:fd:
         1f:2e:f0:d3:d0:12:16:0e:5e:e9:0c:ff:ed:ab:ec:9b:9a:38:
         92:02:20:17:9f:10:a3:43:61:09:05:1a:ba:d1:75:90:a0:9b:
         c8:7c:4d:ce:54:53:a6:fc:11:35:a1:e8:4e:ed:75:43:77
```

[¶](#appendix-C.2-2){.pilcrow}
:::

The CSR contains a challengePassword, which is used for POP linking
([Section 3](#profile7925){.xref}). The CSR also contains an
id-on-hardwareModuleName hardware identifier to customize the returned
certificate to the requesting device (See \[[RFC7299](#RFC7299){.xref}\]
and
\[[PKI-GUIDE](#I-D.moskowitz-ecdsa-pki){.xref}\]).[¶](#appendix-C.2-3){.pilcrow}

The issued certificate presented in plain text in the
following:[¶](#appendix-C.2-4){.pilcrow}

::: {#appendix-C.2-5}
``` {.lang-asn.1 .sourcecode}
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 9112578475118446130 (0x7e7661d7b54e4632)
    Signature Algorithm: ecdsa-with-SHA256
        Issuer: C=US, ST=CA, O=Example Inc,
                      OU=certification, CN=802.1AR CA
        Validity
            Not Before: Jan 31 11:29:16 2019 GMT
            Not After : Dec 31 23:59:59 9999 GMT
        Subject: C=US, ST=CA, L=LA, O=example Inc,
                OU=IoT/serialNumber=Wt1234
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub:
                    04:c8:b4:21:f1:1c:25:e4:7e:3a:c5:71:23:bf:2d:
                    9f:dc:49:4f:02:8b:c3:51:cc:80:c0:3f:15:0b:f5:
                    0c:ff:95:8d:75:41:9d:81:a6:a2:45:df:fa:e7:90:
                    be:95:cf:75:f6:02:f9:15:26:18:f8:16:a2:b2:3b:
                    56:38:e5:9f:d9
                ASN1 OID: prime256v1
                NIST CURVE: P-256
        X509v3 extensions:
            X509v3 Basic Constraints:
                CA:FALSE
            X509v3 Subject Key Identifier:
96:60:0D:87:16:BF:7F:D0:E7:52:D0:AC:76:07:77:AD:66:5D:02:A0
            X509v3 Authority Key Identifier:
                keyid:
68:D1:65:51:F9:51:BF:C8:2A:43:1D:0D:9F:08:BC:2D:20:5B:11:60

            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Subject Alternative Name:
                othername:<unsupported>
    Signature Algorithm: ecdsa-with-SHA256
         30:46:02:21:00:c0:d8:19:96:d2:50:7d:69:3f:3c:48:ea:a5:
         ee:94:91:bd:a6:db:21:40:99:d9:81:17:c6:3b:36:13:74:cd:
         86:02:21:00:a7:74:98:9f:4c:32:1a:5c:f2:5d:83:2a:4d:33:
         6a:08:ad:67:df:20:f1:50:64:21:18:8a:0a:de:6d:34:92:36
```

[¶](#appendix-C.2-5){.pilcrow}
:::
:::
:::

::: {#disskgrequest}
::: {#appendix-C.3 .section}
### [C.3.](#appendix-C.3){.section-number .selfRef} [serverkeygen](#name-serverkeygen-2){.section-name .selfRef} {#name-serverkeygen-2}

The following is the server-side key generation request presented in
plain text:[¶](#appendix-C.3-1){.pilcrow}

::: {#appendix-C.3-2}
``` {.lang-asn.1 .sourcecode}
Certificate Request:
    Data:
        Version: 0 (0x0)
        Subject: O=skg example
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub:
                    04:c8:b4:21:f1:1c:25:e4:7e:3a:c5:71:23:bf:2d:
                    9f:dc:49:4f:02:8b:c3:51:cc:80:c0:3f:15:0b:f5:
                    0c:ff:95:8d:75:41:9d:81:a6:a2:45:df:fa:e7:90:
                    be:95:cf:75:f6:02:f9:15:26:18:f8:16:a2:b2:3b:
                    56:38:e5:9f:d9
                ASN1 OID: prime256v1
                NIST CURVE: P-256
        Attributes:
            a0:00
    Signature Algorithm: ecdsa-with-SHA256
         30:45:02:20:7c:55:39:81:b1:fe:34:92:49:d8:a3:f5:0a:03:
         46:33:6b:7d:fa:a0:99:cf:74:e1:ec:7a:37:a0:a7:60:48:59:
         02:21:00:84:79:29:53:98:77:4b:2f:f8:e7:e8:2a:bb:0c:17:
         ea:ef:34:4a:50:88:fa:69:fd:63:ee:61:18:50:c3:4b:0a
```

[¶](#appendix-C.3-2){.pilcrow}
:::

The following is the private key content of the server-side key
generation response presented in plain
text:[¶](#appendix-C.3-3){.pilcrow}

::: {#appendix-C.3-4 .alignLeft .art-text .artwork}
    Private-Key: (256 bit)
    priv:
        61:33:6a:86:ac:6e:7a:f4:a9:6f:63:28:30:ad:4e:
        6a:a0:83:76:79:20:60:94:d7:67:9a:01:ca:8c:6f:
        0c:37
    pub:
        04:c8:b4:21:f1:1c:25:e4:7e:3a:c5:71:23:bf:2d:
        9f:dc:49:4f:02:8b:c3:51:cc:80:c0:3f:15:0b:f5:
        0c:ff:95:8d:75:41:9d:81:a6:a2:45:df:fa:e7:90:
        be:95:cf:75:f6:02:f9:15:26:18:f8:16:a2:b2:3b:
        56:38:e5:9f:d9
    ASN1 OID: prime256v1
    NIST CURVE: P-256

[¶](#appendix-C.3-4){.pilcrow}
:::

The following is the certificate in the server-side key generation
response payload presented in plain text:[¶](#appendix-C.3-5){.pilcrow}

::: {#appendix-C.3-6}
``` {.lang-asn.1 .sourcecode}
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            b3:31:3e:8f:3f:c9:53:8e
    Signature Algorithm: ecdsa-with-SHA256
        Issuer: O=skg example
        Validity
            Not Before: Sep  4 07:44:03 2019 GMT
            Not After : Aug 30 07:44:03 2039 GMT
        Subject: O=skg example
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub:
                    04:c8:b4:21:f1:1c:25:e4:7e:3a:c5:71:23:bf:2d:
                    9f:dc:49:4f:02:8b:c3:51:cc:80:c0:3f:15:0b:f5:
                    0c:ff:95:8d:75:41:9d:81:a6:a2:45:df:fa:e7:90:
                    be:95:cf:75:f6:02:f9:15:26:18:f8:16:a2:b2:3b:
                    56:38:e5:9f:d9
                ASN1 OID: prime256v1
                NIST CURVE: P-256
        X509v3 extensions:
            X509v3 Basic Constraints:
                CA:FALSE
            Netscape Comment:
                OpenSSL Generated Certificate
            X509v3 Subject Key Identifier:
96:60:0D:87:16:BF:7F:D0:E7:52:D0:AC:76:07:77:AD:66:5D:02:A0
            X509v3 Authority Key Identifier:
                keyid:
96:60:0D:87:16:BF:7F:D0:E7:52:D0:AC:76:07:77:AD:66:5D:02:A0

    Signature Algorithm: ecdsa-with-SHA256
         30:45:02:21:00:e9:5b:fa:25:a0:89:76:65:22:46:f2:d9:61:
         43:da:39:fc:e0:dc:4c:9b:26:b9:cc:e1:f2:41:64:cc:2b:12:
         b6:02:20:13:51:fd:8e:ea:65:76:4e:34:59:d3:24:e4:34:5f:
         f5:b2:a9:15:38:c0:49:76:11:17:96:b3:69:8b:f6:37:9c
```

[¶](#appendix-C.3-6){.pilcrow}
:::
:::
:::
:::
:::

::: {#ack}
::: {#appendix-D .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The authors are very grateful to [Klaus Hartke]{.contact-name} for his
detailed explanations on the use of Block with DTLS and his support for
the Content-Format specification. The authors would like to thank [Esko
Dijk]{.contact-name} and [Michael Verschoor]{.contact-name} for the
valuable discussions that helped in shaping the solution. They would
also like to thank [Peter Panburana]{.contact-name} for his feedback on
technical details of the solution. Constructive comments were received
from [Benjamin Kaduk]{.contact-name}, [Eliot Lear]{.contact-name}, [Jim
Schaad]{.contact-name}, [Hannes Tschofenig]{.contact-name}, [Julien
Vermillard]{.contact-name}, [John Manuel]{.contact-name}, [Oliver
Pfaff]{.contact-name}, [Pete Beal]{.contact-name}, and [Carsten
Bormann]{.contact-name}.[¶](#appendix-D-1){.pilcrow}

Interop tests were done by [Oliver Pfaff]{.contact-name}, [Thomas
Werner]{.contact-name}, [Oskar Camezind]{.contact-name}, [Bjorn
Elmers]{.contact-name}, and [Joel
Hoglund]{.contact-name}.[¶](#appendix-D-2){.pilcrow}

[Robert Moskowitz]{.contact-name} provided code to create the
examples.[¶](#appendix-D-3){.pilcrow}
:::
:::

::: {#contrib}
::: {#appendix-E .section}
## [Contributors](#name-contributors){.section-name .selfRef} {#name-contributors}

[Martin Furuhed]{.contact-name} contributed to the EST-coaps
specification by providing feedback based on the Nexus EST-over-CoAPS
server implementation that started in 2015. [Sandeep
Kumar]{.contact-name} kick-started this specification and was
instrumental in drawing attention to the importance of the
subject.[¶](#appendix-E-1){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#appendix-F .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Peter van der Stok]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Consultant]{.org}
:::

::: email
Email: <stokcons@bbhmail.nl>
:::

::: {.left dir="auto"}
[Panos Kampanakis]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems]{.org}
:::

::: email
Email: <pkampana@cisco.com>
:::

::: {.left dir="auto"}
[Michael C. Richardson]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Sandelman Software Works]{.org}
:::

::: email
Email: <mcr+ietf@sandelman.ca>
:::

::: url
URI: <https://www.sandelman.ca/>
:::

::: {.left dir="auto"}
[Shahid Raza]{.fn .nameRole}
:::

::: {.left dir="auto"}
[RISE Research Institutes of Sweden]{.org}
:::

::: {.left dir="auto"}
[Isafjordsgatan 22]{.street-address}
:::

::: {.left dir="auto"}
SE-[16440]{.postal-code} [Kista, Stockholm]{.locality}
:::

::: {.left dir="auto"}
[Sweden]{.country-name}
:::

::: email
Email: <shahid.raza@ri.se>
:::
:::
:::
