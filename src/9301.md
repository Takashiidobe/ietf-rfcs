  RFC 9301            LISP Control Plane   October 2022
  ------------------- -------------------- --------------
  Farinacci, et al.   Standards Track      \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9301](https://www.rfc-editor.org/rfc/rfc9301){.eref}

Obsoletes:
:   [6830](https://www.rfc-editor.org/rfc/rfc6830){.eref},
    [6833](https://www.rfc-editor.org/rfc/rfc6833){.eref}

Category:
:   Standards Track

Published:
:   October 2022

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    D. Farinacci
    :::

    ::: org
    lispers.net
    :::
    :::

    ::: author
    ::: author-name
    F. Maino
    :::

    ::: org
    Cisco Systems
    :::
    :::

    ::: author
    ::: author-name
    V. Fuller
    :::

    ::: org
    vaf.net Internet Consulting
    :::
    :::

    ::: author
    ::: author-name
    A. Cabellos, [Ed.]{.editor}
    :::

    ::: org
    Universitat Politecnica de Catalunya
    :::
    :::
:::

# RFC 9301 {#rfcnum}

# Locator/ID Separation Protocol (LISP) Control Plane {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document describes the control plane and Mapping Service for the
Locator/ID Separation Protocol (LISP), implemented by two types of
LISP-speaking devices \-- the LISP Map-Resolver and LISP Map-Server \--
that provide a simplified \"front end\" for one or more Endpoint IDs
(EIDs) to Routing Locator mapping
databases.[¶](#section-abstract-1){.pilcrow}

By using this control plane service interface and communicating with
Map-Resolvers and Map-Servers, LISP Ingress Tunnel Routers (ITRs) and
Egress Tunnel Routers (ETRs) are not dependent on the details of mapping
database systems; this behavior facilitates modularity with different
database designs. Since these devices implement the \"edge\" of the LISP
control plane infrastructure, connecting EID addressable nodes of a LISP
site, the implementation and operational complexity of the overall cost
and effort of deploying LISP is
reduced.[¶](#section-abstract-2){.pilcrow}

This document obsoletes RFCs 6830 and
6833.[¶](#section-abstract-3){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9301>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2022 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Revised BSD License text as described in Section 4.e of the Trust Legal
Provisions and are provided without warranty as described in the Revised
BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.auto .internal
    .xref}.  [Introduction](#name-introduction){.internal .xref}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.auto .internal .xref}.  [Scope of
        Applicability](#name-scope-of-applicability){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.auto .internal .xref}.  [Requirements
    Notation](#name-requirements-notation){.internal .xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.auto .internal .xref}.  [Definitions of
    Terms](#name-definitions-of-terms){.internal .xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.auto .internal .xref}.  [Basic
    Overview](#name-basic-overview){.internal .xref}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.auto .internal .xref}.  [LISP IPv4 and IPv6 Control
    Plane Packet Formats](#name-lisp-ipv4-and-ipv6-control-){.internal
    .xref}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.auto .internal .xref}.  [LISP Control
        Packet Type
        Allocations](#name-lisp-control-packet-type-al){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.auto .internal .xref}.  [Map-Request
        Message Format](#name-map-request-message-format){.internal
        .xref}
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.auto .internal .xref}.  [EID-to-RLOC UDP
        Map-Request
        Message](#name-eid-to-rloc-udp-map-request){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.5.2.4}
        [5.4](#section-5.4){.auto .internal .xref}.  [Map-Reply Message
        Format](#name-map-reply-message-format){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.5.2.5}
        [5.5](#section-5.5){.auto .internal .xref}.  [EID-to-RLOC UDP
        Map-Reply Message](#name-eid-to-rloc-udp-map-reply-m){.internal
        .xref}
        :::

    -   ::: {#section-toc.1-1.5.2.6}
        [5.6](#section-5.6){.auto .internal .xref}.  [Map-Register
        Message Format](#name-map-register-message-format){.internal
        .xref}
        :::

    -   ::: {#section-toc.1-1.5.2.7}
        [5.7](#section-5.7){.auto .internal .xref}.  [Map-Notify and
        Map-Notify-Ack Message
        Formats](#name-map-notify-and-map-notify-a){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.5.2.8}
        [5.8](#section-5.8){.auto .internal .xref}.  [Encapsulated
        Control Message
        Format](#name-encapsulated-control-messag){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.auto .internal .xref}.  [Changing the Contents of
    EID-to-RLOC Mappings](#name-changing-the-contents-of-ei){.internal
    .xref}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.auto .internal
        .xref}.  [Solicit-Map-Request
        (SMR)](#name-solicit-map-request-smr){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.auto .internal .xref}.  [Routing Locator
    Reachability](#name-routing-locator-reachabilit){.internal .xref}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.auto .internal .xref}.  [RLOC-Probing
        Algorithm](#name-rloc-probing-algorithm){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.auto .internal .xref}.  [Interactions with Other
    LISP Components](#name-interactions-with-other-lis){.internal .xref}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.auto .internal .xref}.  [ITR EID-to-RLOC
        Mapping Resolution](#name-itr-eid-to-rloc-mapping-res){.internal
        .xref}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.auto .internal .xref}.  [EID-Prefix
        Configuration and ETR
        Registration](#name-eid-prefix-configuration-an){.internal
        .xref}
        :::

    -   ::: {#section-toc.1-1.8.2.3}
        [8.3](#section-8.3){.auto .internal .xref}.  [Map-Server
        Processing](#name-map-server-processing){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.8.2.4}
        [8.4](#section-8.4){.auto .internal .xref}.  [Map-Resolver
        Processing](#name-map-resolver-processing){.internal .xref}

        -   ::: {#section-toc.1-1.8.2.4.2.1}
            [8.4.1](#section-8.4.1){.auto .internal .xref}.  [Anycast
            Operation](#name-anycast-operation){.internal .xref}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.auto .internal .xref}.  [Security
    Considerations](#name-security-considerations){.internal .xref}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.auto .internal .xref}. [Privacy
    Considerations](#name-privacy-considerations){.internal .xref}
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.auto .internal .xref}. [Changes Related to RFCs
    6830 and 6833](#name-changes-related-to-rfcs-683){.internal .xref}
    :::

-   ::: {#section-toc.1-1.12}
    [12](#section-12){.auto .internal .xref}. [IANA
    Considerations](#name-iana-considerations){.internal .xref}

    -   ::: {#section-toc.1-1.12.2.1}
        [12.1](#section-12.1){.auto .internal .xref}.  [LISP UDP Port
        Numbers](#name-lisp-udp-port-numbers){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.12.2.2}
        [12.2](#section-12.2){.auto .internal .xref}.  [LISP Packet Type
        Codes](#name-lisp-packet-type-codes){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.12.2.3}
        [12.3](#section-12.3){.auto .internal .xref}.  [LISP Map-Reply
        EID-Record Action
        Codes](#name-lisp-map-reply-eid-record-a){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.12.2.4}
        [12.4](#section-12.4){.auto .internal .xref}.  [LISP Address
        Type Codes](#name-lisp-address-type-codes){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.12.2.5}
        [12.5](#section-12.5){.auto .internal .xref}.  [LISP Algorithm
        ID Numbers](#name-lisp-algorithm-id-numbers){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.12.2.6}
        [12.6](#section-12.6){.auto .internal .xref}.  [LISP Bit
        Flags](#name-lisp-bit-flags){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.13}
    [13](#section-13){.auto .internal
    .xref}. [References](#name-references){.internal .xref}

    -   ::: {#section-toc.1-1.13.2.1}
        [13.1](#section-13.1){.auto .internal .xref}.  [Normative
        References](#name-normative-references){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.13.2.2}
        [13.2](#section-13.2){.auto .internal .xref}.  [Informative
        References](#name-informative-references){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.14}
    [](#appendix-A){.auto .internal
    .xref}[Acknowledgments](#name-acknowledgments){.internal .xref}
    :::

-   ::: {#section-toc.1-1.15}
    [](#appendix-B){.auto .internal .xref}[Authors\'
    Addresses](#name-authors-addresses){.internal .xref}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

The Locator/ID Separation Protocol \[[RFC9300](#RFC9300){.cite .xref}\]
(see also \[[RFC9299](#RFC9299){.cite .xref}\]) specifies an
architecture and mechanism for dynamic tunneling by logically separating
the addresses currently used by IP in two separate namespaces: Endpoint
IDs (EIDs), used within sites; and Routing Locators (RLOCs), used on the
transit networks that make up the Internet infrastructure. To achieve
this separation, LISP defines protocol mechanisms for mapping from EIDs
to RLOCs. In addition, LISP assumes the existence of a database to store
and propagate those mappings across Mapping System nodes. Several such
databases have been proposed; among them are the Content distribution
Overlay Network Service for LISP-NERD (a Not-so-novel EID-to-RLOC
Database) \[[RFC6837](#RFC6837){.cite .xref}\], LISP Alternative Logical
Topology (LISP-ALT) \[[RFC6836](#RFC6836){.cite .xref}\], and LISP
Delegated Database Tree (LISP-DDT) \[[RFC8111](#RFC8111){.cite
.xref}\].[¶](#section-1-1){.pilcrow}

The LISP Mapping Service defines two types of LISP-speaking devices: the
Map-Resolver, which accepts Map-Requests from an Ingress Tunnel Router
(ITR) and \"resolves\" the EID-to-RLOC mapping using a mapping database;
and the Map-Server, which learns authoritative EID-to-RLOC mappings from
an Egress Tunnel Router (ETR) and publishes them in a
database.[¶](#section-1-2){.pilcrow}

This LISP control plane and Mapping Service can be used by many
different encapsulation-based or translation-based data planes,
including but not limited to those defined in LISP
\[[RFC9300](#RFC9300){.cite .xref}\], the LISP Generic Protocol
Extension (LISP-GPE) \[[RFC9305](#RFC9305){.cite .xref}\], Virtual
eXtensible Local Area Networks (VXLANs) \[[RFC7348](#RFC7348){.cite
.xref}\], VXLAN-GPE \[[NVO3-VXLAN-GPE](#NVO3-VXLAN-GPE){.cite .xref}\],
GRE \[[RFC2890](#RFC2890){.cite .xref}\], the GPRS Tunneling Protocol
(GTP) \[[GTP-3GPP](#GTP-3GPP){.cite .xref}\], Identifier-Locator
Addressing (ILA) \[[INTAREA-ILA](#I-D.herbert-intarea-ila){.cite
.xref}\], and Segment Routing (SRv6) \[[RFC8402](#RFC8402){.cite
.xref}\].[¶](#section-1-3){.pilcrow}

Conceptually, LISP Map-Servers share some of the same basic
configuration and maintenance properties as Domain Name System (DNS)
servers \[[RFC1035](#RFC1035){.cite .xref}\]; likewise, Map-Resolvers
are conceptually similar to DNS caching resolvers. With this in mind,
this specification borrows familiar terminology (resolver and server)
from the DNS specifications.[¶](#section-1-4){.pilcrow}

Note that this document doesn\'t assume any particular database mapping
infrastructure to illustrate certain aspects of Map-Server and
Map-Resolver operations. The Mapping Service interface can (and likely
will) be used by ITRs and ETRs to access other mapping database systems
as the LISP infrastructure evolves.[¶](#section-1-5){.pilcrow}

LISP is not intended to address problems of connectivity and scaling on
behalf of arbitrary communicating parties. Relevant situations are
described in [Section
1.1](https://www.rfc-editor.org/rfc/rfc9300#section-1.1){.relref} of
\[[RFC9300](#RFC9300){.cite .xref}\].[¶](#section-1-6){.pilcrow}

This document obsoletes \[[RFC6830](#RFC6830){.cite .xref}\] and
\[[RFC6833](#RFC6833){.cite .xref}\].[¶](#section-1-7){.pilcrow}

::: {#soa}
::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Scope of Applicability](#name-scope-of-applicability){.section-name .selfRef} {#name-scope-of-applicability}

LISP was originally developed to address the Internet-wide route scaling
problem \[[RFC4984](#RFC4984){.cite .xref}\]. While there are a number
of approaches of interest for that problem, as LISP has been developed
and refined, a large number of other uses for LISP have been found and
are being implemented. As such, the design and development of LISP have
changed so as to focus on these use cases. The common property of these
uses is a large set of cooperating entities seeking to communicate over
the public Internet or other large underlay IP infrastructures while
keeping the addressing and topology of the cooperating entities separate
from the underlay and Internet topology, routing, and
addressing.[¶](#section-1.1-1){.pilcrow}

When communicating over the public Internet, deployers [MUST]{.bcp14}
consider the following guidelines:[¶](#section-1.1-2){.pilcrow}

1.  [LISP Security (LISP-SEC) [MUST]{.bcp14} be implemented
    \[[RFC9303](#RFC9303){.cite .xref}\]. This means that the S-bit
    [MUST]{.bcp14} be set in the Map-Reply ([Section
    5.4](#MR-FORMAT){.auto .internal .xref}), Map-Register ([Section
    5.6](#MAPREG){.auto .internal .xref}), and Encapsulated Control
    Messages (ECMs) ([Section 5.8](#encap-mr){.auto .internal
    .xref}).[¶](#section-1.1-3.1){.pilcrow}]{#section-1.1-3.1}
2.  [Implementations [SHOULD]{.bcp14} use
    \'HMAC-SHA256-128+HKDF-SHA256\' as the Algorithm ID ([Section
    12.5](#KEYS){.auto .internal .xref}) in the Map-Register message
    ([Section 5.6](#MAPREG){.auto .internal .xref}) and [MUST
    NOT]{.bcp14} use \'None\' or \'HMAC-SHA-1-96-None\' as the Algorithm
    ID ([Section 12.5](#KEYS){.auto .internal .xref}) in the
    Map-Register message ([Section 5.6](#MAPREG){.auto .internal
    .xref}).[¶](#section-1.1-3.2){.pilcrow}]{#section-1.1-3.2}
:::
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Requirements Notation](#name-requirements-notation){.section-name .selfRef} {#name-requirements-notation}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.cite .xref}\]
\[[RFC8174](#RFC8174){.cite .xref}\] when, and only when, they appear in
all capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::

::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Definitions of Terms](#name-definitions-of-terms){.section-name .selfRef} {#name-definitions-of-terms}

[]{.break}

Map-Server:
:   A network infrastructure component that learns of EID-Prefix mapping
    entries from an ETR, via the registration mechanism described below,
    or some other authoritative source if one exists. A Map-Server
    publishes these EID-Prefixes in a mapping
    database.[¶](#section-3-1.2){.pilcrow}
:   

Map-Request:
:   A control plane message that queries the Mapping System to resolve
    an EID. A LISP Map-Request can also be sent to an RLOC to test for
    reachability and to exchange security keys between an encapsulator
    and a decapsulator. This type of Map-Request is also known as an
    RLOC-Probe Request.[¶](#section-3-1.4){.pilcrow}
:   

Map-Reply:
:   A control plane message returned in response to a Map-Request sent
    to the Mapping System when resolving an EID. A LISP Map-Reply can
    also be returned by a decapsulator in response to a Map-Request sent
    by an encapsulator to test for reachability. This type of Map-Reply
    is known as an RLOC-Probe Reply.[¶](#section-3-1.6){.pilcrow}
:   

Encapsulated Map-Request:
:   A LISP Map-Request carried within an ECM. This Map-Request has an
    additional LISP header prepended. Sent to UDP destination port 4342.
    The \"outer\" addresses are routable IP addresses, also known as
    RLOCs. Used by an ITR when sending to a Map-Resolver and by a
    Map-Server when forwarding a Map-Request to an
    ETR.[¶](#section-3-1.8){.pilcrow}
:   

Map-Resolver:
:   A network infrastructure component that accepts LISP Encapsulated
    (ECM) Map-Requests, typically from an ITR, and determines whether or
    not the destination IP address is part of the EID namespace; if it
    is not, a Negative Map-Reply is returned. Otherwise, the
    Map-Resolver finds the appropriate EID-to-RLOC mapping by consulting
    a mapping database system.[¶](#section-3-1.10){.pilcrow}
:   

Negative Map-Reply:
:   A LISP Map-Reply that contains an empty Locator-Set. Returned in
    response to a Map-Request if the destination EID is not registered
    in the Mapping System, is policy-denied, or fails
    authentication.[¶](#section-3-1.12){.pilcrow}
:   

Map-Register message:
:   A LISP message sent by an ETR to a Map-Server to register its
    associated EID-Prefixes. In addition to the set of EID-Prefixes to
    register, the message includes one or more RLOCs to reach ETR(s).
    The Map-Server uses these RLOCs when forwarding Map-Requests
    (reformatted as Encapsulated Map-Requests). An ETR [MAY]{.bcp14}
    request that the Map-Server answer Map-Requests on its behalf by
    setting the \"proxy Map-Reply\" flag (P-bit) in the
    message.[¶](#section-3-1.14){.pilcrow}
:   

Map-Notify message:
:   A LISP message sent by a Map-Server to an ETR to confirm that a
    Map-Register has been received and processed. An ETR requests that a
    Map-Notify be returned by setting the \"want-map-notify\" flag
    (M-bit) in the Map-Register message. Unlike a Map-Reply, a
    Map-Notify uses UDP port 4342 for both source and destination.
    Map-Notify messages are also sent to ITRs by Map-Servers when there
    are RLOC-Set changes.[¶](#section-3-1.16){.pilcrow}
:   

For definitions of other terms, notably Ingress Tunnel Router (ITR),
Egress Tunnel Router (ETR), and Re-encapsulating Tunnel Router (RTR),
refer to the LISP data plane specification \[[RFC9300](#RFC9300){.cite
.xref}\].[¶](#section-3-2){.pilcrow}
:::

::: {#OVERVIEW}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Basic Overview](#name-basic-overview){.section-name .selfRef} {#name-basic-overview}

A Map-Server is a device that publishes EID-Prefixes in a LISP mapping
database on behalf of a set of ETRs. When it receives a Map-Request
(typically originating from an ITR), it consults the mapping database to
find an ETR that can answer with the set of RLOCs for an EID-Prefix. To
publish its EID-Prefixes, an ETR periodically sends Map-Register
messages to the Map-Server. A Map-Register message contains a list of
EID-Prefixes plus a set of RLOCs that can be used to reach the
ETRs.[¶](#section-4-1){.pilcrow}

When LISP-ALT \[[RFC6836](#RFC6836){.cite .xref}\] is used as the
mapping database, a Map-Server connects to the ALT network and acts as a
\"last-hop\" ALT-Router. Intermediate ALT-Routers forward Map-Requests
to the Map-Server that advertises a particular EID-Prefix, and the
Map-Server forwards them to the owning ETR, which responds with
Map-Reply messages.[¶](#section-4-2){.pilcrow}

When LISP-DDT \[[RFC8111](#RFC8111){.cite .xref}\] is used as the
mapping database, a Map-Server sends the final Map-Referral messages
from the Delegated Database Tree.[¶](#section-4-3){.pilcrow}

A Map-Resolver receives Encapsulated Map-Requests from its client ITRs
and uses a mapping database system to find the appropriate ETR to answer
those requests. On a LISP-ALT network, a Map-Resolver acts as a
\"first-hop\" ALT-Router. It has Generic Routing Encapsulation (GRE)
tunnels configured to other ALT-Routers and uses BGP to learn paths to
ETRs for different prefixes in the LISP-ALT database. The Map-Resolver
uses this path information to forward Map-Requests over the ALT to the
correct ETRs. On a LISP-DDT network \[[RFC8111](#RFC8111){.cite
.xref}\], a Map-Resolver maintains a referral cache and acts as a
\"first-hop\" DDT node. The Map-Resolver uses the referral information
to forward Map-Requests.[¶](#section-4-4){.pilcrow}

Note that while it is conceivable that a Map-Resolver could cache
responses to improve performance, issues surrounding cache management
would need to be resolved so that doing so would be reliable and
practical. In this specification, Map-Resolvers will operate only in a
non-caching mode, decapsulating and forwarding Encapsulated Map-Requests
received from ITRs. Any specification of caching functionality is out of
scope for this document.[¶](#section-4-5){.pilcrow}

Note that a single device can implement the functions of both a
Map-Server and a Map-Resolver, and in many cases, the functions will be
co-located in that way. Also, there can be ALT-only nodes and DDT-only
nodes, when LISP-ALT and LISP-DDT are used, respectively, connecting
Map-Resolvers and Map-Servers together to make up the Mapping
System.[¶](#section-4-6){.pilcrow}
:::
:::

::: {#lispcp}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [LISP IPv4 and IPv6 Control Plane Packet Formats](#name-lisp-ipv4-and-ipv6-control-){.section-name .selfRef} {#name-lisp-ipv4-and-ipv6-control-}

The following UDP packet formats are used by the LISP control
plane.[¶](#section-5-1){.pilcrow}

[]{#name-ipv4-udp-lisp-control-messa}

::: {#section-5-2.1 .alignLeft .art-text .artwork}
         0                   1                   2                   3
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |Version|  IHL  |Type of Service|          Total Length         |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |         Identification        |Flags|      Fragment Offset    |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |  Time to Live | Protocol = 17 |         Header Checksum       |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                    Source Routing Locator                     |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                 Destination Routing Locator                   |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      / |           Source Port         |         Dest Port             |
    UDP +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      \ |           UDP Length          |        UDP Checksum           |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                                                               |
        |                         LISP Message                          |
        |                                                               |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:::

[Figure 1](#figure-1){.selfRef}: [IPv4 UDP LISP Control
Message](#name-ipv4-udp-lisp-control-messa){.selfRef}

[]{#name-ipv6-udp-lisp-control-messa}

::: {#section-5-3.1 .alignLeft .art-text .artwork}
         0                   1                   2                   3
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |Version| Traffic Class |           Flow Label                  |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |         Payload Length        | Next Header=17|   Hop Limit   |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                                                               |
        +                                                               +
        |                                                               |
        +                     Source Routing Locator                    +
        |                                                               |
        +                                                               +
        |                                                               |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                                                               |
        +                                                               +
        |                                                               |
        +                  Destination Routing Locator                  +
        |                                                               |
        +                                                               +
        |                                                               |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      / |           Source Port         |         Dest Port             |
    UDP +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      \ |           UDP Length          |        UDP Checksum           |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                                                               |
        |                         LISP Message                          |
        |                                                               |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:::

[Figure 2](#figure-2){.selfRef}: [IPv6 UDP LISP Control
Message](#name-ipv6-udp-lisp-control-messa){.selfRef}

When a UDP Map-Request, Map-Register, or Map-Notify (when used as a
notification message) is sent, the UDP source port is chosen by the
sender and the destination UDP port number is set to 4342. When a UDP
Map-Reply, Map-Notify (when used as an acknowledgment to a
Map-Register), or Map-Notify-Ack is sent, the source UDP port number is
set to 4342 and the destination UDP port number is copied from the
source port of either the Map-Request or the invoking data packet.
Implementations [MUST]{.bcp14} be prepared to accept packets when either
the source port or destination UDP port is set to 4342 due to NATs
changing port number values.[¶](#section-5-4){.pilcrow}

The \'UDP Length\' field will reflect the length of the UDP header and
the LISP Message payload. LISP is expected to be deployed by cooperating
entities communicating over underlays. Deployers are expected to set the
MTU according to the specific deployment guidelines to prevent
fragmentation of either the inner packet or the outer encapsulated
packet. For deployments not aware of the underlay restrictions on the
path MTU, the message size [MUST]{.bcp14} be limited to 576 bytes for
IPv4 or 1280 bytes for IPv6 \-- considering the entire IP packet \-- as
outlined in \[[RFC8085](#RFC8085){.cite
.xref}\].[¶](#section-5-5){.pilcrow}

The UDP checksum is computed and set to non-zero for all messages sent
to or from port 4342. It [MUST]{.bcp14} be checked on receipt, and if
the checksum fails, the control message [MUST]{.bcp14} be dropped
\[[RFC1071](#RFC1071){.cite .xref}\].[¶](#section-5-6){.pilcrow}

The format of control messages includes the UDP header so the checksum
and length fields can be used to protect and delimit message
boundaries.[¶](#section-5-7){.pilcrow}

::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [LISP Control Packet Type Allocations](#name-lisp-control-packet-type-al){.section-name .selfRef} {#name-lisp-control-packet-type-al}

This section defines the LISP control message formats and summarizes for
IANA the LISP Type codes assigned by this document. For completeness,
the summary below includes the LISP Shared Extension Message assigned by
\[[RFC9304](#RFC9304){.cite .xref}\]. Message type definitions
are:[¶](#section-5.1-1){.pilcrow}

  Message                             Code   Codepoint
  ----------------------------------- ------ ----------------------
  Reserved                            0      b\'0000\'
  LISP Map-Request                    1      b\'0001\'
  LISP Map-Reply                      2      b\'0010\'
  LISP Map-Register                   3      b\'0011\'
  LISP Map-Notify                     4      b\'0100\'
  LISP Map-Notify-Ack                 5      b\'0101\'
  LISP DDT Map-Referral               6      b\'0110\'
  Unassigned                          7      b\'0111\'
  LISP Encapsulated Control Message   8      b\'1000\'
  Unassigned                          9-14   b\'1001\'- b\'1110\'
  LISP Shared Extension Message       15     b\'1111\'

  : [Table 1](#table-1){.selfRef}

Protocol designers experimenting with new message formats are
recommended to use the LISP Shared Extension Message Type described in
\[[RFC9304](#RFC9304){.cite .xref}\].[¶](#section-5.1-3){.pilcrow}

All LISP control plane messages use Address Family Identifiers (AFIs)
\[[AFN](#AFN){.cite .xref}\] or LISP Canonical Address Format (LCAF)
entries \[[RFC8060](#RFC8060){.cite .xref}\] to encode either
fixed-length or variable-length addresses. This includes explicit fields
in each control message or part of EID-Records or RLOC-Records in
commonly formatted messages. LISP control plane messages that include an
unrecognized AFI [MUST]{.bcp14} be dropped, and the event [MUST]{.bcp14}
be logged.[¶](#section-5.1-4){.pilcrow}

The LISP control plane describes how other data planes can encode
messages to support the soliciting of Map-Requests as well as
RLOC-Probing procedures.[¶](#section-5.1-5){.pilcrow}
:::

::: {#NONCE}
::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [Map-Request Message Format](#name-map-request-message-format){.section-name .selfRef} {#name-map-request-message-format}

::: {#section-5.2-1 .alignLeft .art-text .artwork}
         0                   1                   2                   3
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |Type=1 |A|M|P|S|p|s|R|R|  Rsvd   |L|D|   IRC   | Record Count  |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                         Nonce . . .                           |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                         . . . Nonce                           |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |         Source-EID-AFI        |   Source EID Address  ...     |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |         ITR-RLOC-AFI 1        |    ITR-RLOC Address 1  ...    |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                              ...                              |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |         ITR-RLOC-AFI n        |    ITR-RLOC Address n  ...    |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      / |   Reserved    | EID mask-len  |        EID-Prefix-AFI         |
    Rec +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      \ |                       EID-Prefix  ...                         |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                   Map-Reply Record  ...                       |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-5.2-1){.pilcrow}
:::

Packet field descriptions:[¶](#section-5.2-2){.pilcrow}

[]{.break}

Type:
:   1 (Map-Request)[¶](#section-5.2-3.2){.pilcrow}
:   

A:
:   This is an authoritative bit. It is set to 1 when an ITR wants the
    destination site to return the Map-Reply rather than the mapping
    database system returning a Map-Reply and is set to 0
    otherwise.[¶](#section-5.2-3.4){.pilcrow}
:   

M:
:   This is the map-data-present bit. When set, it indicates that a
    Map-Reply Record segment is included in the
    Map-Request.[¶](#section-5.2-3.6){.pilcrow}
:   

P:
:   This is the probe-bit, which indicates that a Map-Request
    [MUST]{.bcp14} be treated as a Locator reachability probe. The
    receiver [MUST]{.bcp14} respond with a Map-Reply with the probe-bit
    set, indicating that the Map-Reply is a Locator reachability probe
    reply, with the nonce copied from the Map-Request. See
    \"[RLOC-Probing Algorithm](#rloc-probe){.internal .xref}\" ([Section
    7.1](#rloc-probe){.auto .internal .xref}) for more details. This
    RLOC-Probe Map-Request [MUST NOT]{.bcp14} be sent to the Mapping
    System. If a Map-Resolver or Map-Server receives a Map-Request with
    the probe-bit set, it [MUST]{.bcp14} drop the
    message.[¶](#section-5.2-3.8){.pilcrow}
:   

S:
:   This is the Solicit-Map-Request (SMR) bit. See
    \"[Solicit-Map-Request (SMR)](#SMR){.internal .xref}\" ([Section
    6.1](#SMR){.auto .internal .xref}) for
    details.[¶](#section-5.2-3.10){.pilcrow}
:   

p:
:   This is the Proxy Ingress Tunnel Router (PITR) bit. This bit is set
    to 1 when a PITR sends a Map-Request. The use of this bit is
    deployment specific.[¶](#section-5.2-3.12){.pilcrow}
:   

s:
:   This is the SMR-invoked bit. This bit is set to 1 when an xTR is
    sending a Map-Request in response to a received SMR-based
    Map-Request.[¶](#section-5.2-3.14){.pilcrow}
:   

R:
:   This reserved and unassigned bit [MUST]{.bcp14} be set to 0 on
    transmit and [MUST]{.bcp14} be ignored on
    receipt.[¶](#section-5.2-3.16){.pilcrow}
:   

Rsvd:
:   This field [MUST]{.bcp14} be set to 0 on transmit and [MUST]{.bcp14}
    be ignored on receipt.[¶](#section-5.2-3.18){.pilcrow}
:   

L:
:   This is the local-xtr bit. It is used by an xTR in a LISP site to
    tell other xTRs in the same site that it is part of the RLOC-Set for
    the LISP site. The L-bit is set to 1 when the RLOC is the sender\'s
    IP address.[¶](#section-5.2-3.20){.pilcrow}
:   

D:
:   This is the dont-map-reply bit. It is used in the SMR procedure
    described in [Section 6.1](#SMR){.auto .internal .xref}. When an xTR
    sends an SMR message, it doesn\'t need a Map-Reply returned. When
    this bit is set, the receiver of the Map-Request does not return a
    Map-Reply.[¶](#section-5.2-3.22){.pilcrow}
:   

IRC:
:   This 5-bit field is the ITR-RLOC Count, which encodes the additional
    number of (\'ITR-RLOC-AFI\', \'ITR-RLOC Address\') fields present in
    this message. At least one (ITR-RLOC-AFI, ITR-RLOC Address) pair
    [MUST]{.bcp14} be encoded. Multiple \'ITR-RLOC Address\' fields are
    used, so a Map-Replier can select which destination address to use
    for a Map-Reply. The IRC value ranges from 0 to 31. For a value of
    0, there is 1 ITR-RLOC address encoded; for a value of 1, there are
    2 ITR-RLOC addresses encoded, and so on up to 31, which encodes a
    total of 32 ITR-RLOC addresses.[¶](#section-5.2-3.24){.pilcrow}
:   

Record Count:
:   This is the number of records in this Map-Request message. A record
    is comprised of the portion of the packet that is labeled \'Rec\'
    above and occurs the number of times equal to Record Count. For this
    version of the protocol, a receiver [MUST]{.bcp14} accept and
    process Map-Requests that contain one or more records, but a sender
    [MUST]{.bcp14} only send Map-Requests containing one
    record.[¶](#section-5.2-3.26){.pilcrow}
:   

Nonce:
:   This is an 8-octet random value created by the sender of the
    Map-Request. This nonce will be returned in the Map-Reply. The nonce
    is used as an index to identify the corresponding Map-Request when a
    Map-Reply message is received. The nonce [MUST]{.bcp14} be generated
    by a properly seeded pseudo-random source; for example, see
    \[[RFC4086](#RFC4086){.cite
    .xref}\].[¶](#section-5.2-3.28){.pilcrow}
:   

Source-EID-AFI:
:   This is the address family of the \'Source EID Address\'
    field.[¶](#section-5.2-3.30){.pilcrow}
:   

Source EID Address:
:   This is the EID of the source host that originated the packet that
    caused the Map-Request. When Map-Requests are used for refreshing a
    Map-Cache entry or for RLOC-Probing, an AFI value of 0 is used, and
    this field is of zero length.[¶](#section-5.2-3.32){.pilcrow}
:   

ITR-RLOC-AFI:
:   This is the address family of the \'ITR-RLOC Address\' field that
    follows this field.[¶](#section-5.2-3.34){.pilcrow}
:   

ITR-RLOC Address:
:   This is used to give the ETR the option of selecting the destination
    address from any address family for the Map-Reply message. This
    address [MUST]{.bcp14} be a routable RLOC address of the sender of
    the Map-Request message.[¶](#section-5.2-3.36){.pilcrow}
:   

EID mask-len:
:   This is the mask length for the
    EID-Prefix.[¶](#section-5.2-3.38){.pilcrow}
:   

EID-Prefix-AFI:
:   This is the address family of the EID-Prefix according to
    \[[AFN](#AFN){.cite .xref}\] and \[[RFC8060](#RFC8060){.cite
    .xref}\].[¶](#section-5.2-3.40){.pilcrow}
:   

EID-Prefix:
:   This prefix address length is 4 octets for an IPv4 address family
    and 16 octets for an IPv6 address family when the EID-Prefix-AFI is
    1 or 2, respectively. For other AFIs \[[AFN](#AFN){.cite .xref}\],
    the address length varies, and for the LCAF AFI, the format is
    defined in \[[RFC8060](#RFC8060){.cite .xref}\]. When a Map-Request
    is sent by an ITR because a data packet is received for a
    destination where there is no mapping entry, the EID-Prefix is set
    to the destination IP address of the data packet, and the \'EID
    mask-len\' field is set to 32 or 128 for IPv4 or IPv6, respectively.
    When an xTR wants to query a site about the status of a mapping it
    already has cached, the EID-Prefix used in the Map-Request has the
    same mask length as the EID-Prefix returned from the site when it
    sent a Map-Reply message.[¶](#section-5.2-3.42){.pilcrow}
:   

Map-Reply Record:
:   When the M-bit is set, this field is the size of a single \"Record\"
    in the Map-Reply format. This Map-Reply record contains the
    EID-to-RLOC mapping entry associated with the source EID. This
    allows the ETR that will receive this Map-Request to cache the data
    if it chooses to do so. It is important to note that this mapping
    has not been validated by the Mapping
    System.[¶](#section-5.2-3.44){.pilcrow}
:   
:::
:::

::: {#MAPREQ}
::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [EID-to-RLOC UDP Map-Request Message](#name-eid-to-rloc-udp-map-request){.section-name .selfRef} {#name-eid-to-rloc-udp-map-request}

A Map-Request is sent from an ITR when it needs a mapping for an EID,
wants to test an RLOC for reachability, or wants to refresh a mapping
before Time to Live (TTL) expiration. For the initial case, the
destination IP address used for the Map-Request is the data packet\'s
destination address (i.e., the destination EID) that had a mapping cache
lookup failure. For the latter two cases, the destination IP address
used for the Map-Request is one of the RLOC addresses from the
Locator-Set of the Map-Cache entry. The source address is either an IPv4
or IPv6 RLOC address, depending on whether the Map-Request is using an
IPv4 or IPv6 header, respectively. In all cases, the UDP source port
number for the Map-Request message is a 16-bit value selected by the
ITR/PITR, and the UDP destination port number is set to the well-known
destination port number 4342. A successful Map-Reply, which is one that
has a nonce that matches an outstanding Map-Request nonce, will update
the cached set of RLOCs associated with the EID-Prefix
range.[¶](#section-5.3-1){.pilcrow}

One or more Map-Request (\'ITR-RLOC-AFI\', \'ITR-RLOC Address\') fields
[MUST]{.bcp14} be filled in by the ITR. The number of fields (minus 1)
encoded [MUST]{.bcp14} be placed in the \'IRC\' field. The ITR
[MAY]{.bcp14} include all locally configured Locators in this list or
just provide one Routing Locator Address from each address family it
supports. If the ITR erroneously provides no ITR-RLOC addresses, the
Map-Replier [MUST]{.bcp14} drop the
Map-Request.[¶](#section-5.3-2){.pilcrow}

Map-Requests can also be LISP encapsulated using UDP destination
port 4342 with a LISP Type value set to \"Encapsulated Control
Message\", when sent from an ITR to a Map-Resolver. Likewise,
Map-Requests are LISP encapsulated the same way from a Map-Server to an
ETR. Details on Encapsulated Map-Requests and Map-Resolvers can be found
in [Section 5.8](#encap-mr){.auto .internal
.xref}.[¶](#section-5.3-3){.pilcrow}

Map-Requests [MUST]{.bcp14} be rate limited to 1 per second per
EID-Prefix. After 10 retransmits without receiving the corresponding
Map-Reply, the sender [MUST]{.bcp14} wait 30
seconds.[¶](#section-5.3-4){.pilcrow}

An ITR that is configured with mapping database information (i.e., it is
also an ETR) [MAY]{.bcp14} optionally include those mappings in a
Map-Request. When an ETR configured to accept and verify such
\"piggybacked\" mapping data receives such a Map-Request and it does not
have this mapping in the Map-Cache, it [MUST]{.bcp14} originate a
\"verifying Map-Request\" through the mapping database to validate the
\"piggybacked\" mapping data.[¶](#section-5.3-5){.pilcrow}
:::
:::

::: {#MR-FORMAT}
::: {#section-5.4 .section}
### [5.4.](#section-5.4){.section-number .selfRef} [Map-Reply Message Format](#name-map-reply-message-format){.section-name .selfRef} {#name-map-reply-message-format}

::: {#section-5.4-1 .alignLeft .art-text .artwork}
         0                   1                   2                   3
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |Type=2 |P|E|S|          Reserved               | Record Count  |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                         Nonce . . .                           |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                         . . . Nonce                           |
    +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   |                          Record TTL                           |
    |   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    R   | Locator Count | EID mask-len  | ACT |A|      Reserved         |
    e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    c   | Rsvd  |  Map-Version Number   |       EID-Prefix-AFI          |
    o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    r   |                          EID-Prefix                           |
    d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
    | L +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | o |        Unused Flags     |L|p|R|           Loc-AFI             |
    | c +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  \|                             Locator                           |
    +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-5.4-1){.pilcrow}
:::

Packet field descriptions:[¶](#section-5.4-2){.pilcrow}

[]{.break}

Type:
:   2 (Map-Reply)[¶](#section-5.4-3.2){.pilcrow}
:   

P:
:   This is the probe-bit, which indicates that the Map-Reply is in
    response to a Locator reachability probe Map-Request. The \'Nonce\'
    field must contain a copy of the nonce value from the original
    Map-Request. See \"[RLOC-Probing Algorithm](#rloc-probe){.internal
    .xref}\" ([Section 7.1](#rloc-probe){.auto .internal .xref}) for
    more details. When the probe-bit is set to 1 in a Map-Reply message,
    the A-bit in each EID-Record included in the message [MUST]{.bcp14}
    be set to 1; otherwise, it [MUST]{.bcp14} be silently
    discarded.[¶](#section-5.4-3.4){.pilcrow}
:   

E:
:   This bit indicates that the ETR that sends this Map-Reply message is
    advertising that the site is enabled for the Echo-Nonce Locator
    reachability algorithm. See
    Section [10.1](https://www.rfc-editor.org/rfc/rfc9300#section-10.1){.relref}
    ([\"Echo-Nonce
    Algorithm\"](https://www.rfc-editor.org/rfc/rfc9300#section-10.1){.relref})
    of \[[RFC9300](#RFC9300){.cite .xref}\] for more
    details.[¶](#section-5.4-3.6){.pilcrow}
:   

S:
:   This is the Security bit. When set to 1, the following
    authentication information will be appended to the end of the
    Map-Reply. Details can be found in \[[RFC9303](#RFC9303){.cite
    .xref}\].[¶](#section-5.4-3.8){.pilcrow}
:   

::: {#section-5.4-4 .alignLeft .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    AD Type    |       Authentication Data Content . . .       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-5.4-4){.pilcrow}
:::

[]{.break}

Reserved:
:   This unassigned field [MUST]{.bcp14} be set to 0 on transmit and
    [MUST]{.bcp14} be ignored on receipt.[¶](#section-5.4-5.2){.pilcrow}
:   

Record Count:
:   This is the number of records in this reply message. A record is
    comprised of that portion of the packet labeled \'Record\' above and
    occurs the number of times equal to Record Count. Note that the
    reply count can be larger than the requested count, for instance,
    when more-specific prefixes are
    present.[¶](#section-5.4-5.4){.pilcrow}
:   

Nonce:
:   This 64-bit value from the Map-Request is echoed in this \'Nonce\'
    field of the Map-Reply.[¶](#section-5.4-5.6){.pilcrow}
:   

Record TTL:
:   This is the time in minutes the recipient of the Map-Reply can store
    the mapping. If the TTL is 0, the entry [MUST]{.bcp14} be removed
    from the cache immediately. If the value is 0xffffffff, the
    recipient can decide locally how long to store the
    mapping.[¶](#section-5.4-5.8){.pilcrow}
:   

Locator Count:
:   This is the number of Locator entries in the given Record. A Locator
    entry comprises what is labeled above as \'Loc\'. The Locator count
    can be 0, indicating that there are no Locators for the
    EID-Prefix.[¶](#section-5.4-5.10){.pilcrow}
:   

EID mask-len:
:   This is the mask length for the
    EID-Prefix.[¶](#section-5.4-5.12){.pilcrow}
:   

ACT:

:   This 3-bit field describes Negative Map-Reply actions. In any other
    message type, these bits are set to 0 and ignored on receipt. These
    bits are used only when the \'Locator Count\' field is set to 0. The
    action bits are encoded only in Map-Reply messages. They are used to
    tell an ITR or PITR why an empty Locator-Set was returned from the
    Mapping System and how it stores the Map-Cache entry. See [Section
    12.3](#act-iana){.auto .internal .xref} for additional
    information.[¶](#section-5.4-5.14.1){.pilcrow}

    []{.break}

    \(0\) No-Action:
    :   The Map-Cache is kept alive, and no packet encapsulation
        occurs.[¶](#section-5.4-5.14.2.2){.pilcrow}
    :   

    \(1\) Natively-Forward:
    :   The packet is not encapsulated or dropped but natively
        forwarded.[¶](#section-5.4-5.14.2.4){.pilcrow}
    :   

    \(2\) Send-Map-Request:
    :   The Map-Cache entry is created and flagged so that any packet
        matching this entry invokes sending a
        Map-Request.[¶](#section-5.4-5.14.2.6){.pilcrow}
    :   

    \(3\) Drop/No-Reason:
    :   A packet that matches this Map-Cache entry is dropped. An ICMP
        Destination Unreachable message [SHOULD]{.bcp14} be
        sent.[¶](#section-5.4-5.14.2.8){.pilcrow}
    :   

    \(4\) Drop/Policy-Denied:
    :   A packet that matches this Map-Cache entry is dropped. The
        reason for the Drop action is that a Map-Request for the target
        EID is being policy-denied by either an xTR or the Mapping
        System.[¶](#section-5.4-5.14.2.10){.pilcrow}
    :   

    \(5\) Drop/Auth-Failure:
    :   A packet that matches this Map-Cache entry is dropped. The
        reason for the Drop action is that a Map-Request for the target
        EID fails an authentication verification check by either an xTR
        or the Mapping System.[¶](#section-5.4-5.14.2.12){.pilcrow}
    :   

:   

A:
:   The Authoritative bit [MAY]{.bcp14} only be set to 1 by an ETR. A
    Map-Server generating Map-Reply messages as a proxy [MUST
    NOT]{.bcp14} set the A-bit to 1. This bit indicates to the
    requesting ITRs if the Map-Reply was originated by a LISP node
    managed at the site that owns the
    EID-Prefix.[¶](#section-5.4-5.16){.pilcrow}
:   

Map-Version Number:
:   When this 12-bit value in an EID-Record of a Map-Reply message is
    non-zero, see \[[RFC9302](#RFC9302){.cite .xref}\] for
    details.[¶](#section-5.4-5.18){.pilcrow}
:   

EID-Prefix-AFI:
:   This is the address family of the EID-Prefix according to
    \[[AFN](#AFN){.cite .xref}\] and \[[RFC8060](#RFC8060){.cite
    .xref}\].[¶](#section-5.4-5.20){.pilcrow}
:   

EID-Prefix:
:   This prefix is 4 octets for an IPv4 address family and 16 octets for
    an IPv6 address family.[¶](#section-5.4-5.22){.pilcrow}
:   

Priority:
:   Each RLOC is assigned a unicast Priority. Lower values are
    preferable. When multiple RLOCs have the same Priority, they may be
    used in a load-split fashion. A value of 255 means the RLOC [MUST
    NOT]{.bcp14} be used for unicast
    forwarding.[¶](#section-5.4-5.24){.pilcrow}
:   

Weight:
:   When priorities are the same for multiple RLOCs, the Weight
    indicates how to balance unicast traffic between them. Weight is
    encoded as a relative weight of total unicast packets that match the
    mapping entry. For example, if there are 4 Locators in a
    Locator-Set, where the Weights assigned are 30, 20, 20, and 10, the
    first Locator will get 37.5% of the traffic, the second and third
    Locators will each get 25% of the traffic, and the fourth Locator
    will get 12.5% of the traffic. If all Weights for a Locator-Set are
    equal, the receiver of the Map-Reply will decide how to load-split
    the traffic. See
    Section [12](https://www.rfc-editor.org/rfc/rfc9300#section-12){.relref}
    ([\"Routing Locator
    Hashing\"](https://www.rfc-editor.org/rfc/rfc9300#section-12){.relref})
    of \[[RFC9300](#RFC9300){.cite .xref}\] for a suggested hash
    algorithm to distribute the load across Locators with the same
    Priority and equal Weight values.[¶](#section-5.4-5.26){.pilcrow}
:   

M Priority:
:   Each RLOC is assigned a multicast Priority used by an ETR in a
    receiver multicast site to select an ITR in a source multicast site
    for building multicast distribution trees. A value of 255 means the
    RLOC [MUST NOT]{.bcp14} be used for joining a multicast distribution
    tree. For more details, see \[[RFC6831](#RFC6831){.cite
    .xref}\].[¶](#section-5.4-5.28){.pilcrow}
:   

M Weight:
:   When priorities are the same for multiple RLOCs, the Weight
    indicates how to balance building multicast distribution trees
    across multiple ITRs. The Weight is encoded as a relative weight
    (similar to the unicast Weights) of the total number of trees built
    to the source site identified by the EID-Prefix. If all Weights for
    a Locator-Set are equal, the receiver of the Map-Reply will decide
    how to distribute multicast state across ITRs. For more details, see
    \[[RFC6831](#RFC6831){.cite
    .xref}\].[¶](#section-5.4-5.30){.pilcrow}
:   

Unused Flags:
:   These are set to 0 when sending and ignored on
    receipt.[¶](#section-5.4-5.32){.pilcrow}
:   

L:
:   When this bit is set, the Locator is flagged as a local Locator to
    the ETR that is sending the Map-Reply. When a Map-Server is doing
    proxy Map-Replying for a LISP site, the L-bit is set to 0 for all
    Locators in this Locator-Set.[¶](#section-5.4-5.34){.pilcrow}
:   

p:
:   When this bit is set, an ETR informs the RLOC-Probing ITR that the
    Routing Locator Address for which this bit is set is the one being
    RLOC-Probed and may be different from the source address of the
    Map-Reply. An ITR that RLOC-Probes a particular Locator
    [MUST]{.bcp14} use this Locator for retrieving the data structure
    used to store the fact that the Locator is reachable. The p-bit is
    set for a single Locator in the same Locator-Set. If an
    implementation sets more than one p-bit erroneously, the receiver of
    the Map-Reply [MUST]{.bcp14} select the first set p-bit Locator. The
    p-bit [MUST NOT]{.bcp14} be set for Locator-Set records sent in
    Map-Request and Map-Register
    messages.[¶](#section-5.4-5.36){.pilcrow}
:   

R:
:   This is set when the sender of a Map-Reply has a route to the
    Locator in the Locator data record. This receiver may find this
    useful to know if the Locator is up but not necessarily reachable
    from the receiver\'s point of view.[¶](#section-5.4-5.38){.pilcrow}
:   

Locator:
:   This is an IPv4 or IPv6 address (as encoded by the \'Loc-AFI\'
    field) assigned to an ETR and used by an ITR as a destination RLOC
    address in the outer header of a LISP encapsulated packet. Note that
    the destination RLOC address of a LISP encapsulated packet
    [MAY]{.bcp14} be an anycast address. A source RLOC of a LISP
    encapsulated packet can be an anycast address as well. The source or
    destination RLOC [MUST NOT]{.bcp14} be the broadcast address
    (255.255.255.255 or any subnet broadcast address known to the
    router) and [MUST NOT]{.bcp14} be a link-local multicast address.
    The source RLOC [MUST NOT]{.bcp14} be a multicast address. The
    destination RLOC [SHOULD]{.bcp14} be a multicast address if it is
    being mapped from a multicast destination
    EID.[¶](#section-5.4-5.40){.pilcrow}
:   

Map-Replies [MUST]{.bcp14} be rate limited. It is [RECOMMENDED]{.bcp14}
that a Map-Reply for the same destination RLOC be sent to no more than
one packet every 3 seconds.[¶](#section-5.4-6){.pilcrow}

The Record format, as defined here, is used both in the Map-Reply and
Map-Register messages; this includes all the field
definitions.[¶](#section-5.4-7){.pilcrow}
:::
:::

::: {#MR}
::: {#section-5.5 .section}
### [5.5.](#section-5.5){.section-number .selfRef} [EID-to-RLOC UDP Map-Reply Message](#name-eid-to-rloc-udp-map-reply-m){.section-name .selfRef} {#name-eid-to-rloc-udp-map-reply-m}

A Map-Reply returns an EID-Prefix with a mask length that is less than
or equal to the EID being requested. The EID being requested is either
from the destination field of an IP header of a Data-Probe or the EID of
a record of a Map-Request. The RLOCs in the Map-Reply are routable IP
addresses of all ETRs for the LISP site. Each RLOC conveys status
reachability but does not convey path reachability from a requester\'s
perspective. Separate testing of path reachability is required. See
\"[RLOC-Probing Algorithm](#rloc-probe){.internal .xref}\" ([Section
7.1](#rloc-probe){.auto .internal .xref}) for
details.[¶](#section-5.5-1){.pilcrow}

Note that a Map-Reply [MAY]{.bcp14} contain different EID-Prefix
granularity (prefix + mask length) than the Map-Request that triggers
it. This might occur if a Map-Request were for a prefix that had been
returned by an earlier Map-Reply. In such a case, the requester updates
its cache with the new prefix information and granularity. For example,
a requester with two cached EID-Prefixes that are covered by a Map-Reply
containing one less-specific prefix replaces the entry with the
less-specific EID-Prefix. Note that the reverse, replacement of one
less-specific prefix with multiple more-specific prefixes, can also
occur, not by removing the less-specific prefix but rather by adding the
more-specific prefixes that, during a lookup, will override the
less-specific prefix.[¶](#section-5.5-2){.pilcrow}

When an EID moves out of a LISP site
\[[EID-MOBILITY](#EID-MOBILITY){.cite .xref}\], the database Mapping
System may have overlapping EID-Prefixes. Or when a LISP site is
configured with multiple sets of ETRs that support different EID-Prefix
mask lengths, the database Mapping System may have overlapping
EID-Prefixes. When overlapping EID-Prefixes exist, a Map-Request with an
EID that best matches any EID-Prefix [MUST]{.bcp14} be returned in a
single Map-Reply message. For instance, if an ETR had database mapping
entries for EID-Prefixes:[¶](#section-5.5-3){.pilcrow}

::: {#section-5.5-4 .alignLeft .art-text .artwork}
      2001:db8::/32
      2001:db8:1::/48
      2001:db8:1:1::/64
      2001:db8:1:2::/64

[¶](#section-5.5-4){.pilcrow}
:::

A Map-Request for EID 2001:db8:1:1::1 would cause a Map-Reply with a
record count of 1 to be returned with a mapping record EID-Prefix of
2001:db8:1:1::/64.[¶](#section-5.5-5){.pilcrow}

A Map-Request for EID 2001:db8:1:5::5 would cause a Map-Reply with a
record count of 3 to be returned with mapping records for EID-Prefixes
2001:db8:1::/48, 2001:db8:1:1::/64, and 2001:db8:1:2::/64, filling out
the /48 with more-specific prefixes that exist in the Mapping
System.[¶](#section-5.5-6){.pilcrow}

Note that not all overlapping EID-Prefixes need to be returned but only
the more-specific entries (note in the second example above that
2001:db8::/32 was not returned for requesting EID 2001:db8:1:5::5) for
the matching EID-Prefix of the requesting EID. When more than one
EID-Prefix is returned, all [SHOULD]{.bcp14} use the same TTL value so
they can all time out at the same time. When a more-specific EID-Prefix
is received later, its TTL value in the Map-Reply record can be stored
even when other less-specific entries exist. When a less-specific
EID-Prefix is received later, its Map-Cache expiration time
[SHOULD]{.bcp14} be set to the minimum expiration time of any
more-specific EID-Prefix in the Map-Cache. This is done so the integrity
of the EID-Prefix set is wholly maintained and so no more-specific
entries are removed from the Map-Cache while keeping less-specific
entries.[¶](#section-5.5-7){.pilcrow}

For scalability, it is expected that aggregation of EID addresses into
EID-Prefixes will allow one Map-Reply to satisfy a mapping for the EID
addresses in the prefix range, thereby reducing the number of
Map-Request messages.[¶](#section-5.5-8){.pilcrow}

Map-Reply records can have an empty Locator-Set. A Negative Map-Reply is
a Map-Reply with an empty Locator-Set. Negative Map-Replies convey
special actions by the Map-Reply sender to the ITR or PITR that have
solicited the Map-Reply. There are two primary applications for Negative
Map-Replies. The first is for a Map-Resolver to instruct an ITR or PITR
when a destination is for a LISP site versus a non-LISP site, and the
other is to source quench Map-Requests that are sent for non-allocated
EIDs.[¶](#section-5.5-9){.pilcrow}

For each Map-Reply record, the list of Locators in a Locator-Set
[MUST]{.bcp14} be sorted in order of ascending IP address where an IPv4
Routing Locator Address is considered numerically \"less than\" an IPv6
Routing Locator Address.[¶](#section-5.5-10){.pilcrow}

When sending a Map-Reply message, the destination address is copied from
one of the \'ITR-RLOC\' fields from the Map-Request. The ETR can choose
a Routing Locator Address from one of the address families it supports.
For Data-Probes, the destination address of the Map-Reply is copied from
the source address of the Data-Probe message that is invoking the reply.
The source address of the Map-Reply is one of the chosen local IP
addresses; this allows Unicast Reverse Path Forwarding (uRPF) checks to
succeed in the upstream service provider. The destination port of a
Map-Reply message is copied from the source port of the Map-Request or
Data-Probe, and the source port of the Map-Reply message is set to the
well-known UDP port 4342.[¶](#section-5.5-11){.pilcrow}
:::
:::

::: {#MAPREG}
::: {#section-5.6 .section}
### [5.6.](#section-5.6){.section-number .selfRef} [Map-Register Message Format](#name-map-register-message-format){.section-name .selfRef} {#name-map-register-message-format}

This section specifies the encoding format for the Map-Register message.
The message is sent in UDP with a destination UDP port of 4342 and a
randomly selected UDP source port number.[¶](#section-5.6-1){.pilcrow}

The fields below are used in multiple control messages. They are defined
for Map-Register, Map-Notify, and Map-Notify-Ack message
types.[¶](#section-5.6-2){.pilcrow}

The Map-Register message format is:[¶](#section-5.6-3){.pilcrow}

::: {#section-5.6-4 .alignLeft .art-text .artwork}
         0                   1                   2                   3
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |Type=3 |P|S|I|        Reserved       |E|T|a|R|M| Record Count  |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                         Nonce . . .                           |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                         . . . Nonce                           |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |    Key ID     | Algorithm ID  |  Authentication Data Length   |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        ~                     Authentication Data                       ~
    +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   |                          Record TTL                           |
    |   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    R   | Locator Count | EID mask-len  | ACT |A|      Reserved         |
    e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    c   | Rsvd  |  Map-Version Number   |        EID-Prefix-AFI         |
    o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    r   |                          EID-Prefix                           |
    d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
    | L +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | o |        Unused Flags     |L|p|R|           Loc-AFI             |
    | c +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  \|                             Locator                           |
    +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-5.6-4){.pilcrow}
:::

Packet field descriptions:[¶](#section-5.6-5){.pilcrow}

[]{.break}

Type:
:   3 (Map-Register)[¶](#section-5.6-6.2){.pilcrow}
:   

P:
:   This is the proxy Map-Reply bit. When set to 1, the ETR sending the
    Map-Register message is requesting the Map-Server to proxy a
    Map-Reply. The Map-Server will send non-authoritative Map-Replies on
    behalf of the ETR.[¶](#section-5.6-6.4){.pilcrow}
:   

S:
:   This is the security-capable bit. When set, the procedures from
    \[[RFC9303](#RFC9303){.cite .xref}\] are
    supported.[¶](#section-5.6-6.6){.pilcrow}
:   

I:
:   This is the ID-present bit. This bit is set to 1 to indicate that a
    128-bit \'xTR-ID\' field and a 64-bit \'Site-ID\' field are present
    at the end of the Map-Register message. If an xTR is configured with
    an xTR-ID and Site-ID, it [MUST]{.bcp14} set the I-bit to 1 and
    include its xTR-ID and Site-ID in the Map-Register messages it
    generates. The combination of Site-ID plus xTR-ID uniquely
    identifies an xTR in a LISP domain and serves to track its last seen
    nonce.[¶](#section-5.6-6.8){.pilcrow}
:   

Reserved:
:   This unassigned field [MUST]{.bcp14} be set to 0 on transmit and
    [MUST]{.bcp14} be ignored on
    receipt.[¶](#section-5.6-6.10){.pilcrow}
:   

E:
:   This is the Map-Register EID-notify bit. This is used by a First-Hop
    Router that discovers a dynamic EID. This EID-notify-based
    Map-Register is sent by the First-Hop Router to a same site xTR that
    propagates the Map-Register to the Mapping System. The site xTR
    keeps state to later Map-Notify the First-Hop Router after the EID
    has moved away. See \[[EID-MOBILITY](#EID-MOBILITY){.cite .xref}\]
    for a detailed use case.[¶](#section-5.6-6.12){.pilcrow}
:   

T:
:   This is the use TTL for timeout bit. When set to 1, the xTR wants
    the Map-Server to time out registrations based on the value in the
    \'Record TTL\' field of this message. Otherwise, the default timeout
    described in [Section 8.2](#reg){.auto .internal .xref} is
    used.[¶](#section-5.6-6.14){.pilcrow}
:   

a:
:   This is the merge-request bit. When set to 1, the xTR requests to
    merge RLOC-Records from different xTRs registering the same
    EID-Record. See Signal-Free Multicast \[[RFC8378](#RFC8378){.cite
    .xref}\] for one use-case example.[¶](#section-5.6-6.16){.pilcrow}
:   

R:
:   This reserved and unassigned bit [MUST]{.bcp14} be set to 0 on
    transmit and [MUST]{.bcp14} be ignored on
    receipt.[¶](#section-5.6-6.18){.pilcrow}
:   

M:
:   This is the want-map-notify bit. When set to 1, an ETR is requesting
    a Map-Notify message to be returned in response to sending a
    Map-Register message. The Map-Notify message sent by a Map-Server is
    used to acknowledge receipt of a Map-Register
    message.[¶](#section-5.6-6.20){.pilcrow}
:   

Record Count:
:   This is the number of records in this Map-Register message. A record
    is comprised of that portion of the packet labeled \'Record\' above
    and occurs the number of times equal to Record
    Count.[¶](#section-5.6-6.22){.pilcrow}
:   

Nonce:
:   This 8-octet \'Nonce\' field is incremented each time a Map-Register
    message is sent. When a Map-Register acknowledgment is requested,
    the nonce is returned by Map-Servers in Map-Notify messages. Since
    the entire Map-Register message is authenticated, the \'Nonce\'
    field serves to protect against Map-Register replay attacks. An ETR
    that registers to the Mapping System [SHOULD]{.bcp14} store the last
    nonce sent in persistent storage, so when it restarts, it can
    continue using an incrementing nonce. If the ETR cannot support
    saving the nonce, then when it restarts, it [MUST]{.bcp14} use a new
    authentication key to register to the Mapping System. A Map-Server
    [MUST]{.bcp14} track and save in persistent storage the last nonce
    received for each ETR xTR-ID and key pair. If a Map-Register is
    received with a nonce value that is not greater than the saved
    nonce, it [MUST]{.bcp14} drop the Map-Register message and
    [SHOULD]{.bcp14} log the fact that a replay attack could have
    occurred.[¶](#section-5.6-6.24){.pilcrow}
:   

Key ID:
:   This is a key-id value that identifies a pre-shared secret between
    an ETR and a Map-Server. Per-message keys are derived from the
    pre-shared secret to authenticate the origin and protect the
    integrity of the Map-Register. The Key ID allows rotating between
    multiple pre-shared secrets in a nondisruptive way. The pre-shared
    secret [MUST]{.bcp14} be unique per each LISP
    Site-ID.[¶](#section-5.6-6.26){.pilcrow}
:   

Algorithm ID:
:   This field identifies the Key Derivation Function (KDF) and Message
    Authentication Code (MAC) algorithms used to derive the key and to
    compute the Authentication Data of a Map-Register. This 8-bit field
    identifies the KDF and MAC algorithm pair. See [Section
    12.5](#KEYS){.auto .internal .xref} for codepoint
    assignments.[¶](#section-5.6-6.28){.pilcrow}
:   

Authentication Data Length:
:   This is the length in octets of the \'Authentication Data\' field
    that follows this field. The length of the \'Authentication Data\'
    field is dependent on the MAC algorithm used. The length field
    allows a device that doesn\'t know the MAC algorithm to correctly
    parse the packet.[¶](#section-5.6-6.30){.pilcrow}
:   

Authentication Data:

:   This is the output of the MAC algorithm placed in this field after
    the MAC computation. The MAC output is computed as
    follows:[¶](#section-5.6-6.32.1){.pilcrow}

    1.  [The KDF algorithm is identified by the \'Algorithm ID\' field
        according to the table in [Section 12.5](#KEYS){.auto .internal
        .xref}. Implementations of this specification [MUST]{.bcp14}
        implement HMAC-SHA-256-128 \[[RFC4868](#RFC4868){.cite .xref}\]
        and [SHOULD]{.bcp14} implement HMAC-SHA-256-128+HKDF-SHA256
        \[[RFC5869](#RFC5869){.cite
        .xref}\].[¶](#section-5.6-6.32.2.1){.pilcrow}]{#section-5.6-6.32.2.1}
    2.  [The MAC algorithm is identified by the \'Algorithm ID\' field
        according to the table in [Section 12.5](#KEYS){.auto .internal
        .xref}.[¶](#section-5.6-6.32.2.2){.pilcrow}]{#section-5.6-6.32.2.2}
    3.  [The pre-shared secret used to derive the per-message key is
        represented by PSK\[Key ID\], that is, the pre-shared secret
        identified by the Key
        ID.[¶](#section-5.6-6.32.2.3){.pilcrow}]{#section-5.6-6.32.2.3}
    4.  [The derived per-message key is computed as:
        per-msg-key=KDF(nonce+PSK\[Key ID\],s). Where the nonce is the
        value in the \'Nonce\' field of the Map-Register, \"+\" denotes
        concatenation and \"s\" (the salt) is a string that corresponds
        to the message type being authenticated. For Map-Register
        messages, it is equal to \"Map-Register Authentication\".
        Similarly, for Map-Notify and Map-Notify-Ack messages, it is
        \"Map-Notify Authentication\" and \"Map-Notify-Ack
        Authentication\", respectively. For those Algorithm IDs defined
        in [Section 12.5](#KEYS){.auto .internal .xref} that specify a
        \'none\' KDF, the per-message key is computed as: per-msg-key =
        PSK\[Key ID\]. This means that the same key is used across
        multiple protocol
        messages.[¶](#section-5.6-6.32.2.4){.pilcrow}]{#section-5.6-6.32.2.4}
    5.  [The MAC output is computed using the MAC algorithm and the
        per-msg-key over the entire Map-Register payload (from and
        including the LISP message type field through the end of the
        last RLOC-Record) with the authenticated data field preset to
        0.[¶](#section-5.6-6.32.2.5){.pilcrow}]{#section-5.6-6.32.2.5}

:   

The definition of the rest of the Map-Register can be found in the
EID-Record description in [Section 5.4](#MR-FORMAT){.auto .internal
.xref}. When the I-bit is set, the following fields are added to the end
of the Map-Register message:[¶](#section-5.6-7){.pilcrow}

[]{.break}

xTR-ID:
:   \'xTR-ID\' is a 128-bit field at the end of the Map-Register
    message, starting after the final Record in the message. The xTR-ID
    is used to uniquely identify an xTR. The same xTR-ID value [MUST
    NOT]{.bcp14} be used in two different xTRs in the scope of the
    Site-ID.[¶](#section-5.6-8.2){.pilcrow}
:   

Site-ID:
:   \'Site-ID\' is a 64-bit field at the end of the Map-Register
    message, following the xTR-ID. The Site-ID is used to uniquely
    identify to which site the xTR that sent the message belongs. This
    document does not specify a strict meaning for the \'Site-ID\'
    field. Informally, it provides an indication that a group of xTRs
    have some relationship, either administratively, topologically, or
    otherwise.[¶](#section-5.6-8.4){.pilcrow}
:   
:::
:::

::: {#MAP-NOTIF-MAP-NOTIF-ACK}
::: {#section-5.7 .section}
### [5.7.](#section-5.7){.section-number .selfRef} [Map-Notify and Map-Notify-Ack Message Formats](#name-map-notify-and-map-notify-a){.section-name .selfRef} {#name-map-notify-and-map-notify-a}

This section specifies the encoding format for the Map-Notify and
Map-Notify-Ack messages. The messages are sent inside a UDP packet with
source and destination UDP ports equal to
4342.[¶](#section-5.7-1){.pilcrow}

The Map-Notify and Map-Notify-Ack message formats
are:[¶](#section-5.7-2){.pilcrow}

::: {#section-5.7-3 .alignLeft .art-text .artwork}
         0                   1                   2                   3
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |Type=4/5|             Reserved                 | Record Count  |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                         Nonce . . .                           |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |                         . . . Nonce                           |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |    Key ID     | Algorithm ID  |  Authentication Data Length   |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        ~                     Authentication Data                       ~
    +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   |                          Record TTL                           |
    |   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    R   | Locator Count | EID mask-len  | ACT |A|      Reserved         |
    e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    c   | Rsvd  |  Map-Version Number   |         EID-Prefix-AFI        |
    o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    r   |                          EID-Prefix                           |
    d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
    | L +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | o |        Unused Flags     |L|p|R|           Loc-AFI             |
    | c +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  \|                             Locator                           |
    +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-5.7-3){.pilcrow}
:::

Packet field descriptions:[¶](#section-5.7-4){.pilcrow}

[]{.break}

Type:
:   4/5 (Map-Notify/Map-Notify-Ack)[¶](#section-5.7-5.2){.pilcrow}
:   

The Map-Notify message has the same contents as a Map-Register message.
See \"[Map-Register Message Format](#MAPREG){.internal .xref}\"
([Section 5.6](#MAPREG){.auto .internal .xref}) for field descriptions
and \"[Map-Reply Message Format](#MR-FORMAT){.internal .xref}\"
([Section 5.4](#MR-FORMAT){.auto .internal .xref}) for EID-Record and
RLOC-Record descriptions.[¶](#section-5.7-6){.pilcrow}

The fields of the Map-Notify are copied from the corresponding
Map-Register to acknowledge its correct processing. In the Map-Notify,
the \'Authentication Data\' field is recomputed using the corresponding
per-message key and according to the procedure defined in the previous
section. The Map-Notify message can also be used in an unsolicited
manner. This topic is out of scope for this document. See
\[[LISP-PUBSUB](#I-D.ietf-lisp-pubsub){.cite .xref}\] for
details.[¶](#section-5.7-7){.pilcrow}

After sending a Map-Register, if a Map-Notify is not received after 1
second, the transmitter [MUST]{.bcp14} retransmit the original
Map-Register with an exponential backoff (base of 2, that is, the next
backoff timeout interval is doubled); the maximum backoff is 1 minute.
Map-Notify messages are only transmitted upon the reception of a
Map-Register with the M-bit set; Map-Notify messages are not
retransmitted. The only exception to this is for unsolicited Map-Notify
messages; see below.[¶](#section-5.7-8){.pilcrow}

A Map-Server sends an unsolicited Map-Notify message (one that is not
used as an acknowledgment to a Map-Register message) only in conformance
with
Section [3.1](https://www.rfc-editor.org/rfc/rfc8085#section-3.1){.relref}
([\"Congestion Control
Guidelines\"](https://www.rfc-editor.org/rfc/rfc8085#section-3.1){.relref})
of \[[RFC8085](#RFC8085){.cite .xref}\] and
Section [3.3](https://www.rfc-editor.org/rfc/rfc8085#section-3.3){.relref}
([\"Reliability
Guidelines\"](https://www.rfc-editor.org/rfc/rfc8085#section-3.3){.relref})
of \[[RFC8085](#RFC8085){.cite .xref}\]. A Map-Notify is retransmitted
until a Map-Notify-Ack is received by the Map-Server with the same nonce
used in the Map-Notify message. An implementation [SHOULD]{.bcp14}
retransmit up to 3 times at 3-second retransmission intervals, after
which time the retransmission interval is exponentially backed off (base
of 2, that is, the next backoff timeout interval is doubled) for another
3 retransmission attempts. Map-Notify-Ack messages are only transmitted
upon the reception of an unsolicited Map-Notify; Map-Notify-Ack messages
are not retransmitted.[¶](#section-5.7-9){.pilcrow}

The Map-Notify-Ack message has the same contents as a Map-Notify
message. It is used to acknowledge the receipt of an unsolicited
Map-Notify and, once the Authentication Data is validated, allows the
sender to stop retransmitting a Map-Notify with the same nonce and
(validated) Authentication Data. The fields of the Map-Notify-Ack are
copied from the corresponding Map-Notify message to acknowledge its
correct processing. The \'Authentication Data\' field is recomputed
using the corresponding per-message key and according to the procedure
defined in the previous section.[¶](#section-5.7-10){.pilcrow}

Upon reception of a Map-Register, Map-Notify, or Map-Notify-Ack, the
receiver verifies the Authentication Data. If the Authentication Data
fails to validate, the message is dropped without further
processing.[¶](#section-5.7-11){.pilcrow}
:::
:::

::: {#encap-mr}
::: {#section-5.8 .section}
### [5.8.](#section-5.8){.section-number .selfRef} [Encapsulated Control Message Format](#name-encapsulated-control-messag){.section-name .selfRef} {#name-encapsulated-control-messag}

An Encapsulated Control Message (ECM) is used to encapsulate control
packets sent between xTRs and the mapping database system or internal to
the mapping database system.[¶](#section-5.8-1){.pilcrow}

::: {#section-5.8-2 .alignLeft .art-text .artwork}
          0                   1                   2                   3
          0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       / |                       IPv4 or IPv6 Header                     |
     OH  |                      (uses RLOC addresses)                    |
       \ |                                                               |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       / |       Source Port = xxxx      |       Dest Port = 4342        |
     UDP +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       \ |           UDP Length          |        UDP Checksum           |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    LISP |Type=8 |S|D|R|R|            Reserved                           |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       / |                       IPv4 or IPv6 Header                     |
     IH  |                  (uses RLOC or EID addresses)                 |
       \ |                                                               |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       / |       Source Port = xxxx      |       Dest Port = yyyy        |
     UDP +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       \ |           UDP Length          |        UDP Checksum           |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     LCM |                      LISP Control Message                     |
         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-5.8-2){.pilcrow}
:::

Packet header descriptions:[¶](#section-5.8-3){.pilcrow}

[]{.break}

OH:
:   This is the outer IPv4 or IPv6 header, which uses RLOC addresses in
    the source and destination header address
    fields.[¶](#section-5.8-4.2){.pilcrow}
:   

UDP:
:   This is the outer UDP header with destination port 4342. The source
    port is randomly allocated. The checksum field [MUST]{.bcp14} be
    non-zero.[¶](#section-5.8-4.4){.pilcrow}
:   

LISP:
:   Type 8 is defined to be a \"LISP Encapsulated Control Message\", and
    what follows is either an IPv4 or IPv6 header, as encoded by the
    first 4 bits after the \'Reserved\' field, or the \'Authentication
    Data\' field \[[RFC9303](#RFC9303){.cite .xref}\] if the S-bit (see
    below) is set.[¶](#section-5.8-4.6){.pilcrow}
:   

Type:
:   8 (Encapsulated Control Message
    (ECM))[¶](#section-5.8-4.8){.pilcrow}
:   

S:
:   This is the Security bit. When set to 1, the field following the
    \'Reserved\' field will have the following Authentication Data
    format and follow the procedures from \[[RFC9303](#RFC9303){.cite
    .xref}\].[¶](#section-5.8-4.10){.pilcrow}
:   

::: {#section-5.8-5 .alignLeft .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    AD Type    |       Authentication Data Content . . .       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-5.8-5){.pilcrow}
:::

[]{.break}

D:
:   This is the DDT-bit. When set to 1, the sender is requesting a
    Map-Referral message to be returned. Details regarding this
    procedure are described in \[[RFC8111](#RFC8111){.cite
    .xref}\].[¶](#section-5.8-6.2){.pilcrow}
:   

R:
:   This reserved and unassigned bit [MUST]{.bcp14} be set to 0 on
    transmit and [MUST]{.bcp14} be ignored on
    receipt.[¶](#section-5.8-6.4){.pilcrow}
:   

[]{.break}

IH:
:   This is the inner IPv4 or IPv6 header, which can use either RLOC or
    EID addresses in the header address fields. When a Map-Request is
    encapsulated in this packet format, the destination address in this
    header is an EID.[¶](#section-5.8-7.2){.pilcrow}
:   

UDP:
:   This is the inner UDP header, where the port assignments depend on
    the control packet being encapsulated. When the control packet is a
    Map-Request or Map-Register, the source port is selected by the
    ITR/PITR and the destination port is 4342. When the control packet
    is a Map-Reply, the source port is 4342 and the destination port is
    assigned from the source port of the invoking Map-Request. Port
    number 4341 [MUST NOT]{.bcp14} be assigned to either port. The
    checksum field [MUST]{.bcp14} be
    non-zero.[¶](#section-5.8-7.4){.pilcrow}
:   

LCM:
:   The format is one of the control message formats described in
    [Section 5](#lispcp){.auto .internal .xref}. Map-Request messages
    are allowed to be control plane (ECM) encapsulated. When
    Map-Requests are sent for RLOC-Probing purposes (i.e., the probe-bit
    is set), they [MUST NOT]{.bcp14} be sent inside Encapsulated Control
    Messages. PIM Join/Prune messages \[[RFC6831](#RFC6831){.cite
    .xref}\] are also allowed to be control plane (ECM)
    encapsulated.[¶](#section-5.8-7.6){.pilcrow}
:   
:::
:::
:::
:::

::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Changing the Contents of EID-to-RLOC Mappings](#name-changing-the-contents-of-ei){.section-name .selfRef} {#name-changing-the-contents-of-ei}

In the LISP architecture, ITRs/PITRs use a local Map-Cache to store
EID-to-RLOC mappings for forwarding. When an ETR updates a mapping, a
mechanism is required to inform ITRs/PITRs that are using such
mappings.[¶](#section-6-1){.pilcrow}

The LISP data plane defines several mechanisms to update mappings
\[[RFC9300](#RFC9300){.cite .xref}\]. This document specifies the
Solicit-Map-Request (SMR), a control plane push-based mechanism. An
additional control plane mechanism based on the Publish/Subscribe
paradigm is specified in \[[LISP-PUBSUB](#I-D.ietf-lisp-pubsub){.cite
.xref}\].[¶](#section-6-2){.pilcrow}

::: {#SMR}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [Solicit-Map-Request (SMR)](#name-solicit-map-request-smr){.section-name .selfRef} {#name-solicit-map-request-smr}

Soliciting a Map-Request is a selective way for ETRs, at the site where
mappings change, to control the rate they receive requests for Map-Reply
messages. SMRs are also used to tell remote ITRs to update the mappings
they have cached.[¶](#section-6.1-1){.pilcrow}

Since ETRs are not required to keep track of remote ITRs that have
cached their mappings, they do not know which ITRs need to have their
mappings updated. As a result, an ETR will solicit Map-Requests to those
sites to which it has been sending LISP encapsulated data packets for
the last minute, and when an ETR is also acting as an ITR, it will send
an SMR to an ITR to which it has recently sent encapsulated
data.[¶](#section-6.1-2){.pilcrow}

An SMR message is simply a bit set in a Map-Request message. An ITR or
PITR will send a Map-Request (SMR-invoked Map-Request) when it receives
an SMR message. While the SMR message is sent through the data plane,
the SMR-invoked Map-Request [MUST]{.bcp14} be sent through the Mapping
System (not directly).[¶](#section-6.1-3){.pilcrow}

Both the SMR sender and the SMR responder [MUST]{.bcp14} rate limit
these messages. It is [RECOMMENDED]{.bcp14} that the SMR sender rate
limit a Map-Request for the same destination RLOC to no more than one
packet every 3 seconds. It is [RECOMMENDED]{.bcp14} that the SMR
responder rate limit a Map-Request for the same EID-Prefix to no more
than once every 3 seconds.[¶](#section-6.1-4){.pilcrow}

When an ITR receives an SMR message for which it does not have a cached
mapping for the EID in the SMR message, it [SHOULD NOT]{.bcp14} send an
SMR-invoked Map-Request. This scenario can occur when an ETR sends SMR
messages to all Locators in the Locator-Set it has stored in its
Map-Cache but the remote ITRs that receive the SMR may not be sending
packets to the site. There is no point in updating the ITRs until they
need to send, in which case they will send Map-Requests to obtain a
Map-Cache entry.[¶](#section-6.1-5){.pilcrow}
:::
:::
:::

::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Routing Locator Reachability](#name-routing-locator-reachabilit){.section-name .selfRef} {#name-routing-locator-reachabilit}

This document defines several control plane mechanisms for determining
RLOC reachability. Please note that additional data plane reachability
mechanisms are defined in \[[RFC9300](#RFC9300){.cite
.xref}\].[¶](#section-7-1){.pilcrow}

1.  [An ITR may receive an ICMP Network Unreachable or Host Unreachable
    message for an RLOC it is using. This indicates that the RLOC is
    likely down. Note that trusting ICMP messages may not be desirable,
    but neither is ignoring them completely. Implementations are
    encouraged to follow current best practices in treating these
    conditions
    \[[OPSEC-ICMP-FILTER](#I-D.ietf-opsec-icmp-filtering){.cite
    .xref}\].[¶](#section-7-2.1){.pilcrow}]{#section-7-2.1}
2.  [When an ITR participates in the routing protocol that operates in
    the underlay routing system, it can determine that an RLOC is down
    when no Routing Information Base (RIB) entry exists that matches the
    RLOC IP address.[¶](#section-7-2.2){.pilcrow}]{#section-7-2.2}
3.  [An ITR may receive an ICMP Port Unreachable message from a
    destination host. This occurs if an ITR attempts to use interworking
    \[[RFC6832](#RFC6832){.cite .xref}\] and LISP-encapsulated data is
    sent to a non-LISP-capable
    site.[¶](#section-7-2.3){.pilcrow}]{#section-7-2.3}
4.  [An ITR may receive a Map-Reply from an ETR in response to a
    previously sent Map-Request. The RLOC source of the Map-Reply is
    likely up, since the ETR was able to send the Map-Reply to the ITR.
    Please note that in some scenarios the RLOC \-- from the outer
    header \-- can be a spoofable
    field.[¶](#section-7-2.4){.pilcrow}]{#section-7-2.4}
5.  [An ITR/ETR pair can use the \'RLOC-Probing\' mechanism described
    below.[¶](#section-7-2.5){.pilcrow}]{#section-7-2.5}

When ITRs receive ICMP Network Unreachable or Host Unreachable messages
as a method to determine unreachability, they will refrain from using
Locators that are described in Locator lists of Map-Replies. However,
using this approach is unreliable because many network operators turn
off generation of ICMP Destination Unreachable
messages.[¶](#section-7-3){.pilcrow}

If an ITR does receive an ICMP Network Unreachable or Host Unreachable
message, it [MAY]{.bcp14} originate its own ICMP Destination Unreachable
message destined for the host that originated the data packet the ITR
encapsulated.[¶](#section-7-4){.pilcrow}

This assumption does create a dependency: Locator unreachability is
detected by the receipt of ICMP Host Unreachable messages. When a
Locator has been determined to be unreachable, it is not used for active
traffic; this is the same as if it were listed in a Map-Reply with
Priority 255.[¶](#section-7-5){.pilcrow}

The ITR can test the reachability of the unreachable Locator by sending
periodic Map-Requests. Both Map-Requests and Map-Replies [MUST]{.bcp14}
be rate limited; see Sections [5.3](#MAPREQ){.auto .internal .xref} and
[5.4](#MR-FORMAT){.auto .internal .xref} for information about rate
limiting. Locator reachability testing is never done with data packets,
since that increases the risk of packet loss for end-to-end
sessions.[¶](#section-7-6){.pilcrow}

::: {#rloc-probe}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [RLOC-Probing Algorithm](#name-rloc-probing-algorithm){.section-name .selfRef} {#name-rloc-probing-algorithm}

RLOC-Probing is a method that an ITR or PITR can use to determine the
reachability status of one or more Locators that it has cached in a
Map-Cache entry. The probe-bit of the Map-Request and Map-Reply messages
is used for RLOC-Probing.[¶](#section-7.1-1){.pilcrow}

RLOC-Probing is done in the control plane on a timer basis, where an ITR
or PITR will originate a Map-Request destined to a Routing Locator
Address from one of its own Routing Locator Addresses. A Map-Request
used as an RLOC-Probe is NOT encapsulated and NOT sent to a Map-Server
or to the mapping database system as one would when requesting mapping
data. The EID-Record encoded in the Map-Request is the EID-Prefix of the
Map-Cache entry cached by the ITR or PITR. The ITR [MAY]{.bcp14} include
a mapping data record for its own database mapping information that
contains the local EID-Prefixes and RLOCs for its site. RLOC-Probes are
sent periodically using a jittered timer
interval.[¶](#section-7.1-2){.pilcrow}

When an ETR receives a Map-Request message with the probe-bit set, it
returns a Map-Reply with the probe-bit set. The source address of the
Map-Reply is set to the IP address of the outgoing interface the
Map-Reply destination address routes to. The Map-Reply [SHOULD]{.bcp14}
contain mapping data for the EID-Prefix contained in the Map-Request.
This provides the opportunity for the ITR or PITR that sent the
RLOC-Probe to get mapping updates if there were changes to the ETR\'s
database mapping entries.[¶](#section-7.1-3){.pilcrow}

There are advantages and disadvantages of RLOC-Probing. The main benefit
of RLOC-Probing is that it can handle many failure scenarios, allowing
the ITR to determine when the path to a specific Locator is reachable or
has become unreachable, thus providing a robust mechanism for switching
to using another Locator from the cached Locator. RLOC-Probing can also
provide rough Round-Trip Time (RTT) estimates between a pair of
Locators, which can be useful for network management purposes as well as
for selecting low-delay paths. The major disadvantage of RLOC-Probing is
in the number of control messages required and the amount of bandwidth
used to obtain those benefits, especially if the requirement for failure
detection times is very small.[¶](#section-7.1-4){.pilcrow}
:::
:::
:::

::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Interactions with Other LISP Components](#name-interactions-with-other-lis){.section-name .selfRef} {#name-interactions-with-other-lis}

::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [ITR EID-to-RLOC Mapping Resolution](#name-itr-eid-to-rloc-mapping-res){.section-name .selfRef} {#name-itr-eid-to-rloc-mapping-res}

An ITR is configured with one or more Map-Resolver addresses. These
addresses are \"Locators\" (or RLOCs) and [MUST]{.bcp14} be routable on
the underlying core network; they [MUST NOT]{.bcp14} need to be resolved
through LISP EID-to-RLOC mapping, as that would introduce a circular
dependency. When using a Map-Resolver, an ITR does not need to connect
to any other database Mapping System.[¶](#section-8.1-1){.pilcrow}

An ITR sends an Encapsulated Map-Request to a configured Map-Resolver
when it needs an EID-to-RLOC mapping that is not found in its local
Map-Cache. Using the Map-Resolver greatly reduces both the complexity of
the ITR implementation and the costs associated with its
operation.[¶](#section-8.1-2){.pilcrow}

In response to an Encapsulated Map-Request, the ITR can expect one of
the following:[¶](#section-8.1-3){.pilcrow}

-   [An immediate Negative Map-Reply (with action code
    \"Natively-Forward\" and a 15-minute TTL) from the Map-Resolver if
    the Map-Resolver can determine that the requested EID does not
    exist. The ITR saves the EID-Prefix returned in the Map-Reply in its
    cache, marks it as non-LISP-capable, and knows not to attempt LISP
    encapsulation for destinations matching
    it.[¶](#section-8.1-4.1){.pilcrow}]{#section-8.1-4.1}
-   [A Negative Map-Reply (with action code \"Natively-Forward\") from a
    Map-Server that is authoritative (within the LISP deployment
    ([Section 1.1](#soa){.auto .internal .xref})) for an EID-Prefix that
    matches the requested EID but that does not have an actively
    registered, more-specific EID-Prefix. In this case, the requested
    EID is said to match a \"hole\" in the authoritative EID-Prefix. If
    the requested EID matches a more-specific EID-Prefix that has been
    delegated by the Map-Server but for which no ETRs are currently
    registered, a 1-minute TTL is returned. If the requested EID matches
    a non-delegated part of the authoritative EID-Prefix, then it is not
    a LISP EID and a 15-minute TTL is returned. See [Section
    8.2](#reg){.auto .internal .xref} for a discussion of aggregate
    EID-Prefixes and details regarding Map-Server EID-Prefix
    matching.[¶](#section-8.1-4.2){.pilcrow}]{#section-8.1-4.2}
-   [A LISP Map-Reply from the ETR that owns the EID-to-RLOC mapping or
    possibly from a Map-Server answering on behalf of the ETR. See
    [Section 8.4](#mr-processing){.auto .internal .xref} for more
    details on Map-Resolver message
    processing.[¶](#section-8.1-4.3){.pilcrow}]{#section-8.1-4.3}

Note that an ITR may be configured to both use a Map-Resolver and
participate in a LISP-ALT logical network. In such a situation, the ITR
[SHOULD]{.bcp14} send Map-Requests through the ALT network for any
EID-Prefix learned via ALT BGP. Such a configuration is expected to be
very rare, since there is little benefit to using a Map-Resolver if an
ITR is already using LISP-ALT. There would be, for example, no need for
such an ITR to send a Map-Request to a possibly non-existent EID (and
rely on Negative Map-Replies) if it can consult the ALT database to
verify that an EID-Prefix is present before sending that
Map-Request.[¶](#section-8.1-5){.pilcrow}
:::

::: {#reg}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [EID-Prefix Configuration and ETR Registration](#name-eid-prefix-configuration-an){.section-name .selfRef} {#name-eid-prefix-configuration-an}

An ETR publishes its EID-Prefixes on a Map-Server by sending LISP
Map-Register messages. A Map-Register message includes Authentication
Data, so prior to sending a Map-Register message, the ETR and Map-Server
[MUST]{.bcp14} be configured with a pre-shared secret used to derive
Map-Register authentication keys. A Map-Server\'s configuration
[SHOULD]{.bcp14} also include a list of the EID-Prefixes for which each
ETR is authoritative. Upon receipt of a Map-Register from an ETR, a
Map-Server accepts only EID-Prefixes that are configured for that ETR.
Failure to implement such a check would leave the Mapping System
vulnerable to trivial EID-Prefix hijacking
attacks.[¶](#section-8.2-1){.pilcrow}

In addition to the set of EID-Prefixes defined for each ETR that may
register, a Map-Server is typically also configured with one or more
aggregate prefixes that define the part of the EID numbering space
assigned to it. When LISP-ALT is the database in use, aggregate
EID-Prefixes are implemented as discard routes and advertised into ALT
BGP. The existence of aggregate EID-Prefixes in a Map-Server\'s database
means that it may receive Map-Requests for EID-Prefixes that match an
aggregate but do not match a registered prefix; [Section
8.3](#ms-processing){.auto .internal .xref} describes how this is
handled.[¶](#section-8.2-2){.pilcrow}

Map-Register messages are sent periodically from an ETR to a Map-Server
with a suggested interval between messages of one minute. A Map-Server
[SHOULD]{.bcp14} time out and remove an ETR\'s registration if it has
not received a valid Map-Register message within the past three minutes.
When first contacting a Map-Server after restart or changes to its
EID-to-RLOC database mappings, an ETR [MAY]{.bcp14} initially send
Map-Register messages at an increased frequency, up to one every 20
seconds. This \"quick registration\" period is limited to five minutes
in duration.[¶](#section-8.2-3){.pilcrow}

An ETR [MAY]{.bcp14} request that a Map-Server explicitly acknowledge
receipt and processing of a Map-Register message by setting the
\"want-map-notify\" (M-bit) flag. A Map-Server that receives a
Map-Register with this flag set will respond with a Map-Notify message.
Typical use of this flag by an ETR would be to set it for Map-Register
messages sent during the initial \"quick registration\" with a
Map-Server but then set it only occasionally during steady-state
maintenance of its association with that Map-Server. Note that the
Map-Notify message is sent to UDP destination port 4342, not to the
source port specified in the original Map-Register
message.[¶](#section-8.2-4){.pilcrow}

Note that a one-minute minimum registration interval during maintenance
of an ETR-Map-Server association places a lower bound on how quickly and
how frequently a mapping database entry can be updated. This may have
implications for what sorts of mobility can be supported directly by the
Mapping System; shorter registration intervals or other mechanisms might
be needed to support faster mobility in some cases. For a discussion on
one way that faster mobility may be implemented for individual devices,
please see \[[LISP-MN](#I-D.ietf-lisp-mn){.cite
.xref}\].[¶](#section-8.2-5){.pilcrow}

An ETR [MAY]{.bcp14} also request, by setting the \"proxy Map-Reply\"
flag (P-bit) in the Map-Register message, that a Map-Server answer
Map-Requests instead of forwarding them to the ETR. See [Section
7.1](#rloc-probe){.auto .internal .xref} for details on how the
Map-Server sets certain flags (such as those indicating whether the
message is authoritative and how returned Locators [SHOULD]{.bcp14} be
treated) when sending a Map-Reply on behalf of an ETR. When an ETR
requests proxy reply service, it [SHOULD]{.bcp14} include all RLOCs for
all ETRs for the EID-Prefix being registered, along with the routable
flag (\"R-bit\") setting for each RLOC. The Map-Server includes all of
this information in Map-Reply messages that it sends on behalf of the
ETR. This differs from a non-proxy registration, since the latter need
only provide one or more RLOCs for a Map-Server to use for forwarding
Map-Requests; the registration information is not used in Map-Replies,
so it being incomplete is not incorrect.[¶](#section-8.2-6){.pilcrow}

An ETR that uses a Map-Server to publish its EID-to-RLOC mappings does
not need to participate further in the mapping database protocol(s).
When using a LISP-ALT mapping database, for example, this means that the
ETR does not need to implement GRE or BGP, which greatly simplifies its
configuration and reduces its cost of
operation.[¶](#section-8.2-7){.pilcrow}

Note that use of a Map-Server does not preclude an ETR from also
connecting to the mapping database (i.e., it could also connect to the
LISP-ALT network), but doing so doesn\'t seem particularly useful, as
the whole purpose of using a Map-Server is to avoid the complexity of
the mapping database protocols.[¶](#section-8.2-8){.pilcrow}
:::
:::

::: {#ms-processing}
::: {#section-8.3 .section}
### [8.3.](#section-8.3){.section-number .selfRef} [Map-Server Processing](#name-map-server-processing){.section-name .selfRef} {#name-map-server-processing}

Once a Map-Server has EID-Prefixes registered by its client ETRs, it can
accept and process Map-Requests for them.[¶](#section-8.3-1){.pilcrow}

In response to a Map-Request, the Map-Server first checks to see if the
destination EID matches a configured EID-Prefix. If there is no match,
the Map-Server returns a Negative Map-Reply with action code
\"Natively-Forward\" and a 15-minute TTL. This can occur if a
Map-Request is received for a configured aggregate EID-Prefix for which
no more-specific EID-Prefix exists; it indicates the presence of a
non-LISP \"hole\" in the aggregate
EID-Prefix.[¶](#section-8.3-2){.pilcrow}

Next, the Map-Server checks to see if any ETRs have registered the
matching EID-Prefix. If none are found, then the Map-Server returns a
Negative Map-Reply with action code \"Natively-Forward\" and a 1-minute
TTL.[¶](#section-8.3-3){.pilcrow}

If the EID-Prefix is either registered or not registered to the Mapping
System and there is a policy in the Map-Server to have the requester
drop packets for the matching EID-Prefix, then a Drop/Policy-Denied
action is returned. If the EID-Prefix is registered or not registered
and there is an authentication failure, then a Drop/Auth-Failure action
is returned. If either of these actions results as a temporary state in
policy or authentication, then a Send-Map-Request action with a 1-minute
TTL [MAY]{.bcp14} be returned to allow the requester to retry the
Map-Request.[¶](#section-8.3-4){.pilcrow}

If any of the registered ETRs for the EID-Prefix have requested proxy
reply service, then the Map-Server answers the request instead of
forwarding it. It returns a Map-Reply with the EID-Prefix, RLOCs, and
other information learned through the registration
process.[¶](#section-8.3-5){.pilcrow}

If none of the ETRs have requested proxy reply service, then the
Map-Server re-encapsulates and forwards the resulting Encapsulated
Map-Request to one of the registered ETRs. It does not otherwise alter
the Map-Request, so any Map-Reply sent by the ETR is returned to the
RLOC in the Map-Request, not to the Map-Server. Unless also acting as a
Map-Resolver, a Map-Server should never receive Map-Replies; any such
messages [SHOULD]{.bcp14} be discarded without response, perhaps
accompanied by the logging of a diagnostic message if the rate of
Map-Replies is suggestive of malicious
traffic.[¶](#section-8.3-6){.pilcrow}
:::
:::

::: {#mr-processing}
::: {#section-8.4 .section}
### [8.4.](#section-8.4){.section-number .selfRef} [Map-Resolver Processing](#name-map-resolver-processing){.section-name .selfRef} {#name-map-resolver-processing}

Upon receipt of an Encapsulated Map-Request, a Map-Resolver decapsulates
the enclosed message and then searches for the requested EID in its
local database of mapping entries (statically configured or learned from
associated ETRs if the Map-Resolver is also a Map-Server offering proxy
reply service). If it finds a matching entry, it returns a LISP
Map-Reply with the known mapping.[¶](#section-8.4-1){.pilcrow}

If the Map-Resolver does not have the mapping entry and if it can
determine that the EID is not in the mapping database (for example, if
LISP-ALT is used, the Map-Resolver will have an ALT forwarding table
that covers the full EID space), it immediately returns a Negative
Map-Reply with action code \"Natively-Forward\" and a 15‑minute TTL. To
minimize the number of negative cache entries needed by an ITR, the
Map-Resolver [SHOULD]{.bcp14} return the least-specific prefix that both
matches the original query and does not match any EID-Prefix known to
exist in the LISP-capable infrastructure.[¶](#section-8.4-2){.pilcrow}

If the Map-Resolver does not have sufficient information to know whether
the EID exists, it needs to forward the Map-Request to another device
that has more information about the EID being requested. To do this, it
forwards the unencapsulated Map-Request, with the original ITR RLOC as
the source, to the mapping database system. Using LISP-ALT, the
Map-Resolver is connected to the ALT network and sends the Map-Request
to the next ALT hop learned from its ALT BGP neighbors. The Map-Resolver
does not send any response to the ITR; since the source RLOC is that of
the ITR, the ETR or Map-Server that receives the Map-Request over the
ALT and responds will do so directly to the
ITR.[¶](#section-8.4-3){.pilcrow}

::: {#section-8.4.1 .section}
#### [8.4.1.](#section-8.4.1){.section-number .selfRef} [Anycast Operation](#name-anycast-operation){.section-name .selfRef} {#name-anycast-operation}

A Map-Resolver can be set up to use \"anycast\", where the same address
is assigned to multiple Map-Resolvers and is propagated through IGP
routing, to facilitate the use of a topologically close Map-Resolver by
each ITR.[¶](#section-8.4.1-1){.pilcrow}

ETRs [MAY]{.bcp14} have anycast RLOC addresses that are registered as
part of their RLOC-Set to the Mapping System. However, registrations
[MUST]{.bcp14} use their unique RLOC addresses, distinct authentication
keys, or different xTR-IDs to identify security associations with the
Map-Servers.[¶](#section-8.4.1-2){.pilcrow}
:::
:::
:::
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

A LISP threat analysis can be found in \[[RFC7835](#RFC7835){.cite
.xref}\]. Here, we highlight security considerations that apply when
LISP is deployed in environments such as those specified in [Section
1.1](#soa){.auto .internal .xref}, where the following assumptions
hold:[¶](#section-9-1){.pilcrow}

1.  [The Mapping System is secure and trusted, and for the purpose of
    these security considerations, the Mapping System is considered as
    one trusted element.[¶](#section-9-2.1){.pilcrow}]{#section-9-2.1}
2.  [The ETRs have a preconfigured trust relationship with the Mapping
    System, including some form of shared secret. The Mapping System is
    aware of which EIDs an ETR can advertise. How those keys and
    mappings are established is out of scope for this
    document.[¶](#section-9-2.2){.pilcrow}]{#section-9-2.2}
3.  [LISP-SEC \[[RFC9303](#RFC9303){.cite .xref}\] [MUST]{.bcp14} be
    implemented. Network operators should carefully weigh how the
    LISP-SEC threat model applies to their particular use case or
    deployment. If they decide to ignore a particular recommendation,
    they should make sure the risk associated with the corresponding
    threats is well
    understood.[¶](#section-9-2.3){.pilcrow}]{#section-9-2.3}

The Map-Request/Map-Reply message exchange can be exploited by an
attacker to mount DoS and/or amplification attacks. Attackers can send
Map-Requests at high rates to overload LISP nodes and increase the state
maintained by such nodes or consume CPU cycles. Such threats can be
mitigated by systematically applying filters and rate
limiters.[¶](#section-9-3){.pilcrow}

The Map-Request/Map-Reply message exchange can also be exploited to
inject forged mappings directly into the ITR EID-to-RLOC Map-Cache. This
can lead to traffic being redirected to the attacker; see further
details in \[[RFC7835](#RFC7835){.cite .xref}\]. In addition, valid ETRs
in the system can perform overclaiming attacks. In this case, attackers
can claim to own an EID-Prefix that is larger than the prefix owned by
the ETR. Such attacks can be addressed by using LISP-SEC
\[[RFC9303](#RFC9303){.cite .xref}\]. The LISP-SEC protocol defines a
mechanism for providing origin authentication, integrity protection, and
prevention of \'man-in-the-middle\' and \'prefix overclaiming\' attacks
on the Map-Request/Map-Reply exchange. In addition, and while beyond the
scope of securing an individual Map-Server or Map-Resolver, it should be
noted that LISP-SEC can be complemented by additional security
mechanisms defined by the Mapping System infrastructure. For instance,
BGP-based LISP-ALT \[[RFC6836](#RFC6836){.cite .xref}\] can take
advantage of standards work on adding security to BGP, while LISP-DDT
\[[RFC8111](#RFC8111){.cite .xref}\] defines its own additional security
mechanisms.[¶](#section-9-4){.pilcrow}

To publish an authoritative EID-to-RLOC mapping with a Map-Server using
the Map-Register message, an ETR includes Authentication Data that is a
MAC of the entire message using a key derived from the pre-shared
secret. An implementation [SHOULD]{.bcp14} support
HMAC-SHA256-128+HKDF-SHA256 \[[RFC5869](#RFC5869){.cite .xref}\]. The
Map-Register message includes protection against replay attacks by a man
in the middle. However, there is a potential attack where a compromised
ETR could overclaim the prefix it owns and successfully register it on
its corresponding Map-Server. To mitigate this, as noted in [Section
8.2](#reg){.auto .internal .xref}, a Map-Server [MUST]{.bcp14} verify
that all EID-Prefixes registered by an ETR match the configuration
stored on the Map-Server.[¶](#section-9-5){.pilcrow}

Deployments concerned about manipulations of Map-Request and Map-Reply
messages and malicious ETR EID-Prefix overclaiming [MUST]{.bcp14} drop
LISP control plane messages that do not contain LISP-SEC material
(S-bit, EID-AD, OTK-AD, PKT-AD). See [Section
3](https://www.rfc-editor.org/rfc/rfc9303#section-3){.relref} of
\[[RFC9303](#RFC9303){.cite .xref}\] for definitions of \"EID-AD\",
\"OTK-AD\", and \"PKT-AD\".[¶](#section-9-6){.pilcrow}

Mechanisms to encrypt, support privacy, and prevent eavesdropping and
packet tampering for messages exchanged between xTRs, between xTRs and
the Mapping System, and between nodes that make up the Mapping System
[SHOULD]{.bcp14} be deployed. Examples of this are DTLS
\[[RFC9147](#RFC9147){.cite .xref}\] or \"lisp-crypto\"
\[[RFC8061](#RFC8061){.cite .xref}\].[¶](#section-9-7){.pilcrow}
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [Privacy Considerations](#name-privacy-considerations){.section-name .selfRef} {#name-privacy-considerations}

As noted by \[[RFC6973](#RFC6973){.cite .xref}\], privacy is a complex
issue that greatly depends on the specific protocol use case and
deployment. As noted in [Section
1.1](https://www.rfc-editor.org/rfc/rfc9300#section-1.1){.relref} of
\[[RFC9300](#RFC9300){.cite .xref}\], LISP focuses on use cases where
entities communicate over the public Internet while keeping separate
addressing and topology. Here, we detail the privacy threats introduced
by the LISP control plane; the analysis is based on the guidelines
detailed in \[[RFC6973](#RFC6973){.cite
.xref}\].[¶](#section-10-1){.pilcrow}

LISP can use long-lived identifiers (EIDs) that survive mobility events.
Such identifiers bind to the RLOCs of the nodes. The RLOCs represent the
topological location with respect to the specific LISP deployments. In
addition, EID-to-RLOC mappings are typically considered public
information within the LISP deployment when control plane messages are
not encrypted and can be eavesdropped while Map-Request messages are
sent to the corresponding Map-Resolvers or Map-Register messages to
Map-Servers.[¶](#section-10-2){.pilcrow}

In this context, attackers can correlate the EID with the RLOC and track
the corresponding user topological location and/or mobility. This can be
achieved by off-path attackers, if they are authenticated, by querying
the Mapping System. Deployments concerned about this threat can use
access control lists or stronger authentication mechanisms
\[[ECDSA-AUTH](#I-D.ietf-lisp-ecdsa-auth){.cite .xref}\] in the Mapping
System to make sure that only authorized users can access this
information (data minimization). Use of ephemeral EIDs
\[[EID-ANONYMITY](#I-D.ietf-lisp-eid-anonymity){.cite .xref}\] to
achieve anonymity is another mechanism to lessen persistency and
identity tracking.[¶](#section-10-3){.pilcrow}
:::

::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [Changes Related to RFCs 6830 and 6833](#name-changes-related-to-rfcs-683){.section-name .selfRef} {#name-changes-related-to-rfcs-683}

For implementation considerations, the following major changes have been
made to this document since \[[RFC6830](#RFC6830){.cite .xref}\] and
\[[RFC6833](#RFC6833){.cite .xref}\] were
published:[¶](#section-11-1){.pilcrow}

-   [The 16-bit \'Key ID\' field of the Map-Register and Map-Notify
    messages as defined in \[[RFC6830](#RFC6830){.cite .xref}\] has been
    split into an 8-bit \'Key ID\' field and an 8-bit \'Algorithm ID\'
    field. Note that this change also applies to the Map-Notify-Ack
    message defined by this document. See Sections [5.6](#MAPREG){.auto
    .internal .xref} and [5.7](#MAP-NOTIF-MAP-NOTIF-ACK){.auto .internal
    .xref}.[¶](#section-11-2.1){.pilcrow}]{#section-11-2.1}
-   [This document defines a Map-Notify-Ack message to provide
    reliability for Map-Notify messages. Any receiver of a Map-Notify
    message must respond with a Map-Notify-Ack message. Map-Servers who
    are senders of Map-Notify messages must queue the Map-Notify
    contents until they receive a Map-Notify-Ack with the nonce used in
    the Map-Notify message. Note that implementations for Map-Notify-Ack
    support already exist and predate this
    document.[¶](#section-11-2.2){.pilcrow}]{#section-11-2.2}
-   [This document has incorporated the codepoint for the Map-Referral
    message from the LISP-DDT specification \[[RFC8111](#RFC8111){.cite
    .xref}\] to indicate that a Map-Server must send the final
    Map-Referral message when it participates in the LISP-DDT Mapping
    System procedures.[¶](#section-11-2.3){.pilcrow}]{#section-11-2.3}
-   [Bits L and D have been added to the Map-Request message. See
    [Section 5.3](#MAPREQ){.auto .internal .xref} for
    details.[¶](#section-11-2.4){.pilcrow}]{#section-11-2.4}
-   [Bits S, I, E, T, a, R, and M have been added to the Map-Register
    message. See [Section 5.6](#MAPREG){.auto .internal .xref} for
    details.[¶](#section-11-2.5){.pilcrow}]{#section-11-2.5}
-   [The nonce and the Authentication Data in the Map-Register message
    each behave differently; see [Section 5.6](#MAPREG){.auto .internal
    .xref} for details.[¶](#section-11-2.6){.pilcrow}]{#section-11-2.6}
-   [This document adds two new action values that are in an EID-Record
    that appears in Map-Reply, Map-Register, Map-Notify, and
    Map-Notify-Ack messages. These new action values are
    Drop/Policy-Denied and Drop/Auth-Failure. See [Section
    5.4](#MR-FORMAT){.auto .internal .xref} for
    details.[¶](#section-11-2.7){.pilcrow}]{#section-11-2.7}
:::

::: {#section-12 .section}
## [12.](#section-12){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This section provides guidance to IANA regarding registration of values
related to this LISP control plane specification, in accordance with
[BCP 26](#RFC8126){.internal .xref} \[[RFC8126](#RFC8126){.cite
.xref}\].[¶](#section-12-1){.pilcrow}

-   [LISP IANA registry allocations should not be made for purposes
    unrelated to LISP routing or transport
    protocols.[¶](#section-12-2.1){.pilcrow}]{#section-12-2.1}
-   [The following policies are used here with the meanings defined in
    [BCP 26](#RFC8126){.internal .xref} \[[RFC8126](#RFC8126){.cite
    .xref}\]: \"Specification Required\", \"IETF Review\",
    \"Experimental Use\", and \"First Come First
    Served\".[¶](#section-12-2.2){.pilcrow}]{#section-12-2.2}

There are three namespaces (listed in the sub-sections below) in LISP
that have been registered (see \[[RFC9299](#RFC9299){.cite
.xref}\].[¶](#section-12-3){.pilcrow}

::: {#section-12.1 .section}
### [12.1.](#section-12.1){.section-number .selfRef} [LISP UDP Port Numbers](#name-lisp-udp-port-numbers){.section-name .selfRef} {#name-lisp-udp-port-numbers}

IANA allocated UDP port number 4342 for the LISP control plane. IANA has
updated the description for UDP port 4342 to reflect the
following:[¶](#section-12.1-1){.pilcrow}

  Service Name   Port Number   Transport Protocol   Description            Reference
  -------------- ------------- -------------------- ---------------------- -----------
  lisp-control   4342          udp                  LISP Control Packets   RFC 9301

  : [Table 2](#table-2){.selfRef}
:::

::: {#section-12.2 .section}
### [12.2.](#section-12.2){.section-number .selfRef} [LISP Packet Type Codes](#name-lisp-packet-type-codes){.section-name .selfRef} {#name-lisp-packet-type-codes}

IANA is now authoritative for LISP Packet Type definitions, so they have
replaced the registry references to \[[RFC6830](#RFC6830){.cite .xref}\]
with references to this document.[¶](#section-12.2-1){.pilcrow}

Based on deployment experience related to \[[RFC6830](#RFC6830){.cite
.xref}\], the Map-Notify-Ack message (message type 5) is defined in this
document. IANA has registered it in the \"LISP Packet Types\"
registry.[¶](#section-12.2-2){.pilcrow}

  Message               Code   Reference
  --------------------- ------ -----------
  LISP Map-Notify-Ack   5      RFC 9301

  : [Table 3](#table-3){.selfRef}
:::

::: {#act-iana}
::: {#section-12.3 .section}
### [12.3.](#section-12.3){.section-number .selfRef} [LISP Map-Reply EID-Record Action Codes](#name-lisp-map-reply-eid-record-a){.section-name .selfRef} {#name-lisp-map-reply-eid-record-a}

New ACT values can be allocated through IETF Review or IESG Approval.
Four values have already been allocated by \[[RFC6830](#RFC6830){.cite
.xref}\]. IANA has replaced the reference pointing to
\[[RFC6830](#RFC6830){.cite .xref}\] to point to this document. This
specification changes the Action name of value 3 from \"Drop\" to
\"Drop/No-Reason\". It also adds the following new ACT
values.[¶](#section-12.3-1){.pilcrow}

[]{#name-lisp-map-reply-action-value}

  Value   Action               Description                                                                                                                                                    Reference
  ------- -------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------- -----------
  4       Drop/Policy-Denied   A packet matching this Map-Cache entry is dropped because the target EID is policy-denied by the xTR or the Mapping System.                                    RFC 9301
  5       Drop/Auth-Failure    A packet matching this Map-Cache entry is dropped because the Map-Request for the target EID fails an authentication check by the xTR or the Mapping System.   RFC 9301

  : [Table 4](#table-4){.selfRef}: [LISP Map-Reply Action
  Values](#name-lisp-map-reply-action-value){.selfRef}

In addition, LISP has a number of flag fields and reserved fields, such
as the flags of the LISP header fields \[[RFC9300](#RFC9300){.cite
.xref}\]. New bits for flags in these fields can be implemented after
IETF Review or IESG Approval, but these need not be managed by
IANA.[¶](#section-12.3-3){.pilcrow}
:::
:::

::: {#IANA}
::: {#section-12.4 .section}
### [12.4.](#section-12.4){.section-number .selfRef} [LISP Address Type Codes](#name-lisp-address-type-codes){.section-name .selfRef} {#name-lisp-address-type-codes}

LISP Canonical Address Format (LCAF) \[[RFC8060](#RFC8060){.cite
.xref}\] has an 8-bit Type field that defines LISP-specific encodings
for AFI value 16387. LCAF encodings are used for specific use cases
where different address types for EID-Records and RLOC-Records are
required.[¶](#section-12.4-1){.pilcrow}

The \"LISP Canonical Address Format (LCAF) Types\" registry is used for
LCAF types. The registry for LCAF types uses the Specification Required
policy \[[RFC8126](#RFC8126){.cite .xref}\]. Initial values for the
registry as well as further information can be found in
\[[RFC8060](#RFC8060){.cite .xref}\].[¶](#section-12.4-2){.pilcrow}

Therefore, there is no longer a need for the \"LISP Address Type Codes\"
registry requested by \[[RFC6830](#RFC6830){.cite .xref}\]. Per this
document, the registry has been closed.[¶](#section-12.4-3){.pilcrow}
:::
:::

::: {#KEYS}
::: {#section-12.5 .section}
### [12.5.](#section-12.5){.section-number .selfRef} [LISP Algorithm ID Numbers](#name-lisp-algorithm-id-numbers){.section-name .selfRef} {#name-lisp-algorithm-id-numbers}

In \[[RFC6830](#RFC6830){.cite .xref}\], a request for a \"LISP Key ID
Numbers\" registry was submitted. Per this document, IANA has renamed
the registry to \"LISP Algorithm ID Numbers\" and listed this document
as the registry reference.[¶](#section-12.5-1){.pilcrow}

The following Algorithm ID values are defined by this specification, as
used in any packet type that references an \'Algorithm ID\'
field:[¶](#section-12.5-2){.pilcrow}

  Name                          Number   MAC                                    KDF
  ----------------------------- -------- -------------------------------------- --------------------------------------
  None                          0        None                                   None
  HMAC-SHA-1-96-None            1        \[[RFC2404](#RFC2404){.cite .xref}\]   None
  HMAC-SHA-256-128-None         2        \[[RFC4868](#RFC4868){.cite .xref}\]   None
  HMAC-SHA256-128+HKDF-SHA256   3        \[[RFC4868](#RFC4868){.cite .xref}\]   \[[RFC4868](#RFC4868){.cite .xref}\]

  : [Table 5](#table-5){.selfRef}

Number values are in the range of 0 to 255. Values are assigned on a
First Come First Served basis.[¶](#section-12.5-4){.pilcrow}
:::
:::

::: {#BITS}
::: {#section-12.6 .section}
### [12.6.](#section-12.6){.section-number .selfRef} [LISP Bit Flags](#name-lisp-bit-flags){.section-name .selfRef} {#name-lisp-bit-flags}

This document asks IANA to create a registry for allocation of bits in
several headers of the LISP control plane, namely in Map-Request
messages, Map-Reply messages, Map-Register messages, and Encapsulated
Control Messages. Bit allocations are also requested for EID-Records and
RLOC-Records. The registry created should be named \"LISP Control Plane
Header Bits\". A subregistry needs to be created per each message and
EID-Record. The name of each subregistry is indicated below, along with
its format and allocation of bits defined in this document. Any
additional bit allocations require a specification, in accordance with
policies defined in \[[RFC8126](#RFC8126){.cite
.xref}\].[¶](#section-12.6-1){.pilcrow}

Subregistry: Map-Request Header Bits ([Section 5.2](#NONCE){.auto
.internal .xref}):[¶](#section-12.6-2){.pilcrow}

::: {#section-12.6-3 .alignLeft .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Type=1 |A|M|P|S|p|s|R|R|  Rsvd   |L|D|   IRC   | Record Count  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-12.6-3){.pilcrow}
:::

[]{#name-lisp-map-request-header-bit}

  Spec Name   IANA Name       Bit Position   Description
  ----------- --------------- -------------- ---------------------------------
  A           Map-Request-A   4              Authoritative Bit
  M           Map-Request-M   5              Map Data Present Bit
  P           Map-Request-P   6              RLOC-Probe Request Bit
  S           Map-Request-S   7              Solicit Map-Request (SMR) Bit
  p           Map-Request-p   8              Proxy-ITR Bit
  s           Map-Request-s   9              Solicit Map-Request Invoked Bit
  L           Map-Request-L   17             Local xTR Bit
  D           Map-Request-D   18             Don\'t Map-Reply Bit

  : [Table 6](#table-6){.selfRef}: [LISP Map-Request Header
  Bits](#name-lisp-map-request-header-bit){.selfRef}

Subregistry: Map-Reply Header Bits ([Section 5.4](#MR-FORMAT){.auto
.internal .xref}):[¶](#section-12.6-5){.pilcrow}

::: {#section-12.6-6 .alignLeft .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Type=2 |P|E|S|          Reserved               | Record Count  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-12.6-6){.pilcrow}
:::

[]{#name-lisp-map-reply-header-bits}

  Spec Name   IANA Name     Bit Position   Description
  ----------- ------------- -------------- ------------------------
  P           Map-Reply-P   4              RLOC-Probe Bit
  E           Map-Reply-E   5              Echo-Nonce Capable Bit
  S           Map-Reply-S   6              Security Bit

  : [Table 7](#table-7){.selfRef}: [LISP Map-Reply Header
  Bits](#name-lisp-map-reply-header-bits){.selfRef}

Subregistry: Map-Register Header Bits ([Section 5.6](#MAPREG){.auto
.internal .xref}):[¶](#section-12.6-8){.pilcrow}

::: {#section-12.6-9 .alignLeft .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Type=3 |P|S|I|        Reserved       |E|T|a|R|M| Record Count  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-12.6-9){.pilcrow}
:::

[]{#name-lisp-map-register-header-bi}

  Spec Name   IANA Name        Bit Position   Description
  ----------- ---------------- -------------- ----------------------
  P           Map-Register-P   4              Proxy Map-Reply Bit
  S           Map-Register-S   5              LISP-SEC Capable Bit
  I           Map-Register-I   6              xTR-ID Present Bit

  : [Table 8](#table-8){.selfRef}: [LISP Map-Register Header
  Bits](#name-lisp-map-register-header-bi){.selfRef}

Subregistry: Encapsulated Control Message (ECM) Header Bits ([Section
5.8](#encap-mr){.auto .internal .xref}):[¶](#section-12.6-11){.pilcrow}

::: {#section-12.6-12 .alignLeft .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Type=8 |S|D|E|M|            Reserved                           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-12.6-12){.pilcrow}
:::

[]{#name-lisp-encapsulated-control-m}

  Spec Name   IANA Name   Bit Position   Description
  ----------- ----------- -------------- ----------------------------
  S           ECM-S       4              Security Bit
  D           ECM-D       5              LISP-DDT Bit
  E           ECM-E       6              Forward to ETR Bit
  M           ECM-M       7              Destined to Map-Server Bit

  : [Table 9](#table-9){.selfRef}: [LISP Encapsulated Control Message
  (ECM) Header Bits](#name-lisp-encapsulated-control-m){.selfRef}

Subregistry: EID-Record Header Bits ([Section 5.4](#MR-FORMAT){.auto
.internal .xref}):[¶](#section-12.6-14){.pilcrow}

::: {#section-12.6-15 .alignLeft .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Locator Count | EID mask-len  | ACT |A|      Reserved         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-12.6-15){.pilcrow}
:::

[]{#name-lisp-eid-record-header-bits}

  Spec Name   IANA Name      Bit Position   Description
  ----------- -------------- -------------- -------------------
  A           EID-Record-A   19             Authoritative Bit

  : [Table 10](#table-10){.selfRef}: [LISP EID-Record Header
  Bits](#name-lisp-eid-record-header-bits){.selfRef}

Subregistry: RLOC-Record Header Bits ([Section 5.4](#MR-FORMAT){.auto
.internal .xref}):[¶](#section-12.6-17){.pilcrow}

::: {#section-12.6-18 .alignLeft .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |        Unused Flags     |L|p|R|           Loc-AFI             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-12.6-18){.pilcrow}
:::

[]{#name-lisp-rloc-record-header-bit}

  Spec Name   IANA Name       Bit Position   Description
  ----------- --------------- -------------- ----------------------
  L           RLOC-Record-L   13             Local RLOC Bit
  p           RLOC-Record-p   14             RLOC-Probe Reply Bit
  R           RLOC-Record-R   15             RLOC Reachable Bit

  : [Table 11](#table-11){.selfRef}: [LISP RLOC-Record Header
  Bits](#name-lisp-rloc-record-header-bit){.selfRef}
:::
:::
:::

::: {#section-13 .section}
## [13.](#section-13){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-13.1 .section}
### [13.1.](#section-13.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC2404\]
:   [Madson, C.]{.refAuthor} and [R. Glenn]{.refAuthor}, [\"The Use of
    HMAC-SHA-1-96 within ESP and AH\"]{.refTitle}, [RFC
    2404]{.seriesInfo}, [DOI 10.17487/RFC2404]{.seriesInfo}, November
    1998, \<<https://www.rfc-editor.org/info/rfc2404>\>.
:   

\[RFC4086\]
:   [Eastlake 3rd, D.]{.refAuthor}, [Schiller, J.]{.refAuthor}, and [S.
    Crocker]{.refAuthor}, [\"Randomness Requirements for
    Security\"]{.refTitle}, [BCP 106]{.seriesInfo}, [RFC
    4086]{.seriesInfo}, [DOI 10.17487/RFC4086]{.seriesInfo}, June 2005,
    \<<https://www.rfc-editor.org/info/rfc4086>\>.
:   

\[RFC4868\]
:   [Kelly, S.]{.refAuthor} and [S. Frankel]{.refAuthor}, [\"Using
    HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512 with
    IPsec\"]{.refTitle}, [RFC 4868]{.seriesInfo}, [DOI
    10.17487/RFC4868]{.seriesInfo}, May 2007,
    \<<https://www.rfc-editor.org/info/rfc4868>\>.
:   

\[RFC5869\]
:   [Krawczyk, H.]{.refAuthor} and [P. Eronen]{.refAuthor},
    [\"HMAC-based Extract-and-Expand Key Derivation Function
    (HKDF)\"]{.refTitle}, [RFC 5869]{.seriesInfo}, [DOI
    10.17487/RFC5869]{.seriesInfo}, May 2010,
    \<<https://www.rfc-editor.org/info/rfc5869>\>.
:   

\[RFC6833\]
:   [Fuller, V.]{.refAuthor} and [D. Farinacci]{.refAuthor},
    [\"Locator/ID Separation Protocol (LISP) Map-Server
    Interface\"]{.refTitle}, [RFC 6833]{.seriesInfo}, [DOI
    10.17487/RFC6833]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6833>\>.
:   

\[RFC8085\]
:   [Eggert, L.]{.refAuthor}, [Fairhurst, G.]{.refAuthor}, and [G.
    Shepherd]{.refAuthor}, [\"UDP Usage Guidelines\"]{.refTitle}, [BCP
    145]{.seriesInfo}, [RFC 8085]{.seriesInfo}, [DOI
    10.17487/RFC8085]{.seriesInfo}, March 2017,
    \<<https://www.rfc-editor.org/info/rfc8085>\>.
:   

\[RFC8126\]
:   [Cotton, M.]{.refAuthor}, [Leiba, B.]{.refAuthor}, and [T.
    Narten]{.refAuthor}, [\"Guidelines for Writing an IANA
    Considerations Section in RFCs\"]{.refTitle}, [BCP 26]{.seriesInfo},
    [RFC 8126]{.seriesInfo}, [DOI 10.17487/RFC8126]{.seriesInfo}, June
    2017, \<<https://www.rfc-editor.org/info/rfc8126>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC9300\]
:   [Farinacci, D.]{.refAuthor}, [Fuller, V.]{.refAuthor},
    [Meyer, D.]{.refAuthor}, [Lewis, D.]{.refAuthor}, and [A. Cabellos,
    Ed.]{.refAuthor}, [\"The Locator/ID Separation Protocol
    (LISP)\"]{.refTitle}, [RFC 9300]{.seriesInfo}, [DOI
    10.17487/RFC9300]{.seriesInfo}, October 2022,
    \<<https://www.rfc-editor.org/info/rfc9300>\>.
:   

\[RFC9302\]
:   [Iannone, L.]{.refAuthor}, [Saucez, D.]{.refAuthor}, and [O.
    Bonaventure]{.refAuthor}, [\"Locator/ID Separation Protocol (LISP)
    Map-Versioning\"]{.refTitle}, [RFC 9302]{.seriesInfo}, [DOI
    10.17487/RFC9302]{.seriesInfo}, October 2022,
    \<<https://www.rfc-editor.org/info/rfc9302>\>.
:   

\[RFC9303\]
:   [Maino, F.]{.refAuthor}, [Ermagan, V.]{.refAuthor},
    [Cabellos, A.]{.refAuthor}, and [D. Saucez]{.refAuthor},
    [\"Locator/ID Separation Protocol Security (LISP-SEC)\"]{.refTitle},
    [RFC 9303]{.seriesInfo}, [DOI 10.17487/RFC9303]{.seriesInfo},
    October 2022, \<<https://www.rfc-editor.org/info/rfc9303>\>.
:   

\[RFC9304\]
:   [Boucadair, M.]{.refAuthor} and [C. Jacquenet]{.refAuthor},
    [\"Locator/ID Separation Protocol (LISP): Shared Extension Message
    and IANA Registry for Packet Type Allocations\"]{.refTitle}, [RFC
    9304]{.seriesInfo}, [DOI 10.17487/RFC9304]{.seriesInfo}, October
    2022, \<<https://www.rfc-editor.org/info/rfc9304>\>.
:   
:::

::: {#section-13.2 .section}
### [13.2.](#section-13.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[AFN\]
:   [IANA]{.refAuthor}, [\"Address Family Numbers\"]{.refTitle},
    \<[http://www.iana.org/assignments/address-family-numbers/](https://www.iana.org/assignments/address-family-numbers/)\>.
:   

\[ECDSA-AUTH\]
:   [Farinacci, D.]{.refAuthor} and [E. Nordmark]{.refAuthor}, [\"LISP
    Control-Plane ECDSA Authentication and Authorization\"]{.refTitle},
    [Work in Progress]{.refContent}, [Internet-Draft,
    draft-ietf-lisp-ecdsa-auth-09]{.seriesInfo}, 11 September 2022,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-lisp-ecdsa-auth-09>\>.
:   

\[EID-ANONYMITY\]
:   [Farinacci, D.]{.refAuthor}, [Pillay-Esnault, P.]{.refAuthor}, and
    [W. Haddad]{.refAuthor}, [\"LISP EID Anonymity\"]{.refTitle}, [Work
    in Progress]{.refContent}, [Internet-Draft,
    draft-ietf-lisp-eid-anonymity-13]{.seriesInfo}, 11 September 2022,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-lisp-eid-anonymity-13>\>.
:   

\[EID-MOBILITY\]
:   [Portoles, M.]{.refAuthor}, [Ashtaputre, V.]{.refAuthor},
    [Maino, F.]{.refAuthor}, [Moreno, V.]{.refAuthor}, and [D.
    Farinacci]{.refAuthor}, [\"LISP L2/L3 EID Mobility Using a Unified
    Control Plane\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-ietf-lisp-eid-mobility-10]{.seriesInfo}, 10
    July 2022,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-lisp-eid-mobility-10>\>.
:   

\[GTP-3GPP\]
:   [3GPP]{.refAuthor}, [\"General Packet Radio System (GPRS) Tunnelling
    Protocol User Plane (GTPv1-U)\"]{.refTitle},
    [TS.29.281]{.refContent}, June 2022,
    \<<https://portal.3gpp.org/desktopmodules/Specifications/SpecificationDetails.aspx?specificationId=1699>\>.
:   

\[INTAREA-ILA\]
:   [Herbert, T.]{.refAuthor} and [P. Lapukhov]{.refAuthor},
    [\"Identifier-locator addressing for IPv6\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-herbert-intarea-ila-01]{.seriesInfo}, 5 March 2018,
    \<<https://datatracker.ietf.org/doc/html/draft-herbert-intarea-ila-01>\>.
:   

\[LISP-MN\]
:   [Farinacci, D.]{.refAuthor}, [Lewis, D.]{.refAuthor},
    [Meyer, D.]{.refAuthor}, and [C. White]{.refAuthor}, [\"LISP Mobile
    Node\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-ietf-lisp-mn-12]{.seriesInfo}, 24 July 2022,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-lisp-mn-12>\>.
:   

\[LISP-PUBSUB\]
:   [Rodriguez-Natal, A.]{.refAuthor}, [Ermagan, V.]{.refAuthor},
    [Cabellos-Aparicio, A.]{.refAuthor}, [Barkai, S.]{.refAuthor}, and
    [M. Boucadair]{.refAuthor}, [\"Publish/Subscribe Functionality for
    LISP\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-ietf-lisp-pubsub-09]{.seriesInfo}, 28 June
    2021,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-lisp-pubsub-09>\>.
:   

\[NVO3-VXLAN-GPE\]
:   [Maino, F., Ed.]{.refAuthor}, [Kreeger, L., Ed.]{.refAuthor}, and
    [U. Elzur, Ed.]{.refAuthor}, [\"Generic Protocol Extension for VXLAN
    (VXLAN-GPE)\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-ietf-nvo3-vxlan-gpe-12]{.seriesInfo}, 22
    September 2021,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-nvo3-vxlan-gpe-12>\>.
:   

\[OPSEC-ICMP-FILTER\]
:   [Gont, F.]{.refAuthor}, [Gont, G.]{.refAuthor}, and [C.
    Pignataro]{.refAuthor}, [\"Recommendations for filtering ICMP
    messages\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-ietf-opsec-icmp-filtering-04]{.seriesInfo}, 3
    July 2013,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-opsec-icmp-filtering-04>\>.
:   

\[RFC1035\]
:   [Mockapetris, P.]{.refAuthor}, [\"Domain names - implementation and
    specification\"]{.refTitle}, [STD 13]{.seriesInfo}, [RFC
    1035]{.seriesInfo}, [DOI 10.17487/RFC1035]{.seriesInfo}, November
    1987, \<<https://www.rfc-editor.org/info/rfc1035>\>.
:   

\[RFC1071\]
:   [Braden, R.]{.refAuthor}, [Borman, D.]{.refAuthor}, and [C.
    Partridge]{.refAuthor}, [\"Computing the Internet
    checksum\"]{.refTitle}, [RFC 1071]{.seriesInfo}, [DOI
    10.17487/RFC1071]{.seriesInfo}, September 1988,
    \<<https://www.rfc-editor.org/info/rfc1071>\>.
:   

\[RFC2890\]
:   [Dommety, G.]{.refAuthor}, [\"Key and Sequence Number Extensions to
    GRE\"]{.refTitle}, [RFC 2890]{.seriesInfo}, [DOI
    10.17487/RFC2890]{.seriesInfo}, September 2000,
    \<<https://www.rfc-editor.org/info/rfc2890>\>.
:   

\[RFC4984\]
:   [Meyer, D., Ed.]{.refAuthor}, [Zhang, L., Ed.]{.refAuthor}, and [K.
    Fall, Ed.]{.refAuthor}, [\"Report from the IAB Workshop on Routing
    and Addressing\"]{.refTitle}, [RFC 4984]{.seriesInfo}, [DOI
    10.17487/RFC4984]{.seriesInfo}, September 2007,
    \<<https://www.rfc-editor.org/info/rfc4984>\>.
:   

\[RFC6830\]
:   [Farinacci, D.]{.refAuthor}, [Fuller, V.]{.refAuthor},
    [Meyer, D.]{.refAuthor}, and [D. Lewis]{.refAuthor}, [\"The
    Locator/ID Separation Protocol (LISP)\"]{.refTitle}, [RFC
    6830]{.seriesInfo}, [DOI 10.17487/RFC6830]{.seriesInfo}, January
    2013, \<<https://www.rfc-editor.org/info/rfc6830>\>.
:   

\[RFC6831\]
:   [Farinacci, D.]{.refAuthor}, [Meyer, D.]{.refAuthor},
    [Zwiebel, J.]{.refAuthor}, and [S. Venaas]{.refAuthor}, [\"The
    Locator/ID Separation Protocol (LISP) for Multicast
    Environments\"]{.refTitle}, [RFC 6831]{.seriesInfo}, [DOI
    10.17487/RFC6831]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6831>\>.
:   

\[RFC6832\]
:   [Lewis, D.]{.refAuthor}, [Meyer, D.]{.refAuthor},
    [Farinacci, D.]{.refAuthor}, and [V. Fuller]{.refAuthor},
    [\"Interworking between Locator/ID Separation Protocol (LISP) and
    Non-LISP Sites\"]{.refTitle}, [RFC 6832]{.seriesInfo}, [DOI
    10.17487/RFC6832]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6832>\>.
:   

\[RFC6836\]
:   [Fuller, V.]{.refAuthor}, [Farinacci, D.]{.refAuthor},
    [Meyer, D.]{.refAuthor}, and [D. Lewis]{.refAuthor}, [\"Locator/ID
    Separation Protocol Alternative Logical Topology
    (LISP+ALT)\"]{.refTitle}, [RFC 6836]{.seriesInfo}, [DOI
    10.17487/RFC6836]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6836>\>.
:   

\[RFC6837\]
:   [Lear, E.]{.refAuthor}, [\"NERD: A Not-so-novel Endpoint ID (EID) to
    Routing Locator (RLOC) Database\"]{.refTitle}, [RFC
    6837]{.seriesInfo}, [DOI 10.17487/RFC6837]{.seriesInfo}, January
    2013, \<<https://www.rfc-editor.org/info/rfc6837>\>.
:   

\[RFC6973\]
:   [Cooper, A.]{.refAuthor}, [Tschofenig, H.]{.refAuthor},
    [Aboba, B.]{.refAuthor}, [Peterson, J.]{.refAuthor},
    [Morris, J.]{.refAuthor}, [Hansen, M.]{.refAuthor}, and [R.
    Smith]{.refAuthor}, [\"Privacy Considerations for Internet
    Protocols\"]{.refTitle}, [RFC 6973]{.seriesInfo}, [DOI
    10.17487/RFC6973]{.seriesInfo}, July 2013,
    \<<https://www.rfc-editor.org/info/rfc6973>\>.
:   

\[RFC7348\]
:   [Mahalingam, M.]{.refAuthor}, [Dutt, D.]{.refAuthor},
    [Duda, K.]{.refAuthor}, [Agarwal, P.]{.refAuthor},
    [Kreeger, L.]{.refAuthor}, [Sridhar, T.]{.refAuthor},
    [Bursell, M.]{.refAuthor}, and [C. Wright]{.refAuthor}, [\"Virtual
    eXtensible Local Area Network (VXLAN): A Framework for Overlaying
    Virtualized Layer 2 Networks over Layer 3 Networks\"]{.refTitle},
    [RFC 7348]{.seriesInfo}, [DOI 10.17487/RFC7348]{.seriesInfo}, August
    2014, \<<https://www.rfc-editor.org/info/rfc7348>\>.
:   

\[RFC7835\]
:   [Saucez, D.]{.refAuthor}, [Iannone, L.]{.refAuthor}, and [O.
    Bonaventure]{.refAuthor}, [\"Locator/ID Separation Protocol (LISP)
    Threat Analysis\"]{.refTitle}, [RFC 7835]{.seriesInfo}, [DOI
    10.17487/RFC7835]{.seriesInfo}, April 2016,
    \<<https://www.rfc-editor.org/info/rfc7835>\>.
:   

\[RFC8060\]
:   [Farinacci, D.]{.refAuthor}, [Meyer, D.]{.refAuthor}, and [J.
    Snijders]{.refAuthor}, [\"LISP Canonical Address Format
    (LCAF)\"]{.refTitle}, [RFC 8060]{.seriesInfo}, [DOI
    10.17487/RFC8060]{.seriesInfo}, February 2017,
    \<<https://www.rfc-editor.org/info/rfc8060>\>.
:   

\[RFC8061\]
:   [Farinacci, D.]{.refAuthor} and [B. Weis]{.refAuthor}, [\"Locator/ID
    Separation Protocol (LISP) Data-Plane Confidentiality\"]{.refTitle},
    [RFC 8061]{.seriesInfo}, [DOI 10.17487/RFC8061]{.seriesInfo},
    February 2017, \<<https://www.rfc-editor.org/info/rfc8061>\>.
:   

\[RFC8111\]
:   [Fuller, V.]{.refAuthor}, [Lewis, D.]{.refAuthor},
    [Ermagan, V.]{.refAuthor}, [Jain, A.]{.refAuthor}, and [A.
    Smirnov]{.refAuthor}, [\"Locator/ID Separation Protocol Delegated
    Database Tree (LISP-DDT)\"]{.refTitle}, [RFC 8111]{.seriesInfo},
    [DOI 10.17487/RFC8111]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8111>\>.
:   

\[RFC8378\]
:   [Moreno, V.]{.refAuthor} and [D. Farinacci]{.refAuthor},
    [\"Signal-Free Locator/ID Separation Protocol (LISP)
    Multicast\"]{.refTitle}, [RFC 8378]{.seriesInfo}, [DOI
    10.17487/RFC8378]{.seriesInfo}, May 2018,
    \<<https://www.rfc-editor.org/info/rfc8378>\>.
:   

\[RFC8402\]
:   [Filsfils, C., Ed.]{.refAuthor}, [Previdi, S., Ed.]{.refAuthor},
    [Ginsberg, L.]{.refAuthor}, [Decraene, B.]{.refAuthor},
    [Litkowski, S.]{.refAuthor}, and [R. Shakir]{.refAuthor}, [\"Segment
    Routing Architecture\"]{.refTitle}, [RFC 8402]{.seriesInfo}, [DOI
    10.17487/RFC8402]{.seriesInfo}, July 2018,
    \<<https://www.rfc-editor.org/info/rfc8402>\>.
:   

\[RFC9147\]
:   [Rescorla, E.]{.refAuthor}, [Tschofenig, H.]{.refAuthor}, and [N.
    Modadugu]{.refAuthor}, [\"The Datagram Transport Layer Security
    (DTLS) Protocol Version 1.3\"]{.refTitle}, [RFC 9147]{.seriesInfo},
    [DOI 10.17487/RFC9147]{.seriesInfo}, April 2022,
    \<<https://www.rfc-editor.org/info/rfc9147>\>.
:   

\[RFC9299\]
:   [Cabellos, A.]{.refAuthor} and [D. Saucez, Ed.]{.refAuthor}, [\"An
    Architectural Introduction to the Locator/ID Separation Protocol
    (LISP)\"]{.refTitle}, [RFC 9299]{.seriesInfo}, [DOI
    10.17487/RFC9299]{.seriesInfo}, October 2022,
    \<<https://www.rfc-editor.org/info/rfc9299>\>.
:   

\[RFC9305\]
:   [Maino, F., Ed.]{.refAuthor}, [Lemon, J.]{.refAuthor},
    [Agarwal, P.]{.refAuthor}, [Lewis, D.]{.refAuthor}, and [M.
    Smith]{.refAuthor}, [\"Locator/ID Separation Protocol (LISP) Generic
    Protocol Extension\"]{.refTitle}, [RFC 9305]{.seriesInfo}, [DOI
    10.17487/RFC9305]{.seriesInfo}, October 2022,
    \<<https://www.rfc-editor.org/info/rfc9305>\>.
:   
:::
:::

::: {#appendix-A .section}
## [Acknowledgments](#name-acknowledgments){.section-name .selfRef} {#name-acknowledgments}

The original authors would like to thank [Greg Schudel]{.contact-name},
[Darrel Lewis]{.contact-name}, [John Zwiebel]{.contact-name}, [Andrew
Partan]{.contact-name}, [Dave Meyer]{.contact-name}, [Isidor
Kouvelas]{.contact-name}, [Jesper Skriver]{.contact-name}, and members
of the lisp\@ietf.org mailing list for their feedback and helpful
suggestions.[¶](#appendix-A-1){.pilcrow}

Special thanks are due to [Noel Chiappa]{.contact-name} for his
extensive work and thought about caching in
Map-Resolvers.[¶](#appendix-A-2){.pilcrow}

The current authors would like to give a sincere thank you to the people
who help put LISP on the Standards Track in the IETF. They include [Joel
Halpern]{.contact-name}, [Luigi Iannone]{.contact-name}, [Deborah
Brungard]{.contact-name}, [Fabio Maino]{.contact-name}, [Scott
Bradner]{.contact-name}, [Kyle Rose]{.contact-name}, [Takeshi
Takahashi]{.contact-name}, [Sarah Banks]{.contact-name}, [Pete
Resnick]{.contact-name}, [Colin Perkins]{.contact-name}, [Mirja
Kühlewind]{.contact-name}, [Francis Dupont]{.contact-name}, [Benjamin
Kaduk]{.contact-name}, [Eric Rescorla]{.contact-name}, [Alvaro
Retana]{.contact-name}, [Alexey Melnikov]{.contact-name}, [Alissa
Cooper]{.contact-name}, [Suresh Krishnan]{.contact-name}, [Alberto
Rodriguez-Natal]{.contact-name}, [Vina Ermagan]{.contact-name}, [Mohamed
Boucadair]{.contact-name}, [Brian Trammell]{.contact-name}, [Sabrina
Tanamal]{.contact-name}, and [John Drake]{.contact-name}. The
contributions they offered greatly added to the security, scale, and
robustness of the LISP architecture and
protocols.[¶](#appendix-A-3){.pilcrow}
:::

::: {#authors-addresses}
::: {#appendix-B .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Dino Farinacci]{.fn .nameRole}
:::

::: {.left dir="auto"}
[lispers.net]{.org}
:::

::: {.left dir="auto"}
[San Jose]{.locality}, [CA]{.region}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <farinacci@gmail.com>
:::

::: {.left dir="auto"}
[Fabio Maino]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems]{.org}
:::

::: {.left dir="auto"}
[San Jose]{.locality}, [CA]{.region}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <fmaino@cisco.com>
:::

::: {.left dir="auto"}
[Vince Fuller]{.fn .nameRole}
:::

::: {.left dir="auto"}
[vaf.net Internet Consulting]{.org}
:::

::: email
Email: <vince.fuller@gmail.com>
:::

::: {.left dir="auto"}
[Albert Cabellos ([editor]{.role})]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Universitat Politecnica de Catalunya]{.org}
:::

::: {.left dir="auto"}
[c/ Jordi Girona s/n]{.street-address}
:::

::: {.left dir="auto"}
[08034]{.postal-code} [Barcelona]{.locality}
:::

::: {.left dir="auto"}
[Spain]{.country-name}
:::

::: email
Email: <acabello@ac.upc.edu>
:::
:::
:::
