  RFC 9322          IOAM Flags        November 2022
  ----------------- ----------------- ---------------
  Mizrahi, et al.   Standards Track   \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9322](https://www.rfc-editor.org/rfc/rfc9322){.eref}

Category:
:   Standards Track

Published:
:   November 2022

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    T. Mizrahi
    :::

    ::: org
    Huawei
    :::
    :::

    ::: author
    ::: author-name
    F. Brockners
    :::

    ::: org
    Cisco
    :::
    :::

    ::: author
    ::: author-name
    S. Bhandari
    :::

    ::: org
    Thoughtspot
    :::
    :::

    ::: author
    ::: author-name
    B. Gafni
    :::

    ::: org
    Nvidia
    :::
    :::

    ::: author
    ::: author-name
    M. Spiegel
    :::

    ::: org
    Barefoot Networks
    :::
    :::
:::

# RFC 9322 {#rfcnum}

# In Situ Operations, Administration, and Maintenance (IOAM) Loopback and Active Flags {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

In situ Operations, Administration, and Maintenance (IOAM) collects
operational and telemetry information in packets while they traverse a
path between two points in the network. This document defines two new
flags in the IOAM Trace Option headers, specifically the Loopback and
Active flags.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9322>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2022 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Revised BSD License text as described in Section 4.e of the Trust Legal
Provisions and are provided without warranty as described in the Revised
BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.auto .internal
    .xref}.  [Introduction](#name-introduction){.internal .xref}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.auto .internal
    .xref}.  [Conventions](#name-conventions){.internal .xref}

    -   ::: {#section-toc.1-1.2.2.1}
        [2.1](#section-2.1){.auto .internal .xref}.  [Requirements
        Language](#name-requirements-language){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.2.2.2}
        [2.2](#section-2.2){.auto .internal
        .xref}.  [Terminology](#name-terminology){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.auto .internal .xref}.  [New IOAM Trace Option
    Flags](#name-new-ioam-trace-option-flags){.internal .xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.auto .internal .xref}.  [Loopback in
    IOAM](#name-loopback-in-ioam){.internal .xref}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.auto .internal .xref}.  [Loopback:
        Encapsulating Node
        Functionality](#name-loopback-encapsulating-node){.internal
        .xref}

        -   ::: {#section-toc.1-1.4.2.1.2.1}
            [4.1.1](#section-4.1.1){.auto .internal .xref}.  [Loopback
            Packet Selection](#name-loopback-packet-selection){.internal
            .xref}
            :::
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.auto .internal .xref}.  [Receiving and
        Processing
        Loopback](#name-receiving-and-processing-lo){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.auto .internal .xref}.  [Loopback on the
        Return Path](#name-loopback-on-the-return-path){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.auto .internal .xref}.  [Terminating a
        Looped-Back Packet](#name-terminating-a-looped-back-p){.internal
        .xref}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.auto .internal .xref}.  [Active Measurement with
    IOAM](#name-active-measurement-with-ioa){.internal .xref}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.auto .internal .xref}.  [IANA
    Considerations](#name-iana-considerations){.internal .xref}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.auto .internal .xref}.  [Performance
    Considerations](#name-performance-considerations){.internal .xref}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.auto .internal .xref}.  [Security
    Considerations](#name-security-considerations){.internal .xref}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.auto .internal
    .xref}.  [References](#name-references){.internal .xref}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.auto .internal .xref}.  [Normative
        References](#name-normative-references){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.auto .internal .xref}.  [Informative
        References](#name-informative-references){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [](#appendix-A){.auto .internal
    .xref}[Acknowledgments](#name-acknowledgments){.internal .xref}
    :::

-   ::: {#section-toc.1-1.11}
    [](#appendix-B){.auto .internal
    .xref}[Contributors](#name-contributors){.internal .xref}
    :::

-   ::: {#section-toc.1-1.12}
    [](#appendix-C){.auto .internal .xref}[Authors\'
    Addresses](#name-authors-addresses){.internal .xref}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

IOAM \[[RFC9197](#RFC9197){.cite .xref}\] is used for monitoring traffic
in the network by incorporating IOAM data fields into in-flight data
packets.[¶](#section-1-1){.pilcrow}

IOAM data may be represented in one of four possible IOAM options:
Pre-allocated Trace, Incremental Trace, Proof of Transit (POT), and
Edge-to-Edge. This document defines two new flags in the Pre-allocated
and Incremental Trace options: the Loopback and Active
flags.[¶](#section-1-2){.pilcrow}

The Loopback flag is used to request that each transit device along the
path loops back a truncated copy of the data packet to the sender. The
Active flag indicates that a packet is used for active measurement. The
term \"active measurement\" in the context of this document is as
defined in \[[RFC7799](#RFC7799){.cite
.xref}\].[¶](#section-1-3){.pilcrow}
:::

::: {#Conventions}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Conventions](#name-conventions){.section-name .selfRef} {#name-conventions}

::: {#section-2.1 .section}
### [2.1.](#section-2.1){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.cite .xref}\]
\[[RFC8174](#RFC8174){.cite .xref}\] when, and only when, they appear in
all capitals, as shown here.[¶](#section-2.1-1){.pilcrow}
:::

::: {#section-2.2 .section}
### [2.2.](#section-2.2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

Abbreviations used in this document:[¶](#section-2.2-1){.pilcrow}

[]{.break}

IOAM:
:   In situ Operations, Administration, and
    Maintenance[¶](#section-2.2-2.2){.pilcrow}
:   

OAM:
:   Operations, Administration, and Maintenance
    \[[RFC6291](#RFC6291){.cite .xref}\][¶](#section-2.2-2.4){.pilcrow}
:   
:::
:::
:::

::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [New IOAM Trace Option Flags](#name-new-ioam-trace-option-flags){.section-name .selfRef} {#name-new-ioam-trace-option-flags}

::: {#TraceFlags}
This document defines two new flags in the Pre-allocated and Incremental
Trace options:[¶](#section-3-1){.pilcrow}
:::

[]{.break}

Bit 1 \"Loopback\" (L-bit):
:   When set, the Loopback flag triggers the sending of a copy of a
    packet back towards the source, as further described in [Section
    4](#LoopbackSec){.auto .internal
    .xref}.[¶](#section-3-2.2){.pilcrow}
:   

Bit 2 \"Active\" (A-bit):
:   When set, the Active flag indicates that a packet is an active
    measurement packet rather than a data packet, where \"active\" is
    used in the sense defined in \[[RFC7799](#RFC7799){.cite .xref}\].
    The packet may be an IOAM probe packet or a replicated data packet
    (the second and third use cases of [Section 5](#UseCaseSec){.auto
    .internal .xref}).[¶](#section-3-2.4){.pilcrow}
:   
:::

::: {#LoopbackSec}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Loopback in IOAM](#name-loopback-in-ioam){.section-name .selfRef} {#name-loopback-in-ioam}

The Loopback flag is used to request that each transit device along the
path loops back a truncated copy of the data packet to the sender.
Loopback allows an IOAM encapsulating node to trace the path to a given
destination and to receive per-hop data about both the forward and
return paths. Loopback is intended to provide an accelerated alternative
to Traceroute that allows the encapsulating node to receive responses
from multiple transit nodes along the path in less than one round-trip
time (RTT) and by sending a single packet.[¶](#section-4-1){.pilcrow}

As illustrated in [Figure 1](#LoopbackFig){.auto .internal .xref}, an
IOAM encapsulating node can push an IOAM encapsulation that includes the
Loopback flag onto some or all of the packets it forwards using one of
the IOAM encapsulation types, e.g.,
\[[IOAM-NSH](#I-D.ietf-sfc-ioam-nsh){.cite .xref}\] or
\[[IOAM-IPV6-OPTIONS](#I-D.ietf-ippm-ioam-ipv6-options){.cite .xref}\].
The IOAM transit node and the decapsulating node both create copies of
the packet and loop them back to the encapsulating node. The
decapsulating node also terminates the IOAM encapsulation and then
forwards the packet towards the destination. The two IOAM looped-back
copies are terminated by the encapsulating
node.[¶](#section-4-2){.pilcrow}

[]{#name-loopback-in-ioam-2}

::: {#LoopbackFig}
::: {#section-4-3.1 .alignLeft .art-text .artwork}
    +--------+     +--------+     +--------+     +--------+     +--------+
    |        |     |  IOAM  |.....|  IOAM  |.....|  IOAM  |     |        |
    +--------+     +--------+     +--------+     +--------+     +--------+
    | L2/L3  |<===>| L2/L3  |<===>| L2/L3  |<===>| L2/L3  |<===>| L2/L3  |
    +--------+     +--------+     +--------+     +--------+     +--------+
      Source      Encapsulating    Transit      Decapsulating   Destination
                       Node           Node           Node

                   <------------  IOAM-Domain  ----------->

                        IOAM encap. with Loopback flag
    Data packet  ------->============================>----------->
                                      |             |
                     IOAM looped back |             |
                        <=============+             |
                                    IOAM looped back|
                        <===========================+
:::

[Figure 1](#figure-1){.selfRef}: [Loopback in
IOAM](#name-loopback-in-ioam-2){.selfRef}
:::

Loopback can be used only if a return path from transit nodes and
destination nodes towards the source (encapsulating node) exists.
Specifically, loopback is only applicable in encapsulations in which the
identity of the encapsulating node is available in the encapsulation
header. If an encapsulating node receives a looped-back packet that was
not originated from the current encapsulating node, the packet is
dropped.[¶](#section-4-4){.pilcrow}

::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [Loopback: Encapsulating Node Functionality](#name-loopback-encapsulating-node){.section-name .selfRef} {#name-loopback-encapsulating-node}

The encapsulating node either generates synthetic packets with an IOAM
trace option that has the Loopback flag set or sets the Loopback flag in
a subset of the in-transit data packets. Loopback is used either
proactively or on-demand, i.e., when a failure is detected. The
encapsulating node also needs to ensure that sufficient space is
available in the IOAM header for loopback operation, which includes
transit nodes adding trace data on the original path and again on the
return path.[¶](#section-4.1-1){.pilcrow}

An IOAM trace option that has the Loopback flag set [MUST]{.bcp14} have
the value \'1\' in the most significant bit of IOAM-Trace-Type and \'0\'
in the rest of the bits of IOAM-Trace-Type. Thus, every transit node
that processes this trace option only adds a single data field, which is
the Hop_Lim and node_id data field. A transit node that receives a
packet with an IOAM trace option that has the Loopback flag set and the
IOAM-Trace-Type is not equal to \'1\' in the most significant bit and
\'0\' in the rest of the bits [MUST NOT]{.bcp14} loop back a copy of the
packet. The reason for allowing only a single data field per hop is to
minimize the impact of amplification
attacks.[¶](#section-4.1-2){.pilcrow}

IOAM encapsulating nodes [MUST NOT]{.bcp14} push an IOAM encapsulation
with the Loopback flag onto data packets that already include an IOAM
encapsulation. This requirement is intended to prevent IOAM Loopback
nesting where looped-back packets may be subject to loopback in a nested
IOAM-Domain.[¶](#section-4.1-3){.pilcrow}

::: {#SelectSec}
::: {#section-4.1.1 .section}
#### [4.1.1.](#section-4.1.1){.section-number .selfRef} [Loopback Packet Selection](#name-loopback-packet-selection){.section-name .selfRef} {#name-loopback-packet-selection}

If an IOAM encapsulating node incorporates the Loopback flag into all
the traffic it forwards, it may lead to an excessive amount of looped
back packets, which may overload the network and the encapsulating node.
Therefore, an IOAM encapsulating node that supports the Loopback flag
[MUST]{.bcp14} support the ability to incorporate the Loopback flag
selectively into a subset of the packets that are forwarded by
it.[¶](#section-4.1.1-1){.pilcrow}

Various methods of packet selection and sampling have been previously
defined, such as \[[RFC7014](#RFC7014){.cite .xref}\] and
\[[RFC5475](#RFC5475){.cite .xref}\]. Similar techniques can be applied
by an IOAM encapsulating node to apply loopback to a subset of the
forwarded traffic.[¶](#section-4.1.1-2){.pilcrow}

The subset of traffic that is forwarded or transmitted with a Loopback
flag [SHOULD NOT]{.bcp14} exceed 1/N of the interface capacity on any of
the IOAM encapsulating node\'s interfaces. This requirement applies to
the total traffic that incorporates a Loopback flag, including traffic
that is forwarded by the IOAM encapsulating node and probe packets that
are generated by the IOAM encapsulating node. In this context, N is a
parameter that can be configurable by network operators. If there is an
upper bound, M, on the number of IOAM transit nodes in any path in the
network, then configuring N such that N \>\> M (i.e., N is much greater
than M) is [RECOMMENDED]{.bcp14}. The rationale is that a packet that
includes the Loopback flag triggers a looped-back packet from each IOAM
transit node along the path for a total of M looped-back packets. Thus,
if N \>\> M, then the number of looped-back packets is significantly
lower than the number of data packets forwarded by the IOAM
encapsulating node. It is [RECOMMENDED]{.bcp14} that the default value
of N satisfies N>100 to be used in the absence of explicit operator
configuration or if there is no prior knowledge about the network
topology or size.[¶](#section-4.1.1-3){.pilcrow}

An IOAM-Domain in which the Loopback flag is used [MUST]{.bcp14} be
configured such that there is expected to be a return path from each of
the IOAM transit and IOAM decapsulating nodes; if this expectation does
not apply, or if the encapsulating node\'s identity is not available in
the encapsulation header, then configuration [MUST NOT]{.bcp14} enable
the Loopback flag to be set.[¶](#section-4.1.1-4){.pilcrow}
:::
:::
:::

::: {#ReceiveSec}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [Receiving and Processing Loopback](#name-receiving-and-processing-lo){.section-name .selfRef} {#name-receiving-and-processing-lo}

A Loopback flag that is set indicates to the transit nodes processing
this option that they are to create a copy of the received packet and
send the copy back to the source of the packet. In this context, the
source is the IOAM encapsulating node and it is assumed that the source
address is available in the encapsulation header. Thus, the source
address of the original packet is used as the destination address in the
copied packet. If IOAM is used over an encapsulation that does not
include the address of the encapsulating node, then the
transit/decapsulating node does not loop back a copy of the original
packet. The address of the node performing the copy operation is used as
the source address; the specific method of source address assignment is
encapsulation specific, e.g., if an IPv6 encapsulation is used, then the
source address can be assigned as specified in
\[[RFC6724](#RFC6724){.cite .xref}\]. The copy is also truncated, i.e.,
any payload that resides after the IOAM option(s) is removed before
transmitting the looped-back packet back towards the encapsulating node.
Creating the copy that is looped back, and specifically the truncation,
may require some encapsulation-specific updates in the encapsulation
header. The original packet continues towards its destination. The L-bit
[MUST]{.bcp14} be cleared in the copy of the packet that a node sends
back towards the source.[¶](#section-4.2-1){.pilcrow}

An IOAM node that supports the reception and processing of the Loopback
flag [MUST]{.bcp14} support the ability to limit the rate of the
looped-back packets. The rate of looped-back packets [SHOULD]{.bcp14} be
limited so that the number of looped-back packets is significantly lower
than the number of packets that are forwarded by the device. The
looped-back data rate [SHOULD NOT]{.bcp14} exceed 1/N of the interface
capacity on any of the IOAM node\'s interfaces. Using N>100 is
[RECOMMENDED]{.bcp14}. Depending on the IOAM node\'s architecture
considerations, the loopback response rate may be limited to a lower
number in order to avoid overloading the IOAM
node.[¶](#section-4.2-2){.pilcrow}
:::
:::

::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [Loopback on the Return Path](#name-loopback-on-the-return-path){.section-name .selfRef} {#name-loopback-on-the-return-path}

On its way back towards the source, the copied packet is processed like
any other packet with IOAM information, including adding requested data
at each transit node (assuming there is sufficient
space).[¶](#section-4.3-1){.pilcrow}
:::

::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [Terminating a Looped-Back Packet](#name-terminating-a-looped-back-p){.section-name .selfRef} {#name-terminating-a-looped-back-p}

Once the return packet reaches the IOAM-Domain boundary, IOAM
decapsulation occurs as with any other packet containing IOAM
information. Note that the looped-back packet does not have the L-bit
set. The IOAM encapsulating node that initiated the original loopback
packet recognizes a received packet as an IOAM looped-back packet by
checking the Node ID in the Hop_Lim/node_id field that corresponds to
the first hop. If the Node ID and IOAM-Namespace match the current IOAM
node, it indicates that this is a looped-back packet that was initiated
by the current IOAM node and processed accordingly. If there is no match
in the Node ID, the packet is processed like a conventional
IOAM-encapsulated packet.[¶](#section-4.4-1){.pilcrow}

Note that an IOAM encapsulating node may be either an endpoint (such as
an IPv6 host) or a switch/router that pushes a tunnel encapsulation onto
data packets. In both cases, the functionality that was described above
avoids IOAM data leaks from the IOAM-Domain. Specifically, if an IOAM
looped-back packet reaches an IOAM boundary node that is not the IOAM
node that initiated the loopback, the node does not process the packet
as a loopback; the IOAM encapsulation is removed, preventing IOAM
information from leaking out from the IOAM-Domain. Since the packet does
not have any payload, it is terminated.[¶](#section-4.4-2){.pilcrow}
:::
:::
:::

::: {#UseCaseSec}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Active Measurement with IOAM](#name-active-measurement-with-ioa){.section-name .selfRef} {#name-active-measurement-with-ioa}

Active measurement methods \[[RFC7799](#RFC7799){.cite .xref}\] make use
of synthetically generated packets in order to facilitate measurement.
This section presents use cases of active measurement using the IOAM
Active flag.[¶](#section-5-1){.pilcrow}

The Active flag indicates that a packet is used for active measurement.
An IOAM decapsulating node that receives a packet with the Active flag
set in one of its Trace options must terminate the packet. The Active
flag is intended to simplify the implementation of decapsulating nodes
by indicating that the packet should not be forwarded further. It is not
intended as a replacement for existing active OAM protocols, which may
run in higher layers and make use of the Active
flag.[¶](#section-5-2){.pilcrow}

An example of an IOAM deployment scenario is illustrated in [Figure
2](#NetworkFig){.auto .internal .xref}. The figure depicts two
endpoints: a source and a destination. The data traffic from the source
to the destination is forwarded through a set of network devices,
including an IOAM encapsulating node (which incorporates one or more
IOAM options), a decapsulating node (which removes the IOAM options),
and optionally one or more transit nodes. The IOAM options are
encapsulated in one of the IOAM encapsulation types, e.g.,
\[[IOAM-NSH](#I-D.ietf-sfc-ioam-nsh){.cite .xref}\] or
\[[IOAM-IPV6-OPTIONS](#I-D.ietf-ippm-ioam-ipv6-options){.cite
.xref}\].[¶](#section-5-3){.pilcrow}

[]{#name-network-using-ioam}

::: {#NetworkFig}
::: {#section-5-4.1 .alignLeft .art-text .artwork}

    +--------+     +--------+     +--------+     +--------+     +--------+
    |        |     |  IOAM  |.....|  IOAM  |.....|  IOAM  |     |        |
    +--------+     +--------+     +--------+     +--------+     +--------+
    | L2/L3  |<===>| L2/L3  |<===>| L2/L3  |<===>| L2/L3  |<===>| L2/L3  |
    +--------+     +--------+     +--------+     +--------+     +--------+
      Source      Encapsulating    Transit      Decapsulating   Destination
                      Node           Node           Node

                   <------------  IOAM-Domain  ----------->
:::

[Figure 2](#figure-2){.selfRef}: [Network Using
IOAM](#name-network-using-ioam){.selfRef}
:::

This document focuses on three possible use cases of active measurement
using IOAM. These use cases are described using the example of [Figure
2](#NetworkFig){.auto .internal .xref}.[¶](#section-5-5){.pilcrow}

[]{.break}

Endpoint active measurement:
:   synthetic probe packets are sent between the source and destination,
    traversing the IOAM-Domain. Since the probe packets are sent between
    the endpoints, these packets are treated as data packets by the
    IOAM-Domain and do not require special treatment at the IOAM layer.
    Specifically, the Active flag is not used in this case and the IOAM
    layer does not need to be aware that an active measurement mechanism
    is used at a higher layer.[¶](#section-5-6.2){.pilcrow}
:   

IOAM active measurement using probe packets within the IOAM-Domain:
:   probe packets are generated and transmitted by the IOAM
    encapsulating node and are expected to be terminated by the
    decapsulating node. IOAM data related to probe packets may be
    exported by one or more nodes along its path by an exporting
    protocol that is outside the scope of this document (e.g.,
    \[[IOAM-RAWEXPORT](#I-D.spiegel-ippm-ioam-rawexport){.cite
    .xref}\]). Probe packets include a Trace Option that has its Active
    flag set, indicating that the decapsulating node must terminate
    them. The specification of these probe packets and the processing of
    these packets by the encapsulating and decapsulating nodes is
    outside the scope of this document.[¶](#section-5-6.4){.pilcrow}
:   

IOAM active measurement using replicated data packets:
:   probe packets are created by the encapsulating node by selecting
    some or all of the en route data packets and replicating them. A
    selected data packet and its (possibly truncated) copy is forwarded
    with one or more IOAM options while the original packet is forwarded
    normally without IOAM options. To the extent possible, the original
    data packet and its replica are forwarded through the same path. The
    replica includes a Trace Option that has its Active flag set,
    indicating that the decapsulating node should terminate it. The
    current document defines the role of the Active flag in allowing the
    decapsulating node to terminate the packet, but the replication
    functionality and the functionality of the decapsulating node in
    this context is outside the scope of this
    document.[¶](#section-5-6.6){.pilcrow}
:   

If the volume of traffic that incorporates the Active flag is large, it
may overload the network and the IOAM node(s) that process the active
measurement packet. Thus, the rate of the traffic that includes the
Active flag [SHOULD NOT]{.bcp14} exceed 1/N of the interface capacity on
any of the IOAM node\'s interfaces. Using N>100 is
[RECOMMENDED]{.bcp14}. Depending on the IOAM node\'s architecture
considerations, the rate of Active-enabled IOAM packets may be limited
to a lower number in order to avoid overloading the IOAM
node.[¶](#section-5-7){.pilcrow}
:::
:::

::: {#IANA}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

IANA has allocated the following bits in the \"IOAM Trace-Flags\"
registry as follows:[¶](#section-6-1){.pilcrow}

[]{.break}

Bit 1
:   \"Loopback\" (L-bit)[¶](#section-6-2.2){.pilcrow}
:   

Bit 2
:   \"Active\" (A-bit)[¶](#section-6-2.4){.pilcrow}
:   

This document is specified as the \"Reference\" in the registry for both
bits.[¶](#section-6-3){.pilcrow}

Note that bit 0 is the most significant bit in the \"IOAM Trace-Flags\"
registry. This bit was allocated by \[[RFC9197](#RFC9197){.cite .xref}\]
as the \'Overflow\' bit.[¶](#section-6-4){.pilcrow}
:::
:::

::: {#Performance}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Performance Considerations](#name-performance-considerations){.section-name .selfRef} {#name-performance-considerations}

Each of the flags that are defined in this document may have performance
implications. When using the loopback mechanism, a copy of the data
packet is sent back to the sender (thus, generating more traffic than
originally sent by the endpoints). Using active measurement with the
Active flag requires the use of synthetic (overhead)
traffic.[¶](#section-7-1){.pilcrow}

Each of the mechanisms that use the flags above has a cost in terms of
the network bandwidth and may potentially load the node that analyzes
the data. Therefore, it [MUST]{.bcp14} be possible to use each of the
mechanisms on a subset of the data traffic; an encapsulating node needs
to be able to set the Loopback and Active flags selectively in a way
that considers the effect on the network performance, as further
discussed in Sections [4.1.1](#SelectSec){.auto .internal .xref} and
[5](#UseCaseSec){.auto .internal .xref}.[¶](#section-7-2){.pilcrow}

Transit and decapsulating nodes that support loopback need to be able to
limit the looped-back packets (as discussed in [Section
4.2](#ReceiveSec){.auto .internal .xref}) so as to ensure that the
mechanisms are used at a rate that does not significantly affect the
network bandwidth and does not overload the source node in the case of
loopback.[¶](#section-7-3){.pilcrow}
:::
:::

::: {#Security}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

The security considerations of IOAM in general are discussed in
\[[RFC9197](#RFC9197){.cite .xref}\]. Specifically, an attacker may try
to use the functionality that is defined in this document to attack the
network.[¶](#section-8-1){.pilcrow}

IOAM is assumed to be deployed in a restricted administrative domain,
thus limiting the scope of the threats above and their effect. This is a
fundamental assumption with respect to the security aspects of IOAM as
further discussed in \[[RFC9197](#RFC9197){.cite .xref}\]. However, even
given this limited scope, security threats should still be considered
and mitigated. Specifically, an attacker may attempt to overload network
devices by injecting synthetic packets that include an IOAM Trace Option
with one or more of the flags defined in this document. Similarly, an
on-path attacker may maliciously set one or more of the flags of transit
packets.[¶](#section-8-2){.pilcrow}

[]{.break}

Loopback flag:
:   an attacker that sets this flag, either in synthetic packets or
    transit packets, can potentially cause an amplification since each
    device along the path creates a copy of the data packet and sends it
    back to the source. The attacker can potentially leverage the
    Loopback flag for a DDoS attack as multiple devices send looped-back
    copies of a packet to a single victim.[¶](#section-8-3.2){.pilcrow}
:   

Active flag:
:   the impact of synthetic packets with the Active flag is no worse
    than synthetic data packets in which the Active flag is not set. By
    setting the Active flag in en route packets, an attacker can prevent
    these packets from reaching their destination since the packet is
    terminated by the decapsulating device. However, note that an
    on-path attacker may achieve the same goal by changing the
    destination address of a packet. Another potential threat is
    amplification; if an attacker causes transit switches to replicate
    more packets than they are intended to replicate (either by setting
    the Active flag or by sending synthetic packets), then traffic is
    amplified, causing bandwidth degradation. As mentioned in [Section
    5](#UseCaseSec){.auto .internal .xref}, the specification of the
    replication mechanism is not within the scope of this document. A
    specification that defines the replication functionality should also
    address the security aspects of this
    mechanism.[¶](#section-8-3.4){.pilcrow}
:   

Some of the security threats that were discussed in this document may be
worse in a wide area network in which there are nested IOAM-Domains. For
example, if there are two nested IOAM-Domains that use loopback, then a
looped-back copy in the outer IOAM-Domain may be forwarded through
another (inner) IOAM-Domain and may be subject to loopback in that
(inner) IOAM-Domain, causing the amplification to be worse than in the
conventional case.[¶](#section-8-4){.pilcrow}

In order to mitigate the performance-related attacks described in
[Section 7](#Performance){.auto .internal .xref}, it should be possible
for IOAM-enabled devices to selectively apply the mechanisms that use
the flags defined in this document to a subset of the traffic and to
limit the performance of synthetically generated packets to a
configurable rate. Specifically, IOAM nodes should be able
to:[¶](#section-8-5){.pilcrow}

-   [Limit the rate of IOAM packets with the Loopback flag (IOAM
    encapsulating nodes) as discussed in [Section
    4.1.1](#SelectSec){.auto .internal
    .xref}.[¶](#section-8-6.1){.pilcrow}]{#section-8-6.1}
-   [Limit the rate of looped back packets (IOAM transit and
    decapsulating nodes) as discussed in [Section
    4.2](#ReceiveSec){.auto .internal
    .xref}.[¶](#section-8-6.2){.pilcrow}]{#section-8-6.2}
-   [Limit the rate of IOAM packets with the Active flag (IOAM
    encapsulating nodes) as discussed in [Section 5](#UseCaseSec){.auto
    .internal .xref}.[¶](#section-8-6.3){.pilcrow}]{#section-8-6.3}

As defined in [Section 4](#LoopbackSec){.auto .internal .xref}, transit
nodes that process a packet with the Loopback flag only add a single
data field and truncate any payload that follows the IOAM option(s),
thus significantly limiting the possible impact of an amplification
attack.[¶](#section-8-7){.pilcrow}
:::
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC9197\]
:   [Brockners, F., Ed.]{.refAuthor}, [Bhandari, S., Ed.]{.refAuthor},
    and [T. Mizrahi, Ed.]{.refAuthor}, [\"Data Fields for In Situ
    Operations, Administration, and Maintenance (IOAM)\"]{.refTitle},
    [RFC 9197]{.seriesInfo}, [DOI 10.17487/RFC9197]{.seriesInfo}, May
    2022, \<<https://www.rfc-editor.org/info/rfc9197>\>.
:   
:::

::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[IOAM-IPV6-OPTIONS\]
:   [Bhandari, S., Ed.]{.refAuthor} and [F. Brockners, Ed.]{.refAuthor},
    [\"In-situ OAM IPv6 Options\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-ietf-ippm-ioam-ipv6-options-09]{.seriesInfo}, 11 October 2022,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-ippm-ioam-ipv6-options-09>\>.
:   

\[IOAM-NSH\]
:   [Brockners, F., Ed.]{.refAuthor} and [S. Bhandari, Ed.]{.refAuthor},
    [\"Network Service Header (NSH) Encapsulation for In-situ OAM (IOAM)
    Data\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-ietf-sfc-ioam-nsh-11]{.seriesInfo}, 30
    September 2022,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-sfc-ioam-nsh-11>\>.
:   

\[IOAM-RAWEXPORT\]
:   [Spiegel, M.]{.refAuthor}, [Brockners, F.]{.refAuthor},
    [Bhandari, S.]{.refAuthor}, and [R. Sivakolundu]{.refAuthor},
    [\"In-situ OAM raw data export with IPFIX\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-spiegel-ippm-ioam-rawexport-06]{.seriesInfo}, 21 February
    2022,
    \<<https://datatracker.ietf.org/doc/html/draft-spiegel-ippm-ioam-rawexport-06>\>.
:   

\[RFC5475\]
:   [Zseby, T.]{.refAuthor}, [Molina, M.]{.refAuthor},
    [Duffield, N.]{.refAuthor}, [Niccolini, S.]{.refAuthor}, and [F.
    Raspall]{.refAuthor}, [\"Sampling and Filtering Techniques for IP
    Packet Selection\"]{.refTitle}, [RFC 5475]{.seriesInfo}, [DOI
    10.17487/RFC5475]{.seriesInfo}, March 2009,
    \<<https://www.rfc-editor.org/info/rfc5475>\>.
:   

\[RFC6291\]
:   [Andersson, L.]{.refAuthor}, [van Helvoort, H.]{.refAuthor},
    [Bonica, R.]{.refAuthor}, [Romascanu, D.]{.refAuthor}, and [S.
    Mansfield]{.refAuthor}, [\"Guidelines for the Use of the \"OAM\"
    Acronym in the IETF\"]{.refTitle}, [BCP 161]{.seriesInfo}, [RFC
    6291]{.seriesInfo}, [DOI 10.17487/RFC6291]{.seriesInfo}, June 2011,
    \<<https://www.rfc-editor.org/info/rfc6291>\>.
:   

\[RFC6724\]
:   [Thaler, D., Ed.]{.refAuthor}, [Draves, R.]{.refAuthor},
    [Matsumoto, A.]{.refAuthor}, and [T. Chown]{.refAuthor}, [\"Default
    Address Selection for Internet Protocol Version 6
    (IPv6)\"]{.refTitle}, [RFC 6724]{.seriesInfo}, [DOI
    10.17487/RFC6724]{.seriesInfo}, September 2012,
    \<<https://www.rfc-editor.org/info/rfc6724>\>.
:   

\[RFC7014\]
:   [D\'Antonio, S.]{.refAuthor}, [Zseby, T.]{.refAuthor},
    [Henke, C.]{.refAuthor}, and [L. Peluso]{.refAuthor}, [\"Flow
    Selection Techniques\"]{.refTitle}, [RFC 7014]{.seriesInfo}, [DOI
    10.17487/RFC7014]{.seriesInfo}, September 2013,
    \<<https://www.rfc-editor.org/info/rfc7014>\>.
:   

\[RFC7799\]
:   [Morton, A.]{.refAuthor}, [\"Active and Passive Metrics and Methods
    (with Hybrid Types In-Between)\"]{.refTitle}, [RFC
    7799]{.seriesInfo}, [DOI 10.17487/RFC7799]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7799>\>.
:   
:::
:::

::: {#Acknowledgments}
::: {#appendix-A .section}
## [Acknowledgments](#name-acknowledgments){.section-name .selfRef} {#name-acknowledgments}

The authors thank [Martin Duke]{.contact-name}, [Tommy
Pauly]{.contact-name}, [Donald Eastlake]{.contact-name}, [Paul
Kyzivat]{.contact-name}, [Bernard Aboba]{.contact-name}, [Greg
Mirsky]{.contact-name}, and other members of the IPPM working group for
many helpful comments.[¶](#appendix-A-1){.pilcrow}
:::
:::

::: {#appendix-B .section}
## [Contributors](#name-contributors){.section-name .selfRef} {#name-contributors}

The Editors would like to recognize the contributions of the following
individuals to this document.[¶](#appendix-B-1){.pilcrow}

::: {.left dir="auto"}
[Ramesh Sivakolundu]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[170 West Tasman Dr.]{.street-address}
:::

::: {.left dir="auto"}
[San Jose]{.locality}, [CA]{.region} [95134]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <sramesh@cisco.com>
:::

::: {.left dir="auto"}
[Carlos Pignataro]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[7200-11 Kit Creek Road]{.street-address}
:::

::: {.left dir="auto"}
[Research Triangle Park]{.locality}, [NC]{.region} [27709]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <cpignata@cisco.com>
:::

::: {.left dir="auto"}
[Aviv Kfir]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nvidia]{.org}
:::

::: email
Email: <avivk@nvidia.com>
:::

::: {.left dir="auto"}
[Jennifer Lemon]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Broadcom]{.org}
:::

::: {.left dir="auto"}
[270 Innovation Drive]{.street-address}
:::

::: {.left dir="auto"}
[San Jose]{.locality}, [CA]{.region} [95134]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <jennifer.lemon@broadcom.com>
:::
:::

::: {#authors-addresses}
::: {#appendix-C .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Tal Mizrahi]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Huawei]{.org}
:::

::: {.left dir="auto"}
[Israel]{.country-name}
:::

::: email
Email: <tal.mizrahi.phd@gmail.com>
:::

::: {.left dir="auto"}
[Frank Brockners]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[3rd Floor]{.extended-address}
:::

::: {.left dir="auto"}
[Hansaallee 249]{.street-address}
:::

::: {.left dir="auto"}
[40549]{.postal-code} [Duesseldorf]{.locality}
:::

::: {.left dir="auto"}
[Germany]{.country-name}
:::

::: email
Email: <fbrockne@cisco.com>
:::

::: {.left dir="auto"}
[Shwetha Bhandari]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Thoughtspot]{.org}
:::

::: {.left dir="auto"}
[3rd Floor\
Indiqube Orion\
Garden Layout\
HSR Layout]{.extended-address}
:::

::: {.left dir="auto"}
[24th Main Rd]{.street-address}
:::

::: {.left dir="auto"}
[Bangalore]{.locality} [560 102]{.postal-code}
:::

::: {.left dir="auto"}
[Karnataka]{.region}
:::

::: {.left dir="auto"}
[India]{.country-name}
:::

::: email
Email: <shwetha.bhandari@thoughtspot.com>
:::

::: {.left dir="auto"}
[Barak Gafni]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nvidia]{.org}
:::

::: {.left dir="auto"}
[Suite 100]{.extended-address}
:::

::: {.left dir="auto"}
[350 Oakmead Parkway]{.street-address}
:::

::: {.left dir="auto"}
[Sunnyvale]{.locality}, [CA]{.region} [94085]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <gbarak@nvidia.com>
:::

::: {.left dir="auto"}
[Mickey Spiegel]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Barefoot Networks, an Intel company]{.org}
:::

::: {.left dir="auto"}
[4750 Patrick Henry Drive]{.street-address}
:::

::: {.left dir="auto"}
[Santa Clara]{.locality}, [CA]{.region} [95054]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <mickey.spiegel@intel.com>
:::
:::
:::
