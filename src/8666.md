  RFC 8666           OSPFv3 Extensions for Segment Routing   December 2019
  ------------------ --------------------------------------- ---------------
  Psenak & Previdi   Standards Track                         \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8666](https://www.rfc-editor.org/rfc/rfc8666){.eref}

Category:
:   Standards Track

Published:
:   December 2019

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    P. Psenak, [Ed.]{.editor}
    :::

    ::: org
    Cisco Systems, Inc.
    :::
    :::

    ::: author
    ::: author-name
    S. Previdi, [Ed.]{.editor}
    :::

    ::: org
    Cisco Systems, Inc.
    :::
    :::
:::

# RFC 8666 {#rfcnum}

# OSPFv3 Extensions for Segment Routing {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

Segment Routing (SR) allows a flexible definition of end-to-end paths
within IGP topologies by encoding paths as sequences of topological
subpaths called \"segments\". These segments are advertised by the
link-state routing protocols (IS-IS and
OSPF).[¶](#section-abstract-1){.pilcrow}

This document describes the OSPFv3 extensions required for Segment
Routing with the MPLS data plane.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8666>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2019 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Terminology](#name-terminology){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Segment Routing
    Identifiers](#name-segment-routing-identifiers){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}

    -   ::: {#section-toc.1-1.3.2.1}
        [3.1](#section-3.1){.xref}.  [SID/Label
        Sub-TLV](#name-sid-label-sub-tlv){.xref}[¶](#section-toc.1-1.3.2.1.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Segment Routing
    Capabilities](#name-segment-routing-capabilitie){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [OSPFv3 Extended Prefix Range
    TLV](#name-ospfv3-extended-prefix-rang){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Prefix-SID
    Sub-TLV](#name-prefix-sid-sub-tlv){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Adjacency Segment Identifier
    (Adj-SID)](#name-adjacency-segment-identifie){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Adj-SID
        Sub-TLV](#name-adj-sid-sub-tlv){.xref}[¶](#section-toc.1-1.7.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [LAN Adj-SID
        Sub-TLV](#name-lan-adj-sid-sub-tlv){.xref}[¶](#section-toc.1-1.7.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Elements of
    Procedure](#name-elements-of-procedure){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Intra-area Segment Routing in
        OSPFv3](#name-intra-area-segment-routing-){.xref}[¶](#section-toc.1-1.8.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Inter-area Segment Routing in
        OSPFv3](#name-inter-area-segment-routing-){.xref}[¶](#section-toc.1-1.8.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.3}
        [8.3](#section-8.3){.xref}.  [Segment Routing for External
        Prefixes](#name-segment-routing-for-externa){.xref}[¶](#section-toc.1-1.8.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.4}
        [8.4](#section-8.4){.xref}.  [Advertisement of
        Adj-SID](#name-advertisement-of-adj-sid){.xref}[¶](#section-toc.1-1.8.2.4.1){.pilcrow}

        -   ::: {#section-toc.1-1.8.2.4.2.1}
            [8.4.1](#section-8.4.1){.xref}.  [Advertisement of Adj-SID
            on Point-to-Point
            Links](#name-advertisement-of-adj-sid-on){.xref}[¶](#section-toc.1-1.8.2.4.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.8.2.4.2.2}
            [8.4.2](#section-8.4.2){.xref}.  [Adjacency SID on Broadcast
            or NBMA
            Interfaces](#name-adjacency-sid-on-broadcast-){.xref}[¶](#section-toc.1-1.8.2.4.2.2.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [\"OSPFv3 Extended-LSA TLVs\"
        Registry](#name-ospfv3-extended-lsa-tlvs-re){.xref}[¶](#section-toc.1-1.9.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [\"OSPFv3 Extended-LSA Sub-TLVs\"
        Registry](#name-ospfv3-extended-lsa-sub-tlv){.xref}[¶](#section-toc.1-1.9.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [TLV/Sub-TLV Error
    Handling](#name-tlv-sub-tlv-error-handling){.xref} ([TLV/Sub-TLV
    Error
    Handling](#name-tlv-sub-tlv-error-handling){.xref})[¶](#section-toc.1-1.10.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.xref}. [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.12}
    [12](#section-12){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}

    -   ::: {#section-toc.1-1.12.2.1}
        [12.1](#section-12.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.12.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.12.2.2}
        [12.2](#section-12.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.12.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.13}
    [](#section-appendix.a){.xref}[Contributors](#name-contributors){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.14}
    [](#section-appendix.b){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.14.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

Segment Routing (SR) allows a flexible definition of end-to-end paths
within IGP topologies by encoding paths as sequences of topological
subpaths called \"segments\". These segments are advertised by the
link-state routing protocols (IS-IS and OSPF). Prefix segments represent
an ECMP-aware shortest path to a prefix (or a node) as per the state of
the IGP topology. Adjacency segments represent a hop over a specific
adjacency between two nodes in the IGP. A prefix segment is typically a
multi-hop path while an adjacency segment, in most cases, is a one-hop
path. SR\'s control plane can be applied to both IPv6 and MPLS data
planes, and it does not require any additional signaling (other than IGP
extensions). The IPv6 data plane is out of the scope of this
specification; the OSPFv3 extension for SR with the IPv6 data plane will
be specified in a separate document. When used in MPLS networks, SR
paths do not require any LDP or RSVP-TE signaling. However, SR can
interoperate in the presence of Label Switched Paths (LSPs) established
with RSVP or LDP.[¶](#section-1-1){.pilcrow}

This document describes the OSPFv3 extensions required for Segment
Routing with the MPLS data plane.[¶](#section-1-2){.pilcrow}

Segment Routing architecture is described in
\[[RFC8402](#RFC8402){.xref}\].[¶](#section-1-3){.pilcrow}

Segment Routing use cases are described in
\[[RFC7855](#RFC7855){.xref}\].[¶](#section-1-4){.pilcrow}
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

This section lists some of the terminology used in this
document:[¶](#section-2-1){.pilcrow}

ABR:
:   Area Border Router[¶](#section-2-2.2){.pilcrow}

Adj-SID:
:   Adjacency Segment Identifier[¶](#section-2-2.4){.pilcrow}

AS:
:   Autonomous System[¶](#section-2-2.6){.pilcrow}

ASBR:
:   Autonomous System Boundary Router[¶](#section-2-2.8){.pilcrow}

DR:
:   Designated Router[¶](#section-2-2.10){.pilcrow}

IS-IS:
:   Intermediate System to Intermediate
    System[¶](#section-2-2.12){.pilcrow}

LDP:
:   Label Distribution Protocol[¶](#section-2-2.14){.pilcrow}

LSP:
:   Label Switched Path[¶](#section-2-2.16){.pilcrow}

MPLS:
:   Multiprotocol Label Switching[¶](#section-2-2.18){.pilcrow}

OSPF:
:   Open Shortest Path First[¶](#section-2-2.20){.pilcrow}

SPF:
:   Shortest Path First[¶](#section-2-2.22){.pilcrow}

RSVP:
:   Resource Reservation Protocol[¶](#section-2-2.24){.pilcrow}

SID:
:   Segment Identifier[¶](#section-2-2.26){.pilcrow}

SR:
:   Segment Routing[¶](#section-2-2.28){.pilcrow}

SRGB:
:   Segment Routing Global Block[¶](#section-2-2.30){.pilcrow}

SRLB:
:   Segment Routing Local Block[¶](#section-2-2.32){.pilcrow}

SRMS:
:   Segment Routing Mapping Server[¶](#section-2-2.34){.pilcrow}

TLV:
:   Type Length Value[¶](#section-2-2.36){.pilcrow}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-3){.pilcrow}
:::

::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Segment Routing Identifiers](#name-segment-routing-identifiers){.section-name .selfRef} {#name-segment-routing-identifiers}

Segment Routing defines various types of Segment Identifiers (SIDs):
Prefix-SID, Adjacency SID, and LAN Adjacency
SID.[¶](#section-3-1){.pilcrow}

::: {#SIDLABEL}
::: {#section-3.1 .section}
### [3.1.](#section-3.1){.section-number .selfRef} [SID/Label Sub-TLV](#name-sid-label-sub-tlv){.section-name .selfRef} {#name-sid-label-sub-tlv}

The SID/Label sub-TLV appears in multiple TLVs or sub-TLVs defined later
in this document. It is used to advertise the SID or label associated
with a prefix or adjacency. The SID/Label sub-TLV has the following
format:[¶](#section-3.1-1){.pilcrow}

::: {#section-3.1-2 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                      SID/Label (variable)                     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-3.1-2){.pilcrow}
:::

where:[¶](#section-3.1-3){.pilcrow}

-   ::: {#section-3.1-4.1}

    Type:
    :   7[¶](#section-3.1-4.1.1.2){.pilcrow}

    Length:
    :   3 or 4 octets.[¶](#section-3.1-4.1.1.4){.pilcrow}

    SID/Label:
    :   If the length is set to 3, then the 20 rightmost bits represent
        a label. If the length is set to 4, then the value represents a
        32-bit SID.[¶](#section-3.1-4.1.1.6){.pilcrow}
    :::
:::
:::
:::

::: {#SRCAP}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Segment Routing Capabilities](#name-segment-routing-capabilitie){.section-name .selfRef} {#name-segment-routing-capabilitie}

Segment Routing requires some additional router capabilities to be
advertised to other routers in the area.[¶](#section-4-1){.pilcrow}

These SR capabilities are advertised in the OSPFv3 Router Information
Opaque LSA (defined in \[[RFC7770](#RFC7770){.xref}\]) and specified in
\[[RFC8665](#RFC8665){.xref}\].[¶](#section-4-2){.pilcrow}
:::
:::

::: {#PFXRANGE}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [OSPFv3 Extended Prefix Range TLV](#name-ospfv3-extended-prefix-rang){.section-name .selfRef} {#name-ospfv3-extended-prefix-rang}

In some cases, it is useful to advertise attributes for a range of
prefixes in a single advertisement. The SR Mapping Server, which is
described in \[[RFC8661](#RFC8661){.xref}\], is an example of where SIDs
for multiple prefixes can be advertised. To optimize such advertisement
in case of multiple prefixes from a contiguous address range, OSPFv3
Extended Prefix Range TLV is defined.[¶](#section-5-1){.pilcrow}

The OSPFv3 Extended Prefix Range TLV is a top-level TLV of the following
LSAs defined in
\[[RFC8362](#RFC8362){.xref}\]:[¶](#section-5-2){.pilcrow}

-   [E-Intra-Area-Prefix-LSA[¶](#section-5-3.1){.pilcrow}]{#section-5-3.1}
-   [E-Inter-Area-Prefix-LSA[¶](#section-5-3.2){.pilcrow}]{#section-5-3.2}
-   [E-AS-External-LSA[¶](#section-5-3.3){.pilcrow}]{#section-5-3.3}
-   [E-Type-7-LSA[¶](#section-5-3.4){.pilcrow}]{#section-5-3.4}

Multiple OSPFv3 Extended Prefix Range TLVs [MAY]{.bcp14} be advertised
in each LSA mentioned above. The OSPFv3 Extended Prefix Range TLV has
the following format:[¶](#section-5-4){.pilcrow}

::: {#section-5-5 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Prefix Length |       AF      |         Range Size            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |    Flags      |                 Reserved                      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                     Address Prefix (variable)                 |
    |                           ...                                 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                      Sub-TLVs (variable)                      |
    +-                                                             -+
    |                                                               |

[¶](#section-5-5){.pilcrow}
:::

where:[¶](#section-5-6){.pilcrow}

-   ::: {#section-5-7.1}

    Type:
    :   9[¶](#section-5-7.1.1.2){.pilcrow}

    Length:
    :   Variable, in octets, depending on the
        sub-TLVs.[¶](#section-5-7.1.1.4){.pilcrow}

    Prefix Length:
    :   Length of prefix in bits.[¶](#section-5-7.1.1.6){.pilcrow}

    AF:

    :   Address family for the
        prefix.[¶](#section-5-7.1.1.8.1){.pilcrow}

        AF:
        :   0 - IPv4 unicast[¶](#section-5-7.1.1.8.2.2){.pilcrow}

        AF:
        :   1 - IPv6 unicast[¶](#section-5-7.1.1.8.2.4){.pilcrow}

    Range Size:

    :   Represents the number of prefixes that are covered by the
        advertisement. The Range Size [MUST NOT]{.bcp14} exceed the
        number of prefixes that could be satisfied by the Prefix Length
        without including:[¶](#section-5-7.1.1.10.1){.pilcrow}

        -   [Addresses from the IPv4 multicast address range
            (224.0.0.0/3), if the AF is IPv4
            unicast.[¶](#section-5-7.1.1.10.2.1){.pilcrow}]{#section-5-7.1.1.10.2.1}
        -   [Addresses other than the IPv6 unicast addresses, if the AF
            is IPv6
            unicast.[¶](#section-5-7.1.1.10.2.2){.pilcrow}]{#section-5-7.1.1.10.2.2}

    Flags:
    :   Reserved. [MUST]{.bcp14} be zero when sent and are ignored when
        received.[¶](#section-5-7.1.1.12){.pilcrow}

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception.[¶](#section-5-7.1.1.14){.pilcrow}

    Address Prefix:

    :   -   [For the address family IPv4 unicast, the prefix itself is
            encoded as a 32-bit value. The default route is represented
            by a prefix of length
            0.[¶](#section-5-7.1.1.16.1.1){.pilcrow}]{#section-5-7.1.1.16.1.1}
        -   [For the address family IPv6 unicast, the prefix is encoded
            as an even multiple of 32-bit words and padded with zeroed
            bits as necessary. This encoding consumes ((PrefixLength +
            31) / 32) 32-bit
            words.[¶](#section-5-7.1.1.16.1.2){.pilcrow}]{#section-5-7.1.1.16.1.2}
        -   [Prefix encoding for other address families is beyond the
            scope of this specification. Prefix encoding for other
            address families can be defined in future Standards Track
            specifications from the IETF
            stream.[¶](#section-5-7.1.1.16.1.3){.pilcrow}]{#section-5-7.1.1.16.1.3}
    :::

The range represents the contiguous set of prefixes with the same prefix
length as specified by the Prefix Length field. The set starts with the
prefix that is specified by the Address Prefix field. The number of
prefixes in the range is equal to the Range
Size.[¶](#section-5-8){.pilcrow}

If the OSPFv3 Extended Prefix Range TLVs advertising the exact same
range appears in multiple LSAs of the same type, originated by the same
OSPFv3 router, the LSA with the numerically smallest Instance ID
[MUST]{.bcp14} be used, and subsequent instances of the OSPFv3 Extended
Prefix Range TLVs [MUST]{.bcp14} be ignored.[¶](#section-5-9){.pilcrow}
:::
:::

::: {#PREFIXSID}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Prefix-SID Sub-TLV](#name-prefix-sid-sub-tlv){.section-name .selfRef} {#name-prefix-sid-sub-tlv}

The Prefix-SID sub-TLV is a sub-TLV of the following OSPFv3 TLVs as
defined in \[[RFC8362](#RFC8362){.xref}\] and in [Section
5](#PFXRANGE){.xref}:[¶](#section-6-1){.pilcrow}

-   [Intra-Area Prefix TLV[¶](#section-6-2.1){.pilcrow}]{#section-6-2.1}
-   [Inter-Area Prefix TLV[¶](#section-6-2.2){.pilcrow}]{#section-6-2.2}
-   [External Prefix TLV[¶](#section-6-2.3){.pilcrow}]{#section-6-2.3}
-   [OSPFv3 Extended Prefix Range
    TLV[¶](#section-6-2.4){.pilcrow}]{#section-6-2.4}

It [MAY]{.bcp14} appear more than once in the parent TLV and has the
following format:[¶](#section-6-3){.pilcrow}

::: {#section-6-4 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |               Type            |            Length             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Flags     |  Algorithm    |           Reserved            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                       SID/Index/Label (variable)              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-6-4){.pilcrow}
:::

where:[¶](#section-6-5){.pilcrow}

-   ::: {#section-6-6.1}

    Type:
    :   4[¶](#section-6-6.1.1.2){.pilcrow}

    Length:
    :   7 or 8 octets, depending on the
        V-Flag.[¶](#section-6-6.1.1.4){.pilcrow}

    Flags:

    :   Single-octet field. The following flags are
        defined:[¶](#section-6-6.1.1.6.1){.pilcrow}

        ::: {#section-6-6.1.1.6.2 .artwork .art-text .alignLeft}
                            
              0  1  2  3  4  5  6  7 
            +--+--+--+--+--+--+--+--+
            |  |NP|M |E |V |L |  |  |
            +--+--+--+--+--+--+--+--+

        [¶](#section-6-6.1.1.6.2){.pilcrow}
        :::

        where:[¶](#section-6-6.1.1.6.3){.pilcrow}

        NP-Flag:
        :   No-PHP (Penultimate Hop Popping) Flag. If set, then the
            penultimate hop [MUST NOT]{.bcp14} pop the Prefix-SID before
            delivering packets to the node that advertised the
            Prefix-SID.[¶](#section-6-6.1.1.6.4.2){.pilcrow}

        M-Flag:
        :   Mapping Server Flag. If set, the SID was advertised by an SR
            Mapping Server as described in
            \[[RFC8661](#RFC8661){.xref}\].[¶](#section-6-6.1.1.6.4.4){.pilcrow}

        E-Flag:
        :   Explicit Null Flag. If set, any upstream neighbor of the
            Prefix-SID originator [MUST]{.bcp14} replace the Prefix-SID
            with the Explicit NULL label (0 for IPv4, 2 for IPv6) before
            forwarding the packet.[¶](#section-6-6.1.1.6.4.6){.pilcrow}

        V-Flag:
        :   Value/Index Flag. If set, then the Prefix-SID carries an
            absolute value. If not set, then the Prefix-SID carries an
            index.[¶](#section-6-6.1.1.6.4.8){.pilcrow}

        L-Flag:
        :   Local/Global Flag. If set, then the value/index carried by
            the Prefix-SID has local significance. If not set, then the
            value/index carried by this sub-TLV has global
            significance.[¶](#section-6-6.1.1.6.4.10){.pilcrow}

        Other bits:
        :   Reserved. These [MUST]{.bcp14} be zero when sent and are
            ignored when received.[¶](#section-6-6.1.1.6.4.12){.pilcrow}

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception.[¶](#section-6-6.1.1.8){.pilcrow}

    Algorithm:

    :   Single octet identifying the algorithm the Prefix-SID is
        associated with as defined in the IGP Algorithm Types registry
        \[[ALGOREG](#ALGOREG){.xref}\].[¶](#section-6-6.1.1.10.1){.pilcrow}

        A router receiving a Prefix-SID from a remote node and with an
        algorithm value that the remote node has not advertised in the
        SR-Algorithm TLV \[[RFC8665](#RFC8665){.xref}\] [MUST]{.bcp14}
        ignore the Prefix-SID
        sub-TLV.[¶](#section-6-6.1.1.10.2){.pilcrow}

    SID/Index/Label:

    :   According to the V-Flag and L-Flag, it
        contains:[¶](#section-6-6.1.1.12.1){.pilcrow}

        -   [V-Flag is set to 0 and L-Flag is set to 0: The
            SID/Index/Label field is a 4-octet index defining the offset
            in the SID/Label space advertised by this
            router.[¶](#section-6-6.1.1.12.2.1){.pilcrow}]{#section-6-6.1.1.12.2.1}
        -   [V-Flag is set to 1 and L-Flag is set to 1: The
            SID/Index/Label field is a 3-octet local label where the 20
            rightmost bits are used for encoding the label
            value.[¶](#section-6-6.1.1.12.2.2){.pilcrow}]{#section-6-6.1.1.12.2.2}
        -   [All other combinations of V-Flag and L-Flag are invalid and
            any SID Advertisement received with an invalid setting for
            V- and L-Flags [MUST]{.bcp14} be
            ignored.[¶](#section-6-6.1.1.12.2.3){.pilcrow}]{#section-6-6.1.1.12.2.3}
    :::

If an OSPFv3 router advertises multiple Prefix-SIDs for the same prefix,
topology, and algorithm, all of them [MUST]{.bcp14} be
ignored.[¶](#section-6-7){.pilcrow}

When calculating the outgoing label for the prefix, the router
[MUST]{.bcp14} take into account, as described below, the E-, NP-, and
M-Flags advertised by the next-hop router if that router advertised the
SID for the prefix. This [MUST]{.bcp14} be done regardless of whether
the next-hop router contributes to the best path to the
prefix.[¶](#section-6-8){.pilcrow}

The NP-Flag (No-PHP) [MUST]{.bcp14} be set and the E-Flag [MUST]{.bcp14}
be clear for Prefix-SIDs allocated to prefixes that are propagated
between areas by an ABR based on intra-area or inter-area reachability,
unless the advertised prefix is directly attached to such
ABR.[¶](#section-6-9){.pilcrow}

The NP-Flag (No-PHP) [MUST]{.bcp14} be set and the E-Flag [MUST]{.bcp14}
be clear for Prefix-SIDs allocated to redistributed prefixes, unless the
redistributed prefix is directly attached to the advertising
ASBR.[¶](#section-6-10){.pilcrow}

If the NP-Flag is not set, then:[¶](#section-6-11){.pilcrow}

-   [Any upstream neighbor of the Prefix-SID originator [MUST]{.bcp14}
    pop the Prefix-SID. This is equivalent to the penultimate
    hop-popping mechanism used in the MPLS data
    plane.[¶](#section-6-12.1){.pilcrow}]{#section-6-12.1}
-   [The received E-Flag is
    ignored.[¶](#section-6-12.2){.pilcrow}]{#section-6-12.2}

If the NP-Flag is set and the E-Flag is not set,
then:[¶](#section-6-13){.pilcrow}

-   [Any upstream neighbor of the Prefix-SID originator [MUST]{.bcp14}
    keep the Prefix-SID on top of the stack. This is useful when the
    originator of the Prefix-SID needs to stitch the incoming packet
    into a continuing MPLS LSP to the final destination. This could
    occur at an ABR (prefix propagation from one area to another) or at
    an ASBR (prefix propagation from one domain to
    another).[¶](#section-6-14.1){.pilcrow}]{#section-6-14.1}

If both the NP-Flag and E-Flag are set,
then:[¶](#section-6-15){.pilcrow}

-   [Any upstream neighbor of the Prefix-SID originator [MUST]{.bcp14}
    replace the Prefix-SID with an Explicit NULL label. This is useful,
    e.g., when the originator of the Prefix-SID is the final destination
    for the related prefix and the originator wishes to receive the
    packet with the original Traffic Class field
    \[[RFC5462](#RFC5462){.xref}\].[¶](#section-6-16.1){.pilcrow}]{#section-6-16.1}

When the M-Flag is set, the NP-Flag and the E-Flag [MUST]{.bcp14} be
ignored on reception.[¶](#section-6-17){.pilcrow}

As the Mapping Server does not specify the originator of a prefix
advertisement, it is not possible to determine PHP behavior solely based
on the Mapping Server Advertisement. However, PHP behavior
[SHOULD]{.bcp14} be done in the following
cases:[¶](#section-6-18){.pilcrow}

-   [The Prefix is intra-area type and the downstream neighbor is the
    originator of the
    prefix.[¶](#section-6-19.1){.pilcrow}]{#section-6-19.1}
-   [The Prefix is inter-area type and the downstream neighbor is an
    ABR, which is advertising prefix reachability and is setting the
    LA-bit in the Prefix Options as described in
    \[[RFC8362](#RFC8362){.xref}\].[¶](#section-6-19.2){.pilcrow}]{#section-6-19.2}
-   [The Prefix is external type and the downstream neighbor is an ASBR,
    which is advertising prefix reachability and is setting the LA-bit
    in the Prefix Options as described in
    \[[RFC8362](#RFC8362){.xref}\].[¶](#section-6-19.3){.pilcrow}]{#section-6-19.3}

When a Prefix-SID is advertised in the OSPFv3 Extended Prefix Range TLV,
then the value advertised in the Prefix-SID sub-TLV is interpreted as a
starting SID/Label value.[¶](#section-6-20){.pilcrow}

Example 1: If the following router addresses (loopback addresses) need
to be mapped into the corresponding Prefix-SID
indexes:[¶](#section-6-21){.pilcrow}

::: {#section-6-22 .artwork .art-text .alignLeft}
              Router-A: 2001:DB8::1/128, Prefix-SID: Index 1
              Router-B: 2001:DB8::2/128, Prefix-SID: Index 2
              Router-C: 2001:DB8::3/128, Prefix-SID: Index 3
              Router-D: 2001:DB8::4/128, Prefix-SID: Index 4

[¶](#section-6-22){.pilcrow}
:::

then the Address Prefix field in the OSPFv3 Extended Prefix Range TLV
would be set to 2001:DB8::1, the Prefix Length would be set to 128, the
Range Size would be set to 4, and the Index value in the Prefix-SID
sub-TLV would be set to 1.[¶](#section-6-23){.pilcrow}

Example 2: If the following prefixes need to be mapped into the
corresponding Prefix-SID indexes:[¶](#section-6-24){.pilcrow}

::: {#section-6-25 .artwork .art-text .alignLeft}
              2001:DB8:1::0/120,   Prefix-SID: Index 51
              2001:DB8:1::100/120, Prefix-SID: Index 52
              2001:DB8:1::200/120, Prefix-SID: Index 53
              2001:DB8:1::300/120, Prefix-SID: Index 54
              2001:DB8:1::400/120, Prefix-SID: Index 55
              2001:DB8:1::500/120, Prefix-SID: Index 56
              2001:DB8:1::600/120, Prefix-SID: Index 57

[¶](#section-6-25){.pilcrow}
:::

then the Prefix field in the OSPFv3 Extended Prefix Range TLV would be
set to 2001:DB8:1::0, the Prefix Length would be set to 120, the Range
Size would be set to 7, and the Index value in the Prefix-SID sub-TLV
would be set to 51.[¶](#section-6-26){.pilcrow}
:::
:::

::: {#ADJSID}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Adjacency Segment Identifier (Adj-SID)](#name-adjacency-segment-identifie){.section-name .selfRef} {#name-adjacency-segment-identifie}

An Adjacency Segment Identifier (Adj-SID) represents a router adjacency
in Segment Routing.[¶](#section-7-1){.pilcrow}

::: {#ADJSIDSUBTLV}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Adj-SID Sub-TLV](#name-adj-sid-sub-tlv){.section-name .selfRef} {#name-adj-sid-sub-tlv}

The Adj-SID sub-TLV is an optional sub-TLV of the Router-Link TLV as
defined in \[[RFC8362](#RFC8362){.xref}\]. It [MAY]{.bcp14} appear
multiple times in the Router-Link TLV. The Adj-SID sub-TLV has the
following format:[¶](#section-7.1-1){.pilcrow}

::: {#section-7.1-2 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |               Type            |              Length           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Flags         |     Weight    |             Reserved          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                   SID/Label/Index (variable)                  |
    +---------------------------------------------------------------+

[¶](#section-7.1-2){.pilcrow}
:::

where:[¶](#section-7.1-3){.pilcrow}

-   ::: {#section-7.1-4.1}

    Type:
    :   5[¶](#section-7.1-4.1.1.2){.pilcrow}

    Length:
    :   7 or 8 octets, depending on the
        V-Flag.[¶](#section-7.1-4.1.1.4){.pilcrow}

    Flags:

    :   Single-octet field containing the following
        flags:[¶](#section-7.1-4.1.1.6.1){.pilcrow}

        ::: {#section-7.1-4.1.1.6.2 .artwork .art-text .alignLeft}
                0 1 2 3 4 5 6 7 
               +-+-+-+-+-+-+-+-+
               |B|V|L|G|P|     |
               +-+-+-+-+-+-+-+-+

        [¶](#section-7.1-4.1.1.6.2){.pilcrow}
        :::

        where:[¶](#section-7.1-4.1.1.6.3){.pilcrow}

        B-Flag:
        :   Backup Flag. If set, the Adj-SID refers to an adjacency that
            is eligible for protection (e.g., using IP Fast Reroute
            (IPFRR) or MPLS-FRR (MPLS Fast Reroute)) as described in
            [Section
            3.4](https://www.rfc-editor.org/rfc/rfc8402#section-3.4){.relref}
            of
            \[[RFC8402](#RFC8402){.xref}\].[¶](#section-7.1-4.1.1.6.4.2){.pilcrow}

        V-Flag:
        :   Value/Index Flag. If set, then the Adj-SID carries an
            absolute value. If not set, then the Adj-SID carries an
            index.[¶](#section-7.1-4.1.1.6.4.4){.pilcrow}

        L-Flag:
        :   Local/Global Flag. If set, then the value/index carried by
            the Adj-SID has local significance. If not set, then the
            value/index carried by this sub-TLV has global
            significance.[¶](#section-7.1-4.1.1.6.4.6){.pilcrow}

        G-Flag:
        :   Group Flag. When set, the G-Flag indicates that the Adj-SID
            refers to a group of adjacencies (and therefore
            [MAY]{.bcp14} be assigned to other adjacencies as
            well).[¶](#section-7.1-4.1.1.6.4.8){.pilcrow}

        P-Flag.
        :   Persistent Flag. When set, the P-Flag indicates that the
            Adj-SID is persistently allocated, i.e., the Adj-SID value
            remains the same across router restart and/or interface
            flap.[¶](#section-7.1-4.1.1.6.4.10){.pilcrow}

        Other bits:
        :   Reserved. These [MUST]{.bcp14} be zero when sent and are
            ignored when
            received.[¶](#section-7.1-4.1.1.6.4.12){.pilcrow}

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception.[¶](#section-7.1-4.1.1.8){.pilcrow}

    Weight:
    :   Weight used for load-balancing purposes. The use of the weight
        is defined in
        \[[RFC8402](#RFC8402){.xref}\].[¶](#section-7.1-4.1.1.10){.pilcrow}

    SID/Index/Label:
    :   As described in [Section
        6](#PREFIXSID){.xref}.[¶](#section-7.1-4.1.1.12){.pilcrow}
    :::

An SR-capable router [MAY]{.bcp14} allocate an Adj-SID for each of its
adjacencies and set the B-Flag when the adjacency is eligible for
protection by an FRR mechanism (IP or MPLS) as described in
\[[RFC8402](#RFC8402){.xref}\].[¶](#section-7.1-5){.pilcrow}

An SR-capable router [MAY]{.bcp14} allocate more than one Adj-SID to an
adjacency.[¶](#section-7.1-6){.pilcrow}

An SR-capable router [MAY]{.bcp14} allocate the same Adj-SID to
different adjacencies.[¶](#section-7.1-7){.pilcrow}

When the P-Flag is not set, the Adj-SID [MAY]{.bcp14} be persistent.
When the P-Flag is set, the Adj-SID [MUST]{.bcp14} be
persistent.[¶](#section-7.1-8){.pilcrow}
:::
:::

::: {#LANADJSIDSUBTLV}
::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [LAN Adj-SID Sub-TLV](#name-lan-adj-sid-sub-tlv){.section-name .selfRef} {#name-lan-adj-sid-sub-tlv}

The LAN Adjacency SID is an optional sub-TLV of the Router-Link TLV. It
[MAY]{.bcp14} appear multiple times in the Router-Link TLV. It is used
to advertise a SID/Label for an adjacency to a non-DR router on a
broadcast, Non-Broadcast Multi-Access (NBMA), or hybrid
\[[RFC6845](#RFC6845){.xref}\] network.[¶](#section-7.2-1){.pilcrow}

::: {#section-7.2-2 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |            Length             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Flags     |     Weight    |            Reserved           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Neighbor ID                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    SID/Label/Index (variable)                 |
    +---------------------------------------------------------------+

[¶](#section-7.2-2){.pilcrow}
:::

where:[¶](#section-7.2-3){.pilcrow}

-   ::: {#section-7.2-4.1}

    Type:
    :   6[¶](#section-7.2-4.1.1.2){.pilcrow}

    Length:
    :   11 or 12 octets, depending on the
        V-Flag.[¶](#section-7.2-4.1.1.4){.pilcrow}

    Flags:
    :   Same as in [Section
        7.1](#ADJSIDSUBTLV){.xref}.[¶](#section-7.2-4.1.1.6){.pilcrow}

    Weight:
    :   Weight used for load-balancing purposes. The use of the weight
        is defined in
        \[[RFC8402](#RFC8402){.xref}\].[¶](#section-7.2-4.1.1.8){.pilcrow}

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception.[¶](#section-7.2-4.1.1.10){.pilcrow}

    Neighbor ID:
    :   The Router ID of the neighbor for which the LAN Adjacency SID is
        advertised.[¶](#section-7.2-4.1.1.12){.pilcrow}

    SID/Index/Label:

    :   As described in [Section
        6](#PREFIXSID){.xref}.[¶](#section-7.2-4.1.1.14.1){.pilcrow}

        When the P-Flag is not set, the LAN Adjacency SID [MAY]{.bcp14}
        be persistent. When the P-Flag is set, the LAN Adjacency SID
        [MUST]{.bcp14} be
        persistent.[¶](#section-7.2-4.1.1.14.2){.pilcrow}
    :::
:::
:::
:::
:::

::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Elements of Procedure](#name-elements-of-procedure){.section-name .selfRef} {#name-elements-of-procedure}

::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Intra-area Segment Routing in OSPFv3](#name-intra-area-segment-routing-){.section-name .selfRef} {#name-intra-area-segment-routing-}

An OSPFv3 router that supports Segment Routing [MAY]{.bcp14} advertise
Prefix- SIDs for any prefix to which it is advertising reachability
(e.g., a loopback IP address as described in [Section
6](#PREFIXSID){.xref}).[¶](#section-8.1-1){.pilcrow}

A Prefix-SID can also be advertised by SR Mapping Servers (as described
in \[[RFC8661](#RFC8661){.xref}\]). A Mapping Server advertises
Prefix-SIDs for remote prefixes that exist in the OSPFv3 routing domain.
Multiple Mapping Servers can advertise Prefix-SIDs for the same prefix,
in which case the same Prefix-SID [MUST]{.bcp14} be advertised by all of
them. The SR Mapping Server could use either area flooding scope or
autonomous system flooding scope when advertising Prefix-SIDs for
prefixes, based on the configuration of the SR Mapping Server. Depending
on the flooding scope used, the SR Mapping Server chooses the OSPFv3 LSA
type that will be used. If the area flooding scope is needed, an
E-Intra-Area-Prefix-LSA \[[RFC8362](#RFC8362){.xref}\] is used. If
autonomous system flooding scope is needed, an E-AS-External-LSA
\[[RFC8362](#RFC8362){.xref}\] is used.[¶](#section-8.1-2){.pilcrow}

When a Prefix-SID is advertised by the Mapping Server, which is
indicated by the M-Flag in the Prefix-SID sub-TLV ([Section
6](#PREFIXSID){.xref}), the route type as implied by the LSA type is
ignored and the Prefix-SID is bound to the corresponding prefix
independent of the route type.[¶](#section-8.1-3){.pilcrow}

Advertisement of the Prefix-SID by the Mapping Server using an
Inter-Area Prefix TLV, External-Prefix TLV, or Intra-Area-Prefix TLV
\[[RFC8362](#RFC8362){.xref}\] does not itself contribute to the prefix
reachability. The NU-bit \[[RFC5340](#RFC5340){.xref}\] [MUST]{.bcp14}
be set in the PrefixOptions field of the LSA, which is used by the
Mapping Server to advertise SID or SID Range, which prevents the
advertisement from contributing to prefix
reachability.[¶](#section-8.1-4){.pilcrow}

An SR Mapping Server [MUST]{.bcp14} use the OSPFv3 Extended Prefix Range
TLVs when advertising SIDs for prefixes. Prefixes of different route
types can be combined in a single OSPFv3 Extended Prefix Range TLV
advertised by an SR Mapping Server.[¶](#section-8.1-5){.pilcrow}

Area-scoped OSPFv3 Extended Prefix Range TLVs are propagated between
areas, similar to propagation of prefixes between areas. Same rules that
are used for propagating prefixes between areas
\[[RFC5340](#RFC5340){.xref}\] are used for the propagation of the
prefix ranges.[¶](#section-8.1-6){.pilcrow}
:::

::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Inter-area Segment Routing in OSPFv3](#name-inter-area-segment-routing-){.section-name .selfRef} {#name-inter-area-segment-routing-}

In order to support SR in a multiarea environment, OSPFv3 [MUST]{.bcp14}
propagate Prefix-SID information between areas. The following procedure
is used to propagate Prefix-SIDs between
areas.[¶](#section-8.2-1){.pilcrow}

When an OSPFv3 ABR advertises an Inter-Area-Prefix-LSA from an
intra-area prefix to all its connected areas, it will also include the
Prefix-SID sub-TLV as described in [Section 6](#PREFIXSID){.xref}. The
Prefix-SID value will be set as follows:[¶](#section-8.2-2){.pilcrow}

-   [The ABR will look at its best path to the prefix in the source area
    and find the advertising router associated with the best path to
    that prefix.[¶](#section-8.2-3.1){.pilcrow}]{#section-8.2-3.1}
-   [The ABR will then determine if this router advertised a Prefix-SID
    for the prefix and use it when advertising the Prefix-SID to other
    connected areas.[¶](#section-8.2-3.2){.pilcrow}]{#section-8.2-3.2}
-   [If no Prefix-SID was advertised for the prefix in the source area
    by the router that contributes to the best path to the prefix, the
    originating ABR will use the Prefix-SID advertised by any other
    router when propagating the Prefix-SID for the prefix to other
    areas.[¶](#section-8.2-3.3){.pilcrow}]{#section-8.2-3.3}

When an OSPFv3 ABR advertises an Inter-Area-Prefix-LSA from an
inter-area route to all its connected areas, it will also include the
Prefix-SID sub-TLV as described in [Section 6](#PREFIXSID){.xref}. The
Prefix-SID value will be set as follows:[¶](#section-8.2-4){.pilcrow}

-   [The ABR will look at its best path to the prefix in the backbone
    area and find the advertising router associated with the best path
    to that prefix.[¶](#section-8.2-5.1){.pilcrow}]{#section-8.2-5.1}
-   [The ABR will then determine if this router advertised a Prefix-SID
    for the prefix and use it when advertising the Prefix-SID to other
    connected areas.[¶](#section-8.2-5.2){.pilcrow}]{#section-8.2-5.2}
-   [If no Prefix-SID was advertised for the prefix in the backbone area
    by the ABR that contributes to the best path to the prefix, the
    originating ABR will use the Prefix-SID advertised by any other
    router when propagating the Prefix-SID for the prefix to other
    areas.[¶](#section-8.2-5.3){.pilcrow}]{#section-8.2-5.3}
:::

::: {#section-8.3 .section}
### [8.3.](#section-8.3){.section-number .selfRef} [Segment Routing for External Prefixes](#name-segment-routing-for-externa){.section-name .selfRef} {#name-segment-routing-for-externa}

AS-External-LSAs are flooded domain wide. When an ASBR, which supports
SR, originates an E-AS-External-LSA, it [SHOULD]{.bcp14} also include a
Prefix-SID sub-TLV as described in [Section 6](#PREFIXSID){.xref}. The
Prefix-SID value will be set to the SID that has been reserved for that
prefix.[¶](#section-8.3-1){.pilcrow}

When a Not-So-Stubby Area (NSSA) \[[RFC3101](#RFC3101){.xref}\] ABR
translates an E-NSSA-LSA into an E-AS-External-LSA, it [SHOULD]{.bcp14}
also advertise the Prefix-SID for the prefix. The NSSA ABR determines
its best path to the prefix advertised in the translated E-NSSA-LSA and
finds the advertising router associated with that path. If the
advertising router has advertised a Prefix-SID for the prefix, then the
NSSA ABR uses it when advertising the Prefix-SID for the
E-AS-External-LSA. Otherwise, the Prefix-SID advertised by any other
router will be used.[¶](#section-8.3-2){.pilcrow}
:::

::: {#section-8.4 .section}
### [8.4.](#section-8.4){.section-number .selfRef} [Advertisement of Adj-SID](#name-advertisement-of-adj-sid){.section-name .selfRef} {#name-advertisement-of-adj-sid}

The Adjacency Segment Routing Identifier (Adj-SID) is advertised using
the Adj-SID sub-TLV as described in [Section
7](#ADJSID){.xref}.[¶](#section-8.4-1){.pilcrow}

::: {#section-8.4.1 .section}
#### [8.4.1.](#section-8.4.1){.section-number .selfRef} [Advertisement of Adj-SID on Point-to-Point Links](#name-advertisement-of-adj-sid-on){.section-name .selfRef} {#name-advertisement-of-adj-sid-on}

An Adj-SID [MAY]{.bcp14} be advertised for any adjacency on a
point-to-point (P2P) link that is in neighbor state 2-Way or higher. If
the adjacency on a P2P link transitions from the FULL state, then the
Adj-SID for that adjacency [MAY]{.bcp14} be removed from the area. If
the adjacency transitions to a state lower than 2-Way, then the Adj-SID
Advertisement [MUST]{.bcp14} be withdrawn from the
area.[¶](#section-8.4.1-1){.pilcrow}
:::

::: {#section-8.4.2 .section}
#### [8.4.2.](#section-8.4.2){.section-number .selfRef} [Adjacency SID on Broadcast or NBMA Interfaces](#name-adjacency-sid-on-broadcast-){.section-name .selfRef} {#name-adjacency-sid-on-broadcast-}

Broadcast, NBMA, or hybrid \[[RFC6845](#RFC6845){.xref}\] networks in
OSPFv3 are represented by a star topology where the DR is the central
point to which all other routers on the broadcast, NBMA, or hybrid
network connect. As a result, routers on the broadcast, NBMA, or hybrid
network advertise only their adjacency to the DR. Routers that do not
act as DR do not form or advertise adjacencies with each other. They do,
however, maintain 2-Way adjacency state with each other and are directly
reachable.[¶](#section-8.4.2-1){.pilcrow}

When Segment Routing is used, each router on the broadcast, NBMA, or
hybrid network [MAY]{.bcp14} advertise the Adj-SID for its adjacency to
the DR using the Adj-SID sub-TLV as described in [Section
7.1](#ADJSIDSUBTLV){.xref}.[¶](#section-8.4.2-2){.pilcrow}

SR-capable routers [MAY]{.bcp14} also advertise a LAN Adjacency SID for
other neighbors (e.g., Backup Designated Router (BDR), DR-OTHER, etc.)
on the broadcast, NBMA, or hybrid network using the LAN Adj-SID sub-TLV
as described in [Section
7.2](#LANADJSIDSUBTLV){.xref}.[¶](#section-8.4.2-3){.pilcrow}
:::
:::
:::

::: {#IANA}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This specification updates two existing OSPFv3
registries.[¶](#section-9-1){.pilcrow}

::: {#EPLTLVREG}
::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [\"OSPFv3 Extended-LSA TLVs\" Registry](#name-ospfv3-extended-lsa-tlvs-re){.section-name .selfRef} {#name-ospfv3-extended-lsa-tlvs-re}

The following values have been allocated:[¶](#section-9.1-1){.pilcrow}

[]{#name-ospfv3-extended-lsa-tlvs}

::: {#IANA1}
  Value   Description                        Reference
  ------- ---------------------------------- ---------------
  9       OSPFv3 Extended Prefix Range TLV   This document

  : [Table 1](#table-1){.selfRef}: [OSPFv3 Extended-LSA
  TLVs](#name-ospfv3-extended-lsa-tlvs){.selfRef}
:::
:::
:::

::: {#EXTLSAREG}
::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [\"OSPFv3 Extended-LSA Sub-TLVs\" Registry](#name-ospfv3-extended-lsa-sub-tlv){.section-name .selfRef} {#name-ospfv3-extended-lsa-sub-tlv}

The following values have been allocated:[¶](#section-9.2-1){.pilcrow}

[]{#name-ospfv3-extended-lsa-sub-tlvs}

::: {#IANA2}
  Value   Description           Reference
  ------- --------------------- ---------------
  4       Prefix-SID sub-TLV    This document
  5       Adj-SID sub-TLV       This document
  6       LAN Adj-SID sub-TLV   This document
  7       SID/Label sub-TLV     This document

  : [Table 2](#table-2){.selfRef}: [OSPFv3 Extended-LSA
  Sub-TLVs](#name-ospfv3-extended-lsa-sub-tlvs){.selfRef}
:::
:::
:::
:::
:::

::: {#Error-handling}
::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [TLV/Sub-TLV Error Handling](#name-tlv-sub-tlv-error-handling){.section-name .selfRef} {#name-tlv-sub-tlv-error-handling}

For any new TLVs/sub-TLVs defined in this document, if the length is
invalid, the LSA in which it is advertised is considered malformed and
[MUST]{.bcp14} be ignored. Errors [SHOULD]{.bcp14} be logged subject to
rate limiting.[¶](#section-10-1){.pilcrow}
:::
:::

::: {#Security}
::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

With the OSPFv3 Segment Routing extensions defined herein, OSPFv3 will
now program the MPLS data plane \[[RFC3031](#RFC3031){.xref}\].
Previously, LDP \[[RFC5036](#RFC5036){.xref}\] or another label
distribution mechanism was required to advertise MPLS labels and program
the MPLS data plane.[¶](#section-11-1){.pilcrow}

In general, the same types of attacks that can be carried out on the IP
control plane can be carried out on the MPLS control plane resulting in
traffic being misrouted in the respective data planes. However, the
latter can be more difficult to detect and
isolate.[¶](#section-11-2){.pilcrow}

Existing security extensions, as described in
\[[RFC5340](#RFC5340){.xref}\] and \[[RFC8362](#RFC8362){.xref}\], apply
to these Segment Routing extensions. While OSPFv3 is under a single
administrative domain, there can be deployments where potential
attackers have access to one or more networks in the OSPFv3 routing
domain. In these deployments, stronger authentication mechanisms, such
as those specified in \[[RFC4552](#RFC4552){.xref}\] or
\[[RFC7166](#RFC7166){.xref}\], [SHOULD]{.bcp14} be
used.[¶](#section-11-3){.pilcrow}

Implementations [MUST]{.bcp14} ensure that malformed TLVs and sub-TLVs
defined in this document are detected and that they do not provide a
vulnerability for attackers to crash the OSPFv3 router or routing
process. Reception of a malformed TLV or sub-TLV [SHOULD]{.bcp14} be
counted and/or logged for further analysis. Logging of malformed TLVs
and sub-TLVs [SHOULD]{.bcp14} be rate limited to prevent a
Denial-of-Service (DoS) attack (distributed or otherwise) from
overloading the OSPFv3 control plane.[¶](#section-11-4){.pilcrow}
:::
:::

::: {#section-12 .section}
## [12.](#section-12){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-12.1 .section}
### [12.1.](#section-12.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[ALGOREG\]
:   [IANA]{.refAuthor}, [\"Interior Gateway Protocol (IGP)
    Parameters\"]{.refTitle},
    \<<https://www.iana.org/assignments/igp-parameters>\>.

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.

\[RFC3031\]
:   [Rosen, E.]{.refAuthor}[, Viswanathan, A.]{.refAuthor}[, and R.
    Callon]{.refAuthor}, [\"Multiprotocol Label Switching
    Architecture\"]{.refTitle}, [RFC 3031]{.seriesInfo}, [DOI
    10.17487/RFC3031]{.seriesInfo}, January 2001,
    \<<https://www.rfc-editor.org/info/rfc3031>\>.

\[RFC3101\]
:   [Murphy, P.]{.refAuthor}, [\"The OSPF Not-So-Stubby Area (NSSA)
    Option\"]{.refTitle}, [RFC 3101]{.seriesInfo}, [DOI
    10.17487/RFC3101]{.seriesInfo}, January 2003,
    \<<https://www.rfc-editor.org/info/rfc3101>\>.

\[RFC5036\]
:   [Andersson, L., Ed.]{.refAuthor}[, Minei, I., Ed.]{.refAuthor}[,
    and B. Thomas, Ed.]{.refAuthor}, [\"LDP Specification\"]{.refTitle},
    [RFC 5036]{.seriesInfo}, [DOI 10.17487/RFC5036]{.seriesInfo},
    October 2007, \<<https://www.rfc-editor.org/info/rfc5036>\>.

\[RFC5340\]
:   [Coltun, R.]{.refAuthor}[, Ferguson, D.]{.refAuthor}[,
    Moy, J.]{.refAuthor}[, and A. Lindem]{.refAuthor}, [\"OSPF for
    IPv6\"]{.refTitle}, [RFC 5340]{.seriesInfo}, [DOI
    10.17487/RFC5340]{.seriesInfo}, July 2008,
    \<<https://www.rfc-editor.org/info/rfc5340>\>.

\[RFC5462\]
:   [Andersson, L.]{.refAuthor}[ and R. Asati]{.refAuthor},
    [\"Multiprotocol Label Switching (MPLS) Label Stack Entry: \"EXP\"
    Field Renamed to \"Traffic Class\" Field\"]{.refTitle}, [RFC
    5462]{.seriesInfo}, [DOI 10.17487/RFC5462]{.seriesInfo}, February
    2009, \<<https://www.rfc-editor.org/info/rfc5462>\>.

\[RFC6845\]
:   [Sheth, N.]{.refAuthor}[, Wang, L.]{.refAuthor}[, and J.
    Zhang]{.refAuthor}, [\"OSPF Hybrid Broadcast and Point-to-Multipoint
    Interface Type\"]{.refTitle}, [RFC 6845]{.seriesInfo}, [DOI
    10.17487/RFC6845]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6845>\>.

\[RFC7770\]
:   [Lindem, A., Ed.]{.refAuthor}[, Shen, N.]{.refAuthor}[, Vasseur,
    JP.]{.refAuthor}[, Aggarwal, R.]{.refAuthor}[, and S.
    Shaffer]{.refAuthor}, [\"Extensions to OSPF for Advertising Optional
    Router Capabilities\"]{.refTitle}, [RFC 7770]{.seriesInfo}, [DOI
    10.17487/RFC7770]{.seriesInfo}, February 2016,
    \<<https://www.rfc-editor.org/info/rfc7770>\>.

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.

\[RFC8362\]
:   [Lindem, A.]{.refAuthor}[, Roy, A.]{.refAuthor}[,
    Goethals, D.]{.refAuthor}[, Reddy Vallem, V.]{.refAuthor}[, and F.
    Baker]{.refAuthor}, [\"OSPFv3 Link State Advertisement (LSA)
    Extensibility\"]{.refTitle}, [RFC 8362]{.seriesInfo}, [DOI
    10.17487/RFC8362]{.seriesInfo}, April 2018,
    \<<https://www.rfc-editor.org/info/rfc8362>\>.

\[RFC8402\]
:   [Filsfils, C., Ed.]{.refAuthor}[, Previdi, S., Ed.]{.refAuthor}[,
    Ginsberg, L.]{.refAuthor}[, Decraene, B.]{.refAuthor}[,
    Litkowski, S.]{.refAuthor}[, and R. Shakir]{.refAuthor}, [\"Segment
    Routing Architecture\"]{.refTitle}, [RFC 8402]{.seriesInfo}, [DOI
    10.17487/RFC8402]{.seriesInfo}, July 2018,
    \<<https://www.rfc-editor.org/info/rfc8402>\>.

\[RFC8661\]
:   [Bashandy, A., Ed.]{.refAuthor}[, Filsfils, C., Ed.]{.refAuthor}[,
    Previdi, S.]{.refAuthor}[, Decraene, B.]{.refAuthor}[, and S.
    Litkowski]{.refAuthor}, [\"Segment Routing MPLS Interworking with
    LDP\"]{.refTitle}, [RFC 8661]{.seriesInfo}, [DOI
    10.17487/RFC8661]{.seriesInfo}, December 2019,
    \<<https://www.rfc-editor.org/info/rfc8661>\>.

\[RFC8665\]
:   [Psenak, P., Ed.]{.refAuthor}[, Previdi, S., Ed.]{.refAuthor}[,
    Filfils, C.]{.refAuthor}[, Gredler, H.]{.refAuthor}[,
    Shakir, R.]{.refAuthor}[, Henderickx, W.]{.refAuthor}[, and J.
    Tantsura]{.refAuthor}, [\"OSPF Extensions for Segment
    Routing\"]{.refTitle}, [RFC 8665]{.seriesInfo}, [DOI
    10.17487/RFC8665]{.seriesInfo}, December 2019,
    \<<https://www.rfc-editor.org/info/rfc8665>\>.
:::

::: {#section-12.2 .section}
### [12.2.](#section-12.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC4552\]
:   [Gupta, M.]{.refAuthor}[ and N. Melam]{.refAuthor},
    [\"Authentication/Confidentiality for OSPFv3\"]{.refTitle}, [RFC
    4552]{.seriesInfo}, [DOI 10.17487/RFC4552]{.seriesInfo}, June 2006,
    \<<https://www.rfc-editor.org/info/rfc4552>\>.

\[RFC7166\]
:   [Bhatia, M.]{.refAuthor}[, Manral, V.]{.refAuthor}[, and A.
    Lindem]{.refAuthor}, [\"Supporting Authentication Trailer for
    OSPFv3\"]{.refTitle}, [RFC 7166]{.seriesInfo}, [DOI
    10.17487/RFC7166]{.seriesInfo}, March 2014,
    \<<https://www.rfc-editor.org/info/rfc7166>\>.

\[RFC7855\]
:   [Previdi, S., Ed.]{.refAuthor}[, Filsfils, C., Ed.]{.refAuthor}[,
    Decraene, B.]{.refAuthor}[, Litkowski, S.]{.refAuthor}[,
    Horneffer, M.]{.refAuthor}[, and R. Shakir]{.refAuthor}, [\"Source
    Packet Routing in Networking (SPRING) Problem Statement and
    Requirements\"]{.refTitle}, [RFC 7855]{.seriesInfo}, [DOI
    10.17487/RFC7855]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7855>\>.
:::
:::

::: {#Acknowledgements}
::: {#section-appendix.a .section}
## [Contributors](#name-contributors){.section-name .selfRef} {#name-contributors}

The following people gave a substantial contribution to the content of
this document and should be considered
coauthors:[¶](#section-appendix.a-1){.pilcrow}

::: {#section-appendix.a-2 .artwork .art-text .alignLeft}
        
       Clarence Filsfils
       Cisco Systems, Inc.
       Brussels
       Belgium
       
       Email: cfilsfil@cisco.com

[¶](#section-appendix.a-2){.pilcrow}
:::

::: {#section-appendix.a-3 .artwork .art-text .alignLeft}
      
       Hannes Gredler
       RtBrick Inc.
       Austria

       Email: hannes@rtbrick.com

[¶](#section-appendix.a-3){.pilcrow}
:::

::: {#section-appendix.a-4 .artwork .art-text .alignLeft}
         
       Rob Shakir
       Google, Inc.
       United States of America 

       Email: robjs@google.com

[¶](#section-appendix.a-4){.pilcrow}
:::

::: {#section-appendix.a-5 .artwork .art-text .alignLeft}
         
       Wim Henderickx
       Nokia
       Belgium

       Email: wim.henderickx@nokia.com

[¶](#section-appendix.a-5){.pilcrow}
:::

::: {#section-appendix.a-6 .artwork .art-text .alignLeft}
         
       Jeff Tantsura
       Apstra, Inc.
       United States of America

       Email: jefftant.ietf@gmail.com

[¶](#section-appendix.a-6){.pilcrow}
:::

Thanks to Acee Lindem for his substantial contribution to the content of
this document.[¶](#section-appendix.a-7){.pilcrow}

We would like to thank Anton Smirnov for his contribution as
well.[¶](#section-appendix.a-8){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#section-appendix.b .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Peter Psenak ([editor]{.role})]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[Eurovea Centre, Central 3, Pribinova Street 10]{.street-address}
:::

::: {.left dir="auto"}
[81109]{.postal-code} [Bratislava]{.locality}
:::

::: {.left dir="auto"}
[Slovakia]{.country-name}
:::

::: email
Email: <ppsenak@cisco.com>
:::

::: {.left dir="auto"}
[Stefano Previdi ([editor]{.role})]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: email
Email: <stefano@previdi.net>
:::
:::
:::
