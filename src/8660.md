  RFC 8660           Segment Routing with the MPLS Data Plane   December 2019
  ------------------ ------------------------------------------ ---------------
  Bashandy, et al.   Standards Track                            \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8660](https://www.rfc-editor.org/rfc/rfc8660){.eref}

Category:
:   Standards Track

Published:
:   December 2019

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    A. Bashandy, [Ed.]{.editor}
    :::

    ::: org
    Arrcus
    :::
    :::

    ::: author
    ::: author-name
    C. Filsfils, [Ed.]{.editor}
    :::

    ::: org
    Cisco Systems, Inc.
    :::
    :::

    ::: author
    ::: author-name
    S. Previdi
    :::

    ::: org
    Cisco Systems, Inc.
    :::
    :::

    ::: author
    ::: author-name
    B. Decraene
    :::

    ::: org
    Orange
    :::
    :::

    ::: author
    ::: author-name
    S. Litkowski
    :::

    ::: org
    Orange
    :::
    :::

    ::: author
    ::: author-name
    R. Shakir
    :::

    ::: org
    Google
    :::
    :::
:::

# RFC 8660 {#rfcnum}

# Segment Routing with the MPLS Data Plane {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

Segment Routing (SR) leverages the source-routing paradigm. A node
steers a packet through a controlled set of instructions, called
segments, by prepending the packet with an SR header. In the MPLS data
plane, the SR header is instantiated through a label stack. This
document specifies the forwarding behavior to allow instantiating SR
over the MPLS data plane (SR-MPLS).[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8660>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2019 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Requirements
        Language](#name-requirements-language){.xref}[¶](#section-toc.1-1.1.2.1.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [MPLS Instantiation of Segment
    Routing](#name-mpls-instantiation-of-segme){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}

    -   ::: {#section-toc.1-1.2.2.1}
        [2.1](#section-2.1){.xref}.  [Multiple Forwarding Behaviors for
        the Same
        Prefix](#name-multiple-forwarding-behavio){.xref}[¶](#section-toc.1-1.2.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.2.2.2}
        [2.2](#section-2.2){.xref}.  [SID Representation in the MPLS
        Forwarding
        Plane](#name-sid-representation-in-the-m){.xref}[¶](#section-toc.1-1.2.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.2.2.3}
        [2.3](#section-2.3){.xref}.  [Segment Routing Global Block and
        Local
        Block](#name-segment-routing-global-bloc){.xref}[¶](#section-toc.1-1.2.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.2.2.4}
        [2.4](#section-2.4){.xref}.  [Mapping a SID Index to an MPLS
        Label](#name-mapping-a-sid-index-to-an-m){.xref}[¶](#section-toc.1-1.2.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.2.2.5}
        [2.5](#section-2.5){.xref}.  [Incoming Label
        Collision](#name-incoming-label-collision){.xref}[¶](#section-toc.1-1.2.2.5.1){.pilcrow}

        -   ::: {#section-toc.1-1.2.2.5.2.1}
            [2.5.1](#section-2.5.1){.xref}.  [Tiebreaking
            Rules](#name-tiebreaking-rules){.xref}[¶](#section-toc.1-1.2.2.5.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.2.2.5.2.2}
            [2.5.2](#section-2.5.2){.xref}.  [Redistribution between
            Routing Protocol
            Instances](#name-redistribution-between-rout){.xref}[¶](#section-toc.1-1.2.2.5.2.2.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.2.2.6}
        [2.6](#section-2.6){.xref}.  [Effect of Incoming Label Collision
        on Outgoing Label
        Programming](#name-effect-of-incoming-label-co){.xref}[¶](#section-toc.1-1.2.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.2.2.7}
        [2.7](#section-2.7){.xref}.  [PUSH, CONTINUE, and
        NEXT](#name-push-continue-and-next){.xref}[¶](#section-toc.1-1.2.2.7.1){.pilcrow}

        -   ::: {#section-toc.1-1.2.2.7.2.1}
            [2.7.1](#section-2.7.1){.xref}.  [PUSH](#name-push){.xref}[¶](#section-toc.1-1.2.2.7.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.2.2.7.2.2}
            [2.7.2](#section-2.7.2){.xref}.  [CONTINUE](#name-continue){.xref}[¶](#section-toc.1-1.2.2.7.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.2.2.7.2.3}
            [2.7.3](#section-2.7.3){.xref}.  [NEXT](#name-next){.xref}[¶](#section-toc.1-1.2.2.7.2.3.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.2.2.8}
        [2.8](#section-2.8){.xref}.  [MPLS Label Downloaded to the FIB
        for Global and Local
        SIDs](#name-mpls-label-downloaded-to-th){.xref}[¶](#section-toc.1-1.2.2.8.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.2.2.9}
        [2.9](#section-2.9){.xref}.  [Active
        Segment](#name-active-segment){.xref}[¶](#section-toc.1-1.2.2.9.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.2.2.10}
        [2.10](#section-2.10){.xref}. [Forwarding Behavior for Global
        SIDs](#name-forwarding-behavior-for-glo){.xref}[¶](#section-toc.1-1.2.2.10.1){.pilcrow}

        -   ::: {#section-toc.1-1.2.2.10.2.1}
            [2.10.1](#section-2.10.1){.xref}.  [Forwarding for PUSH and
            CONTINUE of Global
            SIDs](#name-forwarding-for-push-and-con){.xref}[¶](#section-toc.1-1.2.2.10.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.2.2.10.2.2}
            [2.10.2](#section-2.10.2){.xref}.  [Forwarding for the NEXT
            Operation for Global
            SIDs](#name-forwarding-for-the-next-ope){.xref}[¶](#section-toc.1-1.2.2.10.2.2.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.2.2.11}
        [2.11](#section-2.11){.xref}. [Forwarding Behavior for Local
        SIDs](#name-forwarding-behavior-for-loc){.xref}[¶](#section-toc.1-1.2.2.11.1){.pilcrow}

        -   ::: {#section-toc.1-1.2.2.11.2.1}
            [2.11.1](#section-2.11.1){.xref}.  [Forwarding for the PUSH
            Operation on Local
            SIDs](#name-forwarding-for-the-push-ope){.xref}[¶](#section-toc.1-1.2.2.11.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.2.2.11.2.2}
            [2.11.2](#section-2.11.2){.xref}.  [Forwarding for the
            CONTINUE Operation for Local
            SIDs](#name-forwarding-for-the-continue){.xref}[¶](#section-toc.1-1.2.2.11.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.2.2.11.2.3}
            [2.11.3](#section-2.11.3){.xref}.  [Outgoing Label for the
            NEXT Operation for Local
            SIDs](#name-outgoing-label-for-the-next){.xref}[¶](#section-toc.1-1.2.2.11.2.3.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Manageability
    Considerations](#name-manageability-consideration){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [References](#name-references){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.6.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.6.2.2}
        [6.2](#section-6.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.6.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [Appendix
    A](#section-appendix.a){.xref}.  [Examples](#name-examples){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}

    -   ::: {#section-toc.1-1.7.2.1}
        [A.1](#section-a.1){.xref}.  [IGP Segment
        Examples](#name-igp-segment-examples){.xref}[¶](#section-toc.1-1.7.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [A.2](#section-a.2){.xref}.  [Incoming Label Collision
        Examples](#name-incoming-label-collision-ex){.xref}[¶](#section-toc.1-1.7.2.2.1){.pilcrow}

        -   ::: {#section-toc.1-1.7.2.2.2.1}
            [A.2.1](#section-a.2.1){.xref}.  [Example
            1](#name-example-1){.xref}[¶](#section-toc.1-1.7.2.2.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.2}
            [A.2.2](#section-a.2.2){.xref}.  [Example
            2](#name-example-2){.xref}[¶](#section-toc.1-1.7.2.2.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.3}
            [A.2.3](#section-a.2.3){.xref}.  [Example
            3](#name-example-3){.xref}[¶](#section-toc.1-1.7.2.2.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.4}
            [A.2.4](#section-a.2.4){.xref}.  [Example
            4](#name-example-4){.xref}[¶](#section-toc.1-1.7.2.2.2.4.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.5}
            [A.2.5](#section-a.2.5){.xref}.  [Example
            5](#name-example-5){.xref}[¶](#section-toc.1-1.7.2.2.2.5.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.6}
            [A.2.6](#section-a.2.6){.xref}.  [Example
            6](#name-example-6){.xref}[¶](#section-toc.1-1.7.2.2.2.6.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.7}
            [A.2.7](#section-a.2.7){.xref}.  [Example
            7](#name-example-7){.xref}[¶](#section-toc.1-1.7.2.2.2.7.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.8}
            [A.2.8](#section-a.2.8){.xref}.  [Example
            8](#name-example-8){.xref}[¶](#section-toc.1-1.7.2.2.2.8.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.9}
            [A.2.9](#section-a.2.9){.xref}.  [Example
            9](#name-example-9){.xref}[¶](#section-toc.1-1.7.2.2.2.9.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.10}
            [A.2.10](#section-a.2.10){.xref}. [Example
            10](#name-example-10){.xref}[¶](#section-toc.1-1.7.2.2.2.10.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.11}
            [A.2.11](#section-a.2.11){.xref}. [Example
            11](#name-example-11){.xref}[¶](#section-toc.1-1.7.2.2.2.11.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.12}
            [A.2.12](#section-a.2.12){.xref}. [Example
            12](#name-example-12){.xref}[¶](#section-toc.1-1.7.2.2.2.12.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.13}
            [A.2.13](#section-a.2.13){.xref}. [Example
            13](#name-example-13){.xref}[¶](#section-toc.1-1.7.2.2.2.13.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.2.2.14}
            [A.2.14](#section-a.2.14){.xref}. [Example
            14](#name-example-14){.xref}[¶](#section-toc.1-1.7.2.2.2.14.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.7.2.3}
        [A.3](#section-a.3){.xref}.  [Examples for the Effect of
        Incoming Label Collision on an Outgoing
        Label](#name-examples-for-the-effect-of-){.xref}[¶](#section-toc.1-1.7.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.7.2.3.2.1}
            [A.3.1](#section-a.3.1){.xref}.  [Example
            1](#name-example-1-2){.xref}[¶](#section-toc.1-1.7.2.3.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.3.2.2}
            [A.3.2](#section-a.3.2){.xref}.  [Example
            2](#name-example-2-2){.xref}[¶](#section-toc.1-1.7.2.3.2.2.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [](#section-appendix.b){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.9}
    [](#section-appendix.c){.xref}[Contributors](#name-contributors){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.10}
    [](#section-appendix.d){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}
    :::
:::
:::

::: {#convert-section-1}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

The Segment Routing architecture \[[RFC8402](#RFC8402){.xref}\] can be
directly applied to the MPLS architecture with no change in the MPLS
forwarding plane. This document specifies forwarding-plane behavior to
allow Segment Routing to operate on top of the MPLS data plane
(SR-MPLS). This document does not address control-plane behavior.
Control-plane behavior is specified in other documents such as
\[[RFC8665](#RFC8665){.xref}\], \[[RFC8666](#RFC8666){.xref}\], and
\[[RFC8667](#RFC8667){.xref}\].[¶](#section-1-1){.pilcrow}

The Segment Routing problem statement is described in
\[[RFC7855](#RFC7855){.xref}\].[¶](#section-1-2){.pilcrow}

Coexistence of SR over the MPLS forwarding plane with LDP
\[[RFC5036](#RFC5036){.xref}\] is specified in
\[[RFC8661](#RFC8661){.xref}\].[¶](#section-1-3){.pilcrow}

Policy routing and traffic engineering using Segment Routing can be
found in
\[[ROUTING-POLICY](#ROUTING-POLICY){.xref}\].[¶](#section-1-4){.pilcrow}

::: {#convert-section-1.1}
::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-1.1-1){.pilcrow}
:::
:::
:::
:::

::: {#convert-section-2}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [MPLS Instantiation of Segment Routing](#name-mpls-instantiation-of-segme){.section-name .selfRef} {#name-mpls-instantiation-of-segme}

MPLS instantiation of Segment Routing fits in the MPLS architecture as
defined in \[[RFC3031](#RFC3031){.xref}\] from both a control-plane and
forwarding-plane perspective:[¶](#section-2-1){.pilcrow}

-   [From a control-plane perspective, \[[RFC3031](#RFC3031){.xref}\]
    does not mandate a single signaling protocol. Segment Routing makes
    use of various control-plane protocols such as link-state IGPs
    \[[RFC8665](#RFC8665){.xref}\] \[[RFC8666](#RFC8666){.xref}\]
    \[[RFC8667](#RFC8667){.xref}\]. The flooding mechanisms of
    link-state IGPs fit very well with label stacking on the ingress. A
    future control-layer protocol and/or policy/configuration can be
    used to specify the label
    stack.[¶](#section-2-2.1){.pilcrow}]{#section-2-2.1}
-   [From a forwarding-plane perspective, Segment Routing does not
    require any change to the forwarding plane because Segment IDs
    (SIDs) are instantiated as MPLS labels, and the Segment Routing
    header is instantiated as a stack of MPLS
    labels.[¶](#section-2-2.2){.pilcrow}]{#section-2-2.2}

We call the \"MPLS Control Plane Client (MCC)\" any control-plane entity
installing forwarding entries in the MPLS data plane. Local
configuration and policies applied on a router are examples of
MCCs.[¶](#section-2-3){.pilcrow}

In order to have a node segment reach the node, a network operator
[SHOULD]{.bcp14} configure at least one node segment per routing
instance, topology, or algorithm. Otherwise, the node is not reachable
within the routing instance, within the topology, or along the routing
algorithm, which restricts its ability to be used by an SR Policy and as
a Topology Independent Loop-Free Alternate
(TI-LFA).[¶](#section-2-4){.pilcrow}

::: {#convert-section-2.1}
::: {#section-2.1 .section}
### [2.1.](#section-2.1){.section-number .selfRef} [Multiple Forwarding Behaviors for the Same Prefix](#name-multiple-forwarding-behavio){.section-name .selfRef} {#name-multiple-forwarding-behavio}

The SR architecture does not prohibit having more than one SID for the
same prefix. In fact, by allowing multiple SIDs for the same prefix, it
is possible to have different forwarding behaviors (such as different
paths, different ECMP and Unequal-Cost Multipath (UCMP) behaviors, etc.)
for the same destination.[¶](#section-2.1-1){.pilcrow}

Instantiating Segment Routing over the MPLS forwarding plane fits
seamlessly with this principle. An operator may assign multiple MPLS
labels or indices to the same prefix and assign different forwarding
behaviors to each label/SID. The MCC in the network downloads different
MPLS labels/SIDs to the FIB for different forwarding behaviors. The MCC
at the entry of an SR domain or at any point in the domain can choose to
apply a particular forwarding behavior to a particular packet by
applying the PUSH action to that packet using the corresponding
SID.[¶](#section-2.1-2){.pilcrow}
:::
:::

::: {#convert-section-2.2}
::: {#section-2.2 .section}
### [2.2.](#section-2.2){.section-number .selfRef} [SID Representation in the MPLS Forwarding Plane](#name-sid-representation-in-the-m){.section-name .selfRef} {#name-sid-representation-in-the-m}

When instantiating SR over the MPLS forwarding plane, a SID is
represented by an MPLS label or an index
\[[RFC8402](#RFC8402){.xref}\].[¶](#section-2.2-1){.pilcrow}

A global SID is a label, or an index that may be mapped to an MPLS label
within the Segment Routing Global Block (SRGB), of the node that
installs a global SID in its FIB and receives the labeled packet.
[Section 2.4](#convert-section-2.4){.xref} specifies the procedure to
map a global segment represented by an index to an MPLS label within the
SRGB.[¶](#section-2.2-2){.pilcrow}

The MCC [MUST]{.bcp14} ensure that any label value corresponding to any
SID it installs in the forwarding plane follows the rules
below:[¶](#section-2.2-3){.pilcrow}

-   [The label value [MUST]{.bcp14} be unique within the router on which
    the MCC is running, i.e., the label [MUST]{.bcp14} only be used to
    represent the SID and [MUST NOT]{.bcp14} be used to represent more
    than one SID or for any other forwarding purpose on the
    router.[¶](#section-2.2-4.1){.pilcrow}]{#section-2.2-4.1}
-   [The label value [MUST NOT]{.bcp14} come from the range of
    special-purpose labels
    \[[RFC7274](#RFC7274){.xref}\].[¶](#section-2.2-4.2){.pilcrow}]{#section-2.2-4.2}

Labels allocated in this document are considered per-platform downstream
allocated labels
\[[RFC3031](#RFC3031){.xref}\].[¶](#section-2.2-5){.pilcrow}
:::
:::

::: {#convert-section-2.3}
::: {#section-2.3 .section}
### [2.3.](#section-2.3){.section-number .selfRef} [Segment Routing Global Block and Local Block](#name-segment-routing-global-bloc){.section-name .selfRef} {#name-segment-routing-global-bloc}

The concepts of SRGB and global SID are explained in
\[[RFC8402](#RFC8402){.xref}\]. In general, the SRGB need not be a
contiguous range of labels.[¶](#section-2.3-1){.pilcrow}

For the rest of this document, the SRGB is specified by the list of MPLS
label ranges \[Ll(1),Lh(1)\], \[Ll(2),Lh(2)\],\..., \[Ll(k),Lh(k)\]
where Ll(i) =\< Lh(i).[¶](#section-2.3-2){.pilcrow}

The following rules apply to the list of MPLS ranges representing the
SRGB:[¶](#section-2.3-3){.pilcrow}

-   [The list of ranges comprising the SRGB [MUST NOT]{.bcp14}
    overlap.[¶](#section-2.3-4.1){.pilcrow}]{#section-2.3-4.1}
-   [Every range in the list of ranges specifying the SRGB [MUST
    NOT]{.bcp14} cover or overlap with a reserved label value or range
    \[[RFC7274](#RFC7274){.xref}\],
    respectively.[¶](#section-2.3-4.2){.pilcrow}]{#section-2.3-4.2}
-   [If the SRGB of a node does not conform to the structure specified
    in this section or to the previous two rules, the SRGB
    [MUST]{.bcp14} be completely ignored by all routers in the routing
    domain, and the node [MUST]{.bcp14} be treated as if it does not
    have an SRGB.[¶](#section-2.3-4.3){.pilcrow}]{#section-2.3-4.3}
-   [The list of label ranges [MUST]{.bcp14} only be used to instantiate
    global SIDs into the MPLS forwarding
    plane.[¶](#section-2.3-4.4){.pilcrow}]{#section-2.3-4.4}

A local segment [MAY]{.bcp14} be allocated from the Segment Routing
Local Block (SRLB) \[[RFC8402](#RFC8402){.xref}\] or from any unused
label as long as it does not use a special-purpose label. The SRLB
consists of the range of local labels reserved by the node for certain
local segments. In a controller-driven network, some controllers or
applications [MAY]{.bcp14} use the control plane to discover the
available set of Local SIDs on a particular router
\[[ROUTING-POLICY](#ROUTING-POLICY){.xref}\]. The rules applicable to
the SRGB are also applicable to the SRLB, except the SRGB [MUST]{.bcp14}
only be used to instantiate global SIDs into the MPLS forwarding plane.
The recommended, minimum, or maximum size of the SRGB and/or SRLB is a
matter of future study.[¶](#section-2.3-5){.pilcrow}
:::
:::

::: {#convert-section-2.4}
::: {#section-2.4 .section}
### [2.4.](#section-2.4){.section-number .selfRef} [Mapping a SID Index to an MPLS Label](#name-mapping-a-sid-index-to-an-m){.section-name .selfRef} {#name-mapping-a-sid-index-to-an-m}

This subsection specifies how the MPLS label value is calculated given
the index of a SID. The value of the index is determined by an MCC such
as IS-IS \[[RFC8667](#RFC8667){.xref}\] or OSPF
\[[RFC8665](#RFC8665){.xref}\]. This section only specifies how to map
the index to an MPLS label. The calculated MPLS label is downloaded to
the FIB, sent out with a forwarded packet, or
both.[¶](#section-2.4-1){.pilcrow}

Consider a SID represented by the index \"I\". Consider an SRGB as
specified in [Section 2.3](#convert-section-2.3){.xref}. The total size
of the SRGB, represented by the variable \"Size\", is calculated
according to the formula:[¶](#section-2.4-2){.pilcrow}

::: {#section-2.4-3 .artwork .art-text .alignLeft}
    size = Lh(1)- Ll(1) + 1 + Lh(2)- Ll(2) + 1 + ... + Lh(k)- Ll(k) + 1

[¶](#section-2.4-3){.pilcrow}
:::

The following rules [MUST]{.bcp14} be applied by the MCC when
calculating the MPLS label value corresponding to the SID index value
\"I\".[¶](#section-2.4-4){.pilcrow}

-   [0 =\< I \< size. If index \"I\" does not satisfy the previous
    inequality, then the label cannot be
    calculated.[¶](#section-2.4-5.1){.pilcrow}]{#section-2.4-5.1}

-   ::: {#section-2.4-5.2}
    The label value corresponding to the SID index \"I\" is calculated
    as follows:[¶](#section-2.4-5.2.1){.pilcrow}

    -   [j = 1 , temp =
        0[¶](#section-2.4-5.2.2.1){.pilcrow}]{#section-2.4-5.2.2.1}

    -   ::: {#section-2.4-5.2.2.2}
        While temp + Lh(j)- Ll(j) \<
        I[¶](#section-2.4-5.2.2.2.1){.pilcrow}

        -   [temp = temp + Lh(j)- Ll(j) +
            1[¶](#section-2.4-5.2.2.2.2.1){.pilcrow}]{#section-2.4-5.2.2.2.2.1}
        -   [j =
            j+1[¶](#section-2.4-5.2.2.2.2.2){.pilcrow}]{#section-2.4-5.2.2.2.2.2}
        :::

    -   [label = I - temp +
        Ll(j)[¶](#section-2.4-5.2.2.3){.pilcrow}]{#section-2.4-5.2.2.3}
    :::

An example for how a router calculates labels and forwards traffic based
on the procedure described in this section can be found in [Appendix
A.1](#convert-section-a.1){.xref}.[¶](#section-2.4-6){.pilcrow}
:::
:::

::: {#convert-section-2.5}
::: {#section-2.5 .section}
### [2.5.](#section-2.5){.section-number .selfRef} [Incoming Label Collision](#name-incoming-label-collision){.section-name .selfRef} {#name-incoming-label-collision}

The MPLS Architecture \[[RFC3031](#RFC3031){.xref}\] defines the term
Forwarding Equivalence Class (FEC) as the set of packets with similar
and/or identical characteristics that are forwarded the same way and are
bound to the same MPLS incoming (local) label. In Segment Routing MPLS,
a local label serves as the SID for a given
FEC.[¶](#section-2.5-1){.pilcrow}

We define SR FEC \[[RFC8402](#RFC8402){.xref}\] as one of the
following:[¶](#section-2.5-2){.pilcrow}

-   [(Prefix, Routing Instance, Topology, Algorithm)
    \[[RFC8402](#RFC8402){.xref}\], where a topology identifies a set of
    links with metrics. For the purpose of incoming label collision
    resolution, the same Topology numerical value [SHOULD]{.bcp14} be
    used on all routers to identify the same set of links with metrics.
    For MCCs where the \"Topology\" and/or \"Algorithm\" fields are not
    defined, the numerical value of zero [MUST]{.bcp14} be used for
    these two fields. For the purpose of incoming label collision
    resolution, a routing instance is identified by a single incoming
    label downloader to the FIB. Two MCCs running on the same router are
    considered different routing instances if the only way the two
    instances know about each other\'s incoming labels is through
    redistribution. The numerical value used to identify a routing
    instance [MAY]{.bcp14} be derived from other configuration or
    [MAY]{.bcp14} be explicitly configured. If it is derived from other
    configuration, then the same numerical value [SHOULD]{.bcp14} be
    derived from the same configuration as long as the configuration
    survives router reload. If the derived numerical value varies for
    the same configuration, then an implementation [SHOULD]{.bcp14} make
    the numerical value used to identify a routing instance
    configurable.[¶](#section-2.5-3.1){.pilcrow}]{#section-2.5-3.1}
-   [(next hop, outgoing interface), where the outgoing interface is
    physical or
    virtual.[¶](#section-2.5-3.2){.pilcrow}]{#section-2.5-3.2}
-   [(number of adjacencies, list of next hops, list of outgoing
    interfaces IDs in ascending numerical order). This FEC represents
    parallel adjacencies
    \[[RFC8402](#RFC8402){.xref}\].[¶](#section-2.5-3.3){.pilcrow}]{#section-2.5-3.3}
-   [(Endpoint, Color). This FEC represents an SR Policy
    \[[RFC8402](#RFC8402){.xref}\].[¶](#section-2.5-3.4){.pilcrow}]{#section-2.5-3.4}
-   [(Mirror SID). The Mirror SID (see \[[RFC8402](#RFC8402){.xref}\],
    [Section
    5.1](https://www.rfc-editor.org/rfc/rfc8402#section-5.1){.relref})
    is the IP address advertised by the advertising node to identify the
    Mirror SID. The IP address is encoded as specified in [Section
    2.5.1](#convert-section-2.5.1){.xref}.[¶](#section-2.5-3.5){.pilcrow}]{#section-2.5-3.5}

This section covers the [RECOMMENDED]{.bcp14} procedure for handling the
scenario where, because of an error/misconfiguration, more than one SR
FEC as defined in this section maps to the same incoming MPLS label.
Examples illustrating the behavior specified in this section can be
found in [Appendix
A.2](#convert-section-a.2){.xref}.[¶](#section-2.5-4){.pilcrow}

An incoming label collision occurs if the SIDs of the set of FECs {FEC1,
FEC2, \..., FECk} map to the same incoming SR MPLS label
\"L1\".[¶](#section-2.5-5){.pilcrow}

Suppose an anycast prefix is advertised with a Prefix-SID by some, but
not all, of the nodes that advertise that prefix. If the Prefix-SID
sub-TLVs result in mapping that anycast prefix to the same incoming
label, then the advertisement of the Prefix-SID by some, but not all, of
the advertising nodes [MUST NOT]{.bcp14} be treated as a label
collision.[¶](#section-2.5-6){.pilcrow}

An implementation [MUST NOT]{.bcp14} allow the MCCs belonging to the
same router to assign the same incoming label to more than one SR
FEC.[¶](#section-2.5-7){.pilcrow}

The objective of the following steps is to deterministically install in
the MPLS Incoming Label Map, also known as label FIB, a single FEC with
the incoming label \"L1\". By \"deterministically install\", we mean if
the set of FECs {FEC1, FEC2,\..., FECk} map to the same incoming SR MPLS
label \"L1\", then the steps below assign the same FEC to the label
\"L1\" irrespective of the order by which the mappings of this set of
FECs to the label \"L1\" are received. For example, first- come,
first-served tiebreaking is not allowed. The remaining FECs may be
installed in the IP FIB without an incoming
label.[¶](#section-2.5-8){.pilcrow}

The procedure in this section relies completely on the local FEC and
label database within a given router.[¶](#section-2.5-9){.pilcrow}

The collision resolution procedure is as
follows:[¶](#section-2.5-10){.pilcrow}

1.  [Given the SIDs of the set of FECs, {FEC1, FEC2,\..., FECk} map to
    the same MPLS label
    \"L1\".[¶](#section-2.5-11.1){.pilcrow}]{#section-2.5-11.1}

2.  ::: {#section-2.5-11.2}
    Within an MCC, apply tiebreaking rules to select one FEC only, and
    assign the label to it. The losing FECs are handled as if no labels
    are attached to them. The losing FECs with algorithms other than the
    shortest path first \[[RFC8402](#RFC8402){.xref}\] are not installed
    in the FIB.[¶](#section-2.5-11.2.1){.pilcrow}

    a.  [If the same set of FECs are attached to the same label \"L1\",
        then the tiebreaking rules [MUST]{.bcp14} always select the same
        FEC irrespective of the order in which the FECs and the label
        \"L1\" are received. In other words, the tiebreaking rule
        [MUST]{.bcp14} be
        deterministic.[¶](#section-2.5-11.2.2.1){.pilcrow}]{#section-2.5-11.2.2.1}
    :::

3.  [If there is still collision between the FECs belonging to different
    MCCs, then reapply the tiebreaking rules to the remaining FECs to
    select one FEC only, and assign the label to that
    FEC.[¶](#section-2.5-11.3){.pilcrow}]{#section-2.5-11.3}

4.  [Install the selected FEC into the IP FIB and its incoming label
    into the label
    FIB.[¶](#section-2.5-11.4){.pilcrow}]{#section-2.5-11.4}

5.  [The remaining FECs with the default algorithm (see the Prefix-SID
    algorithm specification \[[RFC8402](#RFC8402){.xref}\]) may be
    installed in the FIB natively, such as pure IP entries in case of
    Prefix FEC, without any incoming labels corresponding to their SIDs.
    The remaining FECs with algorithms other than the shortest path
    first \[[RFC8402](#RFC8402){.xref}\] are not installed in the
    FIB.[¶](#section-2.5-11.5){.pilcrow}]{#section-2.5-11.5}

::: {#convert-section-2.5.1}
::: {#section-2.5.1 .section}
#### [2.5.1.](#section-2.5.1){.section-number .selfRef} [Tiebreaking Rules](#name-tiebreaking-rules){.section-name .selfRef} {#name-tiebreaking-rules}

The default tiebreaking rules are specified as
follows:[¶](#section-2.5.1-1){.pilcrow}

1.  [Determine the lowest administrative distance among the competing
    FECs as defined in the section below. Then filter away all the
    competing FECs with a higher administrative
    distance.[¶](#section-2.5.1-2.1){.pilcrow}]{#section-2.5.1-2.1}
2.  [If more than one competing FEC remains after step 1, select the
    smallest numerical FEC value. The numerical value of the FEC is
    determined according to the FEC encoding described later in this
    section.[¶](#section-2.5.1-2.2){.pilcrow}]{#section-2.5.1-2.2}

These rules deterministically select which FEC to install in the MPLS
forwarding plane for the given incoming
label.[¶](#section-2.5.1-3){.pilcrow}

This document defines the default tiebreaking rules that
[SHOULD]{.bcp14} be implemented. An implementation [MAY]{.bcp14} choose
to support different tiebreaking rules and [MAY]{.bcp14} use one of
these instead of the default tiebreaking rules. To maximize MPLS
forwarding consistency in case of a SID configuration error, the network
operator [MUST]{.bcp14} deploy, within an IGP flooding area, routers
implementing the same tiebreaking rules.[¶](#section-2.5.1-4){.pilcrow}

Each FEC is assigned an administrative distance. The FEC administrative
distance is encoded as an 8-bit value. The lower the value, the better
the administrative distance.[¶](#section-2.5.1-5){.pilcrow}

The default FEC administrative distance order starting from the lowest
value [SHOULD]{.bcp14} be:[¶](#section-2.5.1-6){.pilcrow}

-   ::: {#section-2.5.1-7.1}
    Explicit SID assignment to a FEC that maps to a label outside the
    SRGB irrespective of the owner MCC. An explicit SID assignment is a
    static assignment of a label to a FEC such that the assignment
    survives a router reboot.[¶](#section-2.5.1-7.1.1){.pilcrow}

    -   [An example of explicit SID allocation is static assignment of a
        specific label to an
        Adj-SID.[¶](#section-2.5.1-7.1.2.1){.pilcrow}]{#section-2.5.1-7.1.2.1}
    -   [An implementation of explicit SID assignment [MUST]{.bcp14}
        guarantee collision freeness on the same
        router.[¶](#section-2.5.1-7.1.2.2){.pilcrow}]{#section-2.5.1-7.1.2.2}
    :::

-   ::: {#section-2.5.1-7.2}
    Dynamic SID assignment:[¶](#section-2.5.1-7.2.1){.pilcrow}

    -   [All FEC types, except for the SR Policy, are ordered using the
        default administrative distance defined by the
        implementation.[¶](#section-2.5.1-7.2.2.1){.pilcrow}]{#section-2.5.1-7.2.2.1}
    -   [The Binding SID \[[RFC8402](#RFC8402){.xref}\] assigned to the
        SR Policy always has a higher default administrative distance
        than the default administrative distance of any other FEC
        type.[¶](#section-2.5.1-7.2.2.2){.pilcrow}]{#section-2.5.1-7.2.2.2}
    :::

To maximize MPLS forwarding consistency, if the same FEC is advertised
in more than one protocol, a user [MUST]{.bcp14} ensure that the
administrative distance preference between protocols is the same on all
routers of the IGP flooding domain. Note that this is not really new as
this already applies to IP forwarding.[¶](#section-2.5.1-8){.pilcrow}

The numerical sort across FECs [SHOULD]{.bcp14} be performed as
follows:[¶](#section-2.5.1-9){.pilcrow}

-   ::: {#section-2.5.1-10.1}
    Each FEC is assigned a FEC type encoded in 8 bits. The type
    codepoints for each SR FEC defined at the beginning of this section
    are as follows:[¶](#section-2.5.1-10.1.1){.pilcrow}

    -   ::: {#section-2.5.1-10.1.2.1}

        120:
        :   (Prefix, Routing Instance, Topology,
            Algorithm)[¶](#section-2.5.1-10.1.2.1.1.2){.pilcrow}

        130:
        :   (next hop, outgoing
            interface)[¶](#section-2.5.1-10.1.2.1.1.4){.pilcrow}

        140:
        :   Parallel Adjacency
            \[[RFC8402](#RFC8402){.xref}\][¶](#section-2.5.1-10.1.2.1.1.6){.pilcrow}

        150:
        :   SR Policy
            \[[RFC8402](#RFC8402){.xref}\][¶](#section-2.5.1-10.1.2.1.1.8){.pilcrow}

        160:
        :   Mirror SID
            \[[RFC8402](#RFC8402){.xref}\][¶](#section-2.5.1-10.1.2.1.1.10){.pilcrow}
        :::

    The numerical values above are mentioned to guide implementation. If
    other numerical values are used, then the numerical values must
    maintain the same greater-than ordering of the numbers mentioned
    here.[¶](#section-2.5.1-10.1.3){.pilcrow}
    :::

-   ::: {#section-2.5.1-10.2}
    The fields of each FEC are encoded as
    follows:[¶](#section-2.5.1-10.2.1){.pilcrow}

    -   [All fields in all FECs are encoded in big endian
        order.[¶](#section-2.5.1-10.2.2.1){.pilcrow}]{#section-2.5.1-10.2.2.1}

    -   [The Routing Instance ID is represented by 16 bits. For routing
        instances that are identified by less than 16 bits, encode the
        Instance ID in the least significant bits while the most
        significant bits are set to
        zero.[¶](#section-2.5.1-10.2.2.2){.pilcrow}]{#section-2.5.1-10.2.2.2}

    -   [The address family is represented by 8 bits, where IPv4 is
        encoded as 100, and IPv6 is encoded as 110. These numerical
        values are mentioned to guide implementations. If other
        numerical values are used, then the numerical value of IPv4
        [MUST]{.bcp14} be less than the numerical value for
        IPv6.[¶](#section-2.5.1-10.2.2.3){.pilcrow}]{#section-2.5.1-10.2.2.3}

    -   ::: {#section-2.5.1-10.2.2.4}
        All addresses are represented in 128 bits as
        follows:[¶](#section-2.5.1-10.2.2.4.1){.pilcrow}

        -   [The IPv6 address is encoded
            natively.[¶](#section-2.5.1-10.2.2.4.2.1){.pilcrow}]{#section-2.5.1-10.2.2.4.2.1}
        -   [The IPv4 address is encoded in the most significant bits,
            and the remaining bits are set to
            zero.[¶](#section-2.5.1-10.2.2.4.2.2){.pilcrow}]{#section-2.5.1-10.2.2.4.2.2}
        :::

    -   ::: {#section-2.5.1-10.2.2.5}
        All prefixes are represented by (8 + 128)
        bits.[¶](#section-2.5.1-10.2.2.5.1){.pilcrow}

        -   [A prefix is encoded in the most significant bits, and the
            remaining bits are set to
            zero.[¶](#section-2.5.1-10.2.2.5.2.1){.pilcrow}]{#section-2.5.1-10.2.2.5.2.1}
        -   [The prefix length is encoded before the prefix in an 8-bit
            field.[¶](#section-2.5.1-10.2.2.5.2.2){.pilcrow}]{#section-2.5.1-10.2.2.5.2.2}
        :::

    -   [The Topology ID is represented by 16 bits. For routing
        instances that identify topologies using less than 16 bits,
        encode the topology ID in the least significant bits while the
        most significant bits are set to
        zero.[¶](#section-2.5.1-10.2.2.6){.pilcrow}]{#section-2.5.1-10.2.2.6}

    -   [The Algorithm is encoded in a 16-bit
        field.[¶](#section-2.5.1-10.2.2.7){.pilcrow}]{#section-2.5.1-10.2.2.7}

    -   [The Color ID is encoded using 32
        bits.[¶](#section-2.5.1-10.2.2.8){.pilcrow}]{#section-2.5.1-10.2.2.8}
    :::

-   [Choose the set of FECs of the smallest FEC type
    codepoint.[¶](#section-2.5.1-10.3){.pilcrow}]{#section-2.5.1-10.3}

-   [Out of these FECs, choose the FECs with the smallest address family
    codepoint.[¶](#section-2.5.1-10.4){.pilcrow}]{#section-2.5.1-10.4}

-   ::: {#section-2.5.1-10.5}
    Encode the remaining set of FECs as
    follows:[¶](#section-2.5.1-10.5.1){.pilcrow}

    -   [(Prefix, Routing Instance, Topology, Algorithm) is encoded as
        (Prefix Length, Prefix, routing_instance_id, Topology, SR
        Algorithm).[¶](#section-2.5.1-10.5.2.1){.pilcrow}]{#section-2.5.1-10.5.2.1}
    -   [(next hop, outgoing interface) is encoded as (next hop,
        outgoing_interface_id).[¶](#section-2.5.1-10.5.2.2){.pilcrow}]{#section-2.5.1-10.5.2.2}
    -   [(number of adjacencies, list of next hops in ascending
        numerical order, list of outgoing interface IDs in ascending
        numerical order) is used to encode a parallel adjacency
        \[[RFC8402](#RFC8402){.xref}\].[¶](#section-2.5.1-10.5.2.3){.pilcrow}]{#section-2.5.1-10.5.2.3}
    -   [(Endpoint, Color) is encoded as (Endpoint_address,
        Color_id).[¶](#section-2.5.1-10.5.2.4){.pilcrow}]{#section-2.5.1-10.5.2.4}
    -   [(IP address) is the encoding for a Mirror SID FEC. The IP
        address is encoded as described above in this
        section.[¶](#section-2.5.1-10.5.2.5){.pilcrow}]{#section-2.5.1-10.5.2.5}
    :::

-   [Select the FEC with the smallest numerical
    value.[¶](#section-2.5.1-10.6){.pilcrow}]{#section-2.5.1-10.6}

The numerical values mentioned in this section are for guidance only. If
other numerical values are used, then the other numerical values
[MUST]{.bcp14} maintain the same numerical ordering among different SR
FECs.[¶](#section-2.5.1-11){.pilcrow}
:::
:::

::: {#convert-section-2.5.2}
::: {#section-2.5.2 .section}
#### [2.5.2.](#section-2.5.2){.section-number .selfRef} [Redistribution between Routing Protocol Instances](#name-redistribution-between-rout){.section-name .selfRef} {#name-redistribution-between-rout}

The following rule [SHOULD]{.bcp14} be applied when redistributing SIDs
with prefixes between routing protocol
instances:[¶](#section-2.5.2-1){.pilcrow}

-   ::: {#section-2.5.2-2.1}
    If the SRGB of the receiving instance is the same as the SRGB of the
    origin instance, then:[¶](#section-2.5.2-2.1.1){.pilcrow}

    -   [the index is redistributed with the
        route.[¶](#section-2.5.2-2.1.2.1){.pilcrow}]{#section-2.5.2-2.1.2.1}
    :::

-   ::: {#section-2.5.2-2.2}
    Else,[¶](#section-2.5.2-2.2.1){.pilcrow}

    -   [the index is not redistributed and if the receiving instance
        decides to advertise an index with the redistributed route, it
        is the duty of the receiving instance to allocate a fresh index
        relative to its own SRGB. Note that in this case, the receiving
        instance [MUST]{.bcp14} compute the local label it assigns to
        the route according to [Section
        2.4](#convert-section-2.4){.xref} and install it in
        FIB.[¶](#section-2.5.2-2.2.2.1){.pilcrow}]{#section-2.5.2-2.2.2.1}
    :::

It is outside the scope of this document to define local node behaviors
that would allow the mapping of the original index into a new index in
the receiving instance via the addition of an offset or other policy
means.[¶](#section-2.5.2-3){.pilcrow}

::: {#convert-section-2.5.2.1}
::: {#section-2.5.2.1 .section}
##### [2.5.2.1.](#section-2.5.2.1){.section-number .selfRef} [Illustration](#name-illustration){.section-name .selfRef} {#name-illustration}

::: {#section-2.5.2.1-1 .artwork .art-text .alignLeft}
            A----IS-IS----B---OSPF----C-192.0.2.1/32 (20001)

[¶](#section-2.5.2.1-1){.pilcrow}
:::

Consider the simple topology above,
where:[¶](#section-2.5.2.1-2){.pilcrow}

-   [A and B are in the IS-IS domain with SRGB =
    \[16000-17000\][¶](#section-2.5.2.1-3.1){.pilcrow}]{#section-2.5.2.1-3.1}
-   [B and C are in the OSPF domain with SRGB =
    \[20000-21000\][¶](#section-2.5.2.1-3.2){.pilcrow}]{#section-2.5.2.1-3.2}
-   [B redistributes 192.0.2.1/32 into the IS-IS
    domain[¶](#section-2.5.2.1-3.3){.pilcrow}]{#section-2.5.2.1-3.3}

In this case, A learns 192.0.2.1/32 as an IP leaf connected to B, which
is usual for IP prefix redistribution[¶](#section-2.5.2.1-4){.pilcrow}

However, according to the redistribution rule above, B decides not to
advertise any index with 192.0.2.1/32 into IS-IS because the SRGB is not
the same.[¶](#section-2.5.2.1-5){.pilcrow}
:::
:::

::: {#convert-section-2.5.2.2}
::: {#section-2.5.2.2 .section}
##### [2.5.2.2.](#section-2.5.2.2){.section-number .selfRef} [Illustration 2](#name-illustration-2){.section-name .selfRef} {#name-illustration-2}

Consider the example in the illustration described in [Section
2.5.2.1](#convert-section-2.5.2.1){.xref}.[¶](#section-2.5.2.2-1){.pilcrow}

When router B redistributes the prefix 192.0.2.1/32, router B decides to
allocate and advertise the same index 1 with the prefix
192.0.2.1/32.[¶](#section-2.5.2.2-2){.pilcrow}

Within the SRGB of the IS-IS domain, index 1 corresponds to the local
label 16001. Hence, according to the redistribution rule above, router B
programs the incoming label 16001 in its FIB to match traffic arriving
from the IS-IS domain destined to the prefix
192.0.2.1/32.[¶](#section-2.5.2.2-3){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#convert-section-2.6}
::: {#section-2.6 .section}
### [2.6.](#section-2.6){.section-number .selfRef} [Effect of Incoming Label Collision on Outgoing Label Programming](#name-effect-of-incoming-label-co){.section-name .selfRef} {#name-effect-of-incoming-label-co}

When determining what outgoing label to use, the ingress node that
pushes new segments, and hence a stack of MPLS labels, [MUST]{.bcp14}
use, for a given FEC, the label that has been selected by the node
receiving the packet with that label exposed as the top label. So in
case of incoming label collision on this receiving node, the ingress
node [MUST]{.bcp14} resolve this collision by using this same \"Incoming
Label Collision resolution procedure\" and by using the data of the
receiving node.[¶](#section-2.6-1){.pilcrow}

In the general case, the ingress node may not have the exact same data
as the receiving node, so the result may be different. This is under the
responsibility of the network operator. But in a typical case, e.g.,
where a centralized node or a distributed link-state IGP is used, all
nodes would have the same database. However, to minimize the chance of
misforwarding, a FEC that loses its incoming label to the tiebreaking
rules specified in [Section 2.5](#convert-section-2.5){.xref} [MUST
NOT]{.bcp14} be installed in FIB with an outgoing Segment Routing label
based on the SID corresponding to the lost incoming
label.[¶](#section-2.6-2){.pilcrow}

Examples for the behavior specified in this section can be found in
[Appendix
A.3](#convert-section-a.3){.xref}.[¶](#section-2.6-3){.pilcrow}
:::
:::

::: {#convert-section-2.7}
::: {#section-2.7 .section}
### [2.7.](#section-2.7){.section-number .selfRef} [PUSH, CONTINUE, and NEXT](#name-push-continue-and-next){.section-name .selfRef} {#name-push-continue-and-next}

PUSH, NEXT, and CONTINUE are operations applied by the forwarding plane.
The specifications of these operations can be found in
\[[RFC8402](#RFC8402){.xref}\]. This subsection specifies how to
implement each of these operations in the MPLS forwarding
plane.[¶](#section-2.7-1){.pilcrow}

::: {#convert-section-2.7.1}
::: {#section-2.7.1 .section}
#### [2.7.1.](#section-2.7.1){.section-number .selfRef} [PUSH](#name-push){.section-name .selfRef} {#name-push}

As described in \[[RFC8402](#RFC8402){.xref}\], PUSH corresponds to
pushing one or more labels on top of an incoming packet then sending it
out of a particular physical interface or virtual interface, such as a
UDP tunnel \[[RFC7510](#RFC7510){.xref}\] or the Layer 2 Tunneling
Protocol version 3 (L2TPv3) \[[RFC4817](#RFC4817){.xref}\], towards a
particular next hop. When pushing labels onto a packet\'s label stack,
the Time-to-Live (TTL) field \[[RFC3032](#RFC3032){.xref}\]
\[[RFC3443](#RFC3443){.xref}\] and the Traffic Class (TC) field
\[[RFC3032](#RFC3032){.xref}\] \[[RFC5462](#RFC5462){.xref}\] of each
label stack entry must, of course, be set. This document does not
specify any set of rules for setting these fields; that is a matter of
local policy. Sections [2.10](#convert-section-2.10){.xref} and
[2.11](#convert-section-2.11){.xref} specify additional details about
forwarding behavior.[¶](#section-2.7.1-1){.pilcrow}
:::
:::

::: {#convert-section-2.7.2}
::: {#section-2.7.2 .section}
#### [2.7.2.](#section-2.7.2){.section-number .selfRef} [CONTINUE](#name-continue){.section-name .selfRef} {#name-continue}

As described in \[[RFC8402](#RFC8402){.xref}\], the CONTINUE operation
corresponds to swapping the incoming label with an outgoing label. The
value of the outgoing label is calculated as specified in Sections
[2.10](#convert-section-2.10){.xref} and
[2.11](#convert-section-2.11){.xref}.[¶](#section-2.7.2-1){.pilcrow}
:::
:::

::: {#convert-section-2.7.3}
::: {#section-2.7.3 .section}
#### [2.7.3.](#section-2.7.3){.section-number .selfRef} [NEXT](#name-next){.section-name .selfRef} {#name-next}

As described in \[[RFC8402](#RFC8402){.xref}\], NEXT corresponds to
popping the topmost label. The action before and/or after the popping
depends on the instruction associated with the active SID on the
received packet prior to the popping. For example, suppose the active
SID in the received packet was an Adj-SID
\[[RFC8402](#RFC8402){.xref}\]; on receiving the packet, the node
applies the NEXT operation, which corresponds to popping the topmost
label, and then sends the packet out of the physical or virtual
interface (e.g., the UDP tunnel \[[RFC7510](#RFC7510){.xref}\] or L2TPv3
tunnel \[[RFC4817](#RFC4817){.xref}\]) towards the next hop
corresponding to the Adj-SID.[¶](#section-2.7.3-1){.pilcrow}

::: {#convert-section-2.7.3.1}
::: {#section-2.7.3.1 .section}
##### [2.7.3.1.](#section-2.7.3.1){.section-number .selfRef} [Mirror SID](#name-mirror-sid){.section-name .selfRef} {#name-mirror-sid}

If the active SID in the received packet was a Mirror SID (see
\[[RFC8402](#RFC8402){.xref}\], [Section
5.1](https://www.rfc-editor.org/rfc/rfc8402#section-5.1){.relref})
allocated by the receiving router, the receiving router applies the NEXT
operation, which corresponds to popping the topmost label, and then
performs a lookup using the contents of the packet after popping the
outermost label in the mirrored forwarding table. The method by which
the lookup is made, and/or the actions applied to the packet after the
lookup in the mirror table, depends on the contents of the packet and
the mirror table. Note that the packet exposed after popping the topmost
label may or may not be an MPLS packet. A Mirror SID can be viewed as a
generalization of the context label in \[[RFC5331](#RFC5331){.xref}\]
because a Mirror SID does not make any assumptions about the packet
underneath the top label.[¶](#section-2.7.3.1-1){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#convert-section-2.8}
::: {#section-2.8 .section}
### [2.8.](#section-2.8){.section-number .selfRef} [MPLS Label Downloaded to the FIB for Global and Local SIDs](#name-mpls-label-downloaded-to-th){.section-name .selfRef} {#name-mpls-label-downloaded-to-th}

The label corresponding to the global SID \"Si\", which is represented
by the global index \"I\" and downloaded to the FIB, is used to match
packets whose active segment (and hence topmost label) is \"Si\". The
value of this label is calculated as specified in [Section
2.4](#convert-section-2.4){.xref}.[¶](#section-2.8-1){.pilcrow}

For Local SIDs, the MCC is responsible for downloading the correct label
value to the FIB. For example, an IGP with SR extensions
\[[RFC8667](#RFC8667){.xref}\] \[[RFC8665](#RFC8665){.xref}\] downloads
the MPLS label corresponding to an Adj-SID
\[[RFC8402](#RFC8402){.xref}\].[¶](#section-2.8-2){.pilcrow}
:::
:::

::: {#convert-section-2.9}
::: {#section-2.9 .section}
### [2.9.](#section-2.9){.section-number .selfRef} [Active Segment](#name-active-segment){.section-name .selfRef} {#name-active-segment}

When instantiated in the MPLS domain, the active segment on a packet
corresponds to the topmost label and is calculated according to the
procedure specified in Sections [2.10](#convert-section-2.10){.xref} and
[2.11](#convert-section-2.11){.xref}. When arriving at a node, the
topmost label corresponding to the active SID matches the MPLS label
downloaded to the FIB as specified in [Section
2.4](#convert-section-2.4){.xref}.[¶](#section-2.9-1){.pilcrow}
:::
:::

::: {#convert-section-2.10}
::: {#section-2.10 .section}
### [2.10.](#section-2.10){.section-number .selfRef} [Forwarding Behavior for Global SIDs](#name-forwarding-behavior-for-glo){.section-name .selfRef} {#name-forwarding-behavior-for-glo}

This section specifies the forwarding behavior, including the
calculation of outgoing labels, that corresponds to a global SID when
applying the PUSH, CONTINUE, and NEXT operations in the MPLS forwarding
plane.[¶](#section-2.10-1){.pilcrow}

This document covers the calculation of the outgoing label for the top
label only. The case where the outgoing label is not the top label and
is part of a stack of labels that instantiates a routing policy or a
traffic-engineering tunnel is outside the scope of this document and may
be covered in other documents such as
\[[ROUTING-POLICY](#ROUTING-POLICY){.xref}\].[¶](#section-2.10-2){.pilcrow}

::: {#convert-section-2.10.1}
::: {#section-2.10.1 .section}
#### [2.10.1.](#section-2.10.1){.section-number .selfRef} [Forwarding for PUSH and CONTINUE of Global SIDs](#name-forwarding-for-push-and-con){.section-name .selfRef} {#name-forwarding-for-push-and-con}

Suppose an MCC on router \"R0\" determines that, before sending the
packet towards a neighbor \"N\", the PUSH or CONTINUE operation is to be
applied to an incoming packet related to the global SID \"Si\". SID
\"Si\" is represented by the global index \"I\" and owned by the router
Ri. Neighbor \"N\" may be directly connected to \"R0\" through either a
physical or a virtual interface (e.g., UDP tunnel
\[[RFC7510](#RFC7510){.xref}\] or L2TPv3 tunnel
\[[RFC4817](#RFC4817){.xref}\]).[¶](#section-2.10.1-1){.pilcrow}

The method by which the MCC on router \"R0\" determines that the PUSH or
CONTINUE operation must be applied using the SID \"Si\" is beyond the
scope of this document. An example of a method to determine the SID
\"Si\" for the PUSH operation is the case where IS-IS
\[[RFC8667](#RFC8667){.xref}\] receives the Prefix-SID \"Si\" sub-TLV
advertised with the prefix \"P/m\" in TLV 135, and the prefix \"P/m\" is
the longest matching network prefix for the incoming IPv4
packet.[¶](#section-2.10.1-2){.pilcrow}

For the CONTINUE operation, an example of a method used to determine the
SID \"Si\" is the case where IS-IS \[[RFC8667](#RFC8667){.xref}\]
receives the Prefix-SID \"Si\" sub-TLV advertised with prefix \"P\" in
TLV 135, and the top label of the incoming packet matches the MPLS label
in the FIB corresponding to the SID \"Si\" on router
\"R0\".[¶](#section-2.10.1-3){.pilcrow}

The forwarding behavior for PUSH and CONTINUE corresponding to the SID
\"Si\" is as follows:[¶](#section-2.10.1-4){.pilcrow}

-   ::: {#section-2.10.1-5.1}
    If neighbor \"N\" does not support SR or advertises an invalid SRGB
    or a SRGB that is too small for the SID \"Si\",
    then:[¶](#section-2.10.1-5.1.1){.pilcrow}

    -   [If it is possible to send the packet towards neighbor \"N\"
        using standard MPLS forwarding behavior as specified in
        \[[RFC3031](#RFC3031){.xref}\] and
        \[[RFC3032](#RFC3032){.xref}\], forward the packet. The method
        by which a router decides whether it is possible to send the
        packet to \"N\" or not is beyond the scope of this document. For
        example, the router \"R0\" can use the downstream label
        determined by another MCC, such as LDP
        \[[RFC5036](#RFC5036){.xref}\], to send the
        packet.[¶](#section-2.10.1-5.1.2.1){.pilcrow}]{#section-2.10.1-5.1.2.1}
    -   [Else, if there are other usable next hops, use them to forward
        the incoming packet. The method by which the router \"R0\"
        decides on the possibility of using other next hops is beyond
        the scope of this document. For example, the MCC on \"R0\" may
        chose the send an IPv4 packet without pushing any label to
        another next
        hop.[¶](#section-2.10.1-5.1.2.2){.pilcrow}]{#section-2.10.1-5.1.2.2}
    -   [Otherwise, drop the
        packet.[¶](#section-2.10.1-5.1.2.3){.pilcrow}]{#section-2.10.1-5.1.2.3}
    :::

-   ::: {#section-2.10.1-5.2}
    Else,[¶](#section-2.10.1-5.2.1){.pilcrow}

    -   [Calculate the outgoing label as specified in [Section
        2.4](#convert-section-2.4){.xref} using the SRGB of neighbor
        \"N\".[¶](#section-2.10.1-5.2.2.1){.pilcrow}]{#section-2.10.1-5.2.2.1}

    -   ::: {#section-2.10.1-5.2.2.2}
        Determine the outgoing label
        stack[¶](#section-2.10.1-5.2.2.2.1){.pilcrow}

        -   ::: {#section-2.10.1-5.2.2.2.2.1}
            If the operation is
            PUSH:[¶](#section-2.10.1-5.2.2.2.2.1.1){.pilcrow}

            -   [Push the calculated label according to the MPLS label
                pushing rules specified in
                \[[RFC3032](#RFC3032){.xref}\].[¶](#section-2.10.1-5.2.2.2.2.1.2.1){.pilcrow}]{#section-2.10.1-5.2.2.2.2.1.2.1}
            :::

        -   ::: {#section-2.10.1-5.2.2.2.2.2}
            Else,[¶](#section-2.10.1-5.2.2.2.2.2.1){.pilcrow}

            -   [swap the incoming label with the calculated label
                according to the label-swapping rules in
                \[[RFC3031](#RFC3031){.xref}\].[¶](#section-2.10.1-5.2.2.2.2.2.2.1){.pilcrow}]{#section-2.10.1-5.2.2.2.2.2.2.1}
            :::

        -   [Send the packet towards neighbor
            \"N\".[¶](#section-2.10.1-5.2.2.2.2.3){.pilcrow}]{#section-2.10.1-5.2.2.2.2.3}
        :::
    :::
:::
:::

::: {#convert-section-2.10.2}
::: {#section-2.10.2 .section}
#### [2.10.2.](#section-2.10.2){.section-number .selfRef} [Forwarding for the NEXT Operation for Global SIDs](#name-forwarding-for-the-next-ope){.section-name .selfRef} {#name-forwarding-for-the-next-ope}

As specified in [Section 2.7.3](#convert-section-2.7.3){.xref}, the NEXT
operation corresponds to popping the topmost label. The forwarding
behavior is as follows:[¶](#section-2.10.2-1){.pilcrow}

-   [Pop the topmost
    label[¶](#section-2.10.2-2.1){.pilcrow}]{#section-2.10.2-2.1}
-   [Apply the instruction associated with the incoming label that has
    been popped[¶](#section-2.10.2-2.2){.pilcrow}]{#section-2.10.2-2.2}

The action on the packet after popping the topmost label depends on the
instruction associated with the incoming label as well as the contents
of the packet right underneath the top label that was popped. Examples
of the NEXT operation are described in [Appendix
A.1](#convert-section-a.1){.xref}[¶](#section-2.10.2-3){.pilcrow}
:::
:::
:::
:::

::: {#convert-section-2.11}
::: {#section-2.11 .section}
### [2.11.](#section-2.11){.section-number .selfRef} [Forwarding Behavior for Local SIDs](#name-forwarding-behavior-for-loc){.section-name .selfRef} {#name-forwarding-behavior-for-loc}

This section specifies the forwarding behavior for Local SIDs when SR is
instantiated over the MPLS forwarding
plane.[¶](#section-2.11-1){.pilcrow}

::: {#convert-section-2.11.1}
::: {#section-2.11.1 .section}
#### [2.11.1.](#section-2.11.1){.section-number .selfRef} [Forwarding for the PUSH Operation on Local SIDs](#name-forwarding-for-the-push-ope){.section-name .selfRef} {#name-forwarding-for-the-push-ope}

Suppose an MCC on router \"R0\" determines that the PUSH operation is to
be applied to an incoming packet using the Local SID \"Si\" before
sending the packet towards neighbor \"N\", which is directly connected
to R0 through a physical or virtual interface such as a UDP tunnel
\[[RFC7510](#RFC7510){.xref}\] or L2TPv3 tunnel
\[[RFC4817](#RFC4817){.xref}\].[¶](#section-2.11.1-1){.pilcrow}

An example of such a Local SID is an Adj-SID allocated and advertised by
IS-IS \[[RFC8667](#RFC8667){.xref}\]. The method by which the MCC on
\"R0\" determines that the PUSH operation is to be applied to the
incoming packet is beyond the scope of this document. An example of such
a method is the backup path used to protect against a failure using
TI-LFA
\[[FAST-REROUTE](#FAST-REROUTE){.xref}\].[¶](#section-2.11.1-2){.pilcrow}

As mentioned in \[[RFC8402](#RFC8402){.xref}\], a Local SID is specified
by an MPLS label. Hence, the PUSH operation for a Local SID is identical
to the label push operation using any MPLS label
\[[RFC3031](#RFC3031){.xref}\]. The forwarding action after pushing the
MPLS label corresponding to the Local SID is also determined by the MCC.
For example, if the PUSH operation was done to forward a packet over a
backup path calculated using TI-LFA, then the forwarding action may be
sending the packet to a certain neighbor that will in turn continue to
forward the packet along the backup
path.[¶](#section-2.11.1-3){.pilcrow}
:::
:::

::: {#convert-section-2.11.2}
::: {#section-2.11.2 .section}
#### [2.11.2.](#section-2.11.2){.section-number .selfRef} [Forwarding for the CONTINUE Operation for Local SIDs](#name-forwarding-for-the-continue){.section-name .selfRef} {#name-forwarding-for-the-continue}

A Local SID on router \"R0\" corresponds to a local label. In such a
scenario, the outgoing label towards next hop \"N\" is determined by the
MCC running on the router \"R0\", and the forwarding behavior for the
CONTINUE operation is identical to the swap operation on an MPLS label
\[[RFC3031](#RFC3031){.xref}\].[¶](#section-2.11.2-1){.pilcrow}
:::
:::

::: {#convert-section-2.11.3}
::: {#section-2.11.3 .section}
#### [2.11.3.](#section-2.11.3){.section-number .selfRef} [Outgoing Label for the NEXT Operation for Local SIDs](#name-outgoing-label-for-the-next){.section-name .selfRef} {#name-outgoing-label-for-the-next}

The NEXT operation for Local SIDs is identical to the NEXT operation for
global SIDs as specified in [Section
2.10.2](#convert-section-2.10.2){.xref}.[¶](#section-2.11.3-1){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#convert-section-3}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-3-1){.pilcrow}
:::
:::

::: {#convert-section-4}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Manageability Considerations](#name-manageability-consideration){.section-name .selfRef} {#name-manageability-consideration}

This document describes the applicability of Segment Routing over the
MPLS data plane. Segment Routing does not introduce any change in the
MPLS data plane. Manageability considerations described in
\[[RFC8402](#RFC8402){.xref}\] apply to the MPLS data plane when used
with Segment Routing. SR Operations, Administration, and Maintenance
(OAM) use cases for the MPLS data plane are defined in
\[[RFC8403](#RFC8403){.xref}\]. SR OAM procedures for the MPLS data
plane are defined in
\[[RFC8287](#RFC8287){.xref}\].[¶](#section-4-1){.pilcrow}
:::
:::

::: {#convert-section-5}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

This document does not introduce additional security requirements and
mechanisms other than the ones described in
\[[RFC8402](#RFC8402){.xref}\].[¶](#section-5-1){.pilcrow}
:::
:::

::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.

\[RFC3031\]
:   [Rosen, E.]{.refAuthor}[, Viswanathan, A.]{.refAuthor}[, and R.
    Callon]{.refAuthor}, [\"Multiprotocol Label Switching
    Architecture\"]{.refTitle}, [RFC 3031]{.seriesInfo}, [DOI
    10.17487/RFC3031]{.seriesInfo}, January 2001,
    \<<https://www.rfc-editor.org/info/rfc3031>\>.

\[RFC3032\]
:   [Rosen, E.]{.refAuthor}[, Tappan, D.]{.refAuthor}[,
    Fedorkow, G.]{.refAuthor}[, Rekhter, Y.]{.refAuthor}[,
    Farinacci, D.]{.refAuthor}[, Li, T.]{.refAuthor}[, and A.
    Conta]{.refAuthor}, [\"MPLS Label Stack Encoding\"]{.refTitle}, [RFC
    3032]{.seriesInfo}, [DOI 10.17487/RFC3032]{.seriesInfo}, January
    2001, \<<https://www.rfc-editor.org/info/rfc3032>\>.

\[RFC3443\]
:   [Agarwal, P.]{.refAuthor}[ and B. Akyol]{.refAuthor}, [\"Time To
    Live (TTL) Processing in Multi-Protocol Label Switching (MPLS)
    Networks\"]{.refTitle}, [RFC 3443]{.seriesInfo}, [DOI
    10.17487/RFC3443]{.seriesInfo}, January 2003,
    \<<https://www.rfc-editor.org/info/rfc3443>\>.

\[RFC5462\]
:   [Andersson, L.]{.refAuthor}[ and R. Asati]{.refAuthor},
    [\"Multiprotocol Label Switching (MPLS) Label Stack Entry: \"EXP\"
    Field Renamed to \"Traffic Class\" Field\"]{.refTitle}, [RFC
    5462]{.seriesInfo}, [DOI 10.17487/RFC5462]{.seriesInfo}, February
    2009, \<<https://www.rfc-editor.org/info/rfc5462>\>.

\[RFC7274\]
:   [Kompella, K.]{.refAuthor}[, Andersson, L.]{.refAuthor}[, and A.
    Farrel]{.refAuthor}, [\"Allocating and Retiring Special-Purpose MPLS
    Labels\"]{.refTitle}, [RFC 7274]{.seriesInfo}, [DOI
    10.17487/RFC7274]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7274>\>.

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.

\[RFC8402\]
:   [Filsfils, C., Ed.]{.refAuthor}[, Previdi, S., Ed.]{.refAuthor}[,
    Ginsberg, L.]{.refAuthor}[, Decraene, B.]{.refAuthor}[,
    Litkowski, S.]{.refAuthor}[, and R. Shakir]{.refAuthor}, [\"Segment
    Routing Architecture\"]{.refTitle}, [RFC 8402]{.seriesInfo}, [DOI
    10.17487/RFC8402]{.seriesInfo}, July 2018,
    \<<https://www.rfc-editor.org/info/rfc8402>\>.
:::

::: {#section-6.2 .section}
### [6.2.](#section-6.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[FAST-REROUTE\]
:   [Litkowski, S.]{.refAuthor}[, Bashandy, A.]{.refAuthor}[,
    Filsfils, C.]{.refAuthor}[, Decraene, B.]{.refAuthor}[,
    Francois, P.]{.refAuthor}[, Voyer, D.]{.refAuthor}[,
    Clad, F.]{.refAuthor}[, and P. Camarillo]{.refAuthor}, [\"Topology
    Independent Fast Reroute using Segment Routing\"]{.refTitle}, [Work
    in Progress]{.refContent}, [Internet-Draft,
    draft-ietf-rtgwg-segment-routing-ti-lfa-01]{.seriesInfo}, 5 March
    2019,
    \<<https://tools.ietf.org/html/draft-ietf-rtgwg-segment-routing-ti-lfa-01>\>.

\[RFC4817\]
:   [Townsley, M.]{.refAuthor}[, Pignataro, C.]{.refAuthor}[,
    Wainner, S.]{.refAuthor}[, Seely, T.]{.refAuthor}[, and J.
    Young]{.refAuthor}, [\"Encapsulation of MPLS over Layer 2 Tunneling
    Protocol Version 3\"]{.refTitle}, [RFC 4817]{.seriesInfo}, [DOI
    10.17487/RFC4817]{.seriesInfo}, March 2007,
    \<<https://www.rfc-editor.org/info/rfc4817>\>.

\[RFC5036\]
:   [Andersson, L., Ed.]{.refAuthor}[, Minei, I., Ed.]{.refAuthor}[,
    and B. Thomas, Ed.]{.refAuthor}, [\"LDP Specification\"]{.refTitle},
    [RFC 5036]{.seriesInfo}, [DOI 10.17487/RFC5036]{.seriesInfo},
    October 2007, \<<https://www.rfc-editor.org/info/rfc5036>\>.

\[RFC5331\]
:   [Aggarwal, R.]{.refAuthor}[, Rekhter, Y.]{.refAuthor}[, and E.
    Rosen]{.refAuthor}, [\"MPLS Upstream Label Assignment and
    Context-Specific Label Space\"]{.refTitle}, [RFC 5331]{.seriesInfo},
    [DOI 10.17487/RFC5331]{.seriesInfo}, August 2008,
    \<<https://www.rfc-editor.org/info/rfc5331>\>.

\[RFC7510\]
:   [Xu, X.]{.refAuthor}[, Sheth, N.]{.refAuthor}[,
    Yong, L.]{.refAuthor}[, Callon, R.]{.refAuthor}[, and D.
    Black]{.refAuthor}, [\"Encapsulating MPLS in UDP\"]{.refTitle}, [RFC
    7510]{.seriesInfo}, [DOI 10.17487/RFC7510]{.seriesInfo}, April 2015,
    \<<https://www.rfc-editor.org/info/rfc7510>\>.

\[RFC7855\]
:   [Previdi, S., Ed.]{.refAuthor}[, Filsfils, C., Ed.]{.refAuthor}[,
    Decraene, B.]{.refAuthor}[, Litkowski, S.]{.refAuthor}[,
    Horneffer, M.]{.refAuthor}[, and R. Shakir]{.refAuthor}, [\"Source
    Packet Routing in Networking (SPRING) Problem Statement and
    Requirements\"]{.refTitle}, [RFC 7855]{.seriesInfo}, [DOI
    10.17487/RFC7855]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7855>\>.

\[RFC8287\]
:   [Kumar, N., Ed.]{.refAuthor}[, Pignataro, C., Ed.]{.refAuthor}[,
    Swallow, G.]{.refAuthor}[, Akiya, N.]{.refAuthor}[,
    Kini, S.]{.refAuthor}[, and M. Chen]{.refAuthor}, [\"Label Switched
    Path (LSP) Ping/Traceroute for Segment Routing (SR) IGP-Prefix and
    IGP-Adjacency Segment Identifiers (SIDs) with MPLS Data
    Planes\"]{.refTitle}, [RFC 8287]{.seriesInfo}, [DOI
    10.17487/RFC8287]{.seriesInfo}, December 2017,
    \<<https://www.rfc-editor.org/info/rfc8287>\>.

\[RFC8403\]
:   [Geib, R., Ed.]{.refAuthor}[, Filsfils, C.]{.refAuthor}[, Pignataro,
    C., Ed.]{.refAuthor}[, and N. Kumar]{.refAuthor}, [\"A Scalable and
    Topology-Aware MPLS Data-Plane Monitoring System\"]{.refTitle}, [RFC
    8403]{.seriesInfo}, [DOI 10.17487/RFC8403]{.seriesInfo}, July 2018,
    \<<https://www.rfc-editor.org/info/rfc8403>\>.

\[RFC8661\]
:   [Bashandy, A., Ed.]{.refAuthor}[, Filsfils, C., Ed.]{.refAuthor}[,
    Previdi, S.]{.refAuthor}[, Decraene, B.]{.refAuthor}[, and S.
    Litkowski]{.refAuthor}, [\"Segment Routing MPLS Interworking with
    LDP\"]{.refTitle}, [RFC 8661]{.seriesInfo}, [DOI
    10.17487/RFC8661]{.seriesInfo}, December 2019,
    \<<https://www.rfc-editor.org/info/rfC8661>\>.

\[RFC8665\]
:   [Psenak, P., Ed.]{.refAuthor}[, Previdi, S., Ed.]{.refAuthor}[,
    Filsfils, C.]{.refAuthor}[, Gredler, H.]{.refAuthor}[,
    Shakir, R.]{.refAuthor}[, Henderickx, W.]{.refAuthor}[, and J.
    Tantsura]{.refAuthor}, [\"OSPF Extensions for Segment
    Routing\"]{.refTitle}, [RFC 8665]{.seriesInfo}, [DOI
    10.17487/RFC8665]{.seriesInfo}, December 2019,
    \<<https://www.rfc-editor.org/info/rfc8665>\>.

\[RFC8666\]
:   [Psenak, P., Ed.]{.refAuthor}[ and S. Previdi, Ed.]{.refAuthor},
    [\"OSPFv3 Extensions for Segment Routing\"]{.refTitle}, [RFC
    8666]{.seriesInfo}, [DOI 10.17487/RFC8666]{.seriesInfo}, December
    2019, \<<https://www.rfc-editor.org/info/rfc8666>\>.

\[RFC8667\]
:   [Previdi, S., Ed.]{.refAuthor}[, Ginsberg, L., Ed.]{.refAuthor}[,
    Filsfils, C.]{.refAuthor}[, Bashandy, A.]{.refAuthor}[,
    Gredler, H.]{.refAuthor}[, and B. Decraene]{.refAuthor}, [\"IS-IS
    Extensions for Segment Routing\"]{.refTitle}, [RFC
    8667]{.seriesInfo}, [DOI 10.17487/RFC8667]{.seriesInfo}, December
    2019, \<<https://www.rfc-editor.org/info/rfc8667>\>.

\[ROUTING-POLICY\]
:   [Filsfils, C.]{.refAuthor}[, Sivabalan, S.]{.refAuthor}[,
    Voyer, D.]{.refAuthor}[, Bogdanov, A.]{.refAuthor}[, and P.
    Mattes]{.refAuthor}, [\"Segment Routing Policy
    Architecture\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft,
    draft-ietf-spring-segment-routing-policy-05]{.seriesInfo}, 17
    November 2019,
    \<<https://tools.ietf.org/html/draft-ietf-spring-segment-routing-policy-05>\>.
:::
:::

::: {#convert-section-a}
::: {#section-appendix.a .section}
## [Appendix A.](#section-appendix.a){.section-number .selfRef} [Examples](#name-examples){.section-name .selfRef} {#name-examples}

::: {#convert-section-a.1}
::: {#section-a.1 .section}
## [A.1.](#section-a.1){.section-number .selfRef} [IGP Segment Examples](#name-igp-segment-examples){.section-name .selfRef} {#name-igp-segment-examples}

Consider the network diagram of [Figure 1](#fig1){.xref} and the IP
addresses and IGP segment allocations of [Figure 2](#fig2){.xref}.
Assume that the network is running IS-IS with SR extensions
\[[RFC8667](#RFC8667){.xref}\], and all links have the same metric. The
following examples can be constructed.[¶](#section-a.1-1){.pilcrow}

[]{#name-igp-segments-illustration}

::: {#fig1}
::: {#section-a.1-2.1 .artwork .art-text .alignLeft}
                                 +--------+
                                /          \
                 R0-----R1-----R2----------R3-----R8
                               | \        / |
                               |  +--R4--+  |
                               |            |
                               +-----R5-----+
:::

[Figure 1](#figure-1){.selfRef}: [IGP Segments \--
Illustration](#name-igp-segments-illustration){.selfRef}
:::

[]{#name-igp-address-and-segment-all}

::: {#fig2}
::: {#section-a.1-3.1 .artwork .art-text .alignLeft}
           +-----------------------------------------------------------+
           | IP addresses allocated by the operator:                   |
           |                      192.0.2.1/32 as a loopback of R1     |
           |                      192.0.2.2/32 as a loopback of R2     |
           |                      192.0.2.3/32 as a loopback of R3     |
           |                      192.0.2.4/32 as a loopback of R4     |
           |                      192.0.2.5/32 as a loopback of R5     |
           |                      192.0.2.8/32 as a loopback of R8     |
           |              198.51.100.9/32 as an anycast loopback of R4 |
           |              198.51.100.9/32 as an anycast loopback of R5 |
           |                                                           |
           | SRGB defined by the operator as [1000,5000]               |
           |                                                           |
           | Global IGP SID indices allocated by the operator:         |
           |                      1 allocated to 192.0.2.1/32          |
           |                      2 allocated to 192.0.2.2/32          |
           |                      3 allocated to 192.0.2.3/32          |
           |                      4 allocated to 192.0.2.4/32          |
           |                      8 allocated to 192.0.2.8/32          |
           |                   1009 allocated to 198.51.100.9/32       |
           |                                                           |
           | Local IGP SID allocated dynamically by R2                 |
           |                     for its "north" adjacency to R3: 9001 |
           |                     for its "east" adjacency to R3 : 9002 |
           |                     for its "south" adjacency to R3: 9003 |
           |                     for its only adjacency to R4   : 9004 |
           |                     for its only adjacency to R1   : 9005 |
           +-----------------------------------------------------------+
:::

[Figure 2](#figure-2){.selfRef}: [IGP Address and Segment Allocation \--
Illustration](#name-igp-address-and-segment-all){.selfRef}
:::

Suppose R1 wants to send IPv4 packet P1 to R8. In this case, R1 needs to
apply the PUSH operation to the IPv4
packet.[¶](#section-a.1-4){.pilcrow}

Remember that the SID index \"8\" is a global IGP segment attached to
the IP prefix 192.0.2.8/32. Its semantic is global within the IGP
domain: any router forwards a packet received with active segment 8 to
the next hop along the ECMP-aware shortest path to the related
prefix.[¶](#section-a.1-5){.pilcrow}

R2 is the next hop along the shortest path towards R8. By applying the
steps in [Section 2.8](#convert-section-2.8){.xref}, the outgoing label
downloaded to R1\'s FIB corresponding to the global SID index \"8\" is
1008 because the SRGB of R2 = \[1000,5000\] as shown in [Figure
2](#fig2){.xref}.[¶](#section-a.1-6){.pilcrow}

Because the packet is IPv4, R1 applies the PUSH operation using the
label value 1008 as specified in [Section
2.10.1](#convert-section-2.10.1){.xref}. The resulting MPLS header will
have the \"S\" bit \[[RFC3032](#RFC3032){.xref}\] set because it is
followed directly by an IPv4 packet.[¶](#section-a.1-7){.pilcrow}

The packet arrives at router R2. Because top label 1008 corresponds to
the IGP SID index \"8\", which is the Prefix-SID attached to the prefix
192.0.2.8/32 owned by Node R8, the instruction associated with the SID
is \"forward the packet using one of the ECMP interfaces or next hops
along the shortest path(s) towards R8\". Because R2 is not the
penultimate hop, R2 applies the CONTINUE operation to the packet and
sends it to R3 using one of the two links connected to R3 with top label
1008 as specified in [Section
2.10.1](#convert-section-2.10.1){.xref}.[¶](#section-a.1-8){.pilcrow}

R3 receives the packet with top label 1008. Because top label 1008
corresponds to the IGP SID index \"8\", which is the Prefix-SID attached
to the prefix 192.0.2.8/32 owned by Node R8, the instruction associated
with the SID is \"send the packet using one of the ECMP interfaces and
next hops along the shortest path towards R8\". Because R3 is the
penultimate hop, we assume that R3 performs penultimate hop popping,
which corresponds to the NEXT operation; the packet is then sent to R8.
The NEXT operation results in popping the outer label and sending the
packet as a pure IPv4 packet to R8.[¶](#section-a.1-9){.pilcrow}

In conclusion, the path followed by P1 is R1-R2\--R3-R8. The ECMP
awareness ensures that the traffic is load-shared between any ECMP path;
in this case, it\'s the two links between R2 and
R3.[¶](#section-a.1-10){.pilcrow}
:::
:::

::: {#convert-section-a.2}
::: {#section-a.2 .section}
## [A.2.](#section-a.2){.section-number .selfRef} [Incoming Label Collision Examples](#name-incoming-label-collision-ex){.section-name .selfRef} {#name-incoming-label-collision-ex}

This section outlines several examples to illustrate the handling of
label collision described in [Section
2.5](#convert-section-2.5){.xref}.[¶](#section-a.2-1){.pilcrow}

For the examples in this section, we assume that Node A has the
following:[¶](#section-a.2-2){.pilcrow}

-   [OSPF default admin distance for
    implementation=50[¶](#section-a.2-3.1){.pilcrow}]{#section-a.2-3.1}
-   [IS-IS default admin distance for
    implementation=60[¶](#section-a.2-3.2){.pilcrow}]{#section-a.2-3.2}

::: {#convert-section-a.2.1}
::: {#section-a.2.1 .section}
### [A.2.1.](#section-a.2.1){.section-number .selfRef} [Example 1](#name-example-1){.section-name .selfRef} {#name-example-1}

The following example illustrates incoming label collision resolution
for the same FEC type using MCC administrative
distance.[¶](#section-a.2.1-1){.pilcrow}

FEC1:[¶](#section-a.2.1-2){.pilcrow}

Node A receives an OSPF Prefix-SID Advertisement from Node B for
198.51.100.5/32 with index=5. Assuming that OSPF SRGB on Node A =
\[1000,1999\], the incoming label is
1005.[¶](#section-a.2.1-3){.pilcrow}

FEC2:[¶](#section-a.2.1-4){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node C for
203.0.113.105/32 with index=5. Assuming that IS-IS SRGB on Node A =
\[1000,1999\], the incoming label is
1005.[¶](#section-a.2.1-5){.pilcrow}

FEC1 and FEC2 both use dynamic SID assignment. Since neither of the FECs
are of type \'SR Policy\', we use the default admin distances of 50 and
60 to break the tie. So FEC1 wins.[¶](#section-a.2.1-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.2}
::: {#section-a.2.2 .section}
### [A.2.2.](#section-a.2.2){.section-number .selfRef} [Example 2](#name-example-2){.section-name .selfRef} {#name-example-2}

The following example Illustrates incoming label collision resolution
for different FEC types using the MCC administrative
distance.[¶](#section-a.2.2-1){.pilcrow}

FEC1:[¶](#section-a.2.2-2){.pilcrow}

Node A receives an OSPF Prefix-SID Advertisement from Node B for
198.51.100.6/32 with index=6. Assuming that OSPF SRGB on Node A =
\[1000,1999\], the incoming label on Node A corresponding to
198.51.100.6/32 is 1006.[¶](#section-a.2.2-3){.pilcrow}

FEC2:[¶](#section-a.2.2-4){.pilcrow}

IS-IS on Node A assigns label 1006 to the globally significant Adj-SID
(i.e., when advertised, the L-Flag is clear in the Adj-SID sub-TLV as
described in \[[RFC8667](#RFC8667){.xref}\]). Hence, the incoming label
corresponding to this Adj-SID is 1006. Assume Node A allocates this
Adj-SID dynamically, and it may differ across router
reboots.[¶](#section-a.2.2-5){.pilcrow}

FEC1 and FEC2 both use dynamic SID assignment. Since neither of the FECs
are of type \'SR Policy\', we use the default admin distances of 50 and
60 to break the tie. So FEC1 wins.[¶](#section-a.2.2-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.3}
::: {#section-a.2.3 .section}
### [A.2.3.](#section-a.2.3){.section-number .selfRef} [Example 3](#name-example-3){.section-name .selfRef} {#name-example-3}

The following example illustrates incoming label collision resolution
based on preferring static over dynamic SID
assignment.[¶](#section-a.2.3-1){.pilcrow}

FEC1:[¶](#section-a.2.3-2){.pilcrow}

OSPF on Node A receives a Prefix-SID Advertisement from Node B for
198.51.100.7/32 with index=7. Assuming that the OSPF SRGB on Node A =
\[1000,1999\], the incoming label corresponding to 198.51.100.7/32 is
1007.[¶](#section-a.2.3-3){.pilcrow}

FEC2:[¶](#section-a.2.3-4){.pilcrow}

The operator on Node A configures IS-IS on Node A to assign label 1007
to the globally significant Adj-SID (i.e., when advertised, the L-Flag
is clear in the Adj-SID sub-TLV as described in
\[[RFC8667](#RFC8667){.xref}\]).[¶](#section-a.2.3-5){.pilcrow}

Node A assigns this Adj-SID explicitly via configuration, so the Adj-SID
survives router reboots.[¶](#section-a.2.3-6){.pilcrow}

FEC1 uses dynamic SID assignment, while FEC2 uses explicit SID
assignment. So FEC2 wins.[¶](#section-a.2.3-7){.pilcrow}
:::
:::

::: {#convert-section-a.2.4}
::: {#section-a.2.4 .section}
### [A.2.4.](#section-a.2.4){.section-number .selfRef} [Example 4](#name-example-4){.section-name .selfRef} {#name-example-4}

The following example illustrates incoming label collision resolution
using FEC type default administrative
distance.[¶](#section-a.2.4-1){.pilcrow}

FEC1:[¶](#section-a.2.4-2){.pilcrow}

OSPF on Node A receives a Prefix-SID Advertisement from Node B for
198.51.100.8/32 with index=8. Assuming that OSPF SRGB on Node A =
\[1000,1999\], the incoming label corresponding to 198.51.100.8/32 is
1008.[¶](#section-a.2.4-3){.pilcrow}

FEC2:[¶](#section-a.2.4-4){.pilcrow}

Suppose the SR Policy Advertisement from the controller to Node A for
the policy identified by (Endpoint = 192.0.2.208, color = 100) that
consists of SID-List=\<S1, S2> assigns the globally significant
Binding-SID label 1008.[¶](#section-a.2.4-5){.pilcrow}

From the point of view of Node A, FEC1 and FEC2 both use dynamic SID
assignment. Based on the default administrative distance outlined in
[Section 2.5.1](#convert-section-2.5.1){.xref}, the Binding SID has a
higher administrative distance than the Prefix-SID; hence, FEC1
wins.[¶](#section-a.2.4-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.5}
::: {#section-a.2.5 .section}
### [A.2.5.](#section-a.2.5){.section-number .selfRef} [Example 5](#name-example-5){.section-name .selfRef} {#name-example-5}

The following example illustrates incoming label collision resolution
based on FEC type preference.[¶](#section-a.2.5-1){.pilcrow}

FEC1:[¶](#section-a.2.5-2){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node B for
203.0.113.110/32 with index=10. Assuming that the IS-IS SRGB on Node A =
\[1000,1999\], the incoming label corresponding to 203.0.113.110/32 is
1010.[¶](#section-a.2.5-3){.pilcrow}

FEC2:[¶](#section-a.2.5-4){.pilcrow}

IS-IS on Node A assigns label 1010 to the globally significant Adj-SID
(i.e., when advertised, the L-Flag is clear in the Adj-SID sub-TLV as
described in
\[[RFC8667](#RFC8667){.xref}\]).[¶](#section-a.2.5-5){.pilcrow}

Node A allocates this Adj-SID dynamically, and it may differ across
router reboots. Hence, both FEC1 and FEC2 both use dynamic SID
assignment.[¶](#section-a.2.5-6){.pilcrow}

Since both FECs are from the same MCC, they have the same default admin
distance. So we compare the FEC type codepoints. FEC1 has FEC type
codepoint=120, while FEC2 has FEC type codepoint=130. Therefore, FEC1
wins.[¶](#section-a.2.5-7){.pilcrow}
:::
:::

::: {#convert-section-a.2.6}
::: {#section-a.2.6 .section}
### [A.2.6.](#section-a.2.6){.section-number .selfRef} [Example 6](#name-example-6){.section-name .selfRef} {#name-example-6}

The following example illustrates incoming label collision resolution
based on address family preference.[¶](#section-a.2.6-1){.pilcrow}

FEC1:[¶](#section-a.2.6-2){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node B for
203.0.113.111/32 with index=11. Assuming that the IS-IS SRGB on Node A =
\[1000,1999\], the incoming label on Node A for 203.0.113.111/32 is
1011.[¶](#section-a.2.6-3){.pilcrow}

FEC2:[¶](#section-a.2.6-4){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node C for
2001:DB8:1000::11/128 with index=11. Assuming that the IS-IS SRGB on
Node A = \[1000,1999\], the incoming label on Node A for
2001:DB8:1000::11/128 is 1011.[¶](#section-a.2.6-5){.pilcrow}

FEC1 and FEC2 both use dynamic SID assignment. Since both FECs are from
the same MCC, they have the same default admin distance. So we compare
the FEC type codepoints. Both FECs have FEC type codepoint=120. So we
compare the address family. Since IPv4 is preferred over IPv6, FEC1
wins.[¶](#section-a.2.6-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.7}
::: {#section-a.2.7 .section}
### [A.2.7.](#section-a.2.7){.section-number .selfRef} [Example 7](#name-example-7){.section-name .selfRef} {#name-example-7}

The following example illustrates incoming label collision resolution
based on prefix length.[¶](#section-a.2.7-1){.pilcrow}

FEC1:[¶](#section-a.2.7-2){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node B for
203.0.113.112/32 with index=12. Assuming that IS-IS SRGB on Node A =
\[1000,1999\], the incoming label for 203.0.113.112/32 on Node A is
1012.[¶](#section-a.2.7-3){.pilcrow}

FEC2:[¶](#section-a.2.7-4){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node C for
203.0.113.128/30 with index=12. Assuming that the IS-IS SRGB on Node A =
\[1000,1999\], the incoming label for 203.0.113.128/30 on Node A is
1012.[¶](#section-a.2.7-5){.pilcrow}

FEC1 and FEC2 both use dynamic SID assignment. Since both FECs are from
the same MCC, they have the same default admin distance. So we compare
the FEC type codepoints. Both FECs have FEC type codepoint=120. So we
compare the address family. Both are a part of the IPv4 address family,
so we compare the prefix length. FEC1 has prefix length=32, and FEC2 has
prefix length=30, so FEC2 wins.[¶](#section-a.2.7-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.8}
::: {#section-a.2.8 .section}
### [A.2.8.](#section-a.2.8){.section-number .selfRef} [Example 8](#name-example-8){.section-name .selfRef} {#name-example-8}

The following example illustrates incoming label collision resolution
based on the numerical value of the FECs.[¶](#section-a.2.8-1){.pilcrow}

FEC1:[¶](#section-a.2.8-2){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node B for
203.0.113.113/32 with index=13. Assuming that IS-IS SRGB on Node A =
\[1000,1999\], the incoming label for 203.0.113.113/32 on Node A is
1013.[¶](#section-a.2.8-3){.pilcrow}

FEC2:[¶](#section-a.2.8-4){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node C for
203.0.113.213/32 with index=13. Assuming that IS-IS SRGB on Node A =
\[1000,1999\], the incoming label for 203.0.113.213/32 on Node A is
1013.[¶](#section-a.2.8-5){.pilcrow}

FEC1 and FEC2 both use dynamic SID assignment. Since both FECs are from
the same MCC, they have the same default admin distance. So we compare
the FEC type codepoints. Both FECs have FEC type codepoint=120. So we
compare the address family. Both are a part of the IPv4 address family,
so we compare the prefix length. Prefix lengths are the same, so we
compare the prefix. FEC1 has the lower prefix, so FEC1
wins.[¶](#section-a.2.8-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.9}
::: {#section-a.2.9 .section}
### [A.2.9.](#section-a.2.9){.section-number .selfRef} [Example 9](#name-example-9){.section-name .selfRef} {#name-example-9}

The following example illustrates incoming label collision resolution
based on the Routing Instance ID.[¶](#section-a.2.9-1){.pilcrow}

FEC1:[¶](#section-a.2.9-2){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node B for
203.0.113.114/32 with index=14. Assume that this IS-IS instance on Node
A has Routing Instance ID = 1000 and SRGB = \[1000,1999\]. Hence, the
incoming label for 203.0.113.114/32 on Node A is
1014.[¶](#section-a.2.9-3){.pilcrow}

FEC2:[¶](#section-a.2.9-4){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node C for
203.0.113.114/32 with index=14. Assume that this is another instance of
IS-IS on Node A but Routing Instance ID = 2000 is different and SRGB =
\[1000,1999\] is the same. Hence, the incoming label for
203.0.113.114/32 on Node A is 1014.[¶](#section-a.2.9-5){.pilcrow}

These two FECs match all the way through the prefix length and prefix.
So the Routing Instance ID breaks the tie, and FEC1
wins.[¶](#section-a.2.9-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.10}
::: {#section-a.2.10 .section}
### [A.2.10.](#section-a.2.10){.section-number .selfRef} [Example 10](#name-example-10){.section-name .selfRef} {#name-example-10}

The following example illustrates incoming label collision resolution
based on the topology ID.[¶](#section-a.2.10-1){.pilcrow}

FEC1:[¶](#section-a.2.10-2){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node B for
203.0.113.115/32 with index=15. Assume that this IS-IS instance on Node
A has Routing Instance ID = 1000. Assume that the prefix advertisement
of 203.0.113.115/32 was received in the IS-IS Multi-topology
advertisement with ID = 50. If the IS-IS SRGB for this routing instance
on Node A = \[1000,1999\], then the incoming label of 203.0.113.115/32
for topology 50 on Node A is 1015.[¶](#section-a.2.10-3){.pilcrow}

FEC2:[¶](#section-a.2.10-4){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node C for
203.0.113.115/32 with index=15. Assume that it has the same Routing
Instance ID = 1000, but 203.0.113.115/32 was advertised with IS-IS
Multi-topology ID = 40, which is different. If the IS-IS SRGB on Node A
= \[1000,1999\], then the incoming label of 203.0.113.115/32 for
topology 40 on Node A is also 1015.[¶](#section-a.2.10-5){.pilcrow}

Since these two FECs match all the way through the prefix length,
prefix, and Routing Instance ID, we compare the IS-IS Multi-topology ID,
so FEC2 wins.[¶](#section-a.2.10-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.11}
::: {#section-a.2.11 .section}
### [A.2.11.](#section-a.2.11){.section-number .selfRef} [Example 11](#name-example-11){.section-name .selfRef} {#name-example-11}

The following example illustrates incoming label collision for
resolution based on the algorithm ID.[¶](#section-a.2.11-1){.pilcrow}

FEC1:[¶](#section-a.2.11-2){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node B for
203.0.113.116/32 with index=16. Assume that IS-IS on Node A has Routing
Instance ID = 1000. Assume that Node B advertised 203.0.113.116/32 with
IS-IS Multi-topology ID = 50 and SR algorithm = 0. Assume that the IS-IS
SRGB on Node A = \[1000,1999\]. Hence, the incoming label corresponding
to this advertisement of 203.0.113.116/32 is
1016.[¶](#section-a.2.11-3){.pilcrow}

FEC2:[¶](#section-a.2.11-4){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node C for
203.0.113.116/32 with index=16. Assume that it is the same IS-IS
instance on Node A with Routing Instance ID = 1000. Also assume that
Node C advertised 203.0.113.116/32 with IS-IS Multi-topology ID = 50 but
with SR algorithm = 22. Since it is the same routing instance, the SRGB
on Node A = \[1000,1999\]. Hence, the incoming label corresponding to
this advertisement of 203.0.113.116/32 by Node C is also
1016.[¶](#section-a.2.11-5){.pilcrow}

Since these two FECs match all the way through in terms of the prefix
length, prefix, Routing Instance ID, and Multi-topology ID, we compare
the SR algorithm IDs, so FEC1 wins.[¶](#section-a.2.11-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.12}
::: {#section-a.2.12 .section}
### [A.2.12.](#section-a.2.12){.section-number .selfRef} [Example 12](#name-example-12){.section-name .selfRef} {#name-example-12}

The following example illustrates incoming label collision resolution
based on the FEC numerical value, independent of how the SID is assigned
to the colliding FECs.[¶](#section-a.2.12-1){.pilcrow}

FEC1:[¶](#section-a.2.12-2){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node B for
203.0.113.117/32 with index=17. Assume that the IS-IS SRGB on Node A =
\[1000,1999\]; thus, the incoming label is
1017.[¶](#section-a.2.12-3){.pilcrow}

FEC2:[¶](#section-a.2.12-4){.pilcrow}

Suppose there is an IS-IS Mapping Server Advertisement (SID / Label
Binding TLV) from Node D that has range = 100 and prefix =
203.0.113.1/32. Suppose this Mapping Server Advertisement generates 100
mappings, one of which maps 203.0.113.17/32 to index=17. Assuming that
it is the same IS-IS instance, the SRGB = \[1000,1999\] and hence the
incoming label for 1017.[¶](#section-a.2.12-5){.pilcrow}

Even though FEC1 comes from a normal Prefix-SID Advertisement and FEC2
is generated from a Mapping Server Advertisement, it is not used as a
tiebreaking parameter. Both FECs use dynamic SID assignment, are from
the same MCC, and have the same FEC type codepoint=120. Their prefix
lengths are the same as well. FEC2 wins based on its lower numerical
prefix value, since 203.0.113.17 is less than
203.0.113.117.[¶](#section-a.2.12-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.13}
::: {#section-a.2.13 .section}
### [A.2.13.](#section-a.2.13){.section-number .selfRef} [Example 13](#name-example-13){.section-name .selfRef} {#name-example-13}

The following example illustrates incoming label collision resolution
based on address family preference.[¶](#section-a.2.13-1){.pilcrow}

FEC1:[¶](#section-a.2.13-2){.pilcrow}

SR Policy Advertisement from the controller to Node A. Endpoint
address=2001:DB8:3000::100, color=100, SID-List=\<S1, S2>, and the
Binding-SID label=1020.[¶](#section-a.2.13-3){.pilcrow}

FEC2:[¶](#section-a.2.13-4){.pilcrow}

SR Policy Advertisement from controller to Node A. Endpoint
address=192.0.2.60, color=100, SID-List=\<S3, S4>, and the Binding-SID
label=1020.[¶](#section-a.2.13-5){.pilcrow}

The FEC tiebreakers match, and they have the same FEC type
codepoint=140. Thus, FEC2 wins based on the IPv4 address family being
preferred over IPv6.[¶](#section-a.2.13-6){.pilcrow}
:::
:::

::: {#convert-section-a.2.14}
::: {#section-a.2.14 .section}
### [A.2.14.](#section-a.2.14){.section-number .selfRef} [Example 14](#name-example-14){.section-name .selfRef} {#name-example-14}

The following example illustrates incoming label resolution based on the
numerical value of the policy endpoint.[¶](#section-a.2.14-1){.pilcrow}

FEC1:[¶](#section-a.2.14-2){.pilcrow}

SR Policy Advertisement from the controller to Node A. Endpoint
address=192.0.2.70, color=100, SID-List=\<S1, S2>, and Binding-SID
label=1021.[¶](#section-a.2.14-3){.pilcrow}

FEC2:[¶](#section-a.2.14-4){.pilcrow}

SR Policy Advertisement from the controller to Node A. Endpoint
address=192.0.2.71, color=100, SID-List=\<S3, S4>, and Binding-SID
label=1021.[¶](#section-a.2.14-5){.pilcrow}

The FEC tiebreakers match, and they have the same address family. Thus,
FEC1 wins by having the lower numerical endpoint address
value.[¶](#section-a.2.14-6){.pilcrow}
:::
:::
:::
:::

::: {#convert-section-a.3}
::: {#section-a.3 .section}
## [A.3.](#section-a.3){.section-number .selfRef} [Examples for the Effect of Incoming Label Collision on an Outgoing Label](#name-examples-for-the-effect-of-){.section-name .selfRef} {#name-examples-for-the-effect-of-}

This section presents examples to illustrate the effect of incoming
label collision on the selection of the outgoing label as described in
[Section 2.6](#convert-section-2.6){.xref}.[¶](#section-a.3-1){.pilcrow}

::: {#convert-section-a.3.1}
::: {#section-a.3.1 .section}
### [A.3.1.](#section-a.3.1){.section-number .selfRef} [Example 1](#name-example-1-2){.section-name .selfRef} {#name-example-1-2}

The following example illustrates the effect of incoming label
resolution on the outgoing label.[¶](#section-a.3.1-1){.pilcrow}

FEC1:[¶](#section-a.3.1-2){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node B for
203.0.113.122/32 with index=22. Assuming that the IS-IS SRGB on Node A =
\[1000,1999\], the corresponding incoming label is
1022.[¶](#section-a.3.1-3){.pilcrow}

FEC2:[¶](#section-a.3.1-4){.pilcrow}

IS-IS on Node A receives a Prefix-SID Advertisement from Node C for
203.0.113.222/32 with index=22. Assuming that the IS-IS SRGB on Node A =
\[1000,1999\], the corresponding incoming label is
1022.[¶](#section-a.3.1-5){.pilcrow}

FEC1 wins based on the lowest numerical prefix value. This means that
Node A installs a transit MPLS forwarding entry to swap incoming label
1022 with outgoing label N and to use outgoing interface I. N is
determined by the index associated with FEC1 (index=22) and the SRGB
advertised by the next-hop node on the shortest path to reach
203.0.113.122/32.[¶](#section-a.3.1-6){.pilcrow}

Node A will generally also install an imposition MPLS forwarding entry
corresponding to FEC1 for incoming prefix=203.0.113.122/32 pushing
outgoing label N, and using outgoing interface
I.[¶](#section-a.3.1-7){.pilcrow}

The rule in [Section 2.6](#convert-section-2.6){.xref} means Node A
[MUST NOT]{.bcp14} install an ingress MPLS forwarding entry
corresponding to FEC2 (the losing FEC, which would be for prefix
203.0.113.222/32).[¶](#section-a.3.1-8){.pilcrow}
:::
:::

::: {#convert-section-a.3.2}
::: {#section-a.3.2 .section}
### [A.3.2.](#section-a.3.2){.section-number .selfRef} [Example 2](#name-example-2-2){.section-name .selfRef} {#name-example-2-2}

The following example illustrates the effect of incoming label collision
resolution on outgoing label programming on Node
A.[¶](#section-a.3.2-1){.pilcrow}

FEC1:[¶](#section-a.3.2-2){.pilcrow}

SR Policy Advertisement from the controller to Node A. Endpoint
address=192.0.2.80, color=100, SID-List=\<S1, S2>, and Binding-SID
label=1023.[¶](#section-a.3.2-3){.pilcrow}

FEC2:[¶](#section-a.3.2-4){.pilcrow}

SR Policy Advertisement from controller to Node A. Endpoint
address=192.0.2.81, color=100, SID-List=\<S3, S4>, and Binding-SID
label=1023.[¶](#section-a.3.2-5){.pilcrow}

FEC1 wins by having the lower numerical endpoint address value. This
means that Node A installs a transit MPLS forwarding entry to swap
incoming label=1023 with outgoing labels, and the outgoing interface is
determined by the SID-List for FEC1.[¶](#section-a.3.2-6){.pilcrow}

In this example, we assume that Node A receives two BGP/VPN
routes:[¶](#section-a.3.2-7){.pilcrow}

-   [R1 with VPN label=V1, BGP next hop = 192.0.2.80, and
    color=100[¶](#section-a.3.2-8.1){.pilcrow}]{#section-a.3.2-8.1}
-   [R2 with VPN label=V2, BGP next hop = 192.0.2.81, and
    color=100[¶](#section-a.3.2-8.2){.pilcrow}]{#section-a.3.2-8.2}

We also assume that Node A has a BGP policy that matches color=100 and
allows its usage as Service Level Agreement (SLA) steering information.
In this case, Node A will install a VPN route with label stack =
\<S1,S2,V1> (corresponding to FEC1).[¶](#section-a.3.2-9){.pilcrow}

The rule described in [Section 2.6](#convert-section-2.6){.xref} means
that Node A [MUST NOT]{.bcp14} install a VPN route with label stack =
\<S3,S4,V1> (corresponding to FEC2.)[¶](#section-a.3.2-10){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#convert-section-7}
::: {#section-appendix.b .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The authors would like to thank Les Ginsberg, Chris Bowers, Himanshu
Shah, Adrian Farrel, Alexander Vainshtein, Przemyslaw Krol, Darren
Dukes, Zafar Ali, and Martin Vigoureux for their valuable comments on
this document.[¶](#section-appendix.b-1){.pilcrow}
:::
:::

::: {#convert-section-6}
::: {#section-appendix.c .section}
## [Contributors](#name-contributors){.section-name .selfRef} {#name-contributors}

The following contributors have substantially helped the definition and
editing of the content of this
document:[¶](#section-appendix.c-1){.pilcrow}

::: {#section-appendix.c-2 .artwork .art-text .alignLeft}
    Martin Horneffer
    Deutsche Telekom
    Email: Martin.Horneffer@telekom.de

[¶](#section-appendix.c-2){.pilcrow}
:::

::: {#section-appendix.c-3 .artwork .art-text .alignLeft}
    Wim Henderickx
    Nokia
    Email: wim.henderickx@nokia.com

[¶](#section-appendix.c-3){.pilcrow}
:::

::: {#section-appendix.c-4 .artwork .art-text .alignLeft}
    Jeff Tantsura
    Email: jefftant@gmail.com

[¶](#section-appendix.c-4){.pilcrow}
:::

::: {#section-appendix.c-5 .artwork .art-text .alignLeft}
    Edward Crabbe
    Email: edward.crabbe@gmail.com

[¶](#section-appendix.c-5){.pilcrow}
:::

::: {#section-appendix.c-6 .artwork .art-text .alignLeft}
    Igor Milojevic
    Email: milojevicigor@gmail.com

[¶](#section-appendix.c-6){.pilcrow}
:::

::: {#section-appendix.c-7 .artwork .art-text .alignLeft}
    Saku Ytti
    Email: saku@ytti.fi

[¶](#section-appendix.c-7){.pilcrow}
:::
:::
:::

::: {#authors-addresses}
::: {#section-appendix.d .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Ahmed Bashandy ([editor]{.role})]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Arrcus]{.org}
:::

::: email
Email: <abashandy.ietf@gmail.com>
:::

::: {.left dir="auto"}
[Clarence Filsfils ([editor]{.role})]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[Brussels]{.street-address}
:::

::: {.left dir="auto"}
[Belgium]{.country-name}
:::

::: email
Email: <cfilsfil@cisco.com>
:::

::: {.left dir="auto"}
[Stefano Previdi]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[Italy]{.country-name}
:::

::: email
Email: <stefano@previdi.net>
:::

::: {.left dir="auto"}
[Bruno Decraene]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Orange]{.org}
:::

::: {.left dir="auto"}
[France]{.country-name}
:::

::: email
Email: <bruno.decraene@orange.com>
:::

::: {.left dir="auto"}
[Stephane Litkowski]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Orange]{.org}
:::

::: {.left dir="auto"}
[France]{.country-name}
:::

::: email
Email: <slitkows.ietf@gmail.com>
:::

::: {.left dir="auto"}
[Rob Shakir]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google]{.org}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <robjs@google.com>
:::
:::
:::
