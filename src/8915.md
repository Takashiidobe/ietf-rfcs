  RFC 8915         Network Time Security for NTP   September 2020
  ---------------- ------------------------------- ----------------
  Franke, et al.   Standards Track                 \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8915](https://www.rfc-editor.org/rfc/rfc8915){.eref}

Category:
:   Standards Track

Published:
:   September 2020

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    D. Franke
    :::

    ::: org
    Akamai
    :::
    :::

    ::: author
    ::: author-name
    D. Sibold
    :::

    ::: org
    PTB
    :::
    :::

    ::: author
    ::: author-name
    K. Teichel
    :::

    ::: org
    PTB
    :::
    :::

    ::: author
    ::: author-name
    M. Dansarie
    :::
    :::

    ::: author
    ::: author-name
    R. Sundblad
    :::

    ::: org
    Netnod
    :::
    :::
:::

# RFC 8915 {#rfcnum}

# Network Time Security for the Network Time Protocol {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This memo specifies Network Time Security (NTS), a mechanism for using
Transport Layer Security (TLS) and Authenticated Encryption with
Associated Data (AEAD) to provide cryptographic security for the
client-server mode of the Network Time Protocol
(NTP).[¶](#section-abstract-1){.pilcrow}

NTS is structured as a suite of two loosely coupled sub-protocols. The
first (NTS Key Establishment (NTS-KE)) handles initial authentication
and key establishment over TLS. The second (NTS Extension Fields for
NTPv4) handles encryption and authentication during NTP time
synchronization via extension fields in the NTP packets, and holds all
required state only on the client via opaque
cookies.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8915>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2020 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Objectives](#name-objectives){.xref}[¶](#section-toc.1-1.1.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.2}
        [1.2](#section-1.2){.xref}.  [Terms and
        Abbreviations](#name-terms-and-abbreviations){.xref}[¶](#section-toc.1-1.1.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.3}
        [1.3](#section-1.3){.xref}.  [Protocol
        Overview](#name-protocol-overview){.xref}[¶](#section-toc.1-1.1.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Requirements
    Language](#name-requirements-language){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [TLS Profile for Network Time
    Security](#name-tls-profile-for-network-tim){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [The NTS Key Establishment
    Protocol](#name-the-nts-key-establishment-p){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [NTS-KE Record
        Types](#name-nts-ke-record-types){.xref}[¶](#section-toc.1-1.4.2.1.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.1.2.1}
            [4.1.1](#section-4.1.1){.xref}.  [End of
            Message](#name-end-of-message){.xref}[¶](#section-toc.1-1.4.2.1.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.2}
            [4.1.2](#section-4.1.2){.xref}.  [NTS Next Protocol
            Negotiation](#name-nts-next-protocol-negotiati){.xref}[¶](#section-toc.1-1.4.2.1.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.3}
            [4.1.3](#section-4.1.3){.xref}.  [Error](#name-error){.xref}[¶](#section-toc.1-1.4.2.1.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.4}
            [4.1.4](#section-4.1.4){.xref}.  [Warning](#name-warning){.xref}[¶](#section-toc.1-1.4.2.1.2.4.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.5}
            [4.1.5](#section-4.1.5){.xref}.  [AEAD Algorithm
            Negotiation](#name-aead-algorithm-negotiation){.xref}[¶](#section-toc.1-1.4.2.1.2.5.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.6}
            [4.1.6](#section-4.1.6){.xref}.  [New Cookie for
            NTPv4](#name-new-cookie-for-ntpv4){.xref}[¶](#section-toc.1-1.4.2.1.2.6.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.7}
            [4.1.7](#section-4.1.7){.xref}.  [NTPv4 Server
            Negotiation](#name-ntpv4-server-negotiation){.xref}[¶](#section-toc.1-1.4.2.1.2.7.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.8}
            [4.1.8](#section-4.1.8){.xref}.  [NTPv4 Port
            Negotiation](#name-ntpv4-port-negotiation){.xref}[¶](#section-toc.1-1.4.2.1.2.8.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [Retry
        Intervals](#name-retry-intervals){.xref}[¶](#section-toc.1-1.4.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [Key Extraction
        (Generally)](#name-key-extraction-generally){.xref}[¶](#section-toc.1-1.4.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [NTS Extension Fields for
    NTPv4](#name-nts-extension-fields-for-nt){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [Key Extraction (for
        NTPv4)](#name-key-extraction-for-ntpv4){.xref}[¶](#section-toc.1-1.5.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [Packet Structure
        Overview](#name-packet-structure-overview){.xref}[¶](#section-toc.1-1.5.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.xref}.  [The Unique Identifier Extension
        Field](#name-the-unique-identifier-exten){.xref}[¶](#section-toc.1-1.5.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.4}
        [5.4](#section-5.4){.xref}.  [The NTS Cookie Extension
        Field](#name-the-nts-cookie-extension-fi){.xref}[¶](#section-toc.1-1.5.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.5}
        [5.5](#section-5.5){.xref}.  [The NTS Cookie Placeholder
        Extension
        Field](#name-the-nts-cookie-placeholder-){.xref}[¶](#section-toc.1-1.5.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.6}
        [5.6](#section-5.6){.xref}.  [The NTS Authenticator and
        Encrypted Extension Fields Extension
        Field](#name-the-nts-authenticator-and-e){.xref}[¶](#section-toc.1-1.5.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.7}
        [5.7](#section-5.7){.xref}.  [Protocol
        Details](#name-protocol-details){.xref}[¶](#section-toc.1-1.5.2.7.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Suggested Format for NTS
    Cookies](#name-suggested-format-for-nts-co){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Service Name and Transport
        Protocol Port Number
        Registry](#name-service-name-and-transport-){.xref}[¶](#section-toc.1-1.7.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [TLS Application-Layer Protocol
        Negotiation (ALPN) Protocol IDs
        Registry](#name-tls-application-layer-proto){.xref}[¶](#section-toc.1-1.7.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.3}
        [7.3](#section-7.3){.xref}.  [TLS Exporter Labels
        Registry](#name-tls-exporter-labels-registr){.xref}[¶](#section-toc.1-1.7.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.4}
        [7.4](#section-7.4){.xref}.  [NTP Kiss-o\'-Death Codes
        Registry](#name-ntp-kiss-o-death-codes-regi){.xref}[¶](#section-toc.1-1.7.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.5}
        [7.5](#section-7.5){.xref}.  [NTP Extension Field Types
        Registry](#name-ntp-extension-field-types-r){.xref}[¶](#section-toc.1-1.7.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.6}
        [7.6](#section-7.6){.xref}.  [Network Time Security Key
        Establishment Record Types
        Registry](#name-network-time-security-key-e){.xref}[¶](#section-toc.1-1.7.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.7}
        [7.7](#section-7.7){.xref}.  [Network Time Security Next
        Protocols
        Registry](#name-network-time-security-next-){.xref}[¶](#section-toc.1-1.7.2.7.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.8}
        [7.8](#section-7.8){.xref}.  [Network Time Security Error and
        Warning Codes
        Registries](#name-network-time-security-error){.xref}[¶](#section-toc.1-1.7.2.8.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Protected
        Modes](#name-protected-modes){.xref}[¶](#section-toc.1-1.8.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Cookie Encryption Key
        Compromise](#name-cookie-encryption-key-compr){.xref}[¶](#section-toc.1-1.8.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.3}
        [8.3](#section-8.3){.xref}.  [Sensitivity to DDoS
        Attacks](#name-sensitivity-to-ddos-attacks){.xref}[¶](#section-toc.1-1.8.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.4}
        [8.4](#section-8.4){.xref}.  [Avoiding DDoS
        Amplification](#name-avoiding-ddos-amplification){.xref}[¶](#section-toc.1-1.8.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.5}
        [8.5](#section-8.5){.xref}.  [Initial Verification of Server
        Certificates](#name-initial-verification-of-ser){.xref}[¶](#section-toc.1-1.8.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.6}
        [8.6](#section-8.6){.xref}.  [Delay
        Attacks](#name-delay-attacks){.xref}[¶](#section-toc.1-1.8.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.7}
        [8.7](#section-8.7){.xref}.  [NTS
        Stripping](#name-nts-stripping){.xref}[¶](#section-toc.1-1.8.2.7.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [Privacy
    Considerations](#name-privacy-considerations){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [Unlinkability](#name-unlinkability){.xref}[¶](#section-toc.1-1.9.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [Confidentiality](#name-confidentiality){.xref}[¶](#section-toc.1-1.9.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.10.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.10.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [](#section-appendix.a){.xref}[Acknowledgments](#name-acknowledgments){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.12}
    [](#section-appendix.b){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

This memo specifies Network Time Security (NTS), a cryptographic
security mechanism for network time synchronization. A complete
specification is provided for application of NTS to the client-server
mode of the [Network Time Protocol (NTP)](#RFC5905){.xref}
\[[RFC5905](#RFC5905){.xref}\].[¶](#section-1-1){.pilcrow}

::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Objectives](#name-objectives){.section-name .selfRef} {#name-objectives}

The objectives of NTS are as follows:[¶](#section-1.1-1){.pilcrow}

-   [Identity: Through the use of a X.509 public key infrastructure,
    implementations can cryptographically establish the identity of the
    parties they are communicating
    with.[¶](#section-1.1-2.1){.pilcrow}]{#section-1.1-2.1}
-   [Authentication: Implementations can cryptographically verify that
    any time synchronization packets are authentic, i.e., that they were
    produced by an identified party and have not been modified in
    transit.[¶](#section-1.1-2.2){.pilcrow}]{#section-1.1-2.2}
-   [Confidentiality: Although basic time synchronization data is
    considered nonconfidential and sent in the clear, NTS includes
    support for encrypting NTP extension
    fields.[¶](#section-1.1-2.3){.pilcrow}]{#section-1.1-2.3}
-   [Replay prevention: Client implementations can detect when a
    received time synchronization packet is a replay of a previous
    packet.[¶](#section-1.1-2.4){.pilcrow}]{#section-1.1-2.4}
-   [Request-response consistency: Client implementations can verify
    that a time synchronization packet received from a server was sent
    in response to a particular request from the
    client.[¶](#section-1.1-2.5){.pilcrow}]{#section-1.1-2.5}
-   [Unlinkability: For mobile clients, NTS will not leak any
    information additional to NTP which would permit a passive adversary
    to determine that two packets sent over different networks came from
    the same client.[¶](#section-1.1-2.6){.pilcrow}]{#section-1.1-2.6}
-   [Non-amplification: Implementations (especially server
    implementations) can avoid acting as distributed denial-of-service
    (DDoS) amplifiers by never responding to a request with a packet
    larger than the request
    packet.[¶](#section-1.1-2.7){.pilcrow}]{#section-1.1-2.7}
-   [Scalability: Server implementations can serve large numbers of
    clients without having to retain any client-specific
    state.[¶](#section-1.1-2.8){.pilcrow}]{#section-1.1-2.8}
-   [Performance: NTS must not significantly degrade the quality of the
    time transfer. The encryption and authentication used when actually
    transferring time should be lightweight (see Section
    [5.7](https://www.rfc-editor.org/rfc/rfc7384#section-5.7){.relref}
    of [RFC 7384](#RFC7384){.xref}
    \[[RFC7384](#RFC7384){.xref}\]).[¶](#section-1.1-2.9){.pilcrow}]{#section-1.1-2.9}
:::

::: {#section-1.2 .section}
### [1.2.](#section-1.2){.section-number .selfRef} [Terms and Abbreviations](#name-terms-and-abbreviations){.section-name .selfRef} {#name-terms-and-abbreviations}

[]{.break}

AEAD
:   [Authenticated Encryption with Associated Data](#RFC5116){.xref}
    \[[RFC5116](#RFC5116){.xref}\][¶](#section-1.2-1.2){.pilcrow}
:   

ALPN
:   [Application-Layer Protocol Negotiation](#RFC7301){.xref}
    \[[RFC7301](#RFC7301){.xref}\][¶](#section-1.2-1.4){.pilcrow}
:   

C2S
:   Client-to-server[¶](#section-1.2-1.6){.pilcrow}
:   

DoS
:   Denial-of-Service[¶](#section-1.2-1.8){.pilcrow}
:   

DDoS
:   Distributed Denial-of-Service[¶](#section-1.2-1.10){.pilcrow}
:   

EF
:   [Extension Field](#RFC5905){.xref}
    \[[RFC5905](#RFC5905){.xref}\][¶](#section-1.2-1.12){.pilcrow}
:   

HKDF
:   [Hashed Message Authentication Code-based Key Derivation
    Function](#RFC5869){.xref}
    \[[RFC5869](#RFC5869){.xref}\][¶](#section-1.2-1.14){.pilcrow}
:   

KoD
:   [Kiss-o\'-Death](#RFC5905){.xref}
    \[[RFC5905](#RFC5905){.xref}\][¶](#section-1.2-1.16){.pilcrow}
:   

NTP
:   [Network Time Protocol](#RFC5905){.xref}
    \[[RFC5905](#RFC5905){.xref}\][¶](#section-1.2-1.18){.pilcrow}
:   

NTS
:   Network Time Security[¶](#section-1.2-1.20){.pilcrow}
:   

NTS NAK
:   NTS negative-acknowledgment[¶](#section-1.2-1.22){.pilcrow}
:   

NTS-KE
:   Network Time Security Key
    Establishment[¶](#section-1.2-1.24){.pilcrow}
:   

S2C
:   Server-to-client[¶](#section-1.2-1.26){.pilcrow}
:   

TLS
:   [Transport Layer Security](#RFC8446){.xref}
    \[[RFC8446](#RFC8446){.xref}\][¶](#section-1.2-1.28){.pilcrow}
:   
:::

::: {#sec-protocol-overview}
::: {#section-1.3 .section}
### [1.3.](#section-1.3){.section-number .selfRef} [Protocol Overview](#name-protocol-overview){.section-name .selfRef} {#name-protocol-overview}

The Network Time Protocol includes many different operating modes to
support various network topologies (see Section
[3](https://www.rfc-editor.org/rfc/rfc5905#section-3){.relref} of [RFC
5905](#RFC5905){.xref} \[[RFC5905](#RFC5905){.xref}\]). In addition to
its best-known and most-widely-used client-server mode, it also includes
modes for synchronization between symmetric peers, a control mode for
server monitoring and administration, and a broadcast mode. These
various modes have differing and partly contradictory requirements for
security and performance. Symmetric and control modes demand mutual
authentication and mutual replay protection. Additionally, for certain
message types, the control mode may require confidentiality as well as
authentication. Client-server mode places more stringent requirements on
resource utilization than other modes because servers may have a vast
number of clients and be unable to afford to maintain per-client state.
However, client-server mode also has more relaxed security needs because
only the client requires replay protection: it is harmless for stateless
servers to process replayed packets. The security demands of symmetric
and control modes, on the other hand, are in conflict with the
resource-utilization demands of client-server mode: any scheme that
provides replay protection inherently involves maintaining some state to
keep track of which messages have already been
seen.[¶](#section-1.3-1){.pilcrow}

This memo specifies NTS exclusively for the client-server mode of NTP.
To this end, NTS is structured as a suite of two
protocols:[¶](#section-1.3-2){.pilcrow}

-   [The \"NTS Extension Fields for NTPv4\" define a collection of NTP
    extension fields for cryptographically securing NTPv4 using
    previously established key material. They are suitable for securing
    client-server mode because the server can implement them without
    retaining per-client state. All state is kept by the client and
    provided to the server in the form of an encrypted cookie supplied
    with each request. On the other hand, the NTS Extension Fields are
    suitable *only* for client-server mode because only the client, and
    not the server, is protected from
    replay.[¶](#section-1.3-3.1){.pilcrow}]{#section-1.3-3.1}
-   [The \"NTS Key Establishment\" protocol (NTS-KE) is a mechanism for
    establishing key material for use with the NTS Extension Fields for
    NTPv4. It uses TLS to establish keys, to provide the client with an
    initial supply of cookies, and to negotiate some additional protocol
    options. After this, the TLS channel is closed with no per-client
    state remaining on the server
    side.[¶](#section-1.3-3.2){.pilcrow}]{#section-1.3-3.2}

The typical protocol flow is as follows: The client connects to an
NTS-KE server on the NTS TCP port and the two parties perform a TLS
handshake. Via the TLS channel, the parties negotiate some additional
protocol parameters, and the server sends the client a supply of cookies
along with an address and port of an NTP server for which the cookies
are valid. The parties use [TLS key export](#RFC5705){.xref}
\[[RFC5705](#RFC5705){.xref}\] to extract key material, which will be
used in the next phase of the protocol. This negotiation takes only a
single round trip, after which the server closes the connection and
discards all associated state. At this point, the NTS-KE phase of the
protocol is complete. Ideally, the client never needs to connect to the
NTS-KE server again.[¶](#section-1.3-4){.pilcrow}

Time synchronization proceeds with the indicated NTP server. The client
sends the server an NTP client packet that includes several extension
fields. Included among these fields are a cookie (previously provided by
the key establishment server) and an authentication tag, computed using
key material extracted from the NTS-KE handshake. The NTP server uses
the cookie to recover this key material and send back an authenticated
response. The response includes a fresh, encrypted cookie that the
client then sends back in the clear in a subsequent request. This
constant refreshing of cookies is necessary in order to achieve NTS\'s
unlinkability goal.[¶](#section-1.3-5){.pilcrow}

[Figure 1](#protocol-overview){.xref} provides an overview of the
high-level interaction between the client, the NTS-KE server, and the
NTP server. Note that the cookies\' data format and the exchange of
secrets between NTS-KE and NTP servers are not part of this
specification and are implementation dependent. However, a suggested
format for NTS cookies is provided in [Section
6](#suggested-format-for-nts-cookies){.xref}.[¶](#section-1.3-6){.pilcrow}

[]{#name-overview-of-high-level-inte}

::: {#protocol-overview}
::: {#section-1.3-7.1 .artwork .art-text .alignLeft}
                                                         +--------------+
                                                         |              |
                                                     +-> | NTP Server 1 |
                                                     |   |              |
                               Shared cookie         |   +--------------+
    +---------------+      encryption parameters     |   +--------------+
    |               |    (Implementation dependent)  |   |              |
    | NTS-KE Server | <------------------------------+-> | NTP Server 2 |
    |               |                                |   |              |
    +---------------+                                |   +--------------+
           ^                                         |          .
           |                                         |          .
           | 1. Negotiate parameters,                |          .
           |    receive initial cookie               |   +--------------+
           |    supply, generate AEAD keys,          |   |              |
           |    and receive NTP server IP            +-> | NTP Server N |
           |    addresses using "NTS Key                 |              |
           |    Establishment" protocol.                 +--------------+
           |                                                    ^
           |                                                    |
           |             +----------+                           |
           |             |          |                           |
           +-----------> |  Client  | <-------------------------+
                         |          |  2. Perform authenticated
                         +----------+     time synchronization
                                          and generate new
                                          cookies using "NTS
                                          Extension Fields for
                                          NTPv4".
:::

[Figure 1](#figure-1){.selfRef}: [Overview of High-Level Interactions in
NTS](#name-overview-of-high-level-inte){.selfRef}
:::
:::
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::

::: {#tls-profile}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [TLS Profile for Network Time Security](#name-tls-profile-for-network-tim){.section-name .selfRef} {#name-tls-profile-for-network-tim}

Network Time Security makes use of TLS for NTS key
establishment.[¶](#section-3-1){.pilcrow}

Since the NTS protocol is new as of this publication, no
backward-compatibility concerns exist to justify using obsolete,
insecure, or otherwise broken TLS features or versions. Implementations
[MUST]{.bcp14} conform with [RFC 7525](#RFC7525){.xref}
\[[RFC7525](#RFC7525){.xref}\] or with a later revision of BCP
195.[¶](#section-3-2){.pilcrow}

Implementations [MUST NOT]{.bcp14} negotiate TLS versions earlier than
1.3 \[[RFC8446](#RFC8446){.xref}\] and [MAY]{.bcp14} refuse to negotiate
any TLS version that has been superseded by a later supported
version.[¶](#section-3-3){.pilcrow}

Use of the [Application-Layer Protocol Negotiation
Extension](#RFC7301){.xref} \[[RFC7301](#RFC7301){.xref}\] is integral
to NTS, and support for it is [REQUIRED]{.bcp14} for
interoperability.[¶](#section-3-4){.pilcrow}

Implementations [MUST]{.bcp14} follow the rules in [RFC
5280](#RFC5280){.xref} \[[RFC5280](#RFC5280){.xref}\] and [RFC
6125](#RFC6125){.xref} \[[RFC6125](#RFC6125){.xref}\] for the
representation and verification of the application\'s service identity.
When NTS-KE service discovery (out of scope for this document) produces
one or more host names, use of the [DNS-ID identifier
type](#RFC6125){.xref} \[[RFC6125](#RFC6125){.xref}\] is
[RECOMMENDED]{.bcp14}; specifications for service discovery mechanisms
can provide additional guidance for certificate validation based on the
results of discovery. [Section 8.5](#sec-cert-verification){.xref} of
this memo discusses particular considerations for certificate
verification in the context of NTS.[¶](#section-3-5){.pilcrow}
:::
:::

::: {#nts-ke}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [The NTS Key Establishment Protocol](#name-the-nts-key-establishment-p){.section-name .selfRef} {#name-the-nts-key-establishment-p}

The NTS key establishment protocol is conducted via TCP port 4460. The
two endpoints carry out a TLS handshake in conformance with [Section
3](#tls-profile){.xref}, with the client offering (via an [ALPN
extension](#RFC7301){.xref} \[[RFC7301](#RFC7301){.xref}\]), and the
server accepting, an application-layer protocol of \"ntske/1\".
Immediately following a successful handshake, the client [SHALL]{.bcp14}
send a single request as Application Data encapsulated in the
TLS-protected channel. Then, the server [SHALL]{.bcp14} send a single
response. After sending their respective request and response, the
client and server [SHALL]{.bcp14} send TLS \"close_notify\" alerts in
accordance with Section
[6.1](https://www.rfc-editor.org/rfc/rfc8446#section-6.1){.relref} of
[RFC 8446](#RFC8446){.xref}
\[[RFC8446](#RFC8446){.xref}\].[¶](#section-4-1){.pilcrow}

The client\'s request and the server\'s response each [SHALL]{.bcp14}
consist of a sequence of records formatted according to [Figure
2](#ntske-record){.xref}. The request and a non-error response each
[SHALL]{.bcp14} include exactly one NTS Next Protocol Negotiation
record. The sequence [SHALL]{.bcp14} be terminated by a \"End of
Message\" record. The requirement that all NTS-KE messages be terminated
by an End of Message record makes them
self-delimiting.[¶](#section-4-2){.pilcrow}

Clients and servers [MAY]{.bcp14} enforce length limits on requests and
responses; however, servers [MUST]{.bcp14} accept requests of at least
1024 octets, and clients [SHOULD]{.bcp14} accept responses of at least
65536 octets.[¶](#section-4-3){.pilcrow}

[]{#name-nts-ke-record-format}

::: {#ntske-record}
::: {#section-4-4.1 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |C|         Record Type         |          Body Length          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .                           Record Body                         .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:::

[Figure 2](#figure-2){.selfRef}: [NTS-KE Record
Format](#name-nts-ke-record-format){.selfRef}
:::

The fields of an NTS-KE record are defined as
follows:[¶](#section-4-5){.pilcrow}

[]{.break}

C (Critical Bit):
:   Determines the disposition of unrecognized Record Types.
    Implementations which receive a record with an unrecognized Record
    Type [MUST]{.bcp14} ignore the record if the Critical Bit is 0 and
    [MUST]{.bcp14} treat it as an error if the Critical Bit is 1 (see
    [Section 4.1.3](#nts-error){.xref}).[¶](#section-4-6.2){.pilcrow}
:   

Record Type Number:
:   A 15-bit integer in network byte order. The semantics of Record
    Types 0-7 are specified in this memo. Additional type numbers
    [SHALL]{.bcp14} be tracked through the IANA \"Network Time Security
    Key Establishment Record Types\"
    registry.[¶](#section-4-6.4){.pilcrow}
:   

Body Length:
:   The length of the Record Body field, in octets, as a 16-bit integer
    in network byte order. Record bodies [MAY]{.bcp14} have any
    representable length and need not be aligned to a word
    boundary.[¶](#section-4-6.6){.pilcrow}
:   

Record Body:
:   The syntax and semantics of this field [SHALL]{.bcp14} be determined
    by the Record Type.[¶](#section-4-6.8){.pilcrow}
:   

For clarity regarding bit-endianness: the Critical Bit is the most
significant bit of the first octet. In the C programming language, given
a network buffer \'unsigned char b\[\]\' containing an NTS-KE record,
the critical bit is \'b\[0\] \>\> 7\' while the record type is
\'((b\[0\] & 0x7f) \<\< 8) + b\[1\]\'.[¶](#section-4-7){.pilcrow}

Note that, although the Type-Length-Body format of an NTS-KE record is
similar to that of an NTP extension field, the semantics of the length
field differ. While the length subfield of an NTP extension field gives
the length of the entire extension field including the type and length
subfields, the length field of an NTS-KE record gives just the length of
the body.[¶](#section-4-8){.pilcrow}

[Figure 3](#fig_NTSKeyEstablishment){.xref} provides a schematic
overview of the key establishment. It displays the protocol steps to be
performed by the NTS client and server and Record Types to be
exchanged.[¶](#section-4-9){.pilcrow}

[]{#name-nts-key-establishment-messa}

::: {#fig_NTSKeyEstablishment}
::: {#section-4-10.1 .artwork .art-text .alignLeft}
                    +---------------------------------------+
                    | - Verify client request message.      |
                    | - Extract TLS key material.           |
                    | - Generate KE response message.       |
                    |   - Include Record Types:             |
                    |       o NTS Next Protocol Negotiation |
                    |       o AEAD Algorithm Negotiation    |
                    |       o <NTPv4 Server Negotiation>    |
                    |       o <NTPv4 Port Negotiation>      |
                    |       o New Cookie for NTPv4          |
                    |       o <New Cookie for NTPv4>        |
                    |       o End of Message                |
                    +-----------------+---------------------+
                                      |
                                      |
    Server -----------+---------------+-----+----------------------->
                      ^                      \
                     /                        \
                    /    TLS application       \
                   /     data                   \
                  /                              \
                 /                                V
    Client -----+---------------------------------+----------------->
                |                                 |
                |                                 |
                |                                 |
    +-----------+----------------------+   +------+-----------------+
    |- Generate KE request message.    |   |- Verify server response|
    | - Include Record Types:          |   |  message.              |
    |  o NTS Next Protocol Negotiation |   |- Extract cookie(s).    |
    |  o AEAD Algorithm Negotiation    |   +------------------------+
    |  o <NTPv4 Server Negotiation>    |
    |  o <NTPv4 Port Negotiation>      |
    |  o End of Message                |
    +----------------------------------+
:::

[Figure 3](#figure-3){.selfRef}: [NTS Key Establishment
Messages](#name-nts-key-establishment-messa){.selfRef}
:::

::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [NTS-KE Record Types](#name-nts-ke-record-types){.section-name .selfRef} {#name-nts-ke-record-types}

The following NTS-KE Record Types are
defined:[¶](#section-4.1-1){.pilcrow}

::: {#end-of-message}
::: {#section-4.1.1 .section}
#### [4.1.1.](#section-4.1.1){.section-number .selfRef} [End of Message](#name-end-of-message){.section-name .selfRef} {#name-end-of-message}

The End of Message record has a Record Type number of 0 and a
zero-length body. It [MUST]{.bcp14} occur exactly once as the final
record of every NTS-KE request and response. The Critical Bit
[MUST]{.bcp14} be set.[¶](#section-4.1.1-1){.pilcrow}
:::
:::

::: {#nts-next-protocol-negotiation}
::: {#section-4.1.2 .section}
#### [4.1.2.](#section-4.1.2){.section-number .selfRef} [NTS Next Protocol Negotiation](#name-nts-next-protocol-negotiati){.section-name .selfRef} {#name-nts-next-protocol-negotiati}

The NTS Next Protocol Negotiation record has a Record Type number of 1.
It [MUST]{.bcp14} occur exactly once in every NTS-KE request and
response. Its body consists of a sequence of 16-bit unsigned integers in
network byte order. Each integer represents a Protocol ID from the IANA
\"Network Time Security Next Protocols\" registry ([Section
7.7](#iana-nts-next-protocols){.xref}). The Critical Bit [MUST]{.bcp14}
be set.[¶](#section-4.1.2-1){.pilcrow}

The Protocol IDs listed in the client\'s NTS Next Protocol Negotiation
record denote those protocols that the client wishes to speak using the
key material established through this NTS-KE session. Protocol IDs
listed in the NTS-KE server\'s response [MUST]{.bcp14} comprise a subset
of those listed in the request and denote those protocols that the NTP
server is willing and able to speak using the key material established
through this NTS-KE session. The client [MAY]{.bcp14} proceed with one
or more of them. The request [MUST]{.bcp14} list at least one protocol,
but the response [MAY]{.bcp14} be empty.[¶](#section-4.1.2-2){.pilcrow}
:::
:::

::: {#nts-error}
::: {#section-4.1.3 .section}
#### [4.1.3.](#section-4.1.3){.section-number .selfRef} [Error](#name-error){.section-name .selfRef} {#name-error}

The Error record has a Record Type number of 2. Its body is exactly two
octets long, consisting of an unsigned 16-bit integer in network byte
order, denoting an error code. The Critical Bit [MUST]{.bcp14} be
set.[¶](#section-4.1.3-1){.pilcrow}

Clients [MUST NOT]{.bcp14} include Error records in their request. If
clients receive a server response that includes an Error record, they
[MUST]{.bcp14} discard any key material negotiated during the initial
TLS exchange and [MUST NOT]{.bcp14} proceed to the Next Protocol.
Requirements for retry intervals are described in [Section
4.2](#nts-ke-retry){.xref}.[¶](#section-4.1.3-2){.pilcrow}

The following error codes are defined:[¶](#section-4.1.3-3){.pilcrow}

-   [Error code 0 means \"Unrecognized Critical Record\". The server
    [MUST]{.bcp14} respond with this error code if the request included
    a record that the server did not understand and that had its
    Critical Bit set. The client [SHOULD NOT]{.bcp14} retry its request
    without
    modification.[¶](#section-4.1.3-4.1){.pilcrow}]{#section-4.1.3-4.1}
-   [Error code 1 means \"Bad Request\". The server [MUST]{.bcp14}
    respond with this error if the request is not complete and
    syntactically well-formed, or, upon the expiration of an
    implementation-defined timeout, it has not yet received such a
    request. The client [SHOULD NOT]{.bcp14} retry its request without
    modification.[¶](#section-4.1.3-4.2){.pilcrow}]{#section-4.1.3-4.2}
-   [Error code 2 means \"Internal Server Error\". The server
    [MUST]{.bcp14} respond with this error if it is unable to respond
    properly due to an internal condition. The client [MAY]{.bcp14}
    retry its
    request.[¶](#section-4.1.3-4.3){.pilcrow}]{#section-4.1.3-4.3}
:::
:::

::: {#nts-warning}
::: {#section-4.1.4 .section}
#### [4.1.4.](#section-4.1.4){.section-number .selfRef} [Warning](#name-warning){.section-name .selfRef} {#name-warning}

The Warning record has a Record Type number of 3. Its body is exactly
two octets long, consisting of an unsigned 16-bit integer in network
byte order, denoting a warning code. The Critical Bit [MUST]{.bcp14} be
set.[¶](#section-4.1.4-1){.pilcrow}

Clients [MUST NOT]{.bcp14} include Warning records in their request. If
clients receive a server response that includes a Warning record, they
[MAY]{.bcp14} discard any negotiated key material and abort without
proceeding to the Next Protocol. Unrecognized warning codes
[MUST]{.bcp14} be treated as errors.[¶](#section-4.1.4-2){.pilcrow}

This memo defines no warning codes.[¶](#section-4.1.4-3){.pilcrow}
:::
:::

::: {#aead-algorithm-negotiation}
::: {#section-4.1.5 .section}
#### [4.1.5.](#section-4.1.5){.section-number .selfRef} [AEAD Algorithm Negotiation](#name-aead-algorithm-negotiation){.section-name .selfRef} {#name-aead-algorithm-negotiation}

The AEAD Algorithm Negotiation record has a Record Type number of 4. Its
body consists of a sequence of unsigned 16-bit integers in network byte
order, denoting Numeric Identifiers from the IANA [\"AEAD Algorithms\"
registry](#IANA-AEAD){.xref} \[[IANA-AEAD](#IANA-AEAD){.xref}\]. The
Critical Bit [MAY]{.bcp14} be set.[¶](#section-4.1.5-1){.pilcrow}

If the NTS Next Protocol Negotiation record offers Protocol ID 0 (for
NTPv4), then this record [MUST]{.bcp14} be included exactly once. Other
protocols [MAY]{.bcp14} require it as
well.[¶](#section-4.1.5-2){.pilcrow}

When included in a request, this record denotes which AEAD algorithms
the client is willing to use to secure the Next Protocol, in decreasing
preference order. When included in a response, this record denotes which
algorithm the server chooses to use. It is empty if the server supports
none of the algorithms offered. In requests, the list [MUST]{.bcp14}
include at least one algorithm. In responses, it [MUST]{.bcp14} include
at most one. Honoring the client\'s preference order is
[OPTIONAL]{.bcp14}: servers may select among any of the client\'s
offered choices, even if they are able to support some other algorithm
that the client prefers more.[¶](#section-4.1.5-3){.pilcrow}

Server implementations of [NTS Extension Fields for
NTPv4](#nts-extension-fields-for-ntpv4){.xref} ([Section
5](#nts-extension-fields-for-ntpv4){.xref}) [MUST]{.bcp14} support
[AEAD_AES_SIV_CMAC_256](#RFC5297){.xref} \[[RFC5297](#RFC5297){.xref}\]
(Numeric Identifier 15). That is, if the client includes
AEAD_AES_SIV_CMAC_256 in its AEAD Algorithm Negotiation record, and the
server accepts Protocol ID 0 (NTPv4) in its NTS Next Protocol
Negotiation record, then the server\'s AEAD Algorithm Negotiation record
[MUST NOT]{.bcp14} be empty.[¶](#section-4.1.5-4){.pilcrow}
:::
:::

::: {#new-cookie-for-ntpv4}
::: {#section-4.1.6 .section}
#### [4.1.6.](#section-4.1.6){.section-number .selfRef} [New Cookie for NTPv4](#name-new-cookie-for-ntpv4){.section-name .selfRef} {#name-new-cookie-for-ntpv4}

The New Cookie for NTPv4 record has a Record Type number of 5. The
contents of its body [SHALL]{.bcp14} be implementation-defined, and
clients [MUST NOT]{.bcp14} attempt to interpret them. See [Section
6](#suggested-format-for-nts-cookies){.xref} for a suggested
construction.[¶](#section-4.1.6-1){.pilcrow}

Clients [MUST NOT]{.bcp14} send records of this type. Servers
[MUST]{.bcp14} send at least one record of this type, and
[SHOULD]{.bcp14} send eight of them, if the Next Protocol Negotiation
response record contains Protocol ID 0 (NTPv4) and the AEAD Algorithm
Negotiation response record is not empty. The Critical Bit [SHOULD
NOT]{.bcp14} be set.[¶](#section-4.1.6-2){.pilcrow}
:::
:::

::: {#ntp-server-negotiation}
::: {#section-4.1.7 .section}
#### [4.1.7.](#section-4.1.7){.section-number .selfRef} [NTPv4 Server Negotiation](#name-ntpv4-server-negotiation){.section-name .selfRef} {#name-ntpv4-server-negotiation}

The NTPv4 Server Negotiation record has a Record Type number of 6. Its
body consists of an [ASCII-encoded](#RFC0020){.xref}
\[[RFC0020](#RFC0020){.xref}\] string. The contents of the string
[SHALL]{.bcp14} be either an IPv4 address, an IPv6 address, or a fully
qualified domain name (FQDN). IPv4 addresses [MUST]{.bcp14} be in dotted
decimal notation. IPv6 addresses [MUST]{.bcp14} conform to the \"Text
Representation of Addresses\" as specified in [RFC
4291](#RFC4291){.xref} \[[RFC4291](#RFC4291){.xref}\] and [MUST
NOT]{.bcp14} include zone identifiers \[[RFC6874](#RFC6874){.xref}\]. If
a label contains at least one non-ASCII character, it is an
internationalized domain name, and an A-LABEL [MUST]{.bcp14} be used as
defined in Section
[2.3.2.1](https://www.rfc-editor.org/rfc/rfc5890#section-2.3.2.1){.relref}
of [RFC 5890](#RFC5890){.xref} \[[RFC5890](#RFC5890){.xref}\]. If the
record contains a domain name, the recipient [MUST]{.bcp14} treat it as
a FQDN, e.g., by making sure it ends with a
dot.[¶](#section-4.1.7-1){.pilcrow}

When NTPv4 is negotiated as a Next Protocol and this record is sent by
the server, the body specifies the hostname or IP address of the NTPv4
server with which the client should associate and that will accept the
supplied cookies. If no record of this type is sent, the client
[SHALL]{.bcp14} interpret this as a directive to associate with an NTPv4
server at the same IP address as the NTS-KE server. Servers [MUST
NOT]{.bcp14} send more than one record of this
type.[¶](#section-4.1.7-2){.pilcrow}

When this record is sent by the client, it indicates that the client
wishes to associate with the specified NTP server. The NTS-KE server
[MAY]{.bcp14} incorporate this request when deciding which NTPv4 Server
Negotiation records to respond with, but honoring the client\'s
preference is [OPTIONAL]{.bcp14}. The client [MUST NOT]{.bcp14} send
more than one record of this type.[¶](#section-4.1.7-3){.pilcrow}

If the client has sent a record of this type, the NTS-KE server
[SHOULD]{.bcp14} reply with the same record if it is valid and the
server is able to supply cookies for it. If the client has not sent any
record of this type, the NTS-KE server [SHOULD]{.bcp14} respond with
either an NTP server address in the same family as the NTS-KE session or
a FQDN that can be resolved to an address in that family, if such
alternatives are available.[¶](#section-4.1.7-4){.pilcrow}

Servers [MAY]{.bcp14} set the Critical Bit on records of this type;
clients [SHOULD NOT]{.bcp14}.[¶](#section-4.1.7-5){.pilcrow}
:::
:::

::: {#ntp-port-negotiation}
::: {#section-4.1.8 .section}
#### [4.1.8.](#section-4.1.8){.section-number .selfRef} [NTPv4 Port Negotiation](#name-ntpv4-port-negotiation){.section-name .selfRef} {#name-ntpv4-port-negotiation}

The NTPv4 Port Negotiation record has a Record Type number of 7. Its
body consists of a 16-bit unsigned integer in network byte order,
denoting a UDP port number.[¶](#section-4.1.8-1){.pilcrow}

When NTPv4 is negotiated as a Next Protocol, and this record is sent by
the server, the body specifies the port number of the NTPv4 server with
which the client should associate and that will accept the supplied
cookies. If no record of this type is sent, the client [SHALL]{.bcp14}
assume a default of 123 (the registered port number for
NTP).[¶](#section-4.1.8-2){.pilcrow}

When this record is sent by the client in conjunction with a NTPv4
Server Negotiation record, it indicates that the client wishes to
associate with the NTP server at the specified port. The NTS-KE server
[MAY]{.bcp14} incorporate this request when deciding what NTPv4 Server
Negotiation and NTPv4 Port Negotiation records to respond with, but
honoring the client\'s preference is
[OPTIONAL]{.bcp14}.[¶](#section-4.1.8-3){.pilcrow}

Servers [MAY]{.bcp14} set the Critical Bit on records of this type;
clients [SHOULD NOT]{.bcp14}.[¶](#section-4.1.8-4){.pilcrow}
:::
:::
:::

::: {#nts-ke-retry}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [Retry Intervals](#name-retry-intervals){.section-name .selfRef} {#name-retry-intervals}

A mechanism for not unnecessarily overloading the NTS-KE server is
[REQUIRED]{.bcp14} when retrying the key establishment process due to
protocol, communication, or other errors. The exact workings of this
will be dependent on the application and operational experience gathered
over time. Until such experience is available, this memo provides the
following suggestion.[¶](#section-4.2-1){.pilcrow}

Clients [SHOULD]{.bcp14} use exponential backoff, with an initial and
minimum retry interval of 10 seconds, a maximum retry interval of 5
days, and a base of 1.5. Thus, the minimum interval in seconds, \'t\',
for the nth retry is calculated with the
following:[¶](#section-4.2-2){.pilcrow}

-   [t = min(10 \* 1.5^n-1^,
    432000).[¶](#section-4.2-3.1){.pilcrow}]{#section-4.2-3.1}

Clients [MUST NOT]{.bcp14} reset the retry interval until they have
performed a successful key establishment with the NTS-KE server,
followed by a successful use of the negotiated Next Protocol with the
keys and data established during that
transaction.[¶](#section-4.2-4){.pilcrow}
:::
:::

::: {#key-extraction}
::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [Key Extraction (Generally)](#name-key-extraction-generally){.section-name .selfRef} {#name-key-extraction-generally}

Following a successful run of the NTS-KE protocol, key material
[SHALL]{.bcp14} be extracted using [the HMAC-based Extract-and-Expand
Key Derivation Function (HKDF)](#RFC5869){.xref}
\[[RFC5869](#RFC5869){.xref}\] in accordance with Section
[7.5](https://www.rfc-editor.org/rfc/rfc8446#section-7.5){.relref} of
[RFC 8446](#RFC8446){.xref} \[[RFC8446](#RFC8446){.xref}\]. Inputs to
the exporter function are to be constructed in a manner specific to the
negotiated Next Protocol. However, all protocols that utilize NTS-KE
[MUST]{.bcp14} conform to the following two
rules:[¶](#section-4.3-1){.pilcrow}

-   [The [disambiguating label string](#RFC5705){.xref}
    \[[RFC5705](#RFC5705){.xref}\] [MUST]{.bcp14} be
    \"EXPORTER-network-time-security\".[¶](#section-4.3-2.1){.pilcrow}]{#section-4.3-2.1}
-   [The [per-association context value](#RFC5705){.xref}
    \[[RFC5705](#RFC5705){.xref}\] [MUST]{.bcp14} be provided and
    [MUST]{.bcp14} begin with the two-octet Protocol ID that was
    negotiated as a Next
    Protocol.[¶](#section-4.3-2.2){.pilcrow}]{#section-4.3-2.2}
:::
:::
:::
:::

::: {#nts-extension-fields-for-ntpv4}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [NTS Extension Fields for NTPv4](#name-nts-extension-fields-for-nt){.section-name .selfRef} {#name-nts-extension-fields-for-nt}

::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [Key Extraction (for NTPv4)](#name-key-extraction-for-ntpv4){.section-name .selfRef} {#name-key-extraction-for-ntpv4}

Following a successful run of the NTS-KE protocol wherein Protocol ID 0
(NTPv4) is selected as a Next Protocol, two AEAD keys [SHALL]{.bcp14} be
extracted: a client-to-server (C2S) key and a server-to-client (S2C)
key. These keys [SHALL]{.bcp14} be computed with the HKDF defined in
Section
[7.5](https://www.rfc-editor.org/rfc/rfc8446#section-7.5){.relref} of
[RFC 8446](#RFC8446){.xref} \[[RFC8446](#RFC8446){.xref}\] using the
following inputs:[¶](#section-5.1-1){.pilcrow}

-   [The [disambiguating label string](#RFC5705){.xref}
    \[[RFC5705](#RFC5705){.xref}\] [SHALL]{.bcp14} be
    \"EXPORTER-network-time-security\".[¶](#section-5.1-2.1){.pilcrow}]{#section-5.1-2.1}

-   ::: {#section-5.1-2.2}
    The [per-association context value](#RFC5705){.xref}
    \[[RFC5705](#RFC5705){.xref}\] [SHALL]{.bcp14} consist of the
    following five octets:[¶](#section-5.1-2.2.1){.pilcrow}

    -   [The first two octets [SHALL]{.bcp14} be zero (the Protocol ID
        for
        NTPv4).[¶](#section-5.1-2.2.2.1){.pilcrow}]{#section-5.1-2.2.2.1}
    -   [The next two octets [SHALL]{.bcp14} be the Numeric Identifier
        of the negotiated AEAD algorithm in network byte
        order.[¶](#section-5.1-2.2.2.2){.pilcrow}]{#section-5.1-2.2.2.2}
    -   [The final octet [SHALL]{.bcp14} be 0x00 for the C2S key and
        0x01 for the S2C
        key.[¶](#section-5.1-2.2.2.3){.pilcrow}]{#section-5.1-2.2.2.3}
    :::

Implementations wishing to derive additional keys for private or
experimental use [MUST NOT]{.bcp14} do so by extending the
above-specified syntax for per-association context values. Instead, they
[SHOULD]{.bcp14} use their own disambiguating label string. Note that
[RFC 5705](#RFC5705){.xref} \[[RFC5705](#RFC5705){.xref}\] provides that
disambiguating label strings beginning with \"EXPERIMENTAL\"
[MAY]{.bcp14} be used without IANA
registration.[¶](#section-5.1-3){.pilcrow}
:::

::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [Packet Structure Overview](#name-packet-structure-overview){.section-name .selfRef} {#name-packet-structure-overview}

In general, an NTS-protected NTPv4 packet consists of the
following:[¶](#section-5.2-1){.pilcrow}

-   [The usual 48-octet NTP header, which is authenticated but not
    encrypted.[¶](#section-5.2-2.1){.pilcrow}]{#section-5.2-2.1}
-   [Some extension fields, which are authenticated but not
    encrypted.[¶](#section-5.2-2.2){.pilcrow}]{#section-5.2-2.2}
-   [An extension field that contains AEAD output (i.e., an
    authentication tag and possible ciphertext). The corresponding
    plaintext, if non-empty, consists of some extension fields that
    benefit from both encryption and
    authentication.[¶](#section-5.2-2.3){.pilcrow}]{#section-5.2-2.3}
-   [Possibly, some additional extension fields that are neither
    encrypted nor authenticated. In general, these are discarded by the
    receiver.[¶](#section-5.2-2.4){.pilcrow}]{#section-5.2-2.4}

Always included among the authenticated or authenticated-and-encrypted
extension fields are a cookie extension field and a unique identifier
extension field, as described in [Section
5.7](#protocol-details){.xref}. The purpose of the cookie extension
field is to enable the server to offload storage of session state onto
the client. The purpose of the unique identifier extension field is to
protect the client from replay attacks.[¶](#section-5.2-3){.pilcrow}
:::

::: {#unique-identifier-extension-field}
::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [The Unique Identifier Extension Field](#name-the-unique-identifier-exten){.section-name .selfRef} {#name-the-unique-identifier-exten}

The Unique Identifier extension field provides the client with a
cryptographically strong means of detecting replayed packets. It has a
Field Type of 0x0104. When the extension field is included in a client
packet (mode 3), its body [SHALL]{.bcp14} consist of a string of octets
generated by a [cryptographically secure random number
generator](#RFC4086){.xref} \[[RFC4086](#RFC4086){.xref}\]. The string
[MUST]{.bcp14} be at least 32 octets long. When the extension field is
included in a server packet (mode 4), its body [SHALL]{.bcp14} contain
the same octet string as was provided in the client packet to which the
server is responding. All server packets generated by NTS-implementing
servers in response to client packets containing this extension field
[MUST]{.bcp14} also contain this field with the same content as in the
client\'s request. The field\'s use in modes other than client-server is
not defined.[¶](#section-5.3-1){.pilcrow}

This extension field [MAY]{.bcp14} also be used standalone, without NTS,
in which case it provides the client with a means of detecting spoofed
packets from off-path attackers. Historically, NTP\'s origin timestamp
field has played both these roles, but this is suboptimal for
cryptographic purposes because it is only 64 bits long, and depending on
implementation details, most of those bits may be predictable. In
contrast, the Unique Identifier extension field enables a degree of
unpredictability and collision resistance more consistent with
cryptographic best practice.[¶](#section-5.3-2){.pilcrow}
:::
:::

::: {#nts-cookie-extension-field}
::: {#section-5.4 .section}
### [5.4.](#section-5.4){.section-number .selfRef} [The NTS Cookie Extension Field](#name-the-nts-cookie-extension-fi){.section-name .selfRef} {#name-the-nts-cookie-extension-fi}

The NTS Cookie extension field has a Field Type of 0x0204. Its purpose
is to carry information that enables the server to recompute keys and
other session state without having to store any per-client state. The
contents of its body [SHALL]{.bcp14} be implementation-defined, and
clients [MUST NOT]{.bcp14} attempt to interpret them. See [Section
6](#suggested-format-for-nts-cookies){.xref} for a suggested
construction. The NTS Cookie extension field [MUST NOT]{.bcp14} be
included in NTP packets whose mode is other than 3 (client) or 4
(server).[¶](#section-5.4-1){.pilcrow}
:::
:::

::: {#nts-cookie-placeholder-extension-field}
::: {#section-5.5 .section}
### [5.5.](#section-5.5){.section-number .selfRef} [The NTS Cookie Placeholder Extension Field](#name-the-nts-cookie-placeholder-){.section-name .selfRef} {#name-the-nts-cookie-placeholder-}

The NTS Cookie Placeholder extension field has a Field Type of 0x0304.
When this extension field is included in a client packet (mode 3), it
communicates to the server that the client wishes it to send additional
cookies in its response. This extension field [MUST NOT]{.bcp14} be
included in NTP packets whose mode is other than
3.[¶](#section-5.5-1){.pilcrow}

Whenever an NTS Cookie Placeholder extension field is present, it
[MUST]{.bcp14} be accompanied by an NTS Cookie extension field. The body
length of the NTS Cookie Placeholder extension field [MUST]{.bcp14} be
the same as the body length of the NTS Cookie extension field. This
length requirement serves to ensure that the response will not be larger
than the request, in order to improve timekeeping precision and prevent
DDoS amplification. The contents of the NTS Cookie Placeholder extension
field\'s body [SHOULD]{.bcp14} be all zeros and, aside from checking its
length, [MUST]{.bcp14} be ignored by the
server.[¶](#section-5.5-2){.pilcrow}
:::
:::

::: {#nts-aeef-extension-field}
::: {#section-5.6 .section}
### [5.6.](#section-5.6){.section-number .selfRef} [The NTS Authenticator and Encrypted Extension Fields Extension Field](#name-the-nts-authenticator-and-e){.section-name .selfRef} {#name-the-nts-authenticator-and-e}

The NTS Authenticator and Encrypted Extension Fields extension field is
the central cryptographic element of an NTS-protected NTP packet. Its
Field Type is 0x0404. It [SHALL]{.bcp14} be formatted according to
[Figure 4](#fig-aeef-field){.xref} and include the following
fields:[¶](#section-5.6-1){.pilcrow}

[]{.break}

Nonce Length:
:   Two octets in network byte order, giving the length of the Nonce
    field, excluding any padding, interpreted as an unsigned
    integer.[¶](#section-5.6-2.2){.pilcrow}
:   

Ciphertext Length:
:   Two octets in network byte order, giving the length of the
    Ciphertext field, excluding any padding, interpreted as an unsigned
    integer.[¶](#section-5.6-2.4){.pilcrow}
:   

Nonce:
:   A nonce as required by the negotiated AEAD algorithm. The end of the
    field is zero-padded to a word (four octets)
    boundary.[¶](#section-5.6-2.6){.pilcrow}
:   

Ciphertext:
:   The output of the negotiated AEAD algorithm. The structure of this
    field is determined by the negotiated algorithm, but it typically
    contains an authentication tag in addition to the actual ciphertext.
    The end of the field is zero-padded to a word (four octets)
    boundary.[¶](#section-5.6-2.8){.pilcrow}
:   

Additional Padding:
:   Clients that use a nonce length shorter than the maximum allowed by
    the negotiated AEAD algorithm may be required to include additional
    zero-padding. The necessary length of this field is specified
    below.[¶](#section-5.6-2.10){.pilcrow}
:   

[]{#name-nts-authenticator-and-encry}

::: {#fig-aeef-field}
::: {#section-5.6-3.1 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |          Nonce Length         |      Ciphertext Length        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .          Nonce, including up to 3 octets padding              .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .        Ciphertext, including up to 3 octets padding           .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    .                                                               .
    .                      Additional Padding                       .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:::

[Figure 4](#figure-4){.selfRef}: [NTS Authenticator and Encrypted
Extension Fields Extension Field
Format](#name-nts-authenticator-and-encry){.selfRef}
:::

The Ciphertext field [SHALL]{.bcp14} be formed by providing the
following inputs to the negotiated AEAD
algorithm:[¶](#section-5.6-4){.pilcrow}

[]{.break}

K:
:   For packets sent from the client to the server, the C2S key
    [SHALL]{.bcp14} be used. For packets sent from the server to the
    client, the S2C key [SHALL]{.bcp14} be
    used.[¶](#section-5.6-5.2){.pilcrow}
:   

A:
:   The associated data [SHALL]{.bcp14} consist of the portion of the
    NTP packet beginning from the start of the NTP header and ending at
    the end of the last extension field that precedes the NTS
    Authenticator and Encrypted Extension Fields extension
    field.[¶](#section-5.6-5.4){.pilcrow}
:   

P:
:   The plaintext [SHALL]{.bcp14} consist of all (if any) NTP extension
    fields to be encrypted; if multiple extension fields are present,
    they [SHALL]{.bcp14} be joined by concatenation. Each such field
    [SHALL]{.bcp14} be formatted in accordance with [RFC
    7822](#RFC7822){.xref} \[[RFC7822](#RFC7822){.xref}\], except that,
    contrary to the RFC 7822 requirement that fields have a minimum
    length of 16 or 28 octets, encrypted extension fields [MAY]{.bcp14}
    be arbitrarily short (but still [MUST]{.bcp14} be a multiple of 4
    octets in length).[¶](#section-5.6-5.6){.pilcrow}
:   

N:
:   The nonce [SHALL]{.bcp14} be formed however required by the
    negotiated AEAD algorithm.[¶](#section-5.6-5.8){.pilcrow}
:   

The purpose of the Additional Padding field is to ensure that servers
can always choose a nonce whose length is adequate to ensure its
uniqueness, even if the client chooses a shorter one, and still ensure
that the overall length of the server\'s response packet does not exceed
the length of the request. For mode 4 (server) packets, no Additional
Padding field is ever required. For mode 3 (client) packets, the length
of the Additional Padding field [SHALL]{.bcp14} be computed as follows.
Let \'N_LEN\' be the padded length of the Nonce field. Let \'N_MAX\' be,
as specified by [RFC 5116](#RFC5116){.xref}
\[[RFC5116](#RFC5116){.xref}\], the maximum permitted nonce length for
the negotiated AEAD algorithm. Let \'N_REQ\' be the lesser of 16 and
N_MAX, rounded up to the nearest multiple of 4. If N_LEN is greater than
or equal to N_REQ, then no Additional Padding field is required.
Otherwise, the Additional Padding field [SHALL]{.bcp14} be at least
N_REQ - N_LEN octets in length. Servers [MUST]{.bcp14} enforce this
requirement by discarding any packet that does not conform to
it.[¶](#section-5.6-6){.pilcrow}

Senders are always free to include more Additional Padding than mandated
by the above paragraph. Theoretically, it could be necessary to do so in
order to bring the extension field to the minimum length required by
[RFC 7822](#RFC7822){.xref} \[[RFC7822](#RFC7822){.xref}\]. This should
never happen in practice because any reasonable AEAD algorithm will have
a nonce and an authenticator long enough to bring the extension field to
its required length already. Nonetheless, implementers are advised to
explicitly handle this case and ensure that the extension field they
emit is of legal length.[¶](#section-5.6-7){.pilcrow}

The NTS Authenticator and Encrypted Extension Fields extension field
[MUST NOT]{.bcp14} be included in NTP packets whose mode is other than 3
(client) or 4 (server).[¶](#section-5.6-8){.pilcrow}
:::
:::

::: {#protocol-details}
::: {#section-5.7 .section}
### [5.7.](#section-5.7){.section-number .selfRef} [Protocol Details](#name-protocol-details){.section-name .selfRef} {#name-protocol-details}

A client sending an NTS-protected request [SHALL]{.bcp14} include the
following extension fields as displayed in [Figure
5](#fig_NTSTimeSyncMessage){.xref}:[¶](#section-5.7-1){.pilcrow}

-   [Exactly one Unique Identifier extension field that [MUST]{.bcp14}
    be authenticated, [MUST NOT]{.bcp14} be encrypted, and whose
    contents [MUST]{.bcp14} be the output of a [cryptographically secure
    random number generator](#RFC4086){.xref}
    \[[RFC4086](#RFC4086){.xref}\].[¶](#section-5.7-2.1){.pilcrow}]{#section-5.7-2.1}
-   [Exactly one NTS Cookie extension field that [MUST]{.bcp14} be
    authenticated and [MUST NOT]{.bcp14} be encrypted. The cookie
    [MUST]{.bcp14} be one which has been previously provided to the
    client, either from the key establishment server during the NTS-KE
    handshake or from the NTP server in response to a previous
    NTS-protected NTP
    request.[¶](#section-5.7-2.2){.pilcrow}]{#section-5.7-2.2}
-   [Exactly one NTS Authenticator and Encrypted Extension Fields
    extension field, generated using an AEAD algorithm and C2S key
    established through
    NTS-KE.[¶](#section-5.7-2.3){.pilcrow}]{#section-5.7-2.3}

To protect the client\'s privacy, the client [SHOULD]{.bcp14} avoid
reusing a cookie. If the client does not have any cookies that it has
not already sent, it [SHOULD]{.bcp14} initiate a rerun of the NTS-KE
protocol. The client [MAY]{.bcp14} reuse cookies in order to prioritize
resilience over unlinkability. Which of the two that should be
prioritized in any particular case is dependent on the application and
the user\'s preference. [Section 9.1](#Unlinkability){.xref} describes
the privacy considerations of this in further
detail.[¶](#section-5.7-3){.pilcrow}

The client [MAY]{.bcp14} include one or more NTS Cookie Placeholder
extension fields that [MUST]{.bcp14} be authenticated and [MAY]{.bcp14}
be encrypted. The number of NTS Cookie Placeholder extension fields that
the client includes [SHOULD]{.bcp14} be such that if the client includes
N placeholders and the server sends back N+1 cookies, the number of
unused cookies stored by the client will come to eight. The client
[SHOULD NOT]{.bcp14} include more than seven NTS Cookie Placeholder
extension fields in a request. When both the client and server adhere to
all cookie-management guidance provided in this memo, the number of
placeholder extension fields will equal the number of dropped packets
since the last successful volley.[¶](#section-5.7-4){.pilcrow}

In rare circumstances, it may be necessary to include fewer NTS Cookie
Placeholder extensions than recommended above in order to prevent
datagram fragmentation. When cookies adhere to the format recommended in
[Section 6](#suggested-format-for-nts-cookies){.xref} and the AEAD in
use is the mandatory-to-implement AEAD_AES_SIV_CMAC_256, senders can
include a cookie and seven placeholders and still have packet size fall
comfortably below 1280 octets if no non-NTS-related extensions are used;
1280 octets is the minimum prescribed MTU for IPv6 and is generally safe
for avoiding IPv4 fragmentation. Nonetheless, senders [SHOULD]{.bcp14}
include fewer cookies and placeholders than otherwise indicated if doing
so is necessary to prevent fragmentation.[¶](#section-5.7-5){.pilcrow}

[]{#name-nts-protected-ntp-time-sync}

::: {#fig_NTSTimeSyncMessage}
::: {#section-5.7-6.1 .artwork .art-text .alignLeft}
                    +---------------------------------------+
                    | - Verify time request message.        |
                    | - Generate time response message.     |
                    |   - Included NTPv4 extension fields:  |
                    |      o Unique Identifier EF           |
                    |      o NTS Authentication and         |
                    |        Encrypted Extension Fields EF  |
                    |        - NTS Cookie EF                |
                    |        - <NTS Cookie EF>              |
                    | - Transmit time request packet.       |
                    +-----------------+---------------------+
                                      |
                                      |
    Server -----------+---------------+-----+----------------------->
                      ^                      \
                     /                        \
      Time request  /                          \   Time response
      (mode 3)     /                            \  (mode 4)
                  /                              \
                 /                                V
    Client -----+---------------------------------+----------------->
                |                                 |
                |                                 |
                |                                 |
    +-----------+-----------------------+   +-----+------------------+
    |- Generate time request message.   |   |- Verify time response  |
    | - Include NTPv4 Extension fields: |   |  message.              |
    |    o Unique Identifier EF         |   |- Extract cookie(s).    |
    |    o NTS Cookie EF                |   |- Time synchronization  |
    |    o <NTS Cookie Placeholder EF>  |   |  processing.           |
    |                                   |   +------------------------+
    |- Generate AEAD tag of NTP message.|
    |- Add NTS Authentication and       |
    |  Encrypted Extension Fields EF.   |
    |- Transmit time request packet.    |
    +-----------------------------------+
:::

[Figure 5](#figure-5){.selfRef}: [NTS-Protected NTP Time Synchronization
Messages](#name-nts-protected-ntp-time-sync){.selfRef}
:::

The client [MAY]{.bcp14} include additional (non-NTS-related) extension
fields that [MAY]{.bcp14} appear prior to the NTS Authenticator and
Encrypted Extension Fields extension fields (therefore authenticated but
not encrypted), within it (therefore encrypted and authenticated), or
after it (therefore neither encrypted nor authenticated). The server
[MUST]{.bcp14} discard any unauthenticated extension fields. Future
specifications of extension fields [MAY]{.bcp14} provide exceptions to
this rule.[¶](#section-5.7-7){.pilcrow}

Upon receiving an NTS-protected request, the server [SHALL]{.bcp14}
(through some implementation-defined mechanism) use the cookie to
recover the AEAD algorithm, C2S key, and S2C key associated with the
request, and then use the C2S key to authenticate the packet and decrypt
the ciphertext. If the cookie is valid and authentication and decryption
succeed, the server [SHALL]{.bcp14} include the following extension
fields in its response:[¶](#section-5.7-8){.pilcrow}

-   [Exactly one Unique Identifier extension field that [MUST]{.bcp14}
    be authenticated, [MUST NOT]{.bcp14} be encrypted, and whose
    contents [SHALL]{.bcp14} echo those provided by the
    client.[¶](#section-5.7-9.1){.pilcrow}]{#section-5.7-9.1}
-   [Exactly one NTS Authenticator and Encrypted Extension Fields
    extension field, generated using the AEAD algorithm and S2C key
    recovered from the cookie provided by the
    client.[¶](#section-5.7-9.2){.pilcrow}]{#section-5.7-9.2}
-   [One or more NTS Cookie extension fields that [MUST]{.bcp14} be
    authenticated and encrypted. The number of NTS Cookie extension
    fields included [SHOULD]{.bcp14} be equal to, and [MUST NOT]{.bcp14}
    exceed, one plus the number of valid NTS Cookie Placeholder
    extension fields included in the request. The cookies returned in
    those fields [MUST]{.bcp14} be valid for use with the NTP server
    that sent them. They [MAY]{.bcp14} be valid for other NTP servers as
    well, but there is no way for the server to indicate
    this.[¶](#section-5.7-9.3){.pilcrow}]{#section-5.7-9.3}

We emphasize the contrast that NTS Cookie extension fields [MUST
NOT]{.bcp14} be encrypted when sent from client to server but
[MUST]{.bcp14} be encrypted when sent from server to client. The former
is necessary in order for the server to be able to recover the C2S and
S2C keys, while the latter is necessary to satisfy the unlinkability
goals discussed in [Section 9.1](#Unlinkability){.xref}. We emphasize
also that \"encrypted\" means encapsulated within the NTS Authenticator
and Encrypted Extensions extension field. While the body of an NTS
Cookie extension field will generally consist of some sort of AEAD
output (regardless of whether the recommendations of [Section
6](#suggested-format-for-nts-cookies){.xref} are precisely followed),
this is not sufficient to make the extension field
\"encrypted\".[¶](#section-5.7-10){.pilcrow}

The server [MAY]{.bcp14} include additional (non-NTS-related) extension
fields that [MAY]{.bcp14} appear prior to the NTS Authenticator and
Encrypted Extension Fields extension field (therefore authenticated but
not encrypted), within it (therefore encrypted and authenticated), or
after it (therefore neither encrypted nor authenticated). The client
[MUST]{.bcp14} discard any unauthenticated extension fields. Future
specifications of extension fields [MAY]{.bcp14} provide exceptions to
this rule.[¶](#section-5.7-11){.pilcrow}

Upon receiving an NTS-protected response, the client [MUST]{.bcp14}
verify that the Unique Identifier matches that of an outstanding
request, and that the packet is authentic under the S2C key associated
with that request. If either of these checks fails, the packet
[MUST]{.bcp14} be discarded without further processing. In particular,
the client [MUST]{.bcp14} discard unprotected responses to NTS-protected
requests.[¶](#section-5.7-12){.pilcrow}

If the server is unable to validate the cookie or authenticate the
request, it [SHOULD]{.bcp14} respond with a Kiss-o\'-Death (KoD) packet
(see Section
[7.4](https://www.rfc-editor.org/rfc/rfc5905#section-7.4){.relref} of
[RFC 5905](#RFC5905){.xref} \[[RFC5905](#RFC5905){.xref}\]) with kiss
code \"NTSN\", meaning \"NTS NAK\" (NTS negative-acknowledgment). It
[MUST NOT]{.bcp14} include any NTS Cookie or NTS Authenticator and
Encrypted Extension Fields extension
fields.[¶](#section-5.7-13){.pilcrow}

If the NTP server has previously responded with authentic NTS-protected
NTP packets, the client [MUST]{.bcp14} verify that any KoD packets
received from the server contain the Unique Identifier extension field
and that the Unique Identifier matches that of an outstanding request.
If this check fails, the packet [MUST]{.bcp14} be discarded without
further processing. If this check passes, the client [MUST]{.bcp14}
comply with Section
[7.4](https://www.rfc-editor.org/rfc/rfc5905#section-7.4){.relref} of
[RFC 5905](#RFC5905){.xref} \[[RFC5905](#RFC5905){.xref}\] where
required.[¶](#section-5.7-14){.pilcrow}

A client [MAY]{.bcp14} automatically rerun the NTS-KE protocol upon
forced disassociation from an NTP server. In that case, it
[MUST]{.bcp14} avoid quickly looping between the NTS-KE and NTP servers
by rate limiting the retries. Requirements for retry intervals in NTS-KE
are described in [Section
4.2](#nts-ke-retry){.xref}.[¶](#section-5.7-15){.pilcrow}

Upon reception of the NTS NAK kiss code, the client [SHOULD]{.bcp14}
wait until the next poll for a valid NTS-protected response, and if none
is received, initiate a fresh NTS-KE handshake to try to renegotiate new
cookies, AEAD keys, and parameters. If the NTS-KE handshake succeeds,
the client [MUST]{.bcp14} discard all old cookies and parameters and use
the new ones instead. As long as the NTS-KE handshake has not succeeded,
the client [SHOULD]{.bcp14} continue polling the NTP server using the
cookies and parameters it has.[¶](#section-5.7-16){.pilcrow}

To allow for NTP session restart when the NTS-KE server is unavailable
and to reduce NTS-KE server load, the client [SHOULD]{.bcp14} keep at
least one unused but recent cookie, AEAD keys, negotiated AEAD
algorithm, and other necessary parameters in persistent storage. This
way, the client is able to resume the NTP session without performing
renewed NTS-KE negotiation.[¶](#section-5.7-17){.pilcrow}
:::
:::
:::
:::

::: {#suggested-format-for-nts-cookies}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Suggested Format for NTS Cookies](#name-suggested-format-for-nts-co){.section-name .selfRef} {#name-suggested-format-for-nts-co}

This section is non-normative. It gives a suggested way for servers to
construct NTS cookies. All normative requirements are stated in [Section
4.1.6](#new-cookie-for-ntpv4){.xref} and [Section
5.4](#nts-cookie-extension-field){.xref}.[¶](#section-6-1){.pilcrow}

The role of cookies in NTS is closely analogous to that of session
tickets in TLS. Accordingly, the thematic resemblance of this section to
[RFC 5077](#RFC5077){.xref} \[[RFC5077](#RFC5077){.xref}\] is
deliberate, and the reader should likewise take heed of its security
considerations.[¶](#section-6-2){.pilcrow}

Servers should select an AEAD algorithm that they will use to encrypt
and authenticate cookies. The chosen algorithm should be one such as
[AEAD_AES_SIV_CMAC_256](#RFC5297){.xref} \[[RFC5297](#RFC5297){.xref}\],
which resists accidental nonce reuse. It need not be the same as the one
that was negotiated with the client. Servers should randomly generate
and store a secret master AEAD key \'K\'. Servers should additionally
choose a non-secret, unique value \'I\' as key identifier for
\'K\'.[¶](#section-6-3){.pilcrow}

Servers should periodically (e.g., once daily) generate a new pair
\'(I,K)\' and immediately switch to using these values for all
newly-generated cookies. Following each such key rotation, servers
should securely erase any previously generated keys that should now be
expired. Servers should continue to accept any cookie generated using
keys that they have not yet erased, even if those keys are no longer
current. Erasing old keys provides for forward secrecy, limiting the
scope of what old information can be stolen if a master key is somehow
compromised. Holding on to a limited number of old keys allows clients
to seamlessly transition from one generation to the next without having
to perform a new NTS-KE handshake.[¶](#section-6-4){.pilcrow}

The need to keep keys synchronized between NTS-KE and NTP servers as
well as across load-balanced clusters can make automatic key rotation
challenging. However, the task can be accomplished without the need for
central key-management infrastructure by using a ratchet, i.e., making
each new key a deterministic, cryptographically pseudorandom function of
its predecessor. A recommended concrete implementation of this approach
is to use [HKDF](#RFC5869){.xref} \[[RFC5869](#RFC5869){.xref}\] to
derive new keys, using the key\'s predecessor as Input Keying Material
and its key identifier as a salt.[¶](#section-6-5){.pilcrow}

To form a cookie, servers should first form a plaintext \'P\' consisting
of the following fields:[¶](#section-6-6){.pilcrow}

-   [The AEAD algorithm negotiated during
    NTS-KE.[¶](#section-6-7.1){.pilcrow}]{#section-6-7.1}
-   [The S2C key.[¶](#section-6-7.2){.pilcrow}]{#section-6-7.2}
-   [The C2S key.[¶](#section-6-7.3){.pilcrow}]{#section-6-7.3}

Servers should then generate a nonce \'N\' uniformly at random, and form
AEAD output \'C\' by encrypting \'P\' under key \'K\' with nonce \'N\'
and no associated data.[¶](#section-6-8){.pilcrow}

The cookie should consist of the tuple
\'(I,N,C)\'.[¶](#section-6-9){.pilcrow}

To verify and decrypt a cookie provided by the client, first parse it
into its components \'I\', \'N\', and \'C\'. Use \'I\' to look up its
decryption key \'K\'. If the key whose identifier is \'I\' has been
erased or never existed, decryption fails; reply with an NTS NAK.
Otherwise, attempt to decrypt and verify ciphertext \'C\' using key
\'K\' and nonce \'N\' with no associated data. If decryption or
verification fails, reply with an NTS NAK. Otherwise, parse out the
contents of the resulting plaintext \'P\' to obtain the negotiated AEAD
algorithm, S2C key, and C2S key.[¶](#section-6-10){.pilcrow}
:::
:::

::: {#iana-considerations}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Service Name and Transport Protocol Port Number Registry](#name-service-name-and-transport-){.section-name .selfRef} {#name-service-name-and-transport-}

IANA has allocated the following entry in the \"Service Name and
Transport Protocol Port Number Registry\"
\[[RFC6335](#RFC6335){.xref}\]:[¶](#section-7.1-1){.pilcrow}

[]{.break}

Service Name:
:   ntske[¶](#section-7.1-2.2){.pilcrow}
:   

Port Number:
:   4460[¶](#section-7.1-2.4){.pilcrow}
:   

Transport Protocol:
:   tcp[¶](#section-7.1-2.6){.pilcrow}
:   

Description:
:   Network Time Security Key
    Establishment[¶](#section-7.1-2.8){.pilcrow}
:   

Assignee:
:   IESG \<iesg\@ietf.org>[¶](#section-7.1-2.10){.pilcrow}
:   

Contact:
:   IETF Chair \<chair\@ietf.org>[¶](#section-7.1-2.12){.pilcrow}
:   

Registration Date:
:   2020-04-07[¶](#section-7.1-2.14){.pilcrow}
:   

Reference:
:   RFC 8915[¶](#section-7.1-2.16){.pilcrow}
:   
:::

::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [TLS Application-Layer Protocol Negotiation (ALPN) Protocol IDs Registry](#name-tls-application-layer-proto){.section-name .selfRef} {#name-tls-application-layer-proto}

IANA has allocated the following entry in the \"TLS Application-Layer
Protocol Negotiation (ALPN) Protocol IDs\" registry
\[[RFC7301](#RFC7301){.xref}\]:[¶](#section-7.2-1){.pilcrow}

[]{.break}

Protocol:
:   Network Time Security Key Establishment, version
    1[¶](#section-7.2-2.2){.pilcrow}
:   

Identification Sequence:
:   0x6E 0x74 0x73 0x6B 0x65 0x2F 0x31
    (\"ntske/1\")[¶](#section-7.2-2.4){.pilcrow}
:   

Reference:
:   RFC 8915, [Section 4](#nts-ke){.xref}[¶](#section-7.2-2.6){.pilcrow}
:   
:::

::: {#section-7.3 .section}
### [7.3.](#section-7.3){.section-number .selfRef} [TLS Exporter Labels Registry](#name-tls-exporter-labels-registr){.section-name .selfRef} {#name-tls-exporter-labels-registr}

IANA has allocated the following entry in the [TLS Exporter Labels
registry](#RFC5705){.xref}
\[[RFC5705](#RFC5705){.xref}\]:[¶](#section-7.3-1){.pilcrow}

  Value                            DTLS-OK   Recommended   Reference                                         Note
  -------------------------------- --------- ------------- ------------------------------------------------- ------
  EXPORTER-network-time-security   Y         Y             RFC 8915, [Section 4.3](#key-extraction){.xref}   

  : [Table 1](#table-1){.selfRef}
:::

::: {#section-7.4 .section}
### [7.4.](#section-7.4){.section-number .selfRef} [NTP Kiss-o\'-Death Codes Registry](#name-ntp-kiss-o-death-codes-regi){.section-name .selfRef} {#name-ntp-kiss-o-death-codes-regi}

IANA has allocated the following entry in the \"NTP Kiss-o\'-Death
Codes\" registry
\[[RFC5905](#RFC5905){.xref}\]:[¶](#section-7.4-1){.pilcrow}

  Code   Meaning                                                     Reference
  ------ ----------------------------------------------------------- ---------------------------------------------------
  NTSN   Network Time Security (NTS) negative-acknowledgment (NAK)   RFC 8915, [Section 5.7](#protocol-details){.xref}

  : [Table 2](#table-2){.selfRef}
:::

::: {#section-7.5 .section}
### [7.5.](#section-7.5){.section-number .selfRef} [NTP Extension Field Types Registry](#name-ntp-extension-field-types-r){.section-name .selfRef} {#name-ntp-extension-field-types-r}

IANA has allocated the following entries in the \"NTP Extension Field
Types\" registry
\[[RFC5905](#RFC5905){.xref}\]:[¶](#section-7.5-1){.pilcrow}

  Field Type   Meaning                                            Reference
  ------------ -------------------------------------------------- -------------------------------------------------------------------------
  0x0104       Unique Identifier                                  RFC 8915, [Section 5.3](#unique-identifier-extension-field){.xref}
  0x0204       NTS Cookie                                         RFC 8915, [Section 5.4](#nts-cookie-extension-field){.xref}
  0x0304       NTS Cookie Placeholder                             RFC 8915, [Section 5.5](#nts-cookie-placeholder-extension-field){.xref}
  0x0404       NTS Authenticator and Encrypted Extension Fields   RFC 8915, [Section 5.6](#nts-aeef-extension-field){.xref}

  : [Table 3](#table-3){.selfRef}
:::

::: {#section-7.6 .section}
### [7.6.](#section-7.6){.section-number .selfRef} [Network Time Security Key Establishment Record Types Registry](#name-network-time-security-key-e){.section-name .selfRef} {#name-network-time-security-key-e}

IANA has created a new registry entitled \"Network Time Security Key
Establishment Record Types\". Entries have the following
fields:[¶](#section-7.6-1){.pilcrow}

[]{.break}

Record Type Number ([REQUIRED]{.bcp14}):
:   An integer in the range 0-32767
    inclusive.[¶](#section-7.6-2.2){.pilcrow}
:   

Description ([REQUIRED]{.bcp14}):
:   A short text description of the purpose of the
    field.[¶](#section-7.6-2.4){.pilcrow}
:   

Reference ([REQUIRED]{.bcp14}):
:   A reference to a document specifying the semantics of the
    record.[¶](#section-7.6-2.6){.pilcrow}
:   

The registration policy varies by Record Type Number, as
follows:[¶](#section-7.6-3){.pilcrow}

[]{.break}

0-1023:
:   IETF Review[¶](#section-7.6-4.2){.pilcrow}
:   

1024-16383:
:   Specification Required[¶](#section-7.6-4.4){.pilcrow}
:   

16384-32767:
:   Private or Experimental Use[¶](#section-7.6-4.6){.pilcrow}
:   

The initial contents of this registry are as
follows:[¶](#section-7.6-5){.pilcrow}

  Record Type Number   Description                                Reference
  -------------------- ------------------------------------------ ------------------------------------------------------------------
  0                    End of Message                             RFC 8915, [Section 4.1.1](#end-of-message){.xref}
  1                    NTS Next Protocol Negotiation              RFC 8915, [Section 4.1.2](#nts-next-protocol-negotiation){.xref}
  2                    Error                                      RFC 8915, [Section 4.1.3](#nts-error){.xref}
  3                    Warning                                    RFC 8915, [Section 4.1.4](#nts-warning){.xref}
  4                    AEAD Algorithm Negotiation                 RFC 8915, [Section 4.1.5](#aead-algorithm-negotiation){.xref}
  5                    New Cookie for NTPv4                       RFC 8915, [Section 4.1.6](#new-cookie-for-ntpv4){.xref}
  6                    NTPv4 Server Negotiation                   RFC 8915, [Section 4.1.7](#ntp-server-negotiation){.xref}
  7                    NTPv4 Port Negotiation                     RFC 8915, [Section 4.1.8](#ntp-port-negotiation){.xref}
  8-16383              Unassigned                                 
  16384-32767          Reserved for Private or Experimental Use   RFC 8915

  : [Table 4](#table-4){.selfRef}
:::

::: {#iana-nts-next-protocols}
::: {#section-7.7 .section}
### [7.7.](#section-7.7){.section-number .selfRef} [Network Time Security Next Protocols Registry](#name-network-time-security-next-){.section-name .selfRef} {#name-network-time-security-next-}

IANA has created a new registry entitled \"Network Time Security Next
Protocols\". Entries have the following
fields:[¶](#section-7.7-1){.pilcrow}

[]{.break}

Protocol ID ([REQUIRED]{.bcp14}):
:   An integer in the range 0-65535 inclusive, functioning as an
    identifier.[¶](#section-7.7-2.2){.pilcrow}
:   

Protocol Name ([REQUIRED]{.bcp14}):
:   A short text string naming the protocol being
    identified.[¶](#section-7.7-2.4){.pilcrow}
:   

Reference ([REQUIRED]{.bcp14}):
:   A reference to a relevant specification
    document.[¶](#section-7.7-2.6){.pilcrow}
:   

The registration policy varies by Protocol ID, as
follows:[¶](#section-7.7-3){.pilcrow}

[]{.break}

0-1023:
:   IETF Review[¶](#section-7.7-4.2){.pilcrow}
:   

1024-32767:
:   Specification Required[¶](#section-7.7-4.4){.pilcrow}
:   

32768-65535:
:   Private or Experimental Use[¶](#section-7.7-4.6){.pilcrow}
:   

The initial contents of this registry are as
follows:[¶](#section-7.7-5){.pilcrow}

  Protocol ID   Protocol Name                              Reference
  ------------- ------------------------------------------ -----------
  0             Network Time Protocol version 4 (NTPv4)    RFC 8915
  1-32767       Unassigned                                 
  32768-65535   Reserved for Private or Experimental Use   RFC 8915

  : [Table 5](#table-5){.selfRef}
:::
:::

::: {#section-7.8 .section}
### [7.8.](#section-7.8){.section-number .selfRef} [Network Time Security Error and Warning Codes Registries](#name-network-time-security-error){.section-name .selfRef} {#name-network-time-security-error}

IANA has created two new registries entitled \"Network Time Security
Error Codes\" and \"Network Time Security Warning Codes\". Entries in
each have the following fields:[¶](#section-7.8-1){.pilcrow}

[]{.break}

Number ([REQUIRED]{.bcp14}):
:   An integer in the range 0-65535
    inclusive[¶](#section-7.8-2.2){.pilcrow}
:   

Description ([REQUIRED]{.bcp14}):
:   A short text description of the
    condition.[¶](#section-7.8-2.4){.pilcrow}
:   

Reference ([REQUIRED]{.bcp14}):
:   A reference to a relevant specification
    document.[¶](#section-7.8-2.6){.pilcrow}
:   

The registration policy varies by Number, as
follows:[¶](#section-7.8-3){.pilcrow}

[]{.break}

0-1023:
:   IETF Review[¶](#section-7.8-4.2){.pilcrow}
:   

1024-32767:
:   Specification Required[¶](#section-7.8-4.4){.pilcrow}
:   

32768-65535:
:   Private or Experimental Use[¶](#section-7.8-4.6){.pilcrow}
:   

The initial contents of the \"Network Time Security Error Codes\"
registry are as follows:[¶](#section-7.8-5){.pilcrow}

  Number        Description                                Reference
  ------------- ------------------------------------------ ----------------------------------------------
  0             Unrecognized Critical Record               RFC 8915, [Section 4.1.3](#nts-error){.xref}
  1             Bad Request                                RFC 8915, [Section 4.1.3](#nts-error){.xref}
  2             Internal Server Error                      RFC 8915, [Section 4.1.3](#nts-error){.xref}
  3-32767       Unassigned                                 
  32768-65535   Reserved for Private or Experimental Use   RFC 8915

  : [Table 6](#table-6){.selfRef}

The \"Network Time Security Warning Codes\" registry is initially empty
except for the reserved range, i.e.:[¶](#section-7.8-7){.pilcrow}

  Number        Description                                Reference
  ------------- ------------------------------------------ -----------
  0-32767       Unassigned                                 
  32768-65535   Reserved for Private or Experimental Use   RFC 8915

  : [Table 7](#table-7){.selfRef}
:::
:::
:::

::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Protected Modes](#name-protected-modes){.section-name .selfRef} {#name-protected-modes}

NTP provides many different operating modes in order to support
different network topologies and to adapt to various requirements. This
memo only specifies NTS for NTP modes 3 (client) and 4 (server) (see
[Section 1.3](#sec-protocol-overview){.xref}). The best current practice
for authenticating the other NTP modes is using the symmetric message
authentication code feature as described in [RFC 5905](#RFC5905){.xref}
\[[RFC5905](#RFC5905){.xref}\] and [RFC 8573](#RFC8573){.xref}
\[[RFC8573](#RFC8573){.xref}\].[¶](#section-8.1-1){.pilcrow}
:::

::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Cookie Encryption Key Compromise](#name-cookie-encryption-key-compr){.section-name .selfRef} {#name-cookie-encryption-key-compr}

If the suggested format for NTS cookies in [Section
6](#suggested-format-for-nts-cookies){.xref} of this document is used,
an attacker who has gained access to the secret cookie encryption key
\'K\' can impersonate the NTP server, including generating new cookies.
NTP and NTS-KE server operators [SHOULD]{.bcp14} remove compromised keys
as soon as the compromise is discovered. This will cause the NTP servers
to respond with NTS NAK, thus forcing key renegotiation. Note that this
measure does not protect against MITM attacks where the attacker has
access to a compromised cookie encryption key. If another cookie scheme
is used, there are likely similar considerations for that particular
scheme.[¶](#section-8.2-1){.pilcrow}
:::

::: {#section-8.3 .section}
### [8.3.](#section-8.3){.section-number .selfRef} [Sensitivity to DDoS Attacks](#name-sensitivity-to-ddos-attacks){.section-name .selfRef} {#name-sensitivity-to-ddos-attacks}

The introduction of NTS brings with it the introduction of asymmetric
cryptography to NTP. Asymmetric cryptography is necessary for initial
server authentication and AEAD key extraction. Asymmetric cryptosystems
are generally orders of magnitude slower than their symmetric
counterparts. This makes it much harder to build systems that can serve
requests at a rate corresponding to the full line speed of the network
connection. This, in turn, opens up a new possibility for DDoS attacks
on NTP services.[¶](#section-8.3-1){.pilcrow}

The main protection against these attacks in NTS lies in that the use of
asymmetric cryptosystems is only necessary in the initial NTS-KE phase
of the protocol. Since the protocol design enables separation of the
NTS-KE and NTP servers, a successful DDoS attack on an NTS-KE server
separated from the NTP service it supports will not affect NTP users
that have already performed initial authentication, AEAD key extraction,
and cookie exchange.[¶](#section-8.3-2){.pilcrow}

NTS users should also consider that they are not fully protected against
DoS attacks by on-path adversaries. In addition to dropping packets and
attacks such as those described in [Section 8.6](#DelayAttack){.xref},
an on-path attacker can send spoofed Kiss-o\'-Death replies, which are
not authenticated, in response to NTP requests. This could result in
significantly increased load on the NTS-KE server. Implementers have to
weigh the user\'s need for unlinkability against the added resilience
that comes with cookie reuse in cases of NTS-KE server
unavailability.[¶](#section-8.3-3){.pilcrow}
:::

::: {#section-8.4 .section}
### [8.4.](#section-8.4){.section-number .selfRef} [Avoiding DDoS Amplification](#name-avoiding-ddos-amplification){.section-name .selfRef} {#name-avoiding-ddos-amplification}

Certain nonstandard and/or deprecated features of the Network Time
Protocol enable clients to send a request to a server that causes the
server to send a response much larger than the request. Servers that
enable these features can be abused in order to amplify traffic volume
in DDoS attacks by sending them a request with a spoofed source IP
address. In recent years, attacks of this nature have become an endemic
nuisance.[¶](#section-8.4-1){.pilcrow}

NTS is designed to avoid contributing any further to this problem by
ensuring that NTS-related extension fields included in server responses
will be the same size as the NTS-related extension fields sent by the
client. In particular, this is why the client is required to send a
separate and appropriately padded-out NTS Cookie Placeholder extension
field for every cookie it wants to get back, rather than being permitted
simply to specify a desired quantity.[¶](#section-8.4-2){.pilcrow}

Due to the [RFC 7822](#RFC7822){.xref} \[[RFC7822](#RFC7822){.xref}\]
requirement that extensions be padded and aligned to four-octet
boundaries, response size may still in some cases exceed request size by
up to three octets. This is sufficiently inconsequential that we have
declined to address it.[¶](#section-8.4-3){.pilcrow}
:::

::: {#sec-cert-verification}
::: {#section-8.5 .section}
### [8.5.](#section-8.5){.section-number .selfRef} [Initial Verification of Server Certificates](#name-initial-verification-of-ser){.section-name .selfRef} {#name-initial-verification-of-ser}

NTS\'s security goals are undermined if the client fails to verify that
the X.509 certificate chain presented by the NTS-KE server is valid and
rooted in a trusted certificate authority. [RFC 5280](#RFC5280){.xref}
\[[RFC5280](#RFC5280){.xref}\] and [RFC 6125](#RFC6125){.xref}
\[[RFC6125](#RFC6125){.xref}\] specify how such verification is to be
performed in general. However, the expectation that the client does not
yet have a correctly-set system clock at the time of certificate
verification presents difficulties with verifying that the certificate
is within its validity period, i.e., that the current time lies between
the times specified in the certificate\'s notBefore and notAfter fields.
It may be operationally necessary in some cases for a client to accept a
certificate that appears to be expired or not yet valid. While there is
no perfect solution to this problem, there are several mitigations the
client can implement to make it more difficult for an adversary to
successfully present an expired
certificate:[¶](#section-8.5-1){.pilcrow}

-   [Check whether the system time is in fact unreliable. On systems
    with the ntp_adjtime() system call, a return code other than
    TIME_ERROR indicates that some trusted software has already set the
    time and certificates can be strictly
    validated.[¶](#section-8.5-2.1){.pilcrow}]{#section-8.5-2.1}
-   [Allow the system administrator to specify that certificates should
    *always* be strictly validated. Such a configuration is appropriate
    on systems that have a battery-backed clock or that can reasonably
    prompt the user to manually set an approximately correct time if it
    appears to be
    needed.[¶](#section-8.5-2.2){.pilcrow}]{#section-8.5-2.2}
-   [Once the clock has been synchronized, periodically write the
    current system time to persistent storage. Do not accept any
    certificate whose notAfter field is earlier than the last recorded
    time.[¶](#section-8.5-2.3){.pilcrow}]{#section-8.5-2.3}
-   [NTP time replies are expected to be consistent with the NTS-KE TLS
    certificate validity period, i.e. time replies received immediately
    after an NTS-KE handshake are expected to lie within the certificate
    validity period. Implementations are recommended to check that this
    is the case. Performing a new NTS-KE handshake based solely on the
    fact that the certificate used by the NTS-KE server in a previous
    handshake has expired is normally not necessary. Clients that still
    wish to do this must take care not to cause an inadvertent
    denial-of-service attack on the NTS-KE server, for example by
    picking a random time in the week preceding certificate expiry to
    perform the new
    handshake.[¶](#section-8.5-2.4){.pilcrow}]{#section-8.5-2.4}
-   [Use multiple time sources. The ability to pass off an expired
    certificate is only useful to an adversary who has compromised the
    corresponding private key. If the adversary has compromised only a
    minority of servers, NTP\'s selection algorithm (Section
    [11.2.1](https://www.rfc-editor.org/rfc/rfc5905#section-11.2.1){.relref}
    of [RFC 5905](#RFC5905){.xref} \[[RFC5905](#RFC5905){.xref}\]) will
    protect the client from accepting bad time from the
    adversary-controlled
    servers.[¶](#section-8.5-2.5){.pilcrow}]{#section-8.5-2.5}
:::
:::

::: {#DelayAttack}
::: {#section-8.6 .section}
### [8.6.](#section-8.6){.section-number .selfRef} [Delay Attacks](#name-delay-attacks){.section-name .selfRef} {#name-delay-attacks}

In a packet delay attack, an adversary with the ability to act as a
man-in-the-middle delays time synchronization packets between client and
server asymmetrically \[[RFC7384](#RFC7384){.xref}\]. Since NTP\'s
formula for computing time offset relies on the assumption that network
latency is roughly symmetrical, this leads to the client to compute an
inaccurate value \[[Mizrahi](#Mizrahi){.xref}\]. The delay attack does
not reorder or modify the content of the exchanged synchronization
packets. Therefore, cryptographic means do not provide a feasible way to
mitigate this attack. However, the maximum error that an adversary can
introduce is bounded by half of the round-trip
delay.[¶](#section-8.6-1){.pilcrow}

[RFC 5905](#RFC5905){.xref} \[[RFC5905](#RFC5905){.xref}\] specifies a
parameter called MAXDIST, which denotes the maximum round-trip latency
(including not only the immediate round trip between client and server,
but the whole distance back to the reference clock as reported in the
Root Delay field) that a client will tolerate before concluding that the
server is unsuitable for synchronization. The standard value for MAXDIST
is one second, although some implementations use larger values. Whatever
value a client chooses, the maximum error that can be introduced by a
delay attack is MAXDIST/2.[¶](#section-8.6-2){.pilcrow}

Usage of multiple time sources, or multiple network paths to a given
time source \[[Shpiner](#Shpiner){.xref}\], may also serve to mitigate
delay attacks if the adversary is in control of only some of the
paths.[¶](#section-8.6-3){.pilcrow}
:::
:::

::: {#section-8.7 .section}
### [8.7.](#section-8.7){.section-number .selfRef} [NTS Stripping](#name-nts-stripping){.section-name .selfRef} {#name-nts-stripping}

Implementers must be aware of the possibility of \"NTS stripping\"
attacks, where an attacker attempts to trick clients into reverting to
plain NTP. Naive client implementations might, for example, revert
automatically to plain NTP if the NTS-KE handshake fails. A
man-in-the-middle attacker can easily cause this to happen. Even clients
that already hold valid cookies can be vulnerable, since an attacker can
force a client to repeat the NTS-KE handshake by sending faked NTP mode
4 replies with the NTS NAK kiss code. Forcing a client to repeat the
NTS-KE handshake can also be the first step in more advanced
attacks.[¶](#section-8.7-1){.pilcrow}

For the reasons described here, implementations [SHOULD NOT]{.bcp14}
revert from NTS-protected to unprotected NTP with any server without
explicit user action.[¶](#section-8.7-2){.pilcrow}
:::
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Privacy Considerations](#name-privacy-considerations){.section-name .selfRef} {#name-privacy-considerations}

::: {#Unlinkability}
::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Unlinkability](#name-unlinkability){.section-name .selfRef} {#name-unlinkability}

Unlinkability prevents a device from being tracked when it changes
network addresses (e.g., because said device moved between different
networks). In other words, unlinkability thwarts an attacker that seeks
to link a new network address used by a device with a network address
that it was formerly using because of recognizable data that the device
persistently sends as part of an NTS-secured NTP association. This is
the justification for continually supplying the client with fresh
cookies, so that a cookie never represents recognizable data in the
sense outlined above.[¶](#section-9.1-1){.pilcrow}

NTS\'s unlinkability objective is merely to not leak any additional data
that could be used to link a device\'s network address. NTS does not
rectify legacy linkability issues that are already present in NTP. Thus,
a client that requires unlinkability must also minimize information
transmitted in a client query (mode 3) packet as described in the
document [NTP Client Data
Minimization](#I-D.ietf-ntp-data-minimization){.xref}
\[[NTP-DATA-MIN](#I-D.ietf-ntp-data-minimization){.xref}\].[¶](#section-9.1-2){.pilcrow}

The unlinkability objective only holds for time synchronization traffic,
as opposed to key establishment traffic. This implies that it cannot be
guaranteed for devices that function not only as time clients, but also
as time servers (because the latter can be externally triggered to send
linkable data, such as the TLS
certificate).[¶](#section-9.1-3){.pilcrow}

It should also be noted that it could be possible to link devices that
operate as time servers from their time synchronization traffic, using
information exposed in (mode 4) server response packets (e.g. reference
ID, reference time, stratum, poll). Also, devices that respond to NTP
control queries could be linked using the information revealed by
control queries.[¶](#section-9.1-4){.pilcrow}

Note that the unlinkability objective does not prevent a client device
from being tracked by its time servers.[¶](#section-9.1-5){.pilcrow}
:::
:::

::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Confidentiality](#name-confidentiality){.section-name .selfRef} {#name-confidentiality}

NTS does not protect the confidentiality of information in NTP\'s header
fields. When clients implement [NTP Client Data
Minimization](#I-D.ietf-ntp-data-minimization){.xref}
\[[NTP-DATA-MIN](#I-D.ietf-ntp-data-minimization){.xref}\], client
packet headers do not contain any information that the client could
conceivably wish to keep secret: one field is random, and all others are
fixed. Information in server packet headers is likewise public: the
origin timestamp is copied from the client\'s (random) transmit
timestamp, and all other fields are set the same regardless of the
identity of the client making the request.[¶](#section-9.2-1){.pilcrow}

Future extension fields could hypothetically contain sensitive
information, in which case NTS provides a mechanism for encrypting
them.[¶](#section-9.2-2){.pilcrow}
:::
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[IANA-AEAD\]
:   [IANA]{.refAuthor}, [\"Authenticated Encryption with Associated Data
    (AEAD) Parameters\"]{.refTitle},
    \<<https://www.iana.org/assignments/aead-parameters/>\>.
:   

\[RFC0020\]
:   [Cerf, V.]{.refAuthor}, [\"ASCII format for network
    interchange\"]{.refTitle}, [STD 80]{.seriesInfo}, [RFC
    20]{.seriesInfo}, [DOI 10.17487/RFC0020]{.seriesInfo}, October 1969,
    \<<https://www.rfc-editor.org/info/rfc20>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC4291\]
:   [Hinden, R.]{.refAuthor}[ and S. Deering]{.refAuthor}, [\"IP Version
    6 Addressing Architecture\"]{.refTitle}, [RFC 4291]{.seriesInfo},
    [DOI 10.17487/RFC4291]{.seriesInfo}, February 2006,
    \<<https://www.rfc-editor.org/info/rfc4291>\>.
:   

\[RFC5116\]
:   [McGrew, D.]{.refAuthor}, [\"An Interface and Algorithms for
    Authenticated Encryption\"]{.refTitle}, [RFC 5116]{.seriesInfo},
    [DOI 10.17487/RFC5116]{.seriesInfo}, January 2008,
    \<<https://www.rfc-editor.org/info/rfc5116>\>.
:   

\[RFC5280\]
:   [Cooper, D.]{.refAuthor}[, Santesson, S.]{.refAuthor}[,
    Farrell, S.]{.refAuthor}[, Boeyen, S.]{.refAuthor}[,
    Housley, R.]{.refAuthor}[, and W. Polk]{.refAuthor}, [\"Internet
    X.509 Public Key Infrastructure Certificate and Certificate
    Revocation List (CRL) Profile\"]{.refTitle}, [RFC
    5280]{.seriesInfo}, [DOI 10.17487/RFC5280]{.seriesInfo}, May 2008,
    \<<https://www.rfc-editor.org/info/rfc5280>\>.
:   

\[RFC5297\]
:   [Harkins, D.]{.refAuthor}, [\"Synthetic Initialization Vector (SIV)
    Authenticated Encryption Using the Advanced Encryption Standard
    (AES)\"]{.refTitle}, [RFC 5297]{.seriesInfo}, [DOI
    10.17487/RFC5297]{.seriesInfo}, October 2008,
    \<<https://www.rfc-editor.org/info/rfc5297>\>.
:   

\[RFC5705\]
:   [Rescorla, E.]{.refAuthor}, [\"Keying Material Exporters for
    Transport Layer Security (TLS)\"]{.refTitle}, [RFC
    5705]{.seriesInfo}, [DOI 10.17487/RFC5705]{.seriesInfo}, March 2010,
    \<<https://www.rfc-editor.org/info/rfc5705>\>.
:   

\[RFC5869\]
:   [Krawczyk, H.]{.refAuthor}[ and P. Eronen]{.refAuthor},
    [\"HMAC-based Extract-and-Expand Key Derivation Function
    (HKDF)\"]{.refTitle}, [RFC 5869]{.seriesInfo}, [DOI
    10.17487/RFC5869]{.seriesInfo}, May 2010,
    \<<https://www.rfc-editor.org/info/rfc5869>\>.
:   

\[RFC5890\]
:   [Klensin, J.]{.refAuthor}, [\"Internationalized Domain Names for
    Applications (IDNA): Definitions and Document
    Framework\"]{.refTitle}, [RFC 5890]{.seriesInfo}, [DOI
    10.17487/RFC5890]{.seriesInfo}, August 2010,
    \<<https://www.rfc-editor.org/info/rfc5890>\>.
:   

\[RFC5905\]
:   [Mills, D.]{.refAuthor}[, Martin, J., Ed.]{.refAuthor}[,
    Burbank, J.]{.refAuthor}[, and W. Kasch]{.refAuthor}, [\"Network
    Time Protocol Version 4: Protocol and Algorithms
    Specification\"]{.refTitle}, [RFC 5905]{.seriesInfo}, [DOI
    10.17487/RFC5905]{.seriesInfo}, June 2010,
    \<<https://www.rfc-editor.org/info/rfc5905>\>.
:   

\[RFC6125\]
:   [Saint-Andre, P.]{.refAuthor}[ and J. Hodges]{.refAuthor},
    [\"Representation and Verification of Domain-Based Application
    Service Identity within Internet Public Key Infrastructure Using
    X.509 (PKIX) Certificates in the Context of Transport Layer Security
    (TLS)\"]{.refTitle}, [RFC 6125]{.seriesInfo}, [DOI
    10.17487/RFC6125]{.seriesInfo}, March 2011,
    \<<https://www.rfc-editor.org/info/rfc6125>\>.
:   

\[RFC6335\]
:   [Cotton, M.]{.refAuthor}[, Eggert, L.]{.refAuthor}[,
    Touch, J.]{.refAuthor}[, Westerlund, M.]{.refAuthor}[, and S.
    Cheshire]{.refAuthor}, [\"Internet Assigned Numbers Authority (IANA)
    Procedures for the Management of the Service Name and Transport
    Protocol Port Number Registry\"]{.refTitle}, [BCP 165]{.seriesInfo},
    [RFC 6335]{.seriesInfo}, [DOI 10.17487/RFC6335]{.seriesInfo}, August
    2011, \<<https://www.rfc-editor.org/info/rfc6335>\>.
:   

\[RFC6874\]
:   [Carpenter, B.]{.refAuthor}[, Cheshire, S.]{.refAuthor}[, and R.
    Hinden]{.refAuthor}, [\"Representing IPv6 Zone Identifiers in
    Address Literals and Uniform Resource Identifiers\"]{.refTitle},
    [RFC 6874]{.seriesInfo}, [DOI 10.17487/RFC6874]{.seriesInfo},
    February 2013, \<<https://www.rfc-editor.org/info/rfc6874>\>.
:   

\[RFC7301\]
:   [Friedl, S.]{.refAuthor}[, Popov, A.]{.refAuthor}[,
    Langley, A.]{.refAuthor}[, and E. Stephan]{.refAuthor}, [\"Transport
    Layer Security (TLS) Application-Layer Protocol Negotiation
    Extension\"]{.refTitle}, [RFC 7301]{.seriesInfo}, [DOI
    10.17487/RFC7301]{.seriesInfo}, July 2014,
    \<<https://www.rfc-editor.org/info/rfc7301>\>.
:   

\[RFC7525\]
:   [Sheffer, Y.]{.refAuthor}[, Holz, R.]{.refAuthor}[, and P.
    Saint-Andre]{.refAuthor}, [\"Recommendations for Secure Use of
    Transport Layer Security (TLS) and Datagram Transport Layer Security
    (DTLS)\"]{.refTitle}, [BCP 195]{.seriesInfo}, [RFC
    7525]{.seriesInfo}, [DOI 10.17487/RFC7525]{.seriesInfo}, May 2015,
    \<<https://www.rfc-editor.org/info/rfc7525>\>.
:   

\[RFC7822\]
:   [Mizrahi, T.]{.refAuthor}[ and D. Mayer]{.refAuthor}, [\"Network
    Time Protocol Version 4 (NTPv4) Extension Fields\"]{.refTitle}, [RFC
    7822]{.seriesInfo}, [DOI 10.17487/RFC7822]{.seriesInfo}, March 2016,
    \<<https://www.rfc-editor.org/info/rfc7822>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8446\]
:   [Rescorla, E.]{.refAuthor}, [\"The Transport Layer Security (TLS)
    Protocol Version 1.3\"]{.refTitle}, [RFC 8446]{.seriesInfo}, [DOI
    10.17487/RFC8446]{.seriesInfo}, August 2018,
    \<<https://www.rfc-editor.org/info/rfc8446>\>.
:   
:::

::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[Mizrahi\]
:   [Mizrahi, T.]{.refAuthor}, [\"A game theoretic analysis of delay
    attacks against time synchronization protocols\"]{.refTitle}, [2012
    IEEE International Symposium on Precision Clock Synchronization for
    Measurement, Control and Communication Proceedings, pp.
    1-6]{.refContent}, [DOI 10.1109/ISPCS.2012.6336612]{.seriesInfo},
    September 2012, \<<https://doi.org/10.1109/ISPCS.2012.6336612>\>.
:   

\[NTP-DATA-MIN\]
:   [Franke, D. F.]{.refAuthor}[ and A. Malhotra]{.refAuthor}, [\"NTP
    Client Data Minimization\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-ietf-ntp-data-minimization-04]{.seriesInfo}, 25 March 2019,
    \<<https://tools.ietf.org/html/draft-ietf-ntp-data-minimization-04>\>.
:   

\[RFC4086\]
:   [Eastlake 3rd, D.]{.refAuthor}[, Schiller, J.]{.refAuthor}[, and S.
    Crocker]{.refAuthor}, [\"Randomness Requirements for
    Security\"]{.refTitle}, [BCP 106]{.seriesInfo}, [RFC
    4086]{.seriesInfo}, [DOI 10.17487/RFC4086]{.seriesInfo}, June 2005,
    \<<https://www.rfc-editor.org/info/rfc4086>\>.
:   

\[RFC5077\]
:   [Salowey, J.]{.refAuthor}[, Zhou, H.]{.refAuthor}[,
    Eronen, P.]{.refAuthor}[, and H. Tschofenig]{.refAuthor},
    [\"Transport Layer Security (TLS) Session Resumption without
    Server-Side State\"]{.refTitle}, [RFC 5077]{.seriesInfo}, [DOI
    10.17487/RFC5077]{.seriesInfo}, January 2008,
    \<<https://www.rfc-editor.org/info/rfc5077>\>.
:   

\[RFC7384\]
:   [Mizrahi, T.]{.refAuthor}, [\"Security Requirements of Time
    Protocols in Packet Switched Networks\"]{.refTitle}, [RFC
    7384]{.seriesInfo}, [DOI 10.17487/RFC7384]{.seriesInfo}, October
    2014, \<<https://www.rfc-editor.org/info/rfc7384>\>.
:   

\[RFC8573\]
:   [Malhotra, A.]{.refAuthor}[ and S. Goldberg]{.refAuthor}, [\"Message
    Authentication Code for the Network Time Protocol\"]{.refTitle},
    [RFC 8573]{.seriesInfo}, [DOI 10.17487/RFC8573]{.seriesInfo}, June
    2019, \<<https://www.rfc-editor.org/info/rfc8573>\>.
:   

\[Shpiner\]
:   [Shpiner, A.]{.refAuthor}[, Revah, Y.]{.refAuthor}[, and T.
    Mizrahi]{.refAuthor}, [\"Multi-path Time Protocols\"]{.refTitle},
    [2013 IEEE International Symposium on Precision Clock
    Synchronization for Measurement, Control and Communication (ISPCS)
    Proceedings, pp. 1-6]{.refContent}, [DOI
    10.1109/ISPCS.2013.6644754]{.seriesInfo}, September 2013,
    \<<https://doi.org/10.1109/ISPCS.2013.6644754>\>.
:   
:::
:::

::: {#Acknowledgments}
::: {#section-appendix.a .section}
## [Acknowledgments](#name-acknowledgments){.section-name .selfRef} {#name-acknowledgments}

The authors would like to thank [Richard Barnes]{.contact-name}, [Steven
Bellovin]{.contact-name}, [Scott Fluhrer]{.contact-name}, [Patrik
Fältström]{.contact-name}, [Sharon Goldberg]{.contact-name}, [Russ
Housley]{.contact-name}, [Benjamin Kaduk]{.contact-name}, [Suresh
Krishnan]{.contact-name}, [Mirja Kühlewind]{.contact-name}, [Martin
Langer]{.contact-name}, [Barry Leiba]{.contact-name}, [Miroslav
Lichvar]{.contact-name}, [Aanchal Malhotra]{.contact-name}, [Danny
Mayer]{.contact-name}, [Dave Mills]{.contact-name}, [Sandra
Murphy]{.contact-name}, [Hal Murray]{.contact-name}, [Karen
O\'Donoghue]{.contact-name}, [Eric K. Rescorla]{.contact-name}, [Kurt
Roeckx]{.contact-name}, [Stephen Roettger]{.contact-name}, [Dan
Romascanu]{.contact-name}, [Kyle Rose]{.contact-name}, [Rich
Salz]{.contact-name}, [Brian Sniffen]{.contact-name}, [Susan
Sons]{.contact-name}, [Douglas Stebila]{.contact-name}, [Harlan
Stenn]{.contact-name}, [Joachim Strömbergsson]{.contact-name}, [Martin
Thomson]{.contact-name}, [Éric Vyncke]{.contact-name}, [Richard
Welty]{.contact-name}, [Christer Weinigel]{.contact-name}, and [Magnus
Westerlund]{.contact-name} for contributions to this document and
comments on the design of NTS.[¶](#section-appendix.a-1){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#section-appendix.b .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Daniel Fox Franke]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Akamai Technologies]{.org}
:::

::: {.left dir="auto"}
[145 Broadway]{.street-address}
:::

::: {.left dir="auto"}
[Cambridge]{.locality}, [MA]{.region} [02142]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <dafranke@akamai.com>
:::

::: {.left dir="auto"}
[Dieter Sibold]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Physikalisch-Technische Bundesanstalt]{.org}
:::

::: {.left dir="auto"}
[Bundesallee 100]{.street-address}
:::

::: {.left dir="auto"}
[D-38116]{.postal-code} [Braunschweig]{.locality}
:::

::: {.left dir="auto"}
[Germany]{.country-name}
:::

::: tel
Phone: [+49-(0)531-592-8462](tel:+49-(0)531-592-8462){.tel}
:::

::: email
Email: <dieter.sibold@ptb.de>
:::

::: {.left dir="auto"}
[Kristof Teichel]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Physikalisch-Technische Bundesanstalt]{.org}
:::

::: {.left dir="auto"}
[Bundesallee 100]{.street-address}
:::

::: {.left dir="auto"}
[D-38116]{.postal-code} [Braunschweig]{.locality}
:::

::: {.left dir="auto"}
[Germany]{.country-name}
:::

::: tel
Phone: [+49-(0)531-592-4471](tel:+49-(0)531-592-4471){.tel}
:::

::: email
Email: <kristof.teichel@ptb.de>
:::

::: {.left dir="auto"}
[Marcus Dansarie]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Sweden]{.country-name}
:::

::: email
Email: <marcus@dansarie.se>
:::

::: url
URI: <https://orcid.org/0000-0001-9246-0263>
:::

::: {.left dir="auto"}
[Ragnar Sundblad]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Netnod]{.org}
:::

::: {.left dir="auto"}
[Sweden]{.country-name}
:::

::: email
Email: <ragge@netnod.se>
:::
:::
:::
