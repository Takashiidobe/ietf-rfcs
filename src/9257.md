  RFC 9257          Guidance for External PSK Usage in TLS   July 2022
  ----------------- ---------------------------------------- -----------
  Housley, et al.   Informational                            \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9257](https://www.rfc-editor.org/rfc/rfc9257){.eref}

Category:
:   Informational

Published:
:   July 2022

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    R. Housley
    :::

    ::: org
    Vigil Security
    :::
    :::

    ::: author
    ::: author-name
    J. Hoyland
    :::

    ::: org
    Cloudflare Ltd.
    :::
    :::

    ::: author
    ::: author-name
    M. Sethi
    :::

    ::: org
    Aalto University
    :::
    :::

    ::: author
    ::: author-name
    C. A. Wood
    :::

    ::: org
    Cloudflare
    :::
    :::
:::

# RFC 9257 {#rfcnum}

# Guidance for External Pre-Shared Key (PSK) Usage in TLS {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document provides usage guidance for external Pre-Shared Keys
(PSKs) in Transport Layer Security (TLS) 1.3 as defined in RFC 8446. It
lists TLS security properties provided by PSKs under certain
assumptions, then it demonstrates how violations of these assumptions
lead to attacks. Advice for applications to help meet these assumptions
is provided. This document also discusses PSK use cases and provisioning
processes. Finally, it lists the privacy and security properties that
are not provided by TLS 1.3 when external PSKs are
used.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This document is not an Internet Standards Track specification; it is
published for informational
purposes.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Not all documents approved
by the IESG are candidates for any level of Internet Standard; see
Section 2 of RFC 7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9257>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2022 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Revised BSD License text as described in Section 4.e of the Trust Legal
Provisions and are provided without warranty as described in the Revised
BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Conventions and
    Definitions](#name-conventions-and-definitions){.xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Notation](#name-notation){.xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [PSK Security
    Properties](#name-psk-security-properties){.xref}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [Shared
        PSKs](#name-shared-psks){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [PSK
        Entropy](#name-psk-entropy){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [External PSKs in
    Practice](#name-external-psks-in-practice){.xref}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [Use Cases](#name-use-cases){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [Provisioning
        Examples](#name-provisioning-examples){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.xref}.  [Provisioning
        Constraints](#name-provisioning-constraints){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Recommendations for External PSK
    Usage](#name-recommendations-for-externa){.xref}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.xref}.  [Stack
        Interfaces](#name-stack-interfaces){.xref}

        -   ::: {#section-toc.1-1.6.2.1.2.1}
            [6.1.1](#section-6.1.1){.xref}.  [PSK Identity Encoding and
            Comparison](#name-psk-identity-encoding-and-c){.xref}
            :::

        -   ::: {#section-toc.1-1.6.2.1.2.2}
            [6.1.2](#section-6.1.2){.xref}.  [PSK Identity
            Collisions](#name-psk-identity-collisions){.xref}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Privacy
    Considerations](#name-privacy-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [References](#name-references){.xref}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [Normative
        References](#name-normative-references){.xref}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Informative
        References](#name-informative-references){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [](#appendix-A){.xref}[Acknowledgements](#name-acknowledgements){.xref}
    :::

-   ::: {#section-toc.1-1.12}
    [](#appendix-B){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}
    :::
:::
:::

::: {#introduction}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

This document provides guidance on the use of external Pre-Shared Keys
(PSKs) in Transport Layer Security (TLS) 1.3
\[[RFC8446](#RFC8446){.xref}\]. This guidance also applies to Datagram
TLS (DTLS) 1.3 \[[RFC9147](#RFC9147){.xref}\] and Compact TLS 1.3
\[[CTLS](#I-D.ietf-tls-ctls){.xref}\]. For readability, this document
uses the term \"TLS\" to refer to all such
versions.[¶](#section-1-1){.pilcrow}

External PSKs are symmetric secret keys provided to the TLS protocol
implementation as external inputs. External PSKs are provisioned out of
band.[¶](#section-1-2){.pilcrow}

This document lists TLS security properties provided by PSKs under
certain assumptions and demonstrates how violations of these assumptions
lead to attacks. This document discusses PSK use cases, provisioning
processes, and TLS stack implementation support in the context of these
assumptions. This document also provides advice for applications in
various use cases to help meet these
assumptions.[¶](#section-1-3){.pilcrow}

There are many resources that provide guidance for password generation
and verification aimed towards improving security. However, there is no
such equivalent for external PSKs in TLS. This document aims to reduce
that gap.[¶](#section-1-4){.pilcrow}
:::
:::

::: {#conventions-and-definitions}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Conventions and Definitions](#name-conventions-and-definitions){.section-name .selfRef} {#name-conventions-and-definitions}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::
:::

::: {#notation}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Notation](#name-notation){.section-name .selfRef} {#name-notation}

For purposes of this document, a \"logical node\" is a computing
presence that other parties can interact with via the TLS protocol. A
logical node could potentially be realized with multiple physical
instances operating under common administrative control, e.g., a server
farm. An \"endpoint\" is a client or server participating in a
connection.[¶](#section-3-1){.pilcrow}
:::
:::

::: {#sec-properties}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [PSK Security Properties](#name-psk-security-properties){.section-name .selfRef} {#name-psk-security-properties}

The use of a previously established PSK allows TLS nodes to authenticate
the endpoint identities. It also offers other benefits, including
resistance to attacks in the presence of quantum computers; see [Section
4.2](#entropy){.xref} for related discussion. However, these keys do not
provide privacy protection of endpoint identities, nor do they provide
non-repudiation (one endpoint in a connection can deny the
conversation); see [Section 7](#endpoint-privacy){.xref} for related
discussion.[¶](#section-4-1){.pilcrow}

PSK authentication security implicitly assumes one fundamental property:
each PSK is known to exactly one client and one server and they never
switch roles. If this assumption is violated, then the security
properties of TLS are severely weakened as discussed
below.[¶](#section-4-2){.pilcrow}

::: {#shared-psks}
::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [Shared PSKs](#name-shared-psks){.section-name .selfRef} {#name-shared-psks}

As discussed in [Section 5.1](#use-cases){.xref}, to demonstrate their
attack, \[[AASS19](#AASS19){.xref}\] describes scenarios where multiple
clients or multiple servers share a PSK. If this is done naively by
having all members share a common key, then TLS authenticates only group
membership, and the security of the overall system is inherently rather
brittle. There are a number of obvious weaknesses
here:[¶](#section-4.1-1){.pilcrow}

1.  [Any group member can impersonate any other group
    member.[¶](#section-4.1-2.1){.pilcrow}]{#section-4.1-2.1}
2.  [If a PSK is combined with the result of a fresh ephemeral key
    exchange, then compromise of a group member that knows the resulting
    shared secret will enable the attacker to passively read traffic
    (and actively modify
    it).[¶](#section-4.1-2.2){.pilcrow}]{#section-4.1-2.2}
3.  [If a PSK is not combined with the result of a fresh ephemeral key
    exchange, then compromise of any group member allows the attacker to
    passively read all traffic (and actively modify it), including past
    traffic.[¶](#section-4.1-2.3){.pilcrow}]{#section-4.1-2.3}

Additionally, a malicious non-member can reroute handshakes between
honest group members to connect them in unintended ways, as described
below. Note that a partial mitigation for this class of attack is
available: each group member includes the Server Name Indication (SNI)
extension \[[RFC6066](#RFC6066){.xref}\] and terminates the connection
on mismatch between the presented SNI value and the receiving member\'s
known identity. See \[[Selfie](#Selfie){.xref}\] for
details.[¶](#section-4.1-3){.pilcrow}

To illustrate the rerouting attack, consider three peers, `A`, `B`, and
`C`, who all know the PSK. The attack proceeds as
follows:[¶](#section-4.1-4){.pilcrow}

1.  [`A` sends a `ClientHello` to
    `B`.[¶](#section-4.1-5.1){.pilcrow}]{#section-4.1-5.1}
2.  [The attacker intercepts the message and redirects it to
    `C`.[¶](#section-4.1-5.2){.pilcrow}]{#section-4.1-5.2}
3.  [`C` responds with a second flight (`ServerHello`, \...) to
    `A`.[¶](#section-4.1-5.3){.pilcrow}]{#section-4.1-5.3}
4.  [`A` sends a `Finished` message to `B`. `A` has completed the
    handshake, ostensibly with
    `B`.[¶](#section-4.1-5.4){.pilcrow}]{#section-4.1-5.4}
5.  [The attacker redirects the `Finished` message to `C`. `C` has
    completed the handshake with
    `A`.[¶](#section-4.1-5.5){.pilcrow}]{#section-4.1-5.5}

In this attack, peer authentication is not provided. Also, if `C`
supports a weaker set of ciphersuites than `B`, cryptographic algorithm
downgrade attacks might be possible. This rerouting is a type of
identity misbinding attack \[[Krawczyk](#Krawczyk){.xref}\]
\[[Sethi](#Sethi){.xref}\]. Selfie attack \[[Selfie](#Selfie){.xref}\]
is a special case of the rerouting attack against a group member that
can act as both a TLS server and a client. In the Selfie attack, a
malicious non-member reroutes a connection from the client to the server
on the same endpoint.[¶](#section-4.1-6){.pilcrow}

Finally, in addition to these weaknesses, sharing a PSK across nodes may
negatively affect deployments. For example, revocation of individual
group members is not possible without establishing a new PSK for all of
the members that have not been revoked.[¶](#section-4.1-7){.pilcrow}
:::
:::

::: {#entropy}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [PSK Entropy](#name-psk-entropy){.section-name .selfRef} {#name-psk-entropy}

Entropy properties of external PSKs may also affect TLS security
properties. For example, if a high-entropy PSK is used, then PSK-only
key establishment modes provide expected security properties for TLS,
including establishment of the same session keys between peers, secrecy
of session keys, peer authentication, and downgrade protection. See
[Appendix
E.1](https://www.rfc-editor.org/rfc/rfc8446#appendix-E.1){.relref} of
\[[RFC8446](#RFC8446){.xref}\] for an explanation of these properties.
However, these modes lack forward security. Forward security may be
achieved by using a PSK-DH mode or by using PSKs with short
lifetimes.[¶](#section-4.2-1){.pilcrow}

In contrast, if a low-entropy PSK is used, then PSK-only key
establishment modes are subject to passive exhaustive search attacks,
which will reveal the traffic keys. PSK-DH modes are subject to active
attacks in which the attacker impersonates one side. The exhaustive
search phase of these attacks can be mounted offline if the attacker
captures a single handshake using the PSK, but those attacks will not
lead to compromise of the traffic keys for that connection because those
also depend on the Diffie-Hellman (DH) exchange. Low-entropy keys are
only secure against active attack if a Password-Authenticated Key
Exchange (PAKE) is used with TLS. At the time of writing, the Crypto
Forum Research Group (CFRG) is working on specifying recommended PAKEs
(see \[[CPACE](#I-D.irtf-cfrg-cpace){.xref}\] and
\[[OPAQUE](#I-D.irtf-cfrg-opaque){.xref}\] for the symmetric and
asymmetric cases, respectively).[¶](#section-4.2-2){.pilcrow}
:::
:::
:::
:::

::: {#external-psks-in-practice}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [External PSKs in Practice](#name-external-psks-in-practice){.section-name .selfRef} {#name-external-psks-in-practice}

PSK ciphersuites were first specified for TLS in 2005. PSKs are now an
integral part of the TLS 1.3 specification
\[[RFC8446](#RFC8446){.xref}\]. TLS 1.3 also uses PSKs for session
resumption. It distinguishes these resumption PSKs from external PSKs
that have been provisioned out of band. This section describes known use
cases and provisioning processes for external PSKs with
TLS.[¶](#section-5-1){.pilcrow}

::: {#use-cases}
::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [Use Cases](#name-use-cases){.section-name .selfRef} {#name-use-cases}

This section lists some example use cases where pairwise external PSKs
(i.e., external PSKs that are shared between only one server and one
client) have been used for authentication in TLS. There was no attempt
to prioritize the examples in any particular
order.[¶](#section-5.1-1){.pilcrow}

-   [Device-to-device communication with out-of-band synchronized keys.
    PSKs provisioned out of band for communicating with known
    identities, wherein the identity to use is discovered via a
    different online
    protocol.[¶](#section-5.1-2.1){.pilcrow}]{#section-5.1-2.1}
-   [Intra-data-center communication. Machine-to-machine communication
    within a single data center or Point of Presence (PoP) may use
    externally provisioned PSKs; this is primarily for the purpose of
    supporting TLS connections with early data. See [Section
    8](#security-con){.xref} for considerations when using early data
    with external
    PSKs.[¶](#section-5.1-2.2){.pilcrow}]{#section-5.1-2.2}
-   [Certificateless server-to-server communication. Machine-to-machine
    communication may use externally provisioned PSKs; this is primarily
    for the purposes of establishing TLS connections without requiring
    the overhead of provisioning and managing PKI
    certificates.[¶](#section-5.1-2.3){.pilcrow}]{#section-5.1-2.3}
-   [Internet of Things (IoT) and devices with limited computational
    capabilities. \[[RFC7925](#RFC7925){.xref}\] defines TLS and DTLS
    profiles for resource-constrained devices and suggests the use of
    PSK ciphersuites for compliant devices. The Open Mobile Alliance
    Lightweight Machine-to-Machine (LwM2M) Technical Specification
    \[[LwM2M](#LwM2M){.xref}\] states that LwM2M servers [MUST]{.bcp14}
    support the PSK mode of
    DTLS.[¶](#section-5.1-2.4){.pilcrow}]{#section-5.1-2.4}
-   [Securing RADIUS \[[RFC2865](#RFC2865){.xref}\] with TLS. PSK
    ciphersuites are optional for this use case, as specified in
    \[[RFC6614](#RFC6614){.xref}\].[¶](#section-5.1-2.5){.pilcrow}]{#section-5.1-2.5}
-   [3GPP server-to-user equipment authentication. The Generic
    Authentication Architecture (GAA) defined by 3GPP mentions that TLS
    PSK ciphersuites can be used between server and user equipment for
    authentication
    \[[GAA](#GAA){.xref}\].[¶](#section-5.1-2.6){.pilcrow}]{#section-5.1-2.6}
-   [Smart Cards. The German electronic Identity (eID) card supports
    authentication of a card holder to online services with TLS PSK
    \[[SmartCard](#SmartCard){.xref}\].[¶](#section-5.1-2.7){.pilcrow}]{#section-5.1-2.7}
-   [Quantum resistance. Some deployments may use PSKs (or combine them
    with certificate-based authentication as described in
    \[[RFC8773](#RFC8773){.xref}\]) because of the protection they
    provide against quantum
    computers.[¶](#section-5.1-2.8){.pilcrow}]{#section-5.1-2.8}

There are also use cases where PSKs are shared between more than two
entities. Some examples below (as noted by Akhmetzyanova, et al.
\[[AASS19](#AASS19){.xref}\]):[¶](#section-5.1-3){.pilcrow}

-   [Group chats. In this use case, group participants may be
    provisioned an external PSK out of band for establishing
    authenticated connections with other members of the
    group.[¶](#section-5.1-4.1){.pilcrow}]{#section-5.1-4.1}
-   [IoT and devices with limited computational capabilities. Many PSK
    provisioning examples are possible in this use case. For example, in
    a given setting, IoT devices may all share the same PSK and use it
    to communicate with a central server (one key for n devices), have
    their own key for communicating with a central server (n keys for n
    devices), or have pairwise keys for communicating with each other
    (n^2^ keys for n
    devices).[¶](#section-5.1-4.2){.pilcrow}]{#section-5.1-4.2}
:::
:::

::: {#provisioning-examples}
::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [Provisioning Examples](#name-provisioning-examples){.section-name .selfRef} {#name-provisioning-examples}

The exact provisioning process depends on the system requirements and
threat model. Whenever possible, avoid sharing a PSK between nodes;
however, sharing a PSK among several nodes is sometimes unavoidable.
When PSK sharing happens, other accommodations [SHOULD]{.bcp14} be used
as discussed in [Section
6](#recommendations){.xref}.[¶](#section-5.2-1){.pilcrow}

Examples of PSK provisioning processes are included
below.[¶](#section-5.2-2){.pilcrow}

-   [Many industrial protocols assume that PSKs are distributed and
    assigned manually via one of the following approaches: (1) typing
    the PSK into the devices or (2) using a trust-on-first-use (TOFU)
    approach with a device completely unprotected before the first login
    took place. Many devices have a very limited UI. For example, they
    may only have a numeric keypad or even fewer buttons. When the TOFU
    approach is not suitable, entering the key would require typing it
    on a constrained
    UI.[¶](#section-5.2-3.1){.pilcrow}]{#section-5.2-3.1}
-   [Some devices provision PSKs via an out-of-band, cloud-based syncing
    protocol.[¶](#section-5.2-3.2){.pilcrow}]{#section-5.2-3.2}
-   [Some secrets may be baked into hardware or software device
    components. Moreover, when this is done at manufacturing time,
    secrets may be printed on labels or included in a Bill of Materials
    for ease of scanning or
    import.[¶](#section-5.2-3.3){.pilcrow}]{#section-5.2-3.3}
:::
:::

::: {#provisioning-constraints}
::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [Provisioning Constraints](#name-provisioning-constraints){.section-name .selfRef} {#name-provisioning-constraints}

PSK provisioning systems are often constrained in application-specific
ways. For example, although one goal of provisioning is to ensure that
each pair of nodes has a unique key pair, some systems do not want to
distribute pairwise shared keys to achieve this. As another example,
some systems require the provisioning process to embed
application-specific information in either PSKs or their identities.
Identities may sometimes need to be routable, as is currently under
discussion for
\[[EAP-TLS-PSK](#I-D.mattsson-emu-eap-tls-psk){.xref}\].[¶](#section-5.3-1){.pilcrow}
:::
:::
:::
:::

::: {#recommendations}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Recommendations for External PSK Usage](#name-recommendations-for-externa){.section-name .selfRef} {#name-recommendations-for-externa}

Recommended requirements for applications using external PSKs are as
follows:[¶](#section-6-1){.pilcrow}

1.  [Each PSK [SHOULD]{.bcp14} be derived from at least 128 bits of
    entropy, [MUST]{.bcp14} be at least 128 bits long, and
    [SHOULD]{.bcp14} be combined with an ephemeral key exchange, e.g.,
    by using the \"psk_dhe_ke\" Pre-Shared Key Exchange Mode in TLS 1.3
    for forward secrecy. As discussed in [Section
    4](#sec-properties){.xref}, low-entropy PSKs (i.e., those derived
    from less than 128 bits of entropy) are subject to attack and
    [SHOULD]{.bcp14} be avoided. If only low-entropy keys are available,
    then key establishment mechanisms such as PAKE that mitigate the
    risk of offline dictionary attacks [SHOULD]{.bcp14} be employed.
    Note that no such mechanisms have yet been standardized, and further
    that these mechanisms will not necessarily follow the same
    architecture as the process for incorporating external PSKs
    described in
    \[[RFC9258](#RFC9258){.xref}\].[¶](#section-6-2.1){.pilcrow}]{#section-6-2.1}
2.  [Unless other accommodations are made to mitigate the risks of PSKs
    known to a group, each PSK [MUST]{.bcp14} be restricted in its use
    to at most two logical nodes: one logical node in a TLS client role
    and one logical node in a TLS server role. (The two logical nodes
    [MAY]{.bcp14} be the same, in different roles.) Two acceptable
    accommodations are described in \[[RFC9258](#RFC9258){.xref}\]: (1)
    exchanging client and server identifiers over the TLS connection
    after the handshake and (2) incorporating identifiers for both the
    client and the server into the context string for an external PSK
    importer.[¶](#section-6-2.2){.pilcrow}]{#section-6-2.2}
3.  [Nodes [SHOULD]{.bcp14} use external PSK importers
    \[[RFC9258](#RFC9258){.xref}\] when configuring PSKs for a
    client-server pair when applicable. Importers make provisioning
    external PSKs easier and less error-prone by deriving a unique,
    imported PSK from the external PSK for each key derivation function
    a node supports. See the Security Considerations of
    \[[RFC9258](#RFC9258){.xref}\] for more
    information.[¶](#section-6-2.3){.pilcrow}]{#section-6-2.3}
4.  [Where possible, the main PSK (that which is fed into the importer)
    [SHOULD]{.bcp14} be deleted after the imported keys have been
    generated. This prevents an attacker from bootstrapping a compromise
    of one node into the ability to attack connections between any node;
    otherwise, the attacker can recover the main key and then re-run the
    importer itself.[¶](#section-6-2.4){.pilcrow}]{#section-6-2.4}

::: {#stack-interfaces}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [Stack Interfaces](#name-stack-interfaces){.section-name .selfRef} {#name-stack-interfaces}

Most major TLS implementations support external PSKs. Stacks supporting
external PSKs provide interfaces that applications may use when
configuring PSKs for individual connections. Details about some existing
stacks at the time of writing are below.[¶](#section-6.1-1){.pilcrow}

-   [OpenSSL and BoringSSL: Applications can specify support for
    external PSKs via distinct ciphersuites in TLS 1.2 and below. Also,
    they can then configure callbacks that are invoked for PSK selection
    during the handshake. These callbacks must provide a PSK identity
    and key. The exact format of the callback depends on the negotiated
    TLS protocol version, with new callback functions added specifically
    to OpenSSL for TLS 1.3 \[[RFC8446](#RFC8446){.xref}\] PSK support.
    The PSK length is validated to be between 1-256 bytes (inclusive).
    The PSK identity may be up to 128 bytes
    long.[¶](#section-6.1-2.1){.pilcrow}]{#section-6.1-2.1}
-   [mbedTLS: Client applications configure PSKs before creating a
    connection by providing the PSK identity and value inline. Servers
    must implement callbacks similar to that of OpenSSL. Both PSK
    identity and key lengths may be between 1-16 bytes long
    (inclusive).[¶](#section-6.1-2.2){.pilcrow}]{#section-6.1-2.2}
-   [gnuTLS: Applications configure PSK values as either raw byte
    strings or hexadecimal strings. The PSK identity and key size are
    not validated.[¶](#section-6.1-2.3){.pilcrow}]{#section-6.1-2.3}
-   [wolfSSL: Applications configure PSKs with callbacks similar to
    OpenSSL.[¶](#section-6.1-2.4){.pilcrow}]{#section-6.1-2.4}

::: {#psk-identity-encoding-and-comparison}
::: {#section-6.1.1 .section}
#### [6.1.1.](#section-6.1.1){.section-number .selfRef} [PSK Identity Encoding and Comparison](#name-psk-identity-encoding-and-c){.section-name .selfRef} {#name-psk-identity-encoding-and-c}

[Section
5.1](https://www.rfc-editor.org/rfc/rfc4279#section-5.1){.relref} of
\[[RFC4279](#RFC4279){.xref}\] mandates that the PSK identity should be
first converted to a character string and then encoded to octets using
UTF-8. This was done to avoid interoperability problems (especially when
the identity is configured by human users). On the other hand,
\[[RFC7925](#RFC7925){.xref}\] advises implementations against assuming
any structured format for PSK identities and recommends byte-by-byte
comparison for any operation. When PSK identities are configured
manually, it is important to be aware that visually identical strings
may, in fact, differ due to encoding
issues.[¶](#section-6.1.1-1){.pilcrow}

TLS 1.3 \[[RFC8446](#RFC8446){.xref}\] follows the same practice of
specifying the PSK identity as a sequence of opaque bytes (shown as
opaque identity\<1..2\^16-1> in the specification) that thus is compared
on a byte-by-byte basis. \[[RFC8446](#RFC8446){.xref}\] also requires
that the PSK identities are at least 1 byte and at the most 65535 bytes
in length. Although \[[RFC8446](#RFC8446){.xref}\] does not place strict
requirements on the format of PSK identities, note that the format of
PSK identities can vary depending on the
deployment:[¶](#section-6.1.1-2){.pilcrow}

-   [The PSK identity [MAY]{.bcp14} be a user-configured string when
    used in protocols like Extensible Authentication Protocol (EAP)
    \[[RFC3748](#RFC3748){.xref}\]. For example, gnuTLS treats PSK
    identities as
    usernames.[¶](#section-6.1.1-3.1){.pilcrow}]{#section-6.1.1-3.1}
-   [PSK identities [MAY]{.bcp14} have a domain name suffix for roaming
    and federation. In applications and settings where the domain name
    suffix is privacy sensitive, this practice is [NOT
    RECOMMENDED]{.bcp14}.[¶](#section-6.1.1-3.2){.pilcrow}]{#section-6.1.1-3.2}
-   [Deployments should take care that the length of the PSK identity is
    sufficient to avoid
    collisions.[¶](#section-6.1.1-3.3){.pilcrow}]{#section-6.1.1-3.3}
:::
:::

::: {#psk-identity-collisions}
::: {#section-6.1.2 .section}
#### [6.1.2.](#section-6.1.2){.section-number .selfRef} [PSK Identity Collisions](#name-psk-identity-collisions){.section-name .selfRef} {#name-psk-identity-collisions}

It is possible, though unlikely, that an external PSK identity may clash
with a resumption PSK identity. The TLS stack implementation and
sequencing of PSK callbacks influences the application\'s behavior when
identity collisions occur. When a server receives a PSK identity in a
TLS 1.3 ClientHello, some TLS stacks execute the application\'s
registered callback function before checking the stack\'s internal
session resumption cache. This means that if a PSK identity collision
occurs, the application\'s external PSK usage will typically take
precedence over the internal session resumption
path.[¶](#section-6.1.2-1){.pilcrow}

Because resumption PSK identities are assigned by the TLS stack
implementation, it is [RECOMMENDED]{.bcp14} that these identifiers be
assigned in a manner that lets resumption PSKs be distinguished from
external PSKs to avoid concerns with collisions
altogether.[¶](#section-6.1.2-2){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#endpoint-privacy}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Privacy Considerations](#name-privacy-considerations){.section-name .selfRef} {#name-privacy-considerations}

PSK privacy properties are orthogonal to security properties described
in [Section 4](#sec-properties){.xref}. TLS does little to keep PSK
identity information private. For example, an adversary learns
information about the external PSK or its identifier by virtue of the
identifier appearing in cleartext in a ClientHello. As a result, a
passive adversary can link two or more connections together that use the
same external PSK on the wire. Depending on the PSK identity, a passive
attacker may also be able to identify the device, person, or enterprise
running the TLS client or TLS server. An active attacker can also use
the PSK identity to suppress handshakes or application data from a
specific device by blocking, delaying, or rate-limiting traffic.
Techniques for mitigating these risks require further analysis and are
out of scope for this document.[¶](#section-7-1){.pilcrow}

In addition to linkability in the network, external PSKs are
intrinsically linkable by PSK receivers. Specifically, servers can link
successive connections that use the same external PSK together.
Preventing this type of linkability is out of
scope.[¶](#section-7-2){.pilcrow}
:::
:::

::: {#security-con}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

Security considerations are provided throughout this document. It bears
repeating that there are concerns related to the use of external PSKs
regarding proper identification of TLS 1.3 endpoints and additional
risks when external PSKs are known to a
group.[¶](#section-8-1){.pilcrow}

It is [NOT RECOMMENDED]{.bcp14} to share the same PSK between more than
one client and server. However, as discussed in [Section
5.1](#use-cases){.xref}, there are application scenarios that may rely
on sharing the same PSK among multiple nodes.
\[[RFC9258](#RFC9258){.xref}\] helps in mitigating rerouting and
Selfie-style reflection attacks when the PSK is shared among multiple
nodes. This is achieved by correctly using the node identifiers in the
ImportedIdentity.context construct specified in
\[[RFC9258](#RFC9258){.xref}\]. One solution would be for each endpoint
to select one globally unique identifier to use in all PSK handshakes.
The unique identifier can, for example, be one of its Media Access
Control (MAC) addresses, a 32-byte random number, or its Universally
Unique IDentifier (UUID) \[[RFC4122](#RFC4122){.xref}\]. Note that such
persistent, global identifiers have privacy implications; see [Section
7](#endpoint-privacy){.xref}.[¶](#section-8-2){.pilcrow}

Each endpoint [SHOULD]{.bcp14} know the identifier of the other endpoint
with which it wants to connect and [SHOULD]{.bcp14} compare it with the
other endpoint\'s identifier used in ImportedIdentity.context. However,
it is important to remember that endpoints sharing the same group PSK
can always impersonate each other.[¶](#section-8-3){.pilcrow}

Considerations for external PSK usage extend beyond proper
identification. When early data is used with an external PSK, the random
value in the ClientHello is the only source of entropy that contributes
to key diversity between sessions. As a result, when an external PSK is
used more than one time, the random number source on the client has a
significant role in the protection of the early
data.[¶](#section-8-4){.pilcrow}
:::
:::

::: {#IANA}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-9-1){.pilcrow}
:::
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8446\]
:   [Rescorla, E.]{.refAuthor}, [\"The Transport Layer Security (TLS)
    Protocol Version 1.3\"]{.refTitle}, [RFC 8446]{.seriesInfo}, [DOI
    10.17487/RFC8446]{.seriesInfo}, August 2018,
    \<<https://www.rfc-editor.org/info/rfc8446>\>.
:   

\[RFC9258\]
:   [Benjamin, D.]{.refAuthor} and [C. A. Wood]{.refAuthor},
    [\"Importing External Pre-Shared Keys (PSKs) for TLS
    1.3\"]{.refTitle}, [RFC 9258]{.seriesInfo}, [DOI
    10.17487/RFC9258]{.seriesInfo}, July 2022,
    \<<https://www.rfc-editor.org/info/rfc9258>\>.
:   
:::

::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[AASS19\]
:   [Akhmetzyanova, L.]{.refAuthor}, [Alekseev, E.]{.refAuthor},
    [Smyshlyaeva, E.]{.refAuthor}, and [A. Sokolov]{.refAuthor},
    [\"Continuing to reflect on TLS 1.3 with external PSK\"]{.refTitle},
    April 2019, \<<https://eprint.iacr.org/2019/421.pdf>\>.
:   

\[CPACE\]
:   [Abdalla, M.]{.refAuthor}, [Haase, B.]{.refAuthor}, and [J.
    Hesse]{.refAuthor}, [\"CPace, a balanced composable
    PAKE\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-irtf-cfrg-cpace-06]{.seriesInfo}, 24 July
    2022,
    \<<https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-cpace-06>\>.
:   

\[CTLS\]
:   [Rescorla, E.]{.refAuthor}, [Barnes, R.]{.refAuthor},
    [Tschofenig, H.]{.refAuthor}, and [B. M. Schwartz]{.refAuthor},
    [\"Compact TLS 1.3\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-ietf-tls-ctls-06]{.seriesInfo}, 9 July 2022,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-tls-ctls-06>\>.
:   

\[EAP-TLS-PSK\]
:   [Mattsson, J. P.]{.refAuthor}, [Sethi, M.]{.refAuthor},
    [Aura, T.]{.refAuthor}, and [O. Friel]{.refAuthor}, [\"EAP-TLS with
    PSK Authentication (EAP-TLS-PSK)\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-mattsson-emu-eap-tls-psk-00]{.seriesInfo}, 9 March 2020,
    \<<https://datatracker.ietf.org/doc/html/draft-mattsson-emu-eap-tls-psk-00>\>.
:   

\[GAA\]
:   [ETSI]{.refAuthor}, [\"Digital cellular telecommunications system
    (Phase 2+); Universal Mobile Telecommunications System (UMTS); LTE;
    3G Security; Generic Authentication Architecture (GAA); System
    description\"]{.refTitle}, [version 12.0.0]{.refContent}, [ETSI TR
    133 919]{.seriesInfo}, October 2014,
    \<<https://www.etsi.org/deliver/etsi_tr/133900_133999/133919/12.00.00_60/tr_133919v120000p.pdf>\>.
:   

\[Krawczyk\]
:   [Krawczyk, H.]{.refAuthor}, [\"SIGMA: The \'SIGn-and-MAc\' Approach
    to Authenticated Diffie-Hellman and Its Use in the IKE
    Protocols\"]{.refTitle}, [DOI
    10.1007/978-3-540-45146-4_24]{.seriesInfo}, 2003,
    \<<https://link.springer.com/content/pdf/10.1007/978-3-540-45146-4_24.pdf>\>.
:   

\[LwM2M\]
:   [Open Mobile Alliance]{.refAuthor}, [\"Lightweight Machine to
    Machine Technical Specification\"]{.refTitle}, [version
    1.0]{.refContent}, February 2017,
    \<<http://www.openmobilealliance.org/release/LightweightM2M/V1_0-20170208-A/OMA-TS-LightweightM2M-V1_0-20170208-A.pdf>\>.
:   

\[OPAQUE\]
:   [Bourdrez, D.]{.refAuthor}, [Krawczyk, H.]{.refAuthor},
    [Lewi, K.]{.refAuthor}, and [C. A. Wood]{.refAuthor}, [\"The OPAQUE
    Asymmetric PAKE Protocol\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-irtf-cfrg-opaque-09]{.seriesInfo}, 6 July 2022,
    \<<https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-opaque-09>\>.
:   

\[RFC2865\]
:   [Rigney, C.]{.refAuthor}, [Willens, S.]{.refAuthor},
    [Rubens, A.]{.refAuthor}, and [W. Simpson]{.refAuthor}, [\"Remote
    Authentication Dial In User Service (RADIUS)\"]{.refTitle}, [RFC
    2865]{.seriesInfo}, [DOI 10.17487/RFC2865]{.seriesInfo}, June 2000,
    \<<https://www.rfc-editor.org/info/rfc2865>\>.
:   

\[RFC3748\]
:   [Aboba, B.]{.refAuthor}, [Blunk, L.]{.refAuthor},
    [Vollbrecht, J.]{.refAuthor}, [Carlson, J.]{.refAuthor}, and [H.
    Levkowetz, Ed.]{.refAuthor}, [\"Extensible Authentication Protocol
    (EAP)\"]{.refTitle}, [RFC 3748]{.seriesInfo}, [DOI
    10.17487/RFC3748]{.seriesInfo}, June 2004,
    \<<https://www.rfc-editor.org/info/rfc3748>\>.
:   

\[RFC4122\]
:   [Leach, P.]{.refAuthor}, [Mealling, M.]{.refAuthor}, and [R.
    Salz]{.refAuthor}, [\"A Universally Unique IDentifier (UUID) URN
    Namespace\"]{.refTitle}, [RFC 4122]{.seriesInfo}, [DOI
    10.17487/RFC4122]{.seriesInfo}, July 2005,
    \<<https://www.rfc-editor.org/info/rfc4122>\>.
:   

\[RFC4279\]
:   [Eronen, P., Ed.]{.refAuthor} and [H. Tschofenig, Ed.]{.refAuthor},
    [\"Pre-Shared Key Ciphersuites for Transport Layer Security
    (TLS)\"]{.refTitle}, [RFC 4279]{.seriesInfo}, [DOI
    10.17487/RFC4279]{.seriesInfo}, December 2005,
    \<<https://www.rfc-editor.org/info/rfc4279>\>.
:   

\[RFC6066\]
:   [Eastlake 3rd, D.]{.refAuthor}, [\"Transport Layer Security (TLS)
    Extensions: Extension Definitions\"]{.refTitle}, [RFC
    6066]{.seriesInfo}, [DOI 10.17487/RFC6066]{.seriesInfo}, January
    2011, \<<https://www.rfc-editor.org/info/rfc6066>\>.
:   

\[RFC6614\]
:   [Winter, S.]{.refAuthor}, [McCauley, M.]{.refAuthor},
    [Venaas, S.]{.refAuthor}, and [K. Wierenga]{.refAuthor},
    [\"Transport Layer Security (TLS) Encryption for
    RADIUS\"]{.refTitle}, [RFC 6614]{.seriesInfo}, [DOI
    10.17487/RFC6614]{.seriesInfo}, May 2012,
    \<<https://www.rfc-editor.org/info/rfc6614>\>.
:   

\[RFC7925\]
:   [Tschofenig, H., Ed.]{.refAuthor} and [T. Fossati]{.refAuthor},
    [\"Transport Layer Security (TLS) / Datagram Transport Layer
    Security (DTLS) Profiles for the Internet of Things\"]{.refTitle},
    [RFC 7925]{.seriesInfo}, [DOI 10.17487/RFC7925]{.seriesInfo}, July
    2016, \<<https://www.rfc-editor.org/info/rfc7925>\>.
:   

\[RFC8773\]
:   [Housley, R.]{.refAuthor}, [\"TLS 1.3 Extension for
    Certificate-Based Authentication with an External Pre-Shared
    Key\"]{.refTitle}, [RFC 8773]{.seriesInfo}, [DOI
    10.17487/RFC8773]{.seriesInfo}, March 2020,
    \<<https://www.rfc-editor.org/info/rfc8773>\>.
:   

\[RFC9147\]
:   [Rescorla, E.]{.refAuthor}, [Tschofenig, H.]{.refAuthor}, and [N.
    Modadugu]{.refAuthor}, [\"The Datagram Transport Layer Security
    (DTLS) Protocol Version 1.3\"]{.refTitle}, [RFC 9147]{.seriesInfo},
    [DOI 10.17487/RFC9147]{.seriesInfo}, April 2022,
    \<<https://www.rfc-editor.org/info/rfc9147>\>.
:   

\[Selfie\]
:   [Drucker, N.]{.refAuthor} and [S. Gueron]{.refAuthor}, [\"Selfie:
    reflections on TLS 1.3 with PSK\"]{.refTitle}, [DOI
    10.1007/s00145-021-09387-y]{.seriesInfo}, May 2021,
    \<<https://eprint.iacr.org/2019/347.pdf>\>.
:   

\[Sethi\]
:   [Sethi, M.]{.refAuthor}, [Peltonen, A.]{.refAuthor}, and [T.
    Aura]{.refAuthor}, [\"Misbinding Attacks on Secure Device Pairing
    and Bootstrapping\"]{.refTitle}, [DOI
    10.1145/3321705.3329813]{.seriesInfo}, May 2019,
    \<<https://arxiv.org/pdf/1902.07550>\>.
:   

\[SmartCard\]
:   [Bundesamt für Sicherheit in der Informationstechnik]{.refAuthor},
    [\"Technical Guideline TR-03112-7 eCard-API-Framework -
    Protocols\"]{.refTitle}, [version 1.1.5]{.refContent}, April 2015,
    \<<https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/Publikationen/TechnischeRichtlinien/TR03112/TR-03112-api_teil7.pdf?__blob=publicationFile&v=1>\>.
:   
:::
:::

::: {#acknowledgements}
::: {#appendix-A .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

This document is the output of the TLS External PSK Design Team,
comprised of the following members: Benjamin Beurdouche, [Björn
Haase]{.contact-name}, [Christopher Wood]{.contact-name}, [Colm
MacCarthaigh]{.contact-name}, [Eric Rescorla]{.contact-name}, [Jonathan
Hoyland]{.contact-name}, [Martin Thomson]{.contact-name}, [Mohamad
Badra]{.contact-name}, [Mohit Sethi]{.contact-name}, [Oleg
Pekar]{.contact-name}, [Owen Friel]{.contact-name}, and [Russ
Housley]{.contact-name}.[¶](#appendix-A-1){.pilcrow}

This document was improved by high-quality reviews by [Ben
Kaduk]{.contact-name} and [John Preuß
Mattsson]{.contact-name}.[¶](#appendix-A-2){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#appendix-B .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Russ Housley]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Vigil Security, LLC]{.org}
:::

::: email
Email: <housley@vigilsec.com>
:::

::: {.left dir="auto"}
[Jonathan Hoyland]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cloudflare Ltd.]{.org}
:::

::: email
Email: <jonathan.hoyland@gmail.com>
:::

::: {.left dir="auto"}
[Mohit Sethi]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Aalto University]{.org}
:::

::: email
Email: <mohit@iki.fi>
:::

::: {.left dir="auto"}
[Christopher A. Wood]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cloudflare]{.org}
:::

::: email
Email: <caw@heapingbits.net>
:::
:::
:::
