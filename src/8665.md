  RFC 8665         OSPF Extensions for Segment Routing   December 2019
  ---------------- ------------------------------------- ---------------
  Psenak, et al.   Standards Track                       \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8665](https://www.rfc-editor.org/rfc/rfc8665){.eref}

Category:
:   Standards Track

Published:
:   December 2019

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    P. Psenak, [Ed.]{.editor}
    :::

    ::: org
    Cisco Systems, Inc.
    :::
    :::

    ::: author
    ::: author-name
    S. Previdi, [Ed.]{.editor}
    :::

    ::: org
    Cisco Systems, Inc.
    :::
    :::

    ::: author
    ::: author-name
    C. Filsfils
    :::

    ::: org
    Cisco Systems, Inc.
    :::
    :::

    ::: author
    ::: author-name
    H. Gredler
    :::

    ::: org
    RtBrick Inc.
    :::
    :::

    ::: author
    ::: author-name
    R. Shakir
    :::

    ::: org
    Google, Inc.
    :::
    :::

    ::: author
    ::: author-name
    W. Henderickx
    :::

    ::: org
    Nokia
    :::
    :::

    ::: author
    ::: author-name
    J. Tantsura
    :::

    ::: org
    Apstra, Inc.
    :::
    :::
:::

# RFC 8665 {#rfcnum}

# OSPF Extensions for Segment Routing {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

Segment Routing (SR) allows a flexible definition of end-to-end paths
within IGP topologies by encoding paths as sequences of topological
subpaths called \"segments\". These segments are advertised by the
link-state routing protocols (IS-IS and
OSPF).[¶](#section-abstract-1){.pilcrow}

This document describes the OSPFv2 extensions required for Segment
Routing.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8665>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2019 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Requirements
        Language](#name-requirements-language){.xref}[¶](#section-toc.1-1.1.2.1.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Segment Routing
    Identifiers](#name-segment-routing-identifiers){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}

    -   ::: {#section-toc.1-1.2.2.1}
        [2.1](#section-2.1){.xref}.  [SID/Label
        Sub-TLV](#name-sid-label-sub-tlv){.xref}[¶](#section-toc.1-1.2.2.1.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Segment Routing
    Capabilities](#name-segment-routing-capabilitie){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}

    -   ::: {#section-toc.1-1.3.2.1}
        [3.1](#section-3.1){.xref}.  [SR-Algorithm
        TLV](#name-sr-algorithm-tlv){.xref}[¶](#section-toc.1-1.3.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.2}
        [3.2](#section-3.2){.xref}.  [SID/Label Range
        TLV](#name-sid-label-range-tlv){.xref}[¶](#section-toc.1-1.3.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.3}
        [3.3](#section-3.3){.xref}.  [SR Local Block
        TLV](#name-sr-local-block-tlv){.xref}[¶](#section-toc.1-1.3.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.4}
        [3.4](#section-3.4){.xref}.  [SRMS Preference
        TLV](#name-srms-preference-tlv){.xref}[¶](#section-toc.1-1.3.2.4.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [OSPF Extended Prefix Range
    TLV](#name-ospf-extended-prefix-range-){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Prefix-SID
    Sub-TLV](#name-prefix-sid-sub-tlv){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Adjacency Segment Identifier
    (Adj-SID)](#name-adjacency-segment-identifie){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.xref}.  [Adj-SID
        Sub-TLV](#name-adj-sid-sub-tlv){.xref}[¶](#section-toc.1-1.6.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.6.2.2}
        [6.2](#section-6.2){.xref}.  [LAN Adj-SID
        Sub-TLV](#name-lan-adj-sid-sub-tlv){.xref}[¶](#section-toc.1-1.6.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Elements of
    Procedure](#name-elements-of-procedure){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Intra-area Segment Routing in
        OSPFv2](#name-intra-area-segment-routing-){.xref}[¶](#section-toc.1-1.7.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [Inter-area Segment Routing in
        OSPFv2](#name-inter-area-segment-routing-){.xref}[¶](#section-toc.1-1.7.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.3}
        [7.3](#section-7.3){.xref}.  [Segment Routing for External
        Prefixes](#name-segment-routing-for-externa){.xref}[¶](#section-toc.1-1.7.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.4}
        [7.4](#section-7.4){.xref}.  [Advertisement of
        Adj-SID](#name-advertisement-of-adj-sid){.xref}[¶](#section-toc.1-1.7.2.4.1){.pilcrow}

        -   ::: {#section-toc.1-1.7.2.4.2.1}
            [7.4.1](#section-7.4.1){.xref}.  [Advertisement of Adj-SID
            on Point-to-Point
            Links](#name-advertisement-of-adj-sid-on){.xref}[¶](#section-toc.1-1.7.2.4.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.4.2.2}
            [7.4.2](#section-7.4.2){.xref}.  [Adjacency SID on Broadcast
            or NBMA
            Interfaces](#name-adjacency-sid-on-broadcast-){.xref}[¶](#section-toc.1-1.7.2.4.2.2.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [OSPF Router Information (RI) TLVs
        Registry](#name-ospf-router-information-ri-){.xref}[¶](#section-toc.1-1.8.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [OSPFv2 Extended Prefix Opaque LSA
        TLVs
        Registry](#name-ospfv2-extended-prefix-opaq){.xref}[¶](#section-toc.1-1.8.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.3}
        [8.3](#section-8.3){.xref}.  [OSPFv2 Extended Prefix TLV
        Sub-TLVs
        Registry](#name-ospfv2-extended-prefix-tlv-){.xref}[¶](#section-toc.1-1.8.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.4}
        [8.4](#section-8.4){.xref}.  [OSPFv2 Extended Link TLV Sub-TLVs
        Registry](#name-ospfv2-extended-link-tlv-su){.xref}[¶](#section-toc.1-1.8.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.5}
        [8.5](#section-8.5){.xref}.  [IGP Algorithm Types
        Registry](#name-igp-algorithm-types-registr){.xref}[¶](#section-toc.1-1.8.2.5.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [TLV/Sub-TLV Error
    Handling](#name-tlv-sub-tlv-error-handling){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}

    -   ::: {#section-toc.1-1.11.2.1}
        [11.1](#section-11.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.11.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.11.2.2}
        [11.2](#section-11.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.11.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.12}
    [](#section-appendix.a){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.13}
    [](#section-appendix.b){.xref}[Contributors](#name-contributors){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.14}
    [](#section-appendix.c){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.14.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

Segment Routing (SR) allows a flexible definition of end-to-end paths
within IGP topologies by encoding paths as sequences of topological
subpaths called \"segments\". These segments are advertised by the
link-state routing protocols (IS-IS and OSPF). Prefix segments represent
an ECMP-aware shortest path to a prefix (or a node), as per the state of
the IGP topology. Adjacency segments represent a hop over a specific
adjacency between two nodes in the IGP. A prefix segment is typically a
multi-hop path while an adjacency segment, in most cases, is a one-hop
path. SR\'s control plane can be applied to both IPv6 and MPLS data
planes, and it does not require any additional signaling (other than IGP
extensions). The IPv6 data plane is out of the scope of this
specification; it is not applicable to OSPFv2, which only supports the
IPv4 address family. When used in MPLS networks, SR paths do not require
any LDP or RSVP-TE signaling. However, SR can interoperate in the
presence of LSPs established with RSVP or
LDP.[¶](#section-1-1){.pilcrow}

There are additional segment types, e.g., Binding Segment Identifier
(SID) defined in
\[[RFC8402](#RFC8402){.xref}\].[¶](#section-1-2){.pilcrow}

This document describes the OSPF extensions required for Segment
Routing.[¶](#section-1-3){.pilcrow}

Segment Routing architecture is described in
\[[RFC8402](#RFC8402){.xref}\].[¶](#section-1-4){.pilcrow}

Segment Routing use cases are described in
\[[RFC7855](#RFC7855){.xref}\].[¶](#section-1-5){.pilcrow}

::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-1.1-1){.pilcrow}
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Segment Routing Identifiers](#name-segment-routing-identifiers){.section-name .selfRef} {#name-segment-routing-identifiers}

Segment Routing defines various types of Segment Identifiers (SIDs):
Prefix-SID, Adjacency SID, LAN Adjacency SID, and Binding
SID.[¶](#section-2-1){.pilcrow}

Extended Prefix/Link Opaque Link State Advertisements (LSAs) defined in
\[[RFC7684](#RFC7684){.xref}\] are used for advertisements of the
various SID types.[¶](#section-2-2){.pilcrow}

::: {#SIDLABEL}
::: {#section-2.1 .section}
### [2.1.](#section-2.1){.section-number .selfRef} [SID/Label Sub-TLV](#name-sid-label-sub-tlv){.section-name .selfRef} {#name-sid-label-sub-tlv}

The SID/Label Sub-TLV appears in multiple TLVs or sub-TLVs defined later
in this document. It is used to advertise the SID or label associated
with a prefix or adjacency. The SID/Label Sub-TLV has the following
format:[¶](#section-2.1-1){.pilcrow}

::: {#section-2.1-2 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         SID/Label (variable)                  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-2.1-2){.pilcrow}
:::

where:[¶](#section-2.1-3){.pilcrow}

-   ::: {#section-2.1-4.1}

    Type:
    :   1[¶](#section-2.1-4.1.1.2){.pilcrow}

    Length:
    :   3 or 4 octets[¶](#section-2.1-4.1.1.4){.pilcrow}

    SID/Label:

    :   If the length is set to 3, then the 20 rightmost bits represent
        a label. If the length is set to 4, then the value represents a
        32-bit SID.[¶](#section-2.1-4.1.1.6.1){.pilcrow}
    :::
:::
:::
:::

::: {#SRCAP}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Segment Routing Capabilities](#name-segment-routing-capabilitie){.section-name .selfRef} {#name-segment-routing-capabilitie}

Segment Routing requires some additional router capabilities to be
advertised to other routers in the area.[¶](#section-3-1){.pilcrow}

These SR capabilities are advertised in the Router Information Opaque
LSA (defined in \[[RFC7770](#RFC7770){.xref}\]). The TLVs defined below
are applicable to both OSPFv2 and OSPFv3; see also
\[[RFC8666](#RFC8666){.xref}\].[¶](#section-3-2){.pilcrow}

::: {#SRALGO}
::: {#section-3.1 .section}
### [3.1.](#section-3.1){.section-number .selfRef} [SR-Algorithm TLV](#name-sr-algorithm-tlv){.section-name .selfRef} {#name-sr-algorithm-tlv}

The SR-Algorithm TLV is a top-level TLV of the Router Information Opaque
LSA (defined in
\[[RFC7770](#RFC7770){.xref}\]).[¶](#section-3.1-1){.pilcrow}

The SR-Algorithm TLV is optional. It [SHOULD]{.bcp14} only be advertised
once in the Router Information Opaque LSA. If the SR-Algorithm TLV is
not advertised by the node, such a node is considered as not being
Segment Routing capable.[¶](#section-3.1-2){.pilcrow}

An SR Router can use various algorithms when calculating reachability to
OSPF routers or prefixes in an OSPF area. Examples of these algorithms
are metric-based Shortest Path First (SPF), various flavors of
Constrained SPF, etc. The SR-Algorithm TLV allows a router to advertise
the algorithms currently used by the router to other routers in an OSPF
area. The SR-Algorithm TLV has the following
format:[¶](#section-3.1-3){.pilcrow}

::: {#section-3.1-4 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Algorithm 1 | Algorithm...  |   Algorithm n |               |
    +-                                                             -+
    |                                                               |
    +                                                               +

[¶](#section-3.1-4){.pilcrow}
:::

where:[¶](#section-3.1-5){.pilcrow}

-   ::: {#section-3.1-6.1}

    Type:
    :   8[¶](#section-3.1-6.1.1.2){.pilcrow}

    Length:
    :   Variable, in octets, depending on the number of algorithms
        advertised[¶](#section-3.1-6.1.1.4){.pilcrow}

    Algorithm:

    :   Single octet identifying the algorithm. The following values are
        defined by this document:[¶](#section-3.1-6.1.1.6.1){.pilcrow}

        0:
        :   Shortest Path First (SPF) algorithm based on link metric.
            This is the standard shortest path algorithm as computed by
            the OSPF protocol. Consistent with the deployed practice for
            link-state protocols, Algorithm 0 permits any node to
            overwrite the SPF path with a different path based on its
            local policy. If the SR-Algorithm TLV is advertised,
            Algorithm 0 [MUST]{.bcp14} be
            included.[¶](#section-3.1-6.1.1.6.2.2){.pilcrow}

        1:
        :   Strict Shortest Path First (SPF) algorithm based on link
            metric. The algorithm is identical to Algorithm 0, but
            Algorithm 1 requires that all nodes along the path will
            honor the SPF routing decision. Local policy at the node
            claiming support for Algorithm 1 [MUST NOT]{.bcp14} alter
            the SPF paths computed by Algorithm
            1.[¶](#section-3.1-6.1.1.6.2.4){.pilcrow}
    :::

When multiple SR-Algorithm TLVs are received from a given router, the
receiver [MUST]{.bcp14} use the first occurrence of the TLV in the
Router Information Opaque LSA. If the SR-Algorithm TLV appears in
multiple Router Information Opaque LSAs that have different flooding
scopes, the SR-Algorithm TLV in the Router Information Opaque LSA with
the area-scoped flooding scope [MUST]{.bcp14} be used. If the
SR-Algorithm TLV appears in multiple Router Information Opaque LSAs that
have the same flooding scope, the SR-Algorithm TLV in the Router
Information (RI) Opaque LSA with the numerically smallest Instance ID
[MUST]{.bcp14} be used and subsequent instances of the SR-Algorithm TLV
[MUST]{.bcp14} be ignored.[¶](#section-3.1-7){.pilcrow}

The RI LSA can be advertised at any of the defined opaque flooding
scopes (link, area, or Autonomous System (AS)). For the purpose of
SR-Algorithm TLV advertisement, area-scoped flooding is
[REQUIRED]{.bcp14}.[¶](#section-3.1-8){.pilcrow}
:::
:::

::: {#SIDRANGE}
::: {#section-3.2 .section}
### [3.2.](#section-3.2){.section-number .selfRef} [SID/Label Range TLV](#name-sid-label-range-tlv){.section-name .selfRef} {#name-sid-label-range-tlv}

Prefix-SIDs [MAY]{.bcp14} be advertised in the form of an index as
described in [Section 5](#PREFIXSID){.xref}. Such an index defines the
offset in the SID/Label space advertised by the router. The SID/Label
Range TLV is used to advertise such SID/Label
space.[¶](#section-3.2-1){.pilcrow}

The SID/Label Range TLV is a top-level TLV of the Router Information
Opaque LSA (defined in
\[[RFC7770](#RFC7770){.xref}\]).[¶](#section-3.2-2){.pilcrow}

The SID/Label Range TLV [MAY]{.bcp14} appear multiple times and has the
following format:[¶](#section-3.2-3){.pilcrow}

::: {#section-3.2-4 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Range Size                 |   Reserved    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sub-TLVs (variable)                    |
    +-                                                             -+
    |                                                               |
    +                                                               +

[¶](#section-3.2-4){.pilcrow}
:::

where:[¶](#section-3.2-5){.pilcrow}

-   ::: {#section-3.2-6.1}

    Type:
    :   9[¶](#section-3.2-6.1.1.2){.pilcrow}

    Length:
    :   Variable, in octets, depending on the
        sub-TLVs[¶](#section-3.2-6.1.1.4){.pilcrow}

    Range Size:
    :   3-octet SID/label range size (i.e., the number of SIDs or labels
        in the range including the first SID/label). It [MUST]{.bcp14}
        be greater than 0.[¶](#section-3.2-6.1.1.6){.pilcrow}

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception[¶](#section-3.2-6.1.1.8){.pilcrow}
    :::

Initially, the only supported sub-TLV is the SID/Label Sub-TLV as
defined in [Section 2.1](#SIDLABEL){.xref}. The SID/Label Sub-TLV
[MUST]{.bcp14} be included in the SID/Label Range TLV. The SID/Label
advertised in the SID/Label Sub-TLV represents the first SID/Label in
the advertised range.[¶](#section-3.2-7){.pilcrow}

Only a single SID/Label Sub-TLV [MAY]{.bcp14} be advertised in the
SID/Label Range TLV. If more than one SID/Label Sub-TLV is present, the
SID/Label Range TLV [MUST]{.bcp14} be
ignored.[¶](#section-3.2-8){.pilcrow}

Multiple occurrences of the SID/Label Range TLV [MAY]{.bcp14} be
advertised in order to advertise multiple ranges. In such a
case:[¶](#section-3.2-9){.pilcrow}

-   [The originating router [MUST]{.bcp14} encode each range into a
    different SID/Label Range
    TLV.[¶](#section-3.2-10.1){.pilcrow}]{#section-3.2-10.1}
-   [The originating router decides the order in which the set of
    SID/Label Range TLVs are advertised inside the Router Information
    Opaque LSA. The originating router [MUST]{.bcp14} ensure the order
    is the same after a graceful restart (using checkpointing,
    nonvolatile storage, or any other mechanism) in order to ensure the
    SID/Label range and SID index correspondence is preserved across
    graceful
    restarts.[¶](#section-3.2-10.2){.pilcrow}]{#section-3.2-10.2}
-   [The receiving router [MUST]{.bcp14} adhere to the order in which
    the ranges are advertised when calculating a SID/Label from a SID
    index.[¶](#section-3.2-10.3){.pilcrow}]{#section-3.2-10.3}
-   [The originating router [MUST NOT]{.bcp14} advertise overlapping
    ranges.[¶](#section-3.2-10.4){.pilcrow}]{#section-3.2-10.4}
-   [When a router receives multiple overlapping ranges, it
    [MUST]{.bcp14} conform to the procedures defined in
    \[[RFC8660](#RFC8660){.xref}\].[¶](#section-3.2-10.5){.pilcrow}]{#section-3.2-10.5}

The following example illustrates the advertisement of multiple
ranges.[¶](#section-3.2-11){.pilcrow}

The originating router advertises the following
ranges:[¶](#section-3.2-12){.pilcrow}

::: {#section-3.2-13 .artwork .art-text .alignLeft}
          Range 1: Range Size: 100   SID/Label Sub-TLV: 100
          Range 1: Range Size: 100   SID/Label Sub-TLV: 1000
          Range 1: Range Size: 100   SID/Label Sub-TLV: 500

[¶](#section-3.2-13){.pilcrow}
:::

The receiving routers concatenate the ranges and build the Segment
Routing Global Block (SRGB) as follows:[¶](#section-3.2-14){.pilcrow}

::: {#section-3.2-15 .artwork .art-text .alignLeft}
     
       SRGB = [100, 199]
              [1000, 1099]
              [500, 599]

[¶](#section-3.2-15){.pilcrow}
:::

The indexes span multiple ranges:[¶](#section-3.2-16){.pilcrow}

::: {#section-3.2-17 .artwork .art-text .alignLeft}
     
          index 0 means label 100
          ...
          index 99 means label 199
          index 100 means label 1000
          index 199 means label 1099
          ...
          index 200 means label 500
          ...

[¶](#section-3.2-17){.pilcrow}
:::

The RI LSA can be advertised at any of the defined flooding scopes
(link, area, or autonomous system (AS)). For the purpose of SID/Label
Range TLV advertisement, area-scoped flooding is
[REQUIRED]{.bcp14}.[¶](#section-3.2-18){.pilcrow}
:::
:::

::: {#SRLB}
::: {#section-3.3 .section}
### [3.3.](#section-3.3){.section-number .selfRef} [SR Local Block TLV](#name-sr-local-block-tlv){.section-name .selfRef} {#name-sr-local-block-tlv}

The SR Local Block TLV (SRLB TLV) contains the range of labels the node
has reserved for Local SIDs. SIDs from the SRLB [MAY]{.bcp14} be used
for Adjacency SIDs but also by components other than the OSPF protocol.
As an example, an application or a controller can instruct the router to
allocate a specific Local SID. Some controllers or applications can use
the control plane to discover the available set of Local SIDs on a
particular router. In such cases, the SRLB is advertised in the control
plane. The requirement to advertise the SRLB is further described in
\[[RFC8660](#RFC8660){.xref}\]. The SRLB TLV is used to advertise the
SRLB.[¶](#section-3.3-1){.pilcrow}

The SRLB TLV is a top-level TLV of the Router Information Opaque LSA
(defined in
\[[RFC7770](#RFC7770){.xref}\]).[¶](#section-3.3-2){.pilcrow}

The SRLB TLV [MAY]{.bcp14} appear multiple times in the Router
Information Opaque LSA and has the following
format:[¶](#section-3.3-3){.pilcrow}

::: {#section-3.3-4 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    Range Size                 |   Reserved    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sub-TLVs (variable)                    |
    +-                                                             -+
    |                                                               |
    +                                                               +

[¶](#section-3.3-4){.pilcrow}
:::

where:[¶](#section-3.3-5){.pilcrow}

-   ::: {#section-3.3-6.1}

    Type:
    :   14[¶](#section-3.3-6.1.1.2){.pilcrow}

    Length:
    :   Variable, in octets, depending on the
        sub-TLVs[¶](#section-3.3-6.1.1.4){.pilcrow}

    Range Size:
    :   3-octet SID/Label range size (i.e., the number of SIDs or labels
        in the range including the first SID/Label). It [MUST]{.bcp14}
        be greater than 0.[¶](#section-3.3-6.1.1.6){.pilcrow}

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception[¶](#section-3.3-6.1.1.8){.pilcrow}
    :::

Initially, the only supported sub-TLV is the SID/Label Sub-TLV as
defined in [Section 2.1](#SIDLABEL){.xref}. The SID/Label Sub-TLV
[MUST]{.bcp14} be included in the SRLB TLV. The SID/Label advertised in
the SID/Label Sub-TLV represents the first SID/Label in the advertised
range.[¶](#section-3.3-7){.pilcrow}

Only a single SID/Label Sub-TLV [MAY]{.bcp14} be advertised in the SRLB
TLV. If more than one SID/Label Sub-TLV is present, the SRLB TLV
[MUST]{.bcp14} be ignored.[¶](#section-3.3-8){.pilcrow}

The originating router [MUST NOT]{.bcp14} advertise overlapping
ranges.[¶](#section-3.3-9){.pilcrow}

Each time a SID from the SRLB is allocated, it [SHOULD]{.bcp14} also be
reported to all components (e.g., controller or applications) in order
for these components to have an up-to-date view of the current SRLB
allocation. This is required to avoid collisions between allocation
instructions.[¶](#section-3.3-10){.pilcrow}

Within the context of OSPF, the reporting of Local SIDs is done through
OSPF sub-TLVs, such as the Adjacency SID ([Section 6](#ADJSID){.xref}).
However, the reporting of allocated Local SIDs can also be done through
other means and protocols, which are outside the scope of this
document.[¶](#section-3.3-11){.pilcrow}

A router advertising the SRLB TLV [MAY]{.bcp14} also have other label
ranges, outside of the SRLB, used for its local allocation purposes and
not advertised in the SRLB TLV. For example, it is possible that an
Adjacency SID is allocated using a local label that is not part of the
SRLB.[¶](#section-3.3-12){.pilcrow}

The RI LSA can be advertised at any of the defined flooding scopes
(link, area, or autonomous system (AS)). For the purpose of SRLB TLV
advertisement, area-scoped flooding is
[REQUIRED]{.bcp14}.[¶](#section-3.3-13){.pilcrow}
:::
:::

::: {#SRMS-Pref}
::: {#section-3.4 .section}
### [3.4.](#section-3.4){.section-number .selfRef} [SRMS Preference TLV](#name-srms-preference-tlv){.section-name .selfRef} {#name-srms-preference-tlv}

The Segment Routing Mapping Server Preference TLV (SRMS Preference TLV)
is used to advertise a preference associated with the node that acts as
an SR Mapping Server. The role of an SRMS is described in
\[[RFC8661](#RFC8661){.xref}\]. SRMS preference is defined in
\[[RFC8661](#RFC8661){.xref}\].[¶](#section-3.4-1){.pilcrow}

The SRMS Preference TLV is a top-level TLV of the Router Information
Opaque LSA (defined in
\[[RFC7770](#RFC7770){.xref}\]).[¶](#section-3.4-2){.pilcrow}

The SRMS Preference TLV [MAY]{.bcp14} only be advertised once in the
Router Information Opaque LSA and has the following
format:[¶](#section-3.4-3){.pilcrow}

::: {#section-3.4-4 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Preference    |                 Reserved                    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-3.4-4){.pilcrow}
:::

where:[¶](#section-3.4-5){.pilcrow}

-   ::: {#section-3.4-6.1}

    Type:
    :   15[¶](#section-3.4-6.1.1.2){.pilcrow}

    Length:
    :   4 octets[¶](#section-3.4-6.1.1.4){.pilcrow}

    Preference:
    :   1 octet, with an SRMS preference value from 0 to
        255[¶](#section-3.4-6.1.1.6){.pilcrow}

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception[¶](#section-3.4-6.1.1.8){.pilcrow}
    :::

When multiple SRMS Preference TLVs are received from a given router, the
receiver [MUST]{.bcp14} use the first occurrence of the TLV in the
Router Information Opaque LSA. If the SRMS Preference TLV appears in
multiple Router Information Opaque LSAs that have different flooding
scopes, the SRMS Preference TLV in the Router Information Opaque LSA
with the narrowest flooding scope [MUST]{.bcp14} be used. If the SRMS
Preference TLV appears in multiple Router Information Opaque LSAs that
have the same flooding scope, the SRMS Preference TLV in the Router
Information Opaque LSA with the numerically smallest Instance ID
[MUST]{.bcp14} be used and subsequent instances of the SRMS Preference
TLV [MUST]{.bcp14} be ignored.[¶](#section-3.4-7){.pilcrow}

The RI LSA can be advertised at any of the defined flooding scopes
(link, area, or autonomous system (AS)). For the purpose of the SRMS
Preference TLV advertisement, AS-scoped flooding [SHOULD]{.bcp14} be
used. This is because SRMS servers can be located in a different area
than consumers of the SRMS advertisements. If the SRMS advertisements
from the SRMS server are only used inside the SRMS server\'s area,
area-scoped flooding [MAY]{.bcp14} be used.[¶](#section-3.4-8){.pilcrow}
:::
:::
:::
:::

::: {#PFXRANGE}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [OSPF Extended Prefix Range TLV](#name-ospf-extended-prefix-range-){.section-name .selfRef} {#name-ospf-extended-prefix-range-}

In some cases, it is useful to advertise attributes for a range of
prefixes. The SR Mapping Server, which is described in
\[[RFC8661](#RFC8661){.xref}\], is an example where we need a single
advertisement to advertise SIDs for multiple prefixes from a contiguous
address range.[¶](#section-4-1){.pilcrow}

The OSPF Extended Prefix Range TLV, which is a top-level TLV of the
Extended Prefix LSA described in \[[RFC7684](#RFC7684){.xref}\] is
defined for this purpose.[¶](#section-4-2){.pilcrow}

Multiple OSPF Extended Prefix Range TLVs [MAY]{.bcp14} be advertised in
each OSPF Extended Prefix Opaque LSA, but all prefix ranges included in
a single OSPF Extended Prefix Opaque LSA [MUST]{.bcp14} have the same
flooding scope. The OSPF Extended Prefix Range TLV has the following
format:[¶](#section-4-3){.pilcrow}

::: {#section-4-4 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Prefix Length |     AF        |         Range Size            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Flags       |                Reserved                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                     Address Prefix (variable)                 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                      Sub-TLVs (variable)                      |
    +-                                                             -+
    |                                                               |

[¶](#section-4-4){.pilcrow}
:::

where:[¶](#section-4-5){.pilcrow}

-   ::: {#section-4-6.1}

    Type:
    :   2[¶](#section-4-6.1.1.2){.pilcrow}

    Length:
    :   Variable, in octets, depending on the
        sub-TLVs[¶](#section-4-6.1.1.4){.pilcrow}

    Prefix Length:
    :   Length of prefix in bits[¶](#section-4-6.1.1.6){.pilcrow}

    AF:
    :   Address family for the prefix. Currently, the only supported
        value is 0 for IPv4 unicast. The inclusion of address family in
        this TLV allows for future
        extension.[¶](#section-4-6.1.1.8){.pilcrow}

    Range Size:
    :   Represents the number of prefixes that are covered by the
        advertisement. The Range Size [MUST NOT]{.bcp14} exceed the
        number of prefixes that could be satisfied by the Prefix Length
        without including the IPv4 multicast address range
        (224.0.0.0/3).[¶](#section-4-6.1.1.10){.pilcrow}

    Flags:

    :   Single-octet field. The following flags are
        defined:[¶](#section-4-6.1.1.12.1){.pilcrow}

        ::: {#section-4-6.1.1.12.2 .artwork .art-text .alignLeft}
                 0  1  2  3  4  5  6  7 
               +--+--+--+--+--+--+--+--+
               |IA|  |  |  |  |  |  |  |
               +--+--+--+--+--+--+--+--+

        [¶](#section-4-6.1.1.12.2){.pilcrow}
        :::

        where:[¶](#section-4-6.1.1.12.3){.pilcrow}

        -   ::: {#section-4-6.1.1.12.4.1}

            IA-Flag:

            :   Inter-Area Flag. If set, advertisement is of inter-area
                type. An Area Border Router (ABR) that is advertising
                the OSPF Extended Prefix Range TLV between areas
                [MUST]{.bcp14} set this
                bit.[¶](#section-4-6.1.1.12.4.1.1.2.1){.pilcrow}

                This bit is used to prevent redundant flooding of Prefix
                Range TLVs between areas as
                follows:[¶](#section-4-6.1.1.12.4.1.1.2.2){.pilcrow}

                -   ::: {#section-4-6.1.1.12.4.1.1.2.3.1}
                    An ABR only propagates an inter-area Prefix Range
                    advertisement from the backbone area to connected
                    nonbackbone areas if the advertisement is considered
                    to be the best one. The following rules are used to
                    select the best range from the set of advertisements
                    for the same Prefix
                    Range:[¶](#section-4-6.1.1.12.4.1.1.2.3.1.1){.pilcrow}

                    -   [An ABR always prefers intra-area Prefix Range
                        advertisements over inter-area
                        advertisements.[¶](#section-4-6.1.1.12.4.1.1.2.3.1.2.1){.pilcrow}]{#section-4-6.1.1.12.4.1.1.2.3.1.2.1}
                    -   [An ABR does not consider inter-area Prefix
                        Range advertisements coming from nonbackbone
                        areas.[¶](#section-4-6.1.1.12.4.1.1.2.3.1.2.2){.pilcrow}]{#section-4-6.1.1.12.4.1.1.2.3.1.2.2}
                    :::
            :::

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception[¶](#section-4-6.1.1.14){.pilcrow}

    Address Prefix:
    :   For the address family IPv4 unicast, the prefix itself is
        encoded as a 32-bit value. The default route is represented by a
        prefix of length 0. Prefix encoding for other address families
        is beyond the scope of this
        specification.[¶](#section-4-6.1.1.16){.pilcrow}
    :::
:::
:::

::: {#PREFIXSID}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Prefix-SID Sub-TLV](#name-prefix-sid-sub-tlv){.section-name .selfRef} {#name-prefix-sid-sub-tlv}

The Prefix-SID Sub-TLV is a sub-TLV of the OSPF Extended Prefix TLV
described in \[[RFC7684](#RFC7684){.xref}\] and the OSPF Extended Prefix
Range TLV described in [Section 4](#PFXRANGE){.xref}. It [MAY]{.bcp14}
appear more than once in the parent TLV and has the following
format:[¶](#section-5-1){.pilcrow}

::: {#section-5-2 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |             Length            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |      Flags    |   Reserved    |      MT-ID    |    Algorithm  | 
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                     SID/Index/Label (variable)                |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

[¶](#section-5-2){.pilcrow}
:::

where:[¶](#section-5-3){.pilcrow}

-   ::: {#section-5-4.1}

    Type:
    :   2[¶](#section-5-4.1.1.2){.pilcrow}

    Length:
    :   7 or 8 octets, depending on the
        V-Flag[¶](#section-5-4.1.1.4){.pilcrow}

    Flags:

    :   Single-octet field. The following flags are
        defined:[¶](#section-5-4.1.1.6.1){.pilcrow}

        ::: {#section-5-4.1.1.6.2 .artwork .art-text .alignLeft}
                                  
                 0  1  2  3  4  5  6  7 
               +--+--+--+--+--+--+--+--+
               |  |NP|M |E |V |L |  |  |
               +--+--+--+--+--+--+--+--+

        [¶](#section-5-4.1.1.6.2){.pilcrow}
        :::

        where:[¶](#section-5-4.1.1.6.3){.pilcrow}

        -   ::: {#section-5-4.1.1.6.4.1}

            NP-Flag:
            :   No-PHP (Penultimate Hop Popping) Flag. If set, then the
                penultimate hop [MUST NOT]{.bcp14} pop the Prefix-SID
                before delivering packets to the node that advertised
                the Prefix-SID.[¶](#section-5-4.1.1.6.4.1.1.2){.pilcrow}

            M-Flag:
            :   Mapping Server Flag. If set, the SID was advertised by
                an SR Mapping Server as described in
                \[[RFC8661](#RFC8661){.xref}\].[¶](#section-5-4.1.1.6.4.1.1.4){.pilcrow}

            E-Flag:
            :   Explicit Null Flag. If set, any upstream neighbor of the
                Prefix-SID originator [MUST]{.bcp14} replace the
                Prefix-SID with the Explicit NULL label (0 for IPv4)
                before forwarding the
                packet.[¶](#section-5-4.1.1.6.4.1.1.6){.pilcrow}

            V-Flag:
            :   Value/Index Flag. If set, then the Prefix-SID carries an
                absolute value. If not set, then the Prefix-SID carries
                an index.[¶](#section-5-4.1.1.6.4.1.1.8){.pilcrow}

            L-Flag:
            :   Local/Global Flag. If set, then the value/index carried
                by the Prefix-SID has local significance. If not set,
                then the value/index carried by this sub-TLV has global
                significance.[¶](#section-5-4.1.1.6.4.1.1.10){.pilcrow}

            Other bits:
            :   Reserved. These [MUST]{.bcp14} be zero when sent and are
                ignored when
                received.[¶](#section-5-4.1.1.6.4.1.1.12){.pilcrow}
            :::

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception[¶](#section-5-4.1.1.8){.pilcrow}

    MT-ID:
    :   Multi-Topology ID (as defined in
        \[[RFC4915](#RFC4915){.xref}\])[¶](#section-5-4.1.1.10){.pilcrow}

    Algorithm:

    :   Single octet identifying the algorithm the Prefix-SID is
        associated with as defined in [Section
        3.1](#SRALGO){.xref}[¶](#section-5-4.1.1.12.1){.pilcrow}

        A router receiving a Prefix-SID from a remote node and with an
        algorithm value that the remote node has not advertised in the
        SR-Algorithm TLV ([Section 3.1](#SRALGO){.xref}) [MUST]{.bcp14}
        ignore the Prefix-SID
        Sub-TLV.[¶](#section-5-4.1.1.12.2){.pilcrow}

    SID/Index/Label:

    :   According to the V- and L-Flags, it
        contains:[¶](#section-5-4.1.1.14.1){.pilcrow}

        -   [V-Flag is set to 0 and L-Flag is set to 0: The
            SID/Index/Label field is a 4-octet index defining the offset
            in the SID/Label space advertised by this
            router.[¶](#section-5-4.1.1.14.2.1){.pilcrow}]{#section-5-4.1.1.14.2.1}
        -   [V-Flag is set to 1 and L-Flag is set to 1: The
            SID/Index/Label field is a 3-octet local label where the 20
            rightmost bits are used for encoding the label
            value.[¶](#section-5-4.1.1.14.2.2){.pilcrow}]{#section-5-4.1.1.14.2.2}
        -   [All other combinations of V-Flag and L-Flag are invalid and
            any SID Advertisement received with an invalid setting for
            V- and L-Flags [MUST]{.bcp14} be
            ignored.[¶](#section-5-4.1.1.14.2.3){.pilcrow}]{#section-5-4.1.1.14.2.3}
    :::

If an OSPF router advertises multiple Prefix-SIDs for the same prefix,
topology, and algorithm, all of them [MUST]{.bcp14} be
ignored.[¶](#section-5-5){.pilcrow}

When calculating the outgoing label for the prefix, the router
[MUST]{.bcp14} take into account, as described below, the E-, NP-, and
M-Flags advertised by the next-hop router if that router advertised the
SID for the prefix. This [MUST]{.bcp14} be done regardless of whether
the next-hop router contributes to the best path to the
prefix.[¶](#section-5-6){.pilcrow}

The NP-Flag (No-PHP) [MUST]{.bcp14} be set and the E-Flag [MUST]{.bcp14}
be clear for Prefix-SIDs allocated to inter-area prefixes that are
originated by the ABR based on intra-area or inter-area reachability
between areas unless the advertised prefix is directly attached to the
ABR.[¶](#section-5-7){.pilcrow}

The NP-Flag (No-PHP) [MUST]{.bcp14} be set and the E-Flag [MUST]{.bcp14}
be clear for Prefix-SIDs allocated to redistributed prefixes, unless the
redistributed prefix is directly attached to the Autonomous System
Boundary Router (ASBR).[¶](#section-5-8){.pilcrow}

If the NP-Flag is not set, then:[¶](#section-5-9){.pilcrow}

-   [Any upstream neighbor of the Prefix-SID originator [MUST]{.bcp14}
    pop the Prefix-SID. This is equivalent to the penultimate
    hop-popping mechanism used in the MPLS data
    plane.[¶](#section-5-10.1){.pilcrow}]{#section-5-10.1}
-   [The received E-Flag is
    ignored.[¶](#section-5-10.2){.pilcrow}]{#section-5-10.2}

If the NP-Flag is set and the E-Flag is not set,
then:[¶](#section-5-11){.pilcrow}

-   [Any upstream neighbor of the Prefix-SID originator [MUST]{.bcp14}
    keep the Prefix-SID on top of the stack. This is useful when the
    originator of the Prefix-SID needs to stitch the incoming packet
    into a continuing MPLS LSP to the final destination. This could
    occur at an ABR (prefix propagation from one area to another) or at
    an ASBR (prefix propagation from one domain to
    another).[¶](#section-5-12.1){.pilcrow}]{#section-5-12.1}

If both the NP-Flag and E-Flag are set,
then:[¶](#section-5-13){.pilcrow}

-   [Any upstream neighbor of the Prefix-SID originator [MUST]{.bcp14}
    replace the Prefix-SID with an Explicit NULL label. This is useful,
    e.g., when the originator of the Prefix-SID is the final destination
    for the related prefix and the originator wishes to receive the
    packet with the original EXP
    bits.[¶](#section-5-14.1){.pilcrow}]{#section-5-14.1}

When the M-Flag is set, the NP-Flag and the E-Flag [MUST]{.bcp14} be
ignored on reception.[¶](#section-5-15){.pilcrow}

As the Mapping Server does not specify the originator of a prefix
advertisement, it is not possible to determine PHP behavior solely based
on the Mapping Server Advertisement. However, PHP behavior
[SHOULD]{.bcp14} be done in the following
cases:[¶](#section-5-16){.pilcrow}

-   [The Prefix is intra-area type and the downstream neighbor is the
    originator of the
    prefix.[¶](#section-5-17.1){.pilcrow}]{#section-5-17.1}
-   [The Prefix is inter-area type and the downstream neighbor is an
    ABR, which is advertising prefix reachability and is also generating
    the Extended Prefix TLV with the A-Flag set for this prefix as
    described in [Section
    2.1](https://www.rfc-editor.org/rfc/rfc7684#section-2.1){.relref} of
    \[[RFC7684](#RFC7684){.xref}\].[¶](#section-5-17.2){.pilcrow}]{#section-5-17.2}
-   [The Prefix is external type and the downstream neighbor is an ASBR,
    which is advertising prefix reachability and is also generating the
    Extended Prefix TLV with the A-Flag set for this prefix as described
    in [Section
    2.1](https://www.rfc-editor.org/rfc/rfc7684#section-2.1){.relref} of
    \[[RFC7684](#RFC7684){.xref}\].[¶](#section-5-17.3){.pilcrow}]{#section-5-17.3}

When a Prefix-SID is advertised in an Extended Prefix Range TLV, then
the value advertised in the Prefix-SID Sub-TLV is interpreted as a
starting SID/Label value.[¶](#section-5-18){.pilcrow}

Example 1: If the following router addresses (loopback addresses) need
to be mapped into the corresponding Prefix-SID
indexes:[¶](#section-5-19){.pilcrow}

::: {#section-5-20 .artwork .art-text .alignLeft}
              Router-A: 192.0.2.1/32, Prefix-SID: Index 1
              Router-B: 192.0.2.2/32, Prefix-SID: Index 2
              Router-C: 192.0.2.3/32, Prefix-SID: Index 3
              Router-D: 192.0.2.4/32, Prefix-SID: Index 4

[¶](#section-5-20){.pilcrow}
:::

then the Prefix field in the Extended Prefix Range TLV would be set to
192.0.2.1, Prefix Length would be set to 32, Range Size would be set to
4, and the Index value in the Prefix-SID Sub-TLV would be set to
1.[¶](#section-5-21){.pilcrow}

Example 2: If the following prefixes need to be mapped into the
corresponding Prefix-SID indexes:[¶](#section-5-22){.pilcrow}

::: {#section-5-23 .artwork .art-text .alignLeft}
               192.0.2.0/30, Prefix-SID: Index 51
               192.0.2.4/30, Prefix-SID: Index 52
               192.0.2.8/30, Prefix-SID: Index 53
              192.0.2.12/30, Prefix-SID: Index 54
              192.0.2.16/30, Prefix-SID: Index 55
              192.0.2.20/30, Prefix-SID: Index 56
              192.0.2.24/30, Prefix-SID: Index 57

[¶](#section-5-23){.pilcrow}
:::

then the Prefix field in the Extended Prefix Range TLV would be set to
192.0.2.0, Prefix Length would be set to 30, Range Size would be 7, and
the Index value in the Prefix-SID Sub-TLV would be set to
51.[¶](#section-5-24){.pilcrow}
:::
:::

::: {#ADJSID}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Adjacency Segment Identifier (Adj-SID)](#name-adjacency-segment-identifie){.section-name .selfRef} {#name-adjacency-segment-identifie}

An Adjacency Segment Identifier (Adj-SID) represents a router adjacency
in Segment Routing.[¶](#section-6-1){.pilcrow}

::: {#ADJSIDSUBTLV}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [Adj-SID Sub-TLV](#name-adj-sid-sub-tlv){.section-name .selfRef} {#name-adj-sid-sub-tlv}

Adj-SID is an optional sub-TLV of the Extended Link TLV defined in
\[[RFC7684](#RFC7684){.xref}\]. It [MAY]{.bcp14} appear multiple times
in the Extended Link TLV. The Adj-SID Sub-TLV has the following
format:[¶](#section-6.1-1){.pilcrow}

::: {#section-6.1-2 .artwork .art-text .alignLeft}
     
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |            Length             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Flags     |    Reserved   |   MT-ID       |  Weight       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                   SID/Label/Index (variable)                  |
    +---------------------------------------------------------------+

[¶](#section-6.1-2){.pilcrow}
:::

where:[¶](#section-6.1-3){.pilcrow}

-   ::: {#section-6.1-4.1}

    Type:
    :   2[¶](#section-6.1-4.1.1.2){.pilcrow}

    Length:
    :   7 or 8 octets, depending on the
        V-Flag[¶](#section-6.1-4.1.1.4){.pilcrow}

    Flags:

    :   Single-octet field containing the following
        flags:[¶](#section-6.1-4.1.1.6.1){.pilcrow}

        ::: {#section-6.1-4.1.1.6.2 .artwork .art-text .alignLeft}
                
                0 1 2 3 4 5 6 7 
               +-+-+-+-+-+-+-+-+
               |B|V|L|G|P|     |
               +-+-+-+-+-+-+-+-+

        [¶](#section-6.1-4.1.1.6.2){.pilcrow}
        :::

        where:[¶](#section-6.1-4.1.1.6.3){.pilcrow}

        -   ::: {#section-6.1-4.1.1.6.4.1}

            B-Flag:
            :   Backup Flag. If set, the Adj-SID refers to an adjacency
                that is eligible for protection (e.g., using IP Fast
                Reroute or MPLS-FRR (MPLS-Fast Reroute) as described in
                [Section
                2.1](https://www.rfc-editor.org/rfc/rfc8402#section-2.1){.relref}
                of
                \[[RFC8402](#RFC8402){.xref}\].[¶](#section-6.1-4.1.1.6.4.1.1.2){.pilcrow}

            V-Flag:
            :   Value/Index Flag. If set, then the Adj-SID carries an
                absolute value. If not set, then the Adj-SID carries an
                index.[¶](#section-6.1-4.1.1.6.4.1.1.4){.pilcrow}

            L-Flag:
            :   Local/Global Flag. If set, then the value/index carried
                by the Adj-SID has local significance. If not set, then
                the value/index carried by this sub-TLV has global
                significance.[¶](#section-6.1-4.1.1.6.4.1.1.6){.pilcrow}

            G-Flag:
            :   Group Flag. When set, the G-Flag indicates that the
                Adj-SID refers to a group of adjacencies (and therefore
                [MAY]{.bcp14} be assigned to other adjacencies as
                well).[¶](#section-6.1-4.1.1.6.4.1.1.8){.pilcrow}

            P-Flag:
            :   Persistent Flag. When set, the P-Flag indicates that the
                Adj-SID is persistently allocated, i.e., the Adj-SID
                value remains consistent across router restart and/or
                interface
                flap.[¶](#section-6.1-4.1.1.6.4.1.1.10){.pilcrow}

            Other bits:
            :   Reserved. These [MUST]{.bcp14} be zero when sent and are
                ignored when
                received.[¶](#section-6.1-4.1.1.6.4.1.1.12){.pilcrow}
            :::

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception[¶](#section-6.1-4.1.1.8){.pilcrow}

    MT-ID:
    :   Multi-Topology ID (as defined in
        \[[RFC4915](#RFC4915){.xref}\][¶](#section-6.1-4.1.1.10){.pilcrow}

    Weight:
    :   Weight used for load-balancing purposes. The use of the weight
        is defined in
        \[[RFC8402](#RFC8402){.xref}\].[¶](#section-6.1-4.1.1.12){.pilcrow}

    SID/Index/Label:
    :   As described in [Section
        5](#PREFIXSID){.xref}[¶](#section-6.1-4.1.1.14){.pilcrow}
    :::

An SR-capable router [MAY]{.bcp14} allocate an Adj-SID for each of its
adjacencies and set the B-Flag when the adjacency is eligible for
protection by an FRR mechanism (IP or MPLS) as described in [Section
3.5](https://www.rfc-editor.org/rfc/rfc8402#section-3.5){.relref} of
\[[RFC8402](#RFC8402){.xref}\].[¶](#section-6.1-5){.pilcrow}

An SR-capable router [MAY]{.bcp14} allocate more than one Adj-SID to an
adjacency.[¶](#section-6.1-6){.pilcrow}

An SR-capable router [MAY]{.bcp14} allocate the same Adj-SID to
different adjacencies.[¶](#section-6.1-7){.pilcrow}

When the P-Flag is not set, the Adj-SID [MAY]{.bcp14} be persistent.
When the P-Flag is set, the Adj-SID [MUST]{.bcp14} be
persistent.[¶](#section-6.1-8){.pilcrow}
:::
:::

::: {#LANADJSIDSUBTLV}
::: {#section-6.2 .section}
### [6.2.](#section-6.2){.section-number .selfRef} [LAN Adj-SID Sub-TLV](#name-lan-adj-sid-sub-tlv){.section-name .selfRef} {#name-lan-adj-sid-sub-tlv}

The LAN Adjacency SID is an optional sub-TLV of the Extended Link TLV
defined in \[[RFC7684](#RFC7684){.xref}\]. It [MAY]{.bcp14} appear
multiple times in the Extended Link TLV. It is used to advertise a
SID/Label for an adjacency to a non-DR (Designated Router) router on a
broadcast, Non-Broadcast Multi-Access (NBMA), or hybrid
\[[RFC6845](#RFC6845){.xref}\] network.[¶](#section-6.2-1){.pilcrow}

::: {#section-6.2-2 .artwork .art-text .alignLeft}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |              Type             |            Length             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Flags     |    Reserved   |     MT-ID     |    Weight     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Neighbor ID                            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    SID/Label/Index (variable)                 |
    +---------------------------------------------------------------+

[¶](#section-6.2-2){.pilcrow}
:::

where:[¶](#section-6.2-3){.pilcrow}

-   ::: {#section-6.2-4.1}

    Type:
    :   3[¶](#section-6.2-4.1.1.2){.pilcrow}

    Length:
    :   11 or 12 octets, depending on the
        V-Flag[¶](#section-6.2-4.1.1.4){.pilcrow}

    Flags:
    :   Same as in [Section
        6.1](#ADJSIDSUBTLV){.xref}[¶](#section-6.2-4.1.1.6){.pilcrow}

    Reserved:
    :   [SHOULD]{.bcp14} be set to 0 on transmission and [MUST]{.bcp14}
        be ignored on reception[¶](#section-6.2-4.1.1.8){.pilcrow}

    MT-ID:
    :   Multi-Topology ID (as defined in
        \[[RFC4915](#RFC4915){.xref}\])[¶](#section-6.2-4.1.1.10){.pilcrow}

    Weight:
    :   Weight used for load-balancing purposes. The use of the weight
        is defined in
        \[[RFC8402](#RFC8402){.xref}\].[¶](#section-6.2-4.1.1.12){.pilcrow}

    Neighbor ID:
    :   The Router ID of the neighbor for which the LAN Adjacency SID is
        advertised[¶](#section-6.2-4.1.1.14){.pilcrow}

    SID/Index/Label:

    :   As described in [Section
        5](#PREFIXSID){.xref}[¶](#section-6.2-4.1.1.16.1){.pilcrow}
    :::

When the P-Flag is not set, the LAN Adjacency SID [MAY]{.bcp14} be
persistent. When the P-Flag is set, the LAN Adjacency SID [MUST]{.bcp14}
be persistent.[¶](#section-6.2-5){.pilcrow}
:::
:::
:::
:::

::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Elements of Procedure](#name-elements-of-procedure){.section-name .selfRef} {#name-elements-of-procedure}

::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Intra-area Segment Routing in OSPFv2](#name-intra-area-segment-routing-){.section-name .selfRef} {#name-intra-area-segment-routing-}

An OSPFv2 router that supports Segment Routing [MAY]{.bcp14} advertise
Prefix- SIDs for any prefix to which it is advertising reachability
(e.g., a loopback IP address as described in [Section
5](#PREFIXSID){.xref}).[¶](#section-7.1-1){.pilcrow}

A Prefix-SID can also be advertised by the SR Mapping Servers (as
described in \[[RFC8661](#RFC8661){.xref}\]). A Mapping Server
advertises Prefix-SIDs for remote prefixes that exist in the OSPFv2
routing domain. Multiple Mapping Servers can advertise Prefix-SIDs for
the same prefix; in which case, the same Prefix-SID [MUST]{.bcp14} be
advertised by all of them. The flooding scope of the OSPF Extended
Prefix Opaque LSA that is generated by the SR Mapping Server could be
either area scoped or AS scoped and is determined based on the
configuration of the SR Mapping Server.[¶](#section-7.1-2){.pilcrow}

An SR Mapping Server [MUST]{.bcp14} use the OSPF Extended Prefix Range
TLV when advertising SIDs for prefixes. Prefixes of different route
types can be combined in a single OSPF Extended Prefix Range TLV
advertised by an SR Mapping Server. Because the OSPF Extended Prefix
Range TLV doesn\'t include a Route-Type field, as in the OSPF Extended
Prefix TLV, it is possible to include adjacent prefixes from different
route types in the OSPF Extended Prefix Range
TLV.[¶](#section-7.1-3){.pilcrow}

Area-scoped OSPF Extended Prefix Range TLVs are propagated between
areas. Similar to propagation of prefixes between areas, an ABR only
propagates the OSPF Extended Prefix Range TLV that it considers to be
the best from the set it received. The rules used to pick the best OSPF
Extended Prefix Range TLV are described in [Section
4](#PFXRANGE){.xref}.[¶](#section-7.1-4){.pilcrow}

When propagating an OSPF Extended Prefix Range TLV between areas, ABRs
[MUST]{.bcp14} set the IA-Flag. This is used to prevent redundant
flooding of the OSPF Extended Prefix Range TLV between areas as
described in [Section 4](#PFXRANGE){.xref}.[¶](#section-7.1-5){.pilcrow}
:::

::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [Inter-area Segment Routing in OSPFv2](#name-inter-area-segment-routing-){.section-name .selfRef} {#name-inter-area-segment-routing-}

In order to support SR in a multiarea environment, OSPFv2 [MUST]{.bcp14}
propagate Prefix-SID information between areas. The following procedure
is used to propagate Prefix-SIDs between
areas.[¶](#section-7.2-1){.pilcrow}

When an OSPF ABR advertises a Type-3 Summary LSA from an intra-area
prefix to all its connected areas, it will also originate an OSPF
Extended Prefix Opaque LSA as described in
\[[RFC7684](#RFC7684){.xref}\]. The flooding scope of the OSPF Extended
Prefix Opaque LSA type will be set to area-local scope. The route type
in the OSPF Extended Prefix TLV is set to inter-area. The Prefix-SID
Sub-TLV will be included in this LSA and the Prefix-SID value will be
set as follows:[¶](#section-7.2-2){.pilcrow}

-   [The ABR will look at its best path to the prefix in the source area
    and find the advertising router associated with the best path to
    that prefix.[¶](#section-7.2-3.1){.pilcrow}]{#section-7.2-3.1}
-   [The ABR will then determine if this router advertised a Prefix-SID
    for the prefix and use it when advertising the Prefix-SID to other
    connected areas.[¶](#section-7.2-3.2){.pilcrow}]{#section-7.2-3.2}
-   [If no Prefix-SID was advertised for the prefix in the source area
    by the router that contributes to the best path to the prefix, the
    originating ABR will use the Prefix-SID advertised by any other
    router when propagating the Prefix-SID for the prefix to other
    areas.[¶](#section-7.2-3.3){.pilcrow}]{#section-7.2-3.3}

When an OSPF ABR advertises Type-3 Summary LSAs from an inter-area route
to all its connected areas, it will also originate an OSPF Extended
Prefix Opaque LSA as described in \[[RFC7684](#RFC7684){.xref}\]. The
flooding scope of the OSPF Extended Prefix Opaque LSA type will be set
to area-local scope. The route type in the OSPF Extended Prefix TLV is
set to inter-area. The Prefix-SID Sub-TLV will be included in this LSA
and the Prefix-SID will be set as follows:[¶](#section-7.2-4){.pilcrow}

-   [The ABR will look at its best path to the prefix in the backbone
    area and find the advertising router associated with the best path
    to that prefix.[¶](#section-7.2-5.1){.pilcrow}]{#section-7.2-5.1}
-   [The ABR will then determine if such a router advertised a
    Prefix-SID for the prefix and use it when advertising the Prefix-SID
    to other connected
    areas.[¶](#section-7.2-5.2){.pilcrow}]{#section-7.2-5.2}
-   [If no Prefix-SID was advertised for the prefix in the backbone area
    by the ABR that contributes to the best path to the prefix, the
    originating ABR will use the Prefix-SID advertised by any other
    router when propagating the Prefix-SID for the prefix to other
    areas.[¶](#section-7.2-5.3){.pilcrow}]{#section-7.2-5.3}
:::

::: {#section-7.3 .section}
### [7.3.](#section-7.3){.section-number .selfRef} [Segment Routing for External Prefixes](#name-segment-routing-for-externa){.section-name .selfRef} {#name-segment-routing-for-externa}

Type-5 LSAs are flooded domain wide. When an ASBR, which supports SR,
generates Type-5 LSAs, it [SHOULD]{.bcp14} also originate OSPF Extended
Prefix Opaque LSAs as described in \[[RFC7684](#RFC7684){.xref}\]. The
flooding scope of the OSPF Extended Prefix Opaque LSA type is set to
AS-wide scope. The route type in the OSPF Extended Prefix TLV is set to
external. The Prefix-SID Sub-TLV is included in this LSA and the
Prefix-SID value will be set to the SID that has been reserved for that
prefix.[¶](#section-7.3-1){.pilcrow}

When a Not-So-Stubby Area (NSSA) \[[RFC3101](#RFC3101){.xref}\] ABR
translates Type-7 LSAs into Type-5 LSAs, it [SHOULD]{.bcp14} also
advertise the Prefix-SID for the prefix. The NSSA ABR determines its
best path to the prefix advertised in the translated Type-7 LSA and
finds the advertising router associated with that path. If the
advertising router has advertised a Prefix-SID for the prefix, then the
NSSA ABR uses it when advertising the Prefix-SID for the Type-5 prefix.
Otherwise, the Prefix-SID advertised by any other router will be
used.[¶](#section-7.3-2){.pilcrow}
:::

::: {#section-7.4 .section}
### [7.4.](#section-7.4){.section-number .selfRef} [Advertisement of Adj-SID](#name-advertisement-of-adj-sid){.section-name .selfRef} {#name-advertisement-of-adj-sid}

The Adjacency Segment Routing Identifier (Adj-SID) is advertised using
the Adj-SID Sub-TLV as described in [Section
6](#ADJSID){.xref}.[¶](#section-7.4-1){.pilcrow}

::: {#section-7.4.1 .section}
#### [7.4.1.](#section-7.4.1){.section-number .selfRef} [Advertisement of Adj-SID on Point-to-Point Links](#name-advertisement-of-adj-sid-on){.section-name .selfRef} {#name-advertisement-of-adj-sid-on}

An Adj-SID [MAY]{.bcp14} be advertised for any adjacency on a
point-to-point (P2P) link that is in neighbor state 2-Way or higher. If
the adjacency on a P2P link transitions from the FULL state, then the
Adj-SID for that adjacency [MAY]{.bcp14} be removed from the area. If
the adjacency transitions to a state lower than 2-Way, then the Adj-SID
Advertisement [MUST]{.bcp14} be withdrawn from the
area.[¶](#section-7.4.1-1){.pilcrow}
:::

::: {#section-7.4.2 .section}
#### [7.4.2.](#section-7.4.2){.section-number .selfRef} [Adjacency SID on Broadcast or NBMA Interfaces](#name-adjacency-sid-on-broadcast-){.section-name .selfRef} {#name-adjacency-sid-on-broadcast-}

Broadcast, NBMA, or hybrid \[[RFC6845](#RFC6845){.xref}\] networks in
OSPF are represented by a star topology where the Designated Router (DR)
is the central point to which all other routers on the broadcast, NBMA,
or hybrid network connect. As a result, routers on the broadcast, NBMA,
or hybrid network advertise only their adjacency to the DR. Routers that
do not act as DR do not form or advertise adjacencies with each other.
They do, however, maintain 2-Way adjacency state with each other and are
directly reachable.[¶](#section-7.4.2-1){.pilcrow}

When Segment Routing is used, each router on the broadcast, NBMA, or
hybrid network [MAY]{.bcp14} advertise the Adj-SID for its adjacency to
the DR using the Adj-SID Sub-TLV as described in [Section
6.1](#ADJSIDSUBTLV){.xref}.[¶](#section-7.4.2-2){.pilcrow}

SR-capable routers [MAY]{.bcp14} also advertise a LAN Adjacency SID for
other neighbors (e.g., Backup Designated Router, DR-OTHER, etc.) on the
broadcast, NBMA, or hybrid network using the LAN Adj-SID Sub-TLV as
described in [Section
6.2](#LANADJSIDSUBTLV){.xref}.[¶](#section-7.4.2-3){.pilcrow}
:::
:::
:::

::: {#IANA}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This specification updates several existing OSPF registries and creates
a new IGP registry.[¶](#section-8-1){.pilcrow}

::: {#RITLVREG}
::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [OSPF Router Information (RI) TLVs Registry](#name-ospf-router-information-ri-){.section-name .selfRef} {#name-ospf-router-information-ri-}

The following values have been allocated:[¶](#section-8.1-1){.pilcrow}

[]{#name-ospf-router-information-ri-t}

::: {#IANA1}
  Value   TLV Name              Reference
  ------- --------------------- ---------------
  8       SR-Algorithm TLV      This document
  9       SID/Label Range TLV   This document
  14      SR Local Block TLV    This document
  15      SRMS Preference TLV   This document

  : [Table 1](#table-1){.selfRef}: [OSPF Router Information (RI)
  TLVs](#name-ospf-router-information-ri-t){.selfRef}
:::
:::
:::

::: {#EPLTLVREG}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [OSPFv2 Extended Prefix Opaque LSA TLVs Registry](#name-ospfv2-extended-prefix-opaq){.section-name .selfRef} {#name-ospfv2-extended-prefix-opaq}

The following values have been allocated:[¶](#section-8.2-1){.pilcrow}

[]{#name-ospfv2-extended-prefix-opaqu}

::: {#IANA2}
  Value   Description                      Reference
  ------- -------------------------------- ---------------
  2       OSPF Extended Prefix Range TLV   This document

  : [Table 2](#table-2){.selfRef}: [OSPFv2 Extended Prefix Opaque LSA
  TLVs](#name-ospfv2-extended-prefix-opaqu){.selfRef}
:::
:::
:::

::: {#EPLSTLVREG}
::: {#section-8.3 .section}
### [8.3.](#section-8.3){.section-number .selfRef} [OSPFv2 Extended Prefix TLV Sub-TLVs Registry](#name-ospfv2-extended-prefix-tlv-){.section-name .selfRef} {#name-ospfv2-extended-prefix-tlv-}

The following values have been allocated:[¶](#section-8.3-1){.pilcrow}

[]{#name-ospfv2-extended-prefix-tlv-s}

::: {#IANA3}
  Value   Description          Reference
  ------- -------------------- ---------------
  1       SID/Label Sub-TLV    This document
  2       Prefix-SID Sub-TLV   This document

  : [Table 3](#table-3){.selfRef}: [OSPFv2 Extended Prefix TLV
  Sub-TLVs](#name-ospfv2-extended-prefix-tlv-s){.selfRef}
:::
:::
:::

::: {#ELLSTLVREG}
::: {#section-8.4 .section}
### [8.4.](#section-8.4){.section-number .selfRef} [OSPFv2 Extended Link TLV Sub-TLVs Registry](#name-ospfv2-extended-link-tlv-su){.section-name .selfRef} {#name-ospfv2-extended-link-tlv-su}

The following initial values have been
allocated:[¶](#section-8.4-1){.pilcrow}

[]{#name-ospfv2-extended-link-tlv-sub}

::: {#IANA4}
  Value   Description                 Reference
  ------- --------------------------- ---------------
  1       SID/Label Sub-TLV           This document
  2       Adj-SID Sub-TLV             This document
  3       LAN Adj-SID/Label Sub-TLV   This document

  : [Table 4](#table-4){.selfRef}: [OSPFv2 Extended Link TLV
  Sub-TLVs](#name-ospfv2-extended-link-tlv-sub){.selfRef}
:::
:::
:::

::: {#IGPALGOREG}
::: {#section-8.5 .section}
### [8.5.](#section-8.5){.section-number .selfRef} [IGP Algorithm Types Registry](#name-igp-algorithm-types-registr){.section-name .selfRef} {#name-igp-algorithm-types-registr}

IANA has set up a subregistry called \"IGP Algorithm Type\" under the
\"Interior Gateway Protocol (IGP) Parameters\" registry. The
registration policy for this registry is \"Standards Action\"
(\[[RFC8126](#RFC8126){.xref}\] and
\[[RFC7120](#RFC7120){.xref}\]).[¶](#section-8.5-1){.pilcrow}

Values in this registry come from the range
0-255.[¶](#section-8.5-2){.pilcrow}

The initial values in the IGP Algorithm Type registry are as
follows:[¶](#section-8.5-3){.pilcrow}

[]{#name-igp-algorithm-types}

::: {#IANA5}
  Value   Description                                                                                                                                                                                                                                                                                                                         Reference
  ------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------
  0       Shortest Path First (SPF) algorithm based on link metric. This is the standard shortest path algorithm as computed by the IGP protocol. Consistent with the deployed practice for link-state protocols, Algorithm 0 permits any node to overwrite the SPF path with a different path based on its local policy.                     This document
  1       Strict Shortest Path First (SPF) algorithm based on link metric. The algorithm is identical to Algorithm 0, but Algorithm 1 requires that all nodes along the path will honor the SPF routing decision. Local policy at the node claiming support for Algorithm 1 [MUST NOT]{.bcp14} alter the SPF paths computed by Algorithm 1.   This document

  : [Table 5](#table-5){.selfRef}: [IGP Algorithm
  Types](#name-igp-algorithm-types){.selfRef}
:::
:::
:::
:::
:::

::: {#Error-handling}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [TLV/Sub-TLV Error Handling](#name-tlv-sub-tlv-error-handling){.section-name .selfRef} {#name-tlv-sub-tlv-error-handling}

For any new TLVs/sub-TLVs defined in this document, if the length is
invalid, the LSA in which it is advertised is considered malformed and
[MUST]{.bcp14} be ignored. An error [SHOULD]{.bcp14} be logged subject
to rate limiting.[¶](#section-9-1){.pilcrow}
:::
:::

::: {#Security}
::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

With the OSPFv2 Segment Routing extensions defined herein, OSPFv2 will
now program the MPLS data plane \[[RFC3031](#RFC3031){.xref}\] in
addition to the IP data plane. Previously, LDP
\[[RFC5036](#RFC5036){.xref}\] or another label distribution mechanism
was required to advertise MPLS labels and program the MPLS data
plane.[¶](#section-10-1){.pilcrow}

In general, the same types of attacks that can be carried out on the IP
control plane can be carried out on the MPLS control plane resulting in
traffic being misrouted in the respective data planes. However, the
latter can be more difficult to detect and
isolate.[¶](#section-10-2){.pilcrow}

Existing security extensions as described in
\[[RFC2328](#RFC2328){.xref}\] and \[[RFC7684](#RFC7684){.xref}\] apply
to these Segment Routing extensions. While OSPF is under a single
administrative domain, there can be deployments where potential
attackers have access to one or more networks in the OSPF routing
domain. In these deployments, stronger authentication mechanisms such as
those specified in \[[RFC7474](#RFC7474){.xref}\] [SHOULD]{.bcp14} be
used.[¶](#section-10-3){.pilcrow}

Implementations [MUST]{.bcp14} assure that malformed TLVs and sub-TLVs
defined in this document are detected and do not provide a vulnerability
for attackers to crash the OSPFv2 router or routing process. Reception
of malformed TLVs or sub-TLVs [SHOULD]{.bcp14} be counted and/or logged
for further analysis. Logging of malformed TLVs and sub-TLVs
[SHOULD]{.bcp14} be rate limited to prevent a Denial of Service (DoS)
attack (distributed or otherwise) from overloading the OSPF control
plane.[¶](#section-10-4){.pilcrow}
:::
:::

::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-11.1 .section}
### [11.1.](#section-11.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.

\[RFC2328\]
:   [Moy, J.]{.refAuthor}, [\"OSPF Version 2\"]{.refTitle}, [STD
    54]{.seriesInfo}, [RFC 2328]{.seriesInfo}, [DOI
    10.17487/RFC2328]{.seriesInfo}, April 1998,
    \<<https://www.rfc-editor.org/info/rfc2328>\>.

\[RFC3101\]
:   [Murphy, P.]{.refAuthor}, [\"The OSPF Not-So-Stubby Area (NSSA)
    Option\"]{.refTitle}, [RFC 3101]{.seriesInfo}, [DOI
    10.17487/RFC3101]{.seriesInfo}, January 2003,
    \<<https://www.rfc-editor.org/info/rfc3101>\>.

\[RFC4915\]
:   [Psenak, P.]{.refAuthor}[, Mirtorabi, S.]{.refAuthor}[,
    Roy, A.]{.refAuthor}[, Nguyen, L.]{.refAuthor}[, and P.
    Pillay-Esnault]{.refAuthor}, [\"Multi-Topology (MT) Routing in
    OSPF\"]{.refTitle}, [RFC 4915]{.seriesInfo}, [DOI
    10.17487/RFC4915]{.seriesInfo}, June 2007,
    \<<https://www.rfc-editor.org/info/rfc4915>\>.

\[RFC6845\]
:   [Sheth, N.]{.refAuthor}[, Wang, L.]{.refAuthor}[, and J.
    Zhang]{.refAuthor}, [\"OSPF Hybrid Broadcast and Point-to-Multipoint
    Interface Type\"]{.refTitle}, [RFC 6845]{.seriesInfo}, [DOI
    10.17487/RFC6845]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6845>\>.

\[RFC7120\]
:   [Cotton, M.]{.refAuthor}, [\"Early IANA Allocation of Standards
    Track Code Points\"]{.refTitle}, [BCP 100]{.seriesInfo}, [RFC
    7120]{.seriesInfo}, [DOI 10.17487/RFC7120]{.seriesInfo}, January
    2014, \<<https://www.rfc-editor.org/info/rfc7120>\>.

\[RFC7684\]
:   [Psenak, P.]{.refAuthor}[, Gredler, H.]{.refAuthor}[,
    Shakir, R.]{.refAuthor}[, Henderickx, W.]{.refAuthor}[,
    Tantsura, J.]{.refAuthor}[, and A. Lindem]{.refAuthor}, [\"OSPFv2
    Prefix/Link Attribute Advertisement\"]{.refTitle}, [RFC
    7684]{.seriesInfo}, [DOI 10.17487/RFC7684]{.seriesInfo}, November
    2015, \<<https://www.rfc-editor.org/info/rfc7684>\>.

\[RFC7770\]
:   [Lindem, A., Ed.]{.refAuthor}[, Shen, N.]{.refAuthor}[, Vasseur,
    JP.]{.refAuthor}[, Aggarwal, R.]{.refAuthor}[, and S.
    Shaffer]{.refAuthor}, [\"Extensions to OSPF for Advertising Optional
    Router Capabilities\"]{.refTitle}, [RFC 7770]{.seriesInfo}, [DOI
    10.17487/RFC7770]{.seriesInfo}, February 2016,
    \<<https://www.rfc-editor.org/info/rfc7770>\>.

\[RFC8126\]
:   [Cotton, M.]{.refAuthor}[, Leiba, B.]{.refAuthor}[, and T.
    Narten]{.refAuthor}, [\"Guidelines for Writing an IANA
    Considerations Section in RFCs\"]{.refTitle}, [BCP 26]{.seriesInfo},
    [RFC 8126]{.seriesInfo}, [DOI 10.17487/RFC8126]{.seriesInfo}, June
    2017, \<<https://www.rfc-editor.org/info/rfc8126>\>.

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.

\[RFC8402\]
:   [Filsfils, C., Ed.]{.refAuthor}[, Previdi, S., Ed.]{.refAuthor}[,
    Ginsberg, L.]{.refAuthor}[, Decraene, B.]{.refAuthor}[,
    Litkowski, S.]{.refAuthor}[, and R. Shakir]{.refAuthor}, [\"Segment
    Routing Architecture\"]{.refTitle}, [RFC 8402]{.seriesInfo}, [DOI
    10.17487/RFC8402]{.seriesInfo}, July 2018,
    \<<https://www.rfc-editor.org/info/rfc8402>\>.

\[RFC8660\]
:   [Bashandy, A., Ed.]{.refAuthor}[, Filsfils, C., Ed.]{.refAuthor}[,
    Previdi, S.]{.refAuthor}[, Decraene, B.]{.refAuthor}[,
    Litkowski, S.]{.refAuthor}[, and R. Shakir]{.refAuthor}, [\"Segment
    Routing with MPLS Data Plane\"]{.refTitle}, [RFC 8660]{.seriesInfo},
    [DOI 10.17487/RFC8660]{.seriesInfo}, December 2019,
    \<<https://www.rfc-editor.org/info/rfc8660>\>.

\[RFC8661\]
:   [Bashandy, A., Ed.]{.refAuthor}[, Filsfils, C., Ed.]{.refAuthor}[,
    Previdi, S.]{.refAuthor}[, Decraene, B.]{.refAuthor}[, and S.
    Litkowski]{.refAuthor}, [\"Segment Routing Interworking with
    LDP\"]{.refTitle}, [RFC 8661]{.seriesInfo}, [DOI
    10.17487/RFC8661]{.seriesInfo}, December 2019,
    \<<https://www.rfc-editor.org/info/rfc8661>\>.
:::

::: {#section-11.2 .section}
### [11.2.](#section-11.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC3031\]
:   [Rosen, E.]{.refAuthor}[, Viswanathan, A.]{.refAuthor}[, and R.
    Callon]{.refAuthor}, [\"Multiprotocol Label Switching
    Architecture\"]{.refTitle}, [RFC 3031]{.seriesInfo}, [DOI
    10.17487/RFC3031]{.seriesInfo}, January 2001,
    \<<https://www.rfc-editor.org/info/rfc3031>\>.

\[RFC5036\]
:   [Andersson, L., Ed.]{.refAuthor}[, Minei, I., Ed.]{.refAuthor}[,
    and B. Thomas, Ed.]{.refAuthor}, [\"LDP Specification\"]{.refTitle},
    [RFC 5036]{.seriesInfo}, [DOI 10.17487/RFC5036]{.seriesInfo},
    October 2007, \<<https://www.rfc-editor.org/info/rfc5036>\>.

\[RFC7474\]
:   [Bhatia, M.]{.refAuthor}[, Hartman, S.]{.refAuthor}[,
    Zhang, D.]{.refAuthor}[, and A. Lindem, Ed.]{.refAuthor},
    [\"Security Extension for OSPFv2 When Using Manual Key
    Management\"]{.refTitle}, [RFC 7474]{.seriesInfo}, [DOI
    10.17487/RFC7474]{.seriesInfo}, April 2015,
    \<<https://www.rfc-editor.org/info/rfc7474>\>.

\[RFC7855\]
:   [Previdi, S., Ed.]{.refAuthor}[, Filsfils, C., Ed.]{.refAuthor}[,
    Decraene, B.]{.refAuthor}[, Litkowski, S.]{.refAuthor}[,
    Horneffer, M.]{.refAuthor}[, and R. Shakir]{.refAuthor}, [\"Source
    Packet Routing in Networking (SPRING) Problem Statement and
    Requirements\"]{.refTitle}, [RFC 7855]{.seriesInfo}, [DOI
    10.17487/RFC7855]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7855>\>.

\[RFC8666\]
:   [Psenak, P., Ed.]{.refAuthor}[ and S. Previdi, Ed.]{.refAuthor},
    [\"OSPFv3 Extensions for Segment Routing\"]{.refTitle}, [RFC
    8666]{.seriesInfo}, [DOI 10.17487/RFC8666]{.seriesInfo}, December
    2019, \<<https://www.rfc-editor.org/info/rfc8666>\>.
:::
:::

::: {#Acknowledgements}
::: {#section-appendix.a .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

We would like to thank Anton Smirnov for his
contribution.[¶](#section-appendix.a-1){.pilcrow}

Thanks to Acee Lindem for the detailed review of the document,
corrections, as well as discussion about details of the
encoding.[¶](#section-appendix.a-2){.pilcrow}
:::
:::

::: {#Contributors}
::: {#section-appendix.b .section}
## [Contributors](#name-contributors){.section-name .selfRef} {#name-contributors}

The following people gave a substantial contribution to the content of
this document: Acee Lindem, Ahmed Bashandy, Martin Horneffer, Bruno
Decraene, Stephane Litkowski, Igor Milojevic, and Saku
Ytti.[¶](#section-appendix.b-1){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#section-appendix.c .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Peter Psenak ([editor]{.role})]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[Apollo Business Center, Mlynske nivy 43]{.street-address}
:::

::: {.left dir="auto"}
[821 09]{.postal-code} [Bratislava]{.locality}
:::

::: {.left dir="auto"}
[Slovakia]{.country-name}
:::

::: email
Email: <ppsenak@cisco.com>
:::

::: {.left dir="auto"}
[Stefano Previdi ([editor]{.role})]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[Via Del Serafico, 200]{.street-address}
:::

::: {.left dir="auto"}
[00142]{.postal-code} [Rome]{.locality}
:::

::: {.left dir="auto"}
[Italy]{.country-name}
:::

::: email
Email: <stefano@previdi.net>
:::

::: {.left dir="auto"}
[Clarence Filsfils]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[Brussels]{.locality}
:::

::: {.left dir="auto"}
[Belgium]{.country-name}
:::

::: email
Email: <cfilsfil@cisco.com>
:::

::: {.left dir="auto"}
[Hannes Gredler]{.fn .nameRole}
:::

::: {.left dir="auto"}
[RtBrick Inc.]{.org}
:::

::: email
Email: <hannes@rtbrick.com>
:::

::: {.left dir="auto"}
[Rob Shakir]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google, Inc.]{.org}
:::

::: {.left dir="auto"}
[1600 Amphitheatre Parkway]{.street-address}
:::

::: {.left dir="auto"}
[Mountain View]{.locality}, [CA]{.region} [94043]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <robjs@google.com>
:::

::: {.left dir="auto"}
[Wim Henderickx]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Nokia]{.org}
:::

::: {.left dir="auto"}
[Copernicuslaan 50]{.street-address}
:::

::: {.left dir="auto"}
[2018]{.postal-code} [Antwerp]{.locality}
:::

::: {.left dir="auto"}
[Belgium]{.country-name}
:::

::: email
Email: <wim.henderickx@nokia.com>
:::

::: {.left dir="auto"}
[Jeff Tantsura]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Apstra, Inc.]{.org}
:::

::: email
Email: <jefftant.ietf@gmail.com>
:::
:::
:::
