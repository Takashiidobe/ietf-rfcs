  RFC 8650       RESTCONF Transport for Event Notifications   November 2019
  -------------- -------------------------------------------- ---------------
  Voit, et al.   Standards Track                              \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8650](https://www.rfc-editor.org/rfc/rfc8650){.eref}

Category:
:   Standards Track

Published:
:   November 2019

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    E. Voit
    :::

    ::: org
    Cisco Systems
    :::
    :::

    ::: author
    ::: author-name
    R. Rahman
    :::

    ::: org
    Cisco Systems
    :::
    :::

    ::: author
    ::: author-name
    E. Nilsen-Nygaard
    :::

    ::: org
    Cisco Systems
    :::
    :::

    ::: author
    ::: author-name
    A. Clemm
    :::

    ::: org
    Futurewei
    :::
    :::

    ::: author
    ::: author-name
    A. Bierman
    :::

    ::: org
    YumaWorks
    :::
    :::
:::

# RFC 8650 {#rfcnum}

# Dynamic Subscription to YANG Events and Datastores over RESTCONF {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document provides a RESTCONF binding to the dynamic subscription
capability of both subscribed notifications and
YANG-Push.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8650>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2019 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Terminology](#name-terminology){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Dynamic
    Subscriptions](#name-dynamic-subscriptions){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}

    -   ::: {#section-toc.1-1.3.2.1}
        [3.1](#section-3.1){.xref}.  [Transport
        Connectivity](#name-transport-connectivity){.xref}[¶](#section-toc.1-1.3.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.2}
        [3.2](#section-3.2){.xref}.  [Discovery](#name-discovery){.xref}[¶](#section-toc.1-1.3.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.3}
        [3.3](#section-3.3){.xref}.  [RESTCONF RPCs and HTTP Status
        Codes](#name-restconf-rpcs-and-http-stat){.xref}[¶](#section-toc.1-1.3.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.4}
        [3.4](#section-3.4){.xref}.  [Call Flow for Server-Sent
        Events](#name-call-flow-for-server-sent-e){.xref}[¶](#section-toc.1-1.3.2.4.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [QoS
    Treatment](#name-qos-treatment){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Notification
    Messages](#name-notification-messages){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [YANG
    Tree](#name-yang-tree){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [YANG
    Module](#name-yang-module){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.10.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.10.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [Appendix
    A](#section-appendix.a){.xref}.  [Examples](#name-examples){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}

    -   ::: {#section-toc.1-1.11.2.1}
        [A.1](#section-a.1){.xref}.  [Dynamic
        Subscriptions](#name-dynamic-subscriptions-2){.xref}[¶](#section-toc.1-1.11.2.1.1){.pilcrow}

        -   ::: {#section-toc.1-1.11.2.1.2.1}
            [A.1.1](#section-a.1.1){.xref}.  [Establishing Dynamic
            Subscriptions](#name-establishing-dynamic-subscr){.xref}[¶](#section-toc.1-1.11.2.1.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.11.2.1.2.2}
            [A.1.2](#section-a.1.2){.xref}.  [Modifying Dynamic
            Subscriptions](#name-modifying-dynamic-subscript){.xref}[¶](#section-toc.1-1.11.2.1.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.11.2.1.2.3}
            [A.1.3](#section-a.1.3){.xref}.  [Deleting Dynamic
            Subscriptions](#name-deleting-dynamic-subscripti){.xref}[¶](#section-toc.1-1.11.2.1.2.3.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.11.2.2}
        [A.2](#section-a.2){.xref}.  [Subscription State
        Notifications](#name-subscription-state-notifica){.xref}[¶](#section-toc.1-1.11.2.2.1){.pilcrow}

        -   ::: {#section-toc.1-1.11.2.2.2.1}
            [A.2.1](#section-a.2.1){.xref}.  [\"subscription-modified\"](#name-subscription-modified){.xref}[¶](#section-toc.1-1.11.2.2.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.11.2.2.2.2}
            [A.2.2](#section-a.2.2){.xref}.  [\"subscription-completed\",
            \"subscription-resumed\", and
            \"replay-completed\"](#name-subscription-completed-subs){.xref}[¶](#section-toc.1-1.11.2.2.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.11.2.2.2.3}
            [A.2.3](#section-a.2.3){.xref}.  [\"subscription-terminated\"
            and
            \"subscription-suspended\"](#name-subscription-terminated-and){.xref}[¶](#section-toc.1-1.11.2.2.2.3.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.11.2.3}
        [A.3](#section-a.3){.xref}.  [Filter
        Example](#name-filter-example){.xref}[¶](#section-toc.1-1.11.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.12}
    [](#section-appendix.b){.xref}[Acknowledgments](#name-acknowledgments){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.13}
    [](#section-appendix.c){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

Mechanisms to support event subscription and YANG-Push are defined in
\[[RFC8639](#RFC8639){.xref}\]. Enhancements to
\[[RFC8639](#RFC8639){.xref}\] that enable YANG datastore subscription
and YANG-Push are defined in \[[RFC8641](#RFC8641){.xref}\]. This
document provides a transport specification for dynamic subscriptions
over RESTCONF \[[RFC8040](#RFC8040){.xref}\]. Requirements for these
mechanisms are captured in
\[[RFC7923](#RFC7923){.xref}\].[¶](#section-1-1){.pilcrow}

The streaming of notifications that encapsulate the resulting
information push is done via the mechanism described in [Section
6.3](https://www.rfc-editor.org/rfc/rfc8040#section-6.3){.relref} of
\[[RFC8040](#RFC8040){.xref}\].[¶](#section-1-2){.pilcrow}
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}

The following terms use the definitions from
\[[RFC8639](#RFC8639){.xref}\]: dynamic subscription, event stream,
notification message, publisher, receiver, subscriber, and
subscription.[¶](#section-2-2){.pilcrow}

Other terms reused include datastore, which is defined in
\[[RFC8342](#RFC8342){.xref}\], and HTTP/2 stream, which maps to the
definition of \"stream\" within \[[RFC7540](#RFC7540){.xref}\], [Section
2](https://www.rfc-editor.org/rfc/rfc7540#section-2){.relref}.[¶](#section-2-3){.pilcrow}
:::

::: {#dyn-subs}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Dynamic Subscriptions](#name-dynamic-subscriptions){.section-name .selfRef} {#name-dynamic-subscriptions}

This section provides specifics on how to establish and maintain dynamic
subscriptions over RESTCONF \[[RFC8040](#RFC8040){.xref}\]. Subscribing
to event streams is accomplished in this way via RPCs defined within
\[[RFC8639](#RFC8639){.xref}\], [Section
2.4](https://www.rfc-editor.org/rfc/rfc8639#section-2.4){.relref}. The
RPCs are done via RESTCONF POSTs. YANG datastore subscription is
accomplished via augmentations to \[[RFC8639](#RFC8639){.xref}\] as
described within \[[RFC8641](#RFC8641){.xref}\], [Section
4.4](https://www.rfc-editor.org/rfc/rfc8641#section-4.4){.relref}.[¶](#section-3-1){.pilcrow}

As described in [Section
6.3](https://www.rfc-editor.org/rfc/rfc8040#section-6.3){.relref} of
\[[RFC8040](#RFC8040){.xref}\], a GET needs to be performed on a
specific URI on the publisher. Subscribers cannot predetermine the URI
against which a subscription might exist on a publisher, as the URI will
only exist after the \"establish-subscription\" RPC has been accepted.
Therefore, the POST for the \"establish-subscription\" RPC replaces the
GET request for the \"location\" leaf that is used in
\[[RFC8040](#RFC8040){.xref}\] to obtain the URI. The subscription URI
will be determined and sent as part of the response to the
\"establish-subscription\" RPC, and a subsequent GET to this URI will be
done in order to start the flow of notification messages back to the
subscriber. As specified in [Section
2.4.1](https://www.rfc-editor.org/rfc/rfc8639#section-2.4.1){.relref} of
\[[RFC8639](#RFC8639){.xref}\], a subscription does not move to the
active state until the GET is received.[¶](#section-3-2){.pilcrow}

::: {#section-3.1 .section}
### [3.1.](#section-3.1){.section-number .selfRef} [Transport Connectivity](#name-transport-connectivity){.section-name .selfRef} {#name-transport-connectivity}

For a dynamic subscription, when a RESTCONF session doesn\'t already
exist, a new RESTCONF session is initiated from the
subscriber.[¶](#section-3.1-1){.pilcrow}

As stated in [Section
2.1](https://www.rfc-editor.org/rfc/rfc8040#section-2.1){.relref} of
\[[RFC8040](#RFC8040){.xref}\], a subscriber [MUST]{.bcp14} establish
the HTTP session over TLS \[[RFC8446](#RFC8446){.xref}\] in order to
secure the content in transit.[¶](#section-3.1-2){.pilcrow}

Without the involvement of additional protocols, HTTP sessions by
themselves do not support quick recognition of the loss of the
communication path to the publisher. Where quick recognition of the loss
of a publisher is required, a subscriber [SHOULD]{.bcp14} use a TLS
heartbeat \[[RFC6520](#RFC6520){.xref}\], just from subscriber to
publisher, to track HTTP session
continuity.[¶](#section-3.1-3){.pilcrow}

Loss of the heartbeat [MUST]{.bcp14} result in the teardown of any
subscription-related TCP sessions between those endpoints. A subscriber
can then attempt to re-establish the dynamic subscription by using the
procedure described in [Section
3.4](#SSE){.xref}.[¶](#section-3.1-4){.pilcrow}
:::

::: {#section-3.2 .section}
### [3.2.](#section-3.2){.section-number .selfRef} [Discovery](#name-discovery){.section-name .selfRef} {#name-discovery}

Subscribers can learn which event streams a RESTCONF server supports by
querying the \"streams\" container of ietf-subscribed-notifications.yang
in \[[RFC8639](#RFC8639){.xref}\]. Support for the \"streams\" container
of ietf-restconf-monitoring.yang in \[[RFC8040](#RFC8040){.xref}\] is
not required. In the case when the RESTCONF binding specified by this
document is used to convey the \"streams\" container from
ietf-restconf-monitoring.yang (i.e., that feature is supported), any
event streams contained therein are also expected to be present in the
\"streams\" container of
ietf-restconf-monitoring.yang.[¶](#section-3.2-1){.pilcrow}

Subscribers can learn which datastores a RESTCONF server supports by
following [Section
2](https://www.rfc-editor.org/rfc/rfc8527#section-2){.relref} of
\[[RFC8527](#RFC8527){.xref}\].[¶](#section-3.2-2){.pilcrow}
:::

::: {#section-3.3 .section}
### [3.3.](#section-3.3){.section-number .selfRef} [RESTCONF RPCs and HTTP Status Codes](#name-restconf-rpcs-and-http-stat){.section-name .selfRef} {#name-restconf-rpcs-and-http-stat}

Specific HTTP response codes as defined in [Section
6](https://www.rfc-editor.org/rfc/rfc7231#section-6){.relref} of
\[[RFC7231](#RFC7231){.xref}\] will indicate the result of RESTCONF RPC
requests with the publisher. An HTTP status code of 200 is the proper
response to any successful RPC defined within
\[[RFC8639](#RFC8639){.xref}\] or
\[[RFC8641](#RFC8641){.xref}\].[¶](#section-3.3-1){.pilcrow}

If a publisher fails to serve the RPC request for one of the reasons
indicated in [Section
2.4.6](https://www.rfc-editor.org/rfc/rfc8639#section-2.4.6){.relref} of
\[[RFC8639](#RFC8639){.xref}\] or [Appendix
A](https://www.rfc-editor.org/rfc/rfc8641#appendix-A){.relref} of
\[[RFC8641](#RFC8641){.xref}\], this will be indicated by an appropriate
error code, as shown below, transported in the HTTP
response.[¶](#section-3.3-2){.pilcrow}

When an HTTP error code is returned, the RPC reply [MUST]{.bcp14}
include an \<rpc-error> element per [Section
7.1](https://www.rfc-editor.org/rfc/rfc8040#section-7.1){.relref} of
\[[RFC8040](#RFC8040){.xref}\] with the following parameter
values:[¶](#section-3.3-3){.pilcrow}

-   [an \"error-type\" node of
    \"application\".[¶](#section-3.3-4.1){.pilcrow}]{#section-3.3-4.1}
-   [an \"error-tag\" node whose value is a string that corresponds to
    an identity associated with the error. This \"error-tag\" will come
    from one of two places and will correspond to the error identities
    either within [Section
    2.4.6](https://www.rfc-editor.org/rfc/rfc8639#section-2.4.6){.relref}
    of \[[RFC8639](#RFC8639){.xref}\] for general subscription errors
    ([Table 1](#gen-sub-errors){.xref}) or within [Appendix
    A.1](https://www.rfc-editor.org/rfc/rfc8641#appendix-A.1){.relref}
    of \[[RFC8641](#RFC8641){.xref}\] for subscription errors specific
    to YANG datastores ([Table
    2](#datastore-specific-errors){.xref}).[¶](#section-3.3-4.2){.pilcrow}]{#section-3.3-4.2}
-   [an \"error-app-tag\" node whose value is a string that corresponds
    to an identity associated with the error, as defined in [Section
    2.4.6](https://www.rfc-editor.org/rfc/rfc8639#section-2.4.6){.relref}
    of \[[RFC8639](#RFC8639){.xref}\] for general subscriptions or
    [Appendix
    A.1](https://www.rfc-editor.org/rfc/rfc8641#appendix-A.1){.relref}
    of \[[RFC8641](#RFC8641){.xref}\] for subscription errors specific
    to YANG datastores. The tag to use depends on the RPC for which the
    error occurred. Viable errors for different RPCs are found in [Table
    3](#rpc-errors){.xref}.[¶](#section-3.3-4.3){.pilcrow}]{#section-3.3-4.3}

[]{#name-general-subscription-error-}

::: {#gen-sub-errors}
  Error identity           Uses \"error-tag\"        HTTP code
  ------------------------ ------------------------- -----------
  dscp-unavailable         invalid-value             400
  encoding-unsupported     invalid-value             400
  filter-unsupported       invalid-value             400
  insufficient-resources   resource-denied           409
  no-such-subscription     invalid-value             404
  replay-unsupported       operation-not-supported   501

  : [Table 1](#table-1){.selfRef}: [General Subscription Error
  Identities and Associated \"error-tag\"
  Use](#name-general-subscription-error-){.selfRef}
:::

[]{#name-datastore-specific-error-id}

::: {#datastore-specific-errors}
  Error identity                Uses \"error-tag\"        HTTP code
  ----------------------------- ------------------------- -----------
  cant-include                  operation-not-supported   501
  datastore-not-subscribable    invalid-value             400
  no-such-subscription-resync   invalid-value             404
  on-change-unsupported         operation-not-supported   501
  on-change-sync-unsupported    operation-not-supported   501
  period-unsupported            invalid-value             400
  update-too-big                too-big                   400
  sync-too-big                  too-big                   400
  unchanging-selection          operation-failed          500

  : [Table 2](#table-2){.selfRef}: [Datastore-Specific Error Identities
  and Associated \"error-tag\"
  Use](#name-datastore-specific-error-id){.selfRef}
:::

[]{#name-rpc-errors-and-associated-e}

::: {#rpc-errors}
  RPC                      Select an identity with a base
  ------------------------ --------------------------------
  establish-subscription   establish-subscription-error
  modify-subscription      modify-subscription-error
  delete-subscription      delete-subscription-error
  kill-subscription        delete-subscription-error
  resync-subscription      resync-subscription-error

  : [Table 3](#table-3){.selfRef}: [RPC Errors and Associated Error
  Identities](#name-rpc-errors-and-associated-e){.selfRef}
:::

Each error identity will be inserted as the \"error-app-tag\" using JSON
encoding following the form \<modulename>:\<identityname>. An example of
such a valid encoding would be
\"ietf-subscribed-notifications:no-such-subscription\".[¶](#section-3.3-8){.pilcrow}

In the case of error responses to an \"establish-subscription\" or
\"modify-subscription\" request, there is the option to include an
\"error-info\" node. This node may contain hints for parameter settings
that might lead to successful RPC requests in the future. Tables
[4](#error-info-estab-sub){.xref} and [5](#error-info-mod-sub){.xref}
show the yang-data structures that may be
returned.[¶](#section-3.3-9){.pilcrow}

[]{#name-optional-error-info-node-hi}

::: {#error-info-estab-sub}
  Target:        Return hints in yang-data structure
  -------------- ---------------------------------------------
  event stream   establish-subscription-stream-error-info
  datastore      establish-subscription-datastore-error-info

  : [Table 4](#table-4){.selfRef}: [Optional \"error-info\" Node Hints
  for an \"establish-subscription\"
  Request](#name-optional-error-info-node-hi){.selfRef}
:::

[]{#name-optional-error-info-node-hin}

::: {#error-info-mod-sub}
  Target:        Returns hints in yang-data structure
  -------------- ------------------------------------------
  event stream   modify-subscription-stream-error-info
  datastore      modify-subscription-datastore-error-info

  : [Table 5](#table-5){.selfRef}: [Optional \"error-info\" Node Hints
  for an \"modify-subscription\"
  Request](#name-optional-error-info-node-hin){.selfRef}
:::

The yang-data included within \"error-info\" [SHOULD NOT]{.bcp14}
include the optional leaf \"reason\", as such a leaf would be redundant
with information that is already placed within the
\"error-app-tag\".[¶](#section-3.3-12){.pilcrow}

In case of an \<rpc-error> as a result of a \"delete-subscription\", a
\"kill-subscription\", or a \"resync-subscription\" request, no
\"error-info\" needs to be included, as the \"subscription-id\" is the
only RPC input parameter, and no hints regarding this RPC input
parameters need to be provided.[¶](#section-3.3-13){.pilcrow}

Note that \"error-path\" \[[RFC8040](#RFC8040){.xref}\] does not need to
be included with the \<rpc-error> element, as subscription errors are
generally associated with the choice of RPC input
parameters.[¶](#section-3.3-14){.pilcrow}
:::

::: {#SSE}
::: {#section-3.4 .section}
### [3.4.](#section-3.4){.section-number .selfRef} [Call Flow for Server-Sent Events](#name-call-flow-for-server-sent-e){.section-name .selfRef} {#name-call-flow-for-server-sent-e}

The call flow for Server-Sent Events (SSE) is defined in [Figure
1](#dyn-sse){.xref}. The logical connections denoted by (a) and (b) can
be a TCP connection or an HTTP/2 stream (if HTTP/2 is used, multiple
HTTP/2 streams can be carried in one TCP connection). Requests to RPCs
as defined in \[[RFC8639](#RFC8639){.xref}\] or
\[[RFC8641](#RFC8641){.xref}\] are sent on a connection indicated by
(a). A successful \"establish-subscription\" will result in an RPC
response returned with both a subscription identifier that uniquely
identifies a subscription, as well as a URI that uniquely identifies the
location of subscription on the publisher (b). This URI is defined via
the \"uri\" leaf in the data model in [Section
7](#YANG-module){.xref}.[¶](#section-3.4-1){.pilcrow}

An HTTP GET is then sent on a separate logical connection (b) to the URI
on the publisher. This signals the publisher to initiate the flow of
notification messages that are sent in SSE
\[[W3C-20150203](#W3C-20150203){.xref}\] as a response to the GET. There
cannot be two or more simultaneous GET requests on a subscription URI:
any GET request received while there is a current GET request on the
same URI [MUST]{.bcp14} be rejected with HTTP error code
409.[¶](#section-3.4-2){.pilcrow}

As described in [Section
6.4](https://www.rfc-editor.org/rfc/rfc8040#section-6.4){.relref} of
\[[RFC8040](#RFC8040){.xref}\], RESTCONF servers [SHOULD NOT]{.bcp14}
send the \"event\" or \"id\" fields in the SSE event
notifications.[¶](#section-3.4-3){.pilcrow}

[]{#name-dynamic-subscriptions-with-}

::: {#dyn-sse}
::: {#section-3.4-4.1 .artwork .art-text .alignLeft}
    +--------------+                             +--------------+
    |  Subscriber  |                             |   Publisher  |
    |              |                             |              |
    |    Logical   |                             |     Logical  |
    |  Connection  |                             |   Connection |
    |  (a)  (b)    |                             |    (a)  (b)  |
    +--------------+                             +--------------+
        | RESTCONF POST (RPC:establish-subscription)   |
        |--------------------------------------------->|
        |                          HTTP 200 OK (ID,URI)|
        |<---------------------------------------------|
        |    |HTTP GET (URI)                                |
        |    |--------------------------------------------->|
        |    |                                   HTTP 200 OK|
        |    |<---------------------------------------------|
        |    |                           SSE (notif-message)|
        |    |<---------------------------------------------|
        | RESTCONF POST (RPC:modify-subscription)      |    |
        |--------------------------------------------->|    |
        |    |                              HTTP 200 OK|    |
        |<---------------------------------------------|    |
        |    |                   SSE (subscription-modified)|
        |    |<------------------------------------------(c)|
        |    |                           SSE (notif-message)|
        |    |<---------------------------------------------|
        | RESTCONF POST (RPC:delete-subscription)      |    |
        |--------------------------------------------->|    |
        |    |                              HTTP 200 OK|    |
        |<---------------------------------------------|    |
        |    |                                         |    |
        |    |                                         |    |
        (a) (b)                                       (a)  (b) 
:::

[Figure 1](#figure-1){.selfRef}: [Dynamic Subscriptions with Server-Sent
Events](#name-dynamic-subscriptions-with-){.selfRef}
:::

Additional requirements for dynamic subscriptions over SSE
include:[¶](#section-3.4-5){.pilcrow}

-   [A publisher [MUST]{.bcp14} return all subscription state
    notifications in a separate SSE message used by the subscription to
    which the state change
    refers.[¶](#section-3.4-6.1){.pilcrow}]{#section-3.4-6.1}
-   [Subscription RPCs [MUST NOT]{.bcp14} use the connection currently
    providing notification messages for that
    subscription.[¶](#section-3.4-6.2){.pilcrow}]{#section-3.4-6.2}
-   [In addition to an RPC response for a \"modify-subscription\" RPC
    traveling over (a), a \"subscription-modified\" state change
    notification [MUST]{.bcp14} be sent within (b). This allows the
    receiver to know exactly when, within the stream of events, the new
    terms of the subscription have been applied to the notification
    messages. See arrow
    (c).[¶](#section-3.4-6.3){.pilcrow}]{#section-3.4-6.3}
-   [In addition to any required access permissions (e.g., Network
    Configuration Access Control Model (NACM)), the RPCs
    \"modify-subscription\", \"resync-subscription\", and
    \"delete-subscription\" [SHOULD]{.bcp14} only be allowed by the same
    RESTCONF username \[[RFC8040](#RFC8040){.xref}\] that invoked
    \"establish-subscription\". Such a restriction generally serves to
    preserve users\' privacy, but exceptions might be made for
    administrators that may need to modify or delete other users\'
    subscriptions.[¶](#section-3.4-6.4){.pilcrow}]{#section-3.4-6.4}
-   [The \"kill-subscription\" RPC can be invoked by any RESTCONF
    username with the required administrative
    permissions.[¶](#section-3.4-6.5){.pilcrow}]{#section-3.4-6.5}

A publisher [MUST]{.bcp14} terminate a subscription in the following
cases:[¶](#section-3.4-7){.pilcrow}

-   [Receipt of a \"delete-subscription\" or a \"kill-subscription\" RPC
    for that
    subscription[¶](#section-3.4-8.1){.pilcrow}]{#section-3.4-8.1}
-   [Loss of TLS
    heartbeat[¶](#section-3.4-8.2){.pilcrow}]{#section-3.4-8.2}

A publisher [MAY]{.bcp14} terminate a subscription at any time as stated
in [Section
1.3](https://www.rfc-editor.org/rfc/rfc8639#section-1.3){.relref} of
\[[RFC8639](#RFC8639){.xref}\].[¶](#section-3.4-9){.pilcrow}
:::
:::
:::
:::

::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [QoS Treatment](#name-qos-treatment){.section-name .selfRef} {#name-qos-treatment}

Qos treatment for event streams is described in [Section
2.3](https://www.rfc-editor.org/rfc/rfc8639#section-2.3){.relref} of
\[[RFC8639](#RFC8639){.xref}\]. In addition, if HTTP/2 is used, the
publisher [MUST]{.bcp14}:[¶](#section-4-1){.pilcrow}

-   [Take the \"weighting\" leaf node in \[[RFC8639](#RFC8639){.xref}\]
    and copy it into the HTTP/2 stream weight, [Section
    5.3](https://www.rfc-editor.org/rfc/rfc7540#section-5.3){.relref} of
    \[[RFC7540](#RFC7540){.xref}\],
    and[¶](#section-4-2.1){.pilcrow}]{#section-4-2.1}
-   [Take any existing subscription \"dependency\", as specified by the
    \"dependency\" leaf node in \[[RFC8639](#RFC8639){.xref}\], and use
    the HTTP/2 stream for the parent subscription as the HTTP/2 stream
    dependency (as described in [Section
    5.3.1](https://www.rfc-editor.org/rfc/rfc7540#section-5.3.1){.relref}
    of \[[RFC7540](#RFC7540){.xref}\]) of the dependent
    subscription.[¶](#section-4-2.2){.pilcrow}]{#section-4-2.2}
-   [Set the exclusive flag ([Section
    5.3.1](https://www.rfc-editor.org/rfc/rfc7540#section-5.3.1){.relref}
    of \[[RFC7540](#RFC7540){.xref}\]) to
    0.[¶](#section-4-2.3){.pilcrow}]{#section-4-2.3}

For dynamic subscriptions with the same Differentiated Services Code
Point (DSCP) value to a specific publisher, it is recommended that the
subscriber sends all URI GET requests on a common HTTP/2 session (if
HTTP/2 is used). Conversely, a subscriber cannot use a common HTTP/2
session for subscriptions with different DSCP
values.[¶](#section-4-3){.pilcrow}
:::

::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Notification Messages](#name-notification-messages){.section-name .selfRef} {#name-notification-messages}

Notification messages transported over RESTCONF will be encoded
according to \[[RFC8040](#RFC8040){.xref}\], [Section
6.4](https://www.rfc-editor.org/rfc/rfc8040#section-6.4){.relref}.[¶](#section-5-1){.pilcrow}
:::

::: {#YANG-tree}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [YANG Tree](#name-yang-tree){.section-name .selfRef} {#name-yang-tree}

The YANG module defined in [Section 7](#YANG-module){.xref} has one leaf
that augments three nodes of
\[[RFC8639](#RFC8639){.xref}\].[¶](#section-6-1){.pilcrow}

::: {#section-6-2}
``` {.sourcecode .lang-yangtree}
module: ietf-restconf-subscribed-notifications
  augment /sn:establish-subscription/sn:output:
    +--ro uri?   inet:uri
  augment /sn:subscriptions/sn:subscription:
    +--ro uri?   inet:uri
  augment /sn:subscription-modified:
    +--ro uri?   inet:uri 
```

[¶](#section-6-2){.pilcrow}
:::
:::
:::

::: {#YANG-module}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [YANG Module](#name-yang-module){.section-name .selfRef} {#name-yang-module}

This module references
\[[RFC8639](#RFC8639){.xref}\].[¶](#section-7-1){.pilcrow}

::: {#section-7-2}
``` {.sourcecode .lang-yang}
<CODE BEGINS> file "ietf-restconf-subscribed-notifications@2019-11-17.yang"

module ietf-restconf-subscribed-notifications {
  yang-version 1.1;
  namespace "urn:ietf:params:xml:ns:yang:"
          + "ietf-restconf-subscribed-notifications";
  prefix rsn;

  import ietf-subscribed-notifications {
    prefix sn;
  }
  import ietf-inet-types {
    prefix inet;
  }

  organization
    "IETF NETCONF (Network Configuration) Working Group";
  contact
    "WG Web:   <https://datatracker.ietf.org/wg/netconf/>
     WG List:  <mailto:netconf@ietf.org>

     Editor:   Eric Voit
               <mailto:evoit@cisco.com>

     Editor:   Alexander Clemm
               <mailto:ludwig@clemm.org>

     Editor:   Reshad Rahman
               <mailto:rrahman@cisco.com>";
  description
    "Defines RESTCONF as a supported transport for subscribed
     event notifications.

     Copyright (c) 2019 IETF Trust and the persons identified
     as authors of the code.  All rights reserved.

     Redistribution and use in source and binary forms, with or
     without modification, is permitted pursuant to, and subject to
     the license terms contained in, the Simplified BSD License set
     forth in Section 4.c of the IETF Trust's Legal Provisions 
     Relating to IETF Documents
     (https://trustee.ietf.org/license-info). 

     This version of this YANG module is part of RFC 8650; see the
     RFC itself for full legal notices.";

  revision 2019-11-17 {
    description
      "Initial version";
    reference
      "RFC 8650: Dynamic Subscription to YANG Events and Datastores
       over RESTCONF";
  }

  grouping uri {
    description
      "Provides a reusable description of a URI.";
    leaf uri {
      type inet:uri;
      config false;
      description
        "Location of a subscription-specific URI on the publisher.";
    }
  }

  augment "/sn:establish-subscription/sn:output" {
    description
      "This augmentation allows RESTCONF-specific parameters for a
       response to a publisher's subscription request.";
    uses uri;
  }

  augment "/sn:subscriptions/sn:subscription" {
    description
      "This augmentation allows RESTCONF-specific parameters to be
       exposed for a subscription.";
    uses uri;
  }

  augment "/sn:subscription-modified" {
    description
      "This augmentation allows RESTCONF-specific parameters to be
       included as part of the notification that a subscription has
       been modified.";
    uses uri;
  }
}

<CODE ENDS>
```

[¶](#section-7-2){.pilcrow}
:::
:::
:::

::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document registers the following namespace URI in the \"ns\"
subregistry of the \"IETF XML Registry\"
\[[RFC3688](#RFC3688){.xref}\]:[¶](#section-8-1){.pilcrow}

URI:
:   urn:ietf:params:xml:ns:yang:ietf-restconf-subscribed-notifications[¶](#section-8-2.2){.pilcrow}

Registrant Contact:
:   The IESG.[¶](#section-8-2.4){.pilcrow}

XML:
:   N/A; the requested URI is an XML
    namespace.[¶](#section-8-2.6){.pilcrow}

This document registers the following YANG module in the \"YANG Module
Names\" registry
\[[RFC6020](#RFC6020){.xref}\]:[¶](#section-8-3){.pilcrow}

Name:
:   ietf-restconf-subscribed-notifications[¶](#section-8-4.2){.pilcrow}

Namespace:
:   urn:ietf:params:xml:ns:yang:ietf-restconf-subscribed-notifications[¶](#section-8-4.4){.pilcrow}

Prefix:
:   rsn[¶](#section-8-4.6){.pilcrow}

Reference:
:   RFC 8650[¶](#section-8-4.8){.pilcrow}
:::

::: {#security}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

The YANG module specified in this document defines a schema for data
that is designed to be accessed via network management transports such
as NETCONF \[[RFC6241](#RFC6241){.xref}\] or RESTCONF
\[[RFC8040](#RFC8040){.xref}\]. The lowest NETCONF layer is the secure
transport layer, and the mandatory-to-implement secure transport is
Secure Shell (SSH) \[[RFC6242](#RFC6242){.xref}\]. The lowest RESTCONF
layer is HTTPS, and the mandatory-to-implement secure transport is TLS
\[[RFC8446](#RFC8446){.xref}\].[¶](#section-9-1){.pilcrow}

The Network Configuration Access Control Model (NACM)
\[[RFC8341](#RFC8341){.xref}\] provides the means to restrict access for
particular NETCONF or RESTCONF users to a preconfigured subset of all
available NETCONF or RESTCONF protocol operations and
content.[¶](#section-9-2){.pilcrow}

The one new data node introduced in this YANG module may be considered
sensitive or vulnerable in some network environments. It is thus
important to control read access (e.g., via get, get-config, or
notification) to this data node. These are the subtrees and data nodes
and their sensitivity/vulnerability:[¶](#section-9-3){.pilcrow}

Container: \"/subscriptions\"[¶](#section-9-4){.pilcrow}

-   [\"uri\": leaf will show where subscribed resources might be located
    on a publisher. Access control must be set so that only someone with
    proper access permissions, i.e., the same RESTCONF
    \[[RFC8040](#RFC8040){.xref}\] user credentials that invoked the
    corresponding \"establish-subscription\", has the ability to access
    this resource.[¶](#section-9-5.1){.pilcrow}]{#section-9-5.1}

The subscription URI is implementation specific and is encrypted via the
use of TLS. Therefore, even if an attacker succeeds in guessing the
subscription URI, a RESTCONF username \[[RFC8040](#RFC8040){.xref}\]
with the required administrative permissions must be used to be able to
access or modify that subscription. It is recommended that the
subscription URI values not be easily
predictable.[¶](#section-9-6){.pilcrow}

The access permission considerations for the RPCs
\"modify-subscription\", \"resync-subscription\",
\"delete-subscription\", and \"kill-subscription\" are described in
[Section 3.4](#SSE){.xref}.[¶](#section-9-7){.pilcrow}

If a buggy or compromised RESTCONF subscriber sends a number of
\"establish-subscription\" requests, then these subscriptions accumulate
and may use up system resources. In such a situation, the publisher
[MAY]{.bcp14} also suspend or terminate a subset of the active
subscriptions from that RESTCONF subscriber in order to reclaim
resources and preserve normal operation for the other
subscriptions.[¶](#section-9-8){.pilcrow}
:::
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.

\[RFC3688\]
:   [Mealling, M.]{.refAuthor}, [\"The IETF XML Registry\"]{.refTitle},
    [BCP 81]{.seriesInfo}, [RFC 3688]{.seriesInfo}, [DOI
    10.17487/RFC3688]{.seriesInfo}, January 2004,
    \<<https://www.rfc-editor.org/info/rfc3688>\>.

\[RFC6020\]
:   [Bjorklund, M., Ed.]{.refAuthor}, [\"YANG - A Data Modeling Language
    for the Network Configuration Protocol (NETCONF)\"]{.refTitle}, [RFC
    6020]{.seriesInfo}, [DOI 10.17487/RFC6020]{.seriesInfo}, October
    2010, \<<https://www.rfc-editor.org/info/rfc6020>\>.

\[RFC6241\]
:   [Enns, R., Ed.]{.refAuthor}[, Bjorklund, M., Ed.]{.refAuthor}[,
    Schoenwaelder, J., Ed.]{.refAuthor}[, and A. Bierman,
    Ed.]{.refAuthor}, [\"Network Configuration Protocol
    (NETCONF)\"]{.refTitle}, [RFC 6241]{.seriesInfo}, [DOI
    10.17487/RFC6241]{.seriesInfo}, June 2011,
    \<<https://www.rfc-editor.org/info/rfc6241>\>.

\[RFC6242\]
:   [Wasserman, M.]{.refAuthor}, [\"Using the NETCONF Protocol over
    Secure Shell (SSH)\"]{.refTitle}, [RFC 6242]{.seriesInfo}, [DOI
    10.17487/RFC6242]{.seriesInfo}, June 2011,
    \<<https://www.rfc-editor.org/info/rfc6242>\>.

\[RFC6520\]
:   [Seggelmann, R.]{.refAuthor}[, Tuexen, M.]{.refAuthor}[, and M.
    Williams]{.refAuthor}, [\"Transport Layer Security (TLS) and
    Datagram Transport Layer Security (DTLS) Heartbeat
    Extension\"]{.refTitle}, [RFC 6520]{.seriesInfo}, [DOI
    10.17487/RFC6520]{.seriesInfo}, February 2012,
    \<<https://www.rfc-editor.org/info/rfc6520>\>.

\[RFC7540\]
:   [Belshe, M.]{.refAuthor}[, Peon, R.]{.refAuthor}[, and M. Thomson,
    Ed.]{.refAuthor}, [\"Hypertext Transfer Protocol Version 2
    (HTTP/2)\"]{.refTitle}, [RFC 7540]{.seriesInfo}, [DOI
    10.17487/RFC7540]{.seriesInfo}, May 2015,
    \<<https://www.rfc-editor.org/info/rfc7540>\>.

\[RFC8040\]
:   [Bierman, A.]{.refAuthor}[, Bjorklund, M.]{.refAuthor}[, and K.
    Watsen]{.refAuthor}, [\"RESTCONF Protocol\"]{.refTitle}, [RFC
    8040]{.seriesInfo}, [DOI 10.17487/RFC8040]{.seriesInfo}, January
    2017, \<<https://www.rfc-editor.org/info/rfc8040>\>.

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.

\[RFC8341\]
:   [Bierman, A.]{.refAuthor}[ and M. Bjorklund]{.refAuthor}, [\"Network
    Configuration Access Control Model\"]{.refTitle}, [STD
    91]{.seriesInfo}, [RFC 8341]{.seriesInfo}, [DOI
    10.17487/RFC8341]{.seriesInfo}, March 2018,
    \<<https://www.rfc-editor.org/info/rfc8341>\>.

\[RFC8342\]
:   [Bjorklund, M.]{.refAuthor}[, Schoenwaelder, J.]{.refAuthor}[,
    Shafer, P.]{.refAuthor}[, Watsen, K.]{.refAuthor}[, and R.
    Wilton]{.refAuthor}, [\"Network Management Datastore Architecture
    (NMDA)\"]{.refTitle}, [RFC 8342]{.seriesInfo}, [DOI
    10.17487/RFC8342]{.seriesInfo}, March 2018,
    \<<https://www.rfc-editor.org/info/rfc8342>\>.

\[RFC8446\]
:   [Rescorla, E.]{.refAuthor}, [\"The Transport Layer Security (TLS)
    Protocol Version 1.3\"]{.refTitle}, [RFC 8446]{.seriesInfo}, [DOI
    10.17487/RFC8446]{.seriesInfo}, August 2018,
    \<<https://www.rfc-editor.org/info/rfc8446>\>.

\[RFC8639\]
:   [Voit, E.]{.refAuthor}[, Clemm, A.]{.refAuthor}[, Gonzalez
    Prieto, A.]{.refAuthor}[, Nilsen-Nygaard, E.]{.refAuthor}[, and A.
    Tripathy]{.refAuthor}, [\"Subscription to YANG
    Notifications\"]{.refTitle}, [RFC 8639]{.seriesInfo}, [DOI
    10.17487/RFC8639]{.seriesInfo}, September 2019,
    \<<https://www.rfc-editor.org/info/rfc8639>\>.

\[RFC8641\]
:   [Clemm, A.]{.refAuthor}[ and E. Voit]{.refAuthor}, [\"Subscription
    to YANG Notifications for Datastore Updates\"]{.refTitle}, [RFC
    8641]{.seriesInfo}, [DOI 10.17487/RFC8641]{.seriesInfo}, September
    2019, \<<https://www.rfc-editor.org/info/rfc8641>\>.

\[W3C-20150203\]
:   [Hickson, I.]{.refAuthor}, [\"Server-Sent Events\"]{.refTitle}, [W3C
    Recommendation]{.seriesInfo}, 3 February 2015,
    \<<https://www.w3.org/TR/2015/REC-eventsource-20150203/>\>. [Latest
    version available at
    \<<https://www.w3.org/TR/eventsource/>\>.]{.annotation}
:::

::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC7231\]
:   [Fielding, R., Ed.]{.refAuthor}[ and J. Reschke, Ed.]{.refAuthor},
    [\"Hypertext Transfer Protocol (HTTP/1.1): Semantics and
    Content\"]{.refTitle}, [RFC 7231]{.seriesInfo}, [DOI
    10.17487/RFC7231]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7231>\>.

\[RFC7923\]
:   [Voit, E.]{.refAuthor}[, Clemm, A.]{.refAuthor}[, and A. Gonzalez
    Prieto]{.refAuthor}, [\"Requirements for Subscription to YANG
    Datastores\"]{.refTitle}, [RFC 7923]{.seriesInfo}, [DOI
    10.17487/RFC7923]{.seriesInfo}, June 2016,
    \<<https://www.rfc-editor.org/info/rfc7923>\>.

\[RFC7951\]
:   [Lhotka, L.]{.refAuthor}, [\"JSON Encoding of Data Modeled with
    YANG\"]{.refTitle}, [RFC 7951]{.seriesInfo}, [DOI
    10.17487/RFC7951]{.seriesInfo}, August 2016,
    \<<https://www.rfc-editor.org/info/rfc7951>\>.

\[RFC8347\]
:   [Liu, X., Ed.]{.refAuthor}[, Kyparlis, A.]{.refAuthor}[,
    Parikh, R.]{.refAuthor}[, Lindem, A.]{.refAuthor}[, and M.
    Zhang]{.refAuthor}, [\"A YANG Data Model for the Virtual Router
    Redundancy Protocol (VRRP)\"]{.refTitle}, [RFC 8347]{.seriesInfo},
    [DOI 10.17487/RFC8347]{.seriesInfo}, March 2018,
    \<<https://www.rfc-editor.org/info/rfc8347>\>.

\[RFC8527\]
:   [Bjorklund, M.]{.refAuthor}[, Schoenwaelder, J.]{.refAuthor}[,
    Shafer, P.]{.refAuthor}[, Watsen, K.]{.refAuthor}[, and R.
    Wilton]{.refAuthor}, [\"RESTCONF Extensions to Support the Network
    Management Datastore Architecture\"]{.refTitle}, [RFC
    8527]{.seriesInfo}, [DOI 10.17487/RFC8527]{.seriesInfo}, March 2019,
    \<<https://www.rfc-editor.org/info/rfc8527>\>.

\[RFC8640\]
:   [Voit, E.]{.refAuthor}[, Clemm, A.]{.refAuthor}[, Gonzalez
    Prieto, A.]{.refAuthor}[, Nilsen-Nygaard, E.]{.refAuthor}[, and A.
    Tripathy]{.refAuthor}, [\"Dynamic Subscription to YANG Events and
    Datastores over NETCONF\"]{.refTitle}, [RFC 8640]{.seriesInfo}, [DOI
    10.17487/RFC8640]{.seriesInfo}, September 2019,
    \<<https://www.rfc-editor.org/info/rfc8640>\>.

\[XPATH\]
:   [Clark, J.]{.refAuthor}[ and S. DeRose]{.refAuthor}, [\"XML Path
    Language (XPath) Version 1.0\"]{.refTitle}, [W3C
    Recommendation]{.seriesInfo}, 16 November 1999,
    \<[http://www.w3.org/TR/1999/REC-xpath-19991116](https://www.w3.org/TR/1999/REC-xpath-19991116)\>.
    [Latest version available at
    \<<https://www.w3.org/TR/xpath/>\>.]{.annotation}
:::
:::

::: {#section-appendix.a .section}
## [Appendix A.](#section-appendix.a){.section-number .selfRef} [Examples](#name-examples){.section-name .selfRef} {#name-examples}

This section is non-normative. To allow easy comparison, this section
mirrors the functional examples shown with NETCONF over XML within
\[[RFC8640](#RFC8640){.xref}\]. In addition, HTTP/2 vs HTTP/1.1 headers
are not shown as the contents of the JSON encoded objects are identical
within.[¶](#section-appendix.a-1){.pilcrow}

The subscription URI values used in the examples in this section are
purely illustrative, and are not indicative of the expected usage that
is described in [Section
9](#security){.xref}.[¶](#section-appendix.a-2){.pilcrow}

The DSCP values are only for example purposes and are all indicated in
decimal since the encoding is JSON
\[[RFC7951](#RFC7951){.xref}\].[¶](#section-appendix.a-3){.pilcrow}

::: {#section-a.1 .section}
## [A.1.](#section-a.1){.section-number .selfRef} [Dynamic Subscriptions](#name-dynamic-subscriptions-2){.section-name .selfRef} {#name-dynamic-subscriptions-2}

::: {#section-a.1.1 .section}
### [A.1.1.](#section-a.1.1){.section-number .selfRef} [Establishing Dynamic Subscriptions](#name-establishing-dynamic-subscr){.section-name .selfRef} {#name-establishing-dynamic-subscr}

The following figure shows two successful \"establish-subscription\" RPC
requests as per \[[RFC8639](#RFC8639){.xref}\]. The first request is
given a subscription identifier of 22, and the second, an identifier of
23.[¶](#section-a.1.1-1){.pilcrow}

[]{#name-multiple-subscriptions-over}

::: {#mess-flow-establishment}
::: {#section-a.1.1-2.1 .artwork .art-text .alignLeft}
       +------------+                  +-----------+
       | Subscriber |                  | Publisher |
       +------------+                  +-----------+
             |                               |
             |establish-subscription         |
             |------------------------------>|  (a)
             |     HTTP 200 OK, id#22, URI#1 |
             |<------------------------------|  (b)
             |GET (URI#1)                    |
             |------------------------------>|  (c)
             | HTTP 200 OK,notif-mesg (id#22)|
             |<------------------------------|
             |                               |
             |                               |
             |establish-subscription         |
             |------------------------------>|
             |      HTTP 200 OK, id#23, URI#2|
             |<------------------------------|
             |GET (URI#2)                    |
             |------------------------------>|
             |                               |
             |                               |
             |             notif-mesg (id#22)|
             |<------------------------------|
             | HTTP 200 OK,notif-mesg (id#23)|
             |<------------------------------|
             |                               | 
:::

[Figure 2](#figure-2){.selfRef}: [Multiple Subscriptions over
RESTCONF/HTTP](#name-multiple-subscriptions-over){.selfRef}
:::

To provide examples of the information being transported, example
messages for interactions in [Figure 2](#mess-flow-establishment){.xref}
are detailed below:[¶](#section-a.1.1-3){.pilcrow}

[]{#name-establish-subscription-requ}

::: {#establish-subs}
::: {#section-a.1.1-4.1 .artwork .art-text .alignLeft}
    POST /restconf/operations
         /ietf-subscribed-notifications:establish-subscription

    {
       "ietf-subscribed-notifications:input": {
          "stream-xpath-filter": "/example-module:foo/",
          "stream": "NETCONF",
          "dscp": 10
       }
    } 
:::

[Figure 3](#figure-3){.selfRef}: [\"establish-subscription\" Request
(a)](#name-establish-subscription-requ){.selfRef}
:::

As the publisher was able to fully satisfy the request, the publisher
sends the subscription identifier of the accepted subscription and the
URI:[¶](#section-a.1.1-5){.pilcrow}

[]{#name-establish-subscription-succ}

::: {#positive-establish-subs}
::: {#section-a.1.1-6.1 .artwork .art-text .alignLeft}
    HTTP status code - 200

    {
       "id": 22,
       "uri": "https://example.com/restconf/subscriptions/22"
    } 
:::

[Figure 4](#figure-4){.selfRef}: [\"establish-subscription\" Success
(b)](#name-establish-subscription-succ){.selfRef}
:::

Upon receipt of the successful response, the subscriber does a GET to
the provided URI to start the flow of notification messages. When the
publisher receives this, the subscription is moved to the active state
(c).[¶](#section-a.1.1-7){.pilcrow}

[]{#name-establish-subscription-subs}

::: {#positive-establish-post}
::: {#section-a.1.1-8.1 .artwork .art-text .alignLeft}
    GET /restconf/subscriptions/22 
:::

[Figure 5](#figure-5){.selfRef}: [\"establish-subscription\" Subsequent
POST](#name-establish-subscription-subs){.selfRef}
:::

While not shown in [Figure 2](#mess-flow-establishment){.xref}, if the
publisher had not been able to fully satisfy the request, or the
subscriber has no authorization to establish the subscription, the
publisher would have sent an RPC error response. For instance, if the
\"dscp\" value of 10 asserted by the subscriber in [Figure
3](#establish-subs){.xref} proved unacceptable, the publisher may have
returned:[¶](#section-a.1.1-9){.pilcrow}

[]{#name-an-unsuccessful-establish-s}

::: {#negative-establish-subs}
::: {#section-a.1.1-10.1 .artwork .art-text .alignLeft}
    HTTP status code - 400

    { "ietf-restconf:errors" : {
        "error" : [
          {
            "error-type": "application",
            "error-tag": "invalid-value",
            "error-severity": "error",
            "error-app-tag":
                "ietf-subscribed-notifications:dscp-unavailable"
          }
        ]
      }
    } 
:::

[Figure 6](#figure-6){.selfRef}: [An Unsuccessful
\"establish-subscription\"](#name-an-unsuccessful-establish-s){.selfRef}
:::

The subscriber can use this information in future attempts to establish
a subscription.[¶](#section-a.1.1-11){.pilcrow}
:::

::: {#section-a.1.2 .section}
### [A.1.2.](#section-a.1.2){.section-number .selfRef} [Modifying Dynamic Subscriptions](#name-modifying-dynamic-subscript){.section-name .selfRef} {#name-modifying-dynamic-subscript}

An existing subscription may be modified. The following exchange shows a
negotiation of such a modification via several exchanges between a
subscriber and a publisher. This negotiation consists of a failed RPC
modification request/response followed by a successful
one.[¶](#section-a.1.2-1){.pilcrow}

[]{#name-interaction-model-for-succe}

::: {#mess-flow-subs-modification}
::: {#section-a.1.2-2.1 .artwork .art-text .alignLeft}
       +------------+                 +-----------+
       | Subscriber |                 | Publisher |
       +------------+                 +-----------+
             |                              |
             |  notification message (id#23)|
             |<-----------------------------|
             |                              |
             |modify-subscription (id#23)   |
             |----------------------------->|  (d)
             |    HTTP 400 error (with hint)|
             |<-----------------------------|  (e)
             |                              |
             |modify-subscription (id#23)   |
             |----------------------------->|
             |                  HTTP 200 OK |
             |<-----------------------------|
             |                              |
             |            notif-mesg (id#23)|
             |<-----------------------------|
             |                              | 
:::

[Figure 7](#figure-7){.selfRef}: [Interaction Model for Successful
Subscription Modification](#name-interaction-model-for-succe){.selfRef}
:::

If the subscription being modified in [Figure
7](#mess-flow-subs-modification){.xref} is a datastore subscription as
per \[[RFC8641](#RFC8641){.xref}\], the modification request made in (d)
may look like that shown in [Figure 8](#simple-modify-subs){.xref}. As
can be seen, the modifications being attempted are the application of a
new XML Path Language (XPath) filter as well as the setting of a new
periodic time interval.[¶](#section-a.1.2-3){.pilcrow}

[]{#name-subscription-modification-r}

::: {#simple-modify-subs}
::: {#section-a.1.2-4.1 .artwork .art-text .alignLeft}
    POST /restconf/operations
         /ietf-subscribed-notifications:modify-subscription

    {
     "ietf-subscribed-notifications:input": {
        "id": 23,
        "ietf-yang-push:datastore-xpath-filter": 
           "/example-module:foo/example-module:bar",
        "ietf-yang-push:periodic": {
           "ietf-yang-push:period": 500
        }
      }
    } 
:::

[Figure 8](#figure-8){.selfRef}: [Subscription Modification Request
(c)](#name-subscription-modification-r){.selfRef}
:::

If the publisher can satisfy both changes, the publisher sends a
positive result for the RPC. If the publisher cannot satisfy either of
the proposed changes, the publisher sends an RPC error response (e). The
following is an example RPC error response for (e) that includes a hint.
This hint is an alternative time period value that might have resulted
in a successful modification:[¶](#section-a.1.2-5){.pilcrow}

[]{#name-modify-subscription-failure}

::: {#negative-modify-subs}
::: {#section-a.1.2-6.1 .artwork .art-text .alignLeft}
    HTTP status code - 400

    { "ietf-restconf:errors" : {
        "error" : [
          "error-type": "application",
          "error-tag": "invalid-value",
          "error-severity": "error",
          "error-app-tag": "ietf-yang-push:period-unsupported",
          "error-info": {
            "ietf-yang-push":
            "modify-subscription-datastore-error-info": {
               "period-hint": 3000
            }
          }
        ]
      }
    } 
:::

[Figure 9](#figure-9){.selfRef}: [\"modify-subscription\" Failure with
Hint (e)](#name-modify-subscription-failure){.selfRef}
:::
:::

::: {#section-a.1.3 .section}
### [A.1.3.](#section-a.1.3){.section-number .selfRef} [Deleting Dynamic Subscriptions](#name-deleting-dynamic-subscripti){.section-name .selfRef} {#name-deleting-dynamic-subscripti}

The following demonstrates deleting a subscription. This subscription
may have been to either a stream or a
datastore.[¶](#section-a.1.3-1){.pilcrow}

[]{#name-delete-subscription-request}

::: {#simple-delete-subs}
::: {#section-a.1.3-2.1 .artwork .art-text .alignLeft}
    POST /restconf/operations
         /ietf-subscribed-notifications:delete-subscription

    {
     "delete-subscription": {
        "id": "22"
     }
    } 
:::

[Figure 10](#figure-10){.selfRef}: [\"delete-subscription\"
Request](#name-delete-subscription-request){.selfRef}
:::

If the publisher can satisfy the request, the publisher replies with
success to the RPC request.[¶](#section-a.1.3-3){.pilcrow}

If the publisher cannot satisfy the request, the publisher sends an
\<rpc-error> element indicating the modification didn\'t work. [Figure
11](#negative-delete-subs){.xref} shows a valid response for an existing
valid subscription identifier, but that subscription identifier was
created on a different transport session:[¶](#section-a.1.3-4){.pilcrow}

[]{#name-unsuccessful-delete-subscri}

::: {#negative-delete-subs}
::: {#section-a.1.3-5.1 .artwork .art-text .alignLeft}
    HTTP status code - 404

    {
      "ietf-restconf:errors" : {
        "error" : [
          "error-type": "application",
          "error-tag": "invalid-value",
          "error-severity": "error",
          "error-app-tag":
             "ietf-subscribed-notifications:no-such-subscription"
        ]
      }
    } 
:::

[Figure 11](#figure-11){.selfRef}: [Unsuccessful
\"delete-subscription\"](#name-unsuccessful-delete-subscri){.selfRef}
:::
:::
:::

::: {#section-a.2 .section}
## [A.2.](#section-a.2){.section-number .selfRef} [Subscription State Notifications](#name-subscription-state-notifica){.section-name .selfRef} {#name-subscription-state-notifica}

A publisher will send subscription state notifications according to the
definitions within
\[[RFC8639](#RFC8639){.xref}\].[¶](#section-a.2-1){.pilcrow}

::: {#section-a.2.1 .section}
### [A.2.1.](#section-a.2.1){.section-number .selfRef} [\"subscription-modified\"](#name-subscription-modified){.section-name .selfRef} {#name-subscription-modified}

A \"subscription-modified\" encoded in JSON would look
like:[¶](#section-a.2.1-1){.pilcrow}

[]{#name-subscription-modified-subsc}

::: {#subscription-modified-ctrl-plane-notif}
::: {#section-a.2.1-2.1}
``` {.sourcecode .lang-json}
{
  "ietf-restconf:notification" : {
    "eventTime": "2007-09-01T10:00:00Z",
    "ietf-subscribed-notifications:subscription-modified": {
      "id": 39,
      "uri": "https://example.com/restconf/subscriptions/22"
      "stream-xpath-filter": "/example-module:foo",
      "stream": {
         "ietf-netconf-subscribed-notifications" : "NETCONF"
      }
    }
  }
} 
```

[¶](#section-a.2.1-2.1){.pilcrow}
:::

[Figure 12](#figure-12){.selfRef}: [\"subscription-modified\"
Subscription State
Notification](#name-subscription-modified-subsc){.selfRef}
:::
:::

::: {#section-a.2.2 .section}
### [A.2.2.](#section-a.2.2){.section-number .selfRef} [\"subscription-completed\", \"subscription-resumed\", and \"replay-completed\"](#name-subscription-completed-subs){.section-name .selfRef} {#name-subscription-completed-subs}

A \"subscription-completed\" notification would look
like:[¶](#section-a.2.2-1){.pilcrow}

[]{#name-subscription-completed-noti}

::: {#subscription-completed}
::: {#section-a.2.2-2.1}
``` {.sourcecode .lang-json}
{
  "ietf-restconf:notification" : {
    "eventTime": "2007-09-01T10:00:00Z",
    "ietf-subscribed-notifications:subscription-completed": {
      "id": 39,
    }
  }
} 
```

[¶](#section-a.2.2-2.1){.pilcrow}
:::

[Figure 13](#figure-13){.selfRef}: [\"subscription-completed\"
Notification in JSON](#name-subscription-completed-noti){.selfRef}
:::

The \"subscription-resumed\" and \"replay-complete\" are virtually
identical, with \"subscription-completed\" simply being replaced by
\"subscription-resumed\" and
\"replay-complete\".[¶](#section-a.2.2-3){.pilcrow}
:::

::: {#section-a.2.3 .section}
### [A.2.3.](#section-a.2.3){.section-number .selfRef} [\"subscription-terminated\" and \"subscription-suspended\"](#name-subscription-terminated-and){.section-name .selfRef} {#name-subscription-terminated-and}

A \"subscription-terminated\" would look
like:[¶](#section-a.2.3-1){.pilcrow}

[]{#name-subscription-terminated-sub}

::: {#subscription-terminated}
::: {#section-a.2.3-2.1}
``` {.sourcecode .lang-json}
{
  "ietf-restconf:notification" : {
    "eventTime": "2007-09-01T10:00:00Z",
    "ietf-subscribed-notifications:subscription-terminated": {
      "id": 39,
      "error-id": "suspension-timeout"
    }
  }
} 
```

[¶](#section-a.2.3-2.1){.pilcrow}
:::

[Figure 14](#figure-14){.selfRef}: [\"subscription-terminated\"
Subscription State
Notification](#name-subscription-terminated-sub){.selfRef}
:::

The \"subscription-suspended\" is virtually identical, with
\"subscription-terminated\" simply being replaced by
\"subscription-suspended\".[¶](#section-a.2.3-3){.pilcrow}
:::
:::

::: {#section-a.3 .section}
## [A.3.](#section-a.3){.section-number .selfRef} [Filter Example](#name-filter-example){.section-name .selfRef} {#name-filter-example}

This section provides an example that illustrates the method of
filtering event record contents. The example is based on the YANG
notification \"vrrp-protocol-error-event\" as defined per the
ietf-vrrp.yang module within \[[RFC8347](#RFC8347){.xref}\]. Event
records based on this specification that are generated by the publisher
might appear as:[¶](#section-a.3-1){.pilcrow}

[]{#name-rfc-8347-vrrp-example-notif}

::: {#VRRP-notification}
::: {#section-a.3-2.1 .artwork .art-text .alignLeft}
    data: {
    data:   "ietf-restconf:notification" : {
    data:     "eventTime" : "2018-09-14T08:22:33.44Z",
    data:     "ietf-vrrp:vrrp-protocol-error-event" : {
    data:       "protocol-error-reason" : "checksum-error"
    data:     }
    data:   }
    data: } 
:::

[Figure 15](#figure-15){.selfRef}: [RFC 8347 (VRRP) - Example
Notification](#name-rfc-8347-vrrp-example-notif){.selfRef}
:::

Suppose a subscriber wanted to establish a subscription that only passes
instances of event records where there is a \"checksum-error\" as part
of a Virtual Router Redundancy Protocol (VRRP) protocol event. Also
assume the publisher places such event records into the NETCONF stream.
To get a continuous series of matching event records, the subscriber
might request the application of an XPath filter against the NETCONF
stream. An \"establish-subscription\" RPC to meet this objective might
be:[¶](#section-a.3-3){.pilcrow}

[]{#name-establishing-a-subscription}

::: {#VRRP-XPATH}
::: {#section-a.3-4.1 .artwork .art-text .alignLeft}
    POST /restconf/operations
         /ietf-subscribed-notifications:establish-subscription
    {
       "ietf-subscribed-notifications:input": {
          "stream": "NETCONF",
          "stream-xpath-filter": 
            "/ietf-vrrp:vrrp-protocol-error-event[
              protocol-error-reason='checksum-error']/",
       }
    } 
:::

[Figure 16](#figure-16){.selfRef}: [Establishing a Subscription Error
Reason via XPath](#name-establishing-a-subscription){.selfRef}
:::

For more examples of XPath filters, see
\[[XPATH](#XPATH){.xref}\].[¶](#section-a.3-5){.pilcrow}

Suppose the \"establish-subscription\" in [Figure
16](#VRRP-XPATH){.xref} was accepted. And suppose later a subscriber
decided they wanted to broaden this subscription cover to all VRRP
protocol events (i.e., not just those with a \"checksum error\"). The
subscriber might attempt to modify the subscription in a way that
replaces the XPath filter with a subtree filter that sends all VRRP
protocol events to a subscriber. Such a \"modify-subscription\" RPC
might look like:[¶](#section-a.3-6){.pilcrow}

[]{#name-example-modify-subscription}

::: {#VRRP-Subtree}
::: {#section-a.3-7.1 .artwork .art-text .alignLeft}
    POST /restconf/operations
         /ietf-subscribed-notifications:modify-subscription
    {
       "ietf-subscribed-notifications:input": {
          "stream": "NETCONF",
          "stream-subtree-filter": {
            "/ietf-vrrp:vrrp-protocol-error-event" : {}
          }
       }
    } 
:::

[Figure 17](#figure-17){.selfRef}: [Example \"modify-subscription\"
RPC](#name-example-modify-subscription){.selfRef}
:::

For more examples of subtree filters, see
\[[RFC6241](#RFC6241){.xref}\], [Section
6.4](https://www.rfc-editor.org/rfc/rfc6241#section-6.4){.relref}.[¶](#section-a.3-8){.pilcrow}
:::
:::

::: {#section-appendix.b .section}
## [Acknowledgments](#name-acknowledgments){.section-name .selfRef} {#name-acknowledgments}

We wish to acknowledge the helpful contributions, comments, and
suggestions that were received from Ambika Prasad Tripathy, Alberto
Gonzalez Prieto, Susan Hares, Tim Jenkins, Balazs Lengyel, Kent Watsen,
Michael Scharf, Guangying Zheng, Martin Bjorklund, Qin Wu, and Robert
Wilton.[¶](#section-appendix.b-1){.pilcrow}
:::

::: {#authors-addresses}
::: {#section-appendix.c .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Eric Voit]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems]{.org}
:::

::: email
Email: <evoit@cisco.com>
:::

::: {.left dir="auto"}
[Reshad Rahman]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems]{.org}
:::

::: email
Email: <rrahman@cisco.com>
:::

::: {.left dir="auto"}
[Einar Nilsen-Nygaard]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems]{.org}
:::

::: email
Email: <einarnn@cisco.com>
:::

::: {.left dir="auto"}
[Alexander Clemm]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Futurewei]{.org}
:::

::: email
Email: <ludwig@clemm.org>
:::

::: {.left dir="auto"}
[Andy Bierman]{.fn .nameRole}
:::

::: {.left dir="auto"}
[YumaWorks]{.org}
:::

::: email
Email: <andy@yumaworks.com>
:::
:::
:::
