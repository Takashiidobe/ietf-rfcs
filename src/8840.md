  RFC 8840       Trickle ICE for SIP   January 2021
  -------------- --------------------- --------------
  Ivov, et al.   Standards Track       \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8840](https://www.rfc-editor.org/rfc/rfc8840){.eref}

Category:
:   Standards Track

Published:
:   January 2021

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    E. Ivov
    :::

    ::: org
    Jitsi
    :::
    :::

    ::: author
    ::: author-name
    T. Stach
    :::

    ::: org
    Unaffiliated
    :::
    :::

    ::: author
    ::: author-name
    E. Marocco
    :::

    ::: org
    Telecom Italia
    :::
    :::

    ::: author
    ::: author-name
    C. Holmberg
    :::

    ::: org
    Ericsson
    :::
    :::
:::

# RFC 8840 {#rfcnum}

# A Session Initiation Protocol (SIP) Usage for Incremental Provisioning of Candidates for the Interactive Connectivity Establishment (Trickle ICE) {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

The Interactive Connectivity Establishment (ICE) protocol describes a
Network Address Translator (NAT) traversal mechanism for UDP-based
multimedia sessions established with the Offer/Answer model. The ICE
extension for Incremental Provisioning of Candidates (Trickle ICE)
defines a mechanism that allows ICE Agents to shorten session
establishment delays by making the candidate gathering and connectivity
checking phases of ICE non-blocking and by executing them in
parallel.[¶](#section-abstract-1){.pilcrow}

This document defines usage semantics for Trickle ICE with the Session
Initiation Protocol (SIP). The document also defines a new SIP Info
Package to support this usage together with the corresponding media
type. Additionally, a new Session Description Protocol (SDP)
\"end-of-candidates\" attribute and a new SIP option tag \"trickle-ice\"
are defined.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8840>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2021 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Terminology](#name-terminology){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Protocol
    Overview](#name-protocol-overview){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}

    -   ::: {#section-toc.1-1.3.2.1}
        [3.1](#section-3.1){.xref}.  [Discovery
        Issues](#name-discovery-issues){.xref}[¶](#section-toc.1-1.3.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.2}
        [3.2](#section-3.2){.xref}.  [Relationship with the Offer/Answer
        Model](#name-relationship-with-the-offer){.xref}[¶](#section-toc.1-1.3.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Incremental Signaling of ICE
    Candidates](#name-incremental-signaling-of-ic){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [Initial Offer/Answer
        Exchange](#name-initial-offer-answer-exchan){.xref}[¶](#section-toc.1-1.4.2.1.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.1.2.1}
            [4.1.1](#section-4.1.1){.xref}.  [Sending the Initial
            Offer](#name-sending-the-initial-offer){.xref}[¶](#section-toc.1-1.4.2.1.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.2}
            [4.1.2](#section-4.1.2){.xref}.  [Receiving the Initial
            Offer](#name-receiving-the-initial-offer){.xref}[¶](#section-toc.1-1.4.2.1.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.3}
            [4.1.3](#section-4.1.3){.xref}.  [Sending the Initial
            Answer](#name-sending-the-initial-answer){.xref}[¶](#section-toc.1-1.4.2.1.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.4}
            [4.1.4](#section-4.1.4){.xref}.  [Receiving the Initial
            Answer](#name-receiving-the-initial-answe){.xref}[¶](#section-toc.1-1.4.2.1.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [Subsequent Offer/Answer
        Exchanges](#name-subsequent-offer-answer-exc){.xref}[¶](#section-toc.1-1.4.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [Establishing the
        Dialog](#name-establishing-the-dialog){.xref}[¶](#section-toc.1-1.4.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.3.2.1}
            [4.3.1](#section-4.3.1){.xref}.  [Establishing Dialog State
            through Reliable Offer/Answer
            Delivery](#name-establishing-dialog-state-t){.xref}[¶](#section-toc.1-1.4.2.3.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.3.2.2}
            [4.3.2](#section-4.3.2){.xref}.  [Establishing Dialog State
            through Unreliable Offer/Answer
            Delivery](#name-establishing-dialog-state-th){.xref}[¶](#section-toc.1-1.4.2.3.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.3.2.3}
            [4.3.3](#section-4.3.3){.xref}.  [Initiating Trickle ICE
            without an SDP
            Answer](#name-initiating-trickle-ice-with){.xref}[¶](#section-toc.1-1.4.2.3.2.3.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.xref}.  [Delivering Candidates in INFO
        Requests](#name-delivering-candidates-in-in){.xref}[¶](#section-toc.1-1.4.2.4.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Initial Discovery of Trickle ICE
    Support](#name-initial-discovery-of-trickl){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [Provisioning Support for Trickle
        ICE](#name-provisioning-support-for-tr){.xref}[¶](#section-toc.1-1.5.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [Trickle ICE Discovery with
        Globally Routable User Agent URIs
        (GRUUs)](#name-trickle-ice-discovery-with-){.xref}[¶](#section-toc.1-1.5.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.xref}.  [Fall Back to Half
        Trickle](#name-fall-back-to-half-trickle){.xref}[¶](#section-toc.1-1.5.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Considerations for RTP and RTCP
    Multiplexing](#name-considerations-for-rtp-and-){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Considerations for Media
    Multiplexing](#name-considerations-for-media-mu){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [SDP \"end-of-candidates\"
    Attribute](#name-sdp-end-of-candidates-attri){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Definition](#name-definition){.xref}[¶](#section-toc.1-1.8.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Offer/Answer
        Procedures](#name-offer-answer-procedures){.xref}[¶](#section-toc.1-1.8.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [Content Type
    \"application/trickle-ice-sdpfrag\"](#name-content-type-application-tr){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [Overall
        Description](#name-overall-description){.xref}[¶](#section-toc.1-1.9.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [Grammar](#name-grammar){.xref}[¶](#section-toc.1-1.9.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [Info
    Package](#name-info-package){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [Rationale \-- Why
        INFO?](#name-rationale-why-info){.xref}[¶](#section-toc.1-1.10.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Overall
        Description](#name-overall-description-2){.xref}[¶](#section-toc.1-1.10.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.3}
        [10.3](#section-10.3){.xref}.  [Applicability](#name-applicability){.xref}[¶](#section-toc.1-1.10.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.4}
        [10.4](#section-10.4){.xref}.  [Info Package
        Name](#name-info-package-name){.xref}[¶](#section-toc.1-1.10.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.5}
        [10.5](#section-10.5){.xref}.  [Info Package
        Parameters](#name-info-package-parameters){.xref}[¶](#section-toc.1-1.10.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.6}
        [10.6](#section-10.6){.xref}.  [SIP Option
        Tags](#name-sip-option-tags){.xref}[¶](#section-toc.1-1.10.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.7}
        [10.7](#section-10.7){.xref}.  [INFO Request Body
        Parts](#name-info-request-body-parts){.xref}[¶](#section-toc.1-1.10.2.7.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.8}
        [10.8](#section-10.8){.xref}.  [Info Package Usage
        Restrictions](#name-info-package-usage-restrict){.xref}[¶](#section-toc.1-1.10.2.8.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.9}
        [10.9](#section-10.9){.xref}.  [Rate of INFO
        Requests](#name-rate-of-info-requests){.xref}[¶](#section-toc.1-1.10.2.9.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.10}
        [10.10](#section-10.10){.xref}. [Info Package Security
        Considerations](#name-info-package-security-consi){.xref}[¶](#section-toc.1-1.10.2.10.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.xref}. [Deployment
    Considerations](#name-deployment-considerations){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.12}
    [12](#section-12){.xref}. [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}

    -   ::: {#section-toc.1-1.12.2.1}
        [12.1](#section-12.1){.xref}.  [SDP \"end-of-candidates\"
        Attribute](#name-sdp-end-of-candidates-attrib){.xref}[¶](#section-toc.1-1.12.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.12.2.2}
        [12.2](#section-12.2){.xref}.  [Media Type
        \"application/trickle-ice-sdpfrag\"](#name-media-type-application-tric){.xref}[¶](#section-toc.1-1.12.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.12.2.3}
        [12.3](#section-12.3){.xref}.  [SIP Info Package
        \"trickle-ice\"](#name-sip-info-package-trickle-ic){.xref}[¶](#section-toc.1-1.12.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.12.2.4}
        [12.4](#section-12.4){.xref}.  [SIP Option Tag
        \"trickle-ice\"](#name-sip-option-tag-trickle-ice){.xref}[¶](#section-toc.1-1.12.2.4.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.13}
    [13](#section-13){.xref}. [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.14}
    [14](#section-14){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.14.1){.pilcrow}

    -   ::: {#section-toc.1-1.14.2.1}
        [14.1](#section-14.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.14.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.14.2.2}
        [14.2](#section-14.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.14.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.15}
    [](#section-appendix.a){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.15.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.16}
    [](#section-appendix.b){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.16.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

The Interactive Connectivity Establishment (ICE) protocol
\[[RFC8445](#RFC8445){.xref}\] describes a mechanism for Network Address
Translator (NAT) traversal that consists of three main
phases.[¶](#section-1-1){.pilcrow}

During the first phase, an agent gathers a set of candidate transport
addresses (source IP, port, and transport protocol). This is followed by
a second phase where these candidates are sent to a remote agent within
the Session Description Protocol (SDP) body of a SIP message. At the
remote agent, the gathering procedure is repeated and candidates are
sent to the first agent. Once the candidate information is available, a
third phase starts in parallel where connectivity between all candidates
in both sets is checked (connectivity checks). Once these phases have
been completed, and only then, both agents can begin
communication.[¶](#section-1-2){.pilcrow}

According to \[[RFC8445](#RFC8445){.xref}\], the three phases above
happen consecutively, in a blocking way, which can introduce undesirable
setup delay during session establishment. The Trickle ICE extension
\[[RFC8838](#RFC8838){.xref}\] defines generic semantics required for
these ICE phases to happen in a parallel, non-blocking way and hence
speeds up session establishment.[¶](#section-1-3){.pilcrow}

This specification defines a usage of Trickle ICE with the Session
Initiation Protocol (SIP)\[[RFC3261](#RFC3261){.xref}\]. It describes
how ICE candidates are to be exchanged incrementally using SIP INFO
requests \[[RFC6086](#RFC6086){.xref}\] and how the Half Trickle and
Full Trickle modes defined in \[[RFC8838](#RFC8838){.xref}\] are to be
used by SIP User Agents (UAs) depending on their expectations for
support of Trickle ICE by a remote agent.[¶](#section-1-4){.pilcrow}

This document defines a new Info Package as specified in
\[[RFC6086](#RFC6086){.xref}\] for use with Trickle ICE together with
the corresponding media type, SDP attribute, and SIP option
tag.[¶](#section-1-5){.pilcrow}
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}

This specification makes use of terminology defined by the ICE protocol
in \[[RFC8445](#RFC8445){.xref}\] and by its Trickle ICE extension in
\[[RFC8838](#RFC8838){.xref}\]. It is assumed that the reader is
familiar with the terminology from both
documents.[¶](#section-2-2){.pilcrow}

\[[RFC8445](#RFC8445){.xref}\] also describes how ICE makes use of the
Session Traversal Utilities for NAT (STUN) protocol
\[[RFC5389](#RFC5389){.xref}\] and its extension Traversal Using Relays
around NAT (TURN)
\[[RFC5766](#RFC5766){.xref}\].[¶](#section-2-3){.pilcrow}
:::

::: {#overview}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Protocol Overview](#name-protocol-overview){.section-name .selfRef} {#name-protocol-overview}

When using ICE for SIP according to \[[RFC8839](#RFC8839){.xref}\], the
ICE candidates are exchanged solely via SDP Offer/Answer as per
\[[RFC3264](#RFC3264){.xref}\]. This specification defines an additional
mechanism where candidates can be exchanged using SIP INFO messages and
a newly defined Info Package \[[RFC6086](#RFC6086){.xref}\]. This also
allows ICE candidates to be sent in parallel to an ongoing Offer/Answer
negotiation and/or after the completion of the Offer/Answer
negotiation.[¶](#section-3-1){.pilcrow}

Typically, in cases where Trickle ICE is fully supported, the Offerer
sends an INVITE request containing a subset of candidates. Once an early
dialog is established, the Offerer can continue sending candidates in
INFO requests within that dialog.[¶](#section-3-2){.pilcrow}

Similarly, an Answerer can send ICE candidates using INFO requests
within the dialog established by its 18x provisional response. [Figure
1](#fig-intro-example){.xref} shows such a sample
exchange:[¶](#section-3-3){.pilcrow}

[]{#name-sample-trickle-ice-scenario}

::: {#fig-intro-example}
::: {#section-3-4.1 .artwork .art-text .alignLeft}
       STUN/TURN                                                STUN/TURN
        Servers          Alice                      Bob          Servers
           |               |                         |                |
           |  STUN Bi.Req. |     INVITE (Offer)      |                |
           |<--------------|------------------------>|                |
           |               |      183 (Answer)       | TURN Alloc Req |
           | STUN Bi.Resp. |<------------------------|--------------->|
           |-------------->|  INFO/OK (SRFLX Cand.)  |                |
           |               |------------------------>| TURN Alloc Resp|
           |               |  INFO/OK (Relay Cand.)  |<---------------|
           |               |<------------------------|                |
           |               |                         |                |
           |               |  More Cands & ConnChecks|                |
           |               |<=======================>|                |
           |               |                         |                |
           |               |          200 OK         |                |
           |               |<------------------------|                |
           |               |            ACK          |                |
           |               |------------------------>|                |
           |               |                         |                |
           |               |<===== MEDIA FLOWS =====>|                |
           |               |                         |                |

           Note: "SRFLX" denotes server-reflexive candidates
:::

[Figure 1](#figure-1){.selfRef}: [Sample Trickle ICE Scenario with
SIP](#name-sample-trickle-ice-scenario){.selfRef}
:::

::: {#disco-issues}
::: {#section-3.1 .section}
### [3.1.](#section-3.1){.section-number .selfRef} [Discovery Issues](#name-discovery-issues){.section-name .selfRef} {#name-discovery-issues}

In order to benefit from Trickle ICE\'s full potential and reduce
session establishment latency to a minimum, Trickle ICE Agents need to
generate SDP Offers and Answers that contain incomplete and potentially
empty sets of candidates. Such Offers and Answers can only be handled
meaningfully by agents that actually support incremental candidate
provisioning, which implies the need to confirm such support before
using it.[¶](#section-3.1-1){.pilcrow}

Contrary to other protocols, where \"in advance\" capability discovery
is widely implemented, the mechanisms that allow this for SIP (i.e., a
combination of UA capabilities \[[RFC3840](#RFC3840){.xref}\] and
Globally Routable User Agent URIs (GRUUs)
\[[RFC5627](#RFC5627){.xref}\]) have only seen low levels of adoption.
This presents an issue for Trickle ICE implementations as SIP UAs do not
have an obvious means of verifying that their peer will support
incremental candidate provisioning.[¶](#section-3.1-2){.pilcrow}

The Half Trickle mode of operation defined in the Trickle ICE
specification \[[RFC8838](#RFC8838){.xref}\] provides one way around
this, by requiring the first Offer to contain a complete set of local
ICE candidates and using only incremental provisioning of remote
candidates for the rest of the session.[¶](#section-3.1-3){.pilcrow}

While using Half Trickle does provide a working solution, it also comes
at the price of increased latency. Therefore, [Section 5](#disco){.xref}
makes several alternative suggestions that enable SIP UAs to engage in
Full Trickle right from their first Offer: [Section
5.1](#disco-prov){.xref} discusses the use of online provisioning as a
means of allowing the use of Trickle ICE for all endpoints in controlled
environments. [Section 5.2](#disco-gruu){.xref} describes anticipatory
discovery for implementations that actually do support GRUU and UA
capabilities, and [Section 5.3](#half-full-trickle){.xref} discusses the
implementation and use of Half Trickle by SIP UAs where none of the
above are an option.[¶](#section-3.1-4){.pilcrow}
:::
:::

::: {#section-3.2 .section}
### [3.2.](#section-3.2){.section-number .selfRef} [Relationship with the Offer/Answer Model](#name-relationship-with-the-offer){.section-name .selfRef} {#name-relationship-with-the-offer}

From the perspective of SIP middleboxes and proxies, the Offer/Answer
exchange for Trickle ICE looks partly similar to the Offer/Answer
exchange for regular ICE for SIP \[[RFC8839](#RFC8839){.xref}\].
However, in order to have the full picture of the candidate exchange,
the newly introduced INFO messages need to be considered as
well.[¶](#section-3.2-1){.pilcrow}

[]{#name-distinguishing-between-tric}

::: {#fig-oa-and-trickle}
::: {#section-3.2-2.1 .artwork .art-text .alignLeft}
    +-------------------------------+  +-------------------------------+
    |   Alice      +--------------+ |  | +--------------+       Bob    |
    |              | Offer/Answer | |  | | Offer/Answer |              |
    | +--------+   |    Module    | |  | |    Module    |   +--------+ |
    | |  ICE   |   +--------------+ |  | +--------------+   |  ICE   | |
    | | Module |         |          |  |        |           | Module | |
    | +--------+         |          |  |        |           +--------+ |
    +-------------------------------+  +-------------------------------+
          |              |                      |                |
          |              |    INVITE (Offer)    |                |
          |              |--------------------->|                |
          |              |     183 (Answer)     |                |
          |              |<---------------------|                |
          |              |                      |                |
          |                                                      |
          |             SIP INFO (more candidates)               |
          |----------------------------------------------------->|
          |             SIP INFO (more candidates)               |
          |<-----------------------------------------------------|
          |                                                      |
          |          STUN Binding Requests/Responses             |
          |----------------------------------------------------->|
          |          STUN Binding Requests/Responses             |
          |<-----------------------------------------------------|
          |                                                      |
:::

[Figure 2](#figure-2){.selfRef}: [Distinguishing between Trickle ICE and
Traditional Signaling](#name-distinguishing-between-tric){.selfRef}
:::

From an architectural viewpoint, as displayed in [Figure
2](#fig-oa-and-trickle){.xref}, exchanging candidates through SIP INFO
requests could be represented as signaling between ICE modules and not
between Offer/Answer modules of SIP UAs. Then, such INFO requests do not
impact the state of the Offer/Answer transaction other than providing
additional candidates. Consequently, INFO requests are not considered
Offers or Answers. Nevertheless, candidates that have been exchanged
using INFO requests [SHALL]{.bcp14} be included in subsequent Offers or
Answers. The version number in the \"o=\" line of that subsequent Offer
needs to be incremented by 1 per the rules in
\[[RFC3264](#RFC3264){.xref}\].[¶](#section-3.2-3){.pilcrow}
:::
:::
:::

::: {#OAproc}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Incremental Signaling of ICE Candidates](#name-incremental-signaling-of-ic){.section-name .selfRef} {#name-incremental-signaling-of-ic}

Trickle ICE Agents will exchange ICE descriptions compliant to
\[[RFC8838](#RFC8838){.xref}\] via Offer/Answer procedures and/or INFO
request bodies. This requires the following SIP-specific
extensions:[¶](#section-4-1){.pilcrow}

1.  [Trickle ICE Agents [MUST]{.bcp14} indicate support for Trickle ICE
    by including the SIP option-tag \"trickle-ice\" in a SIP Supported:
    header field within all SIP INVITE requests and
    responses.[¶](#section-4-2.1){.pilcrow}]{#section-4-2.1}
2.  [Trickle ICE Agents [MUST]{.bcp14} indicate support for Trickle ICE
    by including the ice-option \"trickle\" within all SDP Offers and
    Answers in accordance to
    \[[RFC8838](#RFC8838){.xref}\].[¶](#section-4-2.2){.pilcrow}]{#section-4-2.2}
3.  [Trickle ICE Agents [MAY]{.bcp14} include any number of ICE
    candidates, i.e., from zero to the complete set of candidates, in
    their initial Offer or Answer. If the complete candidate set is
    already included in the initial Offer, it is called Half
    Trickle.[¶](#section-4-2.3){.pilcrow}]{#section-4-2.3}
4.  [Trickle ICE Agents [MAY]{.bcp14} exchange additional ICE candidates
    using INFO requests within an existing INVITE dialog usage
    (including an early dialog) as specified in
    \[[RFC6086](#RFC6086){.xref}\]. The INFO requests carry an
    Info-Package: trickle-ice. Trickle ICE Agents [MUST]{.bcp14} be
    prepared to receive INFO requests within that same dialog usage,
    containing additional candidates and/or an indication that trickling
    of such candidates has
    ended.[¶](#section-4-2.4){.pilcrow}]{#section-4-2.4}
5.  [Trickle ICE Agents [MAY]{.bcp14} exchange additional ICE candidates
    before the Answerer has sent the Answer provided that an invite
    dialog usage is established at both Trickle ICE Agents. Note that in
    case of forking, multiple early dialogs may
    exist.[¶](#section-4-2.5){.pilcrow}]{#section-4-2.5}

The following sections provide further details on how Trickle ICE Agents
perform the initial Offer/Answer exchange ([Section
4.1](#InitialOA){.xref}), perform subsequent Offer/Answer exchanges
([Section 4.2](#subsOA){.xref}), and establish the INVITE dialog usage
([Section 4.3](#dialog-est){.xref}) such that they can incrementally
trickle candidates ([Section
4.4](#info-sdp){.xref}).[¶](#section-4-3){.pilcrow}

::: {#InitialOA}
::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [Initial Offer/Answer Exchange](#name-initial-offer-answer-exchan){.section-name .selfRef} {#name-initial-offer-answer-exchan}

::: {#IniOS}
::: {#section-4.1.1 .section}
#### [4.1.1.](#section-4.1.1){.section-number .selfRef} [Sending the Initial Offer](#name-sending-the-initial-offer){.section-name .selfRef} {#name-sending-the-initial-offer}

If the Offerer includes candidates in its initial Offer, it
[MUST]{.bcp14} encode these candidates as specified in
\[[RFC8839](#RFC8839){.xref}\].[¶](#section-4.1.1-1){.pilcrow}

If the Offerer wants to send its initial Offer before knowing any
candidate for one or more media descriptions, it [MUST]{.bcp14} set the
port to the default value \'9\' for these media descriptions. If the
Offerer does not want to include the host IP address in the
corresponding \"c=\"line, e.g., due to privacy reasons, it
[SHOULD]{.bcp14} include a default address in the \"c=\"line, which is
set to the IPv4 address 0.0.0.0 or to the IPv6 equivalent
::.[¶](#section-4.1.1-2){.pilcrow}

In this case, the Offerer obviously cannot know the RTP Control Protocol
(RTCP) transport address; thus, it [MUST NOT]{.bcp14} include the
\"rtcp\" attribute \[[RFC3605](#RFC3605){.xref}\]. This avoids potential
ICE mismatch (see \[[RFC8839](#RFC8839){.xref}\]) for the RTCP transport
address.[¶](#section-4.1.1-3){.pilcrow}

If the Offerer wants to use RTCP multiplexing
\[[RFC5761](#RFC5761){.xref}\] and/or exclusive RTCP multiplexing
\[[RFC8858](#RFC8858){.xref}\], it still will include the \"rtcp-mux\"
and/or \"rctp-mux-only\" attribute in the initial
Offer.[¶](#section-4.1.1-4){.pilcrow}

In any case, the Offerer [MUST]{.bcp14} include the
\"ice-options:trickle\" attribute in accordance to
\[[RFC8838](#RFC8838){.xref}\] and [MUST]{.bcp14} include in each \"m=\"
line a \"mid\" attribute in accordance to
\[[RFC5888](#RFC5888){.xref}\]. The \"mid\" attribute identifies the
\"m=\" line to which a candidate belongs and helps in case of multiple
\"m=\" lines, when candidate gathering could occur in an order different
from the order of the \"m=\" lines.[¶](#section-4.1.1-5){.pilcrow}
:::
:::

::: {#IniOR}
::: {#section-4.1.2 .section}
#### [4.1.2.](#section-4.1.2){.section-number .selfRef} [Receiving the Initial Offer](#name-receiving-the-initial-offer){.section-name .selfRef} {#name-receiving-the-initial-offer}

If the initial Offer included candidates, the Answerer uses these
candidates to start ICE processing as specified in
\[[RFC8838](#RFC8838){.xref}\].[¶](#section-4.1.2-1){.pilcrow}

If the initial Offer included the \"ice-options:trickle\" attribute, the
Answerer [MUST]{.bcp14} be prepared for receiving trickled candidates
later on.[¶](#section-4.1.2-2){.pilcrow}

In case of a \"m/c=\" line with default values, none of the eventually
trickled candidates will match the default destination. This situation
[MUST NOT]{.bcp14} cause an ICE mismatch (see
\[[RFC8839](#RFC8839){.xref}\]).[¶](#section-4.1.2-3){.pilcrow}
:::
:::

::: {#IniAS}
::: {#section-4.1.3 .section}
#### [4.1.3.](#section-4.1.3){.section-number .selfRef} [Sending the Initial Answer](#name-sending-the-initial-answer){.section-name .selfRef} {#name-sending-the-initial-answer}

If the Answerer includes candidates in its initial Answer, it
[MUST]{.bcp14} encode these candidates as specified in
\[[RFC8839](#RFC8839){.xref}\].[¶](#section-4.1.3-1){.pilcrow}

If the Answerer wants to send its initial Answer before knowing any
candidate for one or more media descriptions, it [MUST]{.bcp14} set the
port to the default value \'9\' for these media descriptions. If the
Answerer does not want to include the host IP address in the
corresponding \"c=\"line, e.g., due to privacy reasons, it
[SHOULD]{.bcp14} include a default address in the \"c=\"line, which is
set to the IPv4 address 0.0.0.0 or to the IPv6 equivalent
::.[¶](#section-4.1.3-2){.pilcrow}

In this case, the Answerer obviously cannot know the RTCP transport
address; thus, it [MUST NOT]{.bcp14} include the \"rtcp\" attribute
\[[RFC6086](#RFC6086){.xref}\]. This avoids potential ICE mismatch (see
\[[RFC8839](#RFC8839){.xref}\]) for the RTCP transport
address.[¶](#section-4.1.3-3){.pilcrow}

If the Answerer accepts the use of RTCP multiplexing
\[[RFC5761](#RFC5761){.xref}\] and/or exclusive RTCP multiplexing
\[[RFC8858](#RFC8858){.xref}\], it will include the \"rtcp-mux\"
attribute in the initial Answer.[¶](#section-4.1.3-4){.pilcrow}

In any case, the Answerer [MUST]{.bcp14} include the
\"ice-options:trickle\" attribute in accordance to
\[[RFC8838](#RFC8838){.xref}\] and [MUST]{.bcp14} include in each \"m=\"
line a \"mid\" attribute in accordance to
\[[RFC5888](#RFC5888){.xref}\].[¶](#section-4.1.3-5){.pilcrow}
:::
:::

::: {#IniAR}
::: {#section-4.1.4 .section}
#### [4.1.4.](#section-4.1.4){.section-number .selfRef} [Receiving the Initial Answer](#name-receiving-the-initial-answe){.section-name .selfRef} {#name-receiving-the-initial-answe}

If the initial Answer included candidates, the Offerer uses these
candidates to start ICE processing as specified in
\[[RFC8838](#RFC8838){.xref}\].[¶](#section-4.1.4-1){.pilcrow}

In case of a \"m/c=\" line with default values, none of the eventually
trickled candidates will match the default destination. This situation
[MUST NOT]{.bcp14} cause an ICE mismatch (see
\[[RFC8839](#RFC8839){.xref}\]).[¶](#section-4.1.4-2){.pilcrow}
:::
:::
:::
:::

::: {#subsOA}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [Subsequent Offer/Answer Exchanges](#name-subsequent-offer-answer-exc){.section-name .selfRef} {#name-subsequent-offer-answer-exc}

Subsequent Offer/Answer exchanges are handled the same as regular ICE
(see [Section
4.4](https://www.rfc-editor.org/rfc/rfc8839#section-4.4){.relref} of
\[[RFC8839](#RFC8839){.xref}\]).[¶](#section-4.2-1){.pilcrow}

If an Offer or Answer needs to be sent while the ICE Agents are in the
middle of trickling, [Section
4.4](https://www.rfc-editor.org/rfc/rfc8839#section-4.4){.relref} of
\[[RFC8839](#RFC8839){.xref}\] applies. This means that an ICE Agent
includes candidate attributes for all local candidates it had trickled
previously for a specific media stream.[¶](#section-4.2-2){.pilcrow}
:::
:::

::: {#dialog-est}
::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [Establishing the Dialog](#name-establishing-the-dialog){.section-name .selfRef} {#name-establishing-the-dialog}

In order to be able to start trickling, the following two conditions
need to be satisfied at the SIP UAs:[¶](#section-4.3-1){.pilcrow}

-   [Trickle ICE support at the peer agent [MUST]{.bcp14} be
    confirmed.[¶](#section-4.3-2.1){.pilcrow}]{#section-4.3-2.1}
-   [A dialog [MUST]{.bcp14} have been created between the
    peers.[¶](#section-4.3-2.2){.pilcrow}]{#section-4.3-2.2}

[Section 5](#disco){.xref} discusses in detail the various options for
satisfying the first of the above conditions. However, regardless of
those mechanisms, agents are certain to have a clear understanding of
whether their peers support trickle ICE once an Offer and an Answer have
been exchanged, which also allows for ICE processing to commence (see
[Figure 3](#offerer-can-trickle){.xref}).[¶](#section-4.3-3){.pilcrow}

::: {#relprov}
::: {#section-4.3.1 .section}
#### [4.3.1.](#section-4.3.1){.section-number .selfRef} [Establishing Dialog State through Reliable Offer/Answer Delivery](#name-establishing-dialog-state-t){.section-name .selfRef} {#name-establishing-dialog-state-t}

[]{#name-a-sip-offerer-can-freely-tr}

::: {#offerer-can-trickle}
::: {#section-4.3.1-1.1 .artwork .art-text .alignLeft}
                    Alice                      Bob
                      |                         |
                      |     INVITE (Offer)      |
                      |------------------------>|
                      |      183 (Answer)       |
                      |<------------------------|
                      |        PRACK/OK         |
                      |------------------------>|
                      |                         |
              +----------------------------------------+
              |Alice and Bob know that both can trickle|
              |and know that the dialog is in the early|
              |state. Send INFO!                       |
              +----------------------------------------+
                      |                         |
                      |  INFO/OK (+SRFLX Cand.) |
                      |------------------------>|
                      |  INFO/OK (+SRFLX Cand.) |
                      |<------------------------|
                      |                         |

            Note: "SRFLX" denotes server-reflexive candidates
:::

[Figure 3](#figure-3){.selfRef}: [A SIP Offerer can freely trickle as
soon as it receives an
Answer](#name-a-sip-offerer-can-freely-tr){.selfRef}
:::

As shown in [Figure 3](#offerer-can-trickle){.xref}, satisfying both
conditions is relatively trivial for ICE Agents that have sent an Offer
in an INVITE and that have received an Answer in a reliable provisional
response. It is guaranteed to have confirmed support (or lack thereof)
for Trickle ICE at the Answerer and to have fully initialized the SIP
dialog at both ends. Offerers and Answerers (after receipt of the PRACK
request) in the above situation can therefore freely commence trickling
within the newly established dialog.[¶](#section-4.3.1-2){.pilcrow}
:::
:::

::: {#unrelprov}
::: {#section-4.3.2 .section}
#### [4.3.2.](#section-4.3.2){.section-number .selfRef} [Establishing Dialog State through Unreliable Offer/Answer Delivery](#name-establishing-dialog-state-th){.section-name .selfRef} {#name-establishing-dialog-state-th}

The situation is a bit more delicate for agents that have received an
Offer in an INVITE request and have sent an Answer in an unreliable
provisional response because, once the response has been sent, the
Answerer does not know when or if it has been received ([Figure
4](#answerer-cant-trickle){.xref}).[¶](#section-4.3.2-1){.pilcrow}

[]{#name-a-sip-ua-that-sent-an-answe}

::: {#answerer-cant-trickle}
::: {#section-4.3.2-2.1 .artwork .art-text .alignLeft}
                    Alice                      Bob
                      |                         |
                      |     INVITE (Offer)      |
                      |------------------------>|
                      |      183 (Answer)       |
                      |<------------------------|
                      |                         |
                      |               +----------------------+
                      |               |Bob:  I don't know if |
                      |               |Alice got my 183 or if|
                      |               |her dialog is already |
                      |               |in the early state.   |
                      |               |  Can I send INFO???  |
                      |               +----------------------+
                      |                         |
:::

[Figure 4](#figure-4){.selfRef}: [A SIP UA that sent an Answer in an
unreliable provisional response does not know if it was received or if
the dialog at the side of the Offerer has entered the early
state](#name-a-sip-ua-that-sent-an-answe){.selfRef}
:::

In order to clear this ambiguity as soon as possible, the Answerer needs
to retransmit the provisional response with the exponential backoff
timers described in \[[RFC3262](#RFC3262){.xref}\]. These
retransmissions [MUST]{.bcp14} cease on receipt of an INFO request
carrying a \"trickle-ice\" Info Package body, on receipt of any other
in-dialog request from the Offerer, or on transmission of the Answer in
a 2xx response. The Offerer cannot send in-dialog requests until it
receives a response, so the arrival of such a request proves that the
response has arrived. Using the INFO request for dialog confirmation is
similar to the procedure described in [Section
7.1.1](https://www.rfc-editor.org/rfc/rfc8839#section-7.1.1){.relref} of
\[[RFC8839](#RFC8839){.xref}\], except that the STUN binding request is
replaced by the INFO request.[¶](#section-4.3.2-3){.pilcrow}

The Offerer [MUST]{.bcp14} send a Trickle ICE INFO request as soon as it
receives an SDP Answer in an unreliable provisional response. This INFO
request [MUST]{.bcp14} repeat the candidates that were already provided
in the Offer (as would be the case when Half Trickle is performed or
when new candidates have not been learned since then). The first case
could happen when Half Trickle is used and all candidates are already in
the initial offer. The second case could happen when Full Trickle is
used and the Offerer is currently gathering additional candidates but
did not yet get them. Also, if the initial Offer did not contain any
candidates, depending on how the Offerer gathers its candidates and how
long it takes to do so, this INFO could still contain no
candidates.[¶](#section-4.3.2-4){.pilcrow}

When Full Trickle is used and if newly learned candidates are available,
the Offerer [SHOULD]{.bcp14} also deliver these candidates in said INFO
request, unless it wants to hold back some candidates in reserve, e.g.,
in case these candidates are expensive to use and would only be trickled
if all other candidates failed.[¶](#section-4.3.2-5){.pilcrow}

The Offerer [SHOULD]{.bcp14} include an \"end-of-candidates\" attribute
in case candidate discovery has ended in the meantime and no further
candidates are to be trickled.[¶](#section-4.3.2-6){.pilcrow}

As soon as an Answerer has received such an INFO request, the Answerer
has an indication that a dialog is established at both ends and
trickling can begin ([Figure
5](#answerer-can-now-trickle){.xref}).[¶](#section-4.3.2-7){.pilcrow}

Note: The \"+SRFLX\" in [Figure 5](#answerer-can-now-trickle){.xref}
indicates that additional newly learned server-reflexive candidates are
included.[¶](#section-4.3.2-8){.pilcrow}

[]{#name-a-sip-ua-that-received-an-i}

::: {#answerer-can-now-trickle}
::: {#section-4.3.2-9.1 .artwork .art-text .alignLeft}
                    Alice                      Bob
                      |                         |
                      |     INVITE (Offer)      |
                      |------------------------>|
                      |      183 (Answer)       |
                      |<------------------------|
                      |  INFO/OK (+SRFLX Cand.) |
                      |------------------------>|
                      |                         |
                      |               +----------------------+
                      |               |Bob:  Now I know Alice|
                      |               | is ready. Send INFO! |
                      |               +----------------------+
                      |  INFO/OK (+SRFLX Cand.) |
                      |<------------------------|
                      |                         |
                      |    200/ACK (Answer)     |
                      |<------------------------|

              Note: "SRFLX" denotes server-reflexive candidates
:::

[Figure 5](#figure-5){.selfRef}: [A SIP UA that received an INFO request
after sending an unreliable provisional response knows that the dialog
at the side of the receiver has entered the early
state](#name-a-sip-ua-that-received-an-i){.selfRef}
:::

When sending the Answer in the 200 OK response to the INVITE request,
the Answerer needs to repeat exactly the same Answer that was previously
sent in the unreliable provisional response in order to fulfill the
corresponding requirements in \[[RFC3264](#RFC3264){.xref}\]. Thus, the
Offerer needs to be prepared for receiving a different number of
candidates in that repeated Answer than previously exchanged via
trickling and [MUST]{.bcp14} ignore the candidate information in that
200 OK response.[¶](#section-4.3.2-10){.pilcrow}
:::
:::

::: {#head-start}
::: {#section-4.3.3 .section}
#### [4.3.3.](#section-4.3.3){.section-number .selfRef} [Initiating Trickle ICE without an SDP Answer](#name-initiating-trickle-ice-with){.section-name .selfRef} {#name-initiating-trickle-ice-with}

The ability to convey arbitrary candidates in INFO message bodies allows
ICE Agents to initiate trickling without actually sending an Answer.
Trickle ICE Agents can therefore respond to an INVITE request with
provisional responses without an SDP Answer
\[[RFC3261](#RFC3261){.xref}\]. Such provisional responses serve for
establishing an early dialog.[¶](#section-4.3.3-1){.pilcrow}

Agents that choose to establish the dialog in this way [MUST]{.bcp14}
retransmit these responses with the exponential backoff timers described
in \[[RFC3262](#RFC3262){.xref}\]. These retransmissions [MUST]{.bcp14}
cease on receipt of an INFO request carrying a \"trickle-ice\" Info
Package body, on receipt of any in-dialog requests from the Offerer, or
on transmission of the Answer in a 2xx response. The Offerer cannot send
in-dialog requests until it receives a response, so the arrival of such
a request proves that the response has arrived. This is again similar to
the procedure described in [Section
6.1.1](https://www.rfc-editor.org/rfc/rfc8839#section-6.1.1){.relref} of
\[[RFC8839](#RFC8839){.xref}\], except that an Answer is not yet
provided.[¶](#section-4.3.3-2){.pilcrow}

Note: The \"+SRFLX\" in [Figure 6](#can-now-trickle-unrelprov){.xref}
indicates that additional newly learned server-reflexive candidates are
included.[¶](#section-4.3.3-3){.pilcrow}

[]{#name-a-sip-ua-sends-an-unreliabl}

::: {#can-now-trickle-unrelprov}
::: {#section-4.3.3-4.1 .artwork .art-text .alignLeft}
                    Alice                      Bob
                      |                         |
                      |     INVITE (Offer)      |
                      |------------------------>|
                      |      183 (-)            |
                      |<------------------------|
                      |  INFO/OK (SRFLX Cand.)  |
                      |------------------------>|
                      |                         |
                      |               +----------------------+
                      |               |Bob:  Now I know again|
                      |               | that Alice is ready. |
                      |               | Send INFO!           |
                      |               +----------------------+
                      |  INFO/OK (SRFLX Cand.)  |
                      |<------------------------|
                      |    183 (Answer) opt.    |
                      |<------------------------|
                      |  INFO/OK (SRFLX Cand.)  |
                      |<------------------------|
                      |    200/ACK (Answer)     |
                      |<------------------------|

           Note: "SRFLX" denotes server-reflexive candidates
:::

[Figure 6](#figure-6){.selfRef}: [A SIP UA sends an unreliable
provisional response without an Answer for establishing an early
dialog](#name-a-sip-ua-sends-an-unreliabl){.selfRef}
:::

When sending the Answer, the agent [MUST]{.bcp14} repeat all currently
known and used candidates, if any, and [MAY]{.bcp14} include all newly
gathered candidates since the last INFO request was sent. However, if
that Answer was already sent in an unreliable provisional response, the
Answerers [MUST]{.bcp14} repeat exactly the same Answer in the 200 OK
response to the INVITE request in order to fulfill the corresponding
requirements in \[[RFC3264](#RFC3264){.xref}\]. In case that trickling
continued, an Offerer needs to be prepared for receiving fewer
candidates in that repeated Answer than previously exchanged via
trickling and [MUST]{.bcp14} ignore the candidate information in that
200 OK response.[¶](#section-4.3.3-5){.pilcrow}
:::
:::
:::
:::

::: {#info-sdp}
::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [Delivering Candidates in INFO Requests](#name-delivering-candidates-in-in){.section-name .selfRef} {#name-delivering-candidates-in-in}

Whenever new ICE candidates become available for sending, agents encode
them in \"candidate\" attributes as described by
\[[RFC8839](#RFC8839){.xref}\]. For
example:[¶](#section-4.4-1){.pilcrow}

::: {#section-4.4-2}
``` {.sourcecode .lang-sdp}
  a=candidate:1 1 UDP 2130706432 200a0b:12f0::1 5000 typ host
```

[¶](#section-4.4-2){.pilcrow}
:::

The use of SIP INFO requests happens within the context of the Info
Package as defined in [Section 10](#info-package){.xref}. The media type
\[[RFC6838](#RFC6838){.xref}\] for their payload [MUST]{.bcp14} be set
to \"application/trickle-ice-sdpfrag\" as defined in [Section
9](#trickle_ice_sdpfrag_def){.xref}. The INFO request body adheres to
the grammar as specified in [Section
9.2](#trickle_ice_sdpfrag_grammar){.xref}.[¶](#section-4.4-3){.pilcrow}

Since neither the \"candidate\" nor the \"end-of-candidates\" attributes
contain information that would allow correlating them to a specific
\"m=\" line, it is handled through the use of pseudo \"m=\"
lines.[¶](#section-4.4-4){.pilcrow}

Pseudo \"m=\" lines follow the SDP syntax for \"m=\" lines as defined in
\[[RFC4566](#RFC4566){.xref}\] and are linked to the corresponding
\"m=\" line in the SDP Offer or Answer via the identification tag in a
\"mid\" attribute \[[RFC5888](#RFC5888){.xref}\]. A pseudo \"m=\" line
does not provide semantics other than indicating to which \"m=\" line a
candidate belongs. Consequently, the receiving agent [MUST]{.bcp14}
ignore any remaining content of the pseudo \"m=\" line, which is not
defined in this document. This guarantees that the
\"application/trickle-ice-sdpfrag\" bodies do not interfere with the
Offer/Answer procedures as specified in
\[[RFC3264](#RFC3264){.xref}\].[¶](#section-4.4-5){.pilcrow}

When sending the INFO request, the agent [MAY]{.bcp14}, if already known
to the agent, include the same content into the pseudo \"m=\" line as
for the \"m=\" line in the corresponding Offer or Answer. However, since
Trickle ICE might be decoupled from the Offer/Answer negotiation, the
content might be unknown to the agent. In this case, the agent
[MUST]{.bcp14} include the following default
values:[¶](#section-4.4-6){.pilcrow}

-   [The media field is set to
    \'audio\'.[¶](#section-4.4-7.1){.pilcrow}]{#section-4.4-7.1}
-   [The port value is set to
    \'9\'.[¶](#section-4.4-7.2){.pilcrow}]{#section-4.4-7.2}
-   [The proto value is set to
    \'RTP/AVP\'.[¶](#section-4.4-7.3){.pilcrow}]{#section-4.4-7.3}
-   [The fmt field [MUST]{.bcp14} appear only once and is set to
    \'0\'.[¶](#section-4.4-7.4){.pilcrow}]{#section-4.4-7.4}

Agents [MUST]{.bcp14} include a pseudo \"m=\" line and an identification
tag in a \"mid\" attribute for every \"m=\" line whose candidate list
they intend to update. Such \"mid\" attributes [MUST]{.bcp14}
immediately precede the list of candidates for that specific \"m=\"
line.[¶](#section-4.4-8){.pilcrow}

All \"candidate\" or \"end-of-candidates\" attributes following a
\"mid\" attribute, up until (and excluding) the next occurrence of a
pseudo \"m=\" line, pertain to the \"m=\" line identified by that
identification tag.[¶](#section-4.4-9){.pilcrow}

Note, that there is no requirement that the INFO request body contains
as many pseudo \"m=\" lines as the Offer/Answer contains \"m=\" lines,
nor that the pseudo \"m=\" lines be in the same order as the \"m=\"
lines that they pertain to. The correspondence can be made via the
\"mid\" attributes since candidates are grouped in sections headed by
\"pseudo\" \"m=\" lines. These sections contain \"mid\" attribute values
that point back to the true \"m=\" line.[¶](#section-4.4-10){.pilcrow}

An \"end-of-candidates\" attribute, preceding the first pseudo \"m=\"
line, indicates the end of all trickling from that agent, as opposed to
end of trickling for a specific \"m=\" line, which would be indicated by
a media-level \"end-of-candidates\"
attribute.[¶](#section-4.4-11){.pilcrow}

Refer to [Figure 7](#INFOexample){.xref} for an example of the INFO
request content.[¶](#section-4.4-12){.pilcrow}

The use of pseudo \"m=\" lines allows for a structure similar to the one
in SDP Offers and Answers where separate media-level and session-level
sections can be distinguished. In the current case, lines preceding the
first pseudo \"m=\" line are considered to be session level. Lines
appearing in between or after pseudo \"m=\" lines will be interpreted as
media level.[¶](#section-4.4-13){.pilcrow}

Note that while this specification uses the \"mid\" attribute from
\[[RFC5888](#RFC5888){.xref}\], it does not define any grouping
semantics.[¶](#section-4.4-14.1){.pilcrow}

All INFO requests [MUST]{.bcp14} carry the \"ice-pwd\" and \"ice-ufrag\"
attributes that allow mapping them to a specific ICE generation. An
agent [MUST]{.bcp14} discard any received INFO requests containing
\"ice-pwd\" and \"ice-ufrag\" attributes that do not match those of the
current ICE Negotiation Session.[¶](#section-4.4-15){.pilcrow}

The \"ice-pwd\" and \"ice-ufrag\" attributes [MUST]{.bcp14} appear at
the same level as the ones in the Offer/Answer exchange. In other words,
if they were present as session-level attributes, they will also appear
at the beginning of all INFO request payloads, i.e., preceding the first
pseudo \"m=\" line. If they were originally exchanged as media-level
attributes, potentially overriding session-level values, then they will
also be included in INFO request payloads following the corresponding
pseudo \"m=\" lines.[¶](#section-4.4-16){.pilcrow}

Note that when candidates are trickled, \[[RFC8838](#RFC8838){.xref}\]
requires that each candidate must be delivered to the receiving Trickle
ICE implementation not more than once and in the same order as it was
conveyed. If the signaling protocol provides any candidate
retransmissions, they need to be hidden from the ICE implementation.
This requirement is fulfilled as follows.[¶](#section-4.4-17){.pilcrow}

Since the agent is not fully aware of the state of the ICE Negotiation
Session at its peer, it [MUST]{.bcp14} include all currently known and
used local candidates in every INFO request. That is, the agent
[MUST]{.bcp14} repeat in the INFO request body all candidates that were
previously sent under the same combination of \"ice-pwd\" and
\"ice-ufrag\" in the same order as they were sent before. In other
words, the sequence of a previously sent list of candidates [MUST
NOT]{.bcp14} change in subsequent INFO requests, and newly gathered
candidates [MUST]{.bcp14} be added at the end of that list. Although
repeating all candidates creates some overhead, it also allows easier
handling of problems that could arise from unreliable transports like,
e.g., loss of messages and reordering, which can be detected through the
CSeq: header field in the INFO request.[¶](#section-4.4-18){.pilcrow}

In addition, an ICE Agent needs to adhere to [Section
17](https://www.rfc-editor.org/rfc/rfc8838#section-17){.relref} of
\[[RFC8838](#RFC8838){.xref}\] on preserving candidate order while
trickling.[¶](#section-4.4-19){.pilcrow}

When receiving INFO requests carrying any candidates, agents
[MUST]{.bcp14} first identify and discard the attribute lines containing
candidates they have already received in previous INFO requests or in
the Offer/Answer exchange preceding them.[¶](#section-4.4-20){.pilcrow}

Such candidates are considered to be equal if their IP address port,
transport, and component ID are the same. After identifying and
discarding the known candidates, the agents [MUST]{.bcp14} forward the
actual new candidates to the ICE Agents in the same order as they were
received in the INFO request body. The ICE Agents will then process the
new candidates according to the rules described in
\[[RFC8838](#RFC8838){.xref}\].[¶](#section-4.4-21){.pilcrow}

Receiving an \"end-of-candidates\" attribute in an INFO request body \--
with the \"ice-ufrag\" and \"ice-pwd\" attributes matching the current
ICE generation \-- is an indication from the peer agent that it will not
send any further candidates. When included at the session level, i.e.,
before any pseudo \"m=\" line, this indication applies to the whole
session; when included at the media level, the indication applies only
to the corresponding \"m=\" line. Handling of such end-of-candidates
indications is defined in
\[[RFC8838](#RFC8838){.xref}\].[¶](#section-4.4-22){.pilcrow}

The example in [Figure 7](#INFOexample){.xref} shows the content of a
candidate delivering INFO request. In the example, the
\"end-of-candidates\" attributes indicate that the candidate gathering
is finished and that no further INFO requests
follow.[¶](#section-4.4-23){.pilcrow}

[]{#name-an-example-for-the-content-}

::: {#INFOexample}
::: {#section-4.4-24.1}
``` sourcecode
  INFO sip:alice@example.com SIP/2.0
  ...
  Info-Package: trickle-ice
  Content-type: application/trickle-ice-sdpfrag
  Content-Disposition: Info-Package
  Content-length: 862

  a=ice-pwd:asd88fgpdd777uzjYhagZg
  a=ice-ufrag:8hhY
  m=audio 9 RTP/AVP 0
  a=mid:1
  a=candidate:1 1 UDP 2130706432 2001:db8:a0b:12f0::1 5000 typ host
  a=candidate:1 2 UDP 2130706432 2001:db8:a0b:12f0::1 5001 typ host
  a=candidate:1 1 UDP 2130706431 192.0.2.1 5010 typ host
  a=candidate:1 2 UDP 2130706431 192.0.2.1 5011 typ host
  a=candidate:2 1 UDP 1694498815 192.0.2.3 5010 typ srflx
     raddr 192.0.2.1 rport 8998
  a=candidate:2 2 UDP 1694498815 192.0.2.3 5011 typ srflx
     raddr 192.0.2.1 rport 8998
  a=end-of-candidates
  m=audio 9 RTP/AVP 0
  a=mid:2
  a=candidate:1 1 UDP 2130706432 2001:db8:a0b:12f0::1 6000 typ host
  a=candidate:1 2 UDP 2130706432 2001:db8:a0b:12f0::1 6001 typ host
  a=candidate:1 1 UDP 2130706431 192.0.2.1 6010 typ host
  a=candidate:1 2 UDP 2130706431 192.0.2.1 6011 typ host
  a=candidate:2 1 UDP 1694498815 192.0.2.3 6010 typ srflx
     raddr 192.0.2.1 rport 9998
  a=candidate:2 2 UDP 1694498815 192.0.2.3 6011 typ srflx
     raddr 192.0.2.1 rport 9998
  a=end-of-candidates

      Note: In a real INFO request, there will be no line breaks
            in the "candidate" attributes
```
:::

[Figure 7](#figure-7){.selfRef}: [An Example for the Content of an INFO
Request](#name-an-example-for-the-content-){.selfRef}
:::
:::
:::
:::
:::

::: {#disco}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Initial Discovery of Trickle ICE Support](#name-initial-discovery-of-trickl){.section-name .selfRef} {#name-initial-discovery-of-trickl}

SIP UAs are required by \[[RFC8838](#RFC8838){.xref}\] to indicate their
support of and intent to use Trickle ICE in their Offers and Answers by
using the \"ice-options:trickle\" attribute, and they [MUST]{.bcp14}
include the SIP option-tag \"trickle-ice\" in a SIP Supported: or
Require: header field. This makes discovery fairly straightforward for
Answerers or for cases where Offers need to be generated within existing
dialogs (i.e., when sending UPDATE or re-INVITE requests). In both
scenarios, prior SDP bodies will have provided the necessary
information.[¶](#section-5-1){.pilcrow}

Obviously, such information is not available at the time a first Offer
is being constructed, and it is therefore impossible for ICE Agents to
determine support for incremental provisioning that way. The following
options are suggested as ways of addressing this
issue.[¶](#section-5-2){.pilcrow}

::: {#disco-prov}
::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [Provisioning Support for Trickle ICE](#name-provisioning-support-for-tr){.section-name .selfRef} {#name-provisioning-support-for-tr}

In certain situations, it may be possible for integrators deploying
Trickle ICE to know in advance that some or all endpoints reachable from
within the deployment will support Trickle ICE. This is the case, for
example, if Session Border Controllers (SBCs) with support for this
specification are used to connect to UAs that do not support Trickle
ICE.[¶](#section-5.1-1){.pilcrow}

While the exact mechanism for allowing such provisioning is out of scope
here, this specification encourages trickle ICE implementations to allow
the option in the way they find most
appropriate.[¶](#section-5.1-2){.pilcrow}

However, an Offerer assuming Trickle ICE support [MUST]{.bcp14} include
a SIP Require: trickle-ice header field. That way, if the provisioned
assumption of Trickle ICE support ends up being incorrect, the failure
is (a) operationally easy to track down and (b) recoverable by the
client, i.e., they can resend the request without the SIP Require:
header field and without the assumption of Trickle ICE
support.[¶](#section-5.1-3){.pilcrow}
:::
:::

::: {#disco-gruu}
::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [Trickle ICE Discovery with Globally Routable User Agent URIs (GRUUs)](#name-trickle-ice-discovery-with-){.section-name .selfRef} {#name-trickle-ice-discovery-with-}

\[[RFC3840](#RFC3840){.xref}\] provides a way for SIP UAs to query for
support of specific capabilities using, among others, OPTIONS requests.
On the other hand, support for GRUU according to
\[[RFC5627](#RFC5627){.xref}\] allows SIP requests to be addressed to
specific UAs (as opposed to arbitrary instances of an address of
record). Combining the two and using the \"trickle-ice\" option tag
defined in [Section 10.6](#option-tag){.xref} provides SIP UAs with a
way of learning the capabilities of specific SIP UA instances and then
addressing them directly with INVITE requests that require Trickle ICE
support.[¶](#section-5.2-1){.pilcrow}

Such learning of capabilities may happen in different ways. One option
for a SIP UA is to learn the GRUU instance ID of a peer through presence
and then to query its capabilities with an OPTIONS request.
Alternatively, it can also just send an OPTIONS request to the Address
of Record (AOR) it intends to contact and then inspect the returned
response(s) for support of both GRUU and Trickle ICE ([Figure
8](#options-gruu){.xref}). It is noted that using the GRUU means that
the INVITE request can go only to that particular device. This prevents
the use of forking for that request.[¶](#section-5.2-2){.pilcrow}

[]{#name-trickle-ice-support-discove}

::: {#options-gruu}
::: {#section-5.2-3.1 .artwork .art-text .alignLeft}
             Alice                                                Bob
               |                                                   |
               |        OPTIONS sip:b1@example.com SIP/2.0         |
               |-------------------------------------------------->|
               |                                                   |
               |                      200 OK                       |
               |    Contact: sip:b1@example.com;gr=hha9s8d-999a    |
               |            ;audio;video|;trickle-ice;...          |
               |<--------------------------------------------------|
               |                                                   |
               | INVITE sip:b1@example.com;gr=hha9s8d-999a SIP/2.0 |
               |             Supported: trickle-ice                |
               |                      (Offer)                      |
               |-------------------------------------------------->|
               |                                                   |
               |                  183 (Answer)                     |
               |<--------------------------------------------------|
               |                INFO/OK (Trickling)                |
               |<------------------------------------------------->|
               |                                                   |
               |                      ...                          |
               |                                                   |
:::

[Figure 8](#figure-8){.selfRef}: [Trickle ICE Support Discovery with
OPTIONS and GRUU](#name-trickle-ice-support-discove){.selfRef}
:::

Confirming support for Trickle ICE through
\[[RFC3840](#RFC3840){.xref}\] gives SIP UAs the option to engage in
Full Trickle negotiation (as opposed to the more lengthy Half Trickle)
from the very first Offer they send.[¶](#section-5.2-4){.pilcrow}
:::
:::

::: {#half-full-trickle}
::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [Fall Back to Half Trickle](#name-fall-back-to-half-trickle){.section-name .selfRef} {#name-fall-back-to-half-trickle}

In cases where none of the other mechanisms in this section are
acceptable, SIP UAs should use the Half Trickle mode defined in
\[[RFC8838](#RFC8838){.xref}\]. With Half Trickle, agents initiate
sessions the same way they would when using ICE for SIP
\[[RFC8839](#RFC8839){.xref}\]. This means that, prior to actually
sending an Offer, agents first gather ICE candidates in a blocking way
and then send them all in that Offer. The blocking nature of the process
implies that some amount of latency will be accumulated, and it is
advised that agents try to anticipate it where possible, for example,
when user actions indicate a high likelihood for an imminent call (e.g.,
activity on a keypad or a phone going off
hook).[¶](#section-5.3-1){.pilcrow}

Using Half Trickle results in Offers that are compatible with both ICE
SIP endpoints \[[RFC8839](#RFC8839){.xref}\] and legacy endpoints
\[[RFC3264](#RFC3264){.xref}\].[¶](#section-5.3-2){.pilcrow}

[]{#name-example-of-a-typical-half-t}

::: {#fig-half-trickle}
::: {#section-5.3-3.1 .artwork .art-text .alignLeft}
    STUN/TURN                                                STUN/TURN
    Servers          Alice                      Bob          Servers
       |               |                             |               |
       |<--------------|                             |               |
       |               |                             |               |
       |               |                             |               |
       |   Candidate   |                             |               |
       |               |                             |               |
       |               |                             |               |
       |   Discovery   |                             |               |
       |               |                             |               |
       |               |                             |               |
       |-------------->|       INVITE (Offer)        |               |
       |               |---------------------------->|               |
       |               |        183 (Answer)         |-------------->|
       |               |<----------------------------|               |
       |               |  INFO (repeated candidates) |               |
       |               |---------------------------->|               |
       |               |                             |               |
       |               |    INFO (more candidates)   |   Candidate   |
       |               |<----------------------------|               |
       |               |    Connectivity Checks      |               |
       |               |<===========================>|   Discovery   |
       |               |   INFO (more candidates)    |               |
       |               |<----------------------------|               |
       |               |    Connectivity Checks      |<--------------|
       |               |<===========================>|               |
       |               |                             |               |
       |               |          200 OK             |               |
       |               |<----------------------------|               |
       |               |                             |               |
       |               |<======= MEDIA FLOWS =======>|               |
       |               |                             |               |
:::

[Figure 9](#figure-9){.selfRef}: [Example of a Typical (Half) Trickle
ICE Exchange with SIP](#name-example-of-a-typical-half-t){.selfRef}
:::

As a reminder, once a single Offer or Answer has been exchanged within a
specific dialog, support for Trickle ICE will have been determined. No
further use of Half Trickle will therefore be necessary within that same
dialog, and all subsequent exchanges can use the Full Trickle mode of
operation.[¶](#section-5.3-4){.pilcrow}
:::
:::
:::
:::

::: {#rtcp-cons}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Considerations for RTP and RTCP Multiplexing](#name-considerations-for-rtp-and-){.section-name .selfRef} {#name-considerations-for-rtp-and-}

The following consideration describes options for Trickle ICE in order
to give some guidance to implementers on how trickling can be optimized
with respect to providing RTCP candidates.[¶](#section-6-1){.pilcrow}

Handling of the \"rtcp\" attribute \[[RFC3605](#RFC3605){.xref}\] and
the \"rtcp-mux\" attribute for RTP/RTCP multiplexing
\[[RFC5761](#RFC5761){.xref}\] is already considered in [Section
5.1.1.1](https://www.rfc-editor.org/rfc/rfc8445#section-5.1.1.1){.relref}
of \[[RFC8445](#RFC8445){.xref}\] and in \[[RFC5761](#RFC5761){.xref}\].
These considerations are still valid for Trickle ICE; however, trickling
provides more flexibility for the sequence of candidate exchange in case
of RTCP multiplexing.[¶](#section-6-2){.pilcrow}

If the Offerer supports RTP/RTCP multiplexing exclusively as specified
in \[[RFC8858](#RFC8858){.xref}\], the procedures in that document apply
for the handling of the \"rtcp-mux-only\", \"rtcp\", and \"rtcp-mux\"
attributes.[¶](#section-6-3){.pilcrow}

While a Half Trickle Offerer has to send an Offer compliant to
\[[RFC8839](#RFC8839){.xref}\] and \[[RFC5761](#RFC5761){.xref}\]
including candidates for all components, the flexibility of a Full
Trickle Offerer allows the sending of only RTP candidates (component 1)
in the initial Offer assuming that RTCP multiplexing is supported by the
Answerer. A Full Trickle Offerer would need to start gathering and
trickling RTCP candidates (component 2) only after having received an
indication in the Answer that the Answerer unexpectedly does not support
RTCP multiplexing.[¶](#section-6-4){.pilcrow}

A Trickle Answerer [MAY]{.bcp14} include an \"rtcp-mux\" attribute
\[[RFC5761](#RFC5761){.xref}\] in the
\"application/trickle-ice-sdpfrag\" body if it supports and uses RTP and
RTCP multiplexing. The Trickle Answerer needs to follow the guidance on
the usage of the \"rtcp\" attribute as given in
\[[RFC8839](#RFC8839){.xref}\] and \[[RFC3605](#RFC3605){.xref}\].
Receipt of this attribute at the Offerer in an INFO request prior to the
Answer indicates that the Answerer supports and uses RTP and RTCP
multiplexing. The Offerer can use this information, e.g., for stopping
the gathering of RTCP candidates and/or for freeing corresponding
resources.[¶](#section-6-5){.pilcrow}

This behavior is illustrated by the following example Offer that
indicates support for RTP and RTCP
multiplexing.[¶](#section-6-6){.pilcrow}

::: {#section-6-7}
``` {.sourcecode .lang-sdp}
  v=0
  o=alice 2890844526 2890844526 IN IP6 atlanta.example.com
  s=
  c=IN IP6 2001:db8:a0b:12f0::3
  t=0 0
  a=ice-pwd:777uzjYhagZgasd88fgpdd
  a=ice-ufrag:Yhh8
  m=audio 5000 RTP/AVP 0
  a=mid:1
  a=rtcp-mux
  a=candidate:1 1 UDP 1658497328 2001:db8:a0b:12f0::3 5000 typ host
```

[¶](#section-6-7){.pilcrow}
:::

Once the dialog is established as described in [Section
4.3](#dialog-est){.xref}, the Answerer sends the following INFO
request.[¶](#section-6-8){.pilcrow}

::: {#section-6-9}
``` sourcecode
  INFO sip:alice@example.com SIP/2.0
  ...
  Info-Package: trickle-ice
  Content-type: application/trickle-ice-sdpfrag
  Content-Disposition: Info-Package
  Content-length: 161

  a=ice-pwd:asd88fgpdd777uzjYhagZg
  a=ice-ufrag:8hhY
  m=audio 9 RTP/AVP 0
  a=mid:1
  a=rtcp-mux
  a=candidate:1 1 UDP 1658497382 2001:db8:a0b:12f0::4 6000 typ host
```

[¶](#section-6-9){.pilcrow}
:::

This INFO request indicates that the Answerer supports and uses RTP and
RTCP multiplexing as well. It allows the Offerer to omit gathering RTCP
candidates or releasing already gathered RTCP candidates. If the INFO
request did not contain the \"rtcp-mux\" attribute, the Offerer has to
gather RTCP candidates unless it wants to wait until receipt of an
Answer that eventually confirms support or non-support for RTP and RTCP
multiplexing. In case the Offerer already sent RTCP candidates in a
previous INFO request, it still needs to repeat them in subsequent INFO
requests, even when that support for RTCP multiplexing was confirmed by
the Answerer and the Offerer has released its RTCP
candidates.[¶](#section-6-10){.pilcrow}
:::
:::

::: {#bundle-cons}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Considerations for Media Multiplexing](#name-considerations-for-media-mu){.section-name .selfRef} {#name-considerations-for-media-mu}

The following considerations describe options for Trickle ICE in order
to give some guidance to implementers on how trickling can be optimized
with respect to providing candidates in case of Media Multiplexing
\[[RFC8843](#RFC8843){.xref}\]. It is assumed that the reader is
familiar with \[[RFC8843](#RFC8843){.xref}\].[¶](#section-7-1){.pilcrow}

ICE candidate exchange is already considered in [Section
10](https://www.rfc-editor.org/rfc/rfc8843#section-10){.relref} of
\[[RFC8843](#RFC8843){.xref}\]. These considerations are still valid for
Trickle ICE; however, trickling provides more flexibility for the
sequence of candidate exchange, especially in Full Trickle
mode.[¶](#section-7-2){.pilcrow}

Except for bundle-only \"m=\" lines, a Half Trickle Offerer has to send
an Offer with candidates for all bundled \"m=\" lines. The additional
flexibility, however, allows a Full Trickle Offerer to initially send
only candidates for the \"m=\" line with the suggested Offerer BUNDLE
address.[¶](#section-7-3){.pilcrow}

On receipt of the Answer, the Offerer will detect if BUNDLE is supported
by the Answerer and if the suggested Offerer BUNDLE address was
selected. In this case, the Offerer does not need to trickle further
candidates for the remaining \"m=\" lines in a bundle. However, if
BUNDLE is not supported, the Full Trickle Offerer needs to gather and
trickle candidates for the remaining \"m=\" lines as necessary. If the
Answerer selects an Offerer BUNDLE address that is different from the
suggested Offerer BUNDLE address, the Full Trickle Offerer needs to
gather and trickle candidates for the \"m=\" line that carries the
selected Offerer BUNDLE address.[¶](#section-7-4){.pilcrow}

A Trickle Answerer [SHOULD]{.bcp14} include a \"group:BUNDLE\" attribute
\[[RFC8843](#RFC8843){.xref}\] at session level in the
\"application/trickle-ice-sdpfrag\" body if it supports and uses
bundling. When doing so, the Answerer [MUST]{.bcp14} include all
identification-tags in the same order that is used or will be used in
the Answer.[¶](#section-7-5){.pilcrow}

Receipt of this attribute at the Offerer in an INFO request prior to the
Answer indicates that the Answerer supports and uses bundling. The
Offerer can use this information, e.g., for stopping the gathering of
candidates for the remaining \"m=\" lines in a bundle and/or for freeing
corresponding resources.[¶](#section-7-6){.pilcrow}

This behavior is illustrated by the following example Offer that
indicates support for Media Multiplexing.[¶](#section-7-7){.pilcrow}

If the Offerer already sent candidates for \"m=\" lines in a bundle in a
previous INFO request, it still needs to repeat them in subsequent INFO
requests, even when that support for bundling was confirmed by the
Answerer and the Offerer has released candidates that are no longer
needed.[¶](#section-7-8){.pilcrow}

::: {#section-7-9}
``` {.sourcecode .lang-sdp}
   v=0
   o=alice 2890844526 2890844526 IN IP6 atlanta.example.com
   s=
   c=IN IP6 2001:db8:a0b:12f0::3
   t=0 0
   a=group:BUNDLE foo bar
   a=ice-pwd:777uzjYhagZgasd88fgpdd
   a=ice-ufrag:Yhh8
   m=audio 10000 RTP/AVP 0
   a=mid:foo
   a=rtcp-mux
   a=rtpmap:0 PCMU/8000
   a=extmap 1 urn:ietf:params:rtp-hdrext:sdes:mid
   a=candidate:1 1 UDP 1658497328 2001:db8:a0b:12f0::3 10000 typ host
   m=video 10002 RTP/AVP 31
   a=mid:bar
   a=rtcp-mux
   a=rtpmap:31 H261/90000
   a=extmap 1 urn:ietf:params:rtp-hdrext:sdes:mid
```

[¶](#section-7-9){.pilcrow}
:::

The example Offer indicates support for RTP and RTCP multiplexing and
contains a \"candidate\" attribute only for the \"m=\" line with the
suggested Offerer BUNDLE address. Once the dialog is established as
described in [Section 4.3](#dialog-est){.xref}, the Answerer sends the
following INFO request.[¶](#section-7-10){.pilcrow}

::: {#section-7-11}
``` sourcecode
   INFO sip:alice@example.com SIP/2.0
   ...
   Info-Package: trickle-ice
   Content-type: application/trickle-ice-sdpfrag
   Content-Disposition: Info-Package
   Content-length: 219

   a=group:BUNDLE foo bar
   a=ice-pwd:asd88fgpdd777uzjYhagZg
   a=ice-ufrag:8hhY
   m=audio 9 RTP/AVP 0
   a=mid:foo
   a=rtcp-mux
   a=candidate:1 1 UDP 1658497328 2001:db8:a0b:12f0::3 5000 typ host
```

[¶](#section-7-11){.pilcrow}
:::

This INFO request indicates that the Answerer supports and uses Media
Multiplexing as well. Note that the Answerer only includes a single
pseudo \"m=\" line since candidates matching those from the second
\"m=\" line in the offer are not needed from the
Answerer.[¶](#section-7-12){.pilcrow}

The INFO request also indicates that the Answerer accepted the suggested
Offerer BUNDLE address. This allows the Offerer to omit gathering RTP
and RTCP candidates for the other \"m=\" lines or releasing already
gathered candidates. If the INFO request did not contain the
\"group:BUNDLE\" attribute, the Offerer has to gather RTP and RTCP
candidates for the other \"m=\" lines unless it wants to wait until
receipt of an Answer that eventually confirms support or non-support for
Media Multiplexing.[¶](#section-7-13){.pilcrow}

Independent of using Full Trickle or Half Trickle mode, the rules from
\[[RFC8859](#RFC8859){.xref}\] apply to both, Offerer and Answerer, when
putting attributes as specified in [Section
9.2](#trickle_ice_sdpfrag_grammar){.xref} in the
\"application/trickle-ice-sdpfrag\" body.[¶](#section-7-14){.pilcrow}
:::
:::

::: {#sec-eoc}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [SDP \"end-of-candidates\" Attribute](#name-sdp-end-of-candidates-attri){.section-name .selfRef} {#name-sdp-end-of-candidates-attri}

::: {#eoc-def}
::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Definition](#name-definition){.section-name .selfRef} {#name-definition}

This section defines the new SDP media-level and session-level
\[[RFC4566](#RFC4566){.xref}\] \"end-of-candidates\" attribute.
\"end-of-candidates\" is a property attribute
\[[RFC4566](#RFC4566){.xref}\]; hence, it has no value. By including
this attribute in an Offer or Answer, the sending agent indicates that
it will not trickle further candidates. When included at the session
level, this indication applies to the whole session; when included at
the media level, the indication applies only to the corresponding media
description.[¶](#section-8.1-1){.pilcrow}

-   [[]{.break}]{#section-8.1-2.1}

    Name:
    :   end-of-candidates[¶](#section-8.1-2.1.1.2){.pilcrow}
    :   

    Value:
    :   N/A[¶](#section-8.1-2.1.1.4){.pilcrow}
    :   

    Usage Level:
    :   media and session level[¶](#section-8.1-2.1.1.6){.pilcrow}
    :   

    Charset Dependent:
    :   no[¶](#section-8.1-2.1.1.8){.pilcrow}
    :   

    Mux Category:
    :   IDENTICAL[¶](#section-8.1-2.1.1.10){.pilcrow}
    :   

    Example:
    :   a=end-of-candidates[¶](#section-8.1-2.1.1.12){.pilcrow}
    :   
:::
:::

::: {#eoc-ind}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Offer/Answer Procedures](#name-offer-answer-procedures){.section-name .selfRef} {#name-offer-answer-procedures}

The Offerer or Answerer [MAY]{.bcp14} include an \"end-of-candidates\"
attribute in case candidate discovery has ended and no further
candidates are to be trickled. The Offerer or Answerer [MUST]{.bcp14}
provide the \"end-of-candidates\" attribute together with the
\"ice-ufrag\" and \"ice-pwd\" attributes of the current ICE generation
as required by \[[RFC8838](#RFC8838){.xref}\]. When included at the
session level, this indication applies to the whole session; when
included at the media level, the indication applies only to the
corresponding media description.[¶](#section-8.2-1){.pilcrow}

Receipt of an \"end-of-candidates\" attribute at an Offerer or Answerer
\-- with the \"ice-ufrag\" and \"ice-pwd\" attributes matching the
current ICE generation \-- indicates that the gathering of candidates
has ended at the peer, for either the session or only the corresponding
media description as specified above. The receiving agent forwards an
end-of-candidates indication to the ICE Agent, which in turn acts as
specified in
\[[RFC8838](#RFC8838){.xref}\].[¶](#section-8.2-2){.pilcrow}
:::
:::
:::
:::

::: {#trickle_ice_sdpfrag_def}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Content Type \"application/trickle-ice-sdpfrag\"](#name-content-type-application-tr){.section-name .selfRef} {#name-content-type-application-tr}

::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Overall Description](#name-overall-description){.section-name .selfRef} {#name-overall-description}

An \"application/trickle-ice-sdpfrag\" body is used exclusively by the
\"trickle-ice\" Info Package. Other SDP-related applications need to
define their own media type. The INFO request body uses a subset of the
possible SDP lines as defined by the grammar in
\[[RFC4566](#RFC4566){.xref}\]. A valid body uses only pseudo \"m=\"
lines and certain attributes that are needed and/or useful for trickling
candidates. The content adheres to the following
grammar.[¶](#section-9.1-1){.pilcrow}
:::

::: {#trickle_ice_sdpfrag_grammar}
::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Grammar](#name-grammar){.section-name .selfRef} {#name-grammar}

The grammar of an \"application/trickle-ice-sdpfrag\" body is based on
the following ABNF \[[RFC5234](#RFC5234){.xref}\]. It specifies the
subset of existing SDP attributes that is needed or useful for trickling
candidates. The grammar uses the indicator for case-sensitive %s, as
defined in \[[RFC7405](#RFC7405){.xref}\], but it also imports grammar
for other SDP attributes that precede the production of
\[[RFC7405](#RFC7405){.xref}\]. A sender [SHOULD]{.bcp14} use lower case
for attributes from such earlier grammar, but a receiver [MUST]{.bcp14}
treat them as case insensitive.[¶](#section-9.2-1){.pilcrow}

::: {#section-9.2-2}
``` {.sourcecode .lang-abnf}
   ;  Syntax
   trickle-ice-sdpfrag =   session-level-fields
                     pseudo-media-descriptions
   session-level-fields = *(session-level-field CRLF)

   session-level-field =  ice-lite-attribute /
                     ice-pwd-attribute /
                     ice-ufrag-attribute /
                     ice-options-attribute /
                     ice-pacing-attribute /
                     end-of-candidates-attribute /
                     bundle-group-attribute /
                     extension-attribute-fields
                                         ; for future extensions

   ice-lite-attribute     = %s"a" "=" ice-lite
   ice-pwd-attribute      = %s"a" "=" ice-pwd-att
   ice-ufrag-attribute    = %s"a" "=" ice-ufrag-att
   ice-pacing-attribute   = %s"a" "=" ice-pacing-att
   ice-options-attribute  = %s"a" "=" ice-options
   end-of-candidates-attribute  = %s"a" "=" end-of-candidates
   end-of-candidates            = %s"end-of-candidates"
   bundle-group-attribute = %s"a" "=" %s"group:" bundle-semantics
                              *(SP identification-tag)
   bundle-semantics = "BUNDLE"
   extension-attribute-fields   = attribute-fields

   pseudo-media-descriptions    =  *( media-field
                              trickle-ice-attribute-fields )
   trickle-ice-attribute-fields = *(trickle-ice-attribute-field CRLF)
   trickle-ice-attribute-field = mid-attribute /
                           candidate-attributes /
                           ice-pwd-attribute  /
                           ice-ufrag-attribute /
                           remote-candidate-attribute /
                           end-of-candidates-attribute /
                           rtcp-attribute /
                           rtcp-mux-attribute /
                           rtcp-mux-only-attribute /
                           extension-attribute-fields
                                           ; for future extensions

   rtcp-attribute                = %s"a" "=" %s"rtcp"
   rtcp-mux-attribute            = %s"a" "=" %s"rtcp-mux"
   rtcp-mux-only-attribute       = %s"a" "=" %s"rtcp-mux-only"
   candidate-attributes          = %s"a" "=" candidate-attribute
   remote-candidate-attribute    = %s"a" "=" remote-candidate-att
```

[¶](#section-9.2-2){.pilcrow}
:::

ice-lite, ice-pwd-att, remote-candidate-att, ice-ufrag-att,
ice-pacing-att, ice-options, candidate-attribute, and
remote-candidate-att are from \[[RFC8839](#RFC8839){.xref}\];
identification-tag and mid-attribute are from
\[[RFC5888](#RFC5888){.xref}\]; and media-field and attribute-fields are
from \[[RFC4566](#RFC4566){.xref}\]. The \"rtcp\" attribute is defined
in \[[RFC3605](#RFC3605){.xref}\], the \"rtcp-mux\" attribute is defined
in \[[RFC5761](#RFC5761){.xref}\], and the \"rtcp-mux-only\" attribute
is defined in \[[RFC8858](#RFC8858){.xref}\]. The latter attributes lack
formal grammar in their corresponding RFCs and are reproduced
here.[¶](#section-9.2-3){.pilcrow}

The \"ice-pwd\" and \"ice-ufrag\" attributes [MUST]{.bcp14} appear at
the same level as the ones in the Offer/Answer exchange. In other words,
if they were present as session-level attributes, they will also appear
at the beginning of all INFO request payloads, i.e., preceding all
pseudo \"m=\" lines. If they were originally exchanged as media-level
attributes, potentially overriding session-level values, then they will
also be included in INFO request payloads following the corresponding
pseudo \"m=\" lines.[¶](#section-9.2-4){.pilcrow}

An Agent [MUST]{.bcp14} ignore any received unknown
extension-attribute-fields.[¶](#section-9.2-5){.pilcrow}
:::
:::
:::
:::

::: {#info-package}
::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [Info Package](#name-info-package){.section-name .selfRef} {#name-info-package}

::: {#rationale}
::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [Rationale \-- Why INFO?](#name-rationale-why-info){.section-name .selfRef} {#name-rationale-why-info}

The decision to use SIP INFO requests as a candidate transport method is
based primarily on their lightweight nature. Once a dialog has been
established, INFO requests can be exchanged both ways with no
restrictions on timing and frequency and no risk of
collision.[¶](#section-10.1-1){.pilcrow}

A critical fact is that the sending of Trickle ICE candidates in one
direction is entirely uncoupled from sending candidates in the other
direction. Thus, the sending of candidates in each direction can be done
by a stream of INFO requests that is not correlated with the stream of
INFO requests in the other direction. And since each INFO request
cumulatively includes the contents of all previous INFO requests in that
direction, the ordering between INFO requests need not be preserved. All
of this permits using largely independent INFO
requests.[¶](#section-10.1-2){.pilcrow}

Contrarily, UPDATE or other Offer/Answer mechanisms assume that the
messages in each direction are tightly coupled with messages in the
other direction. Using Offer/Answer and UPDATE requests
\[[RFC3311](#RFC3311){.xref}\] would introduce the following
complications:[¶](#section-10.1-3){.pilcrow}

[]{.break}

Blocking of messages:
:   Offer/Answer is defined as a strictly sequential mechanism in
    \[[RFC3264](#RFC3264){.xref}\]. There can only be a maximum of one
    active exchange at any point of time. Both sides cannot
    simultaneously send Offers nor can they generate multiple Offers
    prior to receiving an Answer. Using UPDATE requests for candidate
    transport would therefore imply the implementation of a candidate
    pool at every agent where candidates can be stored until it is once
    again that agent\'s \"turn\" to emit an Answer or a new Offer. Such
    an approach would introduce non-negligible complexity for no
    additional value.[¶](#section-10.1-4.2){.pilcrow}
:   

Elevated risk of glare:
:   The sequential nature of Offer/Answer also makes it impossible for
    both sides to send Offers simultaneously. What\'s worse is that
    there are no mechanisms in SIP to actually prevent that.
    \[[RFC3261](#RFC3261){.xref}\], where the situation of Offers
    crossing on the wire is described as \"glare\", only defines a
    procedure for addressing the issue after it has occurred. According
    to that procedure, both Offers are invalidated and both sides need
    to retry the negotiation after a period between 0 and 4 seconds. The
    high likelihood for glare and the average two-second backoff
    intervals to occur implies that the duration of Trickle ICE
    processing would not only fail to improve but actually exceed those
    of regular ICE.[¶](#section-10.1-4.4){.pilcrow}
:   

INFO messages decouple the exchange of candidates from the Offer/Answer
negotiation and are subject to none of the glare issues described above,
which makes them a very convenient and lightweight mechanism for
asynchronous delivery of candidates.[¶](#section-10.1-5){.pilcrow}

Using in-dialog INFO messages also provides a way of guaranteeing that
candidates are delivered end to end, between the same entities that are
actually in the process of initiating a session. Out-of-dialog
alternatives would have implied requiring support for GRUU
\[[RFC5627](#RFC5627){.xref}\] that, given GRUUs relatively low adoption
levels, would have constituted too strong of a constraint to the
adoption of Trickle ICE.[¶](#section-10.1-6){.pilcrow}
:::
:::

::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Overall Description](#name-overall-description-2){.section-name .selfRef} {#name-overall-description-2}

This specification defines an Info Package for use by SIP UAs
implementing Trickle ICE. INFO requests carry ICE candidates discovered
after the peer UAs have confirmed mutual support for Trickle
ICE.[¶](#section-10.2-1){.pilcrow}
:::

::: {#section-10.3 .section}
### [10.3.](#section-10.3){.section-number .selfRef} [Applicability](#name-applicability){.section-name .selfRef} {#name-applicability}

The purpose of the ICE protocol is to establish a media path in the
presence of NAT and firewalls. The candidates are transported in INFO
requests and are part of this
establishment.[¶](#section-10.3-1){.pilcrow}

Candidates sent by a Trickle ICE Agent after the Offer follow the same
signaling path and reach the same entity as the Offer itself. While it
is true that GRUUs can be used to achieve this, one of the goals of this
specification is to allow operation of Trickle ICE in as many
environments as possible including those without GRUU support. Using
out-of-dialog SUBSCRIBE/NOTIFY requests would not satisfy this
goal.[¶](#section-10.3-2){.pilcrow}
:::

::: {#section-10.4 .section}
### [10.4.](#section-10.4){.section-number .selfRef} [Info Package Name](#name-info-package-name){.section-name .selfRef} {#name-info-package-name}

This document defines a SIP Info Package as per
\[[RFC6086](#RFC6086){.xref}\]. The Info Package token name for this
package is \"trickle-ice\".[¶](#section-10.4-1){.pilcrow}
:::

::: {#section-10.5 .section}
### [10.5.](#section-10.5){.section-number .selfRef} [Info Package Parameters](#name-info-package-parameters){.section-name .selfRef} {#name-info-package-parameters}

This document does not define any Info Package
parameters.[¶](#section-10.5-1){.pilcrow}
:::

::: {#option-tag}
::: {#section-10.6 .section}
### [10.6.](#section-10.6){.section-number .selfRef} [SIP Option Tags](#name-sip-option-tags){.section-name .selfRef} {#name-sip-option-tags}

\[[RFC6086](#RFC6086){.xref}\] allows Info Package specifications to
define SIP option-tags. This specification extends the option-tag
construct of the SIP grammar as follows:[¶](#section-10.6-1){.pilcrow}

::: {#section-10.6-2 .artwork .art-text .alignLeft}
     option-tag /= "trickle-ice"

[¶](#section-10.6-2){.pilcrow}
:::

SIP entities that support this specification [MUST]{.bcp14} place the
\"trickle-ice\" option-tag in a SIP Supported: or Require: header field
within all SIP INVITE requests and
responses.[¶](#section-10.6-3){.pilcrow}

When responding to, or generating, a SIP OPTIONS request, a SIP entity
[MUST]{.bcp14} also include the \"trickle-ice\" option-tag in a SIP
Supported: or Require: header field.[¶](#section-10.6-4){.pilcrow}
:::
:::

::: {#section-10.7 .section}
### [10.7.](#section-10.7){.section-number .selfRef} [INFO Request Body Parts](#name-info-request-body-parts){.section-name .selfRef} {#name-info-request-body-parts}

Entities implementing this specification [MUST]{.bcp14} include a
payload of type \"application/trickle-ice-sdpfrag\" in SIP INFO requests
as defined in [Section 9.2](#trickle_ice_sdpfrag_grammar){.xref}. The
payload is used to convey SDP-encoded ICE
candidates.[¶](#section-10.7-1){.pilcrow}
:::

::: {#section-10.8 .section}
### [10.8.](#section-10.8){.section-number .selfRef} [Info Package Usage Restrictions](#name-info-package-usage-restrict){.section-name .selfRef} {#name-info-package-usage-restrict}

This document does not define any Info Package Usage
Restrictions.[¶](#section-10.8-1){.pilcrow}
:::

::: {#section-10.9 .section}
### [10.9.](#section-10.9){.section-number .selfRef} [Rate of INFO Requests](#name-rate-of-info-requests){.section-name .selfRef} {#name-rate-of-info-requests}

Given that IP addresses may be gathered rapidly, a Trickle ICE Agent
with many network interfaces might create a high rate of INFO requests
if every newly detected candidate is trickled individually without
aggregation. An implementation [MUST]{.bcp14} aggregate ICE candidates
in case an unreliable transport protocol such as UDP is used. A Trickle
ICE Agent [MUST NOT]{.bcp14} have more than one INFO request pending at
any one time. When INFO messages are sent over an unreliable transport,
they are retransmitted according to the rules specified in
\[[RFC3261](#RFC3261){.xref}\], [Section
17.1.2.1](https://www.rfc-editor.org/rfc/rfc3261#section-17.1.2.1){.relref}.[¶](#section-10.9-1){.pilcrow}

If the INFO requests are sent on top of TCP, which is probably the
standard way, it is not an issue for the network anymore, but it can
remain one for SIP proxies and other intermediaries forwarding the SIP
INFO messages. Also, an endpoint may not be able to tell that it has
congestion controlled transport all the
way.[¶](#section-10.9-2){.pilcrow}
:::

::: {#section-10.10 .section}
### [10.10.](#section-10.10){.section-number .selfRef} [Info Package Security Considerations](#name-info-package-security-consi){.section-name .selfRef} {#name-info-package-security-consi}

See [Section 13](#sec-cons){.xref}.[¶](#section-10.10-1){.pilcrow}
:::
:::
:::

::: {#deploy-cons}
::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [Deployment Considerations](#name-deployment-considerations){.section-name .selfRef} {#name-deployment-considerations}

Trickle ICE uses two mechanisms for the exchange of candidate
information. This imposes new requirements to certain middleboxes that
are used in some networks, e.g., for monitoring purposes. While the
first mechanism, SDP Offers and Answers, is already used by regular ICE
and is assumed to be supported, the second mechanism, INFO request
bodies, needs to be considered by such middleboxes as well when trickle
ICE is used. Such middleboxes need to make sure that they remain in the
signaling path of the INFO requests and understand the INFO request
body.[¶](#section-11-1){.pilcrow}
:::
:::

::: {#IANA}
::: {#section-12 .section}
## [12.](#section-12){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

::: {#sec-eoc-iana}
::: {#section-12.1 .section}
### [12.1.](#section-12.1){.section-number .selfRef} [SDP \"end-of-candidates\" Attribute](#name-sdp-end-of-candidates-attrib){.section-name .selfRef} {#name-sdp-end-of-candidates-attrib}

This section defines a new SDP media-level and session-level
\[[RFC4566](#RFC4566){.xref}\] \"end-of-candidates\" attribute, which is
a property attribute \[[RFC4566](#RFC4566){.xref}\] and hence has no
value.[¶](#section-12.1-1){.pilcrow}

-   [[]{.break}]{#section-12.1-2.1}

    Name:
    :   end-of-candidates[¶](#section-12.1-2.1.1.2){.pilcrow}
    :   

    Value:
    :   N/A[¶](#section-12.1-2.1.1.4){.pilcrow}
    :   

    Usage Level:
    :   media and session[¶](#section-12.1-2.1.1.6){.pilcrow}
    :   

    Charset Dependent:
    :   no[¶](#section-12.1-2.1.1.8){.pilcrow}
    :   

    Purpose:
    :   The sender indicates that it will not trickle further ICE
        candidates.[¶](#section-12.1-2.1.1.10){.pilcrow}
    :   

    O/A Procedures:
    :   RFC 8840 defines the detailed SDP Offer/Answer procedures for
        the \"end-of-candidates\"
        attribute.[¶](#section-12.1-2.1.1.12){.pilcrow}
    :   

    Mux Category:
    :   IDENTICAL[¶](#section-12.1-2.1.1.14){.pilcrow}
    :   

    Reference:
    :   RFC 8840[¶](#section-12.1-2.1.1.16){.pilcrow}
    :   

    Example:
    :   a=end-of-candidates[¶](#section-12.1-2.1.1.18){.pilcrow}
    :   
:::
:::

::: {#sdpfrag-reg}
::: {#section-12.2 .section}
### [12.2.](#section-12.2){.section-number .selfRef} [Media Type \"application/trickle-ice-sdpfrag\"](#name-media-type-application-tric){.section-name .selfRef} {#name-media-type-application-tric}

This document defines the new media type
\"application/trickle-ice-sdpfrag\" in accordance with
\[[RFC6838](#RFC6838){.xref}\].[¶](#section-12.2-1){.pilcrow}

[]{.break}

Type name:
:   application[¶](#section-12.2-2.2){.pilcrow}
:   

Subtype name:
:   trickle-ice-sdpfrag[¶](#section-12.2-2.4){.pilcrow}
:   

Required parameters:
:   None.[¶](#section-12.2-2.6){.pilcrow}
:   

Optional parameters:
:   None.[¶](#section-12.2-2.8){.pilcrow}
:   

Encoding considerations:

:   The media contents follow the same rules as SDP, except as noted in
    this document. The media contents are text, with the grammar
    specified in [Section
    9.2](#trickle_ice_sdpfrag_grammar){.xref}.[¶](#section-12.2-2.10.1){.pilcrow}

    Although the initially defined content of a trickle-ice-sdpfrag body
    does only include ASCII characters, UTF-8-encoded content might be
    introduced via extension attributes. The \"charset\" attribute may
    be used to signal the presence of other character sets in certain
    parts of a trickle-ice-sdpfrag body (see
    \[[RFC4566](#RFC4566){.xref}\]). Arbitrary binary content cannot be
    directly represented in SDP or a trickle-ice-sdpfrag
    body.[¶](#section-12.2-2.10.2){.pilcrow}

:   

Security considerations:
:   See \[[RFC4566](#RFC4566){.xref}\] and RFC
    8840[¶](#section-12.2-2.12){.pilcrow}
:   

Interoperability considerations:
:   See RFC 8840[¶](#section-12.2-2.14){.pilcrow}
:   

Published specification:
:   See RFC 8840[¶](#section-12.2-2.16){.pilcrow}
:   

Applications that use this media type:
:   Trickle ICE[¶](#section-12.2-2.18){.pilcrow}
:   

Fragment identifier considerations:
:   N/A[¶](#section-12.2-2.20){.pilcrow}
:   

Additional information:

:   \

    []{.break}

    Deprecated alias names for this type:
    :   N/A[¶](#section-12.2-2.22.2.2){.pilcrow}
    :   

    Magic number(s):
    :   N/A[¶](#section-12.2-2.22.2.4){.pilcrow}
    :   

    File extension(s):
    :   N/A[¶](#section-12.2-2.22.2.6){.pilcrow}
    :   

    Macintosh File Type Code(s):
    :   N/A[¶](#section-12.2-2.22.2.8){.pilcrow}
    :   

:   

Person and email address to contact for further information:
:   The IESG (iesg\@ietf.org)[¶](#section-12.2-2.24){.pilcrow}
:   

Intended usage:
:   Trickle ICE for SIP as specified in RFC
    8840.[¶](#section-12.2-2.26){.pilcrow}
:   

Restrictions on usage:
:   N/A[¶](#section-12.2-2.28){.pilcrow}
:   

Author/Change controller:
:   The IESG (iesg\@ietf.org)[¶](#section-12.2-2.30){.pilcrow}
:   

Provisional registration? (standards tree only):
:   N/A[¶](#section-12.2-2.32){.pilcrow}
:   
:::
:::

::: {#package-reg}
::: {#section-12.3 .section}
### [12.3.](#section-12.3){.section-number .selfRef} [SIP Info Package \"trickle-ice\"](#name-sip-info-package-trickle-ic){.section-name .selfRef} {#name-sip-info-package-trickle-ic}

This document defines a new SIP Info Package named \"trickle-ice\" and
updates the \"Info Packages Registry\" with the following
entry.[¶](#section-12.3-1){.pilcrow}

::: {#table_1}
  Name          Reference
  ------------- -----------
  trickle-ice   RFC 8840

  : [Table 1](#table-1){.selfRef}
:::
:::
:::

::: {#optag-reg}
::: {#section-12.4 .section}
### [12.4.](#section-12.4){.section-number .selfRef} [SIP Option Tag \"trickle-ice\"](#name-sip-option-tag-trickle-ice){.section-name .selfRef} {#name-sip-option-tag-trickle-ice}

This specification registers a new SIP option tag \"trickle-ice\" as per
the guidelines in [Section
27.1](https://www.rfc-editor.org/rfc/rfc3261#section-27.1){.relref} of
\[[RFC3261](#RFC3261){.xref}\] and updates the \"Option Tags\"
subregistry of the SIP Parameters registry with the following
entry:[¶](#section-12.4-1){.pilcrow}

::: {#table_2}
  Name          Description                                                                           Reference
  ------------- ------------------------------------------------------------------------------------- -----------
  trickle‑ice   This option tag is used to indicate that a UA supports and understands Trickle ICE.   RFC 8840

  : [Table 2](#table-2){.selfRef}
:::
:::
:::
:::
:::

::: {#sec-cons}
::: {#section-13 .section}
## [13.](#section-13){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

The Security Considerations of \[[RFC6086](#RFC6086){.xref}\],
\[[RFC8838](#RFC8838){.xref}\], and \[[RFC8839](#RFC8839){.xref}\]
apply. This document clarifies how the above specifications are used
together for trickling candidates and does not create additional
security risks.[¶](#section-13-1){.pilcrow}

The new Info Package \"trickle-ice\" and the new media type
\"application/trickle-ice-sdpfrag\" do not introduce additional security
considerations when used in the context of Trickle ICE. Both are not
intended to be used for other applications, so any security
considerations for its use in other contexts is out of the scope of this
document[¶](#section-13-2){.pilcrow}
:::
:::

::: {#section-14 .section}
## [14.](#section-14){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-14.1 .section}
### [14.1.](#section-14.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC3261\]
:   [Rosenberg, J.]{.refAuthor}[, Schulzrinne, H.]{.refAuthor}[,
    Camarillo, G.]{.refAuthor}[, Johnston, A.]{.refAuthor}[,
    Peterson, J.]{.refAuthor}[, Sparks, R.]{.refAuthor}[,
    Handley, M.]{.refAuthor}[, and E. Schooler]{.refAuthor}, [\"SIP:
    Session Initiation Protocol\"]{.refTitle}, [RFC 3261]{.seriesInfo},
    [DOI 10.17487/RFC3261]{.seriesInfo}, June 2002,
    \<<https://www.rfc-editor.org/info/rfc3261>\>.
:   

\[RFC3262\]
:   [Rosenberg, J.]{.refAuthor}[ and H. Schulzrinne]{.refAuthor},
    [\"Reliability of Provisional Responses in Session Initiation
    Protocol (SIP)\"]{.refTitle}, [RFC 3262]{.seriesInfo}, [DOI
    10.17487/RFC3262]{.seriesInfo}, June 2002,
    \<<https://www.rfc-editor.org/info/rfc3262>\>.
:   

\[RFC3264\]
:   [Rosenberg, J.]{.refAuthor}[ and H. Schulzrinne]{.refAuthor}, [\"An
    Offer/Answer Model with Session Description Protocol
    (SDP)\"]{.refTitle}, [RFC 3264]{.seriesInfo}, [DOI
    10.17487/RFC3264]{.seriesInfo}, June 2002,
    \<<https://www.rfc-editor.org/info/rfc3264>\>.
:   

\[RFC3605\]
:   [Huitema, C.]{.refAuthor}, [\"Real Time Control Protocol (RTCP)
    attribute in Session Description Protocol (SDP)\"]{.refTitle}, [RFC
    3605]{.seriesInfo}, [DOI 10.17487/RFC3605]{.seriesInfo}, October
    2003, \<<https://www.rfc-editor.org/info/rfc3605>\>.
:   

\[RFC4566\]
:   [Handley, M.]{.refAuthor}[, Jacobson, V.]{.refAuthor}[, and C.
    Perkins]{.refAuthor}, [\"SDP: Session Description
    Protocol\"]{.refTitle}, [RFC 4566]{.seriesInfo}, [DOI
    10.17487/RFC4566]{.seriesInfo}, July 2006,
    \<<https://www.rfc-editor.org/info/rfc4566>\>.
:   

\[RFC5234\]
:   [Crocker, D., Ed.]{.refAuthor}[ and P. Overell]{.refAuthor},
    [\"Augmented BNF for Syntax Specifications: ABNF\"]{.refTitle}, [STD
    68]{.seriesInfo}, [RFC 5234]{.seriesInfo}, [DOI
    10.17487/RFC5234]{.seriesInfo}, January 2008,
    \<<https://www.rfc-editor.org/info/rfc5234>\>.
:   

\[RFC5761\]
:   [Perkins, C.]{.refAuthor}[ and M. Westerlund]{.refAuthor},
    [\"Multiplexing RTP Data and Control Packets on a Single
    Port\"]{.refTitle}, [RFC 5761]{.seriesInfo}, [DOI
    10.17487/RFC5761]{.seriesInfo}, April 2010,
    \<<https://www.rfc-editor.org/info/rfc5761>\>.
:   

\[RFC5888\]
:   [Camarillo, G.]{.refAuthor}[ and H. Schulzrinne]{.refAuthor}, [\"The
    Session Description Protocol (SDP) Grouping Framework\"]{.refTitle},
    [RFC 5888]{.seriesInfo}, [DOI 10.17487/RFC5888]{.seriesInfo}, June
    2010, \<<https://www.rfc-editor.org/info/rfc5888>\>.
:   

\[RFC6086\]
:   [Holmberg, C.]{.refAuthor}[, Burger, E.]{.refAuthor}[, and H.
    Kaplan]{.refAuthor}, [\"Session Initiation Protocol (SIP) INFO
    Method and Package Framework\"]{.refTitle}, [RFC 6086]{.seriesInfo},
    [DOI 10.17487/RFC6086]{.seriesInfo}, January 2011,
    \<<https://www.rfc-editor.org/info/rfc6086>\>.
:   

\[RFC6838\]
:   [Freed, N.]{.refAuthor}[, Klensin, J.]{.refAuthor}[, and T.
    Hansen]{.refAuthor}, [\"Media Type Specifications and Registration
    Procedures\"]{.refTitle}, [BCP 13]{.seriesInfo}, [RFC
    6838]{.seriesInfo}, [DOI 10.17487/RFC6838]{.seriesInfo}, January
    2013, \<<https://www.rfc-editor.org/info/rfc6838>\>.
:   

\[RFC7405\]
:   [Kyzivat, P.]{.refAuthor}, [\"Case-Sensitive String Support in
    ABNF\"]{.refTitle}, [RFC 7405]{.seriesInfo}, [DOI
    10.17487/RFC7405]{.seriesInfo}, December 2014,
    \<<https://www.rfc-editor.org/info/rfc7405>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8445\]
:   [Keranen, A.]{.refAuthor}[, Holmberg, C.]{.refAuthor}[, and J.
    Rosenberg]{.refAuthor}, [\"Interactive Connectivity Establishment
    (ICE): A Protocol for Network Address Translator (NAT)
    Traversal\"]{.refTitle}, [RFC 8445]{.seriesInfo}, [DOI
    10.17487/RFC8445]{.seriesInfo}, July 2018,
    \<<https://www.rfc-editor.org/info/rfc8445>\>.
:   

\[RFC8838\]
:   [Ivov, E.]{.refAuthor}[, Uberti, J.]{.refAuthor}[, and P.
    Saint-Andre]{.refAuthor}, [\"Trickle ICE: Incremental Provisioning
    of Candidates for the Interactive Connectivity Establishment (ICE)
    Protocol\"]{.refTitle}, [RFC 8838]{.seriesInfo}, [DOI
    10.17487/RFC8838]{.seriesInfo}, January 2021,
    \<<https://www.rfc-editor.org/info/rfc8838>\>.
:   

\[RFC8839\]
:   [Petit-Huguenin, M.]{.refAuthor}[, Nandakumar, S.]{.refAuthor}[,
    Holmberg, C.]{.refAuthor}[, Keränen, A.]{.refAuthor}[, and R.
    Shpount]{.refAuthor}, [\"Session Description Protocol (SDP)
    Offer/Answer Procedures for Interactive Connectivity Establishment
    (ICE)\"]{.refTitle}, [RFC 8839]{.seriesInfo}, [DOI
    10.17487/RFC8839]{.seriesInfo}, January 2021,
    \<<https://www.rfc-editor.org/info/rfc8839>\>.
:   

\[RFC8843\]
:   [Holmberg, C.]{.refAuthor}[, Alvestrand, H.]{.refAuthor}[, and C.
    Jennings]{.refAuthor}, [\"Negotiating Media Multiplexing Using the
    Session Description Protocol (SDP)\"]{.refTitle}, [RFC
    8843]{.seriesInfo}, [DOI 10.17487/RFC8843]{.seriesInfo}, January
    2021, \<<https://www.rfc-editor.org/info/rfc8843>\>.
:   

\[RFC8858\]
:   [Holmberg, C.]{.refAuthor}, [\"Indicating Exclusive Support of RTP
    and RTP Control Protocol (RTCP) Multiplexing Using the Session
    Description Protocol (SDP)\"]{.refTitle}, [RFC 8858]{.seriesInfo},
    [DOI 10.17487/RFC8858]{.seriesInfo}, January 2021,
    \<<https://www.rfc-editor.org/info/rfc8858>\>.
:   

\[RFC8859\]
:   [Nandakumar, S.]{.refAuthor}, [\"A Framework for Session Description
    Protocol (SDP) Attributes When Multiplexing\"]{.refTitle}, [RFC
    8859]{.seriesInfo}, [DOI 10.17487/RFC8859]{.seriesInfo}, January
    2021, \<<https://www.rfc-editor.org/info/rfc8859>\>.
:   
:::

::: {#section-14.2 .section}
### [14.2.](#section-14.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC3311\]
:   [Rosenberg, J.]{.refAuthor}, [\"The Session Initiation Protocol
    (SIP) UPDATE Method\"]{.refTitle}, [RFC 3311]{.seriesInfo}, [DOI
    10.17487/RFC3311]{.seriesInfo}, October 2002,
    \<<https://www.rfc-editor.org/info/rfc3311>\>.
:   

\[RFC3840\]
:   [Rosenberg, J.]{.refAuthor}[, Schulzrinne, H.]{.refAuthor}[, and P.
    Kyzivat]{.refAuthor}, [\"Indicating User Agent Capabilities in the
    Session Initiation Protocol (SIP)\"]{.refTitle}, [RFC
    3840]{.seriesInfo}, [DOI 10.17487/RFC3840]{.seriesInfo}, August
    2004, \<<https://www.rfc-editor.org/info/rfc3840>\>.
:   

\[RFC5389\]
:   [Rosenberg, J.]{.refAuthor}[, Mahy, R.]{.refAuthor}[,
    Matthews, P.]{.refAuthor}[, and D. Wing]{.refAuthor}, [\"Session
    Traversal Utilities for NAT (STUN)\"]{.refTitle}, [RFC
    5389]{.seriesInfo}, [DOI 10.17487/RFC5389]{.seriesInfo}, October
    2008, \<<https://www.rfc-editor.org/info/rfc5389>\>.
:   

\[RFC5627\]
:   [Rosenberg, J.]{.refAuthor}, [\"Obtaining and Using Globally
    Routable User Agent URIs (GRUUs) in the Session Initiation Protocol
    (SIP)\"]{.refTitle}, [RFC 5627]{.seriesInfo}, [DOI
    10.17487/RFC5627]{.seriesInfo}, October 2009,
    \<<https://www.rfc-editor.org/info/rfc5627>\>.
:   

\[RFC5766\]
:   [Mahy, R.]{.refAuthor}[, Matthews, P.]{.refAuthor}[, and J.
    Rosenberg]{.refAuthor}, [\"Traversal Using Relays around NAT (TURN):
    Relay Extensions to Session Traversal Utilities for NAT
    (STUN)\"]{.refTitle}, [RFC 5766]{.seriesInfo}, [DOI
    10.17487/RFC5766]{.seriesInfo}, April 2010,
    \<<https://www.rfc-editor.org/info/rfc5766>\>.
:   
:::
:::

::: {#section-appendix.a .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The authors like to thank [Flemming Andreasen]{.contact-name}, [Ayush
Jain]{.contact-name}, [Paul Kyzivat]{.contact-name}, [Jonathan
Lennox]{.contact-name}, [Simon Perreault]{.contact-name}, [Roman
Shpount]{.contact-name}, and [Martin Thomson]{.contact-name} for
reviewing and/or making various suggestions for improvements and
optimizations.[¶](#section-appendix.a-1){.pilcrow}

The authors also like to thank [Flemming Andreasen]{.contact-name} for
shepherding this document and [Ben Campbell]{.contact-name} for his AD
review and suggestions. In addition, the authors thank [Benjamin
Kaduk]{.contact-name}, [Adam Roach]{.contact-name}, [Mirja
Kühlewind]{.contact-name}, and [Eric Rescorla]{.contact-name} for their
comments and/or text proposals for improving the document during IESG
review.[¶](#section-appendix.a-2){.pilcrow}

Many thanks to [Dale Worley]{.contact-name} for the Gen-Art review and
proposed enhancements for several
sections.[¶](#section-appendix.a-3){.pilcrow}

Many thanks to [Joerg Ott]{.contact-name} for the TSV-Art review and
suggested improvements.[¶](#section-appendix.a-4){.pilcrow}

The authors thank [Shawn Emery]{.contact-name} for the Security
Directorate review.[¶](#section-appendix.a-5){.pilcrow}
:::

::: {#authors-addresses}
::: {#section-appendix.b .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Emil Ivov]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Jitsi]{.org}
:::

::: {.left dir="auto"}
[67000]{.postal-code} [Strasbourg]{.locality}
:::

::: {.left dir="auto"}
[France]{.country-name}
:::

::: tel
Phone: [+33 6 72 81 15 55](tel:+33%206%2072%2081%2015%2055){.tel}
:::

::: email
Email: <emcho@jitsi.org>
:::

::: {.left dir="auto"}
[Thomas Stach]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Unaffiliated]{.org}
:::

::: {.left dir="auto"}
[1130]{.postal-code} [Vienna]{.locality}
:::

::: {.left dir="auto"}
[Austria]{.country-name}
:::

::: email
Email: <thomass.stach@gmail.com>
:::

::: {.left dir="auto"}
[Enrico Marocco]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Telecom Italia]{.org}
:::

::: {.left dir="auto"}
[Via G. Reiss Romoli, 274]{.street-address}
:::

::: {.left dir="auto"}
[10148]{.postal-code} [Turin]{.locality}
:::

::: {.left dir="auto"}
[Italy]{.country-name}
:::

::: email
Email: <enrico.marocco@telecomitalia.it>
:::

::: {.left dir="auto"}
[Christer Holmberg]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Ericsson]{.org}
:::

::: {.left dir="auto"}
[Hirsalantie 11]{.street-address}
:::

::: {.left dir="auto"}
FI-[02420]{.postal-code} [Jorvas]{.locality}
:::

::: {.left dir="auto"}
[Finland]{.country-name}
:::

::: email
Email: <christer.holmberg@ericsson.com>
:::
:::
:::
