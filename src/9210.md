  RFC 9210             DNS Transport over TCP   March 2022
  -------------------- ------------------------ ------------
  Kristoff & Wessels   Best Current Practice    \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9210](https://www.rfc-editor.org/rfc/rfc9210){.eref}

BCP:
:   235

Updates:
:   [1123](https://www.rfc-editor.org/rfc/rfc1123){.eref},
    [1536](https://www.rfc-editor.org/rfc/rfc1536){.eref}

Category:
:   Best Current Practice

Published:
:   March 2022

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    J. Kristoff
    :::

    ::: org
    Dataplane.org
    :::
    :::

    ::: author
    ::: author-name
    D. Wessels
    :::

    ::: org
    Verisign
    :::
    :::
:::

# RFC 9210 {#rfcnum}

# DNS Transport over TCP - Operational Requirements {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document updates RFCs 1123 and 1536. This document requires the
operational practice of permitting DNS messages to be carried over TCP
on the Internet as a Best Current Practice. This operational requirement
is aligned with the implementation requirements in RFC 7766. The use of
TCP includes both DNS over unencrypted TCP as well as over an encrypted
TLS session. The document also considers the consequences of this form
of DNS communication and the potential operational issues that can arise
when this Best Current Practice is not
upheld.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This memo documents an Internet Best Current
Practice.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on BCPs
is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9210>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2022 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Revised BSD License text as described in Section 4.e of the Trust Legal
Provisions and are provided without warranty as described in the Revised
BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Requirements
        Language](#name-requirements-language){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [History of DNS over
    TCP](#name-history-of-dns-over-tcp){.xref}

    -   ::: {#section-toc.1-1.2.2.1}
        [2.1](#section-2.1){.xref}.  [Uneven Transport Usage and
        Preference](#name-uneven-transport-usage-and-){.xref}
        :::

    -   ::: {#section-toc.1-1.2.2.2}
        [2.2](#section-2.2){.xref}.  [Waiting for Large Messages and
        Reliability](#name-waiting-for-large-messages-){.xref}
        :::

    -   ::: {#section-toc.1-1.2.2.3}
        [2.3](#section-2.3){.xref}.  [EDNS(0)](#name-edns0){.xref}
        :::

    -   ::: {#section-toc.1-1.2.2.4}
        [2.4](#section-2.4){.xref}.  [Fragmentation and
        Truncation](#name-fragmentation-and-truncatio){.xref}
        :::

    -   ::: {#section-toc.1-1.2.2.5}
        [2.5](#section-2.5){.xref}.  [\"Only Zone Transfers Use
        TCP\"](#name-only-zone-transfers-use-tcp){.xref}
        :::

    -   ::: {#section-toc.1-1.2.2.6}
        [2.6](#section-2.6){.xref}.  [Reuse, Pipelining, and
        Out-of-Order
        Processing](#name-reuse-pipelining-and-out-of){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [DNS-over-TCP
    Requirements](#name-dns-over-tcp-requirements){.xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Network and System
    Considerations](#name-network-and-system-consider){.xref}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [Connection Establishment and
        Admission](#name-connection-establishment-an){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [Connection
        Management](#name-connection-management){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [Connection
        Termination](#name-connection-termination){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.xref}.  [DNS over
        TLS](#name-dns-over-tls){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.5}
        [4.5](#section-4.5){.xref}.  [Defaults and Recommended
        Limits](#name-defaults-and-recommended-li){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [DNS-over-TCP Filtering
    Risks](#name-dns-over-tcp-filtering-risk){.xref}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [Truncation, Retries, and
        Timeouts](#name-truncation-retries-and-time){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [DNS Root Zone KSK
        Rollover](#name-dns-root-zone-ksk-rollover){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Logging and
    Monitoring](#name-logging-and-monitoring){.xref}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [Privacy
    Considerations](#name-privacy-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [References](#name-references){.xref}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [Normative
        References](#name-normative-references){.xref}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Informative
        References](#name-informative-references){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [Appendix A](#appendix-A){.xref}.  [RFCs Related to DNS Transport
    over TCP](#name-rfcs-related-to-dns-transpo){.xref}

    -   ::: {#section-toc.1-1.11.2.1}
        [A.1](#appendix-A.1){.xref}.  [RFC 1035 - DOMAIN NAMES -
        IMPLEMENTATION AND
        SPECIFICATION](#name-rfc-1035-domain-names-imple){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.2}
        [A.2](#appendix-A.2){.xref}.  [RFC 1536 - Common DNS
        Implementation Errors and Suggested
        Fixes](#name-rfc-1536-common-dns-impleme){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.3}
        [A.3](#appendix-A.3){.xref}.  [RFC 1995 - Incremental Zone
        Transfer in DNS](#name-rfc-1995-incremental-zone-t){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.4}
        [A.4](#appendix-A.4){.xref}.  [RFC 1996 - A Mechanism for Prompt
        Notification of Zone Changes (DNS
        NOTIFY)](#name-rfc-1996-a-mechanism-for-pr){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.5}
        [A.5](#appendix-A.5){.xref}.  [RFC 2181 - Clarifications to the
        DNS Specification](#name-rfc-2181-clarifications-to-){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.6}
        [A.6](#appendix-A.6){.xref}.  [RFC 2694 - DNS extensions to
        Network Address Translators
        (DNS_ALG)](#name-rfc-2694-dns-extensions-to-){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.7}
        [A.7](#appendix-A.7){.xref}.  [RFC 3225 - Indicating Resolver
        Support of DNSSEC](#name-rfc-3225-indicating-resolve){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.8}
        [A.8](#appendix-A.8){.xref}.  [RFC 3226 - DNSSEC and IPv6 A6
        aware server/resolver message size
        requirements](#name-rfc-3226-dnssec-and-ipv6-a6){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.9}
        [A.9](#appendix-A.9){.xref}.  [RFC 4472 - Operational
        Considerations and Issues with IPv6
        DNS](#name-rfc-4472-operational-consid){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.10}
        [A.10](#appendix-A.10){.xref}. [RFC 5452 - Measures for Making
        DNS More Resilient against Forged
        Answers](#name-rfc-5452-measures-for-makin){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.11}
        [A.11](#appendix-A.11){.xref}. [RFC 5507 - Design Choices When
        Expanding the DNS](#name-rfc-5507-design-choices-whe){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.12}
        [A.12](#appendix-A.12){.xref}. [RFC 5625 - DNS Proxy
        Implementation
        Guidelines](#name-rfc-5625-dns-proxy-implemen){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.13}
        [A.13](#appendix-A.13){.xref}. [RFC 5936 - DNS Zone Transfer
        Protocol (AXFR)](#name-rfc-5936-dns-zone-transfer-){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.14}
        [A.14](#appendix-A.14){.xref}. [RFC 7534 - AS112 Nameserver
        Operations](#name-rfc-7534-as112-nameserver-o){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.15}
        [A.15](#appendix-A.15){.xref}. [RFC 6762 - Multicast
        DNS](#name-rfc-6762-multicast-dns){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.16}
        [A.16](#appendix-A.16){.xref}. [RFC 6891 - Extension Mechanisms
        for DNS (EDNS(0))](#name-rfc-6891-extension-mechanis){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.17}
        [A.17](#appendix-A.17){.xref}. [IAB RFC 6950 - Architectural
        Considerations on Application Features in the
        DNS](#name-iab-rfc-6950-architectural-){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.18}
        [A.18](#appendix-A.18){.xref}. [RFC 7477 - Child-to-Parent
        Synchronization in
        DNS](#name-rfc-7477-child-to-parent-sy){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.19}
        [A.19](#appendix-A.19){.xref}. [RFC 7720 - DNS Root Name Service
        Protocol and Deployment
        Requirements](#name-rfc-7720-dns-root-name-serv){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.20}
        [A.20](#appendix-A.20){.xref}. [RFC 7766 - DNS Transport over
        TCP - Implementation
        Requirements](#name-rfc-7766-dns-transport-over){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.21}
        [A.21](#appendix-A.21){.xref}. [RFC 7828 - The
        edns-tcp-keepalive EDNS(0)
        Option](#name-rfc-7828-the-edns-tcp-keepa){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.22}
        [A.22](#appendix-A.22){.xref}. [RFC 7858 - Specification for DNS
        over Transport Layer Security
        (TLS)](#name-rfc-7858-specification-for-){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.23}
        [A.23](#appendix-A.23){.xref}. [RFC 7873 - Domain Name System
        (DNS) Cookies](#name-rfc-7873-domain-name-system){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.24}
        [A.24](#appendix-A.24){.xref}. [RFC 7901 - CHAIN Query Requests
        in DNS](#name-rfc-7901-chain-query-reques){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.25}
        [A.25](#appendix-A.25){.xref}. [RFC 8027 - DNSSEC Roadblock
        Avoidance](#name-rfc-8027-dnssec-roadblock-a){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.26}
        [A.26](#appendix-A.26){.xref}. [RFC 8094 - DNS over Datagram
        Transport Layer Security
        (DTLS)](#name-rfc-8094-dns-over-datagram-){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.27}
        [A.27](#appendix-A.27){.xref}. [RFC 8162 - Using Secure DNS to
        Associate Certificates with Domain Names for
        S/MIME](#name-rfc-8162-using-secure-dns-t){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.28}
        [A.28](#appendix-A.28){.xref}. [RFC 8324 - DNS Privacy,
        Authorization, Special Uses, Encoding, Characters, Matching, and
        Root Structure: Time for Another
        Look?](#name-rfc-8324-dns-privacy-author){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.29}
        [A.29](#appendix-A.29){.xref}. [RFC 8467 - Padding Policies for
        Extension Mechanisms for DNS
        (EDNS(0))](#name-rfc-8467-padding-policies-f){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.30}
        [A.30](#appendix-A.30){.xref}. [RFC 8482 - Providing
        Minimal-Sized Responses to DNS Queries That Have
        QTYPE=ANY](#name-rfc-8482-providing-minimal-){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.31}
        [A.31](#appendix-A.31){.xref}. [RFC 8483 - Yeti DNS
        Testbed](#name-rfc-8483-yeti-dns-testbed){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.32}
        [A.32](#appendix-A.32){.xref}. [RFC 8484 - DNS Queries over
        HTTPS (DoH)](#name-rfc-8484-dns-queries-over-h){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.33}
        [A.33](#appendix-A.33){.xref}. [RFC 8490 - DNS Stateful
        Operations](#name-rfc-8490-dns-stateful-opera){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.34}
        [A.34](#appendix-A.34){.xref}. [RFC 8501 - Reverse DNS in IPv6
        for Internet Service
        Providers](#name-rfc-8501-reverse-dns-in-ipv){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.35}
        [A.35](#appendix-A.35){.xref}. [RFC 8806 - Running a Root Server
        Local to a Resolver](#name-rfc-8806-running-a-root-ser){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.36}
        [A.36](#appendix-A.36){.xref}. [RFC 8906 - A Common Operational
        Problem in DNS Servers: Failure to
        Communicate](#name-rfc-8906-a-common-operation){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.37}
        [A.37](#appendix-A.37){.xref}. [RFC 8932 - Recommendations for
        DNS Privacy Service
        Operators](#name-rfc-8932-recommendations-fo){.xref}
        :::

    -   ::: {#section-toc.1-1.11.2.38}
        [A.38](#appendix-A.38){.xref}. [RFC 8945 - Secret Key
        Transaction Authentication for DNS
        (TSIG)](#name-rfc-8945-secret-key-transac){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.12}
    [](#appendix-B){.xref}[Acknowledgments](#name-acknowledgments){.xref}
    :::

-   ::: {#section-toc.1-1.13}
    [](#appendix-C){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

DNS messages are delivered using UDP or TCP communications. While most
DNS transactions are carried over UDP, some operators have been led to
believe that any DNS-over-TCP traffic is unwanted or unnecessary for
general DNS operation. When DNS over TCP has been restricted, a variety
of communication failures and debugging challenges often arise. As DNS
and new naming system features have evolved, TCP as a transport has
become increasingly important for the correct and safe operation of an
Internet DNS. Reflecting modern usage, the DNS standards declare that
support for TCP is a required part of the DNS implementation
specifications \[[RFC7766](#RFC7766){.xref}\]. This document is the
equivalent of formal requirements for the operational community,
encouraging system administrators, network engineers, and security staff
to ensure DNS-over-TCP communications support is on par with
DNS-over-UDP communications. It updates \[[RFC1123](#RFC1123){.xref}\],
[Section
6.1.3.2](https://www.rfc-editor.org/rfc/rfc1123#section-6.1.3.2){.relref}
to clarify that all DNS resolvers and recursive servers [MUST]{.bcp14}
support and service both TCP and UDP queries and also updates
\[[RFC1536](#RFC1536){.xref}\] to remove the misconception that TCP is
only useful for zone transfers.[¶](#section-1-1){.pilcrow}

::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-1.1-1){.pilcrow}
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [History of DNS over TCP](#name-history-of-dns-over-tcp){.section-name .selfRef} {#name-history-of-dns-over-tcp}

The curious state of disagreement between operational best practices and
guidance for DNS transport protocols derives from conflicting messages
operators have received from other operators, implementors, and even the
IETF. Sometimes these mixed signals have been explicit; on other
occasions, conflicting messages have been implicit. This section
presents an interpretation of the storied and conflicting history that
led to this document. This section is included for informational
purposes only.[¶](#section-2-1){.pilcrow}

::: {#section-2.1 .section}
### [2.1.](#section-2.1){.section-number .selfRef} [Uneven Transport Usage and Preference](#name-uneven-transport-usage-and-){.section-name .selfRef} {#name-uneven-transport-usage-and-}

In the original suite of DNS specifications,
\[[RFC1034](#RFC1034){.xref}\] and \[[RFC1035](#RFC1035){.xref}\]
clearly specify that DNS messages could be carried in either UDP or TCP,
but they also state that there is a preference for UDP as the best
transport for queries in the general case. As stated in
\[[RFC1035](#RFC1035){.xref}\]:[¶](#section-2.1-1){.pilcrow}

> While virtual circuits can be used for any DNS activity, datagrams are
> preferred for queries due to their lower overhead and better
> performance.[¶](#section-2.1-2){.pilcrow}

Another early, important, and influential document,
\[[RFC1123](#RFC1123){.xref}\], marks the preference for a transport
protocol more explicitly:[¶](#section-2.1-3){.pilcrow}

> DNS resolvers and recursive servers [MUST]{.bcp14} support UDP, and
> [SHOULD]{.bcp14} support TCP, for sending (non-zone-transfer)
> queries.[¶](#section-2.1-4){.pilcrow}

and it further stipulates that:[¶](#section-2.1-5){.pilcrow}

> A name server [MAY]{.bcp14} limit the resources it devotes to TCP
> queries, but it [SHOULD NOT]{.bcp14} refuse to service a TCP query
> just because it would have succeeded with
> UDP.[¶](#section-2.1-6){.pilcrow}

Culminating in \[[RFC1536](#RFC1536){.xref}\], DNS over TCP came to be
associated primarily with the zone transfer mechanism, while most DNS
queries and responses were seen as the dominion of
UDP.[¶](#section-2.1-7){.pilcrow}
:::

::: {#section-2.2 .section}
### [2.2.](#section-2.2){.section-number .selfRef} [Waiting for Large Messages and Reliability](#name-waiting-for-large-messages-){.section-name .selfRef} {#name-waiting-for-large-messages-}

In the original specifications, the maximum DNS-over-UDP message size
was enshrined at 512 bytes. However, even while
\[[RFC1123](#RFC1123){.xref}\] prefers UDP for non-zone transfer
queries, it foresaw that DNS over TCP would become more popular in the
future to overcome this limitation:[¶](#section-2.2-1){.pilcrow}

> \[\...\] it is also clear that some new DNS record types defined in
> the future will contain information exceeding the 512 byte limit that
> applies to UDP, and hence will require
> TCP.[¶](#section-2.2-2){.pilcrow}

At least two new, widely anticipated developments were set to elevate
the need for DNS-over-TCP transactions. The first was dynamic updates
defined in \[[RFC2136](#RFC2136){.xref}\], and the second was the set of
extensions collectively known as \"DNSSEC\", whose operational
considerations were originally given in \[[RFC2541](#RFC2541){.xref}\]
(note that \[[RFC2541](#RFC2541){.xref}\] has been obsoleted by
\[[RFC6781](#RFC6781){.xref}\]). The former suggests
that[¶](#section-2.2-3){.pilcrow}

> \...requestors who require an accurate response code must use
> TCP.[¶](#section-2.2-4){.pilcrow}

while the latter warns that[¶](#section-2.2-5){.pilcrow}

> \... larger keys increase the size of the KEY and SIG RRs. This
> increases the chance of DNS UDP packet overflow and the possible
> necessity for using higher overhead TCP in
> responses.[¶](#section-2.2-6){.pilcrow}

Yet, defying some expectations, DNS over TCP remained little used in
real traffic across the Internet in the late 1990s. Dynamic updates saw
little deployment between autonomous networks. Around the time DNSSEC
was first defined, another new feature helped solidify UDP transport
dominance for message transactions.[¶](#section-2.2-7){.pilcrow}
:::

::: {#section-2.3 .section}
### [2.3.](#section-2.3){.section-number .selfRef} [EDNS(0)](#name-edns0){.section-name .selfRef} {#name-edns0}

In 1999, the IETF published the Extension Mechanisms for DNS (EDNS(0))
in \[[RFC2671](#RFC2671){.xref}\] (which was obsoleted by
\[[RFC6891](#RFC6891){.xref}\] in 2013). That document standardized a
way for communicating DNS nodes to perform rudimentary capabilities
negotiation. One such capability written into the base specification and
present in every EDNS(0)-compatible message is the value of the maximum
UDP payload size the sender can support. This unsigned 16-bit field
specifies, in bytes, the maximum (possibly fragmented) DNS message size
a node is capable of receiving over UDP. In practice, typical values are
a subset of the 512- to 4096-byte range. EDNS(0) became widely deployed
over the next several years, and numerous surveys (see
\[[CASTRO2010](#CASTRO2010){.xref}\] and
\[[NETALYZR](#NETALYZR){.xref}\]) have shown that many systems support
larger UDP MTUs with EDNS(0).[¶](#section-2.3-1){.pilcrow}

The natural effect of EDNS(0) deployment meant DNS messages larger than
512 bytes would be less reliant on TCP than they might otherwise have
been. While a non-negligible population of DNS systems lacked EDNS(0) or
fell back to TCP when necessary, DNS clients still strongly prefer UDP
to TCP. For example, as of 2014, DNS-over-TCP transactions remained a
very small fraction of overall DNS traffic received by root name servers
\[[VERISIGN](#VERISIGN){.xref}\].[¶](#section-2.3-2){.pilcrow}
:::

::: {#section-2.4 .section}
### [2.4.](#section-2.4){.section-number .selfRef} [Fragmentation and Truncation](#name-fragmentation-and-truncatio){.section-name .selfRef} {#name-fragmentation-and-truncatio}

Although EDNS(0) provides a way for endpoints to signal support for DNS
messages exceeding 512 bytes, the realities of a diverse and
inconsistently deployed Internet may result in some large messages being
unable to reach their destination. Any IP datagram whose size exceeds
the MTU of a link it transits will be fragmented and then reassembled by
the receiving host. Unfortunately, it is not uncommon for middleboxes
and firewalls to block IP fragments. If one or more fragments do not
arrive, the application does not receive the message, and the request
times out.[¶](#section-2.4-1){.pilcrow}

For IPv4-connected hosts, the MTU is often an Ethernet payload size of
1500 bytes. This means that the largest unfragmented UDP DNS message
that can be sent over IPv4 is likely 1472 bytes, although tunnel
encapsulation may reduce that maximum message size in some
cases.[¶](#section-2.4-2){.pilcrow}

For IPv6, the situation is a little more complicated. First, IPv6
headers are 40 bytes (versus 20 without options in IPv4). Second,
approximately one-third of DNS recursive resolvers use the minimum MTU
of 1280 bytes \[[APNIC](#APNIC){.xref}\]. Third, fragmentation in IPv6
can only be done by the host originating the datagram. The need to
fragment is conveyed in an ICMPv6 \"Packet Too Big\" message. The
originating host indicates a fragmented datagram with IPv6 extension
headers. Unfortunately, it is quite common for both ICMPv6 and IPv6
extension headers to be blocked by middleboxes. According to
\[[HUSTON](#HUSTON){.xref}\], some 35% of IPv6-capable recursive
resolvers were unable to receive a fragmented IPv6 packet. When the
originating host receives a signal that fragmentation is required, it is
expected to populate its path MTU cache for that destination. The
application will then retry the query after a timeout since the host
does not generally retain copies of messages sent over UDP for potential
retransmission.[¶](#section-2.4-3){.pilcrow}

The practical consequence of all this is that DNS requestors must be
prepared to retry queries with different EDNS(0) maximum message size
values. Administrators of \[[BIND](#BIND){.xref}\] are likely to be
familiar with seeing the following message in their system logs:
\"success resolving \... after reducing the advertised EDNS(0) UDP
packet size to 512 octets\".[¶](#section-2.4-4){.pilcrow}

Often, reducing the EDNS(0) UDP packet size leads to a successful
response. That is, the necessary data fits within the smaller message
size. However, when the data does not fit, the server sets the truncated
flag in its response, indicating the client should retry over TCP to
receive the whole response. This is undesirable from the client\'s point
of view because it adds more latency and is potentially undesirable from
the server\'s point of view due to the increased resource requirements
of TCP.[¶](#section-2.4-5){.pilcrow}

Note that a receiver is unable to differentiate between packets lost due
to congestion and packets (fragments) intentionally dropped by firewalls
or middleboxes. Over network paths with non-trivial amounts of packet
loss, larger, fragmented DNS responses are more likely to never arrive
and time out compared to smaller, unfragmented responses. Clients might
be misled into retrying queries with different EDNS(0) UDP packet size
values for the wrong reason.[¶](#section-2.4-6){.pilcrow}

The issues around fragmentation, truncation, and TCP are driving certain
implementation and policy decisions in the DNS. Notably, Cloudflare
implemented a technique that minimizes the number of DNSSEC
denial-of-existence records (for its online signing platform)
\[[CLOUDFLARE](#CLOUDFLARE){.xref}\] and uses an Elliptic Curve Digital
Signature Algorithm (ECDSA) such that its signed responses fit easily in
512 bytes. The Key Signing Key (KSK) Rollover Design Team
\[[DESIGNTEAM](#DESIGNTEAM){.xref}\] spent a lot of time thinking and
worrying about response sizes. There is growing sentiment in the DNSSEC
community that RSA key sizes beyond 2048 bits are impractical and that
critical infrastructure zones should transition to elliptic curve
algorithms to keep response sizes manageable
\[[ECDSA](#ECDSA){.xref}\].[¶](#section-2.4-7){.pilcrow}

More recently, renewed security concerns about fragmented DNS messages
(see \[[AVOID_FRAGS](#I-D.ietf-dnsop-avoid-fragmentation){.xref}\] and
\[[FRAG_POISON](#FRAG_POISON){.xref}\]) are leading implementors to
consider smaller responses and lower default EDNS(0) UDP payload size
values for both queriers and responders
\[[FLAGDAY2020](#FLAGDAY2020){.xref}\].[¶](#section-2.4-8){.pilcrow}
:::

::: {#section-2.5 .section}
### [2.5.](#section-2.5){.section-number .selfRef} [\"Only Zone Transfers Use TCP\"](#name-only-zone-transfers-use-tcp){.section-name .selfRef} {#name-only-zone-transfers-use-tcp}

Today, the majority of the DNS community expects, or at least has a
desire, to see DNS-over-TCP transactions occur without interference
\[[FLAGDAY2020](#FLAGDAY2020){.xref}\]. However, there has also been a
long-held belief by some operators, particularly for security-related
reasons, that DNS-over-TCP services should be purposely limited or not
provided at all \[[CHES94](#CHES94){.xref}\]
\[[DJBDNS](#DJBDNS){.xref}\]. A popular meme is that DNS over TCP is
only ever used for zone transfers and is generally unnecessary
otherwise, with filtering all DNS-over-TCP traffic even described as a
best practice.[¶](#section-2.5-1){.pilcrow}

The position on restricting DNS over TCP had some justification given
that historical implementations of DNS name servers provided very little
in the way of TCP connection management (for example, see [Section
6.1.2](https://www.rfc-editor.org/rfc/rfc7766#section-6.1.2){.relref} of
\[[RFC7766](#RFC7766){.xref}\] for more details). However, modern
standards and implementations are nearing parity with the more
sophisticated TCP management techniques employed by, for example,
HTTP(S) servers and load balancers.[¶](#section-2.5-2){.pilcrow}
:::

::: {#section-2.6 .section}
### [2.6.](#section-2.6){.section-number .selfRef} [Reuse, Pipelining, and Out-of-Order Processing](#name-reuse-pipelining-and-out-of){.section-name .selfRef} {#name-reuse-pipelining-and-out-of}

The idea that a TCP connection can support multiple transactions goes
back as far as \[[RFC0883](#RFC0883){.xref}\], which states: \"Multiple
messages may be sent over a virtual circuit.\" Although
\[[RFC1035](#RFC1035){.xref}\], which updates the former, omits this
particular detail, it has been generally accepted that a TCP connection
can be used for more than one query and
response.[¶](#section-2.6-1){.pilcrow}

\[[RFC5966](#RFC5966){.xref}\] clarifies that servers are not required
to preserve the order of queries and responses over any transport.
\[[RFC7766](#RFC7766){.xref}\], which updates the former, further
encourages query pipelining over TCP to achieve performance on par with
UDP. A server that sends out-of-order responses to pipelined queries
avoids head-of-line blocking when the response for a later query is
ready before the response to an earlier
query.[¶](#section-2.6-2){.pilcrow}

However, TCP can potentially suffer from a different head-of-line
blocking problem due to packet loss. Since TCP itself enforces ordering,
a single lost segment delays delivery of data in any following segments
until the lost segment is retransmitted and successfully
received.[¶](#section-2.6-3){.pilcrow}
:::
:::

::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [DNS-over-TCP Requirements](#name-dns-over-tcp-requirements){.section-name .selfRef} {#name-dns-over-tcp-requirements}

An average increase in DNS message size (e.g., due to DNSSEC), the
continued development of new DNS features ([Appendix
A](#dnsrfcs){.xref}), and a denial-of-service mitigation technique
([Section 8](#Security){.xref}) all show that DNS-over-TCP transactions
are as important to the correct and safe operation of the Internet DNS
as ever, if not more so. Furthermore, there has been research that
argues connection-oriented DNS transactions may provide security and
privacy advantages over UDP transport \[[TDNS](#TDNS){.xref}\]. In fact,
the standard for DNS over TLS \[[RFC7858](#RFC7858){.xref}\] is just
this sort of specification. Therefore, this document makes explicit that
it is undesirable for network operators to artificially inhibit
DNS-over-TCP transport.[¶](#section-3-1){.pilcrow}

[Section
6.1.3.2](https://www.rfc-editor.org/rfc/rfc1123#section-6.1.3.2){.relref}
of \[[RFC1123](#RFC1123){.xref}\] is updated as
follows:[¶](#section-3-2){.pilcrow}

OLD:[¶](#section-3-3){.pilcrow}

> DNS resolvers and recursive servers [MUST]{.bcp14} support UDP, and
> [SHOULD]{.bcp14} support TCP, for sending (non-zone-transfer)
> queries.[¶](#section-3-4){.pilcrow}

NEW:[¶](#section-3-5){.pilcrow}

> All DNS resolvers and servers [MUST]{.bcp14} support and service both
> UDP and TCP queries.[¶](#section-3-6){.pilcrow}

Note that:[¶](#section-3-7){.pilcrow}

-   [DNS servers (including forwarders) [MUST]{.bcp14} support and
    service TCP for receiving queries so that clients can reliably
    receive responses that are larger than what either side considers
    too large for UDP.[¶](#section-3-8.1){.pilcrow}]{#section-3-8.1}
-   [DNS clients [MUST]{.bcp14} support TCP for sending queries so that
    they can retry truncated UDP responses as
    necessary.[¶](#section-3-8.2){.pilcrow}]{#section-3-8.2}

Furthermore, the requirement in [Section
6.1.3.2](https://www.rfc-editor.org/rfc/rfc1123#section-6.1.3.2){.relref}
of \[[RFC1123](#RFC1123){.xref}\] around limiting the resources a server
devotes to queries is hereby updated:[¶](#section-3-9){.pilcrow}

OLD:[¶](#section-3-10){.pilcrow}

> A name server [MAY]{.bcp14} limit the resources it devotes to TCP
> queries, but it [SHOULD NOT]{.bcp14} refuse to service a TCP query
> just because it would have succeeded with
> UDP.[¶](#section-3-11){.pilcrow}

NEW:[¶](#section-3-12){.pilcrow}

> A name server [MAY]{.bcp14} limit the resources it devotes to queries,
> but it [MUST NOT]{.bcp14} refuse to service a query just because it
> would have succeeded with another transport
> protocol.[¶](#section-3-13){.pilcrow}

Lastly, [Section
1](https://www.rfc-editor.org/rfc/rfc1536#section-1){.relref} of
\[[RFC1536](#RFC1536){.xref}\] is updated to eliminate the misconception
that TCP is only useful for zone transfers:[¶](#section-3-14){.pilcrow}

OLD:[¶](#section-3-15){.pilcrow}

> DNS implements the classic request-response scheme of client-server
> interaction. UDP is, therefore, the chosen protocol for communication
> though TCP is used for zone transfers.[¶](#section-3-16){.pilcrow}

NEW:[¶](#section-3-17){.pilcrow}

> DNS implements the classic request-response scheme of client-server
> interaction.[¶](#section-3-18){.pilcrow}

The filtering of DNS over TCP is harmful in the general case. DNS
resolver and server operators [MUST]{.bcp14} support and provide DNS
service over both UDP and TCP transports. Likewise, network operators
[MUST]{.bcp14} allow DNS service over both UDP and TCP transports. It is
acknowledged that DNS-over-TCP service can pose operational challenges
that are not present when running DNS over UDP alone, and vice versa.
However, the potential damage incurred by prohibiting DNS-over-TCP
service is more detrimental to the continued utility and success of the
DNS than when its usage is allowed.[¶](#section-3-19){.pilcrow}
:::

::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Network and System Considerations](#name-network-and-system-consider){.section-name .selfRef} {#name-network-and-system-consider}

This section describes measures that systems and applications can take
to optimize performance over TCP and to protect themselves from
TCP-based resource exhaustion and attacks.[¶](#section-4-1){.pilcrow}

::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [Connection Establishment and Admission](#name-connection-establishment-an){.section-name .selfRef} {#name-connection-establishment-an}

Resolvers and other DNS clients should be aware that some servers might
not be reachable over TCP. For this reason, clients [MAY]{.bcp14} track
and limit the number of TCP connections and connection attempts to a
single server. Reachability problems can be caused by network elements
close to the server, close to the client, or anywhere along the path
between them. Mobile clients that cache connection failures
[MAY]{.bcp14} do so on a per-network basis or [MAY]{.bcp14} clear such a
cache upon change of network.[¶](#section-4.1-1){.pilcrow}

Additionally, DNS clients [MAY]{.bcp14} enforce a short timeout on
unestablished connections rather than rely on the host operating
system\'s TCP connection timeout, which is often around 60-120 seconds
(i.e., due to an initial retransmission timeout of 1 second, the
exponential back-off rules of \[[RFC6298](#RFC6298){.xref}\], and a
limit of six retries as is the default in
Linux).[¶](#section-4.1-2){.pilcrow}

The SYN flooding attack is a denial-of-service method affecting hosts
that run TCP server processes \[[RFC4987](#RFC4987){.xref}\]. This
attack can be very effective if not mitigated. One of the most effective
mitigation techniques is SYN cookies, described in [Section
3.6](https://www.rfc-editor.org/rfc/rfc4987#section-3.6){.relref} of
\[[RFC4987](#RFC4987){.xref}\], which allows the server to avoid
allocating any state until the successful completion of the three-way
handshake.[¶](#section-4.1-3){.pilcrow}

Services not intended for use by the public Internet, such as most
recursive name servers, [SHOULD]{.bcp14} be protected with access
controls. Ideally, these controls are placed in the network, well before
any unwanted TCP packets can reach the DNS server host or application.
If this is not possible, the controls can be placed in the application
itself. In some situations (e.g., attacks), it may be necessary to
deploy access controls for DNS services that should otherwise be
globally reachable. See also
\[[RFC5358](#RFC5358){.xref}\].[¶](#section-4.1-4){.pilcrow}

The FreeBSD and NetBSD operating systems have an \"accept filter\"
feature (\[[accept_filter](#accept_filter){.xref}\]) that postpones
delivery of TCP connections to applications until a complete, valid
request has been received. The dns_accf(9) filter ensures that a valid
DNS message is received. If not, the bogus connection never reaches the
application. The Linux TCP_DEFER_ACCEPT feature, while more limited in
scope, can provide some of the same benefits as the BSD accept filter
feature. These features are implemented as low-level socket options and
are not activated automatically. If applications wish to use these
features, they need to make specific calls to set the right options, and
administrators may also need to configure the applications to
appropriately use the features.[¶](#section-4.1-5){.pilcrow}

Per \[[RFC7766](#RFC7766){.xref}\], applications and administrators are
advised to remember that TCP [MAY]{.bcp14} be used before sending any
UDP queries. Networks and applications [MUST NOT]{.bcp14} be configured
to refuse TCP queries that were not preceded by a UDP
query.[¶](#section-4.1-6){.pilcrow}

TCP Fast Open (TFO) \[[RFC7413](#RFC7413){.xref}\] allows TCP clients to
shorten the handshake for subsequent connections to the same server. TFO
saves one round-trip time in the connection setup. DNS servers
[SHOULD]{.bcp14} enable TFO when possible. Furthermore, DNS servers
clustered behind a single service address (e.g., anycast or load
balancing) [SHOULD]{.bcp14} either use the same TFO server key on all
instances or disable TFO for all members of the
cluster.[¶](#section-4.1-7){.pilcrow}

DNS clients [MAY]{.bcp14} also enable TFO. At the time of this writing,
it is not implemented or is disabled by default on some operating
systems. \[[WIKIPEDIA_TFO](#WIKIPEDIA_TFO){.xref}\] describes
applications and operating systems that support
TFO.[¶](#section-4.1-8){.pilcrow}
:::

::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [Connection Management](#name-connection-management){.section-name .selfRef} {#name-connection-management}

Since host memory for TCP state is a finite resource, DNS clients and
servers [SHOULD]{.bcp14} actively manage their connections. Applications
that do not actively manage their connections can encounter resource
exhaustion leading to denial of service. For DNS, as in other protocols,
there is a trade-off between keeping connections open for potential
future use and the need to free up resources for new connections that
will arrive.[¶](#section-4.2-1){.pilcrow}

Operators of DNS server software [SHOULD]{.bcp14} be aware that
operating system and application vendors [MAY]{.bcp14} impose a limit on
the total number of established connections. These limits may be
designed to protect against DDoS attacks or performance degradation.
Operators [SHOULD]{.bcp14} understand how to increase these limits if
necessary and the consequences of doing so. Limits imposed by the
application [SHOULD]{.bcp14} be lower than limits imposed by the
operating system so that the application can apply its own policy to
connection management, such as closing the oldest idle connections
first.[¶](#section-4.2-2){.pilcrow}

DNS server software [MAY]{.bcp14} provide a configurable limit on the
number of established connections per source IP address or subnet. This
can be used to ensure that a single or small set of users cannot consume
all TCP resources and deny service to other users. Note, however, that
if this limit is enabled, it possibly limits client performance while
leaving some TCP resources unutilized. Operators [SHOULD]{.bcp14} be
aware of these trade-offs and ensure this limit, if configured, is set
appropriately based on the number and diversity of their users and
whether users connect from unique IP addresses or through a shared
Network Address Translator (NAT)
\[[RFC3022](#RFC3022){.xref}\].[¶](#section-4.2-3){.pilcrow}

DNS server software [SHOULD]{.bcp14} provide a configurable timeout for
idle TCP connections. This can be used to free up resources for new
connections and to ensure that idle connections are eventually closed.
At the same time, it possibly limits client performance while leaving
some TCP resources unutilized. For very busy name servers, this might be
set to a low value, such as a few seconds. For less busy servers, it
might be set to a higher value, such as tens of seconds. DNS clients and
servers [SHOULD]{.bcp14} signal their timeout values using the
edns-tcp-keepalive EDNS(0) option
\[[RFC7828](#RFC7828){.xref}\].[¶](#section-4.2-4){.pilcrow}

DNS server software [MAY]{.bcp14} provide a configurable limit on the
number of transactions per TCP connection. This can help protect against
unfair connection use (e.g., not releasing connection slots to other
clients) and network evasion attacks.[¶](#section-4.2-5){.pilcrow}

Similarly, DNS server software [MAY]{.bcp14} provide a configurable
limit on the total duration of a TCP connection. This can help protect
against unfair connection use, slow read attacks, and network evasion
attacks.[¶](#section-4.2-6){.pilcrow}

Since clients may not be aware of server-imposed limits, clients
utilizing TCP for DNS need to always be prepared to re-establish
connections or otherwise retry outstanding
queries.[¶](#section-4.2-7){.pilcrow}
:::

::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [Connection Termination](#name-connection-termination){.section-name .selfRef} {#name-connection-termination}

The TCP peer that initiates a connection close retains the socket in the
TIME_WAIT state for some amount of time, possibly a few minutes. It is
generally preferable for clients to initiate the close of a TCP
connection so that busy servers do not accumulate many sockets in the
TIME_WAIT state, which can cause performance problems or even denial of
service. The edns-tcp-keepalive EDNS(0) option
\[[RFC7828](#RFC7828){.xref}\] can be used to encourage clients to close
connections.[¶](#section-4.3-1){.pilcrow}

On systems where large numbers of sockets in TIME_WAIT are observed (as
either a client or a server) and are affecting an application\'s
performance, it may be tempting to tune local TCP parameters. For
example, the Linux kernel has a \"sysctl\" parameter named
net.ipv4.tcp_tw_reuse, which allows connections in the TIME_WAIT state
to be reused in specific circumstances. Note, however, that this affects
only outgoing (client) connections and has no impact on servers. In most
cases, it is [NOT RECOMMENDED]{.bcp14} to change parameters related to
the TIME_WAIT state. It should only be done by those with detailed
knowledge of both TCP and the affected
application.[¶](#section-4.3-2){.pilcrow}
:::

::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [DNS over TLS](#name-dns-over-tls){.section-name .selfRef} {#name-dns-over-tls}

DNS messages may be sent over TLS to provide privacy between stubs and
recursive resolvers. \[[RFC7858](#RFC7858){.xref}\] is a Standards Track
document describing how this works. Although DNS over TLS utilizes TCP
port 853 instead of port 53, this document applies equally well to DNS
over TLS. Note, however, that DNS over TLS is only defined between stubs
and recursives at the time of this writing.[¶](#section-4.4-1){.pilcrow}

The use of TLS places even stronger operational burdens on DNS clients
and servers. Cryptographic functions for authentication and encryption
require additional processing. Unoptimized connection setup with TLS 1.3
\[[RFC8446](#RFC8446){.xref}\] takes one additional round trip compared
to TCP. Connection setup times can be reduced with TCP Fast Open and TLS
False Start \[[RFC7918](#RFC7918){.xref}\] for TLS 1.2. TLS 1.3 session
resumption does not reduce round-trip latency because no application
profile for use of TLS 0-RTT data with DNS has been published at the
time of this writing. However, TLS session resumption can reduce the
number of cryptographic operations, and in TLS 1.2, session resumption
does reduce the number of additional round trips from two to
one.[¶](#section-4.4-2){.pilcrow}
:::

::: {#section-4.5 .section}
### [4.5.](#section-4.5){.section-number .selfRef} [Defaults and Recommended Limits](#name-defaults-and-recommended-li){.section-name .selfRef} {#name-defaults-and-recommended-li}

A survey of features and defaults was conducted for popular open-source
DNS server implementations at the time of writing. This section
documents those defaults and makes recommendations for configurable
limits that can be used in the absence of any other information. Any
recommended values in this document are only intended as a starting
point for administrators that are unsure of what sorts of limits might
be reasonable. Operators [SHOULD]{.bcp14} use application-specific
monitoring, system logs, and system monitoring tools to gauge whether
their service is operating within or exceeding these limits and adjust
accordingly.[¶](#section-4.5-1){.pilcrow}

Most open-source DNS server implementations provide a configurable limit
on the total number of established connections. Default values range
from 20 to 150. In most cases, where the majority of queries take place
over UDP, 150 is a reasonable limit. For services or environments where
most queries take place over TCP or TLS, 5000 is a more appropriate
limit.[¶](#section-4.5-2){.pilcrow}

Only some open-source implementations provide a way to limit the number
of connections per source IP address or subnet, but the default is to
have no limit. For environments or situations where it may be necessary
to enable this limit, 25 connections per source IP address is a
reasonable starting point. The limit should be increased when aggregated
by subnet or for services where most queries take place over TCP or
TLS.[¶](#section-4.5-3){.pilcrow}

Most open-source implementations provide a configurable idle timeout on
connections. Default values range from 2 to 30 seconds. In most cases,
10 seconds is a reasonable default for this limit. Longer timeouts
improve connection reuse, but busy servers may need to use a lower
limit.[¶](#section-4.5-4){.pilcrow}

Only some open-source implementations provide a way to limit the number
of transactions per connection, but the default is to have no limit.
This document does not offer advice on particular values for such a
limit.[¶](#section-4.5-5){.pilcrow}

Only some open-source implementations provide a way to limit the
duration of connection, but the default is to have no limit. This
document does not offer advice on particular values for such a
limit.[¶](#section-4.5-6){.pilcrow}
:::
:::

::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [DNS-over-TCP Filtering Risks](#name-dns-over-tcp-filtering-risk){.section-name .selfRef} {#name-dns-over-tcp-filtering-risk}

Networks that filter DNS over TCP risk losing access to significant or
important pieces of the DNS namespace. For a variety of reasons, a DNS
answer may require a DNS-over-TCP query. This may include large message
sizes, lack of EDNS(0) support, or DDoS mitigation techniques (including
Response Rate Limiting \[[RRL](#RRL){.xref}\]); additionally, perhaps
some future capability that is as yet unforeseen will also demand TCP
transport.[¶](#section-5-1){.pilcrow}

For example, \[[RFC7901](#RFC7901){.xref}\] describes a latency-avoiding
technique that sends extra data in DNS responses. This makes responses
larger and potentially increases the effectiveness of DDoS reflection
attacks. The specification mandates the use of TCP or DNS cookies
\[[RFC7873](#RFC7873){.xref}\].[¶](#section-5-2){.pilcrow}

Even if any or all particular answers have consistently been returned
successfully with UDP in the past, this continued behavior cannot be
guaranteed when DNS messages are exchanged between autonomous systems.
Therefore, filtering of DNS over TCP is considered harmful and contrary
to the safe and successful operation of the Internet. This section
enumerates some of the known risks at the time of this writing when
networks filter DNS over TCP.[¶](#section-5-3){.pilcrow}

::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [Truncation, Retries, and Timeouts](#name-truncation-retries-and-time){.section-name .selfRef} {#name-truncation-retries-and-time}

Networks that filter DNS over TCP may inadvertently cause problems for
third-party resolvers as experienced by \[[TOYAMA](#TOYAMA){.xref}\].
For example, a resolver receives queries for a moderately popular
domain. The resolver forwards the queries to the domain\'s authoritative
name servers, but those servers respond with the TC bit set. The
resolver retries over TCP, but the authoritative server blocks DNS over
TCP. The pending connections consume resources on the resolver until
they time out. If the number and frequency of these
truncated-and-then-blocked queries are sufficiently high, the resolver
wastes valuable resources on queries that can never be answered. This
condition is generally not easily or completely mitigated by the
affected DNS resolver operator.[¶](#section-5.1-1){.pilcrow}
:::

::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [DNS Root Zone KSK Rollover](#name-dns-root-zone-ksk-rollover){.section-name .selfRef} {#name-dns-root-zone-ksk-rollover}

The plans for deploying DNSSEC KSK for the root zone highlighted a
potential problem in retrieving the root zone key set
\[[LEWIS](#LEWIS){.xref}\]. During some phases of the KSK rollover
process, root zone DNSKEY responses were larger than 1280 bytes, the
IPv6 minimum MTU for links carrying IPv6 traffic
\[[RFC8200](#RFC8200){.xref}\]. There was some concern that any DNS
server unable to receive large DNS messages over UDP, or any DNS message
over TCP, would experience disruption while performing DNSSEC validation
\[[KSK_ROLLOVER_ARCHIVES](#KSK_ROLLOVER_ARCHIVES){.xref}\].[¶](#section-5.2-1){.pilcrow}

However, during the year-long postponement of the KSK rollover, there
were no reported problems that could be attributed to the 1414 octet
DNSKEY response when both the old and new keys were published in the
zone. Additionally, there were no reported problems during the two-month
period when the old key was published as revoked and the DNSKEY response
was 1425 octets in size
\[[ROLL_YOUR_ROOT](#ROLL_YOUR_ROOT){.xref}\].[¶](#section-5.2-2){.pilcrow}
:::
:::

::: {#logging-monitoring}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Logging and Monitoring](#name-logging-and-monitoring){.section-name .selfRef} {#name-logging-and-monitoring}

Developers of applications that log or monitor DNS [SHOULD NOT]{.bcp14}
ignore TCP due to the perception that it is rarely used or is hard to
process. Operators [SHOULD]{.bcp14} ensure that their monitoring and
logging applications properly capture DNS messages over TCP. Otherwise,
attacks, exfiltration attempts, and normal traffic may go
undetected.[¶](#section-6-1){.pilcrow}

DNS messages over TCP are in no way guaranteed to arrive in single
segments. In fact, a clever attacker might attempt to hide certain
messages by forcing them over very small TCP segments. Applications that
capture network packets (e.g., with libpcap
\[[libpcap](#libpcap){.xref}\]) [SHOULD]{.bcp14} implement and perform
full TCP stream reassembly and analyze the reassembled stream instead of
the individual packets. Otherwise, they are vulnerable to network
evasion attacks \[[phrack](#phrack){.xref}\]. Furthermore, such
applications need to protect themselves from resource exhaustion attacks
by limiting the amount of memory allocated to tracking unacknowledged
connection state data. dnscap \[[dnscap](#dnscap){.xref}\] is an
open-source example of a DNS logging program that implements TCP stream
reassembly.[¶](#section-6-2){.pilcrow}

Developers [SHOULD]{.bcp14} also keep in mind connection reuse, query
pipelining, and out-of-order responses when building and testing DNS
monitoring applications.[¶](#section-6-3){.pilcrow}

As an alternative to packet capture, some DNS server software supports
dnstap \[[dnstap](#dnstap){.xref}\] as an integrated monitoring protocol
intended to facilitate wide-scale DNS
monitoring.[¶](#section-6-4){.pilcrow}
:::
:::

::: {#IANA}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-7-1){.pilcrow}
:::
:::

::: {#Security}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

This document, providing operational requirements, is the companion to
the implementation requirements of DNS over TCP provided in
\[[RFC7766](#RFC7766){.xref}\]. The security considerations from
\[[RFC7766](#RFC7766){.xref}\] still apply.[¶](#section-8-1){.pilcrow}

Ironically, returning truncated DNS-over-UDP answers in order to induce
a client query to switch to DNS over TCP has become a common response to
source-address-spoofed, DNS denial-of-service attacks
\[[RRL](#RRL){.xref}\]. Historically, operators have been wary of
TCP-based attacks, but in recent years, UDP-based flooding attacks have
proven to be the most common protocol attack on the DNS. Nevertheless, a
high rate of short-lived DNS transactions over TCP may pose challenges.
In fact, \[[DAI21](#DAI21){.xref}\] details a class of IP fragmentation
attacks on DNS transactions if the IP Identifier field (16 bits in IPv4
and 32 bits in IPv6) can be predicted and a system is coerced to
fragment rather than retransmit messages. While many operators have
provided DNS-over-TCP service for many years without duress, past
experience is no guarantee of future success.[¶](#section-8-2){.pilcrow}

DNS over TCP is similar to many other Internet TCP services. TCP threats
and many mitigation strategies have been well documented in a series of
documents such as \[[RFC4953](#RFC4953){.xref}\],
\[[RFC4987](#RFC4987){.xref}\], \[[RFC5927](#RFC5927){.xref}\], and
\[[RFC5961](#RFC5961){.xref}\].[¶](#section-8-3){.pilcrow}

As mentioned in [Section 6](#logging-monitoring){.xref}, applications
that implement TCP stream reassembly need to limit the amount of memory
allocated to connection tracking. A failure to do so could lead to a
total failure of the logging or monitoring application. Imposition of
resource limits creates a trade-off between allowing some stream
reassembly to continue and allowing some evasion attacks to
succeed.[¶](#section-8-4){.pilcrow}

This document recommends that DNS servers enable TFO when possible.
\[[RFC7413](#RFC7413){.xref}\] recommends that a pool of servers behind
a load balancer with a shared server IP address also share the key used
to generate Fast Open cookies to prevent inordinate fallback to the
three-way handshake (3WHS). This guidance remains accurate but comes
with a caveat: compromise of one server would reveal this group-shared
key and allow for attacks involving the other servers in the pool by
forging invalid Fast Open cookies.[¶](#section-8-5){.pilcrow}
:::
:::

::: {#Privacy}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Privacy Considerations](#name-privacy-considerations){.section-name .selfRef} {#name-privacy-considerations}

Since DNS over both UDP and TCP uses the same underlying message format,
the use of one transport instead of the other does not change the
privacy characteristics of the message content (i.e., the name being
queried). A number of protocols have recently been developed to provide
DNS privacy, including DNS over TLS \[[RFC7858](#RFC7858){.xref}\], DNS
over DTLS \[[RFC8094](#RFC8094){.xref}\], DNS over HTTPS
\[[RFC8484](#RFC8484){.xref}\], with even more on the
way.[¶](#section-9-1){.pilcrow}

Because TCP is somewhat more complex than UDP, some characteristics of a
TCP conversation may enable DNS client fingerprinting and tracking that
is not possible with UDP. For example, the choice of initial sequence
numbers, window size, and options might be able to identify a particular
TCP implementation or even individual hosts behind shared resources such
as NATs.[¶](#section-9-2){.pilcrow}
:::
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC1035\]
:   [Mockapetris, P.]{.refAuthor}, [\"Domain names - implementation and
    specification\"]{.refTitle}, [STD 13]{.seriesInfo}, [RFC
    1035]{.seriesInfo}, [DOI 10.17487/RFC1035]{.seriesInfo}, November
    1987, \<<https://www.rfc-editor.org/info/rfc1035>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC2181\]
:   [Elz, R.]{.refAuthor} and [R. Bush]{.refAuthor}, [\"Clarifications
    to the DNS Specification\"]{.refTitle}, [RFC 2181]{.seriesInfo},
    [DOI 10.17487/RFC2181]{.seriesInfo}, July 1997,
    \<<https://www.rfc-editor.org/info/rfc2181>\>.
:   

\[RFC6891\]
:   [Damas, J.]{.refAuthor}, [Graff, M.]{.refAuthor}, and [P.
    Vixie]{.refAuthor}, [\"Extension Mechanisms for DNS
    (EDNS(0))\"]{.refTitle}, [STD 75]{.seriesInfo}, [RFC
    6891]{.seriesInfo}, [DOI 10.17487/RFC6891]{.seriesInfo}, April 2013,
    \<<https://www.rfc-editor.org/info/rfc6891>\>.
:   

\[RFC7766\]
:   [Dickinson, J.]{.refAuthor}, [Dickinson, S.]{.refAuthor},
    [Bellis, R.]{.refAuthor}, [Mankin, A.]{.refAuthor}, and [D.
    Wessels]{.refAuthor}, [\"DNS Transport over TCP - Implementation
    Requirements\"]{.refTitle}, [RFC 7766]{.seriesInfo}, [DOI
    10.17487/RFC7766]{.seriesInfo}, March 2016,
    \<<https://www.rfc-editor.org/info/rfc7766>\>.
:   

\[RFC7828\]
:   [Wouters, P.]{.refAuthor}, [Abley, J.]{.refAuthor},
    [Dickinson, S.]{.refAuthor}, and [R. Bellis]{.refAuthor}, [\"The
    edns-tcp-keepalive EDNS0 Option\"]{.refTitle}, [RFC
    7828]{.seriesInfo}, [DOI 10.17487/RFC7828]{.seriesInfo}, April 2016,
    \<<https://www.rfc-editor.org/info/rfc7828>\>.
:   

\[RFC7873\]
:   [Eastlake 3rd, D.]{.refAuthor} and [M. Andrews]{.refAuthor},
    [\"Domain Name System (DNS) Cookies\"]{.refTitle}, [RFC
    7873]{.seriesInfo}, [DOI 10.17487/RFC7873]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7873>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   
:::

::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[accept_filter\]
:   [FreeBSD]{.refAuthor}, [\"FreeBSD accept_filter(9)\"]{.refTitle},
    June 2000,
    \<<https://www.freebsd.org/cgi/man.cgi?query=accept_filter>\>.
:   

\[APNIC\]
:   [Huston, G.]{.refAuthor}, [\"DNS XL\"]{.refTitle}, October 2020,
    \<<https://labs.apnic.net/?p=1380>\>.
:   

\[AVOID_FRAGS\]
:   [Fujiwara, K.]{.refAuthor} and [P. Vixie]{.refAuthor},
    [\"Fragmentation Avoidance in DNS\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-ietf-dnsop-avoid-fragmentation-06]{.seriesInfo}, 23 December
    2021,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-dnsop-avoid-fragmentation-06>\>.
:   

\[BIND\]
:   [Internet Systems Consortium]{.refAuthor}, [\"BIND 9\"]{.refTitle},
    \<<https://www.isc.org/bind/>\>.
:   

\[CASTRO2010\]
:   [Castro, S.]{.refAuthor}, [Zhang, M.]{.refAuthor},
    [John, W.]{.refAuthor}, [Wessels, D.]{.refAuthor}, and [K.
    claffy]{.refAuthor}, [\"Understanding and Preparing for DNS
    Evolution\"]{.refTitle}, [DOI
    10.1007/978-3-642-12365-8_1]{.seriesInfo}, April 2010,
    \<<https://doi.org/10.1007/978-3-642-12365-8_1>\>.
:   

\[CHES94\]
:   [Cheswick, W.]{.refAuthor} and [S. Bellovin]{.refAuthor},
    [\"Firewalls and Internet Security: Repelling the Wily
    Hacker\"]{.refTitle}, [First Edition]{.refContent}, 1994.
:   

\[CLOUDFLARE\]
:   [Grant, D.]{.refAuthor}, [\"Economical With The Truth: Making DNSSEC
    Answers Cheap\"]{.refTitle}, June 2016,
    \<<https://blog.cloudflare.com/black-lies/>\>.
:   

\[DAI21\]
:   [Dai, T.]{.refAuthor}, [Shulman, H.]{.refAuthor}, and [M.
    Waidner]{.refAuthor}, [\"DNS-over-TCP Considered
    Vulnerable\"]{.refTitle}, [DOI
    10.1145/3472305.3472884]{.seriesInfo}, July 2021,
    \<<https://doi.org/10.1145/3472305.3472884>\>.
:   

\[DESIGNTEAM\]
:   [ICANN]{.refAuthor}, [\"Root Zone KSK Rollover Plan\"]{.refTitle},
    March 2016,
    \<<https://www.iana.org/reports/2016/root-ksk-rollover-design-20160307.pdf>\>.
:   

\[DJBDNS\]
:   [Bernstein, D.]{.refAuthor}, [\"When are TCP queries
    sent?\"]{.refTitle}, November 2002,
    \<<https://cr.yp.to/djbdns/tcp.html#why>\>.
:   

\[dnscap\]
:   [DNS-OARC]{.refAuthor}, [\"DNSCAP\"]{.refTitle}, February 2014,
    \<<https://www.dns-oarc.net/tools/dnscap>\>.
:   

\[dnstap\]
:   [\"dnstap\"]{.refTitle}, \<<https://dnstap.info>\>.
:   

\[ECDSA\]
:   [van Rijswijk-Deij, R.]{.refAuthor}, [Sperotto, A.]{.refAuthor}, and
    [A. Pras]{.refAuthor}, [\"Making the Case for Elliptic Curves in
    DNSSEC\"]{.refTitle}, [DOI 10.1145/2831347.2831350]{.seriesInfo},
    October 2015, \<<https://dl.acm.org/doi/10.1145/2831347.2831350>\>.
:   

\[FLAGDAY2020\]
:   [DNS Software and Service Providers]{.refAuthor}, [\"DNS Flag Day
    2020\"]{.refTitle}, October 2020,
    \<<https://dnsflagday.net/2020/>\>.
:   

\[FRAG_POISON\]
:   [Herzberg, A.]{.refAuthor} and [H. Shulman]{.refAuthor},
    [\"Fragmentation Considered Poisonous\"]{.refTitle}, May 2012,
    \<<https://arxiv.org/pdf/1205.4011.pdf>\>.
:   

\[HUSTON\]
:   [Huston, G.]{.refAuthor}, [\"Dealing with IPv6 fragmentation in the
    DNS\"]{.refTitle}, August 2017,
    \<<https://blog.apnic.net/2017/08/22/dealing-ipv6-fragmentation-dns/>\>.
:   

\[KSK_ROLLOVER_ARCHIVES\]
:   [ICANN]{.refAuthor}, [\"KSK Rollover List Archives\"]{.refTitle},
    January 2019,
    \<<https://mm.icann.org/pipermail/ksk-rollover/2019-January/date.html>\>.
:   

\[LEWIS\]
:   [Lewis, E.]{.refAuthor}, [\"2017 DNSSEC KSK Rollover\"]{.refTitle},
    [RIPE 74]{.refContent}, May 2017,
    \<<https://ripe74.ripe.net/presentations/25-RIPE74-lewis-submission.pdf>\>.
:   

\[libpcap\]
:   [The Tcpdump Group]{.refAuthor}, [\"Tcpdump and
    Libpcap\"]{.refTitle}, \<<https://www.tcpdump.org>\>.
:   

\[NETALYZR\]
:   [Kreibich, C.]{.refAuthor}, [Weaver, N.]{.refAuthor},
    [Nechaev, B.]{.refAuthor}, and [V. Paxson]{.refAuthor}, [\"Netalyzr:
    Illuminating The Edge Network\"]{.refTitle}, [DOI
    10.1145/1879141.1879173]{.seriesInfo}, November 2010,
    \<<https://doi.org/10.1145/1879141.1879173>\>.
:   

\[phrack\]
:   [horizon]{.refAuthor}, [\"Defeating Sniffers and Intrusion Detection
    Systems\"]{.refTitle}, [Phrack Magazine]{.refContent}, December
    1998, \<<http://phrack.org/issues/54/10.html>\>.
:   

\[RFC0768\]
:   [Postel, J.]{.refAuthor}, [\"User Datagram Protocol\"]{.refTitle},
    [STD 6]{.seriesInfo}, [RFC 768]{.seriesInfo}, [DOI
    10.17487/RFC0768]{.seriesInfo}, August 1980,
    \<<https://www.rfc-editor.org/info/rfc768>\>.
:   

\[RFC0793\]
:   [Postel, J.]{.refAuthor}, [\"Transmission Control
    Protocol\"]{.refTitle}, [STD 7]{.seriesInfo}, [RFC
    793]{.seriesInfo}, [DOI 10.17487/RFC0793]{.seriesInfo}, September
    1981, \<<https://www.rfc-editor.org/info/rfc793>\>.
:   

\[RFC0883\]
:   [Mockapetris, P.]{.refAuthor}, [\"Domain names: Implementation
    specification\"]{.refTitle}, [RFC 883]{.seriesInfo}, [DOI
    10.17487/RFC0883]{.seriesInfo}, November 1983,
    \<<https://www.rfc-editor.org/info/rfc883>\>.
:   

\[RFC1034\]
:   [Mockapetris, P.]{.refAuthor}, [\"Domain names - concepts and
    facilities\"]{.refTitle}, [STD 13]{.seriesInfo}, [RFC
    1034]{.seriesInfo}, [DOI 10.17487/RFC1034]{.seriesInfo}, November
    1987, \<<https://www.rfc-editor.org/info/rfc1034>\>.
:   

\[RFC1123\]
:   [Braden, R., Ed.]{.refAuthor}, [\"Requirements for Internet Hosts -
    Application and Support\"]{.refTitle}, [STD 3]{.seriesInfo}, [RFC
    1123]{.seriesInfo}, [DOI 10.17487/RFC1123]{.seriesInfo}, October
    1989, \<<https://www.rfc-editor.org/info/rfc1123>\>.
:   

\[RFC1536\]
:   [Kumar, A.]{.refAuthor}, [Postel, J.]{.refAuthor},
    [Neuman, C.]{.refAuthor}, [Danzig, P.]{.refAuthor}, and [S.
    Miller]{.refAuthor}, [\"Common DNS Implementation Errors and
    Suggested Fixes\"]{.refTitle}, [RFC 1536]{.seriesInfo}, [DOI
    10.17487/RFC1536]{.seriesInfo}, October 1993,
    \<<https://www.rfc-editor.org/info/rfc1536>\>.
:   

\[RFC1995\]
:   [Ohta, M.]{.refAuthor}, [\"Incremental Zone Transfer in
    DNS\"]{.refTitle}, [RFC 1995]{.seriesInfo}, [DOI
    10.17487/RFC1995]{.seriesInfo}, August 1996,
    \<<https://www.rfc-editor.org/info/rfc1995>\>.
:   

\[RFC1996\]
:   [Vixie, P.]{.refAuthor}, [\"A Mechanism for Prompt Notification of
    Zone Changes (DNS NOTIFY)\"]{.refTitle}, [RFC 1996]{.seriesInfo},
    [DOI 10.17487/RFC1996]{.seriesInfo}, August 1996,
    \<<https://www.rfc-editor.org/info/rfc1996>\>.
:   

\[RFC2136\]
:   [Vixie, P., Ed.]{.refAuthor}, [Thomson, S.]{.refAuthor},
    [Rekhter, Y.]{.refAuthor}, and [J. Bound]{.refAuthor}, [\"Dynamic
    Updates in the Domain Name System (DNS UPDATE)\"]{.refTitle}, [RFC
    2136]{.seriesInfo}, [DOI 10.17487/RFC2136]{.seriesInfo}, April 1997,
    \<<https://www.rfc-editor.org/info/rfc2136>\>.
:   

\[RFC2541\]
:   [Eastlake 3rd, D.]{.refAuthor}, [\"DNS Security Operational
    Considerations\"]{.refTitle}, [RFC 2541]{.seriesInfo}, [DOI
    10.17487/RFC2541]{.seriesInfo}, March 1999,
    \<<https://www.rfc-editor.org/info/rfc2541>\>.
:   

\[RFC2671\]
:   [Vixie, P.]{.refAuthor}, [\"Extension Mechanisms for DNS
    (EDNS0)\"]{.refTitle}, [RFC 2671]{.seriesInfo}, [DOI
    10.17487/RFC2671]{.seriesInfo}, August 1999,
    \<<https://www.rfc-editor.org/info/rfc2671>\>.
:   

\[RFC2694\]
:   [Srisuresh, P.]{.refAuthor}, [Tsirtsis, G.]{.refAuthor},
    [Akkiraju, P.]{.refAuthor}, and [A. Heffernan]{.refAuthor}, [\"DNS
    extensions to Network Address Translators (DNS_ALG)\"]{.refTitle},
    [RFC 2694]{.seriesInfo}, [DOI 10.17487/RFC2694]{.seriesInfo},
    September 1999, \<<https://www.rfc-editor.org/info/rfc2694>\>.
:   

\[RFC3022\]
:   [Srisuresh, P.]{.refAuthor} and [K. Egevang]{.refAuthor},
    [\"Traditional IP Network Address Translator (Traditional
    NAT)\"]{.refTitle}, [RFC 3022]{.seriesInfo}, [DOI
    10.17487/RFC3022]{.seriesInfo}, January 2001,
    \<<https://www.rfc-editor.org/info/rfc3022>\>.
:   

\[RFC3225\]
:   [Conrad, D.]{.refAuthor}, [\"Indicating Resolver Support of
    DNSSEC\"]{.refTitle}, [RFC 3225]{.seriesInfo}, [DOI
    10.17487/RFC3225]{.seriesInfo}, December 2001,
    \<<https://www.rfc-editor.org/info/rfc3225>\>.
:   

\[RFC3226\]
:   [Gudmundsson, O.]{.refAuthor}, [\"DNSSEC and IPv6 A6 aware
    server/resolver message size requirements\"]{.refTitle}, [RFC
    3226]{.seriesInfo}, [DOI 10.17487/RFC3226]{.seriesInfo}, December
    2001, \<<https://www.rfc-editor.org/info/rfc3226>\>.
:   

\[RFC4472\]
:   [Durand, A.]{.refAuthor}, [Ihren, J.]{.refAuthor}, and [P.
    Savola]{.refAuthor}, [\"Operational Considerations and Issues with
    IPv6 DNS\"]{.refTitle}, [RFC 4472]{.seriesInfo}, [DOI
    10.17487/RFC4472]{.seriesInfo}, April 2006,
    \<<https://www.rfc-editor.org/info/rfc4472>\>.
:   

\[RFC4953\]
:   [Touch, J.]{.refAuthor}, [\"Defending TCP Against Spoofing
    Attacks\"]{.refTitle}, [RFC 4953]{.seriesInfo}, [DOI
    10.17487/RFC4953]{.seriesInfo}, July 2007,
    \<<https://www.rfc-editor.org/info/rfc4953>\>.
:   

\[RFC4987\]
:   [Eddy, W.]{.refAuthor}, [\"TCP SYN Flooding Attacks and Common
    Mitigations\"]{.refTitle}, [RFC 4987]{.seriesInfo}, [DOI
    10.17487/RFC4987]{.seriesInfo}, August 2007,
    \<<https://www.rfc-editor.org/info/rfc4987>\>.
:   

\[RFC5358\]
:   [Damas, J.]{.refAuthor} and [F. Neves]{.refAuthor}, [\"Preventing
    Use of Recursive Nameservers in Reflector Attacks\"]{.refTitle},
    [BCP 140]{.seriesInfo}, [RFC 5358]{.seriesInfo}, [DOI
    10.17487/RFC5358]{.seriesInfo}, October 2008,
    \<<https://www.rfc-editor.org/info/rfc5358>\>.
:   

\[RFC5452\]
:   [Hubert, A.]{.refAuthor} and [R. van Mook]{.refAuthor}, [\"Measures
    for Making DNS More Resilient against Forged Answers\"]{.refTitle},
    [RFC 5452]{.seriesInfo}, [DOI 10.17487/RFC5452]{.seriesInfo},
    January 2009, \<<https://www.rfc-editor.org/info/rfc5452>\>.
:   

\[RFC5507\]
:   [IAB]{.refAuthor}, [Faltstrom, P., Ed.]{.refAuthor}, [Austein, R.,
    Ed.]{.refAuthor}, and [P. Koch, Ed.]{.refAuthor}, [\"Design Choices
    When Expanding the DNS\"]{.refTitle}, [RFC 5507]{.seriesInfo}, [DOI
    10.17487/RFC5507]{.seriesInfo}, April 2009,
    \<<https://www.rfc-editor.org/info/rfc5507>\>.
:   

\[RFC5625\]
:   [Bellis, R.]{.refAuthor}, [\"DNS Proxy Implementation
    Guidelines\"]{.refTitle}, [BCP 152]{.seriesInfo}, [RFC
    5625]{.seriesInfo}, [DOI 10.17487/RFC5625]{.seriesInfo}, August
    2009, \<<https://www.rfc-editor.org/info/rfc5625>\>.
:   

\[RFC5927\]
:   [Gont, F.]{.refAuthor}, [\"ICMP Attacks against TCP\"]{.refTitle},
    [RFC 5927]{.seriesInfo}, [DOI 10.17487/RFC5927]{.seriesInfo}, July
    2010, \<<https://www.rfc-editor.org/info/rfc5927>\>.
:   

\[RFC5936\]
:   [Lewis, E.]{.refAuthor} and [A. Hoenes, Ed.]{.refAuthor}, [\"DNS
    Zone Transfer Protocol (AXFR)\"]{.refTitle}, [RFC
    5936]{.seriesInfo}, [DOI 10.17487/RFC5936]{.seriesInfo}, June 2010,
    \<<https://www.rfc-editor.org/info/rfc5936>\>.
:   

\[RFC5961\]
:   [Ramaiah, A.]{.refAuthor}, [Stewart, R.]{.refAuthor}, and [M.
    Dalal]{.refAuthor}, [\"Improving TCP\'s Robustness to Blind
    In-Window Attacks\"]{.refTitle}, [RFC 5961]{.seriesInfo}, [DOI
    10.17487/RFC5961]{.seriesInfo}, August 2010,
    \<<https://www.rfc-editor.org/info/rfc5961>\>.
:   

\[RFC5966\]
:   [Bellis, R.]{.refAuthor}, [\"DNS Transport over TCP - Implementation
    Requirements\"]{.refTitle}, [RFC 5966]{.seriesInfo}, [DOI
    10.17487/RFC5966]{.seriesInfo}, August 2010,
    \<<https://www.rfc-editor.org/info/rfc5966>\>.
:   

\[RFC6298\]
:   [Paxson, V.]{.refAuthor}, [Allman, M.]{.refAuthor},
    [Chu, J.]{.refAuthor}, and [M. Sargent]{.refAuthor}, [\"Computing
    TCP\'s Retransmission Timer\"]{.refTitle}, [RFC 6298]{.seriesInfo},
    [DOI 10.17487/RFC6298]{.seriesInfo}, June 2011,
    \<<https://www.rfc-editor.org/info/rfc6298>\>.
:   

\[RFC6762\]
:   [Cheshire, S.]{.refAuthor} and [M. Krochmal]{.refAuthor},
    [\"Multicast DNS\"]{.refTitle}, [RFC 6762]{.seriesInfo}, [DOI
    10.17487/RFC6762]{.seriesInfo}, February 2013,
    \<<https://www.rfc-editor.org/info/rfc6762>\>.
:   

\[RFC6781\]
:   [Kolkman, O.]{.refAuthor}, [Mekking, W.]{.refAuthor}, and [R.
    Gieben]{.refAuthor}, [\"DNSSEC Operational Practices, Version
    2\"]{.refTitle}, [RFC 6781]{.seriesInfo}, [DOI
    10.17487/RFC6781]{.seriesInfo}, December 2012,
    \<<https://www.rfc-editor.org/info/rfc6781>\>.
:   

\[RFC6950\]
:   [Peterson, J.]{.refAuthor}, [Kolkman, O.]{.refAuthor},
    [Tschofenig, H.]{.refAuthor}, and [B. Aboba]{.refAuthor},
    [\"Architectural Considerations on Application Features in the
    DNS\"]{.refTitle}, [RFC 6950]{.seriesInfo}, [DOI
    10.17487/RFC6950]{.seriesInfo}, October 2013,
    \<<https://www.rfc-editor.org/info/rfc6950>\>.
:   

\[RFC7413\]
:   [Cheng, Y.]{.refAuthor}, [Chu, J.]{.refAuthor},
    [Radhakrishnan, S.]{.refAuthor}, and [A. Jain]{.refAuthor}, [\"TCP
    Fast Open\"]{.refTitle}, [RFC 7413]{.seriesInfo}, [DOI
    10.17487/RFC7413]{.seriesInfo}, December 2014,
    \<<https://www.rfc-editor.org/info/rfc7413>\>.
:   

\[RFC7477\]
:   [Hardaker, W.]{.refAuthor}, [\"Child-to-Parent Synchronization in
    DNS\"]{.refTitle}, [RFC 7477]{.seriesInfo}, [DOI
    10.17487/RFC7477]{.seriesInfo}, March 2015,
    \<<https://www.rfc-editor.org/info/rfc7477>\>.
:   

\[RFC7534\]
:   [Abley, J.]{.refAuthor} and [W. Sotomayor]{.refAuthor}, [\"AS112
    Nameserver Operations\"]{.refTitle}, [RFC 7534]{.seriesInfo}, [DOI
    10.17487/RFC7534]{.seriesInfo}, May 2015,
    \<<https://www.rfc-editor.org/info/rfc7534>\>.
:   

\[RFC7720\]
:   [Blanchet, M.]{.refAuthor} and [L-J. Liman]{.refAuthor}, [\"DNS Root
    Name Service Protocol and Deployment Requirements\"]{.refTitle},
    [BCP 40]{.seriesInfo}, [RFC 7720]{.seriesInfo}, [DOI
    10.17487/RFC7720]{.seriesInfo}, December 2015,
    \<<https://www.rfc-editor.org/info/rfc7720>\>.
:   

\[RFC7858\]
:   [Hu, Z.]{.refAuthor}, [Zhu, L.]{.refAuthor},
    [Heidemann, J.]{.refAuthor}, [Mankin, A.]{.refAuthor},
    [Wessels, D.]{.refAuthor}, and [P. Hoffman]{.refAuthor},
    [\"Specification for DNS over Transport Layer Security
    (TLS)\"]{.refTitle}, [RFC 7858]{.seriesInfo}, [DOI
    10.17487/RFC7858]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7858>\>.
:   

\[RFC7901\]
:   [Wouters, P.]{.refAuthor}, [\"CHAIN Query Requests in
    DNS\"]{.refTitle}, [RFC 7901]{.seriesInfo}, [DOI
    10.17487/RFC7901]{.seriesInfo}, June 2016,
    \<<https://www.rfc-editor.org/info/rfc7901>\>.
:   

\[RFC7918\]
:   [Langley, A.]{.refAuthor}, [Modadugu, N.]{.refAuthor}, and [B.
    Moeller]{.refAuthor}, [\"Transport Layer Security (TLS) False
    Start\"]{.refTitle}, [RFC 7918]{.seriesInfo}, [DOI
    10.17487/RFC7918]{.seriesInfo}, August 2016,
    \<<https://www.rfc-editor.org/info/rfc7918>\>.
:   

\[RFC8027\]
:   [Hardaker, W.]{.refAuthor}, [Gudmundsson, O.]{.refAuthor}, and [S.
    Krishnaswamy]{.refAuthor}, [\"DNSSEC Roadblock
    Avoidance\"]{.refTitle}, [BCP 207]{.seriesInfo}, [RFC
    8027]{.seriesInfo}, [DOI 10.17487/RFC8027]{.seriesInfo}, November
    2016, \<<https://www.rfc-editor.org/info/rfc8027>\>.
:   

\[RFC8094\]
:   [Reddy, T.]{.refAuthor}, [Wing, D.]{.refAuthor}, and [P.
    Patil]{.refAuthor}, [\"DNS over Datagram Transport Layer Security
    (DTLS)\"]{.refTitle}, [RFC 8094]{.seriesInfo}, [DOI
    10.17487/RFC8094]{.seriesInfo}, February 2017,
    \<<https://www.rfc-editor.org/info/rfc8094>\>.
:   

\[RFC8162\]
:   [Hoffman, P.]{.refAuthor} and [J. Schlyter]{.refAuthor}, [\"Using
    Secure DNS to Associate Certificates with Domain Names for
    S/MIME\"]{.refTitle}, [RFC 8162]{.seriesInfo}, [DOI
    10.17487/RFC8162]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8162>\>.
:   

\[RFC8200\]
:   [Deering, S.]{.refAuthor} and [R. Hinden]{.refAuthor}, [\"Internet
    Protocol, Version 6 (IPv6) Specification\"]{.refTitle}, [STD
    86]{.seriesInfo}, [RFC 8200]{.seriesInfo}, [DOI
    10.17487/RFC8200]{.seriesInfo}, July 2017,
    \<<https://www.rfc-editor.org/info/rfc8200>\>.
:   

\[RFC8324\]
:   [Klensin, J.]{.refAuthor}, [\"DNS Privacy, Authorization, Special
    Uses, Encoding, Characters, Matching, and Root Structure: Time for
    Another Look?\"]{.refTitle}, [RFC 8324]{.seriesInfo}, [DOI
    10.17487/RFC8324]{.seriesInfo}, February 2018,
    \<<https://www.rfc-editor.org/info/rfc8324>\>.
:   

\[RFC8446\]
:   [Rescorla, E.]{.refAuthor}, [\"The Transport Layer Security (TLS)
    Protocol Version 1.3\"]{.refTitle}, [RFC 8446]{.seriesInfo}, [DOI
    10.17487/RFC8446]{.seriesInfo}, August 2018,
    \<<https://www.rfc-editor.org/info/rfc8446>\>.
:   

\[RFC8467\]
:   [Mayrhofer, A.]{.refAuthor}, [\"Padding Policies for Extension
    Mechanisms for DNS (EDNS(0))\"]{.refTitle}, [RFC 8467]{.seriesInfo},
    [DOI 10.17487/RFC8467]{.seriesInfo}, October 2018,
    \<<https://www.rfc-editor.org/info/rfc8467>\>.
:   

\[RFC8482\]
:   [Abley, J.]{.refAuthor}, [Gudmundsson, O.]{.refAuthor},
    [Majkowski, M.]{.refAuthor}, and [E. Hunt]{.refAuthor}, [\"Providing
    Minimal-Sized Responses to DNS Queries That Have
    QTYPE=ANY\"]{.refTitle}, [RFC 8482]{.seriesInfo}, [DOI
    10.17487/RFC8482]{.seriesInfo}, January 2019,
    \<<https://www.rfc-editor.org/info/rfc8482>\>.
:   

\[RFC8483\]
:   [Song, L., Ed.]{.refAuthor}, [Liu, D.]{.refAuthor},
    [Vixie, P.]{.refAuthor}, [Kato, A.]{.refAuthor}, and [S.
    Kerr]{.refAuthor}, [\"Yeti DNS Testbed\"]{.refTitle}, [RFC
    8483]{.seriesInfo}, [DOI 10.17487/RFC8483]{.seriesInfo}, October
    2018, \<<https://www.rfc-editor.org/info/rfc8483>\>.
:   

\[RFC8484\]
:   [Hoffman, P.]{.refAuthor} and [P. McManus]{.refAuthor}, [\"DNS
    Queries over HTTPS (DoH)\"]{.refTitle}, [RFC 8484]{.seriesInfo},
    [DOI 10.17487/RFC8484]{.seriesInfo}, October 2018,
    \<<https://www.rfc-editor.org/info/rfc8484>\>.
:   

\[RFC8490\]
:   [Bellis, R.]{.refAuthor}, [Cheshire, S.]{.refAuthor},
    [Dickinson, J.]{.refAuthor}, [Dickinson, S.]{.refAuthor},
    [Lemon, T.]{.refAuthor}, and [T. Pusateri]{.refAuthor}, [\"DNS
    Stateful Operations\"]{.refTitle}, [RFC 8490]{.seriesInfo}, [DOI
    10.17487/RFC8490]{.seriesInfo}, March 2019,
    \<<https://www.rfc-editor.org/info/rfc8490>\>.
:   

\[RFC8501\]
:   [Howard, L.]{.refAuthor}, [\"Reverse DNS in IPv6 for Internet
    Service Providers\"]{.refTitle}, [RFC 8501]{.seriesInfo}, [DOI
    10.17487/RFC8501]{.seriesInfo}, November 2018,
    \<<https://www.rfc-editor.org/info/rfc8501>\>.
:   

\[RFC8806\]
:   [Kumari, W.]{.refAuthor} and [P. Hoffman]{.refAuthor}, [\"Running a
    Root Server Local to a Resolver\"]{.refTitle}, [RFC
    8806]{.seriesInfo}, [DOI 10.17487/RFC8806]{.seriesInfo}, June 2020,
    \<<https://www.rfc-editor.org/info/rfc8806>\>.
:   

\[RFC8906\]
:   [Andrews, M.]{.refAuthor} and [R. Bellis]{.refAuthor}, [\"A Common
    Operational Problem in DNS Servers: Failure to
    Communicate\"]{.refTitle}, [BCP 231]{.seriesInfo}, [RFC
    8906]{.seriesInfo}, [DOI 10.17487/RFC8906]{.seriesInfo}, September
    2020, \<<https://www.rfc-editor.org/info/rfc8906>\>.
:   

\[RFC8932\]
:   [Dickinson, S.]{.refAuthor}, [Overeinder, B.]{.refAuthor}, [van
    Rijswijk-Deij, R.]{.refAuthor}, and [A. Mankin]{.refAuthor},
    [\"Recommendations for DNS Privacy Service Operators\"]{.refTitle},
    [BCP 232]{.seriesInfo}, [RFC 8932]{.seriesInfo}, [DOI
    10.17487/RFC8932]{.seriesInfo}, October 2020,
    \<<https://www.rfc-editor.org/info/rfc8932>\>.
:   

\[RFC8945\]
:   [Dupont, F.]{.refAuthor}, [Morris, S.]{.refAuthor},
    [Vixie, P.]{.refAuthor}, [Eastlake 3rd, D.]{.refAuthor},
    [Gudmundsson, O.]{.refAuthor}, and [B. Wellington]{.refAuthor},
    [\"Secret Key Transaction Authentication for DNS
    (TSIG)\"]{.refTitle}, [STD 93]{.seriesInfo}, [RFC
    8945]{.seriesInfo}, [DOI 10.17487/RFC8945]{.seriesInfo}, November
    2020, \<<https://www.rfc-editor.org/info/rfc8945>\>.
:   

\[ROLL_YOUR_ROOT\]
:   [Müller, M.]{.refAuthor}, [Thomas, M.]{.refAuthor},
    [Wessels, D.]{.refAuthor}, [Hardaker, W.]{.refAuthor},
    [Chung, T.]{.refAuthor}, [Toorop, W.]{.refAuthor}, and [R. van
    Rijswijk-Deij]{.refAuthor}, [\"Roll, Roll, Roll Your Root: A
    Comprehensive Analysis of the First Ever DNSSEC Root KSK
    Rollover\"]{.refTitle}, [DOI 10.1145/3355369.3355570]{.seriesInfo},
    October 2019, \<<https://dl.acm.org/doi/10.1145/3355369.3355570>\>.
:   

\[RRL\]
:   [Vixie, P.]{.refAuthor} and [V. Schryver]{.refAuthor}, [\"DNS
    Response Rate Limiting (DNS RRL)\"]{.refTitle},
    [ISC-TN-2012-1-Draft1]{.refContent}, April 2012.
:   

\[TDNS\]
:   [Zhu, L.]{.refAuthor}, [Heidemann, J.]{.refAuthor},
    [Wessels, D.]{.refAuthor}, [Mankin, A.]{.refAuthor}, and [N.
    Somaiya]{.refAuthor}, [\"Connection-Oriented DNS to Improve Privacy
    and Security\"]{.refTitle}, [DOI 10.1109/SP.2015.18]{.seriesInfo},
    May 2015, \<<https://doi.org/10.1109/SP.2015.18>\>.
:   

\[TOYAMA\]
:   [Toyama, K.]{.refAuthor}, [Ishibashi, K.]{.refAuthor},
    [Toyono, T.]{.refAuthor}, [Ishino, M.]{.refAuthor},
    [Yoshimura, C.]{.refAuthor}, and [K. Fujiwara]{.refAuthor}, [\"DNS
    Anomalies and Their Impacts on DNS Cache Servers\"]{.refTitle},
    [NANOG 32]{.refContent}, October 2004.
:   

\[VERISIGN\]
:   [Thomas, M.]{.refAuthor} and [D. Wessels]{.refAuthor}, [\"An
    Analysis of TCP Traffic in Root Server DITL Data\"]{.refTitle},
    [DNS-OARC 2014 Fall Workshop]{.refContent}, October 2014.
:   

\[WIKIPEDIA_TFO\]
:   [Wikipedia]{.refAuthor}, [\"TCP Fast Open\"]{.refTitle}, February
    2022,
    \<<https://en.wikipedia.org/w/index.php?title=TCP_Fast_Open&oldid=1071397204>\>.
:   
:::
:::

::: {#dnsrfcs}
::: {#appendix-A .section}
## [Appendix A.](#appendix-A){.section-number .selfRef} [RFCs Related to DNS Transport over TCP](#name-rfcs-related-to-dns-transpo){.section-name .selfRef} {#name-rfcs-related-to-dns-transpo}

This section enumerates all known RFCs with a status of Internet
Standard, Proposed Standard, Informational, Best Current Practice, or
Experimental that either implicitly or explicitly make assumptions or
statements about the use of TCP as a transport for the DNS germane to
this document.[¶](#appendix-A-1){.pilcrow}

::: {#appendix-A.1 .section}
### [A.1.](#appendix-A.1){.section-number .selfRef} [RFC 1035 - DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION](#name-rfc-1035-domain-names-imple){.section-name .selfRef} {#name-rfc-1035-domain-names-imple}

The Internet Standard \[[RFC1035](#RFC1035){.xref}\] is the base DNS
specification that explicitly defines support for DNS over
TCP.[¶](#appendix-A.1-1){.pilcrow}
:::

::: {#appendix-A.2 .section}
### [A.2.](#appendix-A.2){.section-number .selfRef} [RFC 1536 - Common DNS Implementation Errors and Suggested Fixes](#name-rfc-1536-common-dns-impleme){.section-name .selfRef} {#name-rfc-1536-common-dns-impleme}

The Informational document \[[RFC1536](#RFC1536){.xref}\] states that
UDP is \"the chosen protocol for communication though TCP is used for
zone transfers.\" That statement should now be considered in its
historical context and is no longer a proper reflection of modern
expectations.[¶](#appendix-A.2-1){.pilcrow}
:::

::: {#appendix-A.3 .section}
### [A.3.](#appendix-A.3){.section-number .selfRef} [RFC 1995 - Incremental Zone Transfer in DNS](#name-rfc-1995-incremental-zone-t){.section-name .selfRef} {#name-rfc-1995-incremental-zone-t}

The Proposed Standard \[[RFC1995](#RFC1995){.xref}\] documents the use
of TCP as the fallback transport when Incremental Zone Transfer (IXFR)
responses do not fit into a single UDP response. As with Authoritative
Transfer (AXFR), IXFR messages are typically delivered over TCP by
default in practice.[¶](#appendix-A.3-1){.pilcrow}
:::

::: {#appendix-A.4 .section}
### [A.4.](#appendix-A.4){.section-number .selfRef} [RFC 1996 - A Mechanism for Prompt Notification of Zone Changes (DNS NOTIFY)](#name-rfc-1996-a-mechanism-for-pr){.section-name .selfRef} {#name-rfc-1996-a-mechanism-for-pr}

The Proposed Standard \[[RFC1996](#RFC1996){.xref}\] suggests that a
primary server may decide to issue NOTIFY messages over TCP. In
practice, NOTIFY messages are generally sent over UDP, but this
specification leaves open the possibility that the choice of transport
protocol is up to the primary server; therefore, a secondary server
ought to be able to operate over both UDP and
TCP.[¶](#appendix-A.4-1){.pilcrow}
:::

::: {#appendix-A.5 .section}
### [A.5.](#appendix-A.5){.section-number .selfRef} [RFC 2181 - Clarifications to the DNS Specification](#name-rfc-2181-clarifications-to-){.section-name .selfRef} {#name-rfc-2181-clarifications-to-}

The Proposed Standard \[[RFC2181](#RFC2181){.xref}\] includes clarifying
text on how a client should react to the TC bit set on responses. It is
advised that the response be discarded and the query resent using
TCP.[¶](#appendix-A.5-1){.pilcrow}
:::

::: {#appendix-A.6 .section}
### [A.6.](#appendix-A.6){.section-number .selfRef} [RFC 2694 - DNS extensions to Network Address Translators (DNS_ALG)](#name-rfc-2694-dns-extensions-to-){.section-name .selfRef} {#name-rfc-2694-dns-extensions-to-}

The Informational document \[[RFC2694](#RFC2694){.xref}\] enumerates
considerations for NAT devices to properly handle DNS traffic. This
document is noteworthy in its suggestion that \"\[t\]ypically, TCP is
used for AXFR requests,\" as further evidence that helps explain why DNS
over TCP may have often been treated very differently than DNS over UDP
in operational networks.[¶](#appendix-A.6-1){.pilcrow}
:::

::: {#appendix-A.7 .section}
### [A.7.](#appendix-A.7){.section-number .selfRef} [RFC 3225 - Indicating Resolver Support of DNSSEC](#name-rfc-3225-indicating-resolve){.section-name .selfRef} {#name-rfc-3225-indicating-resolve}

The Proposed Standard \[[RFC3225](#RFC3225){.xref}\] makes statements
indicating that DNS over TCP is \"detrimental\" as a result of increased
traffic, latency, and server load. This document is a companion to the
next document in the RFC Series that describes the requirement for
EDNS(0) support for DNSSEC.[¶](#appendix-A.7-1){.pilcrow}
:::

::: {#appendix-A.8 .section}
### [A.8.](#appendix-A.8){.section-number .selfRef} [RFC 3226 - DNSSEC and IPv6 A6 aware server/resolver message size requirements](#name-rfc-3226-dnssec-and-ipv6-a6){.section-name .selfRef} {#name-rfc-3226-dnssec-and-ipv6-a6}

Although updated by later DNSSEC RFCs, the Proposed Standard
\[[RFC3226](#RFC3226){.xref}\] strongly argues in favor of UDP messages
instead of TCP, largely for performance reasons. The document declares
EDNS(0) a requirement for DNSSEC servers and advocates that packet
fragmentation may be preferable to TCP in certain
situations.[¶](#appendix-A.8-1){.pilcrow}
:::

::: {#appendix-A.9 .section}
### [A.9.](#appendix-A.9){.section-number .selfRef} [RFC 4472 - Operational Considerations and Issues with IPv6 DNS](#name-rfc-4472-operational-consid){.section-name .selfRef} {#name-rfc-4472-operational-consid}

The Informational document \[[RFC4472](#RFC4472){.xref}\] notes that
IPv6 data may increase DNS responses beyond what would fit in a UDP
message. What is particularly noteworthy, but perhaps less common today
than when this document was written, is that it refers to
implementations that truncate data without setting the TC bit to
encourage the client to resend the query using
TCP.[¶](#appendix-A.9-1){.pilcrow}
:::

::: {#appendix-A.10 .section}
### [A.10.](#appendix-A.10){.section-number .selfRef} [RFC 5452 - Measures for Making DNS More Resilient against Forged Answers](#name-rfc-5452-measures-for-makin){.section-name .selfRef} {#name-rfc-5452-measures-for-makin}

The Proposed Standard \[[RFC5452](#RFC5452){.xref}\] arose as public DNS
systems began to experience widespread abuse from spoofed queries,
resulting in amplification and reflection attacks against unwitting
victims. One of the leading justifications for supporting DNS over TCP
to thwart these attacks is briefly described in [Section
9.3](https://www.rfc-editor.org/rfc/rfc5452#section-9.3){.relref} of
\[[RFC5452](#RFC5452){.xref}\] (\"Spoof Detection and
Countermeasure\").[¶](#appendix-A.10-1){.pilcrow}
:::

::: {#appendix-A.11 .section}
### [A.11.](#appendix-A.11){.section-number .selfRef} [RFC 5507 - Design Choices When Expanding the DNS](#name-rfc-5507-design-choices-whe){.section-name .selfRef} {#name-rfc-5507-design-choices-whe}

The Informational document \[[RFC5507](#RFC5507){.xref}\] was largely an
attempt to dissuade new DNS data types from overloading the TXT resource
record type. In so doing, it summarizes the conventional wisdom of DNS
design and implementation practices. The authors suggest TCP overhead
and stateful properties pose challenges compared to UDP and imply that
UDP is generally preferred for performance and
robustness.[¶](#appendix-A.11-1){.pilcrow}
:::

::: {#appendix-A.12 .section}
### [A.12.](#appendix-A.12){.section-number .selfRef} [RFC 5625 - DNS Proxy Implementation Guidelines](#name-rfc-5625-dns-proxy-implemen){.section-name .selfRef} {#name-rfc-5625-dns-proxy-implemen}

The Best Current Practice document \[[RFC5625](#RFC5625){.xref}\]
provides DNS proxy implementation guidance including the mandate that a
proxy \"[MUST]{.bcp14} \[\...\] be prepared to receive and forward
queries over TCP\" even though it suggests that, historically, TCP
transport has not been strictly mandatory in stub resolvers or recursive
servers.[¶](#appendix-A.12-1){.pilcrow}
:::

::: {#appendix-A.13 .section}
### [A.13.](#appendix-A.13){.section-number .selfRef} [RFC 5936 - DNS Zone Transfer Protocol (AXFR)](#name-rfc-5936-dns-zone-transfer-){.section-name .selfRef} {#name-rfc-5936-dns-zone-transfer-}

The Proposed Standard \[[RFC5936](#RFC5936){.xref}\] provides a detailed
specification for the zone transfer protocol, as originally outlined in
the early DNS standards. AXFR operation is limited to TCP and not
specified for UDP. This document discusses TCP usage at
length.[¶](#appendix-A.13-1){.pilcrow}
:::

::: {#appendix-A.14 .section}
### [A.14.](#appendix-A.14){.section-number .selfRef} [RFC 7534 - AS112 Nameserver Operations](#name-rfc-7534-as112-nameserver-o){.section-name .selfRef} {#name-rfc-7534-as112-nameserver-o}

The Informational document \[[RFC7534](#RFC7534){.xref}\] enumerates the
requirements for operation of AS112 project DNS servers. New AS112 nodes
are tested for their ability to provide service on both UDP and TCP
transports, with the implication that TCP service is an expected part of
normal operations.[¶](#appendix-A.14-1){.pilcrow}
:::

::: {#appendix-A.15 .section}
### [A.15.](#appendix-A.15){.section-number .selfRef} [RFC 6762 - Multicast DNS](#name-rfc-6762-multicast-dns){.section-name .selfRef} {#name-rfc-6762-multicast-dns}

In the Proposed Standard \[[RFC6762](#RFC6762){.xref}\], the TC bit is
deemed to have essentially the same meaning as described in the original
DNS specifications. That is, if a response with the TC bit set is
received, \"\[\...\] the querier [SHOULD]{.bcp14} reissue its query
using TCP in order to receive the larger
response.\"[¶](#appendix-A.15-1){.pilcrow}
:::

::: {#appendix-A.16 .section}
### [A.16.](#appendix-A.16){.section-number .selfRef} [RFC 6891 - Extension Mechanisms for DNS (EDNS(0))](#name-rfc-6891-extension-mechanis){.section-name .selfRef} {#name-rfc-6891-extension-mechanis}

The Internet Standard \[[RFC6891](#RFC6891){.xref}\] helped slow the use
of and need for DNS-over-TCP messages. This document highlights concerns
over server load and scalability in widespread use of DNS over
TCP.[¶](#appendix-A.16-1){.pilcrow}
:::

::: {#appendix-A.17 .section}
### [A.17.](#appendix-A.17){.section-number .selfRef} [IAB RFC 6950 - Architectural Considerations on Application Features in the DNS](#name-iab-rfc-6950-architectural-){.section-name .selfRef} {#name-iab-rfc-6950-architectural-}

The Informational document \[[RFC6950](#RFC6950){.xref}\] draws
attention to large data in the DNS. TCP is referenced in the context as
a common fallback mechanism and counter to some spoofing
attacks.[¶](#appendix-A.17-1){.pilcrow}
:::

::: {#appendix-A.18 .section}
### [A.18.](#appendix-A.18){.section-number .selfRef} [RFC 7477 - Child-to-Parent Synchronization in DNS](#name-rfc-7477-child-to-parent-sy){.section-name .selfRef} {#name-rfc-7477-child-to-parent-sy}

The Proposed Standard \[[RFC7477](#RFC7477){.xref}\] specifies an RRType
and a protocol to signal and synchronize NS, A, and AAAA resource record
changes from a child-to-parent zone. Since this protocol may require
multiple requests and responses, it recommends utilizing DNS over TCP to
ensure the conversation takes place between a consistent pair of end
nodes.[¶](#appendix-A.18-1){.pilcrow}
:::

::: {#appendix-A.19 .section}
### [A.19.](#appendix-A.19){.section-number .selfRef} [RFC 7720 - DNS Root Name Service Protocol and Deployment Requirements](#name-rfc-7720-dns-root-name-serv){.section-name .selfRef} {#name-rfc-7720-dns-root-name-serv}

The Best Current Practice document \[[RFC7720](#RFC7720){.xref}\]
declares that root name service \"[MUST]{.bcp14} support UDP
\[[RFC0768](#RFC0768){.xref}\] and TCP \[[RFC0793](#RFC0793){.xref}\]
transport of DNS queries and responses.\"[¶](#appendix-A.19-1){.pilcrow}
:::

::: {#app-rfc7766}
::: {#appendix-A.20 .section}
### [A.20.](#appendix-A.20){.section-number .selfRef} [RFC 7766 - DNS Transport over TCP - Implementation Requirements](#name-rfc-7766-dns-transport-over){.section-name .selfRef} {#name-rfc-7766-dns-transport-over}

The Proposed Standard \[[RFC7766](#RFC7766){.xref}\] instructs DNS
implementors to provide support for carrying DNS-over-TCP messages in
their software and might be considered the direct ancestor of this
operational requirements document. The implementation requirements
document codifies mandatory support for DNS-over-TCP in compliant DNS
software but makes no recommendations to operators, which we seek to
address here.[¶](#appendix-A.20-1){.pilcrow}
:::
:::

::: {#appendix-A.21 .section}
### [A.21.](#appendix-A.21){.section-number .selfRef} [RFC 7828 - The edns-tcp-keepalive EDNS(0) Option](#name-rfc-7828-the-edns-tcp-keepa){.section-name .selfRef} {#name-rfc-7828-the-edns-tcp-keepa}

The Proposed Standard \[[RFC7828](#RFC7828){.xref}\] defines an EDNS(0)
option to negotiate an idle timeout value for long-lived DNS-over-TCP
connections. Consequently, this document is only applicable and relevant
to DNS-over-TCP sessions and between implementations that support this
option.[¶](#appendix-A.21-1){.pilcrow}
:::

::: {#appendix-A.22 .section}
### [A.22.](#appendix-A.22){.section-number .selfRef} [RFC 7858 - Specification for DNS over Transport Layer Security (TLS)](#name-rfc-7858-specification-for-){.section-name .selfRef} {#name-rfc-7858-specification-for-}

The Proposed Standard \[[RFC7858](#RFC7858){.xref}\] defines a method
for putting DNS messages into a TCP-based encrypted channel using TLS.
This specification is noteworthy for explicitly targeting the
stub-to-recursive traffic but does not preclude its application from
recursive-to-authoritative traffic.[¶](#appendix-A.22-1){.pilcrow}
:::

::: {#appendix-A.23 .section}
### [A.23.](#appendix-A.23){.section-number .selfRef} [RFC 7873 - Domain Name System (DNS) Cookies](#name-rfc-7873-domain-name-system){.section-name .selfRef} {#name-rfc-7873-domain-name-system}

The Proposed Standard \[[RFC7873](#RFC7873){.xref}\] describes an
EDNS(0) option to provide additional protection against query and answer
forgery. This specification mentions DNS over TCP as an alternative
mechanism when DNS cookies are not available. The specification does
make mention of DNS-over-TCP processing in two specific situations. In
one, when a server receives only a client cookie in a request, the
server should consider whether the request arrived over TCP, and if so,
it should consider accepting TCP as sufficient to authenticate the
request and respond accordingly. In another, when a client receives a
BADCOOKIE reply using a fresh server cookie, the client should retry
using TCP as the transport.[¶](#appendix-A.23-1){.pilcrow}
:::

::: {#appendix-A.24 .section}
### [A.24.](#appendix-A.24){.section-number .selfRef} [RFC 7901 - CHAIN Query Requests in DNS](#name-rfc-7901-chain-query-reques){.section-name .selfRef} {#name-rfc-7901-chain-query-reques}

The Experimental specification \[[RFC7901](#RFC7901){.xref}\] describes
an EDNS(0) option that can be used by a security-aware validating
resolver to request and obtain a complete DNSSEC validation path for any
single query. This document requires the use of DNS over TCP or a
transport mechanism verified by a source IP address such as EDNS-COOKIE
\[[RFC7873](#RFC7873){.xref}\].[¶](#appendix-A.24-1){.pilcrow}
:::

::: {#appendix-A.25 .section}
### [A.25.](#appendix-A.25){.section-number .selfRef} [RFC 8027 - DNSSEC Roadblock Avoidance](#name-rfc-8027-dnssec-roadblock-a){.section-name .selfRef} {#name-rfc-8027-dnssec-roadblock-a}

The Best Current Practice document \[[RFC8027](#RFC8027){.xref}\]
details observed problems with DNSSEC deployment and mitigation
techniques. Network traffic blocking and restrictions, including
DNS-over-TCP messages, are highlighted as one reason for DNSSEC
deployment issues. While this document suggests these sorts of problems
are due to \"non-compliant infrastructure\", the scope of the document
is limited to detection and mitigation techniques to avoid so-called
DNSSEC roadblocks.[¶](#appendix-A.25-1){.pilcrow}
:::

::: {#appendix-A.26 .section}
### [A.26.](#appendix-A.26){.section-number .selfRef} [RFC 8094 - DNS over Datagram Transport Layer Security (DTLS)](#name-rfc-8094-dns-over-datagram-){.section-name .selfRef} {#name-rfc-8094-dns-over-datagram-}

The Experimental specification \[[RFC8094](#RFC8094){.xref}\] details a
protocol that uses a datagram transport (UDP) but stipulates that \"DNS
clients and servers that implement DNS over DTLS [MUST]{.bcp14} also
implement DNS over TLS in order to provide privacy for clients that
desire Strict Privacy \[\...\].\" This requirement implies DNS over TCP
must be supported in case the message size is larger than the path
MTU.[¶](#appendix-A.26-1){.pilcrow}
:::

::: {#appendix-A.27 .section}
### [A.27.](#appendix-A.27){.section-number .selfRef} [RFC 8162 - Using Secure DNS to Associate Certificates with Domain Names for S/MIME](#name-rfc-8162-using-secure-dns-t){.section-name .selfRef} {#name-rfc-8162-using-secure-dns-t}

The Experimental specification \[[RFC8162](#RFC8162){.xref}\] describes
a technique to authenticate user X.509 certificates in an S/MIME system
via the DNS. The document points out that the new experimental resource
record types are expected to carry large payloads, resulting in the
suggestion that \"applications [SHOULD]{.bcp14} use TCP \-- not UDP \--
to perform queries for the SMIMEA resource
record.\"[¶](#appendix-A.27-1){.pilcrow}
:::

::: {#appendix-A.28 .section}
### [A.28.](#appendix-A.28){.section-number .selfRef} [RFC 8324 - DNS Privacy, Authorization, Special Uses, Encoding, Characters, Matching, and Root Structure: Time for Another Look?](#name-rfc-8324-dns-privacy-author){.section-name .selfRef} {#name-rfc-8324-dns-privacy-author}

The Informational document \[[RFC8324](#RFC8324){.xref}\] briefly
discusses the common role and challenges of DNS over TCP throughout the
history of DNS.[¶](#appendix-A.28-1){.pilcrow}
:::

::: {#appendix-A.29 .section}
### [A.29.](#appendix-A.29){.section-number .selfRef} [RFC 8467 - Padding Policies for Extension Mechanisms for DNS (EDNS(0))](#name-rfc-8467-padding-policies-f){.section-name .selfRef} {#name-rfc-8467-padding-policies-f}

The Experimental document \[[RFC8467](#RFC8467){.xref}\] reminds
implementors to consider the underlying transport protocol (e.g., TCP)
when calculating the padding length when artificially increasing the DNS
message size with an EDNS(0) padding
option.[¶](#appendix-A.29-1){.pilcrow}
:::

::: {#appendix-A.30 .section}
### [A.30.](#appendix-A.30){.section-number .selfRef} [RFC 8482 - Providing Minimal-Sized Responses to DNS Queries That Have QTYPE=ANY](#name-rfc-8482-providing-minimal-){.section-name .selfRef} {#name-rfc-8482-providing-minimal-}

The Proposed Standard \[[RFC8482](#RFC8482){.xref}\] describes
alternative ways that DNS servers can respond to queries of type ANY,
which are sometimes used to provide amplification in DDoS attacks. The
specification notes that responders may behave differently, depending on
the transport. For example, minimal-sized responses may be used over UDP
transport, while full responses may be given over
TCP.[¶](#appendix-A.30-1){.pilcrow}
:::

::: {#appendix-A.31 .section}
### [A.31.](#appendix-A.31){.section-number .selfRef} [RFC 8483 - Yeti DNS Testbed](#name-rfc-8483-yeti-dns-testbed){.section-name .selfRef} {#name-rfc-8483-yeti-dns-testbed}

The Informational document \[[RFC8483](#RFC8483){.xref}\] describes a
testbed environment that highlights some DNS-over-TCP behaviors,
including issues involving packet fragmentation and operational
requirements for TCP stream assembly in order to conduct DNS measurement
and analysis.[¶](#appendix-A.31-1){.pilcrow}
:::

::: {#appendix-A.32 .section}
### [A.32.](#appendix-A.32){.section-number .selfRef} [RFC 8484 - DNS Queries over HTTPS (DoH)](#name-rfc-8484-dns-queries-over-h){.section-name .selfRef} {#name-rfc-8484-dns-queries-over-h}

The Proposed Standard \[[RFC8484](#RFC8484){.xref}\] defines a protocol
for sending DNS queries and responses over HTTPS. This specification
assumes TLS and TCP for the underlying security and transport layers,
respectively. Self-described as a technique that more closely resembles
a tunneling mechanism, DoH nevertheless likely implies DNS over TCP in
some sense, if not directly.[¶](#appendix-A.32-1){.pilcrow}
:::

::: {#appendix-A.33 .section}
### [A.33.](#appendix-A.33){.section-number .selfRef} [RFC 8490 - DNS Stateful Operations](#name-rfc-8490-dns-stateful-opera){.section-name .selfRef} {#name-rfc-8490-dns-stateful-opera}

The Proposed Standard \[[RFC8490](#RFC8490){.xref}\] updates the base
protocol specification with a new OPCODE to help manage stateful
operations in persistent sessions, such as those that might be used by
DNS over TCP.[¶](#appendix-A.33-1){.pilcrow}
:::

::: {#appendix-A.34 .section}
### [A.34.](#appendix-A.34){.section-number .selfRef} [RFC 8501 - Reverse DNS in IPv6 for Internet Service Providers](#name-rfc-8501-reverse-dns-in-ipv){.section-name .selfRef} {#name-rfc-8501-reverse-dns-in-ipv}

The Informational document \[[RFC8501](#RFC8501){.xref}\] identifies
potential operational challenges with dynamic DNS, including
denial-of-service threats. The document suggests TCP may provide some
advantages but that updating hosts would need to be explicitly
configured to use TCP instead of UDP.[¶](#appendix-A.34-1){.pilcrow}
:::

::: {#appendix-A.35 .section}
### [A.35.](#appendix-A.35){.section-number .selfRef} [RFC 8806 - Running a Root Server Local to a Resolver](#name-rfc-8806-running-a-root-ser){.section-name .selfRef} {#name-rfc-8806-running-a-root-ser}

The Informational document \[[RFC8806](#RFC8806){.xref}\] describes how
to obtain and operate a local copy of the root zone with examples
showing how to pull from authoritative sources using a DNS-over-TCP zone
transfer.[¶](#appendix-A.35-1){.pilcrow}
:::

::: {#appendix-A.36 .section}
### [A.36.](#appendix-A.36){.section-number .selfRef} [RFC 8906 - A Common Operational Problem in DNS Servers: Failure to Communicate](#name-rfc-8906-a-common-operation){.section-name .selfRef} {#name-rfc-8906-a-common-operation}

The Best Current Practice document \[[RFC8906](#RFC8906){.xref}\]
discusses a number of DNS operational failure scenarios and how to avoid
them. This includes discussions involving DNS-over-TCP queries, EDNS
over TCP, and a testing methodology that includes a section on verifying
DNS-over-TCP functionality.[¶](#appendix-A.36-1){.pilcrow}
:::

::: {#appendix-A.37 .section}
### [A.37.](#appendix-A.37){.section-number .selfRef} [RFC 8932 - Recommendations for DNS Privacy Service Operators](#name-rfc-8932-recommendations-fo){.section-name .selfRef} {#name-rfc-8932-recommendations-fo}

The Best Current Practice document \[[RFC8932](#RFC8932){.xref}\]
presents privacy considerations to DNS privacy service operators. These
mechanisms sometimes include the use of TCP and are therefore
susceptible to information leakage such as TCP-based fingerprinting.
This document also references an earlier draft version of this
document.[¶](#appendix-A.37-1){.pilcrow}
:::

::: {#appendix-A.38 .section}
### [A.38.](#appendix-A.38){.section-number .selfRef} [RFC 8945 - Secret Key Transaction Authentication for DNS (TSIG)](#name-rfc-8945-secret-key-transac){.section-name .selfRef} {#name-rfc-8945-secret-key-transac}

The Internet Standard \[[RFC8945](#RFC8945){.xref}\] recommends that a
client use TCP if truncated TSIG messages are
received.[¶](#appendix-A.38-1){.pilcrow}
:::
:::
:::

::: {#Acknowledgments}
::: {#appendix-B .section}
## [Acknowledgments](#name-acknowledgments){.section-name .selfRef} {#name-acknowledgments}

This document was initially motivated by feedback from students who
pointed out that they were hearing contradictory information about
filtering DNS-over-TCP messages. Thanks in particular to a teaching
colleague, JPL, who perhaps unknowingly encouraged the initial research
into the differences between what the community has historically said
and did. Thanks to all the NANOG 63 attendees who provided feedback for
an early talk on this subject.[¶](#appendix-B-1){.pilcrow}

The following individuals provided an array of feedback to help improve
this document: [Joe Abley]{.contact-name}, [Piet Barber]{.contact-name},
[Sara Dickinson]{.contact-name}, [Tony Finch]{.contact-name}, [Bob
Harold]{.contact-name}, [Paul Hoffman]{.contact-name}, [Geoff
Huston]{.contact-name}, [Tatuya Jinmei]{.contact-name}, [Puneet
Sood]{.contact-name}, and [Richard Wilhelm]{.contact-name}. The authors
are also indebted to the contributions stemming from discussion in the
TCPM Working Group meeting at IETF 104. Any remaining errors or
imperfections are the sole responsibility of the document
authors.[¶](#appendix-B-2){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#appendix-C .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[John Kristoff]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Dataplane.org]{.org}
:::

::: {.left dir="auto"}
[Chicago]{.locality}, [IL]{.region} [60605]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: tel
Phone: [+1 312 493 0305](tel:+1%20312%20493%200305){.tel}
:::

::: email
Email: <jtk@dataplane.org>
:::

::: url
URI: <https://dataplane.org/jtk/>
:::

::: {.left dir="auto"}
[Duane Wessels]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Verisign]{.org}
:::

::: {.left dir="auto"}
[12061 Bluemont Way]{.street-address}
:::

::: {.left dir="auto"}
[Reston]{.locality}, [VA]{.region} [20190]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: tel
Phone: [+1 703 948 3200](tel:+1%20703%20948%203200){.tel}
:::

::: email
Email: <dwessels@verisign.com>
:::

::: url
URI: <https://verisign.com>
:::
:::
:::
