  RFC 8805        Self-Published IP Geofeeds   August 2020
  --------------- ---------------------------- -------------
  Kline, et al.   Informational                \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Independent Submission

RFC:
:   [8805](https://www.rfc-editor.org/rfc/rfc8805){.eref}

Category:
:   Informational

Published:
:   August 2020

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    E. Kline
    :::

    ::: org
    Loon LLC
    :::
    :::

    ::: author
    ::: author-name
    K. Duleba
    :::

    ::: org
    Google
    :::
    :::

    ::: author
    ::: author-name
    Z. Szamonek
    :::

    ::: org
    Google Switzerland GmbH
    :::
    :::

    ::: author
    ::: author-name
    S. Moser
    :::

    ::: org
    Google Switzerland GmbH
    :::
    :::

    ::: author
    ::: author-name
    W. Kumari
    :::

    ::: org
    Google
    :::
    :::
:::

# RFC 8805 {#rfcnum}

# A Format for Self-Published IP Geolocation Feeds {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document records a format whereby a network operator can publish a
mapping of IP address prefixes to simplified geolocation information,
colloquially termed a \"geolocation feed\". Interested parties can poll
and parse these feeds to update or merge with other geolocation data
sources and procedures. This format intentionally only allows specifying
coarse-level location.[¶](#section-abstract-1){.pilcrow}

Some technical organizations operating networks that move from one
conference location to the next have already experimentally published
small geolocation feeds.[¶](#section-abstract-2){.pilcrow}

This document describes a currently deployed format. At least one
consumer (Google) has incorporated these feeds into a geolocation data
pipeline, and a significant number of ISPs are using it to inform them
where their prefixes should be
geolocated.[¶](#section-abstract-3){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This document is not an Internet Standards Track specification; it is
published for informational
purposes.[¶](#section-boilerplate.1-1){.pilcrow}

This is a contribution to the RFC Series, independently of any other RFC
stream. The RFC Editor has chosen to publish this document at its
discretion and makes no statement about its value for implementation or
deployment. Documents approved for publication by the RFC Editor are not
candidates for any level of Internet Standard; see Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8805>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2020 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Motivation](#name-motivation){.xref}[¶](#section-toc.1-1.1.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.2}
        [1.2](#section-1.2){.xref}.  [Requirements
        Notation](#name-requirements-notation){.xref}[¶](#section-toc.1-1.1.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.3}
        [1.3](#section-1.3){.xref}.  [Assumptions about
        Publication](#name-assumptions-about-publicati){.xref}[¶](#section-toc.1-1.1.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Self-Published IP Geolocation
    Feeds](#name-self-published-ip-geolocati){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}

    -   ::: {#section-toc.1-1.2.2.1}
        [2.1](#section-2.1){.xref}.  [Specification](#name-specification){.xref}[¶](#section-toc.1-1.2.2.1.1){.pilcrow}

        -   ::: {#section-toc.1-1.2.2.1.2.1}
            [2.1.1](#section-2.1.1){.xref}.  [Geolocation Feed
            Individual Entry
            Fields](#name-geolocation-feed-individual){.xref}[¶](#section-toc.1-1.2.2.1.2.1.1){.pilcrow}

            -   ::: {#section-toc.1-1.2.2.1.2.1.2.1}
                [2.1.1.1](#section-2.1.1.1){.xref}.  [IP
                Prefix](#name-ip-prefix){.xref}[¶](#section-toc.1-1.2.2.1.2.1.2.1.1){.pilcrow}
                :::

            -   ::: {#section-toc.1-1.2.2.1.2.1.2.2}
                [2.1.1.2](#section-2.1.1.2){.xref}.  [Alpha2code
                (Previously:
                \'country\')](#name-alpha2code-previously-count){.xref}[¶](#section-toc.1-1.2.2.1.2.1.2.2.1){.pilcrow}
                :::

            -   ::: {#section-toc.1-1.2.2.1.2.1.2.3}
                [2.1.1.3](#section-2.1.1.3){.xref}.  [Region](#name-region){.xref}[¶](#section-toc.1-1.2.2.1.2.1.2.3.1){.pilcrow}
                :::

            -   ::: {#section-toc.1-1.2.2.1.2.1.2.4}
                [2.1.1.4](#section-2.1.1.4){.xref}.  [City](#name-city){.xref}[¶](#section-toc.1-1.2.2.1.2.1.2.4.1){.pilcrow}
                :::

            -   ::: {#section-toc.1-1.2.2.1.2.1.2.5}
                [2.1.1.5](#section-2.1.1.5){.xref}.  [Postal
                Code](#name-postal-code){.xref}[¶](#section-toc.1-1.2.2.1.2.1.2.5.1){.pilcrow}
                :::
            :::

        -   ::: {#section-toc.1-1.2.2.1.2.2}
            [2.1.2](#section-2.1.2){.xref}.  [Prefixes with No
            Geolocation
            Information](#name-prefixes-with-no-geolocatio){.xref}[¶](#section-toc.1-1.2.2.1.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.2.2.1.2.3}
            [2.1.3](#section-2.1.3){.xref}.  [Additional Parsing
            Requirements](#name-additional-parsing-requirem){.xref}[¶](#section-toc.1-1.2.2.1.2.3.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.2.2.2}
        [2.2](#section-2.2){.xref}.  [Examples](#name-examples){.xref}[¶](#section-toc.1-1.2.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Consuming Self-Published IP Geolocation
    Feeds](#name-consuming-self-published-ip){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}

    -   ::: {#section-toc.1-1.3.2.1}
        [3.1](#section-3.1){.xref}.  [Feed
        Integrity](#name-feed-integrity){.xref}[¶](#section-toc.1-1.3.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.2}
        [3.2](#section-3.2){.xref}.  [Verification of
        Authority](#name-verification-of-authority){.xref}[¶](#section-toc.1-1.3.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.3}
        [3.3](#section-3.3){.xref}.  [Verification of
        Accuracy](#name-verification-of-accuracy){.xref}[¶](#section-toc.1-1.3.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.4}
        [3.4](#section-3.4){.xref}.  [Refreshing Feed
        Information](#name-refreshing-feed-information){.xref}[¶](#section-toc.1-1.3.2.4.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Privacy
    Considerations](#name-privacy-considerations){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Relation to Other
    Work](#name-relation-to-other-work){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Planned Future
    Work](#name-planned-future-work){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Finding Self-Published IP Geolocation
    Feeds](#name-finding-self-published-ip-g){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Ad Hoc \'Well-Known\'
        URIs](#name-ad-hoc-well-known-uris){.xref}[¶](#section-toc.1-1.8.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Other
        Mechanisms](#name-other-mechanisms){.xref}[¶](#section-toc.1-1.8.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.10.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.10.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [Appendix A](#section-appendix.a){.xref}.  [Sample Python Validation
    Code](#name-sample-python-validation-co){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.12}
    [](#section-appendix.b){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.13}
    [](#section-appendix.c){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Motivation](#name-motivation){.section-name .selfRef} {#name-motivation}

Providers of services over the Internet have grown to depend on
best-effort geolocation information to improve the user experience.
Locality information can aid in directing traffic to the nearest serving
location, inferring likely native language, and providing additional
context for services involving search
queries.[¶](#section-1.1-1){.pilcrow}

When an ISP, for example, changes the location where an IP prefix is
deployed, services that make use of geolocation information may begin to
suffer degraded performance. This can lead to customer complaints,
possibly to the ISP directly. Dissemination of correct geolocation data
is complicated by the lack of any centralized means to coordinate and
communicate geolocation information to all interested consumers of the
data.[¶](#section-1.1-2){.pilcrow}

This document records a format whereby a network operator (an ISP, an
enterprise, or any organization that deems the geolocation of its IP
prefixes to be of concern) can publish a mapping of IP address prefixes
to simplified geolocation information, colloquially termed a
\"geolocation feed\". Interested parties can poll and parse these feeds
to update or merge with other geolocation data sources and
procedures.[¶](#section-1.1-3){.pilcrow}

This document describes a currently deployed format. At least one
consumer (Google) has incorporated these feeds into a geolocation data
pipeline, and a significant number of ISPs are using it to inform them
where their prefixes should be geolocated.[¶](#section-1.1-4){.pilcrow}
:::

::: {#section-1.2 .section}
### [1.2.](#section-1.2){.section-number .selfRef} [Requirements Notation](#name-requirements-notation){.section-name .selfRef} {#name-requirements-notation}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-1.2-1){.pilcrow}

As this is an informational document about a data format and set of
operational practices presently in use, requirements notation captures
the design goals of the authors and
implementors.[¶](#section-1.2-2){.pilcrow}
:::

::: {#section-1.3 .section}
### [1.3.](#section-1.3){.section-number .selfRef} [Assumptions about Publication](#name-assumptions-about-publicati){.section-name .selfRef} {#name-assumptions-about-publicati}

This document describes both a format and a mechanism for publishing
data, with the assumption that the network operator to whom operational
responsibility has been delegated for any published data wishes it to be
public. Any privacy risk is bounded by the format, and feed publishers
[MAY]{.bcp14} omit prefixes or any location field associated with a
given prefix to further protect privacy (see [Section 2.1](#spec){.xref}
for details about which fields exactly may be omitted). Feed publishers
assume the responsibility of determining which data should be made
public.[¶](#section-1.3-1){.pilcrow}

This document does not incorporate a mechanism to communicate acceptable
use policies for self-published data. Publication itself is inferred as
a desire by the publisher for the data to be usefully consumed, similar
to the publication of information like host names, cryptographic keys,
and Sender Policy Framework (SPF) records \[[RFC7208](#RFC7208){.xref}\]
in the DNS.[¶](#section-1.3-2){.pilcrow}
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Self-Published IP Geolocation Feeds](#name-self-published-ip-geolocati){.section-name .selfRef} {#name-self-published-ip-geolocati}

The format described here was developed to address the need of network
operators to rapidly and usefully share geolocation information changes.
Originally, there arose a specific case where regional operators found
it desirable to publish location changes rather than wait for
geolocation algorithms to \"learn\" about them. Later, technical
conferences that frequently use the same network prefixes advertised
from different conference locations experimented by publishing
geolocation feeds updated in advance of network location changes in
order to better serve conference attendees.[¶](#section-2-1){.pilcrow}

At its simplest, the mechanism consists of a network operator publishing
a file (the \"geolocation feed\") that contains several text entries,
one per line. Each entry is keyed by a unique (within the feed) IP
prefix (or single IP address) followed by a sequence of network locality
attributes to be ascribed to the given
prefix.[¶](#section-2-2){.pilcrow}

::: {#spec}
::: {#section-2.1 .section}
### [2.1.](#section-2.1){.section-number .selfRef} [Specification](#name-specification){.section-name .selfRef} {#name-specification}

For operational simplicity, every feed should contain data about all IP
addresses the provider wants to publish. Alternatives, like publishing
only entries for IP addresses whose geolocation data has changed or
differ from current observed geolocation behavior \"at large\", are
likely to be too operationally complex.[¶](#section-2.1-1){.pilcrow}

Feeds [MUST]{.bcp14} use UTF-8 \[[RFC3629](#RFC3629){.xref}\] character
encoding. Lines are delimited by a line break (CRLF) (as specified in
\[[RFC4180](#RFC4180){.xref}\]), and blank lines are ignored. Text from
a \'#\' character to the end of the current line is treated as a comment
only and is similarly ignored (note that this does not strictly follow
\[[RFC4180](#RFC4180){.xref}\], which has no support for
comments).[¶](#section-2.1-2){.pilcrow}

Feed lines that are not comments [MUST]{.bcp14} be formatted as
comma-separated values (CSV), as described in
\[[RFC4180](#RFC4180){.xref}\]. Each feed entry is a text line of the
form:[¶](#section-2.1-3){.pilcrow}

::: {#section-2.1-4 .artwork .art-text .alignLeft}
    ip_prefix,alpha2code,region,city,postal_code

[¶](#section-2.1-4){.pilcrow}
:::

The IP prefix field is [REQUIRED]{.bcp14}, all others are
[OPTIONAL]{.bcp14} (can be empty), though the requisite minimum number
of commas [SHOULD]{.bcp14} be present.[¶](#section-2.1-5){.pilcrow}

::: {#section-2.1.1 .section}
#### [2.1.1.](#section-2.1.1){.section-number .selfRef} [Geolocation Feed Individual Entry Fields](#name-geolocation-feed-individual){.section-name .selfRef} {#name-geolocation-feed-individual}

::: {#section-2.1.1.1 .section}
##### [2.1.1.1.](#section-2.1.1.1){.section-number .selfRef} [IP Prefix](#name-ip-prefix){.section-name .selfRef} {#name-ip-prefix}

[REQUIRED]{.bcp14}: Each IP prefix field [MUST]{.bcp14} be either a
single IP address or an IP prefix in Classless Inter-Domain Routing
(CIDR) notation in conformance with [Section
3.1](https://www.rfc-editor.org/rfc/rfc4632#section-3.1){.relref} of
\[[RFC4632](#RFC4632){.xref}\] for IPv4 or [Section
2.3](https://www.rfc-editor.org/rfc/rfc4291#section-2.3){.relref} of
\[[RFC4291](#RFC4291){.xref}\] for
IPv6.[¶](#section-2.1.1.1-1){.pilcrow}

Examples include \"192.0.2.1\" and \"192.0.2.0/24\" for IPv4 and
\"2001:db8::1\" and \"2001:db8::/32\" for
IPv6.[¶](#section-2.1.1.1-2){.pilcrow}
:::

::: {#section-2.1.1.2 .section}
##### [2.1.1.2.](#section-2.1.1.2){.section-number .selfRef} [Alpha2code (Previously: \'country\')](#name-alpha2code-previously-count){.section-name .selfRef} {#name-alpha2code-previously-count}

[OPTIONAL]{.bcp14}: The alpha2code field, if non-empty, [MUST]{.bcp14}
be a 2-letter ISO country code conforming to ISO 3166-1 alpha 2
\[[ISO.3166.1alpha2](#ISO.3166.1alpha2){.xref}\]. Parsers
[SHOULD]{.bcp14} treat this field
case-insensitively.[¶](#section-2.1.1.2-1){.pilcrow}

Earlier versions of this document called this field \"country\", and it
may still be referred to as such in existing
tools/interfaces.[¶](#section-2.1.1.2-2){.pilcrow}

Parsers [MAY]{.bcp14} additionally support other 2-letter codes outside
the ISO 3166-1 alpha 2 codes, such as the 2-letter codes from the
\"Exceptionally reserved codes\"
\[[ISO-GLOSSARY](#ISO-GLOSSARY){.xref}\]
set.[¶](#section-2.1.1.2-3){.pilcrow}

Examples include \"US\" for the United States, \"JP\" for Japan, and
\"PL\" for Poland.[¶](#section-2.1.1.2-4){.pilcrow}
:::

::: {#section-2.1.1.3 .section}
##### [2.1.1.3.](#section-2.1.1.3){.section-number .selfRef} [Region](#name-region){.section-name .selfRef} {#name-region}

[OPTIONAL]{.bcp14}: The region field, if non-empty, [MUST]{.bcp14} be an
ISO region code conforming to ISO 3166-2
\[[ISO.3166.2](#ISO.3166.2){.xref}\]. Parsers [SHOULD]{.bcp14} treat
this field case-insensitively.[¶](#section-2.1.1.3-1){.pilcrow}

Examples include \"ID-RI\" for the Riau province of Indonesia and
\"NG-RI\" for the Rivers province in
Nigeria.[¶](#section-2.1.1.3-2){.pilcrow}
:::

::: {#section-2.1.1.4 .section}
##### [2.1.1.4.](#section-2.1.1.4){.section-number .selfRef} [City](#name-city){.section-name .selfRef} {#name-city}

[OPTIONAL]{.bcp14}: The city field, if non-empty, [SHOULD]{.bcp14} be
free UTF-8 text, excluding the comma (\',\')
character.[¶](#section-2.1.1.4-1){.pilcrow}

Examples include \"Dublin\", \"New York\", and \"Sao Paulo\"
(specifically \"S\" followed by 0xc3, 0xa3, and \"o
Paulo\").[¶](#section-2.1.1.4-2){.pilcrow}
:::

::: {#postal}
::: {#section-2.1.1.5 .section}
##### [2.1.1.5.](#section-2.1.1.5){.section-number .selfRef} [Postal Code](#name-postal-code){.section-name .selfRef} {#name-postal-code}

[OPTIONAL]{.bcp14}, DEPRECATED: The postal code field, if non-empty,
[SHOULD]{.bcp14} be free UTF-8 text, excluding the comma (\',\')
character. The use of this field is deprecated; consumers of feeds
should be able to parse feeds containing these fields, but new feeds
[SHOULD NOT]{.bcp14} include this field due to the granularity of this
information. See [Section 4](#privacy){.xref} for additional
discussion.[¶](#section-2.1.1.5-1){.pilcrow}

Examples include \"106-6126\" (in Minato ward, Tokyo,
Japan).[¶](#section-2.1.1.5-2){.pilcrow}
:::
:::
:::

::: {#section-2.1.2 .section}
#### [2.1.2.](#section-2.1.2){.section-number .selfRef} [Prefixes with No Geolocation Information](#name-prefixes-with-no-geolocatio){.section-name .selfRef} {#name-prefixes-with-no-geolocatio}

Feed publishers may indicate that some IP prefixes should not have any
associated geolocation information. It may be that some prefixes under
their administrative control are reserved, not yet allocated or
deployed, or in the process of being redeployed elsewhere and existing
geolocation information can, from the perspective of the publisher,
safely be discarded.[¶](#section-2.1.2-1){.pilcrow}

This special case can be indicated by explicitly leaving blank all
fields that specify any degree of geolocation information. For
example:[¶](#section-2.1.2-2){.pilcrow}

::: {#section-2.1.2-3 .artwork .art-text .alignLeft}
    192.0.2.0/24,,,,
    2001:db8:1::/48,,,,
    2001:db8:2::/48,,,,

[¶](#section-2.1.2-3){.pilcrow}
:::

Historically, the user-assigned alpha2code identifier of \"ZZ\" has been
used for this same purpose. This is not necessarily preferred, and no
specific interpretation of any of the other user-assigned alpha2code
codes is currently defined.[¶](#section-2.1.2-4){.pilcrow}
:::

::: {#section-2.1.3 .section}
#### [2.1.3.](#section-2.1.3){.section-number .selfRef} [Additional Parsing Requirements](#name-additional-parsing-requirem){.section-name .selfRef} {#name-additional-parsing-requirem}

Feed entries that do not have an IP address or prefix field or have an
IP address or prefix field that fails to parse correctly [MUST]{.bcp14}
be discarded.[¶](#section-2.1.3-1){.pilcrow}

While publishers [SHOULD]{.bcp14} follow \[[RFC5952](#RFC5952){.xref}\]
for IPv6 prefix fields, consumers [MUST]{.bcp14} nevertheless accept all
valid string representations.[¶](#section-2.1.3-2){.pilcrow}

Duplicate IP address or prefix entries [MUST]{.bcp14} be considered an
error, and consumer implementations [SHOULD]{.bcp14} log the repeated
entries for further administrative review. Publishers [SHOULD]{.bcp14}
take measures to ensure there is one and only one entry per IP address
and prefix.[¶](#section-2.1.3-3){.pilcrow}

Multiple entries that constitute nested prefixes are permitted.
Consumers [SHOULD]{.bcp14} consider the entry with the longest matching
prefix (i.e., the \"most specific\") to be the best matching entry for a
given IP address.[¶](#section-2.1.3-4){.pilcrow}

Feed entries with non-empty optional fields that fail to parse, either
in part or in full, [SHOULD]{.bcp14} be discarded. It is
[RECOMMENDED]{.bcp14} that they also be logged for further
administrative review.[¶](#section-2.1.3-5){.pilcrow}

For compatibility with future additional fields, a parser [MUST]{.bcp14}
ignore any fields beyond those it expects. The data from fields that are
expected and that parse successfully [MUST]{.bcp14} still be considered
valid. Per [Section 7](#future_work){.xref}, no extensions to this
format are in use nor are any
anticipated.[¶](#section-2.1.3-6){.pilcrow}
:::
:::
:::

::: {#section-2.2 .section}
### [2.2.](#section-2.2){.section-number .selfRef} [Examples](#name-examples){.section-name .selfRef} {#name-examples}

Example entries using different IP address formats and describing
locations at alpha2code (\"country code\"), region, and city granularity
level, respectively:[¶](#section-2.2-1){.pilcrow}

::: {#section-2.2-2 .artwork .art-text .alignLeft}
    192.0.2.0/25,US,US-AL,,
    192.0.2.5,US,US-AL,Alabaster,
    192.0.2.128/25,PL,PL-MZ,,
    2001:db8::/32,PL,,,
    2001:db8:cafe::/48,PL,PL-MZ,,

[¶](#section-2.2-2){.pilcrow}
:::

The IETF network publishes geolocation information for the meeting
prefixes, and generally just comment out the last meeting information
and append the new meeting information. The
\[[GEO_IETF](#GEO_IETF){.xref}\], at the time of this writing,
contains:[¶](#section-2.2-3){.pilcrow}

::: {#section-2.2-4 .artwork .art-text .alignLeft}
    # IETF106 (Singapore) - November 2019 - Singapore, SG
    130.129.0.0/16,SG,SG-01,Singapore,
    2001:df8::/32,SG,SG-01,Singapore,
    31.133.128.0/18,SG,SG-01,Singapore,
    31.130.224.0/20,SG,SG-01,Singapore,
    2001:67c:1230::/46,SG,SG-01,Singapore,
    2001:67c:370::/48,SG,SG-01,Singapore,

[¶](#section-2.2-4){.pilcrow}
:::

Experimentally, RIPE has published geolocation information for their
conference network prefixes, which change location in accordance with
each new event. \[[GEO_RIPE_NCC](#GEO_RIPE_NCC){.xref}\], at the time of
writing, contains:[¶](#section-2.2-5){.pilcrow}

::: {#section-2.2-6 .artwork .art-text .alignLeft}
    193.0.24.0/21,NL,NL-ZH,Rotterdam,
    2001:67c:64::/48,NL,NL-ZH,Rotterdam,

[¶](#section-2.2-6){.pilcrow}
:::

Similarly, ICANN has published geolocation information for their
portable conference network prefixes.
\[[GEO_ICANN](#GEO_ICANN){.xref}\], at the time of writing,
contains:[¶](#section-2.2-7){.pilcrow}

::: {#section-2.2-8 .artwork .art-text .alignLeft}
    199.91.192.0/21,MA,MA-07,Marrakech
    2620:f:8000::/48,MA,MA-07,Marrakech

[¶](#section-2.2-8){.pilcrow}
:::

A longer example is the \[[GEO_Google](#GEO_Google){.xref}\] Google Corp
Geofeed, which lists the geolocation information for Google corporate
offices.[¶](#section-2.2-9){.pilcrow}

At the time of writing, Google processes approximately 400 feeds
comprising more than 750,000 IPv4 and IPv6
prefixes.[¶](#section-2.2-10){.pilcrow}
:::
:::

::: {#consumers}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Consuming Self-Published IP Geolocation Feeds](#name-consuming-self-published-ip){.section-name .selfRef} {#name-consuming-self-published-ip}

Consumers [MAY]{.bcp14} treat published feed data as a hint only and
[MAY]{.bcp14} choose to prefer other sources of geolocation information
for any given IP prefix. Regardless of a consumer\'s stance with respect
to a given published feed, there are some points of note for sensibly
and effectively consuming published feeds.[¶](#section-3-1){.pilcrow}

::: {#integrity}
::: {#section-3.1 .section}
### [3.1.](#section-3.1){.section-number .selfRef} [Feed Integrity](#name-feed-integrity){.section-name .selfRef} {#name-feed-integrity}

The integrity of published information [SHOULD]{.bcp14} be protected by
securing the means of publication, for example, by using HTTP over TLS
\[[RFC2818](#RFC2818){.xref}\]. Whenever possible, consumers
[SHOULD]{.bcp14} prefer retrieving geolocation feeds in a manner that
guarantees integrity of the feed.[¶](#section-3.1-1){.pilcrow}
:::
:::

::: {#authority}
::: {#section-3.2 .section}
### [3.2.](#section-3.2){.section-number .selfRef} [Verification of Authority](#name-verification-of-authority){.section-name .selfRef} {#name-verification-of-authority}

Consumers of self-published IP geolocation feeds [SHOULD]{.bcp14}
perform some form of verification that the publisher is in fact
authoritative for the addresses in the feed. The actual means of
verification is likely dependent upon the way in which the feed is
discovered. Ad hoc shared URIs, for example, will likely require an ad
hoc verification process. Future automated means of feed discovery
[SHOULD]{.bcp14} have an accompanying automated means of
verification.[¶](#section-3.2-1){.pilcrow}

A consumer should only trust geolocation information for IP addresses or
prefixes for which the publisher has been verified as administratively
authoritative. All other geolocation feed entries should be ignored and
logged for further administrative review.[¶](#section-3.2-2){.pilcrow}
:::
:::

::: {#accuracy}
::: {#section-3.3 .section}
### [3.3.](#section-3.3){.section-number .selfRef} [Verification of Accuracy](#name-verification-of-accuracy){.section-name .selfRef} {#name-verification-of-accuracy}

Errors and inaccuracies may occur at many levels, and publication and
consumption of geolocation data are no exceptions. To the extent
practical, consumers [SHOULD]{.bcp14} take steps to verify the accuracy
of published locality. Verification methodology, resolution of
discrepancies, and preference for alternative sources of data are left
to the discretion of the feed consumer.[¶](#section-3.3-1){.pilcrow}

Consumers [SHOULD]{.bcp14} decide on discrepancy thresholds and
[SHOULD]{.bcp14} flag, for administrative review, feed entries that
exceed set thresholds.[¶](#section-3.3-2){.pilcrow}
:::
:::

::: {#section-3.4 .section}
### [3.4.](#section-3.4){.section-number .selfRef} [Refreshing Feed Information](#name-refreshing-feed-information){.section-name .selfRef} {#name-refreshing-feed-information}

As a publisher can change geolocation data at any time and without
notification, consumers [SHOULD]{.bcp14} implement mechanisms to
periodically refresh local copies of feed data. In the absence of any
other refresh timing information, it is recommended that consumers
[SHOULD]{.bcp14} refresh feeds no less often than weekly and no more
often than is likely to cause issues to the
publisher.[¶](#section-3.4-1){.pilcrow}

For feeds available via HTTPS (or HTTP), the publisher [MAY]{.bcp14}
communicate refresh timing information by means of the standard HTTP
expiration model (\[[RFC7234](#RFC7234){.xref}\]). Specifically,
publishers can include either an Expires header ([Section
5.3](https://www.rfc-editor.org/rfc/rfc7234#section-5.3){.relref} of
\[[RFC7234](#RFC7234){.xref}\]) or a Cache-Control header ([Section
5.2](https://www.rfc-editor.org/rfc/rfc7234#section-5.2){.relref} of
\[[RFC7234](#RFC7234){.xref}\]) specifying the max-age. Where practical,
consumers [SHOULD]{.bcp14} refresh feed information before the expiry
time is reached.[¶](#section-3.4-2){.pilcrow}
:::
:::
:::

::: {#privacy}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Privacy Considerations](#name-privacy-considerations){.section-name .selfRef} {#name-privacy-considerations}

Publishers of geolocation feeds are advised to have fully considered any
and all privacy implications of the disclosure of such information for
the users of the described networks prior to publication. A thorough
comprehension of the security considerations ([Section
13](https://www.rfc-editor.org/rfc/rfc6772#section-13){.relref} of
\[[RFC6772](#RFC6772){.xref}\]) of a chosen geolocation policy is highly
recommended, including an understanding of some of the limitations of
information obscurity ([Section
13.5](https://www.rfc-editor.org/rfc/rfc6772#section-13.5){.relref} of
\[[RFC6772](#RFC6772){.xref}\]) (see also
\[[RFC6772](#RFC6772){.xref}\]).[¶](#section-4-1){.pilcrow}

As noted in [Section 2.1](#spec){.xref}, each location field in an entry
is optional, in order to support expressing only the level of
specificity that the publisher has deemed acceptable. There is no
requirement that the level of specificity be consistent across all
entries within a feed. In particular, the Postal Code field ([Section
2.1.1.5](#postal){.xref}) can provide very specific geolocation,
sometimes within a building. Such specific Postal Code values [MUST
NOT]{.bcp14} be published in geofeeds without the express consent of the
parties being located.[¶](#section-4-2){.pilcrow}

Operators who publish geolocation information are strongly encouraged to
inform affected users/customers of this fact and of the potential
privacy-related consequences and trade-offs.[¶](#section-4-3){.pilcrow}
:::
:::

::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Relation to Other Work](#name-relation-to-other-work){.section-name .selfRef} {#name-relation-to-other-work}

While not originally done in conjunction with the GEOPRIV Working Group
\[[GEOPRIV](#GEOPRIV){.xref}\], Richard Barnes observed that this work
is nevertheless consistent with that which the group has defined, both
for address format and for privacy. The data elements in geolocation
feeds are equivalent to the following XML structure
(\[[RFC5139](#RFC5139){.xref}\]
\[[W3C.REC-xml-20081126](#W3C.REC-xml-20081126){.xref}\]):[¶](#section-5-1){.pilcrow}

::: {#section-5-2}
``` {.sourcecode .lang-xml}
<civicAddress>
  <country>country</country>
  <A1>region</A1>
  <A2>city</A2>
  <PC>postal_code</PC>
</civicAddress>
```

[¶](#section-5-2){.pilcrow}
:::

Providing geolocation information to this granularity is equivalent to
the following privacy policy (the definition of the \'building\'
[Section
6.5.1](https://www.rfc-editor.org/rfc/rfc6772#section-6.5.1){.relref} of
\[[RFC6772](#RFC6772){.xref}\] level of
disclosure):[¶](#section-5-3){.pilcrow}

::: {#section-5-4}
``` {.sourcecode .lang-xml}
<ruleset>
  <rule>
    <conditions/>
    <actions/>
    <transformations>
      <provide-location profile="civic-transformation">
        <provide-civic>building</provide-civic>
      </provide-location>
    </transformations>
  </rule>
</ruleset>
```

[¶](#section-5-4){.pilcrow}
:::
:::

::: {#Security}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

As there is no true security in the obscurity of the location of any
given IP address, self-publication of this data fundamentally opens no
new attack vectors. For publishers, self-published data may increase the
ease with which such location data might be exploited (it can, for
example, make easy the discovery of prefixes populated with customers as
distinct from prefixes not generally in use).[¶](#section-6-1){.pilcrow}

For consumers, feed retrieval processes may receive input from
potentially hostile sources (e.g., in the event of hijacked traffic). As
such, proper input validation and defense measures [MUST]{.bcp14} be
taken (see the discussion in [Section
3.1](#integrity){.xref}).[¶](#section-6-2){.pilcrow}

Similarly, consumers who do not perform sufficient verification of
published data bear the same risks as from other forms of geolocation
configuration errors (see the discussion in Sections
[3.2](#authority){.xref} and
[3.3](#accuracy){.xref}).[¶](#section-6-3){.pilcrow}

Validation of a feed\'s contents includes verifying that the publisher
is authoritative for the IP prefixes included in the feed. Failure to
verify IP prefix authority would, for example, allow ISP Bob to make
geolocation statements about IP space held by ISP Alice. At this time,
only out-of-band verification methods are implemented (i.e., an ISP\'s
feed may be verified against publicly available IP allocation
data).[¶](#section-6-4){.pilcrow}
:::
:::

::: {#future_work}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Planned Future Work](#name-planned-future-work){.section-name .selfRef} {#name-planned-future-work}

In order to more flexibly support future extensions, use of a more
expressive feed format has been suggested. Use of JavaScript Object
Notation (JSON) \[[RFC8259](#RFC8259){.xref}\], specifically, has been
discussed. However, at the time of writing, no such specification nor
implementation exists. Nevertheless, work on extensions is deferred
until a more suitable format has been
selected.[¶](#section-7-1){.pilcrow}

The authors are planning on writing a document describing such a new
format. This document describes a currently deployed and used format.
Given the extremely limited extensibility of the present format no
extensions to it are anticipated. Extensibility requirements are instead
expected to be integral to the development of a new
format.[¶](#section-7-2){.pilcrow}
:::
:::

::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Finding Self-Published IP Geolocation Feeds](#name-finding-self-published-ip-g){.section-name .selfRef} {#name-finding-self-published-ip-g}

The issue of finding, and later verifying, geolocation feeds is not
formally specified in this document. At this time, only ad hoc feed
discovery and verification has a modicum of established practice (see
below); discussion of other mechanisms has been removed for
clarity.[¶](#section-8-1){.pilcrow}

::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Ad Hoc \'Well-Known\' URIs](#name-ad-hoc-well-known-uris){.section-name .selfRef} {#name-ad-hoc-well-known-uris}

To date, geolocation feeds have been shared informally in the form of
HTTPS URIs exchanged in email threads. Three example URIs
(\[[GEO_IETF](#GEO_IETF){.xref}\],
\[[GEO_RIPE_NCC](#GEO_RIPE_NCC){.xref}\], and
\[[GEO_ICANN](#GEO_ICANN){.xref}\]) describe networks that change
locations periodically, the operators and operational practices of which
are well known within their respective technical
communities.[¶](#section-8.1-1){.pilcrow}

The contents of the feeds are verified by a similarly ad hoc process,
including:[¶](#section-8.1-2){.pilcrow}

-   [personal knowledge of the parties involved in the exchange
    and[¶](#section-8.1-3.1){.pilcrow}]{#section-8.1-3.1}
-   [comparison of feed-advertised prefixes with the BGP-advertised
    prefixes of Autonomous System Numbers known to be operated by the
    publishers.[¶](#section-8.1-3.2){.pilcrow}]{#section-8.1-3.2}

Ad hoc mechanisms, while useful for early experimentation by producers
and consumers, are unlikely to be adequate for long-term, widespread use
by multiple parties. Future versions of any such self-published
geolocation feed mechanism [SHOULD]{.bcp14} address scalability concerns
by defining a means for automated discovery and verification of
operational authority of advertised
prefixes.[¶](#section-8.1-4){.pilcrow}
:::

::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Other Mechanisms](#name-other-mechanisms){.section-name .selfRef} {#name-other-mechanisms}

Previous versions of this document referenced use of the WHOIS service
\[[RFC3912](#RFC3912){.xref}\] operated by Regional Internet Registries
(RIRs), as well as possible DNS-based schemes to discover and validate
geofeeds. To the authors\' knowledge, support for such mechanisms has
never been implemented, and this speculative text has been removed to
avoid ambiguity.[¶](#section-8.2-1){.pilcrow}
:::
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-9-1){.pilcrow}
:::

::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[ISO.3166.1alpha2\]
:   [ISO]{.refAuthor}, [\"ISO 3166-1 decoding table\"]{.refTitle},
    \<<http://www.iso.org/iso/home/standards/country_codes/iso-3166-1_decoding_table.htm>\>.
:   

\[ISO.3166.2\]
:   [ISO]{.refAuthor}, [\"ISO 3166-2:2007\"]{.refTitle},
    \<<http://www.iso.org/iso/home/standards/country_codes.htm#2012_iso3166-2>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC3629\]
:   [Yergeau, F.]{.refAuthor}, [\"UTF-8, a transformation format of ISO
    10646\"]{.refTitle}, [STD 63]{.seriesInfo}, [RFC 3629]{.seriesInfo},
    [DOI 10.17487/RFC3629]{.seriesInfo}, November 2003,
    \<<https://www.rfc-editor.org/info/rfc3629>\>.
:   

\[RFC4180\]
:   [Shafranovich, Y.]{.refAuthor}, [\"Common Format and MIME Type for
    Comma-Separated Values (CSV) Files\"]{.refTitle}, [RFC
    4180]{.seriesInfo}, [DOI 10.17487/RFC4180]{.seriesInfo}, October
    2005, \<<https://www.rfc-editor.org/info/rfc4180>\>.
:   

\[RFC4291\]
:   [Hinden, R.]{.refAuthor}[ and S. Deering]{.refAuthor}, [\"IP Version
    6 Addressing Architecture\"]{.refTitle}, [RFC 4291]{.seriesInfo},
    [DOI 10.17487/RFC4291]{.seriesInfo}, February 2006,
    \<<https://www.rfc-editor.org/info/rfc4291>\>.
:   

\[RFC4632\]
:   [Fuller, V.]{.refAuthor}[ and T. Li]{.refAuthor}, [\"Classless
    Inter-domain Routing (CIDR): The Internet Address Assignment and
    Aggregation Plan\"]{.refTitle}, [BCP 122]{.seriesInfo}, [RFC
    4632]{.seriesInfo}, [DOI 10.17487/RFC4632]{.seriesInfo}, August
    2006, \<<https://www.rfc-editor.org/info/rfc4632>\>.
:   

\[RFC5952\]
:   [Kawamura, S.]{.refAuthor}[ and M. Kawashima]{.refAuthor}, [\"A
    Recommendation for IPv6 Address Text Representation\"]{.refTitle},
    [RFC 5952]{.seriesInfo}, [DOI 10.17487/RFC5952]{.seriesInfo}, August
    2010, \<<https://www.rfc-editor.org/info/rfc5952>\>.
:   

\[RFC7234\]
:   [Fielding, R., Ed.]{.refAuthor}[, Nottingham, M., Ed.]{.refAuthor}[,
    and J. Reschke, Ed.]{.refAuthor}, [\"Hypertext Transfer Protocol
    (HTTP/1.1): Caching\"]{.refTitle}, [RFC 7234]{.seriesInfo}, [DOI
    10.17487/RFC7234]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7234>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[W3C.REC-xml-20081126\]
:   [Bray, T.]{.refAuthor}[, Paoli, J.]{.refAuthor}[,
    Sperberg-McQueen, M.]{.refAuthor}[, Maler, E.]{.refAuthor}[, and F.
    Yergeau]{.refAuthor}, [\"Extensible Markup Language (XML) 1.0 (Fifth
    Edition)\"]{.refTitle}, [World Wide Web Consortium Recommendation
    REC-xml-20081126]{.seriesInfo}, November 2008,
    \<[http://www.w3.org/TR/2008/REC-xml-20081126](https://www.w3.org/TR/2008/REC-xml-20081126)\>.
:   
:::

::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[GEOPRIV\]
:   [IETF]{.refAuthor}, [\"Geographic Location/Privacy
    (geopriv)\"]{.refTitle}, ,
    \<[http://datatracker.ietf.org/wg/geopriv/](https://datatracker.ietf.org/wg/geopriv/)\>.
:   

\[GEO_Google\]
:   [Google, LLC]{.refAuthor}, [\"Google Corp Geofeed\"]{.refTitle},
    \<<https://www.gstatic.com/geofeed/corp_external>\>.
:   

\[GEO_ICANN\]
:   [ICANN]{.refAuthor}, [\"ICANN Meeting Geolocation
    Data\"]{.refTitle},
    \<<https://meeting-services.icann.org/geo/google.csv>\>.
:   

\[GEO_IETF\]
:   [Kumari, W.]{.refAuthor}, [\"IETF Meeting Network Geolocation
    Data\"]{.refTitle}, \<<https://noc.ietf.org/geo/google.csv>\>.
:   

\[GEO_RIPE_NCC\]
:   [Schepers, M.]{.refAuthor}, [\"RIPE NCC Meeting Geolocation
    Data\"]{.refTitle}, \<<https://meetings.ripe.net/geo/google.csv>\>.
:   

\[IPADDR_PY\]
:   [Shields, M.]{.refAuthor}[ and P. Moody]{.refAuthor}, [\"Google\'s
    Python IP address manipulation library\"]{.refTitle}, ,
    \<[http://code.google.com/p/ipaddr-py/](https://code.google.com/p/ipaddr-py/)\>.
:   

\[ISO-GLOSSARY\]
:   [ISO]{.refAuthor}, [\"Glossary for ISO 3166\"]{.refTitle}, ,
    \<<https://www.iso.org/glossary-for-iso-3166.html>\>.
:   

\[RFC2818\]
:   [Rescorla, E.]{.refAuthor}, [\"HTTP Over TLS\"]{.refTitle}, [RFC
    2818]{.seriesInfo}, [DOI 10.17487/RFC2818]{.seriesInfo}, May 2000,
    \<<https://www.rfc-editor.org/info/rfc2818>\>.
:   

\[RFC3912\]
:   [Daigle, L.]{.refAuthor}, [\"WHOIS Protocol
    Specification\"]{.refTitle}, [RFC 3912]{.seriesInfo}, [DOI
    10.17487/RFC3912]{.seriesInfo}, September 2004,
    \<<https://www.rfc-editor.org/info/rfc3912>\>.
:   

\[RFC5139\]
:   [Thomson, M.]{.refAuthor}[ and J. Winterbottom]{.refAuthor},
    [\"Revised Civic Location Format for Presence Information Data
    Format Location Object (PIDF-LO)\"]{.refTitle}, [RFC
    5139]{.seriesInfo}, [DOI 10.17487/RFC5139]{.seriesInfo}, February
    2008, \<<https://www.rfc-editor.org/info/rfc5139>\>.
:   

\[RFC6772\]
:   [Schulzrinne, H., Ed.]{.refAuthor}[, Tschofenig, H.,
    Ed.]{.refAuthor}[, Cuellar, J.]{.refAuthor}[,
    Polk, J.]{.refAuthor}[, Morris, J.]{.refAuthor}[, and M.
    Thomson]{.refAuthor}, [\"Geolocation Policy: A Document Format for
    Expressing Privacy Preferences for Location
    Information\"]{.refTitle}, [RFC 6772]{.seriesInfo}, [DOI
    10.17487/RFC6772]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6772>\>.
:   

\[RFC7208\]
:   [Kitterman, S.]{.refAuthor}, [\"Sender Policy Framework (SPF) for
    Authorizing Use of Domains in Email, Version 1\"]{.refTitle}, [RFC
    7208]{.seriesInfo}, [DOI 10.17487/RFC7208]{.seriesInfo}, April 2014,
    \<<https://www.rfc-editor.org/info/rfc7208>\>.
:   

\[RFC8259\]
:   [Bray, T., Ed.]{.refAuthor}, [\"The JavaScript Object Notation
    (JSON) Data Interchange Format\"]{.refTitle}, [STD 90]{.seriesInfo},
    [RFC 8259]{.seriesInfo}, [DOI 10.17487/RFC8259]{.seriesInfo},
    December 2017, \<<https://www.rfc-editor.org/info/rfc8259>\>.
:   
:::
:::

::: {#section-appendix.a .section}
## [Appendix A.](#section-appendix.a){.section-number .selfRef} [Sample Python Validation Code](#name-sample-python-validation-co){.section-name .selfRef} {#name-sample-python-validation-co}

Included here is a simple format validator in Python for self-published
ipgeo feeds. This tool reads CSV data in the self-published ipgeo feed
format from the standard input and performs basic validation. It is
intended for use by feed publishers before launching a feed. Note that
this validator does not verify the uniqueness of every IP prefix entry
within the feed as a whole but only verifies the syntax of each single
line from within the feed. A complete validator [MUST]{.bcp14} also
ensure IP prefix uniqueness.[¶](#section-appendix.a-1){.pilcrow}

The main source file \"ipgeo_feed_validator.py\" follows. It requires
use of the open source ipaddr Python library for IP address and CIDR
parsing and validation
\[[IPADDR_PY](#IPADDR_PY){.xref}\].[¶](#section-appendix.a-2){.pilcrow}

::: {#section-appendix.a-3}
``` {.sourcecode .lang-python}
<CODE BEGINS>
#!/usr/bin/python
#
# Copyright (c) 2012 IETF Trust and the persons identified as
# authors of the code.  All rights reserved.  Redistribution and use
# in source and binary forms, with or without modification, is
# permitted pursuant to, and subject to the license terms contained
# in, the Simplified BSD License set forth in Section 4.c of the
# IETF Trust's Legal Provisions Relating to IETF
# Documents (http://trustee.ietf.org/license-info).

"""Simple format validator for self-published ipgeo feeds.

This tool reads CSV data in the self-published ipgeo feed format
from the standard input and performs basic validation.  It is
intended for use by feed publishers before launching a feed.
"""

import csv
import ipaddr
import re
import sys


class IPGeoFeedValidator(object):
  def __init__(self):
    self.prefixes = {}
    self.line_number = 0
    self.output_log = {}
    self.SetOutputStream(sys.stderr)

  def Validate(self, feed):
    """Check validity of an IPGeo feed.

    Args:
      feed: iterable with feed lines
    """

    for line in feed:
      self._ValidateLine(line)

  def SetOutputStream(self, logfile):
    """Controls where the output messages go do (STDERR by default).

    Use None to disable logging.

    Args:
      logfile: a file object (e.g., sys.stdout) or None.
    """
    self.output_stream = logfile

  def CountErrors(self, severity):
    """How many ERRORs or WARNINGs were generated."""
    return len(self.output_log.get(severity, []))

  ############################################################
  def _ValidateLine(self, line):
    line = line.rstrip('\r\n')
    self.line_number += 1
    self.line = line.split('#')[0]
    self.is_correct_line = True

    if self._ShouldIgnoreLine(line):
      return

    fields = [field for field in csv.reader([line])][0]

    self._ValidateFields(fields)
    self._FlushOutputStream()

  def _ShouldIgnoreLine(self, line):
    line = line.strip()
    if line.startswith('#'):
      return True
    return len(line) == 0

  ############################################################
  def _ValidateFields(self, fields):
    assert(len(fields) > 0)

    is_correct = self._IsIPAddressOrPrefixCorrect(fields[0])

    if len(fields) > 1:
      if not self._IsAlpha2CodeCorrect(fields[1]):
        is_correct = False

    if len(fields) > 2 and not self._IsRegionCodeCorrect(fields[2]):
      is_correct = False

    if len(fields) != 5:
      self._ReportWarning('5 fields were expected (got %d).'
                          % len(fields))

  ############################################################
  def _IsIPAddressOrPrefixCorrect(self, field):
    if '/' in field:
      return self._IsCIDRCorrect(field)
    return self._IsIPAddressCorrect(field)

  def _IsCIDRCorrect(self, cidr):
    try:
      ipprefix = ipaddr.IPNetwork(cidr)
      if ipprefix.network._ip != ipprefix._ip:
        self._ReportError('Incorrect IP Network.')
        return False
      if ipprefix.is_private:
        self._ReportError('IP Address must not be private.')
        return False
    except:
      self._ReportError('Incorrect IP Network.')
      return False
    return True

  def _IsIPAddressCorrect(self, ipaddress):
    try:
      ip = ipaddr.IPAddress(ipaddress)
    except:
      self._ReportError('Incorrect IP Address.')
      return False
    if ip.is_private:
      self._ReportError('IP Address must not be private.')
      return False
    return True

  ############################################################
  def _IsAlpha2CodeCorrect(self, alpha2code):
    if len(alpha2code) == 0:
      return True
    if len(alpha2code) != 2 or not alpha2code.isalpha():
      self._ReportError(
          'Alpha 2 code must be in the ISO 3166-1 alpha 2 format.')
      return False
    return True

  def _IsRegionCodeCorrect(self, region_code):
    if len(region_code) == 0:
      return True
    if '-' not in region_code:
      self._ReportError('Region code must be in ISO 3166-2 format.')
      return False

    parts = region_code.split('-')
    if not self._IsAlpha2CodeCorrect(parts[0]):
      return False
    return True

  ############################################################
  def _ReportError(self, message):
    self._ReportWithSeverity('ERROR', message)

  def _ReportWarning(self, message):
    self._ReportWithSeverity('WARNING', message)

  def _ReportWithSeverity(self, severity, message):
    self.is_correct_line = False
    output_line = '%s: %s\n' % (severity, message)

    if severity not in self.output_log:
      self.output_log[severity] = []
    self.output_log[severity].append(output_line)

    if self.output_stream is not None:
      self.output_stream.write(output_line)

  def _FlushOutputStream(self):
    if self.is_correct_line: return
    if self.output_stream is None: return

    self.output_stream.write('line %d: %s\n\n'
                             % (self.line_number, self.line))


############################################################
def main():
   feed_validator = IPGeoFeedValidator()
   feed_validator.Validate(sys.stdin)

   if feed_validator.CountErrors('ERROR'):
     sys.exit(1)

if __name__ == '__main__':
  main()

<CODE ENDS>
```

[¶](#section-appendix.a-3){.pilcrow}
:::

A unit test file, \"ipgeo_feed_validator_test.py\" is provided as well.
It provides basic test coverage of the code above, though does not test
correct handling of non-ASCII UTF-8
strings.[¶](#section-appendix.a-4){.pilcrow}

::: {#section-appendix.a-5}
``` {.sourcecode .lang-python}
<CODE BEGINS>
#!/usr/bin/python
#
# Copyright (c) 2012 IETF Trust and the persons identified as
# authors of the code.  All rights reserved.  Redistribution and use
# in source and binary forms, with or without modification, is
# permitted pursuant to, and subject to the license terms contained
# in, the Simplified BSD License set forth in Section 4.c of the
# IETF Trust's Legal Provisions Relating to IETF
# Documents (http://trustee.ietf.org/license-info).

import sys
from ipgeo_feed_validator import IPGeoFeedValidator

class IPGeoFeedValidatorTest(object):
  def __init__(self):
    self.validator = IPGeoFeedValidator()
    self.validator.SetOutputStream(None)
    self.successes = 0
    self.failures = 0

  def Run(self):
    self.TestFeedLine('# asdf', 0, 0)
    self.TestFeedLine('   ', 0, 0)
    self.TestFeedLine('', 0, 0)

    self.TestFeedLine('asdf', 1, 1)
    self.TestFeedLine('asdf,US,,,', 1, 0)
    self.TestFeedLine('aaaa::,US,,,', 0, 0)
    self.TestFeedLine('zzzz::,US', 1, 1)
    self.TestFeedLine(',US,,,', 1, 0)
    self.TestFeedLine('55.66.77', 1, 1)
    self.TestFeedLine('55.66.77.888', 1, 1)
    self.TestFeedLine('55.66.77.asdf', 1, 1)

    self.TestFeedLine('2001:db8:cafe::/48,PL,PL-MZ,,02-784', 0, 0)
    self.TestFeedLine('2001:db8:cafe::/48', 0, 1)

    self.TestFeedLine('55.66.77.88,PL', 0, 1)
    self.TestFeedLine('55.66.77.88,PL,,,', 0, 0)
    self.TestFeedLine('55.66.77.88,,,,', 0, 0)
    self.TestFeedLine('55.66.77.88,ZZ,,,', 0, 0)
    self.TestFeedLine('55.66.77.88,US,,,', 0, 0)
    self.TestFeedLine('55.66.77.88,USA,,,', 1, 0)
    self.TestFeedLine('55.66.77.88,99,,,', 1, 0)

    self.TestFeedLine('55.66.77.88,US,US-CA,,', 0, 0)
    self.TestFeedLine('55.66.77.88,US,USA-CA,,', 1, 0)
    self.TestFeedLine('55.66.77.88,USA,USA-CA,,', 2, 0)

    self.TestFeedLine('55.66.77.88,US,US-CA,Mountain View,', 0, 0)
    self.TestFeedLine('55.66.77.88,US,US-CA,Mountain View,94043',
                      0, 0)
    self.TestFeedLine('55.66.77.88,US,US-CA,Mountain View,94043,'
                      '1600 Ampthitheatre Parkway', 0, 1)

    self.TestFeedLine('55.66.77.0/24,US,,,', 0, 0)
    self.TestFeedLine('55.66.77.88/24,US,,,', 1, 0)
    self.TestFeedLine('55.66.77.88/32,US,,,', 0, 0)
    self.TestFeedLine('55.66.77/24,US,,,', 1, 0)
    self.TestFeedLine('55.66.77.0/35,US,,,', 1, 0)

    self.TestFeedLine('172.15.30.1,US,,,', 0, 0)
    self.TestFeedLine('172.28.30.1,US,,,', 1, 0)
    self.TestFeedLine('192.167.100.1,US,,,', 0, 0)
    self.TestFeedLine('192.168.100.1,US,,,', 1, 0)
    self.TestFeedLine('10.0.5.9,US,,,', 1, 0)
    self.TestFeedLine('10.0.5.0/24,US,,,', 1, 0)
    self.TestFeedLine('fc00::/48,PL,,,', 1, 0)
    self.TestFeedLine('fe00::/48,PL,,,', 0, 0)

    print ('%d tests passed, %d failed'
      % (self.successes, self.failures))

  def IsOutputLogCorrectAtSeverity(self, severity,
    expected_msg_count):
    msg_count = self.validator.CountErrors(severity)

    if msg_count != expected_msg_count:
      print ('TEST FAILED: %s\nexpected %d %s[s], observed %d\n%s\n'
         % (self.validator.line, expected_msg_count, severity,
           msg_count,
          str(self.validator.output_log[severity])))
      return False
    return True

  def IsOutputLogCorrect(self, new_errors, new_warnings):
    retval = True

    if not self.IsOutputLogCorrectAtSeverity('ERROR', new_errors):
      retval = False
    if not self.IsOutputLogCorrectAtSeverity('WARNING',
                                             new_warnings):
      retval = False

    return retval

  def TestFeedLine(self, line, warning_count, error_count):
    self.validator.output_log['WARNING'] = []
    self.validator.output_log['ERROR'] = []
    self.validator._ValidateLine(line)

    if not self.IsOutputLogCorrect(warning_count, error_count):
      self.failures += 1
      return False

    self.successes += 1
    return True


if __name__ == '__main__':
  IPGeoFeedValidatorTest().Run()

<CODE ENDS>
```

[¶](#section-appendix.a-5){.pilcrow}
:::
:::

::: {#section-appendix.b .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The authors would like to express their gratitude to reviewers and early
implementors, including but not limited to [Mikael
Abrahamsson]{.contact-name}, [Andrew Alston]{.contact-name}, [Ray
Bellis]{.contact-name}, [John Bond]{.contact-name}, [Alissa
Cooper]{.contact-name}, [Andras Erdei]{.contact-name}, [Stephen
Farrell]{.contact-name}, [Marco Hogewoning]{.contact-name}, [Mike
Joseph]{.contact-name}, [Maciej Kuzniar]{.contact-name}, [George
Michaelson]{.contact-name}, [Menno Schepers]{.contact-name}, [Justyna
Sidorska]{.contact-name}, [Pim van Pelt]{.contact-name}, and [Bjoern A.
Zeeb]{.contact-name}.[¶](#section-appendix.b-1){.pilcrow}

In particular, [Richard L. Barnes]{.contact-name} and [Andy
Newton]{.contact-name} contributed substantial review, text, and
advice.[¶](#section-appendix.b-2){.pilcrow}
:::

::: {#authors-addresses}
::: {#section-appendix.c .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Erik Kline]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Loon LLC]{.org}
:::

::: {.left dir="auto"}
[1600 Amphitheatre Parkway]{.street-address}
:::

::: {.left dir="auto"}
[Mountain View]{.locality}, [CA]{.region} [94043]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <ek@loon.com>
:::

::: {.left dir="auto"}
[Krzysztof Duleba]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google]{.org}
:::

::: {.left dir="auto"}
[1600 Amphitheatre Parkway]{.street-address}
:::

::: {.left dir="auto"}
[Mountain View]{.locality}, [CA]{.region} [94043]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <kduleba@google.com>
:::

::: {.left dir="auto"}
[Zoltan Szamonek]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google Switzerland GmbH]{.org}
:::

::: {.left dir="auto"}
[Brandschenkestrasse 110]{.street-address}
:::

::: {.left dir="auto"}
CH-[8002]{.postal-code} [Zürich]{.locality}
:::

::: {.left dir="auto"}
[Switzerland]{.country-name}
:::

::: email
Email: <zszami@google.com>
:::

::: {.left dir="auto"}
[Stefan Moser]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google Switzerland GmbH]{.org}
:::

::: {.left dir="auto"}
[Brandschenkestrasse 110]{.street-address}
:::

::: {.left dir="auto"}
CH-[8002]{.postal-code} [Zürich]{.locality}
:::

::: {.left dir="auto"}
[Switzerland]{.country-name}
:::

::: email
Email: <smoser@google.com>
:::

::: {.left dir="auto"}
[Warren Kumari]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google]{.org}
:::

::: {.left dir="auto"}
[1600 Amphitheatre Parkway]{.street-address}
:::

::: {.left dir="auto"}
[Mountain View]{.locality}, [CA]{.region} [94043]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <warren@kumari.net>
:::
:::
:::
