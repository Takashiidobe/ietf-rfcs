  RFC 8950            Advertising IPv4 Reachability with IPv6   November 2020
  ------------------- ----------------------------------------- ---------------
  Litkowski, et al.   Standards Track                           \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8950](https://www.rfc-editor.org/rfc/rfc8950){.eref}

Obsoletes:
:   [5549](https://www.rfc-editor.org/rfc/rfc5549){.eref}

Category:
:   Standards Track

Published:
:   November 2020

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    S. Litkowski
    :::

    ::: org
    Cisco
    :::
    :::

    ::: author
    ::: author-name
    S. Agrawal
    :::

    ::: org
    Cisco
    :::
    :::

    ::: author
    ::: author-name
    K. Ananthamurthy
    :::

    ::: org
    Cisco
    :::
    :::

    ::: author
    ::: author-name
    K. Patel
    :::

    ::: org
    Arrcus
    :::
    :::
:::

# RFC 8950 {#rfcnum}

# Advertising IPv4 Network Layer Reachability Information (NLRI) with an IPv6 Next Hop {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

Multiprotocol BGP (MP-BGP) specifies that the set of usable next-hop
address families is determined by the Address Family Identifier (AFI)
and the Subsequent Address Family Identifier (SAFI). The AFI/SAFI
definitions for the IPv4 address family only have provisions for
advertising a next-hop address that belongs to the IPv4 protocol when
advertising IPv4 Network Layer Reachability Information (NLRI) or
VPN-IPv4 NLRI.[¶](#section-abstract-1){.pilcrow}

This document specifies the extensions necessary to allow the
advertising of IPv4 NLRI or VPN-IPv4 NLRI with a next-hop address that
belongs to the IPv6 protocol. This comprises an extension of the
AFI/SAFI definitions to allow the address of the next hop for IPv4 NLRI
or VPN-IPv4 NLRI to also belong to the IPv6 protocol, the encoding of
the next hop to determine which of the protocols the address actually
belongs to, and a BGP Capability allowing MP-BGP peers to dynamically
discover whether they can exchange IPv4 NLRI and VPN-IPv4 NLRI with an
IPv6 next hop. This document obsoletes RFC
5549.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8950>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2020 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Requirements
        Language](#name-requirements-language){.xref}[¶](#section-toc.1-1.1.2.1.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Changes Compared to RFC
    5549](#name-changes-compared-to-rfc-554){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Extension of AFI/SAFI Definitions for the
    IPv4 Address
    Family](#name-extension-of-afi-safi-defin){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Use of BGP Capability
    Advertisement](#name-use-of-bgp-capability-adver){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Operations](#name-operations){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Usage
    Examples](#name-usage-examples){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.xref}.  [IPv4 over IPv6
        Core](#name-ipv4-over-ipv6-core){.xref}[¶](#section-toc.1-1.6.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.6.2.2}
        [6.2](#section-6.2){.xref}.  [IPv4 VPN Unicast over IPv6
        Core](#name-ipv4-vpn-unicast-over-ipv6-){.xref}[¶](#section-toc.1-1.6.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.6.2.3}
        [6.3](#section-6.3){.xref}.  [IPv4 VPN Multicast over IPv6
        Core](#name-ipv4-vpn-multicast-over-ipv){.xref}[¶](#section-toc.1-1.6.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [References](#name-references){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.9.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.9.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [](#section-appendix.a){.xref}[Acknowledgments](#name-acknowledgments){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.11}
    [](#section-appendix.b){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}
    :::
:::
:::

::: {#intro}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

Multiprotocol BGP (MP-BGP) \[[RFC4760](#RFC4760){.xref}\] specifies that
the set of network-layer protocols to which the address carried in the
Next Hop Address field may belong is determined by the Address Family
Identifier (AFI) and the Subsequent Address Family Identifier (SAFI). A
number of existing AFIs/SAFIs allow the next-hop address to belong to a
different address family than the Network Layer Reachability Information
(NLRI). For example, the AFI/SAFI \<25/65> used (as per
\[[RFC6074](#RFC6074){.xref}\]) to perform Layer 2 Virtual Private
Network (L2VPN) auto-discovery allows advertising NLRI that contains the
identifier of a Virtual Private LAN Service (VPLS) instance or that
identifies a particular pool of attachment circuits at a given Provider
Edge (PE), while the Next Hop Address field contains the loopback
address of a PE. Similarly, the AFI/SAFI \<1/132> (defined in
\[[RFC4684](#RFC4684){.xref}\]) to advertise Route Target (RT)
membership information allows advertising NLRI that contains such RT
membership information, while the Next Hop Address field contains the
address of the advertising router.[¶](#section-1-1){.pilcrow}

Furthermore, a number of these existing AFIs/SAFIs allow the next hop to
belong to either the IPv4 protocol or the IPv6 protocol and specify the
encoding of the next-hop information to determine which of the protocols
the address actually belongs to. For example,
\[[RFC4684](#RFC4684){.xref}\] allows the next-hop address to be either
an IPv4 or IPv6 address and states that the Next Hop Address field shall
be interpreted as an IPv4 address whenever the length of the next-hop
address is 4 octets and as an IPv6 address whenever the length of the
next-hop address is 16 octets.[¶](#section-1-2){.pilcrow}

There are situations such as those described in
\[[RFC4925](#RFC4925){.xref}\] and \[[RFC5565](#RFC5565){.xref}\] where
carriers (or large enterprise networks acting as a carrier for their
internal resources) may be required to establish connectivity between
\'islands\' of networks of one address family type across a transit core
of a differing address family type. This includes both the case of IPv6
islands across an IPv4 core and the case of IPv4 islands across an IPv6
core. Where Multiprotocol BGP (MP-BGP) is used to advertise the
corresponding reachability information, this translates into the
requirement for a BGP speaker to advertise the NLRI of a given address
family via a next hop of a different address family (i.e., IPv6 NLRI
with an IPv4 next hop and IPv4 NLRI with an IPv6 next
hop).[¶](#section-1-3){.pilcrow}

The AFI/SAFI definitions for the IPv6 address family assume that the
next-hop address belongs to the IPv6 address family type. Specifically,
as per \[[RFC2545](#RFC2545){.xref}\] and
\[[RFC8277](#RFC8277){.xref}\], when the \<AFI/SAFI> is \<2/1>, \<2/2>,
or \<2/4>, the next-hop address is assumed to be of an IPv6 type. As per
\[[RFC4659](#RFC4659){.xref}\], when the \<AFI/SAFI> is \<2/128>, the
next-hop address is assumed to be of a VPN-IPv6
type.[¶](#section-1-4){.pilcrow}

However, \[[RFC4798](#RFC4798){.xref}\] and
\[[RFC4659](#RFC4659){.xref}\] specify how an IPv4 address can be
encoded inside the next-hop IPv6 address field when IPv6 NLRI needs to
be advertised with an IPv4 next hop. \[[RFC4798](#RFC4798){.xref}\]
defines how the IPv4-mapped IPv6 address format specified in the IPv6
addressing architecture (\[[RFC4291](#RFC4291){.xref}\]) can be used for
that purpose when the \<AFI/SAFI> is \<2/1>, \<2/2>, or \<2/4>.
\[[RFC4659](#RFC4659){.xref}\] defines how the IPv4-mapped IPv6 address
format as well as a null Route Distinguisher (RD) can be used for that
purpose when the \<AFI/SAFI> is \<2/128>. Thus, there are existing
solutions for the advertisement of IPv6 NLRI with an IPv4 next
hop.[¶](#section-1-5){.pilcrow}

Similarly, the AFI/SAFI definitions for the advertisement of IPv4 NLRI
or VPN-IPv4 NLRI assume that the next-hop address belongs to the IPv4
address family type. Specifically, as per \[[RFC4760](#RFC4760){.xref}\]
and \[[RFC8277](#RFC8277){.xref}\], when the \<AFI/SAFI> is \<1/1>,
\<1/2>, or \<1/4>, the next-hop address is assumed to be of an IPv4
type. As per \[[RFC4364](#RFC4364){.xref}\], when the \<AFI/SAFI> is
\<1/128>, the next-hop address is assumed to be of a VPN-IPv4 type. As
per \[[RFC6513](#RFC6513){.xref}\] and \[[RFC6514](#RFC6514){.xref}\],
when the \<AFI/SAFI> is \<1/129>, the next-hop address is assumed to be
of a VPN-IPv4 type. There is clearly no generally applicable method for
encoding an IPv6 address inside the IPv4 address field of the next hop.
Hence, there is currently no specified solution for advertising IPv4 or
VPN-IPv4 NLRI with an IPv6 next hop.[¶](#section-1-6){.pilcrow}

This document specifies the extensions necessary to allow advertisement
of IPv4 NLRI or VPN-IPv4 NLRI with a next-hop address that belongs to
the IPv6 protocol. This comprises an extension of the AFI/SAFI
definitions to allow the address of the next hop for IPv4 NLRI or
VPN-IPv4 NLRI to belong to either the IPv4 or the IPv6 protocol, the
encoding of the next-hop information to determine which of the protocols
the address actually belongs to, and a BGP Capability allowing MP-BGP
peers to dynamically discover whether they can exchange IPv4 NLRI and
VPN-IPv4 NLRI with an IPv6 next hop. The BGP Capability allows gradual
deployment of the functionality of advertising IPv4 reachability via an
IPv6 next hop without any flag day nor any risk of traffic
black-holing.[¶](#section-1-7){.pilcrow}

This document obsoletes
\[[RFC5549](#RFC5549){.xref}\].[¶](#section-1-8){.pilcrow}

::: {#requirements}
::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-1.1-1){.pilcrow}
:::
:::
:::
:::

::: {#diff}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Changes Compared to RFC 5549](#name-changes-compared-to-rfc-554){.section-name .selfRef} {#name-changes-compared-to-rfc-554}

This document introduces two significant changes compared to
\[[RFC5549](#RFC5549){.xref}\]:[¶](#section-2-1){.pilcrow}

-   [In \[[RFC5549](#RFC5549){.xref}\], when AFI/SAFI \<1/128> is used,
    the next-hop address is encoded as an IPv6 address with a length of
    16 or 32 bytes. To accommodate all existing implementations and
    bring consistency with VPNv4oIPv4 and VPNv6oIPv6, this document
    modifies how the next-hop address is encoded. The next-hop address
    is now encoded as a VPN-IPv6 address with a length of 24 or 48 bytes
    (see Sections [3](#extension){.xref} and
    [6.2](#example-vpnv4unoipv6){.xref}). This change addresses Erratum
    ID 5253 (\[[Err5253](#Err5253){.xref}\]). As all known and deployed
    implementations are interoperable today and use the new proposed
    encoding, the change does not break existing
    interoperability.[¶](#section-2-2.1){.pilcrow}]{#section-2-2.1}
-   [This document allows AFI/SAFI \<1/129> (IPv4 multicast) to use an
    IPv6 underlay using similar encoding and procedures to AFI/SAFI
    \<1/128> (see Sections [3](#extension){.xref} and
    [6.3](#example-vpnv4multoipv6){.xref}).[¶](#section-2-2.2){.pilcrow}]{#section-2-2.2}
:::
:::

::: {#extension}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Extension of AFI/SAFI Definitions for the IPv4 Address Family](#name-extension-of-afi-safi-defin){.section-name .selfRef} {#name-extension-of-afi-safi-defin}

As mentioned earlier, MP-BGP specifies that the set of usable next-hop
address families is determined by the AFI and the SAFI. The following
AFI/SAFI definitions for the IPv4 NLRI or VPN-IPv4 NLRI (\<1/1>, \<1/2>,
\<1/4>, \<1/128>, and \<1/129>) only have provisions for advertising a
next-hop address that belongs to the IPv4 protocol. This document
extends the set of usable next-hop address families to include IPv6 in
addition to IPv4 when advertising an IPv4 or VPN-IPv4
NLRI.[¶](#section-3-1){.pilcrow}

Specifically, this document allows advertising the MP_REACH_NLRI
attribute \[[RFC4760](#RFC4760){.xref}\] with this
content:[¶](#section-3-2){.pilcrow}

-   [AFI = 1[¶](#section-3-3.1){.pilcrow}]{#section-3-3.1}
-   [SAFI = 1, 2, or 4[¶](#section-3-3.2){.pilcrow}]{#section-3-3.2}
-   [Length of Next Hop Address = 16 or
    32[¶](#section-3-3.3){.pilcrow}]{#section-3-3.3}
-   [Next Hop Address = IPv6 address of a next hop (potentially followed
    by the link-local IPv6 address of the next hop). This field is to be
    constructed as per [Section
    3](https://www.rfc-editor.org/rfc/rfc2545#section-3){.relref} of
    \[[RFC2545](#RFC2545){.xref}\].[¶](#section-3-3.4){.pilcrow}]{#section-3-3.4}
-   [NLRI = NLRI as per the AFI/SAFI
    definition[¶](#section-3-3.5){.pilcrow}]{#section-3-3.5}

It also allows advertising the MP_REACH_NLRI attribute
\[[RFC4760](#RFC4760){.xref}\] with this
content:[¶](#section-3-4){.pilcrow}

-   [AFI = 1[¶](#section-3-5.1){.pilcrow}]{#section-3-5.1}
-   [SAFI = 128 or 129[¶](#section-3-5.2){.pilcrow}]{#section-3-5.2}
-   [Length of Next Hop Address = 24 or
    48[¶](#section-3-5.3){.pilcrow}]{#section-3-5.3}
-   [Next Hop Address = VPN-IPv6 address of a next hop with an 8-octet
    RD set to zero (potentially followed by the link-local VPN-IPv6
    address of the next hop with an 8-octet RD set to
    zero).[¶](#section-3-5.4){.pilcrow}]{#section-3-5.4}
-   [NLRI = NLRI as per the AFI/SAFI
    definition[¶](#section-3-5.5){.pilcrow}]{#section-3-5.5}

This is in addition to the existing mode of operation allowing
advertisement of NLRI for \<AFI/SAFI> of \<1/1>, \<1/2>, and \<1/4> with
a next-hop address of an IPv4 type and advertisement of NLRI for an
\<AFI/SAFI> of \<1/128> and \<1/129> with a next-hop address of a
VPN-IPv4 type.[¶](#section-3-6){.pilcrow}

The BGP speaker receiving the advertisement [MUST]{.bcp14} use the
Length of Next Hop Address field to determine which network-layer
protocol the next-hop address belongs to.[¶](#section-3-7){.pilcrow}

-   [When the AFI/SAFI is \<1/1>, \<1/2>, or \<1/4> and when the Length
    of Next Hop Address field is equal to 16 or 32, the next-hop address
    is of type IPv6.[¶](#section-3-8.1){.pilcrow}]{#section-3-8.1}
-   [When the AFI/SAFI is \<1/128> or \<1/129> and when the Length of
    Next Hop Address field is equal to 24 or 48, the next-hop address is
    of type VPN-IPv6.[¶](#section-3-8.2){.pilcrow}]{#section-3-8.2}

Note that this method of using the Length of Next Hop Address field to
determine which network-layer protocol the next-hop address belongs to
(out of the set of protocols allowed by the AFI/SAFI definition) is the
same as that used in \[[RFC4684](#RFC4684){.xref}\] and
\[[RFC6074](#RFC6074){.xref}\].[¶](#section-3-9){.pilcrow}
:::
:::

::: {#bgp-cap}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Use of BGP Capability Advertisement](#name-use-of-bgp-capability-adver){.section-name .selfRef} {#name-use-of-bgp-capability-adver}

\[[RFC5492](#RFC5492){.xref}\] defines a mechanism to allow two BGP
speakers to discover if a particular capability is supported by their
BGP peer and, thus, whether it can be used with that peer. This document
defines a capability that can be advertised using
\[[RFC5492](#RFC5492){.xref}\], referred to as the \"Extended Next Hop
Encoding capability\". This capability allows BGP speakers to discover
whether, for a given NLRI \<AFI/SAFI>, a peer supports advertisement
with a next hop whose network protocol is determined by the value of the
Length of Next Hop Address field, as specified in [Section
3](#extension){.xref}.[¶](#section-4-1){.pilcrow}

A BGP speaker that wishes to advertise an IPv6 next hop for IPv4 NLRI or
for VPN-IPv4 NLRI to a BGP peer as per this specification [MUST]{.bcp14}
use the Capability Advertisement procedures defined in
\[[RFC5492](#RFC5492){.xref}\] with the Extended Next Hop Encoding
capability to determine whether its peer supports this for the NLRI
AFI/SAFI pair(s) of interest. The fields in the Capabilities Optional
Parameter [MUST]{.bcp14} be set as follows:[¶](#section-4-2){.pilcrow}

-   [The Capability Code field [MUST]{.bcp14} be set to 5 (which
    indicates the Extended Next Hop Encoding
    capability).[¶](#section-4-3.1){.pilcrow}]{#section-4-3.1}

-   [The Capability Length field is set to a variable value that is the
    length of the Capability Value field (which
    follows).[¶](#section-4-3.2){.pilcrow}]{#section-4-3.2}

-   ::: {#section-4-3.3}
    The Capability Value field has the following
    format:[¶](#section-4-3.3.1){.pilcrow}

    ::: {#section-4-3.3.2 .artwork .art-text .alignLeft}

                 +-----------------------------------------------------+
                 | NLRI AFI - 1 (2 octets)                             |
                 +-----------------------------------------------------+
                 | NLRI SAFI - 1 (2 octets)                            |
                 +-----------------------------------------------------+
                 | Nexthop AFI - 1 (2 octets)                          |
                 +-----------------------------------------------------+
                 | .....                                               |
                 +-----------------------------------------------------+
                 | NLRI AFI - N (2 octets)                             |
                 +-----------------------------------------------------+
                 | NLRI SAFI - N (2 octets)                            |
                 +-----------------------------------------------------+
                 | Nexthop AFI - N (2 octets)                          |
                 +-----------------------------------------------------+

    [¶](#section-4-3.3.2){.pilcrow}
    :::

    where:[¶](#section-4-3.3.3){.pilcrow}

    -   [each triple \<NLRI AFI, NLRI SAFI, Nexthop AFI> indicates that
        the NLRI of \<NLRI AFI / NLRI SAFI> may be advertised with a
        next-hop address belonging to the network-layer protocol of
        Nexthop
        AFI.[¶](#section-4-3.3.4.1){.pilcrow}]{#section-4-3.3.4.1}
    -   [the AFI and SAFI values are defined in the \"Address Family
        Numbers\" and \"Subsequent Address Family Identifier (SAFI)
        Parameters\" registries (see \[[IANA-AFI](#IANA-AFI){.xref}\]
        and \[[IANA-SAFI](#IANA-SAFI){.xref}\],
        respectively).[¶](#section-4-3.3.4.2){.pilcrow}]{#section-4-3.3.4.2}
    :::

Since this document only concerns itself with the advertisement of IPv4
NLRI and VPN-IPv4 NLRI with an IPv6 next hop, this specification only
allows the following values in the Capability Value field of the
Extended Next Hop Encoding capability:[¶](#section-4-4){.pilcrow}

-   [NLRI AFI = 1 (IPv4)[¶](#section-4-5.1){.pilcrow}]{#section-4-5.1}
-   [NLRI SAFI = 1, 2, 4, 128, or
    129[¶](#section-4-5.2){.pilcrow}]{#section-4-5.2}
-   [Nexthop AFI = 2
    (IPv6)[¶](#section-4-5.3){.pilcrow}]{#section-4-5.3}

This document does not specify the use of the Extended Next Hop Encoding
capability with any other combinations of \<NLRI AFI, NLRI SAFI, Nexthop
AFI>. For example, the Next Hop Encoding capability specified in this
document is not intended to be used for NLRI AFIs/SAFIs whose definition
already allows use of both IPv4 and IPv6 next hops (e.g., AFI/SAFI =
\<1/132> as defined in \[[RFC4684](#RFC4684){.xref}\]). Similarly, it is
not intended that the Extended Next Hop Encoding capability be used for
NLRI AFIs/SAFIs for which there is already a solution for advertising a
next hop of a different address family (e.g., AFI/SAFI = \<2/1>, \<2/2>,
or \<2/4> with an IPv4 next hop as per \[[RFC4798](#RFC4798){.xref}\]
and AFI/SAFI = \<2/128> with an IPv4 next hop as per
\[[RFC4659](#RFC4659){.xref}\]).[¶](#section-4-6){.pilcrow}

It is expected that if new AFIs/SAFIs are defined in the future, their
definitions will have provisions (where appropriate) for both IPv4 and
IPv6 next hops from the beginning, with the determination based on the
Length of Next Hop Address field. Thus, new AFIs/SAFIs are not expected
to make use of the Extended Next Hop Encoding
capability.[¶](#section-4-7){.pilcrow}

A BGP speaker [MUST]{.bcp14} only advertise the IPv4 or VPN-IPv4 NLRI
with an IPv6 next hop to a BGP peer if the BGP speaker has first
ascertained via the BGP Capability Advertisement that the BGP peer
supports the Extended Next Hop Encoding capability for the relevant
AFI/SAFI pair.[¶](#section-4-8){.pilcrow}

The Extended Next Hop Encoding capability provides information about
next-hop encoding for a given AFI/SAFI, assuming that AFI/SAFI is
allowed. It does not influence whether that AFI/SAFI is indeed allowed.
Whether an AFI/SAFI can be used between the BGP peers is purely
determined through the Multiprotocol Extensions capability defined in
\[[RFC4760](#RFC4760){.xref}\].[¶](#section-4-9){.pilcrow}
:::
:::

::: {#operations}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Operations](#name-operations){.section-name .selfRef} {#name-operations}

By default, if a particular BGP session is running over IPvx (where IPvx
is IPv4 or IPv6) and if the BGP speaker sending an update is putting its
own address in as the next hop, then the next-hop address
[SHOULD]{.bcp14} be specified as an IPvx address, using the encoding
rules specified in the AFI/SAFI definition of the NLRI being updated.
This default behavior may be overridden by
policy.[¶](#section-5-1){.pilcrow}

When a next-hop address needs to be passed along unchanged (e.g., as a
Route Reflector (RR) would do), its encoding [MUST NOT]{.bcp14} be
changed. If a particular RR client cannot handle that encoding (as
determined by the BGP Capability Advertisement), then the NLRI in
question cannot be distributed to that client. For sound routing in
certain scenarios, this will require that all the RR clients be able to
handle whatever encodings any of them may
generate.[¶](#section-5-2){.pilcrow}
:::
:::

::: {#examples}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Usage Examples](#name-usage-examples){.section-name .selfRef} {#name-usage-examples}

::: {#example-ipv4oipv6}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [IPv4 over IPv6 Core](#name-ipv4-over-ipv6-core){.section-name .selfRef} {#name-ipv4-over-ipv6-core}

The extensions defined in this document may be used as discussed in
\[[RFC5565](#RFC5565){.xref}\] for the interconnection of IPv4 islands
over an IPv6 backbone. In this application, Address Family Border
Routers (AFBRs; as defined in \[[RFC4925](#RFC4925){.xref}\]) advertise
IPv4 NLRI in the MP_REACH_NLRI along with an IPv6 next
hop.[¶](#section-6.1-1){.pilcrow}

The MP_REACH_NLRI is encoded with:[¶](#section-6.1-2){.pilcrow}

-   [AFI = 1[¶](#section-6.1-3.1){.pilcrow}]{#section-6.1-3.1}
-   [SAFI = 1[¶](#section-6.1-3.2){.pilcrow}]{#section-6.1-3.2}
-   [Length of Next Hop Address field = 16 (or
    32)[¶](#section-6.1-3.3){.pilcrow}]{#section-6.1-3.3}
-   [Next Hop Address = IPv6 address of the next
    hop[¶](#section-6.1-3.4){.pilcrow}]{#section-6.1-3.4}
-   [NLRI = IPv4
    routes[¶](#section-6.1-3.5){.pilcrow}]{#section-6.1-3.5}

During BGP Capability Advertisement, the PE routers would include the
following fields in the Capabilities Optional
Parameter:[¶](#section-6.1-4){.pilcrow}

-   [Capability Code set to \"Extended Next Hop
    Encoding\"[¶](#section-6.1-5.1){.pilcrow}]{#section-6.1-5.1}
-   [Capability Value containing \<NLRI AFI=1, NLRI SAFI=1, Nexthop
    AFI=2>[¶](#section-6.1-5.2){.pilcrow}]{#section-6.1-5.2}
:::
:::

::: {#example-vpnv4unoipv6}
::: {#section-6.2 .section}
### [6.2.](#section-6.2){.section-number .selfRef} [IPv4 VPN Unicast over IPv6 Core](#name-ipv4-vpn-unicast-over-ipv6-){.section-name .selfRef} {#name-ipv4-vpn-unicast-over-ipv6-}

The extensions defined in this document may be used for support of IPv4
VPNs over an IPv6 backbone. In this application, PE routers would
advertise VPN-IPv4 NLRI in the MP_REACH_NLRI along with an IPv6 next
hop.[¶](#section-6.2-1){.pilcrow}

The MP_REACH_NLRI is encoded with:[¶](#section-6.2-2){.pilcrow}

-   [AFI = 1[¶](#section-6.2-3.1){.pilcrow}]{#section-6.2-3.1}
-   [SAFI = 128[¶](#section-6.2-3.2){.pilcrow}]{#section-6.2-3.2}
-   [Length of Next Hop Address field = 24 (or
    48)[¶](#section-6.2-3.3){.pilcrow}]{#section-6.2-3.3}
-   [Next Hop Address = VPN-IPv6 address of a next hop whose RD is set
    to zero[¶](#section-6.2-3.4){.pilcrow}]{#section-6.2-3.4}
-   [NLRI = IPv4-VPN
    routes[¶](#section-6.2-3.5){.pilcrow}]{#section-6.2-3.5}

During BGP Capability Advertisement, the PE routers would include the
following fields in the Capabilities Optional
Parameter:[¶](#section-6.2-4){.pilcrow}

-   [Capability Code set to \"Extended Next Hop
    Encoding\"[¶](#section-6.2-5.1){.pilcrow}]{#section-6.2-5.1}
-   [Capability Value containing \<NLRI AFI=1, NLRI SAFI=128, Nexthop
    AFI=2>[¶](#section-6.2-5.2){.pilcrow}]{#section-6.2-5.2}
:::
:::

::: {#example-vpnv4multoipv6}
::: {#section-6.3 .section}
### [6.3.](#section-6.3){.section-number .selfRef} [IPv4 VPN Multicast over IPv6 Core](#name-ipv4-vpn-multicast-over-ipv){.section-name .selfRef} {#name-ipv4-vpn-multicast-over-ipv}

The extensions defined in this document may be used for support of IPv4
multicast VPNs over an IPv6 backbone. In this application, PE routers
would advertise VPN-IPv4 NLRI in the MP_REACH_NLRI along with an IPv6
next hop.[¶](#section-6.3-1){.pilcrow}

The MP_REACH_NLRI is encoded with:[¶](#section-6.3-2){.pilcrow}

-   [AFI = 1[¶](#section-6.3-3.1){.pilcrow}]{#section-6.3-3.1}
-   [SAFI = 129[¶](#section-6.3-3.2){.pilcrow}]{#section-6.3-3.2}
-   [Length of Next Hop Address field = 24 (or
    48)[¶](#section-6.3-3.3){.pilcrow}]{#section-6.3-3.3}
-   [Next Hop Address = VPN-IPv6 address of a next hop whose RD is set
    to zero[¶](#section-6.3-3.4){.pilcrow}]{#section-6.3-3.4}
-   [NLRI = IPv4-VPN
    routes[¶](#section-6.3-3.5){.pilcrow}]{#section-6.3-3.5}

During BGP Capability Advertisement, the PE routers would include the
following fields in the Capabilities Optional
Parameter:[¶](#section-6.3-4){.pilcrow}

-   [Capability Code set to \"Extended Next Hop
    Encoding\"[¶](#section-6.3-5.1){.pilcrow}]{#section-6.3-5.1}
-   [Capability Value containing \<NLRI AFI=1, NLRI SAFI=129, Nexthop
    AFI=2>[¶](#section-6.3-5.2){.pilcrow}]{#section-6.3-5.2}
:::
:::
:::
:::

::: {#IANA}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document does not define any new code points from those included in
\[[RFC5549](#RFC5549){.xref}\].[¶](#section-7-1){.pilcrow}

\[[RFC5549](#RFC5549){.xref}\] added \"Extended Next Hop Encoding\" to
the \"Capability Codes\" registry
(\[[IANA-CAP-CODE](#IANA-CAP-CODE){.xref}\]), which was created by
\[[RFC5492](#RFC5492){.xref}\]. IANA has updated the registration of
that entry to refer to this document. The value allocated for this
Capability Code is 5.[¶](#section-7-2){.pilcrow}
:::
:::

::: {#security}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

This document does not raise any additional security issues beyond those
of BGP-4 and the Multiprotocol Extensions for BGP-4. The same security
mechanisms are applicable.[¶](#section-8-1){.pilcrow}

However, as \[[RFC4272](#RFC4272){.xref}\] discusses, BGP is vulnerable
to traffic diversion attacks. The ability to advertise an IPv6 next hop
adds a new means by which an attacker could cause traffic to be diverted
from its normal path. Such an attack differs from preexisting
vulnerabilities in that traffic could be forwarded to a distant target
across an intervening network infrastructure (e.g., an IPv6 core),
allowing an attack to potentially succeed more easily since less
infrastructure would have to be subverted. Potential consequences
include \"hijacking\" of traffic or denial of
service.[¶](#section-8-2){.pilcrow}

Although not expected to be the typical case, the IPv6 address used as
the BGP next-hop address could be an IPv4-mapped IPv6 address (as
defined in \[[RFC4291](#RFC4291){.xref}\]). Configuration of the
security mechanisms potentially deployed by the network operator (such
as security checks on a next-hop address) also need to keep this case in
mind.[¶](#section-8-3){.pilcrow}
:::
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC2545\]
:   [Marques, P.]{.refAuthor}[ and F. Dupont]{.refAuthor}, [\"Use of
    BGP-4 Multiprotocol Extensions for IPv6 Inter-Domain
    Routing\"]{.refTitle}, [RFC 2545]{.seriesInfo}, [DOI
    10.17487/RFC2545]{.seriesInfo}, March 1999,
    \<<https://www.rfc-editor.org/info/rfc2545>\>.
:   

\[RFC4291\]
:   [Hinden, R.]{.refAuthor}[ and S. Deering]{.refAuthor}, [\"IP Version
    6 Addressing Architecture\"]{.refTitle}, [RFC 4291]{.seriesInfo},
    [DOI 10.17487/RFC4291]{.seriesInfo}, February 2006,
    \<<https://www.rfc-editor.org/info/rfc4291>\>.
:   

\[RFC4364\]
:   [Rosen, E.]{.refAuthor}[ and Y. Rekhter]{.refAuthor}, [\"BGP/MPLS IP
    Virtual Private Networks (VPNs)\"]{.refTitle}, [RFC
    4364]{.seriesInfo}, [DOI 10.17487/RFC4364]{.seriesInfo}, February
    2006, \<<https://www.rfc-editor.org/info/rfc4364>\>.
:   

\[RFC4760\]
:   [Bates, T.]{.refAuthor}[, Chandra, R.]{.refAuthor}[,
    Katz, D.]{.refAuthor}[, and Y. Rekhter]{.refAuthor},
    [\"Multiprotocol Extensions for BGP-4\"]{.refTitle}, [RFC
    4760]{.seriesInfo}, [DOI 10.17487/RFC4760]{.seriesInfo}, January
    2007, \<<https://www.rfc-editor.org/info/rfc4760>\>.
:   

\[RFC5492\]
:   [Scudder, J.]{.refAuthor}[ and R. Chandra]{.refAuthor},
    [\"Capabilities Advertisement with BGP-4\"]{.refTitle}, [RFC
    5492]{.seriesInfo}, [DOI 10.17487/RFC5492]{.seriesInfo}, February
    2009, \<<https://www.rfc-editor.org/info/rfc5492>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8277\]
:   [Rosen, E.]{.refAuthor}, [\"Using BGP to Bind MPLS Labels to Address
    Prefixes\"]{.refTitle}, [RFC 8277]{.seriesInfo}, [DOI
    10.17487/RFC8277]{.seriesInfo}, October 2017,
    \<<https://www.rfc-editor.org/info/rfc8277>\>.
:   
:::

::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[Err5253\]
:   [RFC Errata]{.refAuthor}, [Erratum ID 5253]{.refTitle}, [RFC
    5549]{.refContent}, \<<https://www.rfc-editor.org/errata/eid5253>\>.
:   

\[IANA-AFI\]
:   [IANA]{.refAuthor}, [\"Address Family Numbers\"]{.refTitle},
    \<<https://www.iana.org/assignments/address-family-numbers/>\>.
:   

\[IANA-CAP-CODE\]
:   [IANA]{.refAuthor}, [\"Capability Codes\"]{.refTitle},
    \<<https://www.iana.org/assignments/capability-codes/>\>.
:   

\[IANA-SAFI\]
:   [IANA]{.refAuthor}, [\"Subsequent Address Family Identifiers (SAFI)
    Parameters\"]{.refTitle},
    \<<https://www.iana.org/assignments/safi-namespace/>\>.
:   

\[RFC4272\]
:   [Murphy, S.]{.refAuthor}, [\"BGP Security Vulnerabilities
    Analysis\"]{.refTitle}, [RFC 4272]{.seriesInfo}, [DOI
    10.17487/RFC4272]{.seriesInfo}, January 2006,
    \<<https://www.rfc-editor.org/info/rfc4272>\>.
:   

\[RFC4659\]
:   [De Clercq, J.]{.refAuthor}[, Ooms, D.]{.refAuthor}[,
    Carugi, M.]{.refAuthor}[, and F. Le Faucheur]{.refAuthor},
    [\"BGP-MPLS IP Virtual Private Network (VPN) Extension for IPv6
    VPN\"]{.refTitle}, [RFC 4659]{.seriesInfo}, [DOI
    10.17487/RFC4659]{.seriesInfo}, September 2006,
    \<<https://www.rfc-editor.org/info/rfc4659>\>.
:   

\[RFC4684\]
:   [Marques, P.]{.refAuthor}[, Bonica, R.]{.refAuthor}[,
    Fang, L.]{.refAuthor}[, Martini, L.]{.refAuthor}[,
    Raszuk, R.]{.refAuthor}[, Patel, K.]{.refAuthor}[, and J.
    Guichard]{.refAuthor}, [\"Constrained Route Distribution for Border
    Gateway Protocol/MultiProtocol Label Switching (BGP/MPLS) Internet
    Protocol (IP) Virtual Private Networks (VPNs)\"]{.refTitle}, [RFC
    4684]{.seriesInfo}, [DOI 10.17487/RFC4684]{.seriesInfo}, November
    2006, \<<https://www.rfc-editor.org/info/rfc4684>\>.
:   

\[RFC4798\]
:   [De Clercq, J.]{.refAuthor}[, Ooms, D.]{.refAuthor}[,
    Prevost, S.]{.refAuthor}[, and F. Le Faucheur]{.refAuthor},
    [\"Connecting IPv6 Islands over IPv4 MPLS Using IPv6 Provider Edge
    Routers (6PE)\"]{.refTitle}, [RFC 4798]{.seriesInfo}, [DOI
    10.17487/RFC4798]{.seriesInfo}, February 2007,
    \<<https://www.rfc-editor.org/info/rfc4798>\>.
:   

\[RFC4925\]
:   [Li, X., Ed.]{.refAuthor}[, Dawkins, S., Ed.]{.refAuthor}[, Ward,
    D., Ed.]{.refAuthor}[, and A. Durand, Ed.]{.refAuthor}, [\"Softwire
    Problem Statement\"]{.refTitle}, [RFC 4925]{.seriesInfo}, [DOI
    10.17487/RFC4925]{.seriesInfo}, July 2007,
    \<<https://www.rfc-editor.org/info/rfc4925>\>.
:   

\[RFC5549\]
:   [Le Faucheur, F.]{.refAuthor}[ and E. Rosen]{.refAuthor},
    [\"Advertising IPv4 Network Layer Reachability Information with an
    IPv6 Next Hop\"]{.refTitle}, [RFC 5549]{.seriesInfo}, [DOI
    10.17487/RFC5549]{.seriesInfo}, May 2009,
    \<<https://www.rfc-editor.org/info/rfc5549>\>.
:   

\[RFC5565\]
:   [Wu, J.]{.refAuthor}[, Cui, Y.]{.refAuthor}[,
    Metz, C.]{.refAuthor}[, and E. Rosen]{.refAuthor}, [\"Softwire Mesh
    Framework\"]{.refTitle}, [RFC 5565]{.seriesInfo}, [DOI
    10.17487/RFC5565]{.seriesInfo}, June 2009,
    \<<https://www.rfc-editor.org/info/rfc5565>\>.
:   

\[RFC6074\]
:   [Rosen, E.]{.refAuthor}[, Davie, B.]{.refAuthor}[,
    Radoaca, V.]{.refAuthor}[, and W. Luo]{.refAuthor}, [\"Provisioning,
    Auto-Discovery, and Signaling in Layer 2 Virtual Private Networks
    (L2VPNs)\"]{.refTitle}, [RFC 6074]{.seriesInfo}, [DOI
    10.17487/RFC6074]{.seriesInfo}, January 2011,
    \<<https://www.rfc-editor.org/info/rfc6074>\>.
:   

\[RFC6513\]
:   [Rosen, E., Ed.]{.refAuthor}[ and R. Aggarwal, Ed.]{.refAuthor},
    [\"Multicast in MPLS/BGP IP VPNs\"]{.refTitle}, [RFC
    6513]{.seriesInfo}, [DOI 10.17487/RFC6513]{.seriesInfo}, February
    2012, \<<https://www.rfc-editor.org/info/rfc6513>\>.
:   

\[RFC6514\]
:   [Aggarwal, R.]{.refAuthor}[, Rosen, E.]{.refAuthor}[,
    Morin, T.]{.refAuthor}[, and Y. Rekhter]{.refAuthor}, [\"BGP
    Encodings and Procedures for Multicast in MPLS/BGP IP
    VPNs\"]{.refTitle}, [RFC 6514]{.seriesInfo}, [DOI
    10.17487/RFC6514]{.seriesInfo}, February 2012,
    \<<https://www.rfc-editor.org/info/rfc6514>\>.
:   
:::
:::

::: {#ack}
::: {#section-appendix.a .section}
## [Acknowledgments](#name-acknowledgments){.section-name .selfRef} {#name-acknowledgments}

The authors would like to thank [Francois Le Faucheur]{.contact-name}
and [Eric Rosen]{.contact-name} for their work on
\[[RFC5549](#RFC5549){.xref}\].[¶](#section-appendix.a-1){.pilcrow}

The authors would like to thank [Yakov Rekhter]{.contact-name}, [Pranav
Mehta]{.contact-name}, and [John Scudder]{.contact-name} for their
contributions to the approach defined in
\[[RFC5549](#RFC5549){.xref}\].[¶](#section-appendix.a-2){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#section-appendix.b .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Stephane Litkowski]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco]{.org}
:::

::: email
Email: <slitkows@cisco.com>
:::

::: {.left dir="auto"}
[Swadesh Agrawal]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco]{.org}
:::

::: email
Email: <swaagraw@cisco.com>
:::

::: {.left dir="auto"}
[Krishna Muddenahally Ananthamurthy]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco]{.org}
:::

::: email
Email: <kriswamy@cisco.com>
:::

::: {.left dir="auto"}
[Keyur Patel]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Arrcus]{.org}
:::

::: email
Email: <keyur@arrcus.com>
:::
:::
:::
