  RFC 8839                 ICE SDP Usage     January 2021
  ------------------------ ----------------- --------------
  Petit-Huguenin, et al.   Standards Track   \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8839](https://www.rfc-editor.org/rfc/rfc8839){.eref}

Obsoletes:
:   [5245](https://www.rfc-editor.org/rfc/rfc5245){.eref},
    [6336](https://www.rfc-editor.org/rfc/rfc6336){.eref}

Category:
:   Standards Track

Published:
:   January 2021

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    M. Petit-Huguenin
    :::

    ::: org
    Impedance Mismatch
    :::
    :::

    ::: author
    ::: author-name
    S. Nandakumar
    :::

    ::: org
    Cisco Systems
    :::
    :::

    ::: author
    ::: author-name
    C. Holmberg
    :::

    ::: org
    Ericsson
    :::
    :::

    ::: author
    ::: author-name
    A. Keränen
    :::

    ::: org
    Ericsson
    :::
    :::

    ::: author
    ::: author-name
    R. Shpount
    :::

    ::: org
    TurboBridge
    :::
    :::
:::

# RFC 8839 {#rfcnum}

# Session Description Protocol (SDP) Offer/Answer Procedures for Interactive Connectivity Establishment (ICE) {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document describes Session Description Protocol (SDP) Offer/Answer
procedures for carrying out Interactive Connectivity Establishment (ICE)
between the agents.[¶](#section-abstract-1){.pilcrow}

This document obsoletes RFCs 5245 and
6336.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8839>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2021 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}

This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November 10,
2008. The person(s) controlling the copyright in some of this material
may not have granted the IETF Trust the right to allow modifications of
such material outside the IETF Standards Process. Without obtaining an
adequate license from the person(s) controlling the copyright in such
materials, this document may not be modified outside the IETF Standards
Process, and derivative works of it may not be created outside the IETF
Standards Process, except to format it for publication as an RFC or to
translate it into languages other than
English.[¶](#section-boilerplate.2-3){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Conventions](#name-conventions){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Terminology](#name-terminology){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [SDP Offer/Answer
    Procedures](#name-sdp-offer-answer-procedures){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [Introduction](#name-introduction-2){.xref}[¶](#section-toc.1-1.4.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [Generic
        Procedures](#name-generic-procedures){.xref}[¶](#section-toc.1-1.4.2.2.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.2.2.1}
            [4.2.1](#section-4.2.1){.xref}.  [Encoding](#name-encoding){.xref}[¶](#section-toc.1-1.4.2.2.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.2.2.2}
            [4.2.2](#section-4.2.2){.xref}.  [RTP/RTCP
            Considerations](#name-rtp-rtcp-considerations){.xref}[¶](#section-toc.1-1.4.2.2.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.2.2.3}
            [4.2.3](#section-4.2.3){.xref}.  [Determining
            Role](#name-determining-role){.xref}[¶](#section-toc.1-1.4.2.2.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.2.2.4}
            [4.2.4](#section-4.2.4){.xref}.  [STUN
            Considerations](#name-stun-considerations){.xref}[¶](#section-toc.1-1.4.2.2.2.4.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.2.2.5}
            [4.2.5](#section-4.2.5){.xref}.  [Verifying ICE Support
            Procedures](#name-verifying-ice-support-proce){.xref}[¶](#section-toc.1-1.4.2.2.2.5.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.2.2.6}
            [4.2.6](#section-4.2.6){.xref}.  [SDP
            Example](#name-sdp-example){.xref}[¶](#section-toc.1-1.4.2.2.2.6.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [Initial Offer/Answer
        Exchange](#name-initial-offer-answer-exchan){.xref}[¶](#section-toc.1-1.4.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.3.2.1}
            [4.3.1](#section-4.3.1){.xref}.  [Sending the Initial
            Offer](#name-sending-the-initial-offer){.xref}[¶](#section-toc.1-1.4.2.3.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.3.2.2}
            [4.3.2](#section-4.3.2){.xref}.  [Sending the Initial
            Answer](#name-sending-the-initial-answer){.xref}[¶](#section-toc.1-1.4.2.3.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.3.2.3}
            [4.3.3](#section-4.3.3){.xref}.  [Receiving the Initial
            Answer](#name-receiving-the-initial-answe){.xref}[¶](#section-toc.1-1.4.2.3.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.3.2.4}
            [4.3.4](#section-4.3.4){.xref}.  [Concluding
            ICE](#name-concluding-ice){.xref}[¶](#section-toc.1-1.4.2.3.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.xref}.  [Subsequent Offer/Answer
        Exchanges](#name-subsequent-offer-answer-exc){.xref}[¶](#section-toc.1-1.4.2.4.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.4.2.1}
            [4.4.1](#section-4.4.1){.xref}.  [Sending Subsequent
            Offer](#name-sending-subsequent-offer){.xref}[¶](#section-toc.1-1.4.2.4.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.4.2.2}
            [4.4.2](#section-4.4.2){.xref}.  [Sending Subsequent
            Answer](#name-sending-subsequent-answer){.xref}[¶](#section-toc.1-1.4.2.4.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.4.2.3}
            [4.4.3](#section-4.4.3){.xref}.  [Receiving Answer for a
            Subsequent
            Offer](#name-receiving-answer-for-a-subs){.xref}[¶](#section-toc.1-1.4.2.4.2.3.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Grammar](#name-grammar){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [\"candidate\"
        Attribute](#name-candidate-attribute){.xref}[¶](#section-toc.1-1.5.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [\"remote-candidates\"
        Attribute](#name-remote-candidates-attribute){.xref}[¶](#section-toc.1-1.5.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.xref}.  [\"ice-lite\" and \"ice-mismatch\"
        Attributes](#name-ice-lite-and-ice-mismatch-a){.xref}[¶](#section-toc.1-1.5.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.4}
        [5.4](#section-5.4){.xref}.  [\"ice-ufrag\" and \"ice-pwd\"
        Attributes](#name-ice-ufrag-and-ice-pwd-attri){.xref}[¶](#section-toc.1-1.5.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.5}
        [5.5](#section-5.5){.xref}.  [\"ice-pacing\"
        Attribute](#name-ice-pacing-attribute){.xref}[¶](#section-toc.1-1.5.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.6}
        [5.6](#section-5.6){.xref}.  [\"ice-options\"
        Attribute](#name-ice-options-attribute){.xref}[¶](#section-toc.1-1.5.2.6.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Keepalives](#name-keepalives){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [SIP
    Considerations](#name-sip-considerations){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Latency
        Guidelines](#name-latency-guidelines){.xref}[¶](#section-toc.1-1.7.2.1.1){.pilcrow}

        -   ::: {#section-toc.1-1.7.2.1.2.1}
            [7.1.1](#section-7.1.1){.xref}.  [Offer in
            INVITE](#name-offer-in-invite){.xref}[¶](#section-toc.1-1.7.2.1.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.7.2.1.2.2}
            [7.1.2](#section-7.1.2){.xref}.  [Offer in
            Response](#name-offer-in-response){.xref}[¶](#section-toc.1-1.7.2.1.2.2.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [SIP Option Tags and Media Feature
        Tags](#name-sip-option-tags-and-media-f){.xref}[¶](#section-toc.1-1.7.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.3}
        [7.3](#section-7.3){.xref}.  [Interactions with
        Forking](#name-interactions-with-forking){.xref}[¶](#section-toc.1-1.7.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.4}
        [7.4](#section-7.4){.xref}.  [Interactions with
        Preconditions](#name-interactions-with-precondit){.xref}[¶](#section-toc.1-1.7.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.5}
        [7.5](#section-7.5){.xref}.  [Interactions with Third Party Call
        Control](#name-interactions-with-third-par){.xref}[¶](#section-toc.1-1.7.2.5.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Interactions with Application Layer
    Gateways and
    SIP](#name-interactions-with-applicati){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [IP Address
        Privacy](#name-ip-address-privacy){.xref}[¶](#section-toc.1-1.9.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [Attacks on the Offer/Answer
        Exchanges](#name-attacks-on-the-offer-answer){.xref}[¶](#section-toc.1-1.9.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.3}
        [9.3](#section-9.3){.xref}.  [The Voice Hammer
        Attack](#name-the-voice-hammer-attack){.xref}[¶](#section-toc.1-1.9.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}

    -   ::: {#section-toc.1-1.10.2.1}
        [10.1](#section-10.1){.xref}.  [SDP
        Attributes](#name-sdp-attributes){.xref}[¶](#section-toc.1-1.10.2.1.1){.pilcrow}

        -   ::: {#section-toc.1-1.10.2.1.2.1}
            [10.1.1](#section-10.1.1){.xref}.  [\"candidate\"
            Attribute](#name-candidate-attribute-2){.xref}[¶](#section-toc.1-1.10.2.1.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.10.2.1.2.2}
            [10.1.2](#section-10.1.2){.xref}.  [\"remote-candidates\"
            Attribute](#name-remote-candidates-attribute-2){.xref}[¶](#section-toc.1-1.10.2.1.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.10.2.1.2.3}
            [10.1.3](#section-10.1.3){.xref}.  [\"ice-lite\"
            Attribute](#name-ice-lite-attribute){.xref}[¶](#section-toc.1-1.10.2.1.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.10.2.1.2.4}
            [10.1.4](#section-10.1.4){.xref}.  [\"ice-mismatch\"
            Attribute](#name-ice-mismatch-attribute){.xref}[¶](#section-toc.1-1.10.2.1.2.4.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.10.2.1.2.5}
            [10.1.5](#section-10.1.5){.xref}.  [\"ice-pwd\"
            Attribute](#name-ice-pwd-attribute){.xref}[¶](#section-toc.1-1.10.2.1.2.5.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.10.2.1.2.6}
            [10.1.6](#section-10.1.6){.xref}.  [\"ice-ufrag\"
            Attribute](#name-ice-ufrag-attribute){.xref}[¶](#section-toc.1-1.10.2.1.2.6.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.10.2.1.2.7}
            [10.1.7](#section-10.1.7){.xref}.  [\"ice-options\"
            Attribute](#name-ice-options-attribute-2){.xref}[¶](#section-toc.1-1.10.2.1.2.7.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.10.2.1.2.8}
            [10.1.8](#section-10.1.8){.xref}.  [\"ice-pacing\"
            Attribute](#name-ice-pacing-attribute-2){.xref}[¶](#section-toc.1-1.10.2.1.2.8.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.10.2.2}
        [10.2](#section-10.2){.xref}.  [Interactive Connectivity
        Establishment (ICE) Options
        Registry](#name-interactive-connectivity-es){.xref}[¶](#section-toc.1-1.10.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.10.2.3}
        [10.3](#section-10.3){.xref}.  [Candidate Attribute Extension
        Subregistry
        Establishment](#name-candidate-attribute-extensi){.xref}[¶](#section-toc.1-1.10.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.xref}. [Changes from RFC
    5245](#name-changes-from-rfc-5245){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.12}
    [12](#section-12){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}

    -   ::: {#section-toc.1-1.12.2.1}
        [12.1](#section-12.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.12.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.12.2.2}
        [12.2](#section-12.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.12.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.13}
    [Appendix
    A](#section-appendix.a){.xref}.  [Examples](#name-examples){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.14}
    [Appendix B](#section-appendix.b){.xref}.  [The
    \"remote-candidates\"
    Attribute](#name-the-remote-candidates-attri){.xref}[¶](#section-toc.1-1.14.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.15}
    [Appendix C](#section-appendix.c){.xref}.  [Why Is the Conflict
    Resolution Mechanism
    Needed?](#name-why-is-the-conflict-resolut){.xref}[¶](#section-toc.1-1.15.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.16}
    [Appendix D](#section-appendix.d){.xref}.  [Why Send an Updated
    Offer?](#name-why-send-an-updated-offer){.xref}[¶](#section-toc.1-1.16.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.17}
    [](#section-appendix.e){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.17.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.18}
    [](#section-appendix.f){.xref}[Contributors](#name-contributors){.xref}[¶](#section-toc.1-1.18.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.19}
    [](#section-appendix.g){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.19.1){.pilcrow}
    :::
:::
:::

::: {#intro}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

This document describes how Interactive Connectivity Establishment (ICE)
is used with Session Description Protocol (SDP) offer/answer
\[[RFC3264](#RFC3264){.xref}\]. The ICE specification
\[[RFC8445](#RFC8445){.xref}\] describes procedures that are common to
all usages of ICE, and this document gives the additional details needed
to use ICE with SDP offer/answer.[¶](#section-1-1){.pilcrow}

This document obsoletes RFCs 5245 and 6336.[¶](#section-1-2){.pilcrow}

NOTE: Previously both the common ICE procedures, and the SDP
offer/answer specific details, were described in
\[[RFC5245](#RFC5245){.xref}\]. \[[RFC8445](#RFC8445){.xref}\] obsoleted
\[[RFC5245](#RFC5245){.xref}\], and the SDP offer/answer-specific
details were removed from the document. [Section 11](#sec.5245){.xref}
describes the changes to the SDP offer/answer-specific details specified
in this document.[¶](#section-1-3){.pilcrow}
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Conventions](#name-conventions){.section-name .selfRef} {#name-conventions}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::

::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

Readers should be familiar with the terminology defined in
\[[RFC3264](#RFC3264){.xref}\], in \[[RFC8445](#RFC8445){.xref}\], and
the following:[¶](#section-3-1){.pilcrow}

[]{.break}

Default Destination/Candidate:
:   The default destination for a component of a data stream is the
    transport address that would be used by an agent that is not ICE
    aware. A default candidate for a component is one whose transport
    address matches the default destination for that component. For the
    RTP component, the default connection address is in the \"c=\" line
    of the SDP, and the port and transport protocol are in the \"m=\"
    line. For the RTP Control Protocol (RTCP) component, the address and
    port are indicated using the \"rtcp\" attribute defined in
    \[[RFC3605](#RFC3605){.xref}\], if present; otherwise, the RTCP
    component address is the same as the address of the RTP component,
    and its port is one greater than the port of the RTP
    component.[¶](#section-3-2.2){.pilcrow}
:   
:::

::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [SDP Offer/Answer Procedures](#name-sdp-offer-answer-procedures){.section-name .selfRef} {#name-sdp-offer-answer-procedures}

::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [Introduction](#name-introduction-2){.section-name .selfRef} {#name-introduction-2}

\[[RFC8445](#RFC8445){.xref}\] defines ICE candidate exchange as the
process for ICE agents (initiator and responder) to exchange their
candidate information required for ICE processing at the agents. For the
purposes of this specification, the candidate exchange process
corresponds to the Offer/Answer protocol \[[RFC3264](#RFC3264){.xref}\],
and the terms \"offerer\" and \"answerer\" correspond to the initiator
and responder roles from \[[RFC8445](#RFC8445){.xref}\]
respectively.[¶](#section-4.1-1){.pilcrow}

Once the initiating agent has gathered, pruned, and prioritized its set
of candidates \[[RFC8445](#RFC8445){.xref}\], the candidate exchange
with the peer agent begins.[¶](#section-4.1-2){.pilcrow}
:::

::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [Generic Procedures](#name-generic-procedures){.section-name .selfRef} {#name-generic-procedures}

::: {#sec-encoding}
::: {#section-4.2.1 .section}
#### [4.2.1.](#section-4.2.1){.section-number .selfRef} [Encoding](#name-encoding){.section-name .selfRef} {#name-encoding}

[Section 5](#sec-grammar){.xref} provides detailed rules for
constructing various SDP attributes defined in this
specification.[¶](#section-4.2.1-1){.pilcrow}

::: {#section-4.2.1.1 .section}
##### [4.2.1.1.](#section-4.2.1.1){.section-number .selfRef} [Data Streams](#name-data-streams){.section-name .selfRef} {#name-data-streams}

Each data stream \[[RFC8445](#RFC8445){.xref}\] is represented by an SDP
media description (\"m=\" section).[¶](#section-4.2.1.1-1){.pilcrow}
:::

::: {#section-4.2.1.2 .section}
##### [4.2.1.2.](#section-4.2.1.2){.section-number .selfRef} [Candidates](#name-candidates){.section-name .selfRef} {#name-candidates}

Within an \"m=\" section, each candidate (including the default
candidate) associated with the data stream is represented by an SDP
\"candidate\" attribute.[¶](#section-4.2.1.2-1){.pilcrow}

Prior to nomination, the \"c=\" line associated with an \"m=\" section
contains the connection address of the default candidate, while the
\"m=\" line contains the port and transport protocol of the default
candidate for that \"m=\" section.[¶](#section-4.2.1.2-2){.pilcrow}

After nomination, the \"c=\" line for a given \"m=\" section contains
the connection address of the nominated candidate (the local candidate
of the nominated candidate pair), and the \"m=\" line contains the port
and transport protocol corresponding to the nominated candidate for that
\"m=\" section.[¶](#section-4.2.1.2-3){.pilcrow}
:::

::: {#section-4.2.1.3 .section}
##### [4.2.1.3.](#section-4.2.1.3){.section-number .selfRef} [Username and Password](#name-username-and-password){.section-name .selfRef} {#name-username-and-password}

The ICE username is represented by an SDP \"ice-ufrag\" attribute, and
the ICE password is represented by an SDP \"ice-pwd\"
attribute.[¶](#section-4.2.1.3-1){.pilcrow}
:::

::: {#section-4.2.1.4 .section}
##### [4.2.1.4.](#section-4.2.1.4){.section-number .selfRef} [Lite Implementations](#name-lite-implementations){.section-name .selfRef} {#name-lite-implementations}

An ICE-lite implementation \[[RFC8445](#RFC8445){.xref}\] [MUST]{.bcp14}
include an SDP \"ice-lite\" attribute. A full implementation [MUST
NOT]{.bcp14} include that attribute.[¶](#section-4.2.1.4-1){.pilcrow}
:::

::: {#section-4.2.1.5 .section}
##### [4.2.1.5.](#section-4.2.1.5){.section-number .selfRef} [ICE Extensions](#name-ice-extensions){.section-name .selfRef} {#name-ice-extensions}

An agent uses the SDP \"ice-options\" attribute to indicate support of
ICE extensions.[¶](#section-4.2.1.5-1){.pilcrow}

An agent compliant with this specification [MUST]{.bcp14} include an SDP
\"ice-options\" attribute with an \"ice2\" attribute value
\[[RFC8445](#RFC8445){.xref}\]. If an agent receives an SDP offer or
answer that indicates ICE support, but that does not contain an SDP
\"ice-options\" attribute with an \"ice2\" attribute value, the agent
can assume that the peer is compliant to
\[[RFC5245](#RFC5245){.xref}\].[¶](#section-4.2.1.5-2){.pilcrow}
:::

::: {#section-4.2.1.6 .section}
##### [4.2.1.6.](#section-4.2.1.6){.section-number .selfRef} [Inactive and Disabled Data Streams](#name-inactive-and-disabled-data-){.section-name .selfRef} {#name-inactive-and-disabled-data-}

If an \"m=\" section is marked as inactive
\[[RFC4566](#RFC4566){.xref}\], or has a bandwidth value of zero
\[[RFC4566](#RFC4566){.xref}\], the agent [MUST]{.bcp14} still include
ICE-related SDP attributes.[¶](#section-4.2.1.6-1){.pilcrow}

If the port value associated with an \"m=\" section is set to zero
(implying a disabled stream) as defined in [Section
8.2](https://www.rfc-editor.org/rfc/rfc3264#section-8.2){.relref} of
\[[RFC3264](#RFC3264){.xref}\], the agent [SHOULD NOT]{.bcp14} include
ICE-related SDP \"candidate\" attributes in that \"m=\" section, unless
an SDP extension specifying otherwise is
used.[¶](#section-4.2.1.6-2){.pilcrow}
:::
:::
:::

::: {#section-4.2.2 .section}
#### [4.2.2.](#section-4.2.2){.section-number .selfRef} [RTP/RTCP Considerations](#name-rtp-rtcp-considerations){.section-name .selfRef} {#name-rtp-rtcp-considerations}

If an agent utilizes both RTP and RTCP, and separate ports are used for
RTP and RTCP, the agent [MUST]{.bcp14} include SDP \"candidate\"
attributes for both the RTP and RTCP
components.[¶](#section-4.2.2-1){.pilcrow}

The agent includes an SDP \"rtcp\" attribute following the procedures in
\[[RFC3605](#RFC3605){.xref}\]. Hence, in the cases where the RTCP port
value is one higher than the RTP port value and the RTCP component
address the same as the address of the RTP component, the SDP \"rtcp\"
attribute might be omitted.[¶](#section-4.2.2-2){.pilcrow}

NOTE: \[[RFC5245](#RFC5245){.xref}\] required that an agent always
includes the SDP \"rtcp\" attribute, even if the RTCP port value was one
higher than the RTP port value. This specification aligns the \"rtcp\"
attribute procedures with
\[[RFC3605](#RFC3605){.xref}\].[¶](#section-4.2.2-3){.pilcrow}

If the agent does not utilize RTCP, it indicates that by including
\"RS:0\" and \"RR:0\" SDP attributes as described in
\[[RFC3556](#RFC3556){.xref}\].[¶](#section-4.2.2-4){.pilcrow}
:::

::: {#section-4.2.3 .section}
#### [4.2.3.](#section-4.2.3){.section-number .selfRef} [Determining Role](#name-determining-role){.section-name .selfRef} {#name-determining-role}

The offerer acts as the initiating agent. The answerer acts as the
responding agent. The ICE roles (controlling and controlled) are
determined using the procedures in
\[[RFC8445](#RFC8445){.xref}\].[¶](#section-4.2.3-1){.pilcrow}
:::

::: {#section-4.2.4 .section}
#### [4.2.4.](#section-4.2.4){.section-number .selfRef} [STUN Considerations](#name-stun-considerations){.section-name .selfRef} {#name-stun-considerations}

Once an agent has provided its local candidates to its peer in an SDP
offer or answer, the agent [MUST]{.bcp14} be prepared to receive STUN
(Session Traversal Utilities for NAT, \[[RFC5389](#RFC5389){.xref}\])
connectivity check Binding requests on those
candidates.[¶](#section-4.2.4-1){.pilcrow}
:::

::: {#sec-ice-mismatch}
::: {#section-4.2.5 .section}
#### [4.2.5.](#section-4.2.5){.section-number .selfRef} [Verifying ICE Support Procedures](#name-verifying-ice-support-proce){.section-name .selfRef} {#name-verifying-ice-support-proce}

An ICE agent indicates support of ICE by including at least the SDP
\"ice-pwd\" and \"ice-ufrag\" attributes in an offer or answer. An ICE
agent compliant with this specification [MUST]{.bcp14} also include an
SDP \"ice-options\" attribute with an \"ice2\" attribute
value.[¶](#section-4.2.5-1){.pilcrow}

The agents will proceed with the ICE procedures defined in
\[[RFC8445](#RFC8445){.xref}\] and this specification if, for each data
stream in the SDP it received, the default destination for each
component of that data stream appears in a \"candidate\" attribute. For
example, in the case of RTP, the connection address, port, and transport
protocol in the \"c=\" and \"m=\" lines, respectively, appear in a
\"candidate\" attribute, and the value in the \"rtcp\" attribute appears
in a \"candidate\" attribute.[¶](#section-4.2.5-2){.pilcrow}

This specification provides no guidance on how an agent should proceed
in the cases where the above condition is not met with the few
exceptions noted below:[¶](#section-4.2.5-3){.pilcrow}

1.  [The presence of certain Application Layer Gateways might modify the
    transport address information as described in [Section
    8](#sec-alg-sip){.xref}. The behavior of the responding agent in
    such a situation is implementation dependent. Informally, the
    responding agent might consider the mismatched transport address
    information as a plausible new candidate learned from the peer and
    continue its ICE processing with that transport address included.
    Alternatively, the responding agent [MAY]{.bcp14} include an
    \"ice-mismatch\" attribute in its answer for such data streams. If
    an agent chooses to include an \"ice-mismatch\" attribute in its
    answer for a data stream, then it [MUST]{.bcp14} also omit
    \"candidate\" attributes, [MUST]{.bcp14} terminate the usage of ICE
    procedures, and \[[RFC3264](#RFC3264){.xref}\] procedures
    [MUST]{.bcp14} be used instead for this data
    stream.[¶](#section-4.2.5-4.1){.pilcrow}]{#section-4.2.5-4.1}
2.  [The transport address from the peer for the default destination is
    set to IPv4/IPv6 address values \"0.0.0.0\"/\"::\" and port value of
    \"9\". This [MUST NOT]{.bcp14} be considered as an ICE failure by
    the peer agent, and the ICE processing [MUST]{.bcp14} continue as
    usual.[¶](#section-4.2.5-4.2){.pilcrow}]{#section-4.2.5-4.2}
3.  [In some cases, the controlling/initiator agent may receive an SDP
    answer that may omit \"candidate\" attributes for the data stream,
    and instead include a media-level \"ice-mismatch\" attribute. This
    signals to the offerer that the answerer supports ICE, but that ICE
    processing was not used for this data stream. In this case, ICE
    processing [MUST]{.bcp14} be terminated for this data stream, and
    \[[RFC3264](#RFC3264){.xref}\] procedures [MUST]{.bcp14} be followed
    instead.[¶](#section-4.2.5-4.3){.pilcrow}]{#section-4.2.5-4.3}
4.  [The transport address from the peer for the default destination is
    an FQDN. Regardless of the procedures used to resolve FQDN or the
    resolution result, this [MUST NOT]{.bcp14} be considered as an ICE
    failure by the peer agent, and the ICE processing [MUST]{.bcp14}
    continue as
    usual.[¶](#section-4.2.5-4.4){.pilcrow}]{#section-4.2.5-4.4}
:::
:::

::: {#section-4.2.6 .section}
#### [4.2.6.](#section-4.2.6){.section-number .selfRef} [SDP Example](#name-sdp-example){.section-name .selfRef} {#name-sdp-example}

The following is an example SDP message that includes ICE attributes
(lines folded for readability):[¶](#section-4.2.6-1){.pilcrow}

::: {#section-4.2.6-2}
``` {.sourcecode .lang-sdp}
v=0
o=jdoe 2890844526 2890842807 IN IP4 203.0.113.141
s=
c=IN IP4 192.0.2.3
t=0 0
a=ice-options:ice2
a=ice-pacing:50
a=ice-pwd:asd88fgpdd777uzjYhagZg
a=ice-ufrag:8hhY
m=audio 45664 RTP/AVP 0
b=RS:0
b=RR:0
a=rtpmap:0 PCMU/8000
a=candidate:1 1 UDP 2130706431 203.0.113.141 8998 typ host
a=candidate:2 1 UDP 1694498815 192.0.2.3 45664 typ srflx raddr
 203.0.113.141 rport 8998
```

[¶](#section-4.2.6-2){.pilcrow}
:::
:::
:::

::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [Initial Offer/Answer Exchange](#name-initial-offer-answer-exchan){.section-name .selfRef} {#name-initial-offer-answer-exchan}

::: {#section-4.3.1 .section}
#### [4.3.1.](#section-4.3.1){.section-number .selfRef} [Sending the Initial Offer](#name-sending-the-initial-offer){.section-name .selfRef} {#name-sending-the-initial-offer}

When an offerer generates the initial offer, in each \"m=\" section it
[MUST]{.bcp14} include SDP \"candidate\" attributes for each available
candidate associated with the \"m=\" section. In addition, the offerer
[MUST]{.bcp14} include an SDP \"ice-ufrag\" attribute, an SDP
\"ice-pwd\" attribute, and an SDP \"ice-options\" attribute with an
\"ice2\" attribute value in the offer. If the offerer is a full ICE
implementation, it [SHOULD]{.bcp14} include an \"ice-pacing\" attribute
in the offer (if not included, the default value will apply). A lite ICE
implementation [MUST NOT]{.bcp14} include the \"ice-pacing\" attribute
in the offer (as it will not perform connectivity
checks).[¶](#section-4.3.1-1){.pilcrow}

It is valid for an offer \"m=\" line to include no SDP \"candidate\"
attributes and have the default destination set to the IP address values
\"0.0.0.0\"/\"::\" and the port value to \"9\". This implies that the
offering agent is only going to use peer-reflexive candidates or will
provide additional candidates in subsequent signaling
messages.[¶](#section-4.3.1-2){.pilcrow}

[]{.break}

Note:
:   Within the scope of this document, \"initial offer\" refers to the
    first SDP offer that is sent in order to negotiate usage of ICE. It
    might, or might not, be the initial SDP offer of the SDP
    session.[¶](#section-4.3.1-3.2){.pilcrow}
:   

[]{.break}

Note:
:   The procedures in this document only consider \"m=\" sections
    associated with data streams where ICE is
    used.[¶](#section-4.3.1-4.2){.pilcrow}
:   
:::

::: {#section-4.3.2 .section}
#### [4.3.2.](#section-4.3.2){.section-number .selfRef} [Sending the Initial Answer](#name-sending-the-initial-answer){.section-name .selfRef} {#name-sending-the-initial-answer}

When an answerer receives an initial offer indicating that the offerer
supports ICE, and if the answerer accepts the offer and the usage of
ICE, the answerer [MUST]{.bcp14} include in each \"m=\" section within
the answer the SDP \"candidate\" attributes for each available candidate
associated with the \"m=\" section. In addition, the answerer
[MUST]{.bcp14} include an SDP \"ice-ufrag\" attribute, an SDP
\"ice-pwd\" attribute, and an SDP \"ice-options\" attribute with an
\"ice2\" attribute value in the answer. If the answerer is a full ICE
implementation, it [SHOULD]{.bcp14} include an \"ice-pacing\" attribute
in the answer (if not included, the default value will apply). A lite
ICE implementation [MUST NOT]{.bcp14} include the \"ice-pacing\"
attribute in the answer (as it will not perform connectivity
checks).[¶](#section-4.3.2-1){.pilcrow}

In each \"m=\" line, the answerer [MUST]{.bcp14} use the same transport
protocol as was used in the offer \"m=\" line. If none of the candidates
in the \"m=\" line in the answer uses the same transport protocol as
indicated in the offer \"m=\" line, then, in order to avoid ICE
mismatch, the default destination [MUST]{.bcp14} be set to IP address
values \"0.0.0.0\"/\"::\" and port value of
\"9\".[¶](#section-4.3.2-2){.pilcrow}

It is also valid for an answer \"m=\" line to include no SDP
\"candidate\" attributes and have the default destination set to the IP
address values \"0.0.0.0\"/\"::\" and the port value to \"9\". This
implies that the answering agent is only going to use peer-reflexive
candidates or that additional candidates would be provided in subsequent
signaling messages.[¶](#section-4.3.2-3){.pilcrow}

Once the answerer has sent the answer, it can start performing
connectivity checks towards the peer candidates that were provided in
the offer.[¶](#section-4.3.2-4){.pilcrow}

If the offer does not indicate support of ICE ([Section
4.2.5](#sec-ice-mismatch){.xref}), the answerer [MUST NOT]{.bcp14}
accept the usage of ICE. If the answerer still accepts the offer, the
answerer [MUST NOT]{.bcp14} include any ICE-related SDP attributes in
the answer. Instead, the answerer will generate the answer according to
normal offer/answer procedures
\[[RFC3264](#RFC3264){.xref}\].[¶](#section-4.3.2-5){.pilcrow}

If the answerer detects a possibility of an ICE mismatch, procedures
described in [Section 4.2.5](#sec-ice-mismatch){.xref} are
followed.[¶](#section-4.3.2-6){.pilcrow}
:::

::: {#section-4.3.3 .section}
#### [4.3.3.](#section-4.3.3){.section-number .selfRef} [Receiving the Initial Answer](#name-receiving-the-initial-answe){.section-name .selfRef} {#name-receiving-the-initial-answe}

When an offerer receives an initial answer that indicates that the
answerer supports ICE, it can start performing connectivity checks
towards the peer candidates that were provided in the
answer.[¶](#section-4.3.3-1){.pilcrow}

If the answer does not indicate that the answerer supports ICE, or if
the answerer included \"ice-mismatch\" attributes for all the active
data streams in the answer, the offerer [MUST]{.bcp14} terminate the
usage of ICE for the entire session, and \[[RFC3264](#RFC3264){.xref}\]
procedures [MUST]{.bcp14} be followed
instead.[¶](#section-4.3.3-2){.pilcrow}

On the other hand, if the answer indicates support for ICE but includes
\"ice-mismatch\" in certain active data streams, then the offerer
[MUST]{.bcp14} terminate the usage of ICE procedures, and
\[[RFC3264](#RFC3264){.xref}\] procedures [MUST]{.bcp14} be used instead
for only these data streams. Also, ICE procedures [MUST]{.bcp14} be used
for data streams where an \"ice-mismatch\" attribute was not
included.[¶](#section-4.3.3-3){.pilcrow}

If the offerer detects an ICE mismatch for one or more data streams in
the answer, as described in [Section 4.2.5](#sec-ice-mismatch){.xref},
the offerer [MUST]{.bcp14} terminate the usage of ICE for the entire
session. The subsequent actions taken by the offerer are implementation
dependent and are out of the scope of this
specification.[¶](#section-4.3.3-4){.pilcrow}
:::

::: {#section-4.3.4 .section}
#### [4.3.4.](#section-4.3.4){.section-number .selfRef} [Concluding ICE](#name-concluding-ice){.section-name .selfRef} {#name-concluding-ice}

Once the agent has successfully nominated a pair
\[[RFC8445](#RFC8445){.xref}\], the state of the checklist associated
with the pair is set to Completed. Once the state of each checklist is
set to either Completed or Failed, for each Completed checklist, the
agent checks whether the nominated pair matches the default candidate
pair. If there are one or more pairs that do not match, and the peer did
not indicate support for the \'ice2\' ice-option, the controlling agent
[MUST]{.bcp14} generate a subsequent offer in which the connection
address, port, and transport protocol in the \"c=\" and \"m=\" lines
associated with each data stream match the corresponding local
information of the nominated pair for that data stream ([Section
4.4.1.2.2](#sec-send-subsequent-offer-after-nom){.xref}). If the peer
did indicate support for the \'ice2\' ice-option, the controlling agent
does not immediately need to generate an updated offer in order to align
a connection address, port, and protocol with a nominated pair. However,
later in the session, whenever the controlling agent does send a
subsequent offer, it [MUST]{.bcp14} do the alignment as described
above.[¶](#section-4.3.4-1){.pilcrow}

If there are one or more checklists with the state set to Failed, the
controlling agent [MUST]{.bcp14} generate a subsequent offer in order to
remove the associated data streams by setting the port value of the data
streams to zero ([Section
4.4.1.1.2](#sec-send-subsequent-offer-remove){.xref}), even if the peer
did indicate support for the \'ice2\' ice-option. If needed, such offer
is used to align the connection address, port, and transport protocol,
as described above.[¶](#section-4.3.4-2){.pilcrow}

As described in \[[RFC8445](#RFC8445){.xref}\], once the controlling
agent has nominated a candidate pair for a checklist, the agent [MUST
NOT]{.bcp14} nominate another pair for that checklist during the
lifetime of the ICE session (i.e., until ICE is
restarted).[¶](#section-4.3.4-3){.pilcrow}

\[[RFC8863](#RFC8863){.xref}\] provides a mechanism for allowing the ICE
process to run long enough in order to find working candidate pairs, by
waiting for potential peer-reflexive candidates, even though no
candidate pairs were received from the peer or all current candidate
pairs associated with a checklist have either failed or been
discarded.[¶](#section-4.3.4-4){.pilcrow}
:::
:::

::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [Subsequent Offer/Answer Exchanges](#name-subsequent-offer-answer-exc){.section-name .selfRef} {#name-subsequent-offer-answer-exc}

Either agent [MAY]{.bcp14} generate a subsequent offer at any time
allowed by \[[RFC3264](#RFC3264){.xref}\]. This section defines rules
for construction of subsequent offers and
answers.[¶](#section-4.4-1){.pilcrow}

Should a subsequent offer fail, ICE processing continues as if the
subsequent offer had never been made.[¶](#section-4.4-2){.pilcrow}

::: {#sec-send-subsequent-offer}
::: {#section-4.4.1 .section}
#### [4.4.1.](#section-4.4.1){.section-number .selfRef} [Sending Subsequent Offer](#name-sending-subsequent-offer){.section-name .selfRef} {#name-sending-subsequent-offer}

::: {#section-4.4.1.1 .section}
##### [4.4.1.1.](#section-4.4.1.1){.section-number .selfRef} [Procedures for All Implementations](#name-procedures-for-all-implemen){.section-name .selfRef} {#name-procedures-for-all-implemen}

::: {#sec-suboffer-restarts}
::: {#section-4.4.1.1.1 .section}
###### [4.4.1.1.1.](#section-4.4.1.1.1){.section-number .selfRef} [ICE Restart](#name-ice-restart){.section-name .selfRef} {#name-ice-restart}

An agent [MAY]{.bcp14} restart ICE processing for an existing data
stream
\[[RFC8445](#RFC8445){.xref}\].[¶](#section-4.4.1.1.1-1){.pilcrow}

The rules governing the ICE restart imply that setting the connection
address in the \"c=\" line to \"0.0.0.0\" (for IPv4)/ \"::\" (for IPv6)
will cause an ICE restart. Consequently, ICE implementations [MUST
NOT]{.bcp14} utilize this mechanism for call hold, and instead
[MUST]{.bcp14} use \"inactive\" and \"sendonly\" as described in
\[[RFC3264](#RFC3264){.xref}\].[¶](#section-4.4.1.1.1-2){.pilcrow}

To restart ICE, an agent [MUST]{.bcp14} change both the \"ice-pwd\" and
the \"ice-ufrag\" for the data stream in an offer. However, it is
permissible to use a session-level attribute in one offer, but to
provide the same \"ice-pwd\" or \"ice-ufrag\" as a media-level attribute
in a subsequent offer. This [MUST NOT]{.bcp14} be considered as ICE
restart.[¶](#section-4.4.1.1.1-3){.pilcrow}

An agent sets the rest of the ICE-related fields in the SDP for this
data stream as it would in an initial offer of this data stream
([Section 4.2.1](#sec-encoding){.xref}). Consequently, the set of
candidates [MAY]{.bcp14} include some, none, or all of the previous
candidates for that data stream and [MAY]{.bcp14} include a totally new
set of candidates. The agent [MAY]{.bcp14} modify the attribute values
of the SDP \"ice-options\" and SDP \"ice-pacing\" attributes, and it
[MAY]{.bcp14} change its role using the SDP \"ice-lite\" attribute. The
agent [MUST NOT]{.bcp14} modify the SDP \"ice-options\", \"ice-pacing\",
and \"ice-lite\" attributes in a subsequent offer unless the offer is
sent in order to request an ICE
restart.[¶](#section-4.4.1.1.1-4){.pilcrow}
:::
:::

::: {#sec-send-subsequent-offer-remove}
::: {#section-4.4.1.1.2 .section}
###### [4.4.1.1.2.](#section-4.4.1.1.2){.section-number .selfRef} [Removing a Data Stream](#name-removing-a-data-stream){.section-name .selfRef} {#name-removing-a-data-stream}

If an agent removes a data stream by setting its port to zero, it [MUST
NOT]{.bcp14} include any \"candidate\" attributes for that data stream
and [SHOULD NOT]{.bcp14} include any other ICE-related attributes
defined in [Section 5](#sec-grammar){.xref} for that data
stream.[¶](#section-4.4.1.1.2-1){.pilcrow}
:::
:::

::: {#section-4.4.1.1.3 .section}
###### [4.4.1.1.3.](#section-4.4.1.1.3){.section-number .selfRef} [Adding a Data Stream](#name-adding-a-data-stream){.section-name .selfRef} {#name-adding-a-data-stream}

If an agent wishes to add a new data stream, it sets the fields in the
SDP for this data stream as if this were an initial offer for that data
stream ([Section 4.2.1](#sec-encoding){.xref}). This will cause ICE
processing to begin for this data
stream.[¶](#section-4.4.1.1.3-1){.pilcrow}
:::
:::

::: {#section-4.4.1.2 .section}
##### [4.4.1.2.](#section-4.4.1.2){.section-number .selfRef} [Procedures for Full Implementations](#name-procedures-for-full-impleme){.section-name .selfRef} {#name-procedures-for-full-impleme}

This section describes additional procedures for full implementations,
covering existing data streams.[¶](#section-4.4.1.2-1){.pilcrow}

::: {#section-4.4.1.2.1 .section}
###### [4.4.1.2.1.](#section-4.4.1.2.1){.section-number .selfRef} [Before Nomination](#name-before-nomination){.section-name .selfRef} {#name-before-nomination}

When an offerer sends a subsequent offer; in each \"m=\" section for
which a candidate pair has not yet been nominated, the offer
[MUST]{.bcp14} include the same set of ICE-related information that the
offerer included in the previous offer or answer. The agent
[MAY]{.bcp14} include additional candidates it did not offer previously,
but which it has gathered since the last offer/answer exchange,
including peer-reflexive candidates.[¶](#section-4.4.1.2.1-1){.pilcrow}

The agent [MAY]{.bcp14} change the default destination for media. As
with initial offers, there [MUST]{.bcp14} be a set of \"candidate\"
attributes in the offer matching this default
destination.[¶](#section-4.4.1.2.1-2){.pilcrow}
:::

::: {#sec-send-subsequent-offer-after-nom}
::: {#section-4.4.1.2.2 .section}
###### [4.4.1.2.2.](#section-4.4.1.2.2){.section-number .selfRef} [After Nomination](#name-after-nomination){.section-name .selfRef} {#name-after-nomination}

Once a candidate pair has been nominated for a data stream, the
connection address, port, and transport protocol in each \"c=\" and
\"m=\" line associated with that data stream [MUST]{.bcp14} match the
data associated with the nominated pair for that data stream. In
addition, the offerer only includes SDP \"candidate\" attributes (one
per component) representing the local candidates of the nominated
candidate pair. The offerer [MUST NOT]{.bcp14} include any other SDP
\"candidate\" attributes in the subsequent
offer.[¶](#section-4.4.1.2.2-1){.pilcrow}

In addition, if the agent is controlling, it [MUST]{.bcp14} include the
\"remote-candidates\" attribute for each data stream whose checklist is
in the Completed state. The attribute contains the remote candidates
corresponding to the nominated pair in the valid list for each component
of that data stream. It is needed to avoid a race condition whereby the
controlling agent chooses its pairs, but the updated offer beats the
connectivity checks to the controlled agent, which doesn\'t even know
these pairs are valid, let alone selected. See [Appendix
B](#sec-why-remote){.xref} for elaboration on this race
condition.[¶](#section-4.4.1.2.2-2){.pilcrow}
:::
:::
:::

::: {#section-4.4.1.3 .section}
##### [4.4.1.3.](#section-4.4.1.3){.section-number .selfRef} [Procedures for Lite Implementations](#name-procedures-for-lite-impleme){.section-name .selfRef} {#name-procedures-for-lite-impleme}

If the ICE state is Running, a lite implementation [MUST]{.bcp14}
include all of its candidates for each component of each data stream in
\"candidate\" attributes in any subsequent offer. The candidates are
formed identically to the procedures for initial
offers.[¶](#section-4.4.1.3-1){.pilcrow}

A lite implementation [MUST NOT]{.bcp14} add additional host candidates
in a subsequent offer, and [MUST NOT]{.bcp14} modify the username
fragments and passwords. If an agent needs to offer additional
candidates, or to modify the username fragments and passwords, it
[MUST]{.bcp14} request an ICE restart ([Section
4.4.1.1.1](#sec-suboffer-restarts){.xref}) for that data
stream.[¶](#section-4.4.1.3-2){.pilcrow}

If ICE has completed for a data stream, and if the agent is controlled,
the default destination for that data stream [MUST]{.bcp14} be set to
the remote candidate of the candidate pair for that component in the
valid list. For a lite implementation, there is always just a single
candidate pair in the valid list for each component of a data stream.
Additionally, the agent [MUST]{.bcp14} include a \"candidate\" attribute
for each default destination.[¶](#section-4.4.1.3-3){.pilcrow}

If the ICE state is Completed, and if the agent is controlling (which
only happens when both agents are lite), the agent [MUST]{.bcp14}
include the \"remote-candidates\" attribute for each data stream. The
attribute contains the remote candidates from the candidate pairs in the
valid list (one pair for each component of each data
stream).[¶](#section-4.4.1.3-4){.pilcrow}
:::
:::
:::

::: {#sec-subsequent-answer}
::: {#section-4.4.2 .section}
#### [4.4.2.](#section-4.4.2){.section-number .selfRef} [Sending Subsequent Answer](#name-sending-subsequent-answer){.section-name .selfRef} {#name-sending-subsequent-answer}

If ICE is Completed for a data stream, and the offer for that data
stream lacked the \"remote-candidates\" attribute, the rules for
construction of the answer are identical to those for the offerer,
except that the answerer [MUST NOT]{.bcp14} include the
\"remote-candidates\" attribute in the
answer.[¶](#section-4.4.2-1){.pilcrow}

A controlled agent will receive an offer with the \"remote-candidates\"
attribute for a data stream when its peer has concluded ICE processing
for that data stream. This attribute is present in the offer to deal
with a race condition between the receipt of the offer, and the receipt
of the Binding response that tells the answerer the candidate that will
be selected by ICE. See [Appendix B](#sec-why-remote){.xref} for an
explanation of this race condition. Consequently, processing of an offer
with this attribute depends on the winner of the
race.[¶](#section-4.4.2-2){.pilcrow}

The agent forms a candidate pair for each component of the data stream
by:[¶](#section-4.4.2-3){.pilcrow}

-   [Setting the remote candidate equal to the offerer\'s default
    destination for that component (i.e., the contents of the \"m=\" and
    \"c=\" lines for RTP, and the \"rtcp\" attribute for
    RTCP)[¶](#section-4.4.2-4.1){.pilcrow}]{#section-4.4.2-4.1}
-   [Setting the local candidate equal to the transport address for that
    same component in the \"remote-candidates\" attribute in the
    offer.[¶](#section-4.4.2-4.2){.pilcrow}]{#section-4.4.2-4.2}

The agent then sees if each of these candidate pairs is present in the
valid list. If a particular pair is not in the valid list, the check has
\"lost\" the race. Call such a pair a \"losing
pair\".[¶](#section-4.4.2-5){.pilcrow}

The agent finds all the pairs in the checklist whose remote candidates
equal the remote candidate in the losing
pair:[¶](#section-4.4.2-6){.pilcrow}

-   [If none of the pairs is In-Progress, and at least one is Failed, it
    is most likely that a network failure, such as a network partition
    or serious packet loss, has occurred. The agent [SHOULD]{.bcp14}
    generate an answer for this data stream as if the \"remote-
    candidates\" attribute had not been present, and then restart ICE
    for this
    stream.[¶](#section-4.4.2-7.1){.pilcrow}]{#section-4.4.2-7.1}
-   [If at least one of the pairs is In-Progress, the agent
    [SHOULD]{.bcp14} wait for those checks to complete, and as each
    completes, redo the processing in this section until there are no
    losing pairs.[¶](#section-4.4.2-7.2){.pilcrow}]{#section-4.4.2-7.2}

Once there are no losing pairs, the agent can generate the answer. It
[MUST]{.bcp14} set the default destination for media to the candidates
in the \"remote-candidates\" attribute from the offer (each of which
will now be the local candidate of a candidate pair in the valid list).
It [MUST]{.bcp14} include a \"candidate\" attribute in the answer for
each candidate in the \"remote-candidates\" attribute in the
offer.[¶](#section-4.4.2-8){.pilcrow}

::: {#section-4.4.2.1 .section}
##### [4.4.2.1.](#section-4.4.2.1){.section-number .selfRef} [ICE Restart](#name-ice-restart-2){.section-name .selfRef} {#name-ice-restart-2}

If the offerer in a subsequent offer requested an ICE restart ([Section
4.4.1.1.1](#sec-suboffer-restarts){.xref}) for a data stream, and if the
answerer accepts the offer, the answerer follows the procedures for
generating an initial answer.[¶](#section-4.4.2.1-1){.pilcrow}

For a given data stream, the answerer [MAY]{.bcp14} include the same
candidates that were used in the previous ICE session, but it
[MUST]{.bcp14} change the SDP \"ice-pwd\" and \"ice-ufrag\" attribute
values.[¶](#section-4.4.2.1-2){.pilcrow}

The answerer [MAY]{.bcp14} modify the attribute values of the SDP
\"ice-options\" and SDP \"ice-pacing\" attributes, and it [MAY]{.bcp14}
change its role using the SDP \"ice-lite\" attribute. The answerer [MUST
NOT]{.bcp14} modify the SDP \"ice-options\", \"ice-pacing\", and
\"ice-lite\" attributes in a subsequent answer unless the answer is sent
for an offer that was used to request an ICE restart ([Section
4.4.1.1.1](#sec-suboffer-restarts){.xref}). If any of the SDP attributes
have been modified in a subsequent offer that is not used to request an
ICE restart, the answerer [MUST]{.bcp14} reject the
offer.[¶](#section-4.4.2.1-3){.pilcrow}
:::

::: {#section-4.4.2.2 .section}
##### [4.4.2.2.](#section-4.4.2.2){.section-number .selfRef} [Lite Implementation Specific Procedures](#name-lite-implementation-specifi){.section-name .selfRef} {#name-lite-implementation-specifi}

If the received offer contains the \"remote-candidates\" attribute for a
data stream, the agent forms a candidate pair for each component of the
data stream by:[¶](#section-4.4.2.2-1){.pilcrow}

-   [Setting the remote candidate equal to the offerer\'s default
    destination for that component (i.e., the contents of the \"m=\" and
    \"c=\" lines for RTP, and the \"rtcp\" attribute for
    RTCP).[¶](#section-4.4.2.2-2.1){.pilcrow}]{#section-4.4.2.2-2.1}
-   [Setting the local candidate equal to the transport address for that
    same component in the \"remote-candidates\" attribute in the
    offer.[¶](#section-4.4.2.2-2.2){.pilcrow}]{#section-4.4.2.2-2.2}

The state of the checklist associated with that data stream is set to
Completed.[¶](#section-4.4.2.2-3){.pilcrow}

Furthermore, if the agent believed it was controlling, but the offer
contained the \"remote-candidates\" attribute, both agents believe they
are controlling. In this case, both would have sent updated offers
around the same time.[¶](#section-4.4.2.2-4){.pilcrow}

However, the signaling protocol carrying the offer/answer exchanges will
have resolved this glare condition, so that one agent is always the
\'winner\' by having its offer received before its peer has sent an
offer. The winner takes the role of controlling, so that the loser (the
answerer under consideration in this section) [MUST]{.bcp14} change its
role to controlled.[¶](#section-4.4.2.2-5){.pilcrow}

Consequently, if the agent was controlling based on the rules in
[Section
8.2](https://www.rfc-editor.org/rfc/rfc8445#section-8.2){.relref} of
\[[RFC8445](#RFC8445){.xref}\] and was going to send an updated offer,
it no longer needs to.[¶](#section-4.4.2.2-6){.pilcrow}

Besides the potential role change, change in the valid list, and state
changes, the construction of the answer is performed identically to the
construction of an offer.[¶](#section-4.4.2.2-7){.pilcrow}
:::
:::
:::

::: {#section-4.4.3 .section}
#### [4.4.3.](#section-4.4.3){.section-number .selfRef} [Receiving Answer for a Subsequent Offer](#name-receiving-answer-for-a-subs){.section-name .selfRef} {#name-receiving-answer-for-a-subs}

::: {#section-4.4.3.1 .section}
##### [4.4.3.1.](#section-4.4.3.1){.section-number .selfRef} [Procedures for Full Implementations](#name-procedures-for-full-implemen){.section-name .selfRef} {#name-procedures-for-full-implemen}

There may be certain situations where the offerer receives an SDP answer
that lacks ICE candidates although the initial answer included them. One
example of such an \"unexpected\" answer might happen when an
ICE-unaware Back-to-Back User Agent (B2BUA) introduces a media server
during call hold using third party call control procedures
\[[RFC3725](#RFC3725){.xref}\]. Omitting further details on how this is
done, this could result in an answer that was constructed by the B2BUA
being received at the holding UA. With the B2BUA being ICE-unaware, that
answer would not include ICE
candidates.[¶](#section-4.4.3.1-1){.pilcrow}

Receiving an answer without ICE attributes in this situation might be
unexpected, but would not necessarily impair the user
experience.[¶](#section-4.4.3.1-2){.pilcrow}

When the offerer receives an answer indicating support for ICE, the
offer performs one of the following
actions:[¶](#section-4.4.3.1-3){.pilcrow}

-   [If the offer was a restart, the agent [MUST]{.bcp14} perform ICE
    restart procedures as specified in [Section
    4.4.3.1.1](#sec-restart-subsequent){.xref}.[¶](#section-4.4.3.1-4.1){.pilcrow}]{#section-4.4.3.1-4.1}
-   [If the offer/answer exchange removed a data stream, or an answer
    rejected an offered data stream, an agent [MUST]{.bcp14} flush the
    valid list for that data stream. It [MUST]{.bcp14} also terminate
    any STUN transactions in progress for that data
    stream.[¶](#section-4.4.3.1-4.2){.pilcrow}]{#section-4.4.3.1-4.2}
-   [If the offer/answer exchange added a new data stream, the agent
    [MUST]{.bcp14} create a new checklist for it (and an empty valid
    list to start of course), which in turn triggers the candidate
    processing procedures
    \[[RFC8445](#RFC8445){.xref}\].[¶](#section-4.4.3.1-4.3){.pilcrow}]{#section-4.4.3.1-4.3}
-   [If the checklist state associated with a data stream is Running,
    the agent recomputes the checklist. If a pair on the new checklist
    was also on the previous checklist, its candidate pair state is
    copied over. Otherwise, its candidate pair state is set to Frozen.
    If none of the checklists are active (meaning that the candidate
    pair states in each checklist are Frozen), appropriate procedures in
    \[[RFC8445](#RFC8445){.xref}\] are performed to move candidate
    pair(s) to the Waiting state to further continue ICE
    processing.[¶](#section-4.4.3.1-4.4){.pilcrow}]{#section-4.4.3.1-4.4}
-   [If the ICE state is Completed, and the SDP answer conforms to
    [Section 4.4.2](#sec-subsequent-answer){.xref}, the agent
    [MUST]{.bcp14} remain in the Completed ICE
    state.[¶](#section-4.4.3.1-4.5){.pilcrow}]{#section-4.4.3.1-4.5}

However, if the ICE support is no longer indicated in the SDP answer,
the agent [MUST]{.bcp14} fall back to \[[RFC3264](#RFC3264){.xref}\]
procedures and [SHOULD NOT]{.bcp14} drop the dialog because of the
missing ICE support or unexpected answer. When the agent sends a new
offer, it [MUST]{.bcp14} perform an ICE
restart.[¶](#section-4.4.3.1-5){.pilcrow}

::: {#sec-restart-subsequent}
::: {#section-4.4.3.1.1 .section}
###### [4.4.3.1.1.](#section-4.4.3.1.1){.section-number .selfRef} [ICE Restarts](#name-ice-restarts){.section-name .selfRef} {#name-ice-restarts}

The agent [MUST]{.bcp14} remember the nominated pair in the valid list
for each component of the data stream, called the \"previous selected
pair\", prior to the restart. The agent will continue to send media
using this pair, as described in [Section
12](https://www.rfc-editor.org/rfc/rfc8445#section-12){.relref} of
\[[RFC8445](#RFC8445){.xref}\]. Once these destinations are noted, the
agent [MUST]{.bcp14} flush the valid lists and checklists, and then
recompute the checklist and its states, thus triggering the candidate
processing procedures
\[[RFC8445](#RFC8445){.xref}\].[¶](#section-4.4.3.1.1-1){.pilcrow}
:::
:::
:::

::: {#section-4.4.3.2 .section}
##### [4.4.3.2.](#section-4.4.3.2){.section-number .selfRef} [Procedures for Lite Implementations](#name-procedures-for-lite-implemen){.section-name .selfRef} {#name-procedures-for-lite-implemen}

If ICE is restarting for a data stream, the agent [MUST]{.bcp14} create
a new valid list for that data stream. It [MUST]{.bcp14} remember the
nominated pair in the previous valid list for each component of the data
stream, called the \"previous selected pairs\", and continue to send
media there as described in [Section
12](https://www.rfc-editor.org/rfc/rfc8445#section-12){.relref} of
\[[RFC8445](#RFC8445){.xref}\]. The state of each checklist for each
data stream [MUST]{.bcp14} change to Running, and the ICE state
[MUST]{.bcp14} be set to Running.[¶](#section-4.4.3.2-1){.pilcrow}
:::
:::
:::
:::

::: {#sec-grammar}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Grammar](#name-grammar){.section-name .selfRef} {#name-grammar}

This specification defines eight new SDP attributes \-- the
\"candidate\", \"remote-candidates\", \"ice-lite\", \"ice-mismatch\",
\"ice-ufrag\", \"ice-pwd\", \"ice-pacing\", and \"ice-options\"
attributes.[¶](#section-5-1){.pilcrow}

This section also provides non-normative examples of the attributes
defined.[¶](#section-5-2){.pilcrow}

The syntax for the attributes follow Augmented BNF as defined in
\[[RFC5234](#RFC5234){.xref}\].[¶](#section-5-3){.pilcrow}

::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [\"candidate\" Attribute](#name-candidate-attribute){.section-name .selfRef} {#name-candidate-attribute}

The \"candidate\" attribute is a media-level attribute only. It contains
a transport address for a candidate that can be used for connectivity
checks.[¶](#section-5.1-1){.pilcrow}

::: {#section-5.1-2}
``` {.sourcecode .lang-abnf}
candidate-attribute   = "candidate" ":" foundation SP component-id SP
                        transport SP
                        priority SP
                        connection-address SP     ;from RFC 4566
                        port         ;port from RFC 4566
                        SP cand-type
                        [SP rel-addr]
                        [SP rel-port]
                        *(SP cand-extension)

foundation            = 1*32ice-char
component-id          = 1*3DIGIT
transport             = "UDP" / transport-extension
transport-extension   = token              ; from RFC 3261
priority              = 1*10DIGIT
cand-type             = "typ" SP candidate-types
candidate-types       = "host" / "srflx" / "prflx" / "relay" / token
rel-addr              = "raddr" SP connection-address
rel-port              = "rport" SP port
cand-extension        = extension-att-name SP extension-att-value
extension-att-name    = token
extension-att-value   = *VCHAR
ice-char              = ALPHA / DIGIT / "+" / "/"
```

[¶](#section-5.1-2){.pilcrow}
:::

This grammar encodes the primary information about a candidate: its IP
address, port and transport protocol, and its properties: the
foundation, component ID, priority, type, and related transport
address:[¶](#section-5.1-3){.pilcrow}

[]{.break}

\<connection-address>:
:   is taken from RFC 4566 \[[RFC4566](#RFC4566){.xref}\]. It is the IP
    address of the candidate, allowing for IPv4 addresses, IPv6
    addresses, and fully qualified domain names (FQDNs). When parsing
    this field, an agent can differentiate an IPv4 address and an IPv6
    address by presence of a colon in its value - the presence of a
    colon indicates IPv6. An agent generating local candidates [MUST
    NOT]{.bcp14} use FQDN addresses. An agent processing remote
    candidates [MUST]{.bcp14} ignore \"candidate\" lines that include
    candidates with FQDNs or IP address versions that are not supported
    or recognized. The procedures for generation and handling of FQDN
    candidates, as well as, how agents indicate support for such
    procedures, need to be specified in an extension
    specification.[¶](#section-5.1-4.2){.pilcrow}
:   

\<port>:
:   is also taken from RFC 4566 \[[RFC4566](#RFC4566){.xref}\]. It is
    the port of the candidate.[¶](#section-5.1-4.4){.pilcrow}
:   

\<transport>:
:   indicates the transport protocol for the candidate. This
    specification only defines UDP. However, extensibility is provided
    to allow for future transport protocols to be used with ICE by
    extending the subregistry \"ICE Transport Protocols\" under the
    \"Interactive Connectivity Establishment (ICE)\"
    registry.[¶](#section-5.1-4.6){.pilcrow}
:   

\<foundation>:
:   is composed of 1 to 32 \<ice-char>s. It is an identifier that is
    equivalent for two candidates that are of the same type, share the
    same base, and come from the same STUN server. The foundation is
    used to optimize ICE performance in the Frozen algorithm as
    described in
    \[[RFC8445](#RFC8445){.xref}\].[¶](#section-5.1-4.8){.pilcrow}
:   

\<component-id>:
:   is a positive integer between 1 and 256 (inclusive) that identifies
    the specific component of the data stream for which this is a
    candidate. It [MUST]{.bcp14} start at 1 and [MUST]{.bcp14} increment
    by 1 for each component of a particular candidate. For data streams
    based on RTP, candidates for the actual RTP media [MUST]{.bcp14}
    have a component ID of 1, and candidates for RTCP [MUST]{.bcp14}
    have a component ID of 2. See [Section
    13](https://www.rfc-editor.org/rfc/rfc8445#section-13){.relref} of
    \[[RFC8445](#RFC8445){.xref}\] for additional discussion on
    extending ICE to new data streams.[¶](#section-5.1-4.10){.pilcrow}
:   

\<priority>:
:   is a positive integer between 1 and (2\*\*31 - 1) inclusive. The
    procedures for computing a candidate\'s priority are described in
    [Section
    5.1.2](https://www.rfc-editor.org/rfc/rfc8445#section-5.1.2){.relref}
    of \[[RFC8445](#RFC8445){.xref}\].[¶](#section-5.1-4.12){.pilcrow}
:   

\<cand-type>:
:   encodes the type of candidate. This specification defines the values
    \"host\", \"srflx\", \"prflx\", and \"relay\" for host,
    server-reflexive, peer-reflexive, and relayed candidates,
    respectively. Specifications for new candidate types [MUST]{.bcp14}
    define how, if at all, various steps in the ICE processing differ
    from the ones defined by this
    specification.[¶](#section-5.1-4.14){.pilcrow}
:   

\<rel-addr> and \<rel-port>:
:   convey transport addresses related to the candidate, useful for
    diagnostics and other purposes. \<rel-addr> and \<rel-port>
    [MUST]{.bcp14} be present for server-reflexive, peer-reflexive, and
    relayed candidates. If a candidate is server-reflexive or
    peer-reflexive, \<rel-addr> and \<rel-port> are equal to the base
    for that server-reflexive or peer-reflexive candidate. If the
    candidate is relayed, \<rel-addr> and \<rel-port> are equal to the
    mapped address in the Allocate response that provided the client
    with that relayed candidate (see [Section
    6.3](https://www.rfc-editor.org/rfc/rfc5766#section-6.3){.relref} of
    \[[RFC5766](#RFC5766){.xref}\]). If the candidate is a host
    candidate, \<rel-addr> and \<rel-port> MUST be
    omitted.[¶](#section-5.1-4.16){.pilcrow}
:   

:   In some cases, e.g., for privacy reasons, an agent may not want to
    reveal the related address and port. In this case the address
    [MUST]{.bcp14} be set to \"0.0.0.0\" (for IPv4 candidates) or \"::\"
    (for IPv6 candidates) and the port to
    \"9\".[¶](#section-5.1-4.18){.pilcrow}
:   

The \"candidate\" attribute can itself be extended. The grammar allows
for new name/value pairs to be added at the end of the attribute. Such
extensions [MUST]{.bcp14} be made through IETF Review or IESG Approval
\[[RFC8126](#RFC8126){.xref}\], and the assignments [MUST]{.bcp14}
contain the specific extension and a reference to the document defining
the usage of the extension.[¶](#section-5.1-5){.pilcrow}

An implementation [MUST]{.bcp14} ignore any name/value pairs it doesn\'t
understand.[¶](#section-5.1-6){.pilcrow}

The following is an example SDP line for a UDP server-reflexive
\"candidate\" attribute for the RTP
component:[¶](#section-5.1-7){.pilcrow}

::: {#section-5.1-8}
``` {.sourcecode .lang-sdp}
a=candidate:2 1 UDP 1694498815 192.0.2.3 45664 typ srflx raddr
203.0.113.141 rport 8998
```

[¶](#section-5.1-8){.pilcrow}
:::
:::

::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [\"remote-candidates\" Attribute](#name-remote-candidates-attribute){.section-name .selfRef} {#name-remote-candidates-attribute}

The syntax of the \"remote-candidates\" attribute is defined using
Augmented BNF as defined in \[[RFC5234](#RFC5234){.xref}\]. The
\"remote-candidates\" attribute is a media-level attribute
only.[¶](#section-5.2-1){.pilcrow}

::: {#section-5.2-2}
``` {.sourcecode .lang-abnf}
remote-candidate-att = "remote-candidates:" remote-candidate
                         0*(SP remote-candidate)
remote-candidate = component-id SP connection-address SP port
```

[¶](#section-5.2-2){.pilcrow}
:::

The attribute contains a connection-address and port for each component.
The ordering of components is irrelevant. However, a value
[MUST]{.bcp14} be present for each component of a data stream. This
attribute [MUST]{.bcp14} be included in an offer by a controlling agent
for a data stream that is Completed, and [MUST NOT]{.bcp14} be included
in any other case.[¶](#section-5.2-3){.pilcrow}

The following is an example of \"remote-candidates\" SDP lines for the
RTP and RTCP components:[¶](#section-5.2-4){.pilcrow}

::: {#section-5.2-5}
``` {.sourcecode .lang-sdp}
a=remote-candidates:1 192.0.2.3 45664
a=remote-candidates:2 192.0.2.3 45665
```

[¶](#section-5.2-5){.pilcrow}
:::
:::

::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [\"ice-lite\" and \"ice-mismatch\" Attributes](#name-ice-lite-and-ice-mismatch-a){.section-name .selfRef} {#name-ice-lite-and-ice-mismatch-a}

The syntax of the \"ice-lite\" and \"ice-mismatch\" attributes, both of
which are flags, is:[¶](#section-5.3-1){.pilcrow}

::: {#section-5.3-2}
``` {.sourcecode .lang-abnf}
ice-lite               = "ice-lite"
ice-mismatch           = "ice-mismatch"
```

[¶](#section-5.3-2){.pilcrow}
:::

\"ice-lite\" is a session-level attribute only, and indicates that an
agent is a lite implementation. \"ice-mismatch\" is a media-level
attribute and only reported in the answer. It indicates that the offer
arrived with a default destination for a media component that didn\'t
have a corresponding \"candidate\" attribute. Inclusion of
\"ice-mismatch\" attribute for a given data stream implies that even
though both agents support ICE, ICE procedures [MUST NOT]{.bcp14} be
used for this data stream, and \[[RFC3264](#RFC3264){.xref}\] procedures
[MUST]{.bcp14} be used instead.[¶](#section-5.3-3){.pilcrow}
:::

::: {#section-5.4 .section}
### [5.4.](#section-5.4){.section-number .selfRef} [\"ice-ufrag\" and \"ice-pwd\" Attributes](#name-ice-ufrag-and-ice-pwd-attri){.section-name .selfRef} {#name-ice-ufrag-and-ice-pwd-attri}

The \"ice-ufrag\" and \"ice-pwd\" attributes convey the username
fragment and password used by ICE for message integrity. Their syntax
is:[¶](#section-5.4-1){.pilcrow}

::: {#section-5.4-2}
``` {.sourcecode .lang-abnf}
ice-pwd-att           = "ice-pwd:" password
ice-ufrag-att         = "ice-ufrag:" ufrag
password              = 22*256ice-char
ufrag                 = 4*256ice-char
```

[¶](#section-5.4-2){.pilcrow}
:::

The \"ice-pwd\" and \"ice-ufrag\" attributes can appear at either the
session-level or media-level. When present in both, the value in the
media-level takes precedence. Thus, the value at the session-level is
effectively a default that applies to all data streams, unless
overridden by a media-level value. Whether present at the session or
media-level, there [MUST]{.bcp14} be an \"ice-pwd\" and \"ice-ufrag\"
attribute for each data stream. If two data streams have identical
\"ice-ufrag\"s, they [MUST]{.bcp14} have identical
\"ice-pwd\"s.[¶](#section-5.4-3){.pilcrow}

The \"ice-ufrag\" and \"ice-pwd\" attributes [MUST]{.bcp14} be chosen
randomly at the beginning of a session (the same applies when ICE is
restarting for an agent).[¶](#section-5.4-4){.pilcrow}

\[[RFC8445](#RFC8445){.xref}\] requires the \"ice-ufrag\" attribute to
contain at least 24 bits of randomness, and the \"ice-pwd\" attribute to
contain at least 128 bits of randomness. This means that the
\"ice-ufrag\" attribute will be at least 4 characters long, and the
\"ice-pwd\" at least 22 characters long, since the grammar for these
attributes allows for 6 bits of information per character. The
attributes [MAY]{.bcp14} be longer than 4 and 22 characters,
respectively, of course, up to 256 characters. The upper limit allows
for buffer sizing in implementations. Its large upper limit allows for
increased amounts of randomness to be added over time. For compatibility
with the 512-character limitation for the STUN username attribute value
and for bandwidth conservation considerations, the \"ice-ufrag\"
attribute [MUST NOT]{.bcp14} be longer than 32 characters when sending,
but an implementation [MUST]{.bcp14} accept up to 256 characters when
receiving.[¶](#section-5.4-5){.pilcrow}

The following example shows sample \"ice-ufrag\" and \"ice-pwd\" SDP
lines:[¶](#section-5.4-6){.pilcrow}

::: {#section-5.4-7}
``` {.sourcecode .lang-sdp}
a=ice-pwd:asd88fgpdd777uzjYhagZg
a=ice-ufrag:8hhY
```

[¶](#section-5.4-7){.pilcrow}
:::
:::

::: {#section-5.5 .section}
### [5.5.](#section-5.5){.section-number .selfRef} [\"ice-pacing\" Attribute](#name-ice-pacing-attribute){.section-name .selfRef} {#name-ice-pacing-attribute}

The \"ice-pacing\" is a session-level attribute that indicates the
desired connectivity-check pacing (Ta interval), in milliseconds, that
the sender wishes to use. See [Section
14.2](https://www.rfc-editor.org/rfc/rfc8445#section-14.2){.relref} of
\[[RFC8445](#RFC8445){.xref}\] for more information regarding selecting
a pacing value. The syntax is:[¶](#section-5.5-1){.pilcrow}

::: {#section-5.5-2}
``` {.sourcecode .lang-abnf}
ice-pacing-att            = "ice-pacing:" pacing-value
pacing-value              = 1*10DIGIT
```

[¶](#section-5.5-2){.pilcrow}
:::

If absent in an offer or answer, the default value of the attribute is
50 ms, which is the recommended value specified in
\[[RFC8445](#RFC8445){.xref}\].[¶](#section-5.5-3){.pilcrow}

As defined in \[[RFC8445](#RFC8445){.xref}\], regardless of the Ta value
chosen for each agent, the combination of all transactions from all
agents (if a given implementation runs several concurrent agents) will
not be sent more often than once every 5
ms.[¶](#section-5.5-4){.pilcrow}

As defined in \[[RFC8445](#RFC8445){.xref}\], once both agents have
indicated the pacing value they want to use, both agents will use the
larger of the indicated values.[¶](#section-5.5-5){.pilcrow}

The following example shows an \"ice-pacing\" SDP line with value
\'50\':[¶](#section-5.5-6){.pilcrow}

::: {#section-5.5-7}
``` {.sourcecode .lang-sdp}
a=ice-pacing:50
```

[¶](#section-5.5-7){.pilcrow}
:::
:::

::: {#sec-ice-options}
::: {#section-5.6 .section}
### [5.6.](#section-5.6){.section-number .selfRef} [\"ice-options\" Attribute](#name-ice-options-attribute){.section-name .selfRef} {#name-ice-options-attribute}

The \"ice-options\" attribute is a session-level and media-level
attribute. It contains a series of tokens that identify the options
supported by the agent. Its grammar is:[¶](#section-5.6-1){.pilcrow}

::: {#section-5.6-2}
``` {.sourcecode .lang-abnf}
ice-options           = "ice-options:" ice-option-tag
                          *(SP ice-option-tag)
ice-option-tag        = 1*ice-char
```

[¶](#section-5.6-2){.pilcrow}
:::

The existence of an \"ice-options\" in an offer indicates that a certain
extension is supported by the agent, and it is willing to use it if the
peer agent also includes the same extension in the answer. There might
be further extension-specific negotiation needed between the agents that
determine how the extension gets used in a given session. The details of
the negotiation procedures, if present, [MUST]{.bcp14} be defined by the
specification defining the extension ([Section
10.2](#sec-iana-ice-options){.xref}).[¶](#section-5.6-3){.pilcrow}

The following example shows an \"ice-options\" SDP line with \'ice2\'
and \'rtp+ecn\' \[[RFC6679](#RFC6679){.xref}\]
values.[¶](#section-5.6-4){.pilcrow}

::: {#section-5.6-5}
``` {.sourcecode .lang-sdp}
a=ice-options:ice2 rtp+ecn
```

[¶](#section-5.6-5){.pilcrow}
:::
:::
:::
:::
:::

::: {#sec-keepalive}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Keepalives](#name-keepalives){.section-name .selfRef} {#name-keepalives}

All the ICE agents [MUST]{.bcp14} follow the procedures defined in
[Section 11](https://www.rfc-editor.org/rfc/rfc8445#section-11){.relref}
of \[[RFC8445](#RFC8445){.xref}\] for sending keepalives. As defined in
\[[RFC8445](#RFC8445){.xref}\], the keepalives will be sent regardless
of whether the data stream is currently inactive, sendonly, recvonly, or
sendrecv, and regardless of the presence or value of the bandwidth
attribute. An agent can determine that its peer supports ICE by the
presence of \"candidate\" attributes for each media
session.[¶](#section-6-1){.pilcrow}
:::
:::

::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [SIP Considerations](#name-sip-considerations){.section-name .selfRef} {#name-sip-considerations}

Note that ICE is not intended for NAT traversal for SIP signaling, which
is assumed to be provided via another mechanism
\[[RFC5626](#RFC5626){.xref}\].[¶](#section-7-1){.pilcrow}

When ICE is used with SIP, forking may result in a single offer
generating a multiplicity of answers. In that case, ICE proceeds
completely in parallel and independently for each answer, treating the
combination of its offer and each answer as an independent offer/answer
exchange, with its own set of local candidates, pairs, checklists,
states, and so on.[¶](#section-7-2){.pilcrow}

::: {#sec-latency}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Latency Guidelines](#name-latency-guidelines){.section-name .selfRef} {#name-latency-guidelines}

ICE requires a series of STUN-based connectivity checks to take place
between endpoints. These checks start from the answerer on generation of
its answer, and start from the offerer when it receives the answer.
These checks can take time to complete, and as such, the selection of
messages to use with offers and answers can affect perceived user
latency. Two latency figures are of particular interest. These are the
post-pickup delay and the post-dial delay. The post-pickup delay refers
to the time between when a user \"answers the phone\" and when any
speech they utter can be delivered to the caller. The post-dial delay
refers to the time between when a user enters the destination address
for the user and ringback begins as a consequence of having successfully
started alerting the called user agent.[¶](#section-7.1-1){.pilcrow}

Two cases can be considered \-- one where the offer is present in the
initial INVITE and one where it is in a
response.[¶](#section-7.1-2){.pilcrow}

::: {#section-7.1.1 .section}
#### [7.1.1.](#section-7.1.1){.section-number .selfRef} [Offer in INVITE](#name-offer-in-invite){.section-name .selfRef} {#name-offer-in-invite}

To reduce post-dial delays, it is [RECOMMENDED]{.bcp14} that the caller
begin gathering candidates prior to actually sending its initial INVITE,
so that the candidates can be provided in the INVITE. This can be
started upon user interface cues that a call is pending, such as
activity on a keypad or the phone going
off-hook.[¶](#section-7.1.1-1){.pilcrow}

On the receipt of the offer, the answerer [SHOULD]{.bcp14} generate an
answer in a provisional response as soon as it has completed gathering
the candidates. ICE requires that a provisional response with an SDP be
transmitted reliably. This can be done through the existing Provisional
Response Acknowledgment (PRACK) mechanism \[[RFC3262](#RFC3262){.xref}\]
or through an ICE-specific optimization, wherein, the agent retransmits
the provisional response with the exponential backoff timers described
in \[[RFC3262](#RFC3262){.xref}\]. Such retransmissions [MUST]{.bcp14}
cease on receipt of a STUN Binding request with the transport address
matching the candidate address for one of the data streams signaled in
that SDP or on transmission of the answer in a 2xx response. If no
Binding request is received prior to the last retransmit, the agent does
not consider the session terminated. For the ICE-lite peers, the agent
[MUST]{.bcp14} cease retransmitting the 18x response after sending it
four times since there will be no Binding request sent, and the number
four is arbitrarily chosen to limit the number of 18x
retransmits.[¶](#section-7.1.1-2){.pilcrow}

Once the answer has been sent, the agent [SHOULD]{.bcp14} begin its
connectivity checks. Once candidate pairs for each component of a data
stream enter the valid list, the answerer can begin sending media on
that data stream.[¶](#section-7.1.1-3){.pilcrow}

However, prior to this point, any media that needs to be sent towards
the caller (such as SIP early media \[[RFC3960](#RFC3960){.xref}\])
[MUST NOT]{.bcp14} be transmitted. For this reason, implementations
[SHOULD]{.bcp14} delay alerting the called party until candidates for
each component of each data stream have entered the valid list. In the
case of a PSTN gateway, this would mean that the setup message into the
PSTN is delayed until this point. Doing this increases the post-dial
delay, but has the effect of eliminating \'ghost rings\'. Ghost rings
are cases where the called party hears the phone ring, picks up, but
hears nothing and cannot be heard. This technique works without
requiring support for, or usage of, preconditions
\[[RFC3312](#RFC3312){.xref}\]. It also has the benefit of guaranteeing
that not a single packet of media will get clipped, so that post-pickup
delay is zero. If an agent chooses to delay local alerting in this way,
it [SHOULD]{.bcp14} generate a 180 response once alerting
begins.[¶](#section-7.1.1-4){.pilcrow}
:::

::: {#section-7.1.2 .section}
#### [7.1.2.](#section-7.1.2){.section-number .selfRef} [Offer in Response](#name-offer-in-response){.section-name .selfRef} {#name-offer-in-response}

In addition to uses where the offer is in an INVITE, and the answer is
in the provisional and/or 200 OK response, ICE works with cases where
the offer appears in the response. In such cases, which are common in
third party call control \[[RFC3725](#RFC3725){.xref}\], ICE agents
[SHOULD]{.bcp14} generate their offers in a reliable provisional
response (which [MUST]{.bcp14} utilize \[[RFC3262](#RFC3262){.xref}\]),
and not alert the user on receipt of the INVITE. The answer will arrive
in a PRACK. This allows for ICE processing to take place prior to
alerting, so that there is no post-pickup delay, at the expense of
increased call setup delays. Once ICE completes, the callee can alert
the user and then generate a 200 OK when they answer. The 200 OK would
contain no SDP, since the offer/answer exchange has
completed.[¶](#section-7.1.2-1){.pilcrow}

Alternatively, agents [MAY]{.bcp14} place the offer in a 2xx instead (in
which case the answer comes in the ACK). When this happens, the callee
will alert the user on receipt of the INVITE, and the ICE exchanges will
take place only after the user answers. This has the effect of reducing
call-setup delay, but can cause substantial post-pickup delays and media
clipping.[¶](#section-7.1.2-2){.pilcrow}
:::
:::
:::

::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [SIP Option Tags and Media Feature Tags](#name-sip-option-tags-and-media-f){.section-name .selfRef} {#name-sip-option-tags-and-media-f}

\[[RFC5768](#RFC5768){.xref}\] specifies a SIP option tag and media
feature tag for usage with ICE. ICE implementations using SIP
[SHOULD]{.bcp14} support this specification, which uses a feature tag in
registrations to facilitate interoperability through signaling
intermediaries.[¶](#section-7.2-1){.pilcrow}
:::

::: {#section-7.3 .section}
### [7.3.](#section-7.3){.section-number .selfRef} [Interactions with Forking](#name-interactions-with-forking){.section-name .selfRef} {#name-interactions-with-forking}

ICE interacts very well with forking. Indeed, ICE fixes some of the
problems associated with forking. Without ICE, when a call forks and the
caller receives multiple incoming data streams, it cannot determine
which data stream corresponds to which
callee.[¶](#section-7.3-1){.pilcrow}

With ICE, this problem is resolved. The connectivity checks which occur
prior to transmission of media carry username fragments which in turn
are correlated to a specific callee. Subsequent media packets that
arrive on the same candidate pair as the connectivity check will be
associated with that same callee. Thus, the caller can perform this
correlation as long as it has received an
answer.[¶](#section-7.3-2){.pilcrow}
:::

::: {#section-7.4 .section}
### [7.4.](#section-7.4){.section-number .selfRef} [Interactions with Preconditions](#name-interactions-with-precondit){.section-name .selfRef} {#name-interactions-with-precondit}

Quality of Service (QoS) preconditions, which are defined in
\[[RFC3312](#RFC3312){.xref}\] and \[[RFC4032](#RFC4032){.xref}\], apply
only to the transport addresses listed as the default targets for media
in an offer/answer. If ICE changes the transport address where media is
received, this change is reflected in an updated offer that changes the
default destination for media to match ICE\'s selection. As such, it
appears like any other re-INVITE would, and is fully treated in RFCs
3312 and 4032, which apply without regard to the fact that the
destination for media is changing due to ICE negotiations occurring \"in
the background\".[¶](#section-7.4-1){.pilcrow}

Indeed, an agent [SHOULD NOT]{.bcp14} indicate that QoS preconditions
have been met until the checks have completed and selected the candidate
pairs to be used for media.[¶](#section-7.4-2){.pilcrow}

ICE also has interactions with connectivity preconditions
\[[RFC5898](#RFC5898){.xref}\]. Those interactions are described there.
Note that the procedures described in [Section 7.1](#sec-latency){.xref}
describe their own type of \"preconditions\", albeit with less
functionality than those provided by the explicit preconditions in
\[[RFC5898](#RFC5898){.xref}\].[¶](#section-7.4-3){.pilcrow}
:::

::: {#section-7.5 .section}
### [7.5.](#section-7.5){.section-number .selfRef} [Interactions with Third Party Call Control](#name-interactions-with-third-par){.section-name .selfRef} {#name-interactions-with-third-par}

ICE works with Flows I, III, and IV as described in
\[[RFC3725](#RFC3725){.xref}\]. Flow I works without the controller
supporting or being aware of ICE. Flow IV will work as long as the
controller passes along the ICE attributes without alteration. Flow II
is fundamentally incompatible with ICE; each agent will believe itself
to be the answerer and thus never generate a
re-INVITE.[¶](#section-7.5-1){.pilcrow}

The flows for continued operation, as described in [Section
7](https://www.rfc-editor.org/rfc/rfc3725#section-7){.relref} of
\[[RFC3725](#RFC3725){.xref}\], require additional behavior of ICE
implementations to support. In particular, if an agent receives a
mid-dialog re-INVITE that contains no offer, it [MUST]{.bcp14} restart
ICE for each data stream and go through the process of gathering new
candidates. Furthermore, that list of candidates [SHOULD]{.bcp14}
include the ones currently being used for
media.[¶](#section-7.5-2){.pilcrow}
:::
:::

::: {#sec-alg-sip}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Interactions with Application Layer Gateways and SIP](#name-interactions-with-applicati){.section-name .selfRef} {#name-interactions-with-applicati}

Application Layer Gateways (ALGs) are functions present in a Network
Address Translation (NAT) device that inspect the contents of packets
and modify them, in order to facilitate NAT traversal for application
protocols. Session Border Controllers (SBCs) are close cousins of ALGs,
but are less transparent since they actually exist as application-layer
SIP intermediaries. ICE has interactions with SBCs and
ALGs.[¶](#section-8-1){.pilcrow}

If an ALG is SIP aware but not ICE aware, ICE will work through it as
long as the ALG correctly modifies the SDP. A correct ALG implementation
behaves as follows:[¶](#section-8-2){.pilcrow}

-   [The ALG does not modify the \"m=\" and \"c=\" lines or the \"rtcp\"
    attribute if they contain external
    addresses.[¶](#section-8-3.1){.pilcrow}]{#section-8-3.1}

-   ::: {#section-8-3.2}
    If the \"m=\" and \"c=\" lines contain internal addresses, the
    modification depends on the state of the
    ALG:[¶](#section-8-3.2.1){.pilcrow}

    -   [If the ALG already has a binding established that maps an
        external port to an internal connection address and port
        matching the values in the \"m=\" and \"c=\" lines or \"rtcp\"
        attribute, the ALG uses that binding instead of creating a new
        one.[¶](#section-8-3.2.2.1){.pilcrow}]{#section-8-3.2.2.1}
    -   [If the ALG does not already have a binding, it creates a new
        one and modifies the SDP, rewriting the \"m=\" and \"c=\" lines
        and \"rtcp\"
        attribute.[¶](#section-8-3.2.2.2){.pilcrow}]{#section-8-3.2.2.2}
    :::

Unfortunately, many ALGs are known to work poorly in these corner cases.
ICE does not try to work around broken ALGs, as this is outside the
scope of its functionality. ICE can help diagnose these conditions,
which often show up as a mismatch between the set of candidates and the
\"m=\" and \"c=\" lines and \"rtcp\" attributes. The \"ice-mismatch\"
attribute is used for this purpose.[¶](#section-8-4){.pilcrow}

ICE works best through ALGs when the signaling is run over TLS. This
prevents the ALG from manipulating the SDP messages and interfering with
ICE operation. Implementations that are expected to be deployed behind
ALGs [SHOULD]{.bcp14} provide for TLS transport of the
SDP.[¶](#section-8-5){.pilcrow}

If an SBC is SIP aware but not ICE aware, the result depends on the
behavior of the SBC. If it is acting as a proper Back-to-Back User Agent
(B2BUA), the SBC will remove any SDP attributes it doesn\'t understand,
including the ICE attributes. Consequently, the call will appear to both
endpoints as if the other side doesn\'t support ICE. This will result in
ICE being disabled, and media flowing through the SBC, if the SBC has
requested it. If, however, the SBC passes the ICE attributes without
modification, yet modifies the default destination for media (contained
in the \"m=\" and \"c=\" lines and \"rtcp\" attribute), this will be
detected as an ICE mismatch, and ICE processing is aborted for the call.
It is outside of the scope of ICE for it to act as a tool for \"working
around\" SBCs. If one is present, ICE will not be used and the SBC
techniques take precedence.[¶](#section-8-6){.pilcrow}
:::
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

The generic ICE security considerations are defined in
\[[RFC8445](#RFC8445){.xref}\], and the generic SDP offer/answer
security considerations are defined in \[[RFC3264](#RFC3264){.xref}\].
These security considerations also apply to implementations of this
document.[¶](#section-9-1){.pilcrow}

::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [IP Address Privacy](#name-ip-address-privacy){.section-name .selfRef} {#name-ip-address-privacy}

In some cases, e.g., for privacy reasons, an agent may not want to
reveal the related address and port. In this case the address
[MUST]{.bcp14} be set to \"0.0.0.0\" (for IPv4 candidates) or \"::\"
(for IPv6 candidates) and the port to
\'9\'.[¶](#section-9.1-1){.pilcrow}
:::

::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Attacks on the Offer/Answer Exchanges](#name-attacks-on-the-offer-answer){.section-name .selfRef} {#name-attacks-on-the-offer-answer}

An attacker that can modify or disrupt the offer/answer exchanges
themselves can readily launch a variety of attacks with ICE. They could
direct media to a target of a DoS attack, they could insert themselves
into the data stream, and so on. These are similar to the general
security considerations for offer/answer exchanges, and the security
considerations in \[[RFC3264](#RFC3264){.xref}\] apply. These require
techniques for message integrity and encryption for offers and answers,
which are satisfied by the TLS mechanism \[[RFC3261](#RFC3261){.xref}\]
when SIP is used. As such, the usage of TLS with ICE is
[RECOMMENDED]{.bcp14}.[¶](#section-9.2-1){.pilcrow}
:::

::: {#sec-voice-hammer}
::: {#section-9.3 .section}
### [9.3.](#section-9.3){.section-number .selfRef} [The Voice Hammer Attack](#name-the-voice-hammer-attack){.section-name .selfRef} {#name-the-voice-hammer-attack}

The voice hammer attack is an amplification attack, and can be triggered
even if the attacker is an authenticated and valid participant in a
session. In this attack, the attacker initiates sessions to other
agents, and maliciously includes the connection address and port of a
DoS target as the destination for media traffic signaled in the SDP.
This causes substantial amplification; a single offer/answer exchange
can create a continuing flood of media packets, possibly at high rates
(consider video sources). The use of ICE can help to prevent against
this attack.[¶](#section-9.3-1){.pilcrow}

Specifically, if ICE is used, the agent receiving the malicious SDP will
first perform connectivity checks to the target of media before sending
media there. If this target is a third-party host, the checks will not
succeed, and media is never sent. The ICE extension defined in
\[[RFC7675](#RFC7675){.xref}\] can be used to further protect against
voice hammer attacks.[¶](#section-9.3-2){.pilcrow}

Unfortunately, ICE doesn\'t help if it\'s not used, in which case an
attacker could simply send the offer without the ICE parameters.
However, in environments where the set of clients is known, and is
limited to ones that support ICE, the server can reject any offers or
answers that don\'t indicate ICE support.[¶](#section-9.3-3){.pilcrow}

SIP user agents (UA) \[[RFC3261](#RFC3261){.xref}\] that are not willing
to receive non-ICE answers [MUST]{.bcp14} include an \"ice\" option tag
\[[RFC5768](#RFC5768){.xref}\] in the SIP Require header field in their
offer. UAs that reject non-ICE offers will generally use a 421 response
code, together with an option tag \"ice\" in the Require header field in
the response.[¶](#section-9.3-4){.pilcrow}
:::
:::
:::

::: {#iana}
::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

::: {#section-10.1 .section}
### [10.1.](#section-10.1){.section-number .selfRef} [SDP Attributes](#name-sdp-attributes){.section-name .selfRef} {#name-sdp-attributes}

The original ICE specification defined seven new SDP attributes per the
procedures of [Section
8.2.4](https://www.rfc-editor.org/rfc/rfc4566#section-8.2.4){.relref} of
\[[RFC4566](#RFC4566){.xref}\]. The registration information from the
original specification is included here with modifications to include
Mux Category \[[RFC8859](#RFC8859){.xref}\] and also defines a new SDP
attribute \"ice-pacing\".[¶](#section-10.1-1){.pilcrow}

::: {#section-10.1.1 .section}
#### [10.1.1.](#section-10.1.1){.section-number .selfRef} [\"candidate\" Attribute](#name-candidate-attribute-2){.section-name .selfRef} {#name-candidate-attribute-2}

[]{.break}

Attribute Name:
:   candidate[¶](#section-10.1.1-1.2){.pilcrow}
:   

Type of Attribute:
:   media-level[¶](#section-10.1.1-1.4){.pilcrow}
:   

Subject to charset:
:   No[¶](#section-10.1.1-1.6){.pilcrow}
:   

Purpose:
:   This attribute is used with Interactive Connectivity Establishment
    (ICE), and provides one of many possible candidate addresses for
    communication. These addresses are validated with an end-to-end
    connectivity check using Session Traversal Utilities for NAT
    (STUN).[¶](#section-10.1.1-1.8){.pilcrow}
:   

Appropriate Values:
:   See [Section 5](#sec-grammar){.xref} of RFC
    8839.[¶](#section-10.1.1-1.10){.pilcrow}
:   

Contact Name:
:   IESG[¶](#section-10.1.1-1.12){.pilcrow}
:   

Contact Email:
:   iesg\@ietf.org[¶](#section-10.1.1-1.14){.pilcrow}
:   

Reference:
:   RFC 8839[¶](#section-10.1.1-1.16){.pilcrow}
:   

Mux Category:
:   TRANSPORT[¶](#section-10.1.1-1.18){.pilcrow}
:   
:::

::: {#section-10.1.2 .section}
#### [10.1.2.](#section-10.1.2){.section-number .selfRef} [\"remote-candidates\" Attribute](#name-remote-candidates-attribute-2){.section-name .selfRef} {#name-remote-candidates-attribute-2}

[]{.break}

Attribute Name:
:   remote-candidates[¶](#section-10.1.2-1.2){.pilcrow}
:   

Type of Attribute:
:   media-level[¶](#section-10.1.2-1.4){.pilcrow}
:   

Subject to charset:
:   No[¶](#section-10.1.2-1.6){.pilcrow}
:   

Purpose:
:   This attribute is used with Interactive Connectivity Establishment
    (ICE), and provides the identity of the remote candidates that the
    offerer wishes the answerer to use in its
    answer.[¶](#section-10.1.2-1.8){.pilcrow}
:   

Appropriate Values:
:   See [Section 5](#sec-grammar){.xref} of RFC
    8839.[¶](#section-10.1.2-1.10){.pilcrow}
:   

Contact Name:
:   IESG[¶](#section-10.1.2-1.12){.pilcrow}
:   

Contact Email:
:   iesg\@ietf.org[¶](#section-10.1.2-1.14){.pilcrow}
:   

Reference:
:   RFC 8839[¶](#section-10.1.2-1.16){.pilcrow}
:   

Mux Category:
:   TRANSPORT[¶](#section-10.1.2-1.18){.pilcrow}
:   
:::

::: {#section-10.1.3 .section}
#### [10.1.3.](#section-10.1.3){.section-number .selfRef} [\"ice-lite\" Attribute](#name-ice-lite-attribute){.section-name .selfRef} {#name-ice-lite-attribute}

[]{.break}

Attribute Name:
:   ice-lite[¶](#section-10.1.3-1.2){.pilcrow}
:   

Type of Attribute:
:   session-level[¶](#section-10.1.3-1.4){.pilcrow}
:   

Subject to charset:
:   No[¶](#section-10.1.3-1.6){.pilcrow}
:   

Purpose:
:   This attribute is used with Interactive Connectivity Establishment
    (ICE), and indicates that an agent has the minimum functionality
    required to support ICE inter-operation with a peer that has a full
    implementation.[¶](#section-10.1.3-1.8){.pilcrow}
:   

Appropriate Values:
:   See [Section 5](#sec-grammar){.xref} of RFC
    8839.[¶](#section-10.1.3-1.10){.pilcrow}
:   

Contact Name:
:   IESG[¶](#section-10.1.3-1.12){.pilcrow}
:   

Contact Email:
:   iesg\@ietf.org[¶](#section-10.1.3-1.14){.pilcrow}
:   

Reference:
:   RFC 8839[¶](#section-10.1.3-1.16){.pilcrow}
:   

Mux Category:
:   NORMAL[¶](#section-10.1.3-1.18){.pilcrow}
:   
:::

::: {#section-10.1.4 .section}
#### [10.1.4.](#section-10.1.4){.section-number .selfRef} [\"ice-mismatch\" Attribute](#name-ice-mismatch-attribute){.section-name .selfRef} {#name-ice-mismatch-attribute}

[]{.break}

Attribute Name:
:   ice-mismatch[¶](#section-10.1.4-1.2){.pilcrow}
:   

Type of Attribute:
:   media-level[¶](#section-10.1.4-1.4){.pilcrow}
:   

Subject to charset:
:   No[¶](#section-10.1.4-1.6){.pilcrow}
:   

Purpose:
:   This attribute is used with Interactive Connectivity Establishment
    (ICE), and indicates that an agent is ICE capable, but did not
    proceed with ICE due to a mismatch of candidates with the default
    destination for media signaled in the
    SDP.[¶](#section-10.1.4-1.8){.pilcrow}
:   

Appropriate Values:
:   See [Section 5](#sec-grammar){.xref} of RFC
    8839.[¶](#section-10.1.4-1.10){.pilcrow}
:   

Contact Name:
:   IESG[¶](#section-10.1.4-1.12){.pilcrow}
:   

Contact e-mail:
:   iesg\@ietf.org[¶](#section-10.1.4-1.14){.pilcrow}
:   

Reference:
:   RFC 8839[¶](#section-10.1.4-1.16){.pilcrow}
:   

Mux Category:
:   NORMAL[¶](#section-10.1.4-1.18){.pilcrow}
:   
:::

::: {#section-10.1.5 .section}
#### [10.1.5.](#section-10.1.5){.section-number .selfRef} [\"ice-pwd\" Attribute](#name-ice-pwd-attribute){.section-name .selfRef} {#name-ice-pwd-attribute}

[]{.break}

Attribute Name:
:   ice-pwd[¶](#section-10.1.5-1.2){.pilcrow}
:   

Type of Attribute:
:   session- or media-level[¶](#section-10.1.5-1.4){.pilcrow}
:   

Subject to charset:
:   No[¶](#section-10.1.5-1.6){.pilcrow}
:   

Purpose:
:   This attribute is used with Interactive Connectivity Establishment
    (ICE), and provides the password used to protect STUN connectivity
    checks.[¶](#section-10.1.5-1.8){.pilcrow}
:   

Appropriate Values:
:   See [Section 5](#sec-grammar){.xref} of RFC
    8839.[¶](#section-10.1.5-1.10){.pilcrow}
:   

Contact Name:
:   IESG[¶](#section-10.1.5-1.12){.pilcrow}
:   

Contact e-mail:
:   iesg\@ietf.org[¶](#section-10.1.5-1.14){.pilcrow}
:   

Reference:
:   RFC 8839[¶](#section-10.1.5-1.16){.pilcrow}
:   

Mux Category:
:   TRANSPORT[¶](#section-10.1.5-1.18){.pilcrow}
:   
:::

::: {#section-10.1.6 .section}
#### [10.1.6.](#section-10.1.6){.section-number .selfRef} [\"ice-ufrag\" Attribute](#name-ice-ufrag-attribute){.section-name .selfRef} {#name-ice-ufrag-attribute}

[]{.break}

Attribute Name:
:   ice-ufrag[¶](#section-10.1.6-1.2){.pilcrow}
:   

Type of Attribute:
:   session- or media-level[¶](#section-10.1.6-1.4){.pilcrow}
:   

Subject to charset:
:   No[¶](#section-10.1.6-1.6){.pilcrow}
:   

Purpose:
:   This attribute is used with Interactive Connectivity Establishment
    (ICE), and provides the fragments used to construct the username in
    STUN connectivity checks.[¶](#section-10.1.6-1.8){.pilcrow}
:   

Appropriate Values:
:   See [Section 5](#sec-grammar){.xref} of RFC
    8839.[¶](#section-10.1.6-1.10){.pilcrow}
:   

Contact Name:
:   IESG[¶](#section-10.1.6-1.12){.pilcrow}
:   

Contact e-mail:
:   iesg\@ietf.org[¶](#section-10.1.6-1.14){.pilcrow}
:   

Reference:
:   RFC 8839[¶](#section-10.1.6-1.16){.pilcrow}
:   

Mux Category:
:   TRANSPORT[¶](#section-10.1.6-1.18){.pilcrow}
:   
:::

::: {#section-10.1.7 .section}
#### [10.1.7.](#section-10.1.7){.section-number .selfRef} [\"ice-options\" Attribute](#name-ice-options-attribute-2){.section-name .selfRef} {#name-ice-options-attribute-2}

[]{.break}

Attribute Name:
:   ice-options[¶](#section-10.1.7-1.2){.pilcrow}
:   

Long Form:
:   ice-options[¶](#section-10.1.7-1.4){.pilcrow}
:   

Type of Attribute:
:   session-level[¶](#section-10.1.7-1.6){.pilcrow}
:   

Subject to charset:
:   No[¶](#section-10.1.7-1.8){.pilcrow}
:   

Purpose:
:   This attribute is used with Interactive Connectivity Establishment
    (ICE), and indicates the ICE options or extensions used by the
    agent.[¶](#section-10.1.7-1.10){.pilcrow}
:   

Appropriate Values:
:   See [Section 5](#sec-grammar){.xref} of RFC
    8839.[¶](#section-10.1.7-1.12){.pilcrow}
:   

Contact Name:
:   IESG[¶](#section-10.1.7-1.14){.pilcrow}
:   

Contact e-mail:
:   iesg\@ietf.org[¶](#section-10.1.7-1.16){.pilcrow}
:   

Reference:
:   RFC 8839[¶](#section-10.1.7-1.18){.pilcrow}
:   

Mux Category:
:   NORMAL[¶](#section-10.1.7-1.20){.pilcrow}
:   
:::

::: {#section-10.1.8 .section}
#### [10.1.8.](#section-10.1.8){.section-number .selfRef} [\"ice-pacing\" Attribute](#name-ice-pacing-attribute-2){.section-name .selfRef} {#name-ice-pacing-attribute-2}

This specification also defines a new SDP attribute, \"ice-pacing\",
according to the following data:[¶](#section-10.1.8-1){.pilcrow}

[]{.break}

Attribute Name:
:   ice-pacing[¶](#section-10.1.8-2.2){.pilcrow}
:   

Type of Attribute:
:   session-level[¶](#section-10.1.8-2.4){.pilcrow}
:   

Subject to charset:
:   No[¶](#section-10.1.8-2.6){.pilcrow}
:   

Purpose:
:   This attribute is used with Interactive Connectivity Establishment
    (ICE) to indicate desired connectivity check pacing
    values.[¶](#section-10.1.8-2.8){.pilcrow}
:   

Appropriate Values:
:   See [Section 5](#sec-grammar){.xref} of RFC
    8839.[¶](#section-10.1.8-2.10){.pilcrow}
:   

Contact Name:
:   IESG[¶](#section-10.1.8-2.12){.pilcrow}
:   

Contact e-mail:
:   iesg\@ietf.org[¶](#section-10.1.8-2.14){.pilcrow}
:   

Reference:
:   RFC 8839[¶](#section-10.1.8-2.16){.pilcrow}
:   

Mux Category:
:   NORMAL[¶](#section-10.1.8-2.18){.pilcrow}
:   
:::
:::

::: {#sec-iana-ice-options}
::: {#section-10.2 .section}
### [10.2.](#section-10.2){.section-number .selfRef} [Interactive Connectivity Establishment (ICE) Options Registry](#name-interactive-connectivity-es){.section-name .selfRef} {#name-interactive-connectivity-es}

IANA maintains a registry for \"ice-options\" identifiers under the
Specification Required policy as defined in \"Guidelines for Writing an
IANA Considerations Section in RFCs\"
\[[RFC8126](#RFC8126){.xref}\].[¶](#section-10.2-1){.pilcrow}

ICE options are of unlimited length according to the syntax in [Section
5.6](#sec-ice-options){.xref}; however, they are [RECOMMENDED]{.bcp14}
to be no longer than 20 characters. This is to reduce message sizes and
allow for efficient parsing. ICE options are defined at the session
level.[¶](#section-10.2-2){.pilcrow}

A registration request [MUST]{.bcp14} include the following
information:[¶](#section-10.2-3){.pilcrow}

-   [The ICE option identifier to be
    registered[¶](#section-10.2-4.1){.pilcrow}]{#section-10.2-4.1}
-   [Name and email address of organization or individuals having change
    control[¶](#section-10.2-4.2){.pilcrow}]{#section-10.2-4.2}
-   [Short description of the ICE extension to which the option
    relates[¶](#section-10.2-4.3){.pilcrow}]{#section-10.2-4.3}
-   [Reference(s) to the specification defining the ICE option and the
    related
    extensions[¶](#section-10.2-4.4){.pilcrow}]{#section-10.2-4.4}
:::
:::

::: {#sec-iana-cand-ext}
::: {#section-10.3 .section}
### [10.3.](#section-10.3){.section-number .selfRef} [Candidate Attribute Extension Subregistry Establishment](#name-candidate-attribute-extensi){.section-name .selfRef} {#name-candidate-attribute-extensi}

This section creates a new subregistry, \"Candidate Attribute
Extensions\", under the SDP Parameters registry:
[http://www.iana.org/assignments/sdp-parameters](https://www.iana.org/assignments/sdp-parameters).[¶](#section-10.3-1){.pilcrow}

The purpose of the subregistry is to register SDP \"candidate\"
attribute extensions.[¶](#section-10.3-2){.pilcrow}

When a \"candidate\" extension is registered in the subregistry, it
needs to meet the \"Specification Required\" policies defined in
\[[RFC8126](#RFC8126){.xref}\].[¶](#section-10.3-3){.pilcrow}

\"candidate\" attribute extensions [MUST]{.bcp14} follow the
\'cand-extension\' syntax. The attribute extension name [MUST]{.bcp14}
follow the \'extension-att-name\' syntax, and the attribute extension
value [MUST]{.bcp14} follow the \'extension-att-value\'
syntax.[¶](#section-10.3-4){.pilcrow}

A registration request [MUST]{.bcp14} include the following
information:[¶](#section-10.3-5){.pilcrow}

-   [The name of the attribute
    extension.[¶](#section-10.3-6.1){.pilcrow}]{#section-10.3-6.1}
-   [Name and email address of organization or individuals having change
    control[¶](#section-10.3-6.2){.pilcrow}]{#section-10.3-6.2}
-   [A short description of the attribute
    extension.[¶](#section-10.3-6.3){.pilcrow}]{#section-10.3-6.3}
-   [A reference to a specification that describes the semantics, usage
    and possible values of the attribute
    extension.[¶](#section-10.3-6.4){.pilcrow}]{#section-10.3-6.4}
:::
:::
:::
:::

::: {#sec.5245}
::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [Changes from RFC 5245](#name-changes-from-rfc-5245){.section-name .selfRef} {#name-changes-from-rfc-5245}

\[[RFC8445](#RFC8445){.xref}\] describes the changes made to the common
SIP procedures, including removal of aggressive nomination, modifying
the procedures for calculating candidate pair states, scheduling
connectivity checks, and the calculation of timer
values.[¶](#section-11-1){.pilcrow}

This document defines the following SDP offer/answer specific
changes:[¶](#section-11-2){.pilcrow}

-   [SDP offer/answer realization and usage of \'ice2\'
    option.[¶](#section-11-3.1){.pilcrow}]{#section-11-3.1}
-   [Definition and usage of SDP \"ice-pacing\"
    attribute.[¶](#section-11-3.2){.pilcrow}]{#section-11-3.2}
-   [Explicit text that an ICE agent must not generate candidates with
    FQDNs, and must discard such candidates if received from the peer
    agent.[¶](#section-11-3.3){.pilcrow}]{#section-11-3.3}
-   [Relax requirement to include SDP \"rtcp\"
    attribute.[¶](#section-11-3.4){.pilcrow}]{#section-11-3.4}
-   [Generic clarifications of SDP offer/answer
    procedures.[¶](#section-11-3.5){.pilcrow}]{#section-11-3.5}
-   [ICE mismatch is now optional, and an agent has an option to not
    trigger mismatch and instead treat the default candidate as an
    additional
    candidate.[¶](#section-11-3.6){.pilcrow}]{#section-11-3.6}
-   [FQDNs and \"0.0.0.0\"/\"::\" IP addresses with port \"9\" default
    candidates do not trigger ICE
    mismatch.[¶](#section-11-3.7){.pilcrow}]{#section-11-3.7}
:::
:::

::: {#section-12 .section}
## [12.](#section-12){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-12.1 .section}
### [12.1.](#section-12.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC3261\]
:   [Rosenberg, J.]{.refAuthor}[, Schulzrinne, H.]{.refAuthor}[,
    Camarillo, G.]{.refAuthor}[, Johnston, A.]{.refAuthor}[,
    Peterson, J.]{.refAuthor}[, Sparks, R.]{.refAuthor}[,
    Handley, M.]{.refAuthor}[, and E. Schooler]{.refAuthor}, [\"SIP:
    Session Initiation Protocol\"]{.refTitle}, [RFC 3261]{.seriesInfo},
    [DOI 10.17487/RFC3261]{.seriesInfo}, June 2002,
    \<<https://www.rfc-editor.org/info/rfc3261>\>.
:   

\[RFC3262\]
:   [Rosenberg, J.]{.refAuthor}[ and H. Schulzrinne]{.refAuthor},
    [\"Reliability of Provisional Responses in Session Initiation
    Protocol (SIP)\"]{.refTitle}, [RFC 3262]{.seriesInfo}, [DOI
    10.17487/RFC3262]{.seriesInfo}, June 2002,
    \<<https://www.rfc-editor.org/info/rfc3262>\>.
:   

\[RFC3264\]
:   [Rosenberg, J.]{.refAuthor}[ and H. Schulzrinne]{.refAuthor}, [\"An
    Offer/Answer Model with Session Description Protocol
    (SDP)\"]{.refTitle}, [RFC 3264]{.seriesInfo}, [DOI
    10.17487/RFC3264]{.seriesInfo}, June 2002,
    \<<https://www.rfc-editor.org/info/rfc3264>\>.
:   

\[RFC3312\]
:   [Camarillo, G., Ed.]{.refAuthor}[, Marshall, W., Ed.]{.refAuthor}[,
    and J. Rosenberg]{.refAuthor}, [\"Integration of Resource Management
    and Session Initiation Protocol (SIP)\"]{.refTitle}, [RFC
    3312]{.seriesInfo}, [DOI 10.17487/RFC3312]{.seriesInfo}, October
    2002, \<<https://www.rfc-editor.org/info/rfc3312>\>.
:   

\[RFC3556\]
:   [Casner, S.]{.refAuthor}, [\"Session Description Protocol (SDP)
    Bandwidth Modifiers for RTP Control Protocol (RTCP)
    Bandwidth\"]{.refTitle}, [RFC 3556]{.seriesInfo}, [DOI
    10.17487/RFC3556]{.seriesInfo}, July 2003,
    \<<https://www.rfc-editor.org/info/rfc3556>\>.
:   

\[RFC3605\]
:   [Huitema, C.]{.refAuthor}, [\"Real Time Control Protocol (RTCP)
    attribute in Session Description Protocol (SDP)\"]{.refTitle}, [RFC
    3605]{.seriesInfo}, [DOI 10.17487/RFC3605]{.seriesInfo}, October
    2003, \<<https://www.rfc-editor.org/info/rfc3605>\>.
:   

\[RFC4032\]
:   [Camarillo, G.]{.refAuthor}[ and P. Kyzivat]{.refAuthor}, [\"Update
    to the Session Initiation Protocol (SIP) Preconditions
    Framework\"]{.refTitle}, [RFC 4032]{.seriesInfo}, [DOI
    10.17487/RFC4032]{.seriesInfo}, March 2005,
    \<<https://www.rfc-editor.org/info/rfc4032>\>.
:   

\[RFC4566\]
:   [Handley, M.]{.refAuthor}[, Jacobson, V.]{.refAuthor}[, and C.
    Perkins]{.refAuthor}, [\"SDP: Session Description
    Protocol\"]{.refTitle}, [RFC 4566]{.seriesInfo}, [DOI
    10.17487/RFC4566]{.seriesInfo}, July 2006,
    \<<https://www.rfc-editor.org/info/rfc4566>\>.
:   

\[RFC5234\]
:   [Crocker, D., Ed.]{.refAuthor}[ and P. Overell]{.refAuthor},
    [\"Augmented BNF for Syntax Specifications: ABNF\"]{.refTitle}, [STD
    68]{.seriesInfo}, [RFC 5234]{.seriesInfo}, [DOI
    10.17487/RFC5234]{.seriesInfo}, January 2008,
    \<<https://www.rfc-editor.org/info/rfc5234>\>.
:   

\[RFC5389\]
:   [Rosenberg, J.]{.refAuthor}[, Mahy, R.]{.refAuthor}[,
    Matthews, P.]{.refAuthor}[, and D. Wing]{.refAuthor}, [\"Session
    Traversal Utilities for NAT (STUN)\"]{.refTitle}, [RFC
    5389]{.seriesInfo}, [DOI 10.17487/RFC5389]{.seriesInfo}, October
    2008, \<<https://www.rfc-editor.org/info/rfc5389>\>.
:   

\[RFC5766\]
:   [Mahy, R.]{.refAuthor}[, Matthews, P.]{.refAuthor}[, and J.
    Rosenberg]{.refAuthor}, [\"Traversal Using Relays around NAT (TURN):
    Relay Extensions to Session Traversal Utilities for NAT
    (STUN)\"]{.refTitle}, [RFC 5766]{.seriesInfo}, [DOI
    10.17487/RFC5766]{.seriesInfo}, April 2010,
    \<<https://www.rfc-editor.org/info/rfc5766>\>.
:   

\[RFC5768\]
:   [Rosenberg, J.]{.refAuthor}, [\"Indicating Support for Interactive
    Connectivity Establishment (ICE) in the Session Initiation Protocol
    (SIP)\"]{.refTitle}, [RFC 5768]{.seriesInfo}, [DOI
    10.17487/RFC5768]{.seriesInfo}, April 2010,
    \<<https://www.rfc-editor.org/info/rfc5768>\>.
:   

\[RFC6336\]
:   [Westerlund, M.]{.refAuthor}[ and C. Perkins]{.refAuthor}, [\"IANA
    Registry for Interactive Connectivity Establishment (ICE)
    Options\"]{.refTitle}, [RFC 6336]{.seriesInfo}, [DOI
    10.17487/RFC6336]{.seriesInfo}, July 2011,
    \<<https://www.rfc-editor.org/info/rfc6336>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8445\]
:   [Keranen, A.]{.refAuthor}[, Holmberg, C.]{.refAuthor}[, and J.
    Rosenberg]{.refAuthor}, [\"Interactive Connectivity Establishment
    (ICE): A Protocol for Network Address Translator (NAT)
    Traversal\"]{.refTitle}, [RFC 8445]{.seriesInfo}, [DOI
    10.17487/RFC8445]{.seriesInfo}, July 2018,
    \<<https://www.rfc-editor.org/info/rfc8445>\>.
:   
:::

::: {#section-12.2 .section}
### [12.2.](#section-12.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC3725\]
:   [Rosenberg, J.]{.refAuthor}[, Peterson, J.]{.refAuthor}[,
    Schulzrinne, H.]{.refAuthor}[, and G. Camarillo]{.refAuthor},
    [\"Best Current Practices for Third Party Call Control (3pcc) in the
    Session Initiation Protocol (SIP)\"]{.refTitle}, [BCP
    85]{.seriesInfo}, [RFC 3725]{.seriesInfo}, [DOI
    10.17487/RFC3725]{.seriesInfo}, April 2004,
    \<<https://www.rfc-editor.org/info/rfc3725>\>.
:   

\[RFC3960\]
:   [Camarillo, G.]{.refAuthor}[ and H. Schulzrinne]{.refAuthor},
    [\"Early Media and Ringing Tone Generation in the Session Initiation
    Protocol (SIP)\"]{.refTitle}, [RFC 3960]{.seriesInfo}, [DOI
    10.17487/RFC3960]{.seriesInfo}, December 2004,
    \<<https://www.rfc-editor.org/info/rfc3960>\>.
:   

\[RFC5245\]
:   [Rosenberg, J.]{.refAuthor}, [\"Interactive Connectivity
    Establishment (ICE): A Protocol for Network Address Translator (NAT)
    Traversal for Offer/Answer Protocols\"]{.refTitle}, [RFC
    5245]{.seriesInfo}, [DOI 10.17487/RFC5245]{.seriesInfo}, April 2010,
    \<<https://www.rfc-editor.org/info/rfc5245>\>.
:   

\[RFC5626\]
:   [Jennings, C., Ed.]{.refAuthor}[, Mahy, R., Ed.]{.refAuthor}[,
    and F. Audet, Ed.]{.refAuthor}, [\"Managing Client-Initiated
    Connections in the Session Initiation Protocol (SIP)\"]{.refTitle},
    [RFC 5626]{.seriesInfo}, [DOI 10.17487/RFC5626]{.seriesInfo},
    October 2009, \<<https://www.rfc-editor.org/info/rfc5626>\>.
:   

\[RFC5898\]
:   [Andreasen, F.]{.refAuthor}[, Camarillo, G.]{.refAuthor}[,
    Oran, D.]{.refAuthor}[, and D. Wing]{.refAuthor}, [\"Connectivity
    Preconditions for Session Description Protocol (SDP) Media
    Streams\"]{.refTitle}, [RFC 5898]{.seriesInfo}, [DOI
    10.17487/RFC5898]{.seriesInfo}, July 2010,
    \<<https://www.rfc-editor.org/info/rfc5898>\>.
:   

\[RFC6679\]
:   [Westerlund, M.]{.refAuthor}[, Johansson, I.]{.refAuthor}[,
    Perkins, C.]{.refAuthor}[, O\'Hanlon, P.]{.refAuthor}[, and K.
    Carlberg]{.refAuthor}, [\"Explicit Congestion Notification (ECN) for
    RTP over UDP\"]{.refTitle}, [RFC 6679]{.seriesInfo}, [DOI
    10.17487/RFC6679]{.seriesInfo}, August 2012,
    \<<https://www.rfc-editor.org/info/rfc6679>\>.
:   

\[RFC7675\]
:   [Perumal, M.]{.refAuthor}[, Wing, D.]{.refAuthor}[,
    Ravindranath, R.]{.refAuthor}[, Reddy, T.]{.refAuthor}[, and M.
    Thomson]{.refAuthor}, [\"Session Traversal Utilities for NAT (STUN)
    Usage for Consent Freshness\"]{.refTitle}, [RFC 7675]{.seriesInfo},
    [DOI 10.17487/RFC7675]{.seriesInfo}, October 2015,
    \<<https://www.rfc-editor.org/info/rfc7675>\>.
:   

\[RFC8126\]
:   [Cotton, M.]{.refAuthor}[, Leiba, B.]{.refAuthor}[, and T.
    Narten]{.refAuthor}, [\"Guidelines for Writing an IANA
    Considerations Section in RFCs\"]{.refTitle}, [BCP 26]{.seriesInfo},
    [RFC 8126]{.seriesInfo}, [DOI 10.17487/RFC8126]{.seriesInfo}, June
    2017, \<<https://www.rfc-editor.org/info/rfc8126>\>.
:   

\[RFC8859\]
:   [Nandakumar, S.]{.refAuthor}, [\"A Framework for Session Description
    Protocol (SDP) Attributes When Multiplexing\"]{.refTitle}, [RFC
    8859]{.seriesInfo}, [DOI 10.17487/RFC8859]{.seriesInfo}, January
    2021, \<<https://www.rfc-editor.org/info/rfc8859>\>.
:   

\[RFC8863\]
:   [Holmberg, C.]{.refAuthor}[ and J. Uberti]{.refAuthor},
    [\"Interactive Connectivity Establishment Patiently Awaiting
    Connectivity (ICE PAC)\"]{.refTitle}, [RFC 8863]{.seriesInfo}, [DOI
    10.17487/RFC8863]{.seriesInfo}, January 2021,
    \<<https://www.rfc-editor.org/info/rfc8863>\>.
:   
:::
:::

::: {#sec-example}
::: {#section-appendix.a .section}
## [Appendix A.](#section-appendix.a){.section-number .selfRef} [Examples](#name-examples){.section-name .selfRef} {#name-examples}

For the example shown in [Section
15](https://www.rfc-editor.org/rfc/rfc8445#section-15){.relref} of
\[[RFC8445](#RFC8445){.xref}\], the resulting offer (message 5) encoded
in SDP looks like (lines folded for
clarity):[¶](#section-appendix.a-1){.pilcrow}

::: {#section-appendix.a-2}
``` {.sourcecode .lang-sdp}
v=0
o=jdoe 2890844526 2890842807 IN IP6 $L-PRIV-1.IP
s=
c=IN IP6 $NAT-PUB-1.IP
t=0 0
a=ice-options:ice2
a=ice-pacing:50
a=ice-pwd:asd88fgpdd777uzjYhagZg
a=ice-ufrag:8hhY
m=audio $NAT-PUB-1.PORT RTP/AVP 0
b=RS:0
b=RR:0
a=rtpmap:0 PCMU/8000
a=candidate:1 1 UDP 2130706431 $L-PRIV-1.IP $L-PRIV-1.PORT typ host
a=candidate:2 1 UDP 1694498815 $NAT-PUB-1.IP $NAT-PUB-1.PORT typ
 srflx raddr $L-PRIV-1.IP rport $L-PRIV-1.PORT
```

[¶](#section-appendix.a-2){.pilcrow}
:::

The offer, with the variables replaced with their values, will look like
(lines folded for clarity):[¶](#section-appendix.a-3){.pilcrow}

::: {#section-appendix.a-4}
``` {.sourcecode .lang-sdp}
v=0
o=jdoe 2890844526 2890842807 IN IP6 fe80::6676:baff:fe9c:ee4a
s=
c=IN IP6 2001:db8:8101:3a55:4858:a2a9:22ff:99b9
t=0 0
a=ice-options:ice2
a=ice-pacing:50
a=ice-pwd:asd88fgpdd777uzjYhagZg
a=ice-ufrag:8hhY
m=audio 45664 RTP/AVP 0
b=RS:0
b=RR:0
a=rtpmap:0 PCMU/8000
a=candidate:1 1 UDP 2130706431 fe80::6676:baff:fe9c:ee4a 8998
 typ host
a=candidate:2 1 UDP 1694498815 2001:db8:8101:3a55:4858:a2a9:22ff:99b9
 45664 typ srflx raddr fe80::6676:baff:fe9c:ee4a rport 8998
```

[¶](#section-appendix.a-4){.pilcrow}
:::

The resulting answer looks like:[¶](#section-appendix.a-5){.pilcrow}

::: {#section-appendix.a-6}
``` {.sourcecode .lang-sdp}
v=0
o=bob 2808844564 2808844564 IN IP4 $R-PUB-1.IP
s=
c=IN IP4 $R-PUB-1.IP
t=0 0
a=ice-options:ice2
a=ice-pacing:50
a=ice-pwd:YH75Fviy6338Vbrhrlp8Yh
a=ice-ufrag:9uB6
m=audio $R-PUB-1.PORT RTP/AVP 0
b=RS:0
b=RR:0
a=rtpmap:0 PCMU/8000
a=candidate:1 1 UDP 2130706431 $R-PUB-1.IP $R-PUB-1.PORT typ host
```

[¶](#section-appendix.a-6){.pilcrow}
:::

With the variables filled in:[¶](#section-appendix.a-7){.pilcrow}

::: {#section-appendix.a-8}
``` {.sourcecode .lang-sdp}
v=0
o=bob 2808844564 2808844564 IN IP4 192.0.2.1
s=
c=IN IP4 192.0.2.1
t=0 0
a=ice-options:ice2
a=ice-pacing:50
a=ice-pwd:YH75Fviy6338Vbrhrlp8Yh
a=ice-ufrag:9uB6
m=audio 3478 RTP/AVP 0
b=RS:0
b=RR:0
a=rtpmap:0 PCMU/8000
a=candidate:1 1 UDP 2130706431 192.0.2.1 3478 typ host
```

[¶](#section-appendix.a-8){.pilcrow}
:::
:::
:::

::: {#sec-why-remote}
::: {#section-appendix.b .section}
## [Appendix B.](#section-appendix.b){.section-number .selfRef} [The \"remote-candidates\" Attribute](#name-the-remote-candidates-attri){.section-name .selfRef} {#name-the-remote-candidates-attri}

The \"remote-candidates\" attribute exists to eliminate a race condition
between the updated offer and the response to the STUN Binding request
that moved a candidate into the valid list. This race condition is shown
in [Figure 1](#fig-race-flow){.xref}. On receipt of message 4, agent L
adds a candidate pair to the valid list. If there was only a single data
stream with a single component, agent L could now send an updated offer.
However, the check from agent R has not yet received a response, and
agent R receives the updated offer (message 7) before getting the
response (message 9). Thus, it does not yet know that this particular
pair is valid. To eliminate this condition, the actual candidates at R
that were selected by the offerer (the remote candidates) are included
in the offer itself, and the answerer delays its answer until those
pairs validate.[¶](#section-appendix.b-1){.pilcrow}

[]{#name-race-condition-flow}

::: {#fig-race-flow}
::: {#section-appendix.b-2.1 .artwork .art-text .alignLeft}
    Agent L               Network               Agent R
       |(1) Offer            |                     |
       |------------------------------------------>|
       |(2) Answer           |                     |
       |<------------------------------------------|
       |(3) STUN Req.        |                     |
       |------------------------------------------>|
       |(4) STUN Res.        |                     |
       |<------------------------------------------|
       |(5) STUN Req.        |                     |
       |<------------------------------------------|
       |(6) STUN Res.        |                     |
       |-------------------->|                     |
       |                     |Lost                 |
       |(7) Offer            |                     |
       |------------------------------------------>|
       |(8) STUN Req.        |                     |
       |<------------------------------------------|
       |(9) STUN Res.        |                     |
       |------------------------------------------>|
       |(10) Answer          |                     |
       |<------------------------------------------|
:::

[Figure 1](#figure-1){.selfRef}: [Race Condition
Flow](#name-race-condition-flow){.selfRef}
:::
:::
:::

::: {#sec-glare}
::: {#section-appendix.c .section}
## [Appendix C.](#section-appendix.c){.section-number .selfRef} [Why Is the Conflict Resolution Mechanism Needed?](#name-why-is-the-conflict-resolut){.section-name .selfRef} {#name-why-is-the-conflict-resolut}

When ICE runs between two peers, one agent acts as controlled, and the
other as controlling. Rules are defined as a function of implementation
type and offerer/answerer to determine who is controlling and who is
controlled. However, the specification mentions that, in some cases,
both sides might believe they are controlling, or both sides might
believe they are controlled. How can this
happen?[¶](#section-appendix.c-1){.pilcrow}

The condition when both agents believe they are controlled shows up in
third party call control cases. Consider the following
flow:[¶](#section-appendix.c-2){.pilcrow}

[]{#name-role-conflict-flow}

::: {#fig-conflict}
::: {#section-appendix.c-3.1 .artwork .art-text .alignLeft}
              A         Controller          B
              |(1) INV()     |              |
              |<-------------|              |
              |(2) 200(SDP1) |              |
              |------------->|              |
              |              |(3) INV()     |
              |              |------------->|
              |              |(4) 200(SDP2) |
              |              |<-------------|
              |(5) ACK(SDP2) |              |
              |<-------------|              |
              |              |(6) ACK(SDP1) |
              |              |------------->|
:::

[Figure 2](#figure-2){.selfRef}: [Role Conflict
Flow](#name-role-conflict-flow){.selfRef}
:::

This flow is a variation on flow III of RFC 3725
\[[RFC3725](#RFC3725){.xref}\]. In fact, it works better than flow III
since it produces fewer messages. In this flow, the controller sends an
offerless INVITE to agent A, which responds with its offer, SDP1. The
agent then sends an offerless INVITE to agent B, which it responds to
with its offer, SDP2. The controller then uses the offer from each agent
to generate the answers. When this flow is used, ICE will run between
agents A and B, but both will believe they are in the controlling role.
With the role conflict resolution procedures, this flow will function
properly when ICE is used.[¶](#section-appendix.c-4){.pilcrow}

At this time, there are no documented flows that can result in the case
where both agents believe they are controlled. However, the conflict
resolution procedures allow for this case, should a flow arise that
would fit into this category.[¶](#section-appendix.c-5){.pilcrow}
:::
:::

::: {#section-appendix.d .section}
## [Appendix D.](#section-appendix.d){.section-number .selfRef} [Why Send an Updated Offer?](#name-why-send-an-updated-offer){.section-name .selfRef} {#name-why-send-an-updated-offer}

[Section
12.1](https://www.rfc-editor.org/rfc/rfc8445#section-12.1){.relref} of
\[[RFC8445](#RFC8445){.xref}\] describes rules for sending media. Both
agents can send media once ICE checks complete, without waiting for an
updated offer. Indeed, the only purpose of the updated offer is to
\"correct\" the SDP so that the default destination for media matches
where media is being sent based on ICE procedures (which will be the
highest-priority nominated candidate
pair).[¶](#section-appendix.d-1){.pilcrow}

This raises the question \-- why is the updated offer/answer exchange
needed at all? Indeed, in a pure offer/answer environment, it would not
be. The offerer and answerer will agree on the candidates to use through
ICE, and then can begin using them. As far as the agents themselves are
concerned, the updated offer/answer provides no new information.
However, in practice, numerous components along the signaling path look
at the SDP information. These include entities performing off-path QoS
reservations, NAT traversal components such as ALGs and Session Border
Controllers (SBCs), and diagnostic tools that passively monitor the
network. For these tools to continue to function without change, the
core property of SDP \-- that the existing, pre-ICE definitions of the
addresses used for media \-- the \"m=\" and \"c=\" lines and the
\"rtcp\" attribute \-- must be retained. For this reason, an updated
offer must be sent.[¶](#section-appendix.d-2){.pilcrow}
:::

::: {#section-appendix.e .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

A large part of the text in this document was taken from
\[[RFC5245](#RFC5245){.xref}\], authored by [Jonathan
Rosenberg]{.contact-name}.[¶](#section-appendix.e-1){.pilcrow}

Some of the text in this document was taken from
\[[RFC6336](#RFC6336){.xref}\], authored by [Magnus
Westerlund]{.contact-name} and [Colin
Perkins]{.contact-name}.[¶](#section-appendix.e-2){.pilcrow}

Many thanks to [Flemming Andreasen]{.contact-name} for shepherd review
feedback.[¶](#section-appendix.e-3){.pilcrow}

Thanks to following experts for their reviews and constructive feedback:
[Thomas Stach]{.contact-name}, [Adam Roach]{.contact-name}, [Peter
Saint-Andre]{.contact-name}, [Roman Danyliw]{.contact-name}, [Alissa
Cooper]{.contact-name}, [Benjamin Kaduk]{.contact-name}, [Mirja
Kühlewind]{.contact-name}, [Alexey Melnikov]{.contact-name}, and [Éric
Vyncke]{.contact-name} for their detailed
reviews.[¶](#section-appendix.e-4){.pilcrow}
:::

::: {#section-appendix.f .section}
## [Contributors](#name-contributors){.section-name .selfRef} {#name-contributors}

The following experts have contributed textual and structural
improvements for this work:[¶](#section-appendix.f-1){.pilcrow}

::: {.left dir="auto"}
[Thomas Stach]{.fn .nameRole}
:::

::: email
Email: <thomass.stach@gmail.com>
:::
:::

::: {#authors-addresses}
::: {#section-appendix.g .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Marc Petit-Huguenin]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Impedance Mismatch]{.org}
:::

::: email
Email: <marc@petit-huguenin.org>
:::

::: {.left dir="auto"}
[Suhas Nandakumar]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems]{.org}
:::

::: {.left dir="auto"}
[707 Tasman Dr]{.street-address}
:::

::: {.left dir="auto"}
[Milpitas]{.locality}, [CA]{.region} [95035]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <snandaku@cisco.com>
:::

::: {.left dir="auto"}
[Christer Holmberg]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Ericsson]{.org}
:::

::: {.left dir="auto"}
[Hirsalantie 11]{.street-address}
:::

::: {.left dir="auto"}
FI-[02420]{.postal-code} [Jorvas]{.locality}
:::

::: {.left dir="auto"}
[Finland]{.country-name}
:::

::: email
Email: <christer.holmberg@ericsson.com>
:::

::: {.left dir="auto"}
[Ari Keränen]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Ericsson]{.org}
:::

::: {.left dir="auto"}
FI-[02420]{.postal-code} [Jorvas]{.locality}
:::

::: {.left dir="auto"}
[Finland]{.country-name}
:::

::: email
Email: <ari.keranen@ericsson.com>
:::

::: {.left dir="auto"}
[Roman Shpount]{.fn .nameRole}
:::

::: {.left dir="auto"}
[TurboBridge]{.org}
:::

::: {.left dir="auto"}
[4905 Del Ray Avenue, Suite 300]{.street-address}
:::

::: {.left dir="auto"}
[Bethesda]{.locality}, [MD]{.region} [20814]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <rshpount@turbobridge.com>
:::
:::
:::
