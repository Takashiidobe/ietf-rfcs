  RFC 9103         XFR over TLS      August 2021
  ---------------- ----------------- -------------
  Toorop, et al.   Standards Track   \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9103](https://www.rfc-editor.org/rfc/rfc9103){.eref}

Updates:
:   [1995](https://www.rfc-editor.org/rfc/rfc1995){.eref},
    [5936](https://www.rfc-editor.org/rfc/rfc5936){.eref},
    [7766](https://www.rfc-editor.org/rfc/rfc7766){.eref}

Category:
:   Standards Track

Published:
:   August 2021

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    W. Toorop
    :::

    ::: org
    NLnet Labs
    :::
    :::

    ::: author
    ::: author-name
    S. Dickinson
    :::

    ::: org
    Sinodun IT
    :::
    :::

    ::: author
    ::: author-name
    S. Sahib
    :::

    ::: org
    Brave Software
    :::
    :::

    ::: author
    ::: author-name
    P. Aras
    :::

    ::: org
    Salesforce
    :::
    :::

    ::: author
    ::: author-name
    A. Mankin
    :::

    ::: org
    Salesforce
    :::
    :::
:::

# RFC 9103 {#rfcnum}

# DNS Zone Transfer over TLS {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

DNS zone transfers are transmitted in cleartext, which gives attackers
the opportunity to collect the content of a zone by eavesdropping on
network connections. The DNS Transaction Signature (TSIG) mechanism is
specified to restrict direct zone transfer to authorized clients only,
but it does not add confidentiality. This document specifies the use of
TLS, rather than cleartext, to prevent zone content collection via
passive monitoring of zone transfers: XFR over TLS (XoT). Additionally,
this specification updates RFC 1995 and RFC 5936 with respect to
efficient use of TCP connections and RFC 7766 with respect to the
recommended number of connections between a client and server for each
transport.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9103>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2021 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Terminology](#name-terminology){.xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Threat Model](#name-threat-model){.xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Design Considerations for
    XoT](#name-design-considerations-for-x){.xref}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Connection and Data Flows in Existing XFR
    Mechanisms](#name-connection-and-data-flows-i){.xref}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [AXFR
        Mechanism](#name-axfr-mechanism){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [IXFR
        Mechanism](#name-ixfr-mechanism){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.xref}.  [Data Leakage of NOTIFY and SOA
        Message Exchanges](#name-data-leakage-of-notify-and-){.xref}

        -   ::: {#section-toc.1-1.5.2.3.2.1}
            [5.3.1](#section-5.3.1){.xref}.  [NOTIFY](#name-notify){.xref}
            :::

        -   ::: {#section-toc.1-1.5.2.3.2.2}
            [5.3.2](#section-5.3.2){.xref}.  [SOA](#name-soa){.xref}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Updates to Existing
    Specifications](#name-updates-to-existing-specifi){.xref}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.xref}.  [Update to RFC 1995 for IXFR over
        TCP](#name-update-to-rfc-1995-for-ixfr){.xref}
        :::

    -   ::: {#section-toc.1-1.6.2.2}
        [6.2](#section-6.2){.xref}.  [Update to RFC 5936 for AXFR over
        TCP](#name-update-to-rfc-5936-for-axfr){.xref}
        :::

    -   ::: {#section-toc.1-1.6.2.3}
        [6.3](#section-6.3){.xref}.  [Updates to RFCs 1995 and 5936 for
        XFR over TCP](#name-updates-to-rfcs-1995-and-59){.xref}

        -   ::: {#section-toc.1-1.6.2.3.2.1}
            [6.3.1](#section-6.3.1){.xref}.  [Connection
            Reuse](#name-connection-reuse){.xref}
            :::

        -   ::: {#section-toc.1-1.6.2.3.2.2}
            [6.3.2](#section-6.3.2){.xref}.  [AXFRs and IXFRs on the
            Same Connection](#name-axfrs-and-ixfrs-on-the-same){.xref}
            :::

        -   ::: {#section-toc.1-1.6.2.3.2.3}
            [6.3.3](#section-6.3.3){.xref}.  [XFR
            Limits](#name-xfr-limits){.xref}
            :::

        -   ::: {#section-toc.1-1.6.2.3.2.4}
            [6.3.4](#section-6.3.4){.xref}.  [The edns-tcp-keepalive
            EDNS(0) Option](#name-the-edns-tcp-keepalive-edns){.xref}
            :::

        -   ::: {#section-toc.1-1.6.2.3.2.5}
            [6.3.5](#section-6.3.5){.xref}.  [Backwards
            Compatibility](#name-backwards-compatibility){.xref}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.4}
        [6.4](#section-6.4){.xref}.  [Update to RFC
        7766](#name-update-to-rfc-7766){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [XoT
    Specification](#name-xot-specification){.xref}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Connection
        Establishment](#name-connection-establishment){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [TLS
        Versions](#name-tls-versions){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.3}
        [7.3](#section-7.3){.xref}.  [Port
        Selection](#name-port-selection){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.4}
        [7.4](#section-7.4){.xref}.  [High-Level XoT
        Descriptions](#name-high-level-xot-descriptions){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.5}
        [7.5](#section-7.5){.xref}.  [XoT
        Transfers](#name-xot-transfers){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.6}
        [7.6](#section-7.6){.xref}.  [XoT
        Connections](#name-xot-connections){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.7}
        [7.7](#section-7.7){.xref}.  [XoT vs.
        ADoT](#name-xot-vs-adot){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.8}
        [7.8](#section-7.8){.xref}.  [Response
        RCODES](#name-response-rcodes){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.9}
        [7.9](#section-7.9){.xref}.  [AXoT
        Specifics](#name-axot-specifics){.xref}

        -   ::: {#section-toc.1-1.7.2.9.2.1}
            [7.9.1](#section-7.9.1){.xref}.  [Padding AXoT
            Responses](#name-padding-axot-responses){.xref}
            :::
        :::

    -   ::: {#section-toc.1-1.7.2.10}
        [7.10](#section-7.10){.xref}. [IXoT
        Specifics](#name-ixot-specifics){.xref}

        -   ::: {#section-toc.1-1.7.2.10.2.1}
            [7.10.1](#section-7.10.1){.xref}.  [Condensation of
            Responses](#name-condensation-of-responses){.xref}
            :::

        -   ::: {#section-toc.1-1.7.2.10.2.2}
            [7.10.2](#section-7.10.2){.xref}.  [Fallback to
            AXFR](#name-fallback-to-axfr){.xref}
            :::

        -   ::: {#section-toc.1-1.7.2.10.2.3}
            [7.10.3](#section-7.10.3){.xref}.  [Padding of IXoT
            Responses](#name-padding-of-ixot-responses){.xref}
            :::
        :::

    -   ::: {#section-toc.1-1.7.2.11}
        [7.11](#section-7.11){.xref}. [Name Compression and Maximum
        Payload Sizes](#name-name-compression-and-maximu){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Multi-primary
    Configurations](#name-multi-primary-configuration){.xref}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [Authentication
    Mechanisms](#name-authentication-mechanisms){.xref}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [TSIG](#name-tsig){.xref}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [SIG(0)](#name-sig0){.xref}
        :::

    -   ::: {#section-toc.1-1.9.2.3}
        [9.3](#section-9.3){.xref}.  [TLS](#name-tls){.xref}

        -   ::: {#section-toc.1-1.9.2.3.2.1}
            [9.3.1](#section-9.3.1){.xref}.  [Opportunistic
            TLS](#name-opportunistic-tls){.xref}
            :::

        -   ::: {#section-toc.1-1.9.2.3.2.2}
            [9.3.2](#section-9.3.2){.xref}.  [Strict
            TLS](#name-strict-tls){.xref}
            :::

        -   ::: {#section-toc.1-1.9.2.3.2.3}
            [9.3.3](#section-9.3.3){.xref}.  [Mutual
            TLS](#name-mutual-tls){.xref}
            :::
        :::

    -   ::: {#section-toc.1-1.9.2.4}
        [9.4](#section-9.4){.xref}.  [IP-Based ACL on the
        Primary](#name-ip-based-acl-on-the-primary){.xref}
        :::

    -   ::: {#section-toc.1-1.9.2.5}
        [9.5](#section-9.5){.xref}.  [ZONEMD](#name-zonemd){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [XoT
    Authentication](#name-xot-authentication){.xref}
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.xref}. [Policies for Both AXoT and
    IXoT](#name-policies-for-both-axot-and-){.xref}
    :::

-   ::: {#section-toc.1-1.12}
    [12](#section-12){.xref}. [Implementation
    Considerations](#name-implementation-consideratio){.xref}
    :::

-   ::: {#section-toc.1-1.13}
    [13](#section-13){.xref}. [Operational
    Considerations](#name-operational-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.14}
    [14](#section-14){.xref}. [IANA
    Considerations](#name-iana-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.15}
    [15](#section-15){.xref}. [Security
    Considerations](#name-security-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.16}
    [16](#section-16){.xref}. [References](#name-references){.xref}

    -   ::: {#section-toc.1-1.16.2.1}
        [16.1](#section-16.1){.xref}.  [Normative
        References](#name-normative-references){.xref}
        :::

    -   ::: {#section-toc.1-1.16.2.2}
        [16.2](#section-16.2){.xref}.  [Informative
        References](#name-informative-references){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.17}
    [Appendix A](#appendix-A){.xref}.  [XoT Server Connection
    Handling](#name-xot-server-connection-handl){.xref}

    -   ::: {#section-toc.1-1.17.2.1}
        [A.1](#appendix-A.1){.xref}.  [Listening Only on a Specific IP
        Address for TLS](#name-listening-only-on-a-specifi){.xref}
        :::

    -   ::: {#section-toc.1-1.17.2.2}
        [A.2](#appendix-A.2){.xref}.  [Client-Specific TLS
        Acceptance](#name-client-specific-tls-accepta){.xref}
        :::

    -   ::: {#section-toc.1-1.17.2.3}
        [A.3](#appendix-A.3){.xref}.  [SNI-Based TLS
        Acceptance](#name-sni-based-tls-acceptance){.xref}
        :::

    -   ::: {#section-toc.1-1.17.2.4}
        [A.4](#appendix-A.4){.xref}.  [Transport-Specific Response
        Policies](#name-transport-specific-response){.xref}

        -   ::: {#section-toc.1-1.17.2.4.2.1}
            [A.4.1](#appendix-A.4.1){.xref}.  [SNI-Based Response
            Policies](#name-sni-based-response-policies){.xref}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.18}
    [](#appendix-B){.xref}[Acknowledgements](#name-acknowledgements){.xref}
    :::

-   ::: {#section-toc.1-1.19}
    [](#appendix-C){.xref}[Contributors](#name-contributors){.xref}
    :::

-   ::: {#section-toc.1-1.20}
    [](#appendix-D){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}
    :::
:::
:::

::: {#introduction}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

DNS has a number of privacy vulnerabilities, as discussed in detail in
\[[RFC9076](#RFC9076){.xref}\]. Query privacy between stub resolvers and
recursive resolvers has received the most attention to date, with
Standards Track documents for both DNS over TLS (DoT)
\[[RFC7858](#RFC7858){.xref}\] and DNS over HTTPS (DoH)
\[[RFC8484](#RFC8484){.xref}\] and a proposal for DNS over QUIC
\[[DPRIVE-DNSOQUIC](#I-D.ietf-dprive-dnsoquic){.xref}\]. There is
ongoing work on DNS privacy requirements for exchanges between recursive
resolvers and authoritative servers and some suggestions for how
signaling of DoT support by authoritative name servers might work.
However, there is currently no RFC that specifically defines
recursive-to-authoritative DNS over TLS
(ADoT).[¶](#section-1-1){.pilcrow}

\[[RFC9076](#RFC9076){.xref}\] establishes that a stub resolver\'s DNS
query transactions are not public and that they need protection, but, on
zone transfer \[[RFC1995](#RFC1995){.xref}\]
\[[RFC5936](#RFC5936){.xref}\], it says only:[¶](#section-1-2){.pilcrow}

> Privacy risks for the holder of a zone (the risk that someone gets the
> data) are discussed in \[[RFC5155](#RFC5155){.xref}\] and
> \[[RFC5936](#RFC5936){.xref}\].[¶](#section-1-3){.pilcrow}

In what way is exposing the full contents of a zone a privacy risk? The
contents of the zone could include information such as names of persons
used in names of hosts. Best practice is not to use personal information
for domain names, but many such domain names exist. The contents of the
zone could also include references to locations that allow inference
about location information of the individuals associated with the
zone\'s organization. It could also include references to other
organizations. Examples of this could be:[¶](#section-1-4){.pilcrow}

-   [Person-laptop.example.org[¶](#section-1-5.1){.pilcrow}]{#section-1-5.1}
-   [MX-for-Location.example.org[¶](#section-1-5.2){.pilcrow}]{#section-1-5.2}
-   [Service-tenant-from-another-org.example.org[¶](#section-1-5.3){.pilcrow}]{#section-1-5.3}

Additionally, the full zone contents expose all the IP addresses of
endpoints held in the DNS records, which can make reconnaissance and
attack targeting easier, particularly for IPv6 addresses or private
networks. There may also be regulatory, policy, or other reasons why the
zone contents in full must be treated as
private.[¶](#section-1-6){.pilcrow}

Neither of the RFCs mentioned in \[[RFC9076](#RFC9076){.xref}\]
contemplate the risk that someone gets the data through eavesdropping on
network connections, only via enumeration or unauthorized transfer, as
described in the following paragraphs.[¶](#section-1-7){.pilcrow}

Zone enumeration is trivially possible for DNSSEC zones that use NSEC,
i.e., queries for the authenticated denial-of-existence records allow a
client to walk through the entire zone contents.
\[[RFC5155](#RFC5155){.xref}\] specifies NSEC3, a mechanism to provide
measures against zone enumeration for DNSSEC-signed zones (a goal was to
make it as hard to enumerate a DNSSEC-signed zone as an unsigned zone).
Whilst this is widely used, it has been demonstrated that zone walking
is possible for precomputed NSEC3 using attacks, such as those described
in \[[NSEC3-attacks](#NSEC3-attacks){.xref}\]. This prompted further
work on an alternative mechanism for DNSSEC-authenticated denial of
existence (NSEC5 \[[NSEC5](#I-D.vcelak-nsec5){.xref}\]); however,
questions remain over the practicality of this
mechanism.[¶](#section-1-8){.pilcrow}

\[[RFC5155](#RFC5155){.xref}\] does not address data obtained outside
zone enumeration (nor does \[[NSEC5](#I-D.vcelak-nsec5){.xref}\]).
Preventing eavesdropping of zone transfers (as described in this
document) is orthogonal to preventing zone enumeration, though they aim
to protect the same information.[¶](#section-1-9){.pilcrow}

\[[RFC5936](#RFC5936){.xref}\] specifies using TSIG
\[[RFC8945](#RFC8945){.xref}\] for authorization of the clients of a
zone transfer and for data integrity but does not express any need for
confidentiality, and TSIG does not offer
encryption.[¶](#section-1-10){.pilcrow}

Section 8 of the NIST document \"Secure Domain Name System (DNS)
Deployment Guide\" \[[NIST-GUIDE](#NIST-GUIDE){.xref}\] discusses
restricting access for zone transfers using Access Control Lists (ACLs)
and TSIG in more detail. It also discusses the possibility that specific
deployments might choose to use a lower-level network layer to protect
zone transfers, e.g., IPsec.[¶](#section-1-11){.pilcrow}

It is noted that in all the common open-source implementations such ACLs
are applied on a per-query basis (at the time of writing). Since
requests typically occur on TCP connections, authoritative servers must
therefore accept any TCP connection and then handle the authentication
of each zone transfer (XFR) request
individually.[¶](#section-1-12){.pilcrow}

Because both AXFR (authoritative transfer) and IXFR (incremental zone
transfer) are typically carried out over TCP from authoritative DNS
protocol implementations, encrypting zone transfers using TLS
\[[RFC8499](#RFC8499){.xref}\] \-- based closely on DoT
\[[RFC7858](#RFC7858){.xref}\] \-- seems like a simple step forward.
This document specifies how to use TLS (1.3 or later) as a transport to
prevent zone collection from zone transfers.[¶](#section-1-13){.pilcrow}

This document also updates the previous specifications for zone
transfers to clarify and extend them, mainly with respect to TCP
usage:[¶](#section-1-14){.pilcrow}

-   [\[[RFC1995](#RFC1995){.xref}\] (IXFR) and
    \[[RFC5936](#RFC5936){.xref}\] (AXFR) are both updated to add
    further specification on efficient use of TCP
    connections.[¶](#section-1-15.1){.pilcrow}]{#section-1-15.1}
-   [[Section
    6.2.2](https://www.rfc-editor.org/rfc/rfc7766#section-6.2.2){.relref}
    of \[[RFC7766](#RFC7766){.xref}\] (\"DNS Transport over TCP -
    Implementation Requirements\") is updated with a new recommendation
    about the number of connections between a client and server for each
    transport.[¶](#section-1-15.2){.pilcrow}]{#section-1-15.2}
:::
:::

::: {#terminology}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}

Privacy terminology is as described in [Section
3](https://www.rfc-editor.org/rfc/rfc6973#section-3){.relref} of
\[[RFC6973](#RFC6973){.xref}\].[¶](#section-2-2){.pilcrow}

DNS terminology is as described in \[[RFC8499](#RFC8499){.xref}\]. Note
that, as in \[[RFC8499](#RFC8499){.xref}\], the terms \'primary\' and
\'secondary\' are used for two servers engaged in zone
transfers.[¶](#section-2-3){.pilcrow}

[]{.break}

DoT:
:   DNS over TLS, as specified in
    \[[RFC7858](#RFC7858){.xref}\][¶](#section-2-4.2){.pilcrow}
:   

XFR over TCP:
:   Used to mean both IXFR over TCP \[[RFC1995](#RFC1995){.xref}\] and
    AXFR over TCP
    \[[RFC5936](#RFC5936){.xref}\][¶](#section-2-4.4){.pilcrow}
:   

XoT:
:   XFR-over-TLS mechanisms, as specified in this document, which apply
    to both AXFR over TLS and IXFR over TLS (XoT is pronounced \'zot\'
    since X here stands for \'zone
    transfer\')[¶](#section-2-4.6){.pilcrow}
:   

AXoT:
:   AXFR over TLS[¶](#section-2-4.8){.pilcrow}
:   

IXoT:
:   IXFR over TLS[¶](#section-2-4.10){.pilcrow}
:   
:::
:::

::: {#threat-model}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Threat Model](#name-threat-model){.section-name .selfRef} {#name-threat-model}

The threat model considered here is one where the current contents and
size of the zone are considered sensitive and should be protected during
transfer.[¶](#section-3-1){.pilcrow}

The threat model does not, however, consider the existence of a zone,
the act of zone transfer between two entities, nor the identities of the
name servers hosting a zone (including both those acting as hidden
primaries/secondaries or directly serving the zone) as sensitive
information. The proposed mechanism does not attempt to obscure such
information. The reasons for this include:[¶](#section-3-2){.pilcrow}

-   [much of this information can be obtained by various methods,
    including active scanning of the DNS,
    and[¶](#section-3-3.1){.pilcrow}]{#section-3-3.1}
-   [an attacker who can monitor network traffic can rather easily infer
    relations between name servers simply from traffic patterns, even
    when some or all of the traffic is encrypted (in terms of current
    deployments).[¶](#section-3-3.2){.pilcrow}]{#section-3-3.2}

The model does not consider attacks on the mechanisms that trigger a
zone transfer, e.g., NOTIFY messages.[¶](#section-3-4){.pilcrow}

It is noted that simply using XoT will indicate a desire by the zone
owner that the contents of the zone remain confidential and so could be
subject to blocking (e.g., via blocking of port 853) if an attacker had
such capabilities. However, this threat is likely true of any such
mechanism that attempts to encrypt data passed between name servers,
e.g., IPsec.[¶](#section-3-5){.pilcrow}
:::
:::

::: {#design-considerations-for-xot}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Design Considerations for XoT](#name-design-considerations-for-x){.section-name .selfRef} {#name-design-considerations-for-x}

The following principles were considered in the design for
XoT:[¶](#section-4-1){.pilcrow}

[]{.break}

Confidentiality:
:   Clearly using an encrypted transport for zone transfers will defeat
    zone content leakage that can occur via passive
    surveillance.[¶](#section-4-2.2){.pilcrow}
:   

Authentication:
:   Use of single or mutual TLS (mTLS) authentication (in combination
    with ACLs) can complement and potentially be an alternative to
    TSIG.[¶](#section-4-2.4){.pilcrow}
:   

Performance:

:   -   [Existing AXFR and IXFR mechanisms have the burden of backwards
        compatibility with older implementations based on the original
        specifications in \[[RFC1034](#RFC1034){.xref}\] and
        \[[RFC1035](#RFC1035){.xref}\]. For example, some older AXFR
        servers don\'t support using a TCP connection for multiple AXFR
        sessions or XFRs of different zones because they have not been
        updated to follow the guidance in
        \[[RFC5936](#RFC5936){.xref}\]. Any implementation of XoT would
        obviously be required to implement optimized and interoperable
        transfers, as described in \[[RFC5936](#RFC5936){.xref}\], e.g.,
        transfer of multiple zones over one
        connection.[¶](#section-4-2.6.1.1){.pilcrow}]{#section-4-2.6.1.1}
    -   [Current usage of TCP for IXFR is suboptimal in some cases,
        i.e., connections are frequently closed after a single
        IXFR.[¶](#section-4-2.6.1.2){.pilcrow}]{#section-4-2.6.1.2}

:   
:::
:::

::: {#connection-and-data-flows-in-existing-xfr-mechanisms}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Connection and Data Flows in Existing XFR Mechanisms](#name-connection-and-data-flows-i){.section-name .selfRef} {#name-connection-and-data-flows-i}

The original specification for zone transfers in
\[[RFC1034](#RFC1034){.xref}\] and \[[RFC1035](#RFC1035){.xref}\] was
based on a polling mechanism: a secondary performed a periodic query for
the SOA (start of zone authority) record (based on the refresh timer) to
determine if an AXFR was required.[¶](#section-5-1){.pilcrow}

\[[RFC1995](#RFC1995){.xref}\] and \[[RFC1996](#RFC1996){.xref}\]
introduced the concepts of IXFR and NOTIFY, respectively, to provide for
prompt propagation of zone updates. This has largely replaced AXFR where
possible, particularly for dynamically updated
zones.[¶](#section-5-2){.pilcrow}

\[[RFC5936](#RFC5936){.xref}\] subsequently redefined the specification
of AXFR to improve performance and
interoperability.[¶](#section-5-3){.pilcrow}

In this document, the term \'XFR mechanism\' is used to describe the
entire set of message exchanges between a secondary and a primary that
concludes with a successful AXFR or IXFR request/response. This set may
or may not include:[¶](#section-5-4){.pilcrow}

-   [NOTIFY messages[¶](#section-5-5.1){.pilcrow}]{#section-5-5.1}
-   [SOA queries[¶](#section-5-5.2){.pilcrow}]{#section-5-5.2}
-   [Fallback from IXFR to
    AXFR[¶](#section-5-5.3){.pilcrow}]{#section-5-5.3}
-   [Fallback from IXFR over UDP to IXFR over
    TCP[¶](#section-5-5.4){.pilcrow}]{#section-5-5.4}

The term is used to encompass the range of permutations that are
possible and is useful to distinguish the \'XFR mechanism\' from a
single XFR request/response exchange.[¶](#section-5-6){.pilcrow}

::: {#axfr-mechanism}
::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [AXFR Mechanism](#name-axfr-mechanism){.section-name .selfRef} {#name-axfr-mechanism}

The figure below provides an outline of an AXFR mechanism including
NOTIFYs.[¶](#section-5.1-1){.pilcrow}

[]{#name-axfr-mechanism-2}

::: {#fig1}
::: {#section-5.1-2.1 .artwork .art-text .alignLeft}
       Secondary                            Primary

           |              NOTIFY               |
           | <-------------------------------- |  UDP
           | --------------------------------> |
           |          NOTIFY Response          |
           |                                   |
           |                                   |
           |            SOA Request            |
           | --------------------------------> |  UDP (or part of
           | <-------------------------------- |  a TCP session)
           |           SOA Response            |
           |                                   |
           |                                   |
           |                                   |
           |            AXFR Request           | ---
           | --------------------------------> |   |
           | <-------------------------------- |   |
           |          AXFR Response 1          |   |
           |             (Zone data)           |   |
           |                                   |   |
           | <-------------------------------- |   | TCP
           |          AXFR Response 2          |   | Session
           |             (Zone data)           |   |
           |                                   |   |
           | <-------------------------------- |   |
           |          AXFR Response 3          |   |
           |             (Zone data)           | ---
           |                                   |
:::

[Figure 1](#figure-1){.selfRef}: [AXFR
Mechanism](#name-axfr-mechanism-2){.selfRef}
:::

1.  [An AXFR is often (but not always) preceded by a NOTIFY (over UDP)
    from the primary to the secondary. A secondary may also initiate an
    AXFR based on a refresh timer or scheduled/triggered zone
    maintenance.[¶](#section-5.1-3.1){.pilcrow}]{#section-5.1-3.1}
2.  [The secondary will normally (but not always) make an SOA query to
    the primary to obtain the serial number of the zone held by the
    primary.[¶](#section-5.1-3.2){.pilcrow}]{#section-5.1-3.2}
3.  [If the primary serial is higher than the secondary\'s serial (using
    Serial Number Arithmetic \[[RFC1982](#RFC1982){.xref}\]), the
    secondary makes an AXFR request (over TCP) to the primary, after
    which the AXFR data flows in one or more AXFR responses on the TCP
    connection. \[[RFC5936](#RFC5936){.xref}\] defines this specific
    step as an \'AXFR session\', i.e., as an AXFR query message and the
    sequence of AXFR response messages returned for
    it.[¶](#section-5.1-3.3){.pilcrow}]{#section-5.1-3.3}

\[[RFC5936](#RFC5936){.xref}\] re-specified AXFR, providing additional
guidance beyond that provided in \[[RFC1034](#RFC1034){.xref}\] and
\[[RFC1035](#RFC1035){.xref}\] and importantly specified that AXFR must
use TCP as the transport protocol.[¶](#section-5.1-4){.pilcrow}

Additionally, Sections
[4.1](https://www.rfc-editor.org/rfc/rfc5936#section-4.1){.relref},
[4.1.1](https://www.rfc-editor.org/rfc/rfc5936#section-4.1.1){.relref},
and
[4.1.2](https://www.rfc-editor.org/rfc/rfc5936#section-4.1.2){.relref}
of \[[RFC5936](#RFC5936){.xref}\] provide improved guidance for AXFR
clients and servers with regard to reuse of TCP connections for multiple
AXFRs and AXFRs of different zones. However,
\[[RFC5936](#RFC5936){.xref}\] was constrained by having to be backwards
compatible with some very early basic implementations of AXFR. For
example, it outlines that the SOA query can also happen on this
connection. However, this can cause interoperability problems with older
implementations that support only the trivial case of one AXFR per
connection.[¶](#section-5.1-5){.pilcrow}
:::
:::

::: {#ixfr-mechanism}
::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [IXFR Mechanism](#name-ixfr-mechanism){.section-name .selfRef} {#name-ixfr-mechanism}

The figure below provides an outline of the IXFR mechanism including
NOTIFYs.[¶](#section-5.2-1){.pilcrow}

[]{#name-ixfr-mechanism-2}

::: {#fig2}
::: {#section-5.2-2.1 .artwork .art-text .alignLeft}
       Secondary                            Primary

           |              NOTIFY               |
           | <-------------------------------- |  UDP
           | --------------------------------> |
           |          NOTIFY Response          |
           |                                   |
           |                                   |
           |            SOA Request            |
           | --------------------------------> |  UDP or TCP
           | <-------------------------------- |
           |           SOA Response            |
           |                                   |
           |                                   |
           |                                   |
           |            IXFR Request           |
           | --------------------------------> |  UDP or TCP
           | <-------------------------------- |
           |            IXFR Response          |
           |             (Zone data)           |
           |                                   |
           |                                   | ---
           |            IXFR Request           |    |
           | --------------------------------> |    | Retry over
           | <-------------------------------- |    | TCP if
           |            IXFR Response          |    | required
           |             (Zone data)           | ---
:::

[Figure 2](#figure-2){.selfRef}: [IXFR
Mechanism](#name-ixfr-mechanism-2){.selfRef}
:::

1.  [An IXFR is normally (but not always) preceded by a NOTIFY (over
    UDP) from the primary to the secondary. A secondary may also
    initiate an IXFR based on a refresh timer or scheduled/triggered
    zone maintenance.[¶](#section-5.2-3.1){.pilcrow}]{#section-5.2-3.1}
2.  [The secondary will normally (but not always) make an SOA query to
    the primary to obtain the serial number of the zone held by the
    primary.[¶](#section-5.2-3.2){.pilcrow}]{#section-5.2-3.2}
3.  [If the primary serial is higher than the secondary\'s serial (using
    Serial Number Arithmetic \[[RFC1982](#RFC1982){.xref}\]), the
    secondary makes an IXFR request to the primary, after which the
    primary sends an IXFR
    response.[¶](#section-5.2-3.3){.pilcrow}]{#section-5.2-3.3}

\[[RFC1995](#RFC1995){.xref}\] specifies that IXFR may use UDP if the
entire IXFR response can be contained in a single DNS packet, otherwise,
TCP is used. In fact, it says:[¶](#section-5.2-4){.pilcrow}

> Thus, a client should first make an IXFR query using
> UDP.[¶](#section-5.2-5){.pilcrow}

So there may be a fourth step above where the client falls back to IXFR
over TCP. There may also be an additional step where the secondary must
fall back to AXFR because, e.g., the primary does not support
IXFR.[¶](#section-5.2-6){.pilcrow}

However, it is noted that most of the widely used open-source
implementations of authoritative name servers (including both
\[[BIND](#BIND){.xref}\] and \[[NSD](#NSD){.xref}\]) do IXFR using TCP
by default in their latest releases. For BIND, TCP connections are
sometimes used for SOA queries, but, in general, they are not used
persistently and are closed after an IXFR is
completed.[¶](#section-5.2-7){.pilcrow}
:::
:::

::: {#data-leakage-of-notify-and-soa-message-exchanges}
::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [Data Leakage of NOTIFY and SOA Message Exchanges](#name-data-leakage-of-notify-and-){.section-name .selfRef} {#name-data-leakage-of-notify-and-}

This section presents a rationale for considering the encryption of the
other messages in the XFR mechanism.[¶](#section-5.3-1){.pilcrow}

Since the SOA of the published zone can be trivially discovered by
simply querying the publicly available authoritative servers, leakage of
this resource record (RR) via such a direct query is not discussed in
the following sections.[¶](#section-5.3-2){.pilcrow}

::: {#notify}
::: {#section-5.3.1 .section}
#### [5.3.1.](#section-5.3.1){.section-number .selfRef} [NOTIFY](#name-notify){.section-name .selfRef} {#name-notify}

Unencrypted NOTIFY messages identify configured secondaries on the
primary.[¶](#section-5.3.1-1){.pilcrow}

\[[RFC1996](#RFC1996){.xref}\] also
states:[¶](#section-5.3.1-2){.pilcrow}

> If ANCOUNT>0, then the answer section represents an unsecure hint at
> the new RRset for this
> \<QNAME,QCLASS,QTYPE>.[¶](#section-5.3.1-3){.pilcrow}

But since the only query type (QTYPE) for NOTIFY defined at the time of
this writing is SOA, this does not pose a potential
leak.[¶](#section-5.3.1-4){.pilcrow}
:::
:::

::: {#soa}
::: {#section-5.3.2 .section}
#### [5.3.2.](#section-5.3.2){.section-number .selfRef} [SOA](#name-soa){.section-name .selfRef} {#name-soa}

For hidden XFR servers (either primaries or secondaries), an SOA
response directly from that server only additionally leaks the degree of
SOA serial number lag of any downstream secondary of that
server.[¶](#section-5.3.2-1){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#updates-to-existing-specifications}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Updates to Existing Specifications](#name-updates-to-existing-specifi){.section-name .selfRef} {#name-updates-to-existing-specifi}

For convenience, the term \'XFR over TCP\' is used in this document to
mean both IXFR over TCP and AXFR over TCP; therefore, statements that
use that term update both \[[RFC1995](#RFC1995){.xref}\] and
\[[RFC5936](#RFC5936){.xref}\] and implicitly also apply to XoT.
Differences in behavior specific to XoT are discussed in [Section
7](#xot-specification){.xref}.[¶](#section-6-1){.pilcrow}

Both \[[RFC1995](#RFC1995){.xref}\] and \[[RFC5936](#RFC5936){.xref}\]
were published sometime before TCP became a widely supported transport
for DNS. \[[RFC1995](#RFC1995){.xref}\], in fact, says nothing with
respect to optimizing IXFRs over TCP or reusing already open TCP
connections to perform IXFRs or other queries. Therefore, there arguably
is an implicit assumption that a TCP connection is used for one and only
one IXFR request. Indeed, many major open-source implementations take
this approach (at the time of this writing). And whilst
\[[RFC5936](#RFC5936){.xref}\] gives guidance on connection reuse for
AXFR, it predates more recent specifications describing persistent TCP
connections (e.g., \[[RFC7766](#RFC7766){.xref}\],
\[[RFC7828](#RFC7828){.xref}\]), and AXFR implementations again often
make less-than-optimal use of open
connections.[¶](#section-6-2){.pilcrow}

Given this, new implementations of XoT will clearly benefit from
specific guidance on TCP/TLS connection usage for XFR, because this
will:[¶](#section-6-3){.pilcrow}

-   [result in more consistent XoT implementations with better
    interoperability and[¶](#section-6-4.1){.pilcrow}]{#section-6-4.1}
-   [remove any need for XoT implementations to support legacy behavior
    for XoT connections that XFR-over-TCP implementations have
    historically often
    supported.[¶](#section-6-4.2){.pilcrow}]{#section-6-4.2}

Therefore, this document updates both the previous specifications for
XFR over TCP (\[[RFC1995](#RFC1995){.xref}\] and
\[[RFC5936](#RFC5936){.xref}\]) to clarify
that:[¶](#section-6-5){.pilcrow}

-   [Implementations [MUST]{.bcp14} use \[[RFC7766](#RFC7766){.xref}\]
    (\"DNS Transport over TCP - Implementation Requirements\") to
    optimize the use of TCP
    connections.[¶](#section-6-6.1){.pilcrow}]{#section-6-6.1}
-   [Whilst \[[RFC7766](#RFC7766){.xref}\] states that \"DNS clients
    [SHOULD]{.bcp14} pipeline their queries\" on TCP connections, it did
    not distinguish between XFRs and other queries for this behavior. It
    is now recognized that XFRs are not as latency sensitive as other
    queries and can be significantly more complex for clients to handle,
    both because of the large amount of state that must be kept and
    because there may be multiple messages in the responses. For these
    reasons, it is clarified here that a valid reason for not pipelining
    queries is when they are all XFR queries, i.e., clients sending
    multiple XFRs [MAY]{.bcp14} choose not to pipeline those queries.
    Clients that do not pipeline XFR queries therefore have no
    additional requirements to handle out-of-order or intermingled
    responses (as described later), since they will never receive
    them.[¶](#section-6-6.2){.pilcrow}]{#section-6-6.2}
-   [Implementations [SHOULD]{.bcp14} use the edns-tcp-keepalive EDNS(0)
    option \[[RFC7828](#RFC7828){.xref}\] to manage persistent
    connections. This is more flexible than the alternative of simply
    using fixed timeouts.[¶](#section-6-6.3){.pilcrow}]{#section-6-6.3}

The following sections include detailed clarifications on the updates to
XFR behavior implied in \[[RFC7766](#RFC7766){.xref}\] and how the use
of \[[RFC7828](#RFC7828){.xref}\] applies specifically to XFR exchanges.
They also discuss how IXFR and AXFR can reuse the same TCP
connection.[¶](#section-6-7){.pilcrow}

For completeness, the recent specification of extended DNS error (EDE)
codes \[[RFC8914](#RFC8914){.xref}\] is also mentioned here. For zone
transfers, when returning REFUSED to a zone transfer request from an
\'unauthorized\' client (e.g., where the client is not listed in an ACL
for zone transfers or does not sign the request with a valid TSIG key),
the extended DNS error code 18 - Prohibited can also be
sent.[¶](#section-6-8){.pilcrow}

::: {#update-to-rfc1995-for-ixfr-over-tcp}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [Update to RFC 1995 for IXFR over TCP](#name-update-to-rfc-1995-for-ixfr){.section-name .selfRef} {#name-update-to-rfc-1995-for-ixfr}

For clarity, an IXFR-over-TCP server compliant with this specification
[MUST]{.bcp14} be able to handle multiple concurrent IXoT requests on a
single TCP connection (for the same and different zones) and
[SHOULD]{.bcp14} send the responses as soon as they are available, which
might be out of order compared to the
requests.[¶](#section-6.1-1){.pilcrow}
:::
:::

::: {#update-to-rfc5936-for-axfr-over-tcp}
::: {#section-6.2 .section}
### [6.2.](#section-6.2){.section-number .selfRef} [Update to RFC 5936 for AXFR over TCP](#name-update-to-rfc-5936-for-axfr){.section-name .selfRef} {#name-update-to-rfc-5936-for-axfr}

For clarity, an AXFR-over-TCP server compliant with this specification
[MUST]{.bcp14} be able to handle multiple concurrent AXoT sessions on a
single TCP connection (for the same and different zones). The response
streams for concurrent AXFRs [MAY]{.bcp14} be intermingled, and
AXFR-over-TCP clients compliant with this specification, which pipeline
AXFR requests, [MUST]{.bcp14} be able to handle
this.[¶](#section-6.2-1){.pilcrow}
:::
:::

::: {#updates-to-rfc1995-and-rfc5936-for-xfr-over-tcp}
::: {#section-6.3 .section}
### [6.3.](#section-6.3){.section-number .selfRef} [Updates to RFCs 1995 and 5936 for XFR over TCP](#name-updates-to-rfcs-1995-and-59){.section-name .selfRef} {#name-updates-to-rfcs-1995-and-59}

::: {#connection-reuse}
::: {#section-6.3.1 .section}
#### [6.3.1.](#section-6.3.1){.section-number .selfRef} [Connection Reuse](#name-connection-reuse){.section-name .selfRef} {#name-connection-reuse}

As specified, XFR-over-TCP clients [SHOULD]{.bcp14} reuse any existing
open TCP connection when starting any new XFR request to the same
primary, and for issuing SOA queries, instead of opening a new
connection. The number of TCP connections between a secondary and
primary [SHOULD]{.bcp14} be minimized (also see [Section
6.4](#update-to-rfc7766){.xref}).[¶](#section-6.3.1-1){.pilcrow}

Valid reasons for not reusing existing connections might
include:[¶](#section-6.3.1-2){.pilcrow}

-   [As already noted in \[[RFC7766](#RFC7766){.xref}\], separate
    connections for different zones might be preferred for operational
    reasons. In this case, the number of concurrent connections for zone
    transfers [SHOULD]{.bcp14} be limited to the total number of zones
    transferred between the client and
    server.[¶](#section-6.3.1-3.1){.pilcrow}]{#section-6.3.1-3.1}
-   [A configured limit for the number of outstanding queries or XFR
    requests allowed on a single TCP connection has been
    reached.[¶](#section-6.3.1-3.2){.pilcrow}]{#section-6.3.1-3.2}
-   [The message ID pool has already been exhausted on an open
    connection.[¶](#section-6.3.1-3.3){.pilcrow}]{#section-6.3.1-3.3}
-   [A large number of timeouts or slow responses have occurred on an
    open
    connection.[¶](#section-6.3.1-3.4){.pilcrow}]{#section-6.3.1-3.4}
-   [An edns-tcp-keepalive EDNS(0) option with a timeout of 0 has been
    received from the server, and the client is in the process of
    closing the connection (see [Section
    6.3.4](#the-edns-tcp-keepalive-edns0-option){.xref}).[¶](#section-6.3.1-3.5){.pilcrow}]{#section-6.3.1-3.5}

If no TCP connections are currently open, XFR clients [MAY]{.bcp14} send
SOA queries over UDP or a new TCP
connection.[¶](#section-6.3.1-4){.pilcrow}
:::
:::

::: {#axfrs-and-ixfrs-on-the-same-connection}
::: {#section-6.3.2 .section}
#### [6.3.2.](#section-6.3.2){.section-number .selfRef} [AXFRs and IXFRs on the Same Connection](#name-axfrs-and-ixfrs-on-the-same){.section-name .selfRef} {#name-axfrs-and-ixfrs-on-the-same}

Neither \[[RFC1995](#RFC1995){.xref}\] nor
\[[RFC5936](#RFC5936){.xref}\] explicitly discuss the use of a single
TCP connection for both IXFR and AXFR requests.
\[[RFC5936](#RFC5936){.xref}\] does make the general
statement:[¶](#section-6.3.2-1){.pilcrow}

> Non-AXFR session traffic can also use an open
> connection.[¶](#section-6.3.2-2){.pilcrow}

In this document, the above is clarified to indicate that
implementations capable of both AXFR and IXFR and compliant with this
specification [SHOULD]{.bcp14}:[¶](#section-6.3.2-3){.pilcrow}

-   [use the same TCP connection for both AXFR and IXFR requests to the
    same primary,[¶](#section-6.3.2-4.1){.pilcrow}]{#section-6.3.2-4.1}
-   [pipeline such requests (if they pipeline XFR requests in general)
    and [MAY]{.bcp14} intermingle them,
    and[¶](#section-6.3.2-4.2){.pilcrow}]{#section-6.3.2-4.2}
-   [send the response(s) for each request as soon as they are
    available, i.e., responses [MAY]{.bcp14} be sent
    intermingled.[¶](#section-6.3.2-4.3){.pilcrow}]{#section-6.3.2-4.3}

For some current implementations, adding all the above functionality
would introduce significant code complexity. In such a case, there will
need to be an assessment of the trade-off between that and the
performance benefits of the above for
XFR.[¶](#section-6.3.2-5){.pilcrow}
:::
:::

::: {#xfr-limits}
::: {#section-6.3.3 .section}
#### [6.3.3.](#section-6.3.3){.section-number .selfRef} [XFR Limits](#name-xfr-limits){.section-name .selfRef} {#name-xfr-limits}

The server [MAY]{.bcp14} limit the number of concurrent IXFRs, AXFRs, or
total XFR transfers in progress (or from a given secondary) to protect
server resources. Servers [SHOULD]{.bcp14} return SERVFAIL if this limit
is hit, since it is a transient error and a retry at a later time might
succeed (there is no previous specification for this
behavior).[¶](#section-6.3.3-1){.pilcrow}
:::
:::

::: {#the-edns-tcp-keepalive-edns0-option}
::: {#section-6.3.4 .section}
#### [6.3.4.](#section-6.3.4){.section-number .selfRef} [The edns-tcp-keepalive EDNS(0) Option](#name-the-edns-tcp-keepalive-edns){.section-name .selfRef} {#name-the-edns-tcp-keepalive-edns}

XFR clients that send the edns-tcp-keepalive EDNS(0) option on every XFR
request provide the server with maximum opportunity to update the
edns-tcp-keepalive timeout. The XFR server may use the frequency of
recent XFRs to calculate an average update rate as input to the decision
of what edns-tcp-keepalive timeout to use. If the server does not
support edns-tcp-keepalive, the client [MAY]{.bcp14} keep the connection
open for a few seconds (\[[RFC7766](#RFC7766){.xref}\] recommends that
servers use timeouts of at least a few
seconds).[¶](#section-6.3.4-1){.pilcrow}

Whilst the specification for EDNS(0) \[[RFC6891](#RFC6891){.xref}\] does
not specifically mention AXFRs, it does
say:[¶](#section-6.3.4-2){.pilcrow}

> If an OPT record is present in a received request, compliant
> responders [MUST]{.bcp14} include an OPT record in their respective
> responses.[¶](#section-6.3.4-3){.pilcrow}

In this document, the above is clarified to indicate that if an OPT
record is present in a received AXFR request, compliant responders
[MUST]{.bcp14} include an OPT record in each of the subsequent AXFR
responses. Note that this requirement, combined with the use of
edns-tcp-keepalive, enables AXFR servers to signal the desire to close a
connection (when existing transactions have competed) due to low
resources by sending an edns-tcp-keepalive EDNS(0) option with a timeout
of 0 on any AXFR response. This does not signal that the AXFR is
aborted, just that the server wishes to close the connection as soon as
possible.[¶](#section-6.3.4-4){.pilcrow}
:::
:::

::: {#backwards-compatibility}
::: {#section-6.3.5 .section}
#### [6.3.5.](#section-6.3.5){.section-number .selfRef} [Backwards Compatibility](#name-backwards-compatibility){.section-name .selfRef} {#name-backwards-compatibility}

Certain legacy behaviors were noted in \[[RFC5936](#RFC5936){.xref}\],
with provisions that implementations may want to offer options to
fallback to legacy behavior when interoperating with servers known to
not support \[[RFC5936](#RFC5936){.xref}\]. For purposes of
interoperability, IXFR and AXFR implementations may want to continue
offering such configuration options, as well as supporting some
behaviors that were underspecified prior to this work (e.g., performing
IXFR and AXFRs on separate connections). However, XoT connections should
have no need to do so.[¶](#section-6.3.5-1){.pilcrow}
:::
:::
:::
:::

::: {#update-to-rfc7766}
::: {#section-6.4 .section}
### [6.4.](#section-6.4){.section-number .selfRef} [Update to RFC 7766](#name-update-to-rfc-7766){.section-name .selfRef} {#name-update-to-rfc-7766}

\[[RFC7766](#RFC7766){.xref}\] made general implementation
recommendations with regard to TCP/TLS connection
handling:[¶](#section-6.4-1){.pilcrow}

> To mitigate the risk of unintentional server overload, DNS clients
> [MUST]{.bcp14} take care to minimize the number of concurrent TCP
> connections made to any individual server. It is [RECOMMENDED]{.bcp14}
> that for any given client/server interaction there [SHOULD]{.bcp14} be
> no more than one connection for regular queries, one for zone
> transfers, and one for each protocol that is being used on top of TCP
> (for example, if the resolver was using TLS). However, it is noted
> that certain primary/ secondary configurations with many busy zones
> might need to use more than one TCP connection for zone transfers for
> operational reasons (for example, to support concurrent transfers of
> multiple zones).[¶](#section-6.4-2){.pilcrow}

Whilst this recommends a particular behavior for the clients using TCP,
it does not relax the requirement for servers to handle \'mixed\'
traffic (regular queries and zone transfers) on any open TCP/TLS
connection. It also overlooks the potential that other transports might
want to take the same approach with regard to using separate connections
for different purposes.[¶](#section-6.4-3){.pilcrow}

This specification updates the above general guidance in
\[[RFC7766](#RFC7766){.xref}\] to provide the same separation of
connection purpose (regular queries and zone transfers) for all
transports being used on top of TCP.[¶](#section-6.4-4){.pilcrow}

Therefore, it is [RECOMMENDED]{.bcp14} that for each protocol used on
top of TCP in any given client/server interaction there [SHOULD]{.bcp14}
be no more than one connection for regular queries and one for zone
transfers.[¶](#section-6.4-5){.pilcrow}

As an illustration, it could be imagined that in the future such an
interaction could hypothetically include one or all of the
following:[¶](#section-6.4-6){.pilcrow}

-   [one TCP connection for regular
    queries[¶](#section-6.4-7.1){.pilcrow}]{#section-6.4-7.1}
-   [one TCP connection for zone
    transfers[¶](#section-6.4-7.2){.pilcrow}]{#section-6.4-7.2}
-   [one TLS connection for regular
    queries[¶](#section-6.4-7.3){.pilcrow}]{#section-6.4-7.3}
-   [one TLS connection for zone
    transfers[¶](#section-6.4-7.4){.pilcrow}]{#section-6.4-7.4}
-   [one DoH connection for regular
    queries[¶](#section-6.4-7.5){.pilcrow}]{#section-6.4-7.5}
-   [one DoH connection for zone
    transfers[¶](#section-6.4-7.6){.pilcrow}]{#section-6.4-7.6}

[Section 6.3.1](#connection-reuse){.xref} provides specific details of
the reasons why more than one connection for a given transport might be
required for zone transfers from a particular
client.[¶](#section-6.4-8){.pilcrow}
:::
:::
:::
:::

::: {#xot-specification}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [XoT Specification](#name-xot-specification){.section-name .selfRef} {#name-xot-specification}

::: {#connection-establishment}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Connection Establishment](#name-connection-establishment){.section-name .selfRef} {#name-connection-establishment}

During connection establishment, the Application-Layer Protocol
Negotiation (ALPN) token \"dot\" \[[DoT-ALPN](#DoT-ALPN){.xref}\]
[MUST]{.bcp14} be selected in the TLS
handshake.[¶](#section-7.1-1){.pilcrow}
:::
:::

::: {#tls-versions}
::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [TLS Versions](#name-tls-versions){.section-name .selfRef} {#name-tls-versions}

All implementations of this specification [MUST]{.bcp14} use only TLS
1.3 \[[RFC8446](#RFC8446){.xref}\] or
later.[¶](#section-7.2-1){.pilcrow}
:::
:::

::: {#port-selection}
::: {#section-7.3 .section}
### [7.3.](#section-7.3){.section-number .selfRef} [Port Selection](#name-port-selection){.section-name .selfRef} {#name-port-selection}

The connection for XoT [SHOULD]{.bcp14} be established using port 853,
as specified in \[[RFC7858](#RFC7858){.xref}\], unless there is mutual
agreement between the primary and secondary to use a port other than
port 853 for XoT. There [MAY]{.bcp14} be agreement to use different
ports for AXoT and IXoT or for different
zones.[¶](#section-7.3-1){.pilcrow}
:::
:::

::: {#high-level-xot-descriptions}
::: {#section-7.4 .section}
### [7.4.](#section-7.4){.section-number .selfRef} [High-Level XoT Descriptions](#name-high-level-xot-descriptions){.section-name .selfRef} {#name-high-level-xot-descriptions}

It is useful to note that in XoT it is the secondary that initiates the
TLS connection to the primary for an XFR request so that, in terms of
connectivity, the secondary is the TLS client and the primary is the TLS
server.[¶](#section-7.4-1){.pilcrow}

The figure below provides an outline of the AXoT mechanism including
NOTIFYs.[¶](#section-7.4-2){.pilcrow}

[]{#name-axot-mechanism}

::: {#fig3}
::: {#section-7.4-3.1 .artwork .art-text .alignLeft}
       Secondary                            Primary

           |              NOTIFY               |
           | <-------------------------------- |  UDP
           | --------------------------------> |
           |          NOTIFY Response          |
           |                                   |
           |                                   |
           |            SOA Request            |
           | --------------------------------> |  UDP (or part of
           | <-------------------------------- |  a TCP/TLS session)
           |           SOA Response            |
           |                                   |
           |                                   |
           |                                   |
           |            AXFR Request           | ---
           | --------------------------------> |   |
           | <-------------------------------- |   |
           |          AXFR Response 1          |   |
           |             (Zone data)           |   |
           |                                   |   |
           | <-------------------------------- |   | TLS
           |          AXFR Response 2          |   | Session
           |             (Zone data)           |   |
           |                                   |   |
           | <-------------------------------- |   |
           |          AXFR Response 3          |   |
           |             (Zone data)           | ---
           |                                   |
:::

[Figure 3](#figure-3){.selfRef}: [AXoT
Mechanism](#name-axot-mechanism){.selfRef}
:::

The figure below provides an outline of the IXoT mechanism including
NOTIFYs.[¶](#section-7.4-4){.pilcrow}

[]{#name-ixot-mechanism}

::: {#fig4}
::: {#section-7.4-5.1 .artwork .art-text .alignLeft}
       Secondary                            Primary

           |              NOTIFY               |
           | <-------------------------------- |  UDP
           | --------------------------------> |
           |          NOTIFY Response          |
           |                                   |
           |                                   |
           |            SOA Request            |
           | --------------------------------> |  UDP (or part of
           | <-------------------------------- |  a TCP/TLS session)
           |           SOA Response            |
           |                                   |
           |                                   |
           |                                   |
           |            IXFR Request           | ---
           | --------------------------------> |    |
           | <-------------------------------- |    |
           |            IXFR Response          |    |
           |             (Zone data)           |    |
           |                                   |    | TLS
           |                                   |    | session
           |            IXFR Request           |    |
           | --------------------------------> |    |
           | <-------------------------------- |    |
           |            IXFR Response          |    |
           |             (Zone data)           | ---
:::

[Figure 4](#figure-4){.selfRef}: [IXoT
Mechanism](#name-ixot-mechanism){.selfRef}
:::
:::
:::

::: {#xot-transfers}
::: {#section-7.5 .section}
### [7.5.](#section-7.5){.section-number .selfRef} [XoT Transfers](#name-xot-transfers){.section-name .selfRef} {#name-xot-transfers}

For a zone transfer between two endpoints to be considered protected
with XoT, all XFR requests and responses for that zone [MUST]{.bcp14} be
sent over TLS connections, where at a
minimum:[¶](#section-7.5-1){.pilcrow}

-   [The client [MUST]{.bcp14} authenticate the server by use of an
    authentication domain name using a Strict Privacy profile, as
    described in
    \[[RFC8310](#RFC8310){.xref}\].[¶](#section-7.5-2.1){.pilcrow}]{#section-7.5-2.1}

-   ::: {#section-7.5-2.2}
    The server [MUST]{.bcp14} validate the client is authorized to
    request or proxy a zone transfer by using one or both of the
    following methods:[¶](#section-7.5-2.2.1){.pilcrow}

    -   [mutual TLS
        (mTLS)[¶](#section-7.5-2.2.2.1){.pilcrow}]{#section-7.5-2.2.2.1}
    -   [an IP-based ACL (which can be either per message or per
        connection) combined with a valid TSIG/SIG(0) signature on the
        XFR
        request[¶](#section-7.5-2.2.2.2){.pilcrow}]{#section-7.5-2.2.2.2}
    :::

If only one method is selected, then mTLS is preferred because it
provides strong cryptographic protection at both
endpoints.[¶](#section-7.5-3){.pilcrow}

Authentication mechanisms are discussed in full in [Section
9](#authentication-mechanisms){.xref}, and the rationale for the above
requirement is discussed in [Section 10](#xot-authentication){.xref}.
Transfer group policies are discussed in [Section
11](#policies-for-both-axot-and-ixot){.xref}.[¶](#section-7.5-4){.pilcrow}
:::
:::

::: {#xot-connections}
::: {#section-7.6 .section}
### [7.6.](#section-7.6){.section-number .selfRef} [XoT Connections](#name-xot-connections){.section-name .selfRef} {#name-xot-connections}

The details in [Section 6](#updates-to-existing-specifications){.xref}
about, e.g., persistent connections and XFR message handling, are fully
applicable to XoT connections as well. However, any behavior specified
here takes precedence for XoT.[¶](#section-7.6-1){.pilcrow}

If no TLS connections are currently open, XoT clients [MAY]{.bcp14} send
SOA queries over UDP, TCP, or TLS.[¶](#section-7.6-2){.pilcrow}
:::
:::

::: {#xot-vs-adot}
::: {#section-7.7 .section}
### [7.7.](#section-7.7){.section-number .selfRef} [XoT vs. ADoT](#name-xot-vs-adot){.section-name .selfRef} {#name-xot-vs-adot}

As noted earlier, there is currently no specification for encryption of
connections from recursive resolvers to authoritative servers. Some
authoritative servers are experimenting with ADoT, and opportunistic
encryption has also been raised as a possibility; therefore, it is
highly likely that use of encryption by authoritative servers will
evolve in the coming years.[¶](#section-7.7-1){.pilcrow}

This raises questions in the short term with regard to TLS connection
and message handling for authoritative servers. In particular, there is
likely to be a class of authoritative servers that wish to use XoT in
the near future with a small number of configured secondaries but that
do not wish to support DoT for regular queries from recursives in that
same time frame. These servers have to potentially cope with probing and
direct queries from recursives and from test servers and also potential
attacks that might wish to make use of TLS to overload the
server.[¶](#section-7.7-2){.pilcrow}

\[[RFC5936](#RFC5936){.xref}\] clearly states that non-AXFR session
traffic can use an open connection; however, this requirement needs to
be reevaluated when considering the application of the same model to
XoT. Proposing that a server should also start responding to all queries
received over TLS just because it has enabled XoT would be equivalent to
defining a form of authoritative DoT. This specification does not
propose that, but it also does not prohibit servers from answering
queries unrelated to XFR exchanges over TLS. Rather, this specification
simply outlines in later sections:[¶](#section-7.7-3){.pilcrow}

-   [the utilization of EDE codes by XoT servers in response to queries
    on TLS connections that they are not willing to answer (see [Section
    7.8](#response-rcodes){.xref})[¶](#section-7.7-4.1){.pilcrow}]{#section-7.7-4.1}
-   [the operational and policy options that an operator of a XoT server
    has with regard to managing TLS connections and messages (see
    [Appendix
    A](#xot-server-connection-handling){.xref})[¶](#section-7.7-4.2){.pilcrow}]{#section-7.7-4.2}
:::
:::

::: {#response-rcodes}
::: {#section-7.8 .section}
### [7.8.](#section-7.8){.section-number .selfRef} [Response RCODES](#name-response-rcodes){.section-name .selfRef} {#name-response-rcodes}

XoT clients and servers [MUST]{.bcp14} implement EDE codes. If a XoT
server receives non-XoT traffic it is not willing to answer on a TLS
connection, it [SHOULD]{.bcp14} respond with REFUSED and the extended
DNS error code 21 - Not Supported \[[RFC8914](#RFC8914){.xref}\]. XoT
clients should not send any further queries of this type to the server
for a reasonable period of time (for example, one hour), i.e., long
enough that the server configuration or policy might be
updated.[¶](#section-7.8-1){.pilcrow}

Historically, servers have used the REFUSED RCODE for many situations;
therefore, clients often had no detailed information on which to base an
error or fallback path when queries were refused. As a result, the
client behavior could vary significantly. XoT servers that refuse
queries must cater to the fact that client behavior might vary from
continually retrying queries regardless of receiving REFUSED to every
query or, at the other extreme, clients may decide to stop using the
server over any transport. This might be because those clients are
either non-XoT clients or do not implement EDE
codes.[¶](#section-7.8-2){.pilcrow}
:::
:::

::: {#axot-specifics}
::: {#section-7.9 .section}
### [7.9.](#section-7.9){.section-number .selfRef} [AXoT Specifics](#name-axot-specifics){.section-name .selfRef} {#name-axot-specifics}

::: {#padding-axot-responses}
::: {#section-7.9.1 .section}
#### [7.9.1.](#section-7.9.1){.section-number .selfRef} [Padding AXoT Responses](#name-padding-axot-responses){.section-name .selfRef} {#name-padding-axot-responses}

The goal of padding AXoT responses is two
fold:[¶](#section-7.9.1-1){.pilcrow}

-   [to obfuscate the actual size of the transferred zone to minimize
    information leakage about the entire contents of the
    zone[¶](#section-7.9.1-2.1){.pilcrow}]{#section-7.9.1-2.1}
-   [to obfuscate the incremental changes to the zone between SOA
    updates to minimize information leakage about zone update activity
    and growth[¶](#section-7.9.1-2.2){.pilcrow}]{#section-7.9.1-2.2}

Note that the reuse of XoT connections for transfers of multiple
different zones slightly complicates any attempt to analyze the traffic
size and timing to extract information. Also, effective padding may
require the state to be kept because zones may grow and/or shrink over
time.[¶](#section-7.9.1-3){.pilcrow}

It is noted here that, depending on the padding policies eventually
developed for XoT, the requirement to obfuscate the total zone size
might require a server to create \'empty\' AXoT responses, that is, AXoT
responses that contain no RRs apart from an OPT RR containing the
EDNS(0) option for padding. For example, without this capability, the
maximum size that a tiny zone could be padded to would theoretically be
limited if there had to be a minimum of 1 RR per
packet.[¶](#section-7.9.1-4){.pilcrow}

However, as with existing AXFR, the last AXoT response message sent
[MUST]{.bcp14} contain the same SOA that was in the first message of the
AXoT response series in order to signal the conclusion of the zone
transfer.[¶](#section-7.9.1-5){.pilcrow}

\[[RFC5936](#RFC5936){.xref}\] says:[¶](#section-7.9.1-6){.pilcrow}

> Each AXFR response message [SHOULD]{.bcp14} contain a sufficient
> number of RRs to reasonably amortize the per-message overhead, up to
> the largest number that will fit within a DNS message (taking the
> required content of the other sections into account, as described
> below).[¶](#section-7.9.1-7){.pilcrow}

\'Empty\' AXoT responses generated in order to meet a padding
requirement will be exceptions to the above statement. For flexibility,
for future proofing, and in order to guarantee support for future
padding policies, it is stated here that secondary implementations
[MUST]{.bcp14} be resilient to receiving padded AXoT responses,
including \'empty\' AXoT responses that contain only an OPT RR
containing the EDNS(0) option for
padding.[¶](#section-7.9.1-8){.pilcrow}

Recommendations of specific policies for padding AXoT responses are out
of scope for this specification. Detailed considerations of such
policies and the trade-offs involved are expected to be the subject of
future work.[¶](#section-7.9.1-9){.pilcrow}
:::
:::
:::
:::

::: {#ixot-specifics}
::: {#section-7.10 .section}
### [7.10.](#section-7.10){.section-number .selfRef} [IXoT Specifics](#name-ixot-specifics){.section-name .selfRef} {#name-ixot-specifics}

::: {#condensation-of-responses}
::: {#section-7.10.1 .section}
#### [7.10.1.](#section-7.10.1){.section-number .selfRef} [Condensation of Responses](#name-condensation-of-responses){.section-name .selfRef} {#name-condensation-of-responses}

\[[RFC1995](#RFC1995){.xref}\] says that condensation of responses is
optional and [MAY]{.bcp14} be done. Whilst it does add complexity to
generating responses, it can significantly reduce the size of responses.
However, any such reduction might be offset by increased message size
due to padding. This specification does not update the optionality of
condensation for XoT responses.[¶](#section-7.10.1-1){.pilcrow}
:::
:::

::: {#fallback-to-axfr}
::: {#section-7.10.2 .section}
#### [7.10.2.](#section-7.10.2){.section-number .selfRef} [Fallback to AXFR](#name-fallback-to-axfr){.section-name .selfRef} {#name-fallback-to-axfr}

Fallback to AXFR can happen, for example, if the server is not able to
provide an IXFR for the requested SOA. Implementations differ in how
long they store zone deltas and how many may be stored at any one
time.[¶](#section-7.10.2-1){.pilcrow}

Just as with IXFR over TCP, after a failed IXFR, an IXoT client
[SHOULD]{.bcp14} request the AXFR on the already open XoT
connection.[¶](#section-7.10.2-2){.pilcrow}
:::
:::

::: {#padding-of-ixot-responses}
::: {#section-7.10.3 .section}
#### [7.10.3.](#section-7.10.3){.section-number .selfRef} [Padding of IXoT Responses](#name-padding-of-ixot-responses){.section-name .selfRef} {#name-padding-of-ixot-responses}

The goal of padding IXoT responses is to obfuscate the incremental
changes to the zone between SOA updates to minimize information leakage
about zone update activity and growth. Both the size and timing of the
IXoT responses could reveal information.[¶](#section-7.10.3-1){.pilcrow}

IXFR responses can vary greatly in size from the order of 100 bytes for
one or two record updates to tens of thousands of bytes for large,
dynamic DNSSEC-signed zones. The frequency of IXFR responses can also
depend greatly on if and how the zone is DNSSEC
signed.[¶](#section-7.10.3-2){.pilcrow}

In order to guarantee support for future padding policies, it is stated
here that secondary implementations [MUST]{.bcp14} be resilient to
receiving padded IXoT responses.[¶](#section-7.10.3-3){.pilcrow}

Recommendation of specific policies for padding IXoT responses are out
of scope for this specification. Detailed considerations of such padding
policies, the use of traffic obfuscation techniques (such as generating
fake XFR traffic), and the trade-offs involved are expected to be the
subject of future work.[¶](#section-7.10.3-4){.pilcrow}
:::
:::
:::
:::

::: {#name-compression-and-maximum-payload-sizes}
::: {#section-7.11 .section}
### [7.11.](#section-7.11){.section-number .selfRef} [Name Compression and Maximum Payload Sizes](#name-name-compression-and-maximu){.section-name .selfRef} {#name-name-compression-and-maximu}

It is noted here that name compression \[[RFC1035](#RFC1035){.xref}\]
can be used in XFR responses to reduce the size of the payload; however,
the maximum value of the offset that can be used in the name compression
pointer structure is 16384. For some DNS implementations, this limits
the size of an individual XFR response used in practice to something
around the order of 16 KB. In principle, larger payload sizes can be
supported for some responses with more sophisticated approaches (e.g.,
by precalculating the maximum offset
required).[¶](#section-7.11-1){.pilcrow}

Implementations may wish to offer options to disable name compression
for XoT responses to enable larger payloads. This might be particularly
helpful when padding is used, since minimizing the payload size is not
necessarily a useful optimization in this case and disabling name
compression will reduce the resources required to construct the
payload.[¶](#section-7.11-2){.pilcrow}
:::
:::
:::
:::

::: {#multi-primary-configurations}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Multi-primary Configurations](#name-multi-primary-configuration){.section-name .selfRef} {#name-multi-primary-configuration}

This model can provide flexibility and redundancy, particularly for
IXFR. A secondary will receive one or more NOTIFY messages and can send
an SOA to all of the configured primaries. It can then choose to send an
XFR request to the primary with the highest SOA (or based on other
criteria, e.g., RTT).[¶](#section-8-1){.pilcrow}

When using persistent connections, the secondary may have a XoT
connection already open to one or more primaries. Should a secondary
preferentially request an XFR from a primary to which it already has an
open XoT connection or the one with the highest SOA (assuming it
doesn\'t have a connection open to it
already)?[¶](#section-8-2){.pilcrow}

Two extremes can be envisaged here. The first one can be considered a
\'preferred primary connection\' model. In this case, the secondary
continues to use one persistent connection to a single primary until it
has reason not to. Reasons not to might include the primary repeatedly
closing the connection, long query/response RTTs on transfers, or the
SOA of the primary being an unacceptable lag behind the SOA of an
alternative primary.[¶](#section-8-3){.pilcrow}

The other extreme can be considered a \'parallel primary connection\'
model. Here, a secondary could keep multiple persistent connections open
to all available primaries and only request XFRs from the primary with
the highest serial number. Since normally the number of secondaries and
primaries in direct contact in a transfer group is reasonably low, this
might be feasible if latency is the most significant
concern.[¶](#section-8-4){.pilcrow}

Recommendation of a particular scheme is out of scope of this document,
but implementations are encouraged to provide configuration options that
allow operators to make choices about this
behavior.[¶](#section-8-5){.pilcrow}
:::
:::

::: {#authentication-mechanisms}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [Authentication Mechanisms](#name-authentication-mechanisms){.section-name .selfRef} {#name-authentication-mechanisms}

To provide context to the requirements in [Section
7.5](#xot-transfers){.xref}, this section provides a brief summary of
some of the existing authentication and validation mechanisms (both
transport independent and TLS specific) that are available when
performing zone transfers. [Section 10](#xot-authentication){.xref} then
discusses in more detail specifically how a combination of TLS
authentication, TSIG, and IP-based ACLs interact for
XoT.[¶](#section-9-1){.pilcrow}

In this document, the mechanisms are classified based on the following
properties:[¶](#section-9-2){.pilcrow}

[]{.break}

Data Origin Authentication (DO):
:   Authentication 1) of the fact that the DNS message originated from
    the party with whom credentials were shared and 2) of the data
    integrity of the message contents (the originating party may or may
    not be the party operating the far end of a TCP/TLS connection in a
    \'proxy\' scenario).[¶](#section-9-3.2){.pilcrow}
:   

Channel Confidentiality (CC):
:   Confidentiality of the communication channel between the client and
    server (i.e., the two endpoints of a TCP/TLS connection) from
    passive surveillance.[¶](#section-9-3.4){.pilcrow}
:   

Channel Authentication (CA):
:   Authentication of the identity of the party to whom a TCP/TLS
    connection is made (this might not be a direct connection between
    the primary and secondary in a proxy
    scenario).[¶](#section-9-3.6){.pilcrow}
:   

::: {#tsig}
::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [TSIG](#name-tsig){.section-name .selfRef} {#name-tsig}

TSIG \[[RFC8945](#RFC8945){.xref}\] provides a mechanism for two or more
parties to use shared secret keys that can then be used to create a
message digest to protect individual DNS messages. This allows each
party to authenticate that a request or response (and the data in it)
came from the other party, even if it was transmitted over an unsecured
channel or via a proxy.[¶](#section-9.1-1){.pilcrow}

[]{.break}

Properties:
:   Data origin authentication.[¶](#section-9.1-2.2){.pilcrow}
:   
:::
:::

::: {#sig-0}
::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [SIG(0)](#name-sig0){.section-name .selfRef} {#name-sig0}

SIG(0) \[[RFC2931](#RFC2931){.xref}\] similarly provides a mechanism to
digitally sign a DNS message but uses public key authentication, where
the public keys are stored in DNS as KEY RRs and a private key is stored
at the signer.[¶](#section-9.2-1){.pilcrow}

[]{.break}

Properties:
:   Data origin authentication.[¶](#section-9.2-2.2){.pilcrow}
:   
:::
:::

::: {#tls}
::: {#section-9.3 .section}
### [9.3.](#section-9.3){.section-number .selfRef} [TLS](#name-tls){.section-name .selfRef} {#name-tls}

::: {#opportunistic-tls}
::: {#section-9.3.1 .section}
#### [9.3.1.](#section-9.3.1){.section-number .selfRef} [Opportunistic TLS](#name-opportunistic-tls){.section-name .selfRef} {#name-opportunistic-tls}

Opportunistic TLS for DoT is defined in \[[RFC8310](#RFC8310){.xref}\]
and can provide a defense against passive surveillance, providing
on-the-wire confidentiality. Essentially:[¶](#section-9.3.1-1){.pilcrow}

-   [if clients know authentication information for a server, they
    [SHOULD]{.bcp14} try to authenticate the
    server,[¶](#section-9.3.1-2.1){.pilcrow}]{#section-9.3.1-2.1}
-   [if this fails or clients do not know the information, they
    [MAY]{.bcp14} fallback to using TLS without authentication,
    or[¶](#section-9.3.1-2.2){.pilcrow}]{#section-9.3.1-2.2}
-   [clients [MAY]{.bcp14} fallback to using cleartext if TLS is not
    available.[¶](#section-9.3.1-2.3){.pilcrow}]{#section-9.3.1-2.3}

As such, it does not offer a defense against active attacks (e.g., an
on-path active attacker on the connection from client to server) and is
not considered as useful for XoT.[¶](#section-9.3.1-3){.pilcrow}

[]{.break}

Properties:
:   None guaranteed.[¶](#section-9.3.1-4.2){.pilcrow}
:   
:::
:::

::: {#strict-tls}
::: {#section-9.3.2 .section}
#### [9.3.2.](#section-9.3.2){.section-number .selfRef} [Strict TLS](#name-strict-tls){.section-name .selfRef} {#name-strict-tls}

Strict TLS for DoT \[[RFC8310](#RFC8310){.xref}\] requires that a client
is configured with an authentication domain name (and/or Subject Public
Key Info (SPKI) pin set) that [MUST]{.bcp14} be used to authenticate the
TLS handshake with the server. If authentication of the server fails,
the client will not proceed with the connection. This provides a defense
for the client against active surveillance, providing client-to-server
authentication and end-to-end channel
confidentiality.[¶](#section-9.3.2-1){.pilcrow}

[]{.break}

Properties:
:   Channel confidentiality and channel authentication (of the
    server).[¶](#section-9.3.2-2.2){.pilcrow}
:   
:::
:::

::: {#mutual-tls}
::: {#section-9.3.3 .section}
#### [9.3.3.](#section-9.3.3){.section-number .selfRef} [Mutual TLS](#name-mutual-tls){.section-name .selfRef} {#name-mutual-tls}

This is an extension to Strict TLS \[[RFC8310](#RFC8310){.xref}\] that
requires that a client is configured with an authentication domain name
(and/or SPKI pin set) and a client certificate. The client offers the
certificate for authentication by the server, and the client can
authenticate the server the same way as in Strict TLS. This provides a
defense for both parties against active surveillance, providing
bidirectional authentication and end-to-end channel
confidentiality.[¶](#section-9.3.3-1){.pilcrow}

[]{.break}

Properties:
:   Channel confidentiality and mutual channel
    authentication.[¶](#section-9.3.3-2.2){.pilcrow}
:   
:::
:::
:::
:::

::: {#ip-based-acl-on-the-primary}
::: {#section-9.4 .section}
### [9.4.](#section-9.4){.section-number .selfRef} [IP-Based ACL on the Primary](#name-ip-based-acl-on-the-primary){.section-name .selfRef} {#name-ip-based-acl-on-the-primary}

Most DNS server implementations offer an option to configure an IP-based
ACL, which is often used in combination with TSIG-based ACLs to restrict
access to zone transfers on primary servers on a per-query
basis.[¶](#section-9.4-1){.pilcrow}

This is also possible with XoT, but it must be noted that, as with TCP,
the implementation of such an ACL cannot be enforced on the primary
until an XFR request is received on an established
connection.[¶](#section-9.4-2){.pilcrow}

As discussed in [Appendix A](#xot-server-connection-handling){.xref}, an
IP-based per-connection ACL could also be implemented where only TLS
connections from recognized secondaries are
accepted.[¶](#section-9.4-3){.pilcrow}

[]{.break}

Properties:
:   Channel authentication of the client.[¶](#section-9.4-4.2){.pilcrow}
:   
:::
:::

::: {#zonemd}
::: {#section-9.5 .section}
### [9.5.](#section-9.5){.section-number .selfRef} [ZONEMD](#name-zonemd){.section-name .selfRef} {#name-zonemd}

For completeness, ZONEMD \[[RFC8976](#RFC8976){.xref}\] (\"Message
Digest for DNS Zones\") is described here. The ZONEMD message digest is
a mechanism that can be used to verify the content of a standalone zone.
It is designed to be independent of the transmission channel or
mechanism, allowing a general consumer of a zone to do origin
authentication of the entire zone contents. Note that the current
version of \[[RFC8976](#RFC8976){.xref}\]
states:[¶](#section-9.5-1){.pilcrow}

> As specified herein, ZONEMD is impractical for large, dynamic zones
> due to the time and resources required for digest calculation.
> However, the ZONEMD record is extensible so that new digest schemes
> may be added in the future to support large, dynamic
> zones.[¶](#section-9.5-2){.pilcrow}

It is complementary but orthogonal to the above mechanisms and can be
used in conjunction with XoT but is not considered further
here.[¶](#section-9.5-3){.pilcrow}
:::
:::
:::
:::

::: {#xot-authentication}
::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [XoT Authentication](#name-xot-authentication){.section-name .selfRef} {#name-xot-authentication}

It is noted that zone transfer scenarios can vary from a simple single
primary/secondary relationship where both servers are under the control
of a single operator to a complex hierarchical structure that includes
proxies and multiple operators. Each deployment scenario will require
specific analysis to determine which combination of authentication
methods are best suited to the deployment model in
question.[¶](#section-10-1){.pilcrow}

The XoT authentication requirement specified in [Section
7.5](#xot-transfers){.xref} addresses the issue of ensuring that the
transfers are encrypted between the two endpoints directly involved in
the current transfers. The following table summarizes the properties of
a selection of the mechanisms discussed in [Section
9](#authentication-mechanisms){.xref}. The two-letter abbreviations for
the properties are used below: (S) indicates the secondary and (P)
indicates the primary.[¶](#section-10-2){.pilcrow}

[]{#name-properties-of-authenticatio}

::: {#table1}
  Method           DO(S)   CC(S)   CA(S)   DO(P)   CC(P)   CA(P)
  ---------------- ------- ------- ------- ------- ------- -------
  Strict TLS               Y       Y               Y       
  Mutual TLS               Y       Y               Y       Y
  ACL on primary                                           Y
  TSIG             Y                       Y               

  : [Table 1](#table-1){.selfRef}: [Properties of Authentication Methods
  for XoT](#name-properties-of-authenticatio){.selfRef}
:::

Based on this analysis, it can be seen that:[¶](#section-10-4){.pilcrow}

-   [Using just mutual TLS can be considered a standalone solution since
    both endpoints are cryptographically
    authenticated.[¶](#section-10-5.1){.pilcrow}]{#section-10-5.1}
-   [Using secondary-side Strict TLS with a primary-side IP-based ACL
    and TSIG/SIG(0) combination provides sufficient protection to be
    acceptable.[¶](#section-10-5.2){.pilcrow}]{#section-10-5.2}

Using just an IP-based ACL could be susceptible to attacks that can
spoof TCP IP addresses; using TSIG/SIG(0) alone could be susceptible to
attacks that were able to capture such messages should they be
accidentally sent in cleartext by any server with the
key.[¶](#section-10-6){.pilcrow}
:::
:::

::: {#policies-for-both-axot-and-ixot}
::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [Policies for Both AXoT and IXoT](#name-policies-for-both-axot-and-){.section-name .selfRef} {#name-policies-for-both-axot-and-}

Whilst the protection of the zone contents in a transfer between two
endpoints can be provided by the XoT protocol, the protection of all the
transfers of a given zone requires operational administration and policy
management.[¶](#section-11-1){.pilcrow}

The entire group of servers involved in XFR for a particular set of
zones (all the primaries and all the secondaries) is called the
\'transfer group\'.[¶](#section-11-2){.pilcrow}

In order to assure the confidentiality of the zone information, the
entire transfer group [MUST]{.bcp14} have a consistent policy of using
XoT. If any do not, this is a weak link for attackers to exploit. For
clarification, this means that within any transfer group both AXFRs and
IXFRs for a zone [MUST]{.bcp14} all use XoT.[¶](#section-11-3){.pilcrow}

An individual zone transfer is not considered protected by XoT unless
both the client and server are configured to use only XoT, and the
overall zone transfer is not considered protected until all members of
the transfer group are configured to use only XoT with all other
transfers servers (see [Section
12](#implementation-considerations){.xref}).[¶](#section-11-4){.pilcrow}

A XoT policy [MUST]{.bcp14} specify if:[¶](#section-11-5){.pilcrow}

-   [mutual TLS is used
    and/or[¶](#section-11-6.1){.pilcrow}]{#section-11-6.1}
-   [an IP-based ACL and TSIG/SIG(0) combination is
    used.[¶](#section-11-6.2){.pilcrow}]{#section-11-6.2}

Since this may require configuration of a number of servers who may be
under the control of different operators, the desired consistency could
be hard to enforce and audit in practice.[¶](#section-11-7){.pilcrow}

Certain aspects of the policies can be relatively easy to test
independently, e.g., by requesting zone transfers without TSIG, from
unauthorized IP addresses or over cleartext DNS. Other aspects, such as
if a secondary will accept data without a TSIG digest or if secondaries
are using Strict as opposed to Opportunistic TLS, are more
challenging.[¶](#section-11-8){.pilcrow}

The mechanics of coordinating or enforcing such policies are out of the
scope of this document but may be the subject of future operational
guidance.[¶](#section-11-9){.pilcrow}
:::
:::

::: {#implementation-considerations}
::: {#section-12 .section}
## [12.](#section-12){.section-number .selfRef} [Implementation Considerations](#name-implementation-consideratio){.section-name .selfRef} {#name-implementation-consideratio}

Server implementations may want to also offer options that allow ACLs on
a zone to specify that a specific client can use either XoT or TCP. This
would allow for flexibility while clients are migrating to
XoT.[¶](#section-12-1){.pilcrow}

Client implementations may similarly want to offer options to cater to
the multi-primary case where the primaries are migrating to
XoT.[¶](#section-12-2){.pilcrow}
:::
:::

::: {#operational-considerations}
::: {#section-13 .section}
## [13.](#section-13){.section-number .selfRef} [Operational Considerations](#name-operational-considerations){.section-name .selfRef} {#name-operational-considerations}

If the options described in [Section
12](#implementation-considerations){.xref} are available, such
configuration options [MUST]{.bcp14} only be used in a \'migration
mode\' and therefore should be used with great
care.[¶](#section-13-1){.pilcrow}

It is noted that use of a TLS proxy in front of the primary server is a
simple deployment solution that can enable server-side
XoT.[¶](#section-13-2){.pilcrow}
:::
:::

::: {#iana-considerations}
::: {#section-14 .section}
## [14.](#section-14){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-14-1){.pilcrow}
:::
:::

::: {#security-considerations}
::: {#section-15 .section}
## [15.](#section-15){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

This document specifies a security measure against a DNS risk: the risk
that an attacker collects entire DNS zones through eavesdropping on
cleartext DNS zone transfers.[¶](#section-15-1){.pilcrow}

This does not mitigate:[¶](#section-15-2){.pilcrow}

-   [the risk that some level of zone activity might be inferred by
    observing zone transfer sizes and timing on encrypted connections
    (even with padding applied), in combination with obtaining SOA
    records by directly querying authoritative
    servers,[¶](#section-15-3.1){.pilcrow}]{#section-15-3.1}
-   [the risk that hidden primaries might be inferred or identified via
    observation of encrypted connections,
    or[¶](#section-15-3.2){.pilcrow}]{#section-15-3.2}
-   [the risk of zone contents being obtained via zone enumeration
    techniques.[¶](#section-15-3.3){.pilcrow}]{#section-15-3.3}

Security concerns of DoT are outlined in \[[RFC7858](#RFC7858){.xref}\]
and \[[RFC8310](#RFC8310){.xref}\].[¶](#section-15-4){.pilcrow}
:::
:::

::: {#section-16 .section}
## [16.](#section-16){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-16.1 .section}
### [16.1.](#section-16.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[DoT-ALPN\]
:   [IANA]{.refAuthor}, [\"TLS Application-Layer Protocol Negotiation
    (ALPN) Protocol IDs\"]{.refTitle},
    \<<https://www.iana.org/assignments/tls-extensiontype-values/>\>.
:   

\[RFC1034\]
:   [Mockapetris, P.]{.refAuthor}, [\"Domain names - concepts and
    facilities\"]{.refTitle}, [STD 13]{.seriesInfo}, [RFC
    1034]{.seriesInfo}, [DOI 10.17487/RFC1034]{.seriesInfo}, November
    1987, \<<https://www.rfc-editor.org/info/rfc1034>\>.
:   

\[RFC1035\]
:   [Mockapetris, P.]{.refAuthor}, [\"Domain names - implementation and
    specification\"]{.refTitle}, [STD 13]{.seriesInfo}, [RFC
    1035]{.seriesInfo}, [DOI 10.17487/RFC1035]{.seriesInfo}, November
    1987, \<<https://www.rfc-editor.org/info/rfc1035>\>.
:   

\[RFC1995\]
:   [Ohta, M.]{.refAuthor}, [\"Incremental Zone Transfer in
    DNS\"]{.refTitle}, [RFC 1995]{.seriesInfo}, [DOI
    10.17487/RFC1995]{.seriesInfo}, August 1996,
    \<<https://www.rfc-editor.org/info/rfc1995>\>.
:   

\[RFC1996\]
:   [Vixie, P.]{.refAuthor}, [\"A Mechanism for Prompt Notification of
    Zone Changes (DNS NOTIFY)\"]{.refTitle}, [RFC 1996]{.seriesInfo},
    [DOI 10.17487/RFC1996]{.seriesInfo}, August 1996,
    \<<https://www.rfc-editor.org/info/rfc1996>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC2931\]
:   [Eastlake 3rd, D.]{.refAuthor}, [\"DNS Request and Transaction
    Signatures ( SIG(0)s )\"]{.refTitle}, [RFC 2931]{.seriesInfo}, [DOI
    10.17487/RFC2931]{.seriesInfo}, September 2000,
    \<<https://www.rfc-editor.org/info/rfc2931>\>.
:   

\[RFC5936\]
:   [Lewis, E.]{.refAuthor} and [A. Hoenes, Ed.]{.refAuthor}, [\"DNS
    Zone Transfer Protocol (AXFR)\"]{.refTitle}, [RFC
    5936]{.seriesInfo}, [DOI 10.17487/RFC5936]{.seriesInfo}, June 2010,
    \<<https://www.rfc-editor.org/info/rfc5936>\>.
:   

\[RFC6973\]
:   [Cooper, A.]{.refAuthor}, [Tschofenig, H.]{.refAuthor},
    [Aboba, B.]{.refAuthor}, [Peterson, J.]{.refAuthor},
    [Morris, J.]{.refAuthor}, [Hansen, M.]{.refAuthor}, and [R.
    Smith]{.refAuthor}, [\"Privacy Considerations for Internet
    Protocols\"]{.refTitle}, [RFC 6973]{.seriesInfo}, [DOI
    10.17487/RFC6973]{.seriesInfo}, July 2013,
    \<<https://www.rfc-editor.org/info/rfc6973>\>.
:   

\[RFC7766\]
:   [Dickinson, J.]{.refAuthor}, [Dickinson, S.]{.refAuthor},
    [Bellis, R.]{.refAuthor}, [Mankin, A.]{.refAuthor}, and [D.
    Wessels]{.refAuthor}, [\"DNS Transport over TCP - Implementation
    Requirements\"]{.refTitle}, [RFC 7766]{.seriesInfo}, [DOI
    10.17487/RFC7766]{.seriesInfo}, March 2016,
    \<<https://www.rfc-editor.org/info/rfc7766>\>.
:   

\[RFC7828\]
:   [Wouters, P.]{.refAuthor}, [Abley, J.]{.refAuthor},
    [Dickinson, S.]{.refAuthor}, and [R. Bellis]{.refAuthor}, [\"The
    edns-tcp-keepalive EDNS0 Option\"]{.refTitle}, [RFC
    7828]{.seriesInfo}, [DOI 10.17487/RFC7828]{.seriesInfo}, April 2016,
    \<<https://www.rfc-editor.org/info/rfc7828>\>.
:   

\[RFC7858\]
:   [Hu, Z.]{.refAuthor}, [Zhu, L.]{.refAuthor},
    [Heidemann, J.]{.refAuthor}, [Mankin, A.]{.refAuthor},
    [Wessels, D.]{.refAuthor}, and [P. Hoffman]{.refAuthor},
    [\"Specification for DNS over Transport Layer Security
    (TLS)\"]{.refTitle}, [RFC 7858]{.seriesInfo}, [DOI
    10.17487/RFC7858]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7858>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8310\]
:   [Dickinson, S.]{.refAuthor}, [Gillmor, D.]{.refAuthor}, and [T.
    Reddy]{.refAuthor}, [\"Usage Profiles for DNS over TLS and DNS over
    DTLS\"]{.refTitle}, [RFC 8310]{.seriesInfo}, [DOI
    10.17487/RFC8310]{.seriesInfo}, March 2018,
    \<<https://www.rfc-editor.org/info/rfc8310>\>.
:   

\[RFC8446\]
:   [Rescorla, E.]{.refAuthor}, [\"The Transport Layer Security (TLS)
    Protocol Version 1.3\"]{.refTitle}, [RFC 8446]{.seriesInfo}, [DOI
    10.17487/RFC8446]{.seriesInfo}, August 2018,
    \<<https://www.rfc-editor.org/info/rfc8446>\>.
:   

\[RFC8499\]
:   [Hoffman, P.]{.refAuthor}, [Sullivan, A.]{.refAuthor}, and [K.
    Fujiwara]{.refAuthor}, [\"DNS Terminology\"]{.refTitle}, [BCP
    219]{.seriesInfo}, [RFC 8499]{.seriesInfo}, [DOI
    10.17487/RFC8499]{.seriesInfo}, January 2019,
    \<<https://www.rfc-editor.org/info/rfc8499>\>.
:   

\[RFC8914\]
:   [Kumari, W.]{.refAuthor}, [Hunt, E.]{.refAuthor},
    [Arends, R.]{.refAuthor}, [Hardaker, W.]{.refAuthor}, and [D.
    Lawrence]{.refAuthor}, [\"Extended DNS Errors\"]{.refTitle}, [RFC
    8914]{.seriesInfo}, [DOI 10.17487/RFC8914]{.seriesInfo}, October
    2020, \<<https://www.rfc-editor.org/info/rfc8914>\>.
:   

\[RFC8945\]
:   [Dupont, F.]{.refAuthor}, [Morris, S.]{.refAuthor},
    [Vixie, P.]{.refAuthor}, [Eastlake 3rd, D.]{.refAuthor},
    [Gudmundsson, O.]{.refAuthor}, and [B. Wellington]{.refAuthor},
    [\"Secret Key Transaction Authentication for DNS
    (TSIG)\"]{.refTitle}, [STD 93]{.seriesInfo}, [RFC
    8945]{.seriesInfo}, [DOI 10.17487/RFC8945]{.seriesInfo}, November
    2020, \<<https://www.rfc-editor.org/info/rfc8945>\>.
:   
:::

::: {#section-16.2 .section}
### [16.2.](#section-16.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[BIND\]
:   [ISC]{.refAuthor}, [\"BIND 9.16.16\"]{.refTitle},
    \<<https://www.isc.org/bind/>\>.
:   

\[DPRIVE-DNSOQUIC\]
:   [Huitema, C.]{.refAuthor}, [Dickinson, S.]{.refAuthor}, and [A.
    Mankin]{.refAuthor}, [\"Specification of DNS over Dedicated QUIC
    Connections\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-ietf-dprive-dnsoquic-03]{.seriesInfo}, 12
    July 2021,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-dprive-dnsoquic-03>\>.
:   

\[NIST-GUIDE\]
:   [Chandramouli, R.]{.refAuthor} and [S. Rose]{.refAuthor}, [\"Secure
    Domain Name System (DNS) Deployment Guide\"]{.refTitle}, September
    2013,
    \<<https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-81-2.pdf>\>.
:   

\[NSD\]
:   [NLnet Labs]{.refAuthor}, [\"NSD 4.3.6\"]{.refTitle},
    \<<https://www.nlnetlabs.nl/projects/nsd/about/>\>.
:   

\[NSEC3-attacks\]
:   [Goldberg, S.]{.refAuthor}, [Naor, N.]{.refAuthor},
    [Papadopoulos, D.]{.refAuthor}, [Reyzin, L.]{.refAuthor},
    [Vasant, S.]{.refAuthor}, and [A. Ziv]{.refAuthor}, [\"Stretching
    NSEC3 to the Limit: Efficient Zone Enumeration Attacks on NSEC3
    Variants\"]{.refTitle}, February 2015,
    \<<https://www.cs.bu.edu/~goldbe/papers/nsec3attacks.pdf>\>.
:   

\[NSEC5\]
:   [Vcelak, J.]{.refAuthor}, [Goldberg, S.]{.refAuthor},
    [Papadopoulos, D.]{.refAuthor}, [Huque, S.]{.refAuthor}, and [D.
    Lawrence]{.refAuthor}, [\"NSEC5, DNSSEC Authenticated Denial of
    Existence\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-vcelak-nsec5-08]{.seriesInfo}, 29 December
    2018,
    \<<https://datatracker.ietf.org/doc/html/draft-vcelak-nsec5-08>\>.
:   

\[RFC1982\]
:   [Elz, R.]{.refAuthor} and [R. Bush]{.refAuthor}, [\"Serial Number
    Arithmetic\"]{.refTitle}, [RFC 1982]{.seriesInfo}, [DOI
    10.17487/RFC1982]{.seriesInfo}, August 1996,
    \<<https://www.rfc-editor.org/info/rfc1982>\>.
:   

\[RFC5155\]
:   [Laurie, B.]{.refAuthor}, [Sisson, G.]{.refAuthor},
    [Arends, R.]{.refAuthor}, and [D. Blacka]{.refAuthor}, [\"DNS
    Security (DNSSEC) Hashed Authenticated Denial of
    Existence\"]{.refTitle}, [RFC 5155]{.seriesInfo}, [DOI
    10.17487/RFC5155]{.seriesInfo}, March 2008,
    \<<https://www.rfc-editor.org/info/rfc5155>\>.
:   

\[RFC6891\]
:   [Damas, J.]{.refAuthor}, [Graff, M.]{.refAuthor}, and [P.
    Vixie]{.refAuthor}, [\"Extension Mechanisms for DNS
    (EDNS(0))\"]{.refTitle}, [STD 75]{.seriesInfo}, [RFC
    6891]{.seriesInfo}, [DOI 10.17487/RFC6891]{.seriesInfo}, April 2013,
    \<<https://www.rfc-editor.org/info/rfc6891>\>.
:   

\[RFC8484\]
:   [Hoffman, P.]{.refAuthor} and [P. McManus]{.refAuthor}, [\"DNS
    Queries over HTTPS (DoH)\"]{.refTitle}, [RFC 8484]{.seriesInfo},
    [DOI 10.17487/RFC8484]{.seriesInfo}, October 2018,
    \<<https://www.rfc-editor.org/info/rfc8484>\>.
:   

\[RFC8976\]
:   [Wessels, D.]{.refAuthor}, [Barber, P.]{.refAuthor},
    [Weinberg, M.]{.refAuthor}, [Kumari, W.]{.refAuthor}, and [W.
    Hardaker]{.refAuthor}, [\"Message Digest for DNS
    Zones\"]{.refTitle}, [RFC 8976]{.seriesInfo}, [DOI
    10.17487/RFC8976]{.seriesInfo}, February 2021,
    \<<https://www.rfc-editor.org/info/rfc8976>\>.
:   

\[RFC9076\]
:   [Wicinski, T., Ed.]{.refAuthor}, [\"DNS Privacy
    Considerations\"]{.refTitle}, [RFC 9076]{.seriesInfo}, [DOI
    10.17487/RFC9076]{.seriesInfo}, July 2021,
    \<<https://www.rfc-editor.org/info/rfc9076>\>.
:   

\[TLS-ESNI\]
:   [Rescorla, E.]{.refAuthor}, [Oku, K.]{.refAuthor},
    [Sullivan, N.]{.refAuthor}, and [C. A. Wood]{.refAuthor}, [\"TLS
    Encrypted Client Hello\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-ietf-tls-esni-13]{.seriesInfo}, 12 August 2021,
    \<<https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni-13>\>.
:   
:::
:::

::: {#xot-server-connection-handling}
::: {#appendix-A .section}
## [Appendix A.](#appendix-A){.section-number .selfRef} [XoT Server Connection Handling](#name-xot-server-connection-handl){.section-name .selfRef} {#name-xot-server-connection-handl}

This appendix provides a non-normative outline of the pros and cons of
XoT server connection-handling options.[¶](#appendix-A-1){.pilcrow}

For completeness, it is noted that an earlier draft version of this
document suggested using a XoT-specific ALPN to negotiate TLS
connections that supported only a limited set of queries (SOA, XFRs);
however, this did not gain support. Reasons given included additional
code complexity and the fact that XoT and ADoT are both DNS wire format
and so should share the `dot` ALPN.[¶](#appendix-A-2){.pilcrow}

::: {#only-listen-on-tls-on-a-specific-ip-address}
::: {#appendix-A.1 .section}
### [A.1.](#appendix-A.1){.section-number .selfRef} [Listening Only on a Specific IP Address for TLS](#name-listening-only-on-a-specifi){.section-name .selfRef} {#name-listening-only-on-a-specifi}

Obviously, a name server that hosts a zone and services queries for the
zone on an IP address published in an NS record may wish to use a
separate IP address for XoT to listen for TLS, only publishing that
address to its secondaries.[¶](#appendix-A.1-1){.pilcrow}

[]{.break}

Pros:
:   Probing of the public IP address will show no support for TLS. ACLs
    will prevent zone transfer on all transports on a per-query
    basis.[¶](#appendix-A.1-2.2){.pilcrow}
:   

Cons:
:   Attackers passively observing traffic will still be able to observe
    TLS connections to the separate
    address.[¶](#appendix-A.1-2.4){.pilcrow}
:   
:::
:::

::: {#client-specific-tls-acceptance}
::: {#appendix-A.2 .section}
### [A.2.](#appendix-A.2){.section-number .selfRef} [Client-Specific TLS Acceptance](#name-client-specific-tls-accepta){.section-name .selfRef} {#name-client-specific-tls-accepta}

Primaries that include IP-based ACLs and/or mutual TLS in their
authentication models have the option of only accepting TLS connections
from authorized clients. This could be implemented either using a proxy
or directly in the DNS implementation.[¶](#appendix-A.2-1){.pilcrow}

[]{.break}

Pros:
:   Connection management happens at setup time. The maximum number of
    TLS connections a server will have to support can be easily
    assessed. Once the connection is accepted, the server might well be
    willing to answer any query on that connection since it is coming
    from a configured secondary, and a specific response policy on the
    connection may not be needed (see
    below).[¶](#appendix-A.2-2.2){.pilcrow}
:   

Cons:
:   Currently, none of the major open-source implementations of a DNS
    authoritative server support such an
    option.[¶](#appendix-A.2-2.4){.pilcrow}
:   
:::
:::

::: {#sni-based-tls-acceptance}
::: {#appendix-A.3 .section}
### [A.3.](#appendix-A.3){.section-number .selfRef} [SNI-Based TLS Acceptance](#name-sni-based-tls-acceptance){.section-name .selfRef} {#name-sni-based-tls-acceptance}

Primaries could also choose to only accept TLS connections based on a
Server Name Indication (SNI) that was published only to their
secondaries.[¶](#appendix-A.3-1){.pilcrow}

[]{.break}

Pros:
:   Reduces the number of accepted
    connections.[¶](#appendix-A.3-2.2){.pilcrow}
:   

Cons:
:   As above. Also, this is not a recommended use of SNI. For SNIs sent
    in the clear, this would still allow attackers passively observing
    traffic to potentially abuse this mechanism. The use of Encrypted
    Client Hello \[[TLS-ESNI](#I-D.ietf-tls-esni){.xref}\] may be of use
    here.[¶](#appendix-A.3-2.4){.pilcrow}
:   
:::
:::

::: {#transport-specific-response-policies}
::: {#appendix-A.4 .section}
### [A.4.](#appendix-A.4){.section-number .selfRef} [Transport-Specific Response Policies](#name-transport-specific-response){.section-name .selfRef} {#name-transport-specific-response}

Some primaries might rely on TSIG/SIG(0) combined with per-query,
IP-based ACLs to authenticate secondaries. In this case, the primary
must accept all incoming TLS/TCP connections and then apply a
transport-specific response policy on a per-query
basis.[¶](#appendix-A.4-1){.pilcrow}

As an aside, whilst \[[RFC7766](#RFC7766){.xref}\] makes a general
purpose distinction in the advice to clients about their usage of
connections (between regular queries and zone transfers), this is not
strict, and nothing in the DNS protocol prevents using the same
connection for both types of traffic. Hence, a server cannot know the
intention of any client that connects to it; it can only inspect the
messages it receives on such a connection and make per-query decisions
about whether or not to answer those
queries.[¶](#appendix-A.4-2){.pilcrow}

Example policies a XoT server might implement
are:[¶](#appendix-A.4-3){.pilcrow}

[]{.break}

strict:
:   REFUSE all queries on TLS connections, except SOA and authorized XFR
    requests[¶](#appendix-A.4-4.2){.pilcrow}
:   

moderate:
:   REFUSE all queries on TLS connections until one is received that is
    signed by a recognized TSIG/SIG(0) key, then answer all queries on
    the connection after that[¶](#appendix-A.4-4.4){.pilcrow}
:   

complex:
:   apply a heuristic to determine which queries on a TLS connections to
    REFUSE[¶](#appendix-A.4-4.6){.pilcrow}
:   

relaxed:
:   answer all non-XoT queries on all TLS connections with the same
    policy applied to TCP queries[¶](#appendix-A.4-4.8){.pilcrow}
:   

[]{.break}

Pros:
:   Allows for flexible behavior by the server that could be changed
    over time.[¶](#appendix-A.4-5.2){.pilcrow}
:   

Cons:
:   The server must handle the burden of accepting all TLS connections
    just to perform XFRs with a small number of secondaries. Client
    behavior to a REFUSED response is not clearly defined (see [Section
    7.8](#response-rcodes){.xref}). Currently, none of the major
    open-source implementations of a DNS authoritative server offer an
    option for different response policies in different transports (but
    such functionality could potentially be implemented using a
    proxy).[¶](#appendix-A.4-5.4){.pilcrow}
:   

::: {#sni-based-response-policies}
::: {#appendix-A.4.1 .section}
#### [A.4.1.](#appendix-A.4.1){.section-number .selfRef} [SNI-Based Response Policies](#name-sni-based-response-policies){.section-name .selfRef} {#name-sni-based-response-policies}

In a similar fashion, XoT servers might use the presence of an SNI in
the Client Hello to determine which response policy to initially apply
to the TLS connections.[¶](#appendix-A.4.1-1){.pilcrow}

[]{.break}

Pros:
:   This has the potential to allow a clean distinction between a XoT
    service and any future DoT-based service for answering recursive
    queries.[¶](#appendix-A.4.1-2.2){.pilcrow}
:   

Cons:
:   As above.[¶](#appendix-A.4.1-2.4){.pilcrow}
:   
:::
:::
:::
:::
:::
:::

::: {#acknowledgements}
::: {#appendix-B .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The authors thank [Tony Finch]{.contact-name}, [Benno
Overeinder]{.contact-name}, [Shumon Huque]{.contact-name}, [Tim
Wicinski]{.contact-name}, and many other members of DPRIVE for review
and discussions.[¶](#appendix-B-1){.pilcrow}

The authors particularly thank [Peter van Dijk]{.contact-name}, [Ondrej
Sury]{.contact-name}, [Brian Dickson]{.contact-name}, and several other
open-source DNS implementers for valuable discussion and clarification
on the issue associated with pipelining XFR queries and handling
out-of-order/intermingled responses.[¶](#appendix-B-2){.pilcrow}
:::
:::

::: {#contributors}
::: {#appendix-C .section}
## [Contributors](#name-contributors){.section-name .selfRef} {#name-contributors}

Significant contributions to the document were made
by:[¶](#appendix-C-1){.pilcrow}

::: {.left dir="auto"}
[Han Zhang]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Salesforce]{.org}
:::

::: {.left dir="auto"}
[San Francisco]{.locality}, [CA]{.region}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <hzhang@salesforce.com>
:::
:::
:::

::: {#authors-addresses}
::: {#appendix-D .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Willem Toorop]{.fn .nameRole}
:::

::: {.left dir="auto"}
[NLnet Labs]{.org}
:::

::: {.left dir="auto"}
[Science Park 400]{.street-address}
:::

::: {.left dir="auto"}
[1098 XH]{.postal-code} [Amsterdam]{.locality}
:::

::: {.left dir="auto"}
[Netherlands]{.country-name}
:::

::: email
Email: <willem@nlnetlabs.nl>
:::

::: {.left dir="auto"}
[Sara Dickinson]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Sinodun IT]{.org}
:::

::: {.left dir="auto"}
[Magdalen Centre]{.extended-address}
:::

::: {.left dir="auto"}
[Oxford Science Park]{.street-address}
:::

::: {.left dir="auto"}
[Oxford]{.locality}
:::

::: {.left dir="auto"}
[OX4 4GA]{.postal-code}
:::

::: {.left dir="auto"}
[United Kingdom]{.country-name}
:::

::: email
Email: <sara@sinodun.com>
:::

::: {.left dir="auto"}
[Shivan Sahib]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Brave Software]{.org}
:::

::: {.left dir="auto"}
[Vancouver]{.locality} [BC]{.region}
:::

::: {.left dir="auto"}
[Canada]{.country-name}
:::

::: email
Email: <shivankaulsahib@gmail.com>
:::

::: {.left dir="auto"}
[Pallavi Aras]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Salesforce]{.org}
:::

::: {.left dir="auto"}
[Herndon]{.locality}, [VA]{.region}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <paras@salesforce.com>
:::

::: {.left dir="auto"}
[Allison Mankin]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Salesforce]{.org}
:::

::: {.left dir="auto"}
[Herndon]{.locality}, [VA]{.region}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <allison.mankin@gmail.com>
:::
:::
:::
