  RFC 9163   Expect-CT      June 2022
  ---------- -------------- -----------
  Stark      Experimental   \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9163](https://www.rfc-editor.org/rfc/rfc9163){.eref}

Category:
:   Experimental

Published:
:   June 2022

ISSN:
:   2070-1721

Author:

:   ::: author
    ::: author-name
    E. Stark
    :::

    ::: org
    Google
    :::
    :::
:::

# RFC 9163 {#rfcnum}

# Expect-CT Extension for HTTP {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document defines a new HTTP header field named \"Expect-CT\", which
allows web host operators to instruct user agents (UAs) to expect valid
Signed Certificate Timestamps (SCTs) to be served on connections to
these hosts. Expect-CT allows web host operators to discover
misconfigurations in their Certificate Transparency (CT) deployments.
Further, web host operators can use Expect-CT to ensure that if a UA
that supports Expect-CT accepts a misissued certificate, that
certificate will be discoverable in Certificate Transparency
logs.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This document is not an Internet Standards Track specification; it is
published for examination, experimental implementation, and
evaluation.[¶](#section-boilerplate.1-1){.pilcrow}

This document defines an Experimental Protocol for the Internet
community. This document is a product of the Internet Engineering Task
Force (IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Not all documents approved
by the IESG are candidates for any level of Internet Standard; see
Section 2 of RFC 7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9163>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2022 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Revised BSD License text as described in Section 4.e of the Trust Legal
Provisions and are provided without warranty as described in the Revised
BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Requirements
        Language](#name-requirements-language){.xref}
        :::

    -   ::: {#section-toc.1-1.1.2.2}
        [1.2](#section-1.2){.xref}.  [Terminology](#name-terminology){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Server and Client
    Behavior](#name-server-and-client-behavior){.xref}

    -   ::: {#section-toc.1-1.2.2.1}
        [2.1](#section-2.1){.xref}.  [Response Header Field
        Syntax](#name-response-header-field-synta){.xref}

        -   ::: {#section-toc.1-1.2.2.1.2.1}
            [2.1.1](#section-2.1.1){.xref}.  [The report-uri
            Directive](#name-the-report-uri-directive){.xref}
            :::

        -   ::: {#section-toc.1-1.2.2.1.2.2}
            [2.1.2](#section-2.1.2){.xref}.  [The enforce
            Directive](#name-the-enforce-directive){.xref}
            :::

        -   ::: {#section-toc.1-1.2.2.1.2.3}
            [2.1.3](#section-2.1.3){.xref}.  [The max-age
            Directive](#name-the-max-age-directive){.xref}
            :::

        -   ::: {#section-toc.1-1.2.2.1.2.4}
            [2.1.4](#section-2.1.4){.xref}.  [Examples](#name-examples){.xref}
            :::
        :::

    -   ::: {#section-toc.1-1.2.2.2}
        [2.2](#section-2.2){.xref}.  [Host Processing
        Model](#name-host-processing-model){.xref}

        -   ::: {#section-toc.1-1.2.2.2.2.1}
            [2.2.1](#section-2.2.1){.xref}.  [HTTP-over-Secure-Transport
            Request Type](#name-http-over-secure-transport-){.xref}
            :::

        -   ::: {#section-toc.1-1.2.2.2.2.2}
            [2.2.2](#section-2.2.2){.xref}.  [HTTP Request
            Type](#name-http-request-type){.xref}
            :::
        :::

    -   ::: {#section-toc.1-1.2.2.3}
        [2.3](#section-2.3){.xref}.  [User Agent Processing
        Model](#name-user-agent-processing-model){.xref}

        -   ::: {#section-toc.1-1.2.2.3.2.1}
            [2.3.1](#section-2.3.1){.xref}.  [Missing or Malformed
            Expect-CT Header
            Fields](#name-missing-or-malformed-expect){.xref}
            :::

        -   ::: {#section-toc.1-1.2.2.3.2.2}
            [2.3.2](#section-2.3.2){.xref}.  [Expect-CT Header Field
            Processing](#name-expect-ct-header-field-proc){.xref}
            :::

        -   ::: {#section-toc.1-1.2.2.3.2.3}
            [2.3.3](#section-2.3.3){.xref}.  [Reporting](#name-reporting){.xref}
            :::
        :::

    -   ::: {#section-toc.1-1.2.2.4}
        [2.4](#section-2.4){.xref}.  [Evaluating Expect-CT Connections
        for CT Compliance](#name-evaluating-expect-ct-connec){.xref}

        -   ::: {#section-toc.1-1.2.2.4.2.1}
            [2.4.1](#section-2.4.1){.xref}.  [Skipping CT Compliance
            Checks](#name-skipping-ct-compliance-chec){.xref}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Reporting Expect-CT
    Failure](#name-reporting-expect-ct-failure){.xref}

    -   ::: {#section-toc.1-1.3.2.1}
        [3.1](#section-3.1){.xref}.  [Generating a Violation
        Report](#name-generating-a-violation-repo){.xref}
        :::

    -   ::: {#section-toc.1-1.3.2.2}
        [3.2](#section-3.2){.xref}.  [Sending a Violation
        Report](#name-sending-a-violation-report){.xref}
        :::

    -   ::: {#section-toc.1-1.3.2.3}
        [3.3](#section-3.3){.xref}.  [Receiving a Violation
        Report](#name-receiving-a-violation-repor){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Usability
    Considerations](#name-usability-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Authoring
    Considerations](#name-authoring-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Privacy
    Considerations](#name-privacy-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Hostile Header
        Attacks](#name-hostile-header-attacks){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [Maximum
        max-age](#name-maximum-max-age){.xref}
        :::

    -   ::: {#section-toc.1-1.7.2.3}
        [7.3](#section-7.3){.xref}.  [Amplification
        Attacks](#name-amplification-attacks){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Header Field
        Registry](#name-header-field-registry){.xref}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Media Types
        Registry](#name-media-types-registry){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [References](#name-references){.xref}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [Normative
        References](#name-normative-references){.xref}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [Informative
        References](#name-informative-references){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [](#appendix-A){.xref}[Author\'s
    Address](#name-authors-address){.xref}
    :::
:::
:::

::: {#introduction}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

This document defines a new HTTP header field
(\[[RFC9110](#RFC9110){.xref}\], [Section
6.3](https://www.rfc-editor.org/rfc/rfc9110#section-6.3){.relref}) that
enables UAs to identify web hosts that expect the presence of Signed
Certificate Timestamps (SCTs) \[[RFC9162](#RFC9162){.xref}\] in
subsequent Transport Layer Security (TLS) \[[RFC8446](#RFC8446){.xref}\]
connections.[¶](#section-1-1){.pilcrow}

Web hosts that serve the Expect-CT header field are noted by the UA as
\"Known Expect-CT Hosts\". The UA evaluates each connection to a Known
Expect-CT Host for compliance with the UA\'s Certificate Transparency
(CT) Policy. If the connection violates the CT Policy, the UA sends a
report to a URI configured by the Expect-CT Host and/or fails the
connection, depending on the configuration that the Expect-CT Host has
chosen.[¶](#section-1-2){.pilcrow}

If misconfigured, Expect-CT can cause unwanted connection failures (for
example, if a host deploys Expect-CT but then switches to a legitimate
certificate that is not logged in Certificate Transparency logs or if a
web host operator believes their certificate to conform to all UAs\' CT
policies but is mistaken). Web host operators are advised to deploy
Expect-CT with precautions by using the reporting feature and gradually
increasing the time interval during which the UA regards the host as a
Known Expect-CT Host. These precautions can help web host operators gain
confidence that their Expect-CT deployment is not causing unwanted
connection failures.[¶](#section-1-3){.pilcrow}

Expect-CT is a trust-on-first-use (TOFU) mechanism. The first time a UA
connects to a host, it lacks the information necessary to require SCTs
for the connection. Thus, the UA will not be able to detect and thwart
an attack on the UA\'s first connection to the host. Still, Expect-CT
provides value by 1) allowing UAs to detect the use of unlogged
certificates after the initial communication, and 2) allowing web hosts
to be confident that UAs are only trusting publicly auditable
certificates.[¶](#section-1-4){.pilcrow}

Expect-CT is similar to HTTP Strict Transport Security (HSTS)
\[[RFC6797](#RFC6797){.xref}\] and HTTP Public Key Pinning (HPKP)
\[[RFC7469](#RFC7469){.xref}\]. HSTS allows websites to declare
themselves accessible only via secure connections, and HPKP allows
websites to declare their cryptographic identifies. Similarly, Expect-CT
allows websites to declare themselves accessible only via connections
that are compliant with CT Policy.[¶](#section-1-5){.pilcrow}

This Expect-CT specification is compatible with
\[[RFC6962](#RFC6962){.xref}\] and \[[RFC9162](#RFC9162){.xref}\], but
not necessarily with future versions of Certificate Transparency. UAs
will ignore Expect-CT header fields from web hosts that use future
versions of Certificate Transparency, unless a future version of this
document specifies how they should be
processed.[¶](#section-1-6){.pilcrow}

::: {#requirements-language}
::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-1.1-1){.pilcrow}
:::
:::

::: {#terminology}
::: {#section-1.2 .section}
### [1.2.](#section-1.2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

Terminology is defined in this section.[¶](#section-1.2-1){.pilcrow}

[]{.break}

\"Certificate Transparency Policy\"
:   A policy defined by the UA concerning the number, sources, and
    delivery mechanisms of Signed Certificate Timestamps that are
    associated with TLS connections. The policy defines the properties
    of a connection that must be met in order for the UA to consider it
    CT qualified.[¶](#section-1.2-2.2){.pilcrow}
:   

\"Certificate Transparency Qualified\"
:   Describes a TLS connection for which the UA has determined that a
    sufficient quantity and quality of Signed Certificate Timestamps
    have been provided.[¶](#section-1.2-2.4){.pilcrow}
:   

\"CT Qualified\"
:   An abbreviation for \"Certificate Transparency
    Qualified\".[¶](#section-1.2-2.6){.pilcrow}
:   

\"CT Policy\"
:   An abbreviation for \"Certificate Transparency
    Policy\".[¶](#section-1.2-2.8){.pilcrow}
:   

\"Effective Expect-CT Date\"
:   The time at which a UA observed a valid Expect-CT header field for a
    given host.[¶](#section-1.2-2.10){.pilcrow}
:   

\"Expect-CT Host\"
:   A conformant host implementing the HTTP server aspects of Expect-CT.
    This means that an Expect-CT Host returns the Expect-CT response
    header field in its HTTP response messages sent over secure
    transport. The term \"host\" is equivalent to \"server\" in this
    specification.[¶](#section-1.2-2.12){.pilcrow}
:   

\"Known Expect-CT Host\"
:   An Expect-CT Host that the UA has noted as such. See [Section
    2.3.2.1](#noting-expect-ct){.xref} for
    particulars.[¶](#section-1.2-2.14){.pilcrow}
:   

\"User Agent (UA)\"
:   For the purposes of this specification, a UA is an HTTP client
    application typically actively manipulated by a user
    \[[RFC9110](#RFC9110){.xref}\].[¶](#section-1.2-2.16){.pilcrow}
:   

\"Unknown Expect-CT Host\"
:   An Expect-CT Host that the UA has not
    noted.[¶](#section-1.2-2.18){.pilcrow}
:   
:::
:::
:::
:::

::: {#server-and-client-behavior}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Server and Client Behavior](#name-server-and-client-behavior){.section-name .selfRef} {#name-server-and-client-behavior}

::: {#response-header-field-syntax}
::: {#section-2.1 .section}
### [2.1.](#section-2.1){.section-number .selfRef} [Response Header Field Syntax](#name-response-header-field-synta){.section-name .selfRef} {#name-response-header-field-synta}

The Expect-CT response header field is a new field defined in this
specification. It is used by a server to indicate that UAs should
evaluate connections to the host emitting the header field for CT
compliance ([Section
2.4](#expect-ct-compliance){.xref}).[¶](#section-2.1-1){.pilcrow}

[Figure 1](#expect-ct-syntax){.xref} describes the syntax (Augmented
Backus-Naur Form) of the header field, using the grammar defined in
\[[RFC5234](#RFC5234){.xref}\] and the rules defined in [Section
5](https://www.rfc-editor.org/rfc/rfc9110#section-5){.relref} of
\[[RFC9110](#RFC9110){.xref}\]. The \"#\" ABNF extension is specified in
[Section
5.6.1](https://www.rfc-editor.org/rfc/rfc9110#section-5.6.1){.relref} of
\[[RFC9110](#RFC9110){.xref}\].[¶](#section-2.1-2){.pilcrow}

[]{#name-syntax-of-the-expect-ct-hea}

::: {#expect-ct-syntax}
::: {#section-2.1-3.1}
``` {.lang-abnf .sourcecode}
Expect-CT           = 1#expect-ct-directive
expect-ct-directive = directive-name [ "=" directive-value ]
directive-name      = token
directive-value     = token / quoted-string
```
:::

[Figure 1](#figure-1){.selfRef}: [Syntax of the Expect-CT Header
Field](#name-syntax-of-the-expect-ct-hea){.selfRef}
:::

The directives defined in this specification are described below. The
overall requirements for directives are:[¶](#section-2.1-4){.pilcrow}

1.  [The order of appearance of directives is not
    significant.[¶](#section-2.1-5.1){.pilcrow}]{#section-2.1-5.1}
2.  [A given directive [MUST NOT]{.bcp14} appear more than once in a
    given header field. Directives are either optional or required, as
    stipulated in their
    definitions.[¶](#section-2.1-5.2){.pilcrow}]{#section-2.1-5.2}
3.  [Directive names are case
    insensitive.[¶](#section-2.1-5.3){.pilcrow}]{#section-2.1-5.3}
4.  [UAs [MUST]{.bcp14} ignore any header fields containing directives,
    or other header field value data that does not conform to the syntax
    defined in this specification. In particular, UAs [MUST NOT]{.bcp14}
    attempt to fix malformed header
    fields.[¶](#section-2.1-5.4){.pilcrow}]{#section-2.1-5.4}
5.  [If a header field contains any directive(s) the UA does not
    recognize, the UA [MUST]{.bcp14} ignore those
    directives.[¶](#section-2.1-5.5){.pilcrow}]{#section-2.1-5.5}
6.  [If the Expect-CT header field otherwise satisfies the above
    requirements (1 through 5), and Expect-CT is not disabled for local
    policy reasons (as discussed in [Section
    2.4.1](#skipping-ct-compliance-checks){.xref}), the UA
    [MUST]{.bcp14} process the directives it
    recognizes.[¶](#section-2.1-5.6){.pilcrow}]{#section-2.1-5.6}

::: {#the-report-uri-directive}
::: {#section-2.1.1 .section}
#### [2.1.1.](#section-2.1.1){.section-number .selfRef} [The report-uri Directive](#name-the-report-uri-directive){.section-name .selfRef} {#name-the-report-uri-directive}

The [OPTIONAL]{.bcp14} `report-uri` directive indicates the URI to which
the UA [SHOULD]{.bcp14} report Expect-CT failures ([Section
2.4](#expect-ct-compliance){.xref}). The UA POSTs the reports to the
given URI as described in [Section
3](#reporting-expect-ct-failure){.xref}.[¶](#section-2.1.1-1){.pilcrow}

The `report-uri` directive is [REQUIRED]{.bcp14} to have a directive
value, for which the syntax is defined in [Figure
2](#reporturi-syntax){.xref}.[¶](#section-2.1.1-2){.pilcrow}

[]{#name-syntax-of-the-report-uri-di}

::: {#reporturi-syntax}
::: {#section-2.1.1-3.1}
``` {.lang-abnf .sourcecode}
report-uri-value = (DQUOTE absolute-URI DQUOTE) / absolute-URI
```
:::

[Figure 2](#figure-2){.selfRef}: [Syntax of the report-uri Directive
Value](#name-syntax-of-the-report-uri-di){.selfRef}
:::

The \'report-uri-value\' [MUST]{.bcp14} be quoted if it contains any
character not allowed in \'token\'.[¶](#section-2.1.1-4){.pilcrow}

`absolute-URI` is defined in [Section
4.3](https://www.rfc-editor.org/rfc/rfc3986#section-4.3){.relref} of
\[[RFC3986](#RFC3986){.xref}\].[¶](#section-2.1.1-5){.pilcrow}

UAs [MUST]{.bcp14} ignore any `report-uri` that does not use the HTTPS
scheme. UAs [MUST]{.bcp14} check Expect-CT compliance when the host in
the `report-uri` is a Known Expect-CT Host; similarly, UAs
[MUST]{.bcp14} apply HSTS \[[RFC6797](#RFC6797){.xref}\] if the host in
the `report-uri` is a Known HSTS Host.[¶](#section-2.1.1-6){.pilcrow}

UAs [SHOULD]{.bcp14} make their best effort to report Expect-CT failures
to the `report-uri`, but they may fail to report in exceptional
conditions. For example, if connecting to the `report-uri` itself incurs
an Expect-CT failure or other certificate validation failure, the UA
[MUST]{.bcp14} cancel the connection. Similarly, if Expect-CT Host A
sets a `report-uri` referring to Expect-CT Host B, and if B sets a
`report-uri` referring to A, and if both hosts fail to comply to the
UA\'s CT Policy, the UA [SHOULD]{.bcp14} detect and break the loop by
failing to send reports to and about those
hosts.[¶](#section-2.1.1-7){.pilcrow}

Note that the `report-uri` need not necessarily be in the same Internet
domain or web origin as the host being reported about. Hosts are in fact
encouraged to use a separate host as the `report-uri` so that CT
failures on the Expect-CT Host do not prevent reports from being
sent.[¶](#section-2.1.1-8){.pilcrow}

UAs [SHOULD]{.bcp14} limit the rate at which they send reports. For
example, it is unnecessary to send the same report to the same
`report-uri` more than once in the same web-browsing
session.[¶](#section-2.1.1-9){.pilcrow}
:::
:::

::: {#the-enforce-directive}
::: {#section-2.1.2 .section}
#### [2.1.2.](#section-2.1.2){.section-number .selfRef} [The enforce Directive](#name-the-enforce-directive){.section-name .selfRef} {#name-the-enforce-directive}

The [OPTIONAL]{.bcp14} `enforce` directive is a valueless directive
that, if present (i.e., it is \"asserted\"), signals to the UA that
compliance to the CT Policy should be enforced (rather than report-only)
and that the UA should refuse future connections that violate its CT
Policy. When both the `enforce` directive and `report-uri` directive (as
defined in [Figure 2](#reporturi-syntax){.xref}) are present, the
configuration is referred to as an \"enforce-and-report\" configuration,
signaling to the UA that both compliance to the CT Policy should be
enforced and violations should be
reported.[¶](#section-2.1.2-1){.pilcrow}
:::
:::

::: {#the-max-age-directive}
::: {#section-2.1.3 .section}
#### [2.1.3.](#section-2.1.3){.section-number .selfRef} [The max-age Directive](#name-the-max-age-directive){.section-name .selfRef} {#name-the-max-age-directive}

The `max-age` directive specifies the number of seconds after the
reception of the Expect-CT header field during which the UA
[SHOULD]{.bcp14} regard the host from whom the message was received as a
Known Expect-CT Host.[¶](#section-2.1.3-1){.pilcrow}

If a response contains an Expect-CT header field, then the response
[MUST]{.bcp14} contain an Expect-CT header field with a `max-age`
directive. (A `max-age` directive need not appear in every Expect-CT
header field in the response.) The `max-age` directive is
[REQUIRED]{.bcp14} to have a directive value, for which the syntax
(after quoted-string unescaping, if necessary) is defined in [Figure
3](#maxage-syntax){.xref}.[¶](#section-2.1.3-2){.pilcrow}

[]{#name-syntax-of-the-max-age-direc}

::: {#maxage-syntax}
::: {#section-2.1.3-3.1}
``` {.lang-abnf .sourcecode}
max-age-value = delta-seconds
delta-seconds = 1*DIGIT
```
:::

[Figure 3](#figure-3){.selfRef}: [Syntax of the max-age Directive
Value](#name-syntax-of-the-max-age-direc){.selfRef}
:::

`delta-seconds` is used as defined in [Section
1.3](https://www.rfc-editor.org/rfc/rfc9111#section-1.3){.relref} of
\[[RFC9111](#RFC9111){.xref}\].[¶](#section-2.1.3-4){.pilcrow}
:::
:::

::: {#examples}
::: {#section-2.1.4 .section}
#### [2.1.4.](#section-2.1.4){.section-number .selfRef} [Examples](#name-examples){.section-name .selfRef} {#name-examples}

The following three examples demonstrate valid Expect-CT response header
fields (where the second splits the directives into two field
instances):[¶](#section-2.1.4-1){.pilcrow}

[]{#name-examples-of-valid-expect-ct}

::: {#example-header-fields}
::: {#section-2.1.4-2.1 .alignLeft .art-http-headers .art-text .artwork}
    Expect-CT: max-age=86400, enforce

    Expect-CT: max-age=86400,enforce
    Expect-CT: report-uri="https://foo.example/report"

    Expect-CT: max-age=86400,report-uri="https://foo.example/report"
:::

[Figure 4](#figure-4){.selfRef}: [Examples of Valid Expect-CT
ResponseHeader Fields](#name-examples-of-valid-expect-ct){.selfRef}
:::
:::
:::
:::
:::

::: {#host-processing-model}
::: {#section-2.2 .section}
### [2.2.](#section-2.2){.section-number .selfRef} [Host Processing Model](#name-host-processing-model){.section-name .selfRef} {#name-host-processing-model}

This section describes the processing model that Expect-CT Hosts
implement. The model has 2 parts: (1) the processing rules for HTTP
request messages received over a secure transport (e.g., authenticated,
non-anonymous TLS); and (2) the processing rules for HTTP request
messages received over non-secure transports, such as
TCP.[¶](#section-2.2-1){.pilcrow}

::: {#http-over-secure-transport-request-type}
::: {#section-2.2.1 .section}
#### [2.2.1.](#section-2.2.1){.section-number .selfRef} [HTTP-over-Secure-Transport Request Type](#name-http-over-secure-transport-){.section-name .selfRef} {#name-http-over-secure-transport-}

An Expect-CT Host includes an Expect-CT header field in its response.
The header field [MUST]{.bcp14} satisfy the grammar specified in
[Section
2.1](#response-header-field-syntax){.xref}.[¶](#section-2.2.1-1){.pilcrow}

Establishing a given host as an Expect-CT Host, in the context of a
given UA, is accomplished as follows:[¶](#section-2.2.1-2){.pilcrow}

1.  [Over the HTTP protocol running over secure transport, by correctly
    returning (per this specification) a valid Expect-CT header field to
    the UA.[¶](#section-2.2.1-3.1){.pilcrow}]{#section-2.2.1-3.1}
2.  [Through other mechanisms such as a client-side preloaded Expect-CT
    Host list.[¶](#section-2.2.1-3.2){.pilcrow}]{#section-2.2.1-3.2}
:::
:::

::: {#http-request-type}
::: {#section-2.2.2 .section}
#### [2.2.2.](#section-2.2.2){.section-number .selfRef} [HTTP Request Type](#name-http-request-type){.section-name .selfRef} {#name-http-request-type}

Expect-CT Hosts [SHOULD NOT]{.bcp14} include the Expect-CT header field
in HTTP responses conveyed over non-secure
transport.[¶](#section-2.2.2-1){.pilcrow}
:::
:::
:::
:::

::: {#user-agent-processing-model}
::: {#section-2.3 .section}
### [2.3.](#section-2.3){.section-number .selfRef} [User Agent Processing Model](#name-user-agent-processing-model){.section-name .selfRef} {#name-user-agent-processing-model}

The UA processing model relies on parsing domain names. Note that
internationalized domain names [SHALL]{.bcp14} be canonicalized by the
UA according to the scheme in [Section
10](https://www.rfc-editor.org/rfc/rfc6797#section-10){.relref} of
\[[RFC6797](#RFC6797){.xref}\].[¶](#section-2.3-1){.pilcrow}

The UA stores Known Expect-CT Hosts and their associated Expect-CT
directives. This data is collectively known as a host\'s \"Expect-CT
metadata\".[¶](#section-2.3-2){.pilcrow}

::: {#missing-or-malformed-expect-ct-header-fields}
::: {#section-2.3.1 .section}
#### [2.3.1.](#section-2.3.1){.section-number .selfRef} [Missing or Malformed Expect-CT Header Fields](#name-missing-or-malformed-expect){.section-name .selfRef} {#name-missing-or-malformed-expect}

If an HTTP response does not include an Expect-CT header field that
conforms to the grammar specified in [Section
2.1](#response-header-field-syntax){.xref}, then the UA [MUST
NOT]{.bcp14} update any Expect-CT
metadata.[¶](#section-2.3.1-1){.pilcrow}
:::
:::

::: {#expect-ct-header-field-processing}
::: {#section-2.3.2 .section}
#### [2.3.2.](#section-2.3.2){.section-number .selfRef} [Expect-CT Header Field Processing](#name-expect-ct-header-field-proc){.section-name .selfRef} {#name-expect-ct-header-field-proc}

If the UA receives an HTTP response over a secure transport that
includes an Expect-CT header field conforming to the grammar specified
in [Section 2.1](#response-header-field-syntax){.xref}, the UA
[MUST]{.bcp14} evaluate the connection on which the header field was
received for compliance with the UA\'s CT Policy, and then process the
Expect-CT header field as follows. UAs [MUST]{.bcp14} ignore any
Expect-CT header field received in an HTTP response conveyed over
non-secure transport.[¶](#section-2.3.2-1){.pilcrow}

If the connection does not comply with the UA\'s CT Policy (i.e., the
connection is not CT qualified), then the UA [MUST NOT]{.bcp14} update
any Expect-CT metadata. If the header field includes a `report-uri`
directive, the UA [SHOULD]{.bcp14} send a report to the specified
`report-uri` ([Section
2.3.3](#header-field-processing-reporting){.xref}).[¶](#section-2.3.2-2){.pilcrow}

If the connection complies with the UA\'s CT Policy (i.e., the
connection is CT qualified), then the UA [MUST]{.bcp14}
either:[¶](#section-2.3.2-3){.pilcrow}

-   [Note the host as a Known Expect-CT Host if it is not already so
    noted (see [Section 2.3.2.1](#noting-expect-ct){.xref})
    or[¶](#section-2.3.2-4.1){.pilcrow}]{#section-2.3.2-4.1}
-   [Update the UA\'s cached information for the Known Expect-CT Host if
    the `enforce`, `max-age`, or `report-uri` header field value
    directives convey information different from that already maintained
    by the UA. If the `max-age` directive has a value of 0, the UA
    [MUST]{.bcp14} remove its cached Expect-CT information if the host
    was previously noted as a Known Expect-CT Host and [MUST
    NOT]{.bcp14} note this host as a Known Expect-CT Host if it is not
    already noted.[¶](#section-2.3.2-4.2){.pilcrow}]{#section-2.3.2-4.2}

If a UA receives an Expect-CT header field over a CT-compliant
connection that uses a version of Certificate Transparency other than
\[[RFC6962](#RFC6962){.xref}\] or \[[RFC9162](#RFC9162){.xref}\], the UA
[MUST]{.bcp14} ignore the Expect-CT header field and clear any Expect-CT
metadata associated with the host.[¶](#section-2.3.2-5){.pilcrow}

::: {#noting-expect-ct}
::: {#section-2.3.2.1 .section}
##### [2.3.2.1.](#section-2.3.2.1){.section-number .selfRef} [Noting Expect-CT](#name-noting-expect-ct){.section-name .selfRef} {#name-noting-expect-ct}

Upon receipt of the Expect-CT response header field over an error-free
TLS connection (with X.509 certificate chain validation as described in
\[[RFC5280](#RFC5280){.xref}\], as well as the validation described in
[Section 2.4](#expect-ct-compliance){.xref} of this document), the UA
[MUST]{.bcp14} note the host as a Known Expect-CT Host, storing the
host\'s domain name and its associated Expect-CT directives in
non-volatile storage.[¶](#section-2.3.2.1-1){.pilcrow}

To note a host as a Known Expect-CT Host, the UA [MUST]{.bcp14} set its
Expect-CT metadata in its Known Expect-CT Host cache (as specified in
[Section 2.3.2.2](#storage-model){.xref}), using the metadata given in
the most recently received valid Expect-CT header
field.[¶](#section-2.3.2.1-2){.pilcrow}

For forward compatibility, the UA [MUST]{.bcp14} ignore any unrecognized
Expect-CT header field directives while still processing those
directives it does recognize. [Section
2.1](#response-header-field-syntax){.xref} specifies the directives
`enforce`, `max-age`, and `report-uri`, but future specifications and
implementations might use additional
directives.[¶](#section-2.3.2.1-3){.pilcrow}
:::
:::

::: {#storage-model}
::: {#section-2.3.2.2 .section}
##### [2.3.2.2.](#section-2.3.2.2){.section-number .selfRef} [Storage Model](#name-storage-model){.section-name .selfRef} {#name-storage-model}

If the substring matching the host production from the Request-URI (of
the message to which the host responded) does not exactly match an
existing Known Expect-CT Host\'s domain name, per the matching procedure
for a Congruent Match specified in [Section
8.2](https://www.rfc-editor.org/rfc/rfc6797#section-8.2){.relref} of
\[[RFC6797](#RFC6797){.xref}\], then the UA [MUST]{.bcp14} add this host
to the Known Expect-CT Host cache. The UA
caches:[¶](#section-2.3.2.2-1){.pilcrow}

-   [the Expect-CT Host\'s domain
    name.[¶](#section-2.3.2.2-2.1){.pilcrow}]{#section-2.3.2.2-2.1}
-   [whether the `enforce` directive is
    present.[¶](#section-2.3.2.2-2.2){.pilcrow}]{#section-2.3.2.2-2.2}
-   [the Effective Expiration Date, which is the Effective Expect-CT
    Date plus the value of the `max-age` directive. Alternatively, the
    UA [MAY]{.bcp14} cache enough information to calculate the Effective
    Expiration Date. The Effective Expiration Date is calculated from
    when the UA observed the Expect-CT header field and is independent
    of when the response was
    generated.[¶](#section-2.3.2.2-2.3){.pilcrow}]{#section-2.3.2.2-2.3}
-   [the value of the `report-uri` directive, if
    present.[¶](#section-2.3.2.2-2.4){.pilcrow}]{#section-2.3.2.2-2.4}

If any other metadata from optional or future Expect-CT header
directives are present in the Expect-CT header field, and the UA
understands them, the UA [MAY]{.bcp14} note them as
well.[¶](#section-2.3.2.2-3){.pilcrow}

UAs [MAY]{.bcp14} set an upper limit on the value of `max-age` so that
UAs that have noted erroneous Expect-CT Hosts (whether by accident or
due to attack) have some chance of recovering over time. If the server
sets a `max-age` greater than the UA\'s upper limit, the UA may behave
as if the server set the `max-age` to the UA\'s upper limit. For
example, if the UA caps `max-age` at 5,184,000 seconds (60 days), and an
Expect-CT Host sets a `max-age directive` of 90 days in its Expect-CT
header field, the UA may behave as if the `max-age` were effectively 60
days. (One way to achieve this behavior is for the UA to simply store a
value of 60 days instead of the 90-day value provided by the Expect-CT
Host.)[¶](#section-2.3.2.2-4){.pilcrow}
:::
:::
:::
:::

::: {#header-field-processing-reporting}
::: {#section-2.3.3 .section}
#### [2.3.3.](#section-2.3.3){.section-number .selfRef} [Reporting](#name-reporting){.section-name .selfRef} {#name-reporting}

If the UA receives, over a secure transport, an HTTP response that
includes an Expect-CT header field with a `report-uri` directive, and
the connection does not comply with the UA\'s CT Policy (i.e., the
connection is not CT qualified), and the UA has not already sent an
Expect-CT report for this connection, then the UA [SHOULD]{.bcp14} send
a report to the specified `report-uri` as specified in [Section
3](#reporting-expect-ct-failure){.xref}.[¶](#section-2.3.3-1){.pilcrow}
:::
:::
:::
:::

::: {#expect-ct-compliance}
::: {#section-2.4 .section}
### [2.4.](#section-2.4){.section-number .selfRef} [Evaluating Expect-CT Connections for CT Compliance](#name-evaluating-expect-ct-connec){.section-name .selfRef} {#name-evaluating-expect-ct-connec}

When a UA sets up a TLS connection, the UA determines whether the host
is a Known Expect-CT Host according to its Known Expect-CT Host cache.
An Expect-CT Host is \"expired\" if the Effective Expiration Date refers
to a date in the past. The UA [MUST]{.bcp14} ignore any expired
Expect-CT Hosts in its cache and not treat such hosts as Known Expect-CT
Hosts.[¶](#section-2.4-1){.pilcrow}

When a UA connects to a Known Expect-CT Host using a TLS connection, if
the TLS connection has no errors, then the UA will apply an additional
correctness check: compliance with a CT Policy. A UA should evaluate
compliance with its CT Policy whenever connecting to a Known Expect-CT
Host. However, the check can be skipped for local policy reasons (as
discussed in [Section 2.4.1](#skipping-ct-compliance-checks){.xref}) or
in the event that other checks cause the UA to terminate the connection
before CT compliance is evaluated. For example, a Public Key Pinning
failure \[[RFC7469](#RFC7469){.xref}\] could cause the UA to terminate
the connection before CT compliance is checked. Similarly, if the UA
terminates the connection due to an Expect-CT failure, this could cause
the UA to skip subsequent correctness checks. When the CT compliance
check is skipped or bypassed, Expect-CT reports ([Section
3](#reporting-expect-ct-failure){.xref}) will not be
sent.[¶](#section-2.4-2){.pilcrow}

When CT compliance is evaluated for a Known Expect-CT Host, the UA
[MUST]{.bcp14} evaluate compliance when setting up the TLS session,
before beginning an HTTP conversation over the TLS
channel.[¶](#section-2.4-3){.pilcrow}

If a connection to a Known Expect-CT Host violates the UA\'s CT Policy
(i.e., the connection is not CT qualified), and if the Known Expect-CT
Host\'s Expect-CT metadata indicates an `enforce` configuration, the UA
[MUST]{.bcp14} treat the CT compliance failure as an error. The UA
[MAY]{.bcp14} allow the user to bypass the error unless connection
errors should have no user recourse due to other policies in effect
(such as HSTS, as described in [Section
12.1](https://www.rfc-editor.org/rfc/rfc6797#section-12.1){.relref} of
\[[RFC6797](#RFC6797){.xref}\]).[¶](#section-2.4-4){.pilcrow}

If a connection to a Known Expect-CT Host violates the UA\'s CT Policy,
and if the Known Expect-CT Host\'s Expect-CT metadata includes a
`report-uri`, the UA [SHOULD]{.bcp14} send an Expect-CT report to that
`report-uri` ([Section
3](#reporting-expect-ct-failure){.xref}).[¶](#section-2.4-5){.pilcrow}

::: {#skipping-ct-compliance-checks}
::: {#section-2.4.1 .section}
#### [2.4.1.](#section-2.4.1){.section-number .selfRef} [Skipping CT Compliance Checks](#name-skipping-ct-compliance-chec){.section-name .selfRef} {#name-skipping-ct-compliance-chec}

It is acceptable for a UA to skip CT compliance checks for some hosts
according to local policy. For example, a UA [MAY]{.bcp14} disable CT
compliance checks for hosts whose validated certificate chain terminates
at a user-defined trust anchor rather than a trust anchor built in to
the UA (or underlying platform).[¶](#section-2.4.1-1){.pilcrow}

If the UA does not evaluate CT compliance, e.g., because the user has
elected to disable it, or because a presented certificate chain chains
up to a user-defined trust anchor, UAs [SHOULD NOT]{.bcp14} send
Expect-CT reports.[¶](#section-2.4.1-2){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#reporting-expect-ct-failure}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Reporting Expect-CT Failure](#name-reporting-expect-ct-failure){.section-name .selfRef} {#name-reporting-expect-ct-failure}

When the UA attempts to connect to a Known Expect-CT Host and the
connection is not CT qualified, the UA [SHOULD]{.bcp14} report Expect-CT
failures to the `report-uri`, if any, in the Known Expect-CT Host\'s
Expect-CT metadata.[¶](#section-3-1){.pilcrow}

When the UA receives an Expect-CT response header field over a
connection that is not CT qualified, if the UA has not already sent an
Expect-CT report for this connection, then the UA [SHOULD]{.bcp14}
report Expect-CT failures to the configured `report-uri`, if
any.[¶](#section-3-2){.pilcrow}

::: {#generating-a-violation-report}
::: {#section-3.1 .section}
### [3.1.](#section-3.1){.section-number .selfRef} [Generating a Violation Report](#name-generating-a-violation-repo){.section-name .selfRef} {#name-generating-a-violation-repo}

To generate a violation `report object`, the UA constructs a JSON
\[[RFC8259](#RFC8259){.xref}\] object with the following keys and
values:[¶](#section-3.1-1){.pilcrow}

[]{.break}

\"date-time\"
:   The value for this key indicates the UTC time that the UA observed
    the CT compliance failure. The value is a string formatted according
    to [Section
    5.6](https://www.rfc-editor.org/rfc/rfc3339#section-5.6){.relref} of
    \[[RFC3339](#RFC3339){.xref}\], \"Internet Date/Time
    Format\".[¶](#section-3.1-2.2){.pilcrow}
:   

\"hostname\"
:   The value is the hostname to which the UA made the original request
    that failed the CT compliance check. The value is provided as a
    string.[¶](#section-3.1-2.4){.pilcrow}
:   

\"port\"
:   The value is the port to which the UA made the original request that
    failed the CT compliance check. The value is provided as an
    integer.[¶](#section-3.1-2.6){.pilcrow}
:   

\"scheme\"
:   (optional) The value is the scheme with which the UA made the
    original request that failed the CT compliance check. The value is
    provided as a string. This key is optional and is assumed to be
    \"https\" if not present.[¶](#section-3.1-2.8){.pilcrow}
:   

\"effective-expiration-date\"
:   The value indicates the Effective Expiration Date (see [Section
    2.3.2.2](#storage-model){.xref}) for the Expect-CT Host that failed
    the CT compliance check, in UTC. The value is provided as a string
    formatted according to [Section
    5.6](https://www.rfc-editor.org/rfc/rfc3339#section-5.6){.relref} of
    \[[RFC3339](#RFC3339){.xref}\], \"Internet Date/Time
    Format\".[¶](#section-3.1-2.10){.pilcrow}
:   

\"served-certificate-chain\"
:   The value is the certificate chain as served by the Expect-CT Host
    during TLS session setup. The value is provided as an array of
    strings, which [MUST]{.bcp14} appear in the order that the
    certificates were served; each string in the array is the
    Privacy-Enhanced Mail (PEM) representation of each X.509 certificate
    as described in
    \[[RFC7468](#RFC7468){.xref}\].[¶](#section-3.1-2.12){.pilcrow}
:   

\"validated-certificate-chain\"
:   The value is the certificate chain as constructed by the UA during
    certificate chain verification. (This may differ from the value of
    the \"served-certificate-chain\" key.) The value is provided as an
    array of strings, which [MUST]{.bcp14} appear in the order matching
    the chain that the UA validated; each string in the array is the PEM
    representation of each X.509 certificate as described in
    \[[RFC7468](#RFC7468){.xref}\]. The first certificate in the chain
    represents the end-entity certificate being verified. UAs that build
    certificate chains in more than one way during the validation
    process [SHOULD]{.bcp14} send the last chain
    built.[¶](#section-3.1-2.14){.pilcrow}
:   

\"scts\"
:   The value represents the SCTs (if any) that the UA received for the
    Expect-CT Host and their validation statuses. The value is provided
    as an array of JSON objects. The SCTs may appear in any order. Each
    JSON object in the array has the following
    keys:[¶](#section-3.1-2.16){.pilcrow}
:   

-   [A \"version\" key, with an integer value. The UA [MUST]{.bcp14} set
    this value to 1 if the SCT is in the format defined in [Section
    3.2](https://www.rfc-editor.org/rfc/rfc6962#section-3.2){.relref} of
    \[[RFC6962](#RFC6962){.xref}\] or 2 if it is in the format defined
    in [Section
    4.5](https://www.rfc-editor.org/rfc/rfc9162#section-4.5){.relref} of
    \[[RFC9162](#RFC9162){.xref}\].[¶](#section-3.1-3.1){.pilcrow}]{#section-3.1-3.1}
-   [The \"status\" key, with a string value that the UA [MUST]{.bcp14}
    set to one of the following values: \"unknown\" (indicating that the
    UA does not have or does not trust the public key of the log from
    which the SCT was issued); \"valid\" (indicating that the UA
    successfully validated the SCT as described in [Section
    5.2](https://www.rfc-editor.org/rfc/rfc6962#section-5.2){.relref} of
    \[[RFC6962](#RFC6962){.xref}\] or [Section
    8.1.3](https://www.rfc-editor.org/rfc/rfc9162#section-8.1.3){.relref}
    of \[[RFC9162](#RFC9162){.xref}\]); or \"invalid\" (indicating that
    the SCT validation failed because of a bad signature or an invalid
    timestamp).[¶](#section-3.1-3.2){.pilcrow}]{#section-3.1-3.2}
-   [The \"source\" key, with a string value that indicates from where
    the UA obtained the SCT, as defined in [Section
    3](https://www.rfc-editor.org/rfc/rfc6962#section-3){.relref} of
    \[[RFC6962](#RFC6962){.xref}\] and [Section
    6](https://www.rfc-editor.org/rfc/rfc9162#section-6){.relref} of
    \[[RFC9162](#RFC9162){.xref}\]. The UA [MUST]{.bcp14} set the value
    to one of the following: \"tls-extension\", \"ocsp\", or
    \"embedded\". These correspond to the three methods of delivering
    SCTs in the TLS handshake that are described in [Section
    3.3](https://www.rfc-editor.org/rfc/rfc6962#section-3.3){.relref} of
    \[[RFC6962](#RFC6962){.xref}\].[¶](#section-3.1-3.3){.pilcrow}]{#section-3.1-3.3}
-   [The \"serialized_sct\" key, with a string value. If the value of
    the \"version\" key is 1, the UA [MUST]{.bcp14} set this value to
    the base64-encoded \[[RFC4648](#RFC4648){.xref}\] serialized
    `SignedCertificateTimestamp` structure from [Section
    3.2](https://www.rfc-editor.org/rfc/rfc6962#section-3.2){.relref} of
    \[[RFC6962](#RFC6962){.xref}\]. The base64 encoding is defined in
    [Section
    4](https://www.rfc-editor.org/rfc/rfc4648#section-4){.relref} of
    \[[RFC4648](#RFC4648){.xref}\]. If the value of the \"version\" key
    is 2, the UA [MUST]{.bcp14} set this value to the base64-encoded
    \[[RFC4648](#RFC4648){.xref}\] serialized `TransItem` structure
    representing the SCT, as defined in [Section
    4.5](https://www.rfc-editor.org/rfc/rfc9162#section-4.5){.relref} of
    \[[RFC9162](#RFC9162){.xref}\].[¶](#section-3.1-3.4){.pilcrow}]{#section-3.1-3.4}

[]{.break}

\"failure-mode\"
:   The value indicates whether the Expect-CT report was triggered by an
    Expect-CT policy in enforce or report-only mode. The value is
    provided as a string. The UA [MUST]{.bcp14} set this value to
    \"enforce\" if the Expect-CT metadata indicates an `enforce`
    configuration, and \"report-only\"
    otherwise.[¶](#section-3.1-4.2){.pilcrow}
:   

\"test-report\"
:   (optional) The value is set to true if the report is being sent by a
    testing client to verify that the report server behaves correctly.
    The value is provided as a boolean and [MUST]{.bcp14} be set to true
    if the report serves to test the server\'s behavior and can be
    discarded.[¶](#section-3.1-4.4){.pilcrow}
:   
:::
:::

::: {#sending-report}
::: {#section-3.2 .section}
### [3.2.](#section-3.2){.section-number .selfRef} [Sending a Violation Report](#name-sending-a-violation-report){.section-name .selfRef} {#name-sending-a-violation-report}

The UA [SHOULD]{.bcp14} report Expect-CT failures for Known Expect-CT
Hosts: that is, when a connection to a Known Expect-CT Host does not
comply with the UA\'s CT Policy and the host\'s Expect-CT metadata
contains a `report-uri`.[¶](#section-3.2-1){.pilcrow}

Additionally, the UA [SHOULD]{.bcp14} report Expect-CT failures for
hosts for which it does not have any stored Expect-CT metadata; that is,
when the UA connects to a host and receives an Expect-CT header field
that contains the `report-uri` directive, the UA [SHOULD]{.bcp14} report
an Expect-CT failure if the connection does not comply with the UA\'s CT
Policy.[¶](#section-3.2-2){.pilcrow}

The steps to report an Expect-CT failure are as
follows.[¶](#section-3.2-3){.pilcrow}

1.  [Prepare a JSON object `report object` with the single key
    \"expect-ct-report\", whose value is the result of generating a
    violation `report object` as described in [Section
    3.1](#generating-a-violation-report){.xref}.[¶](#section-3.2-4.1){.pilcrow}]{#section-3.2-4.1}
2.  [Let `report body` be the JSON stringification of
    `report object`.[¶](#section-3.2-4.2){.pilcrow}]{#section-3.2-4.2}
3.  [Let `report-uri` be the value of the `report-uri` directive in the
    Expect-CT header
    field.[¶](#section-3.2-4.3){.pilcrow}]{#section-3.2-4.3}
4.  [Send an HTTP POST request to `report-uri` with a `Content-Type`
    header field of `application/expect-ct-report+json` and an entity
    body consisting of
    `report body`.[¶](#section-3.2-4.4){.pilcrow}]{#section-3.2-4.4}

The UA [MAY]{.bcp14} perform other operations as part of sending the
HTTP POST request, such as sending a Cross-Origin Resource Sharing
(CORS) preflight as part of
\[[FETCH](#FETCH){.xref}\].[¶](#section-3.2-5){.pilcrow}

Future versions of this specification may need to modify or extend the
Expect-CT report format. They may do so by defining a new top-level key
to contain the report, replacing the \"expect-ct-report\" key. [Section
3.3](#receiving-report){.xref} defines how report servers should handle
report formats that they do not support.[¶](#section-3.2-6){.pilcrow}
:::
:::

::: {#receiving-report}
::: {#section-3.3 .section}
### [3.3.](#section-3.3){.section-number .selfRef} [Receiving a Violation Report](#name-receiving-a-violation-repor){.section-name .selfRef} {#name-receiving-a-violation-repor}

Upon receiving an Expect-CT violation report, the report server
[MUST]{.bcp14} respond with a 2xx (Successful) status code if it can
parse the request body as valid JSON, the report conforms to the format
described in [Section 3.1](#generating-a-violation-report){.xref}, and
it recognizes the scheme, hostname, and port in the \"scheme\",
\"hostname\", and \"port\" fields of the report. If the `report body`
cannot be parsed or does not conform to the format described in [Section
3.1](#generating-a-violation-report){.xref}, or the report server does
not expect to receive reports for the scheme, hostname, or port in the
report, then the report server [MUST]{.bcp14} respond with a 400 Bad
Request status code.[¶](#section-3.3-1){.pilcrow}

As described in [Section 3.2](#sending-report){.xref}, future versions
of this specification may define new report formats that are sent with a
different top-level key. If the report server does not recognize the
report format, the report server [MUST]{.bcp14} respond with a 501 Not
Implemented status code.[¶](#section-3.3-2){.pilcrow}

If the report\'s \"test-report\" key is set to true, the server
[MAY]{.bcp14} discard the report without further processing but
[MUST]{.bcp14} still return a 2xx (Successful) status code. If the
\"test-report\" key is absent or set to false, the server
[SHOULD]{.bcp14} store the report for processing and analysis by the
owner of the Expect-CT Host.[¶](#section-3.3-3){.pilcrow}
:::
:::
:::
:::

::: {#usability-considerations}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Usability Considerations](#name-usability-considerations){.section-name .selfRef} {#name-usability-considerations}

When the UA detects a Known Expect-CT Host in violation of the UA\'s CT
Policy, end users will experience denials of service. It is advisable
for UAs to explain to users why they cannot access the Expect-CT Host,
e.g., in a user interface that explains that the host\'s certificate
cannot be validated.[¶](#section-4-1){.pilcrow}
:::
:::

::: {#authoring-considerations}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Authoring Considerations](#name-authoring-considerations){.section-name .selfRef} {#name-authoring-considerations}

Expect-CT could be specified as a TLS extension or X.509 certificate
extension instead of an HTTP response header field. Using an HTTP header
field as the mechanism for Expect-CT introduces a layering mismatch; for
example, the software that terminates TLS and validates Certificate
Transparency information might know nothing about HTTP. Nevertheless, an
HTTP header field was chosen primarily for ease of deployment. In
practice, deploying new certificate extensions requires certificate
authorities to support them, and new TLS extensions require server
software updates, including possibly to servers outside of the site
owner\'s direct control (such as in the case of a third-party Content
Delivery Network (CDN)). Ease of deployment is a high priority for
Expect-CT because it is intended as a temporary transition mechanism for
user agents that are transitioning to universal Certificate Transparency
requirements.[¶](#section-5-1){.pilcrow}
:::
:::

::: {#privacy-considerations}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Privacy Considerations](#name-privacy-considerations){.section-name .selfRef} {#name-privacy-considerations}

Expect-CT can be used to infer what Certificate Transparency Policy a UA
is using by attempting to retrieve specially configured websites that
pass one user agent\'s policies but not another\'s. Note that this
consideration is true of UAs that enforce CT policies without Expect-CT
as well.[¶](#section-6-1){.pilcrow}

Additionally, reports submitted to the `report-uri` could reveal
information to a third party about which web page is being accessed and
by which IP address, by using individual `report-uri` values for
individually tracked pages. This information could be leaked even if
client-side scripting were disabled.[¶](#section-6-2){.pilcrow}

Implementations store state about Known Expect-CT Hosts and, hence,
which domains the UA has contacted. Implementations may choose to not
store this state subject to local policy (e.g., in the private browsing
mode of a web browser).[¶](#section-6-3){.pilcrow}

Violation reports, as noted in [Section
3](#reporting-expect-ct-failure){.xref}, contain information about the
certificate chain that has violated the CT Policy. In some cases, such
as an organization-wide compromise of the end-to-end security of TLS,
this may include information about the interception tools and design
used by the organization that the organization would otherwise prefer
not be disclosed.[¶](#section-6-4){.pilcrow}

Because Expect-CT causes remotely detectable behavior, it\'s advisable
that UAs offer a way for privacy-sensitive end users to clear currently
noted Expect-CT Hosts and allow users to query the current state of
Known Expect-CT Hosts.[¶](#section-6-5){.pilcrow}
:::
:::

::: {#security-considerations}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

::: {#hostile-header-attacks}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Hostile Header Attacks](#name-hostile-header-attacks){.section-name .selfRef} {#name-hostile-header-attacks}

When UAs support the Expect-CT header field, it becomes a potential
vector for hostile header attacks against site owners. If a site owner
uses a certificate issued by a certificate authority that does not embed
SCTs nor serve SCTs via the Online Certificate Status Protocol (OCSP) or
TLS extension, a malicious server operator or attacker could temporarily
reconfigure the host to comply with the UA\'s CT Policy and add the
Expect-CT header field in enforcing mode with a long `max-age`.
Implementing user agents would note this as an Expect-CT Host (see
[Section 2.3.2.1](#noting-expect-ct){.xref}). After having done this,
the configuration could then be reverted to not comply with the CT
Policy, prompting failures. Note that this scenario would require the
attacker to have substantial control over the infrastructure in
question, being able to obtain different certificates, change server
software, or act as a man in the middle in
connections.[¶](#section-7.1-1){.pilcrow}

Site operators can mitigate this situation by one of the following:
reconfiguring their web server to transmit SCTs using the TLS extension
defined in [Section
6.5](https://www.rfc-editor.org/rfc/rfc9162#section-6.5){.relref} of
\[[RFC9162](#RFC9162){.xref}\]; obtaining a certificate from an
alternative certificate authority that provides SCTs by one of the other
methods; or by waiting for the user agent\'s persisted notation of this
as an Expect-CT Host to reach its `max-age`. User agents may choose to
implement mechanisms for users to cure this situation, as noted in
[Section
4](#usability-considerations){.xref}.[¶](#section-7.1-2){.pilcrow}
:::
:::

::: {#maximum-max-age}
::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [Maximum max-age](#name-maximum-max-age){.section-name .selfRef} {#name-maximum-max-age}

There is a security trade-off in that low maximum values provide a
narrow window of protection for users that visit the Known Expect-CT
Host only infrequently, while high maximum values might result in a
denial of service to a UA in the event of a hostile header attack or
simply an error on the part of the site
owner.[¶](#section-7.2-1){.pilcrow}

There is probably no ideal maximum for the `max-age` directive. Since
Expect-CT is primarily a policy-expansion and investigation technology
rather than an end-user protection, a value on the order of 30 days
(2,592,000 seconds) may be considered a balance between these competing
security concerns.[¶](#section-7.2-2){.pilcrow}
:::
:::

::: {#amplification-attacks}
::: {#section-7.3 .section}
### [7.3.](#section-7.3){.section-number .selfRef} [Amplification Attacks](#name-amplification-attacks){.section-name .selfRef} {#name-amplification-attacks}

Another kind of hostile header attack uses the `report-uri` mechanism on
many hosts not currently exposing SCTs as a method to cause a denial of
service to the host receiving the reports. If some highly trafficked
websites emitted a non-enforcing Expect-CT header field with a
`report-uri`, implementing UAs\' reports could flood the reporting host.
It is noted in [Section 2.1.1](#the-report-uri-directive){.xref} that
UAs should limit the rate at which they emit reports, but an attacker
may alter the Expect-CT header fields to induce UAs to submit different
reports to different URIs to still cause the same
effect.[¶](#section-7.3-1){.pilcrow}
:::
:::
:::
:::

::: {#iana-considerations}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

::: {#header-field-registry}
::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Header Field Registry](#name-header-field-registry){.section-name .selfRef} {#name-header-field-registry}

This document registers the \"Expect-CT\" header field in the
\"Hypertext Transfer Protocol (HTTP) Field Name Registry\" registry
located at
\<<https://www.iana.org/assignments/http-fields>\>.[¶](#section-8.1-1){.pilcrow}

[]{.break}

Header field name:
:   Expect-CT[¶](#section-8.1-2.2){.pilcrow}
:   

Applicable protocol:
:   http[¶](#section-8.1-2.4){.pilcrow}
:   

Status:
:   permanent[¶](#section-8.1-2.6){.pilcrow}
:   

Author/Change controller:
:   IETF[¶](#section-8.1-2.8){.pilcrow}
:   

Specification document(s):
:   This document[¶](#section-8.1-2.10){.pilcrow}
:   

Related information:
:   (empty)[¶](#section-8.1-2.12){.pilcrow}
:   
:::
:::

::: {#media-types-registry}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Media Types Registry](#name-media-types-registry){.section-name .selfRef} {#name-media-types-registry}

This document registers the `application/expect-ct-report+json` media
type (which uses the suffix established in
\[[RFC6839](#RFC6839){.xref}\]) for Expect-CT violation reports in the
\"Media Types\" registry as follows.[¶](#section-8.2-1){.pilcrow}

[]{.break}

Type name:
:   application[¶](#section-8.2-2.2){.pilcrow}
:   

Subtype name:
:   expect-ct-report+json[¶](#section-8.2-2.4){.pilcrow}
:   

Required parameters:
:   n/a[¶](#section-8.2-2.6){.pilcrow}
:   

Optional parameters:
:   n/a[¶](#section-8.2-2.8){.pilcrow}
:   

Encoding considerations:
:   binary[¶](#section-8.2-2.10){.pilcrow}
:   

Security considerations:
:   See [Section
    7](#security-considerations){.xref}[¶](#section-8.2-2.12){.pilcrow}
:   

Interoperability considerations:
:   n/a[¶](#section-8.2-2.14){.pilcrow}
:   

Published specification:
:   This document[¶](#section-8.2-2.16){.pilcrow}
:   

Applications that use this media type:
:   UAs that implement Certificate Transparency compliance checks and
    reporting[¶](#section-8.2-2.18){.pilcrow}
:   

Additional information:

:   

:   

:   Deprecated alias names for this type:
    n/a[¶](#section-8.2-2.22){.pilcrow}
:   

:   Magic number(s): n/a[¶](#section-8.2-2.24){.pilcrow}
:   

:   File extension(s): n/a[¶](#section-8.2-2.26){.pilcrow}
:   

:   Macintosh file type code(s): n/a[¶](#section-8.2-2.28){.pilcrow}
:   

Person & email address to contact for further information:
:   \
    Emily Stark (estark\@google.com)[¶](#section-8.2-2.30){.pilcrow}
:   

Intended usage:
:   COMMON[¶](#section-8.2-2.32){.pilcrow}
:   

Restrictions on usage:
:   none[¶](#section-8.2-2.34){.pilcrow}
:   

Author:
:   Emily Stark (estark\@google.com)[¶](#section-8.2-2.36){.pilcrow}
:   

Change controller:
:   IETF[¶](#section-8.2-2.38){.pilcrow}
:   
:::
:::
:::
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC3339\]
:   [Klyne, G.]{.refAuthor} and [C. Newman]{.refAuthor}, [\"Date and
    Time on the Internet: Timestamps\"]{.refTitle}, [RFC
    3339]{.seriesInfo}, [DOI 10.17487/RFC3339]{.seriesInfo}, July 2002,
    \<<https://www.rfc-editor.org/info/rfc3339>\>.
:   

\[RFC3986\]
:   [Berners-Lee, T.]{.refAuthor}, [Fielding, R.]{.refAuthor}, and [L.
    Masinter]{.refAuthor}, [\"Uniform Resource Identifier (URI): Generic
    Syntax\"]{.refTitle}, [STD 66]{.seriesInfo}, [RFC
    3986]{.seriesInfo}, [DOI 10.17487/RFC3986]{.seriesInfo}, January
    2005, \<<https://www.rfc-editor.org/info/rfc3986>\>.
:   

\[RFC4648\]
:   [Josefsson, S.]{.refAuthor}, [\"The Base16, Base32, and Base64 Data
    Encodings\"]{.refTitle}, [RFC 4648]{.seriesInfo}, [DOI
    10.17487/RFC4648]{.seriesInfo}, October 2006,
    \<<https://www.rfc-editor.org/info/rfc4648>\>.
:   

\[RFC5234\]
:   [Crocker, D., Ed.]{.refAuthor} and [P. Overell]{.refAuthor},
    [\"Augmented BNF for Syntax Specifications: ABNF\"]{.refTitle}, [STD
    68]{.seriesInfo}, [RFC 5234]{.seriesInfo}, [DOI
    10.17487/RFC5234]{.seriesInfo}, January 2008,
    \<<https://www.rfc-editor.org/info/rfc5234>\>.
:   

\[RFC5280\]
:   [Cooper, D.]{.refAuthor}, [Santesson, S.]{.refAuthor},
    [Farrell, S.]{.refAuthor}, [Boeyen, S.]{.refAuthor},
    [Housley, R.]{.refAuthor}, and [W. Polk]{.refAuthor}, [\"Internet
    X.509 Public Key Infrastructure Certificate and Certificate
    Revocation List (CRL) Profile\"]{.refTitle}, [RFC
    5280]{.seriesInfo}, [DOI 10.17487/RFC5280]{.seriesInfo}, May 2008,
    \<<https://www.rfc-editor.org/info/rfc5280>\>.
:   

\[RFC6797\]
:   [Hodges, J.]{.refAuthor}, [Jackson, C.]{.refAuthor}, and [A.
    Barth]{.refAuthor}, [\"HTTP Strict Transport Security
    (HSTS)\"]{.refTitle}, [RFC 6797]{.seriesInfo}, [DOI
    10.17487/RFC6797]{.seriesInfo}, November 2012,
    \<<https://www.rfc-editor.org/info/rfc6797>\>.
:   

\[RFC6839\]
:   [Hansen, T.]{.refAuthor} and [A. Melnikov]{.refAuthor},
    [\"Additional Media Type Structured Syntax Suffixes\"]{.refTitle},
    [RFC 6839]{.seriesInfo}, [DOI 10.17487/RFC6839]{.seriesInfo},
    January 2013, \<<https://www.rfc-editor.org/info/rfc6839>\>.
:   

\[RFC6962\]
:   [Laurie, B.]{.refAuthor}, [Langley, A.]{.refAuthor}, and [E.
    Kasper]{.refAuthor}, [\"Certificate Transparency\"]{.refTitle}, [RFC
    6962]{.seriesInfo}, [DOI 10.17487/RFC6962]{.seriesInfo}, June 2013,
    \<<https://www.rfc-editor.org/info/rfc6962>\>.
:   

\[RFC7468\]
:   [Josefsson, S.]{.refAuthor} and [S. Leonard]{.refAuthor}, [\"Textual
    Encodings of PKIX, PKCS, and CMS Structures\"]{.refTitle}, [RFC
    7468]{.seriesInfo}, [DOI 10.17487/RFC7468]{.seriesInfo}, April 2015,
    \<<https://www.rfc-editor.org/info/rfc7468>\>.
:   

\[RFC7469\]
:   [Evans, C.]{.refAuthor}, [Palmer, C.]{.refAuthor}, and [R.
    Sleevi]{.refAuthor}, [\"Public Key Pinning Extension for
    HTTP\"]{.refTitle}, [RFC 7469]{.seriesInfo}, [DOI
    10.17487/RFC7469]{.seriesInfo}, April 2015,
    \<<https://www.rfc-editor.org/info/rfc7469>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8259\]
:   [Bray, T., Ed.]{.refAuthor}, [\"The JavaScript Object Notation
    (JSON) Data Interchange Format\"]{.refTitle}, [STD 90]{.seriesInfo},
    [RFC 8259]{.seriesInfo}, [DOI 10.17487/RFC8259]{.seriesInfo},
    December 2017, \<<https://www.rfc-editor.org/info/rfc8259>\>.
:   

\[RFC9110\]
:   [Fielding, R., Ed.]{.refAuthor}, [Nottingham, M., Ed.]{.refAuthor},
    and [J. Reschke, Ed.]{.refAuthor}, [\"HTTP Semantics\"]{.refTitle},
    [STD 97]{.seriesInfo}, [RFC 9110]{.seriesInfo}, [DOI
    10.17487/RFC9110]{.seriesInfo}, June 2022,
    \<<https://www.rfc-editor.org/info/rfc9110>\>.
:   

\[RFC9111\]
:   [Fielding, R., Ed.]{.refAuthor}, [Nottingham, M., Ed.]{.refAuthor},
    and [J. Reschke, Ed.]{.refAuthor}, [\"HTTP Caching\"]{.refTitle},
    [STD 98]{.seriesInfo}, [RFC 9111]{.seriesInfo}, [DOI
    10.17487/RFC9111]{.seriesInfo}, June 2022,
    \<<https://www.rfc-editor.org/info/rfc9111>\>.
:   

\[RFC9162\]
:   [Laurie, B.]{.refAuthor}, [Messeri, E.]{.refAuthor}, and [R.
    Stradling]{.refAuthor}, [\"Certificate Transparency Version
    2.0\"]{.refTitle}, [RFC 9162]{.seriesInfo}, [DOI
    10.17487/RFC9162]{.seriesInfo}, December 2021,
    \<<https://www.rfc-editor.org/info/rfc9162>\>.
:   
:::

::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[FETCH\]
:   [WHATWG]{.refAuthor}, [\"Fetch - Living Standard\"]{.refTitle},
    \<<https://fetch.spec.whatwg.org>\>.
:   

\[RFC8446\]
:   [Rescorla, E.]{.refAuthor}, [\"The Transport Layer Security (TLS)
    Protocol Version 1.3\"]{.refTitle}, [RFC 8446]{.seriesInfo}, [DOI
    10.17487/RFC8446]{.seriesInfo}, August 2018,
    \<<https://www.rfc-editor.org/info/rfc8446>\>.
:   
:::
:::

::: {#authors-addresses}
::: {#appendix-A .section}
## [Author\'s Address](#name-authors-address){.section-name .selfRef} {#name-authors-address}

::: {.left dir="auto"}
[Emily Stark]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google]{.org}
:::

::: email
Email: <estark@google.com>
:::
:::
:::
