  RFC 8775      PIM Designated Router Load Balancing   April 2020
  ------------- -------------------------------------- ------------
  Cai, et al.   Standards Track                        \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8775](https://www.rfc-editor.org/rfc/rfc8775){.eref}

Category:
:   Standards Track

Published:
:   April 2020

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    Y. Cai
    :::

    ::: org
    Alibaba Group
    :::
    :::

    ::: author
    ::: author-name
    H. Ou
    :::

    ::: org
    Alibaba Group
    :::
    :::

    ::: author
    ::: author-name
    S. Vallepalli
    :::
    :::

    ::: author
    ::: author-name
    M. Mishra
    :::

    ::: org
    Cisco Systems, Inc.
    :::
    :::

    ::: author
    ::: author-name
    S. Venaas
    :::

    ::: org
    Cisco Systems, Inc.
    :::
    :::

    ::: author
    ::: author-name
    A. Green
    :::

    ::: org
    British Telecom
    :::
    :::
:::

# RFC 8775 {#rfcnum}

# PIM Designated Router Load Balancing {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

On a multi-access network, one of the PIM-SM (PIM Sparse Mode) routers
is elected as a Designated Router. One of the responsibilities of the
Designated Router is to track local multicast listeners and forward data
to these listeners if the group is operating in PIM-SM. This document
specifies a modification to the PIM-SM protocol that allows more than
one of the PIM-SM routers to take on this responsibility so that the
forwarding load can be distributed among multiple
routers.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8775>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2020 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Terminology](#name-terminology){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Applicability](#name-applicability){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Functional
    Overview](#name-functional-overview){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [GDR
        Candidates](#name-gdr-candidates){.xref}[¶](#section-toc.1-1.4.2.1.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Protocol
    Specification](#name-protocol-specification){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [Hash Mask and Hash
        Algorithm](#name-hash-mask-and-hash-algorith){.xref}[¶](#section-toc.1-1.5.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [Modulo Hash
        Algorithm](#name-modulo-hash-algorithm){.xref}[¶](#section-toc.1-1.5.2.2.1){.pilcrow}

        -   ::: {#section-toc.1-1.5.2.2.2.1}
            [5.2.1](#section-5.2.1){.xref}.  [Modulo Hash Algorithm
            Examples](#name-modulo-hash-algorithm-examp){.xref}[¶](#section-toc.1-1.5.2.2.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.5.2.2.2.2}
            [5.2.2](#section-5.2.2){.xref}.  [Limitations](#name-limitations){.xref}[¶](#section-toc.1-1.5.2.2.2.2.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.xref}.  [PIM Hello
        Options](#name-pim-hello-options){.xref}[¶](#section-toc.1-1.5.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.5.2.3.2.1}
            [5.3.1](#section-5.3.1){.xref}.  [PIM DR Load-Balancing
            Capability (DRLB-Cap) Hello
            Option](#name-pim-dr-load-balancing-capab){.xref}[¶](#section-toc.1-1.5.2.3.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.5.2.3.2.2}
            [5.3.2](#section-5.3.2){.xref}.  [PIM DR Load-Balancing List
            (DRLB-List) Hello
            Option](#name-pim-dr-load-balancing-list-){.xref}[¶](#section-toc.1-1.5.2.3.2.2.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.5.2.4}
        [5.4](#section-5.4){.xref}.  [PIM DR
        Operation](#name-pim-dr-operation){.xref}[¶](#section-toc.1-1.5.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.5}
        [5.5](#section-5.5){.xref}.  [PIM GDR Candidate
        Operation](#name-pim-gdr-candidate-operation){.xref}[¶](#section-toc.1-1.5.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.6}
        [5.6](#section-5.6){.xref}.  [DRLB-List Hello Option
        Processing](#name-drlb-list-hello-option-proc){.xref}[¶](#section-toc.1-1.5.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.7}
        [5.7](#section-5.7){.xref}.  [PIM Assert
        Modification](#name-pim-assert-modification){.xref}[¶](#section-toc.1-1.5.2.7.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.5.2.8}
        [5.8](#section-5.8){.xref}.  [Backward
        Compatibility](#name-backward-compatibility){.xref}[¶](#section-toc.1-1.5.2.8.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Operational
    Considerations](#name-operational-considerations){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Initial
        Registry](#name-initial-registry){.xref}[¶](#section-toc.1-1.7.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [Assignment of New Hash
        Algorithms](#name-assignment-of-new-hash-algo){.xref}[¶](#section-toc.1-1.7.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [References](#name-references){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.9.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.9.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [](#section-appendix.a){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.11}
    [](#section-appendix.b){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

On a multi-access LAN (such as an Ethernet) with one or more PIM-SM (PIM
Sparse Mode) \[[RFC7761](#RFC7761){.xref}\] routers, one of the PIM-SM
routers is elected as a Designated Router (DR). The PIM DR has two
responsibilities in the PIM-SM protocol. For any active sources on a
LAN, the PIM DR is responsible for registering with the Rendezvous Point
(RP) if the group is operating in PIM-SM. Also, the PIM DR is
responsible for tracking local multicast listeners and forwarding data
to these listeners if the group is operating in
PIM-SM.[¶](#section-1-1){.pilcrow}

Consider the following LAN in [Figure
1](#LAN-REC){.xref}:[¶](#section-1-2){.pilcrow}

[]{#name-lan-with-receivers}

::: {#LAN-REC}
::: {#section-1-3.1 .artwork .art-text .alignLeft}
                              (core networks)
                               |     |     |
                               |     |     |
                              R1    R2     R3
                               |     |     |
                               ----(LAN)----
                                     |
                                     |
                             (many receivers)
:::

[Figure 1](#figure-1){.selfRef}: [LAN with
Receivers](#name-lan-with-receivers){.selfRef}
:::

Assume R1 is elected as the DR. According to the PIM-SM protocol, R1
will be responsible for forwarding traffic to that LAN on behalf of all
local members. In addition to keeping track of membership reports, R1 is
also responsible for initiating the creation of source and/or shared
trees towards the senders or the RPs. The membership reports would be
IGMP or Multicast Listener Discovery (MLD) messages. This applies to any
versions of the IGMP and MLD protocols. The most recent versions are
IGMPv3 \[[RFC3376](#RFC3376){.xref}\] and MLDv2
\[[RFC3810](#RFC3810){.xref}\].[¶](#section-1-4){.pilcrow}

Having a single router acting as DR and being responsible for data-plane
forwarding leads to several issues. One of the issues is that the
aggregated bandwidth will be limited to what R1 can handle with regards
to capacity of incoming links, the interface on the LAN, and total
forwarding capacity. It is very common that a LAN consists of switches
that run IGMP/MLD or PIM snooping \[[RFC4541](#RFC4541){.xref}\]. This
allows the forwarding of multicast packets to be restricted only to
segments leading to receivers that have indicated their interest in
multicast groups using either IGMP or MLD. The emergence of the switched
Ethernet allows the aggregated bandwidth to exceed, sometimes by a large
number, that of a single link. For example, let us modify [Figure
1](#LAN-REC){.xref} and introduce an Ethernet switch in [Figure
2](#LAN-SWITCH){.xref}.[¶](#section-1-5){.pilcrow}

[]{#name-lan-with-ethernet-switch}

::: {#LAN-SWITCH}
::: {#section-1-6.1 .artwork .art-text .alignLeft}
                             (core networks)
                              |     |     |
                              |     |     |
                             R1    R2     R3
                              |     |     |
                           +=gi1===gi2===gi3=+
                           +                 +
                           +      switch     +
                           +                 +
                           +=gi4===gi5===gi6=+
                              |     |     |
                             H1    H2     H3
:::

[Figure 2](#figure-2){.selfRef}: [LAN with Ethernet
Switch](#name-lan-with-ethernet-switch){.selfRef}
:::

Let us assume that each individual link is a Gigabit Ethernet. Each
router (R1, R2, and R3) and the switch have enough forwarding capacity
to handle hundreds of gigabits of data.[¶](#section-1-7){.pilcrow}

Let us further assume that each of the hosts requests 500 Mbps of unique
multicast data. This totals to 1.5 Gbps of data, which is less than what
each switch or the combined uplink bandwidth across the routers can
handle, even under failure of a single
router.[¶](#section-1-8){.pilcrow}

On the other hand, the link between R1 and switch, via port gi1, can
only handle a throughput of 1 Gbps. And if R1 is the only DR (the PIM DR
elected using the procedure defined by \[[RFC7761](#RFC7761){.xref}\]),
at least 500 Mbps worth of data will be lost because the only link that
can be used to draw the traffic from the routers to the switch is via
gi1. In other words, the entire network\'s throughput is limited by the
single connection between the PIM DR and the switch (or LAN, as in
[Figure 1](#LAN-REC){.xref}).[¶](#section-1-9){.pilcrow}

Another important issue is related to failover. If R1 is the only
forwarder on a shared LAN, when R1 goes out of service, multicast
forwarding for the entire LAN has to be rebuilt by the newly elected PIM
DR. However, if there were a way that allowed multiple routers to
forward to the LAN for different groups, failure of one of the routers
would only lead to disruption to a subset of the flows, therefore
improving the overall resilience of the
network.[¶](#section-1-10){.pilcrow}

This document specifies a modification to the PIM-SM protocol that
allows more than one of these routers, called Group Designated Routers
(GDRs), to be selected so that the forwarding load can be distributed
among a number of routers.[¶](#section-1-11){.pilcrow}
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}

With respect to PIM-SM, this document follows the terminology that has
been defined in
\[[RFC7761](#RFC7761){.xref}\].[¶](#section-2-2){.pilcrow}

This document also introduces the following new
acronyms:[¶](#section-2-3){.pilcrow}

GDR: Group Designated Router.
:   For each multicast flow, either a (\*,G) for Any-Source Multicast
    (ASM) or an (S,G) for Source-Specific Multicast (SSM)
    \[[RFC4607](#RFC4607){.xref}\], a hash algorithm (described below)
    is used to select one of the routers as a GDR. The GDR is
    responsible for initiating the forwarding tree building process for
    the corresponding multicast flow.[¶](#section-2-4.2){.pilcrow}
:   

GDR Candidate:
:   a router that has the potential to become a GDR. There might be
    multiple GDR Candidates on a LAN, but only one can become the GDR
    for a specific multicast flow.[¶](#section-2-4.4){.pilcrow}
:   
:::

::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Applicability](#name-applicability){.section-name .selfRef} {#name-applicability}

The extension specified in this document applies to PIM-SM routers
acting as last-hop routers (there are directly connected receivers). It
does not alter the behavior of a PIM DR or any other routers on the
first-hop network (directly connected sources). This is because the
source tree is built using the IP address of the sender, not the IP
address of the PIM DR that sends PIM registers towards the RP. The load
balancing between first-hop routers can be achieved naturally if an IGP
provides equal cost multiple paths (which it usually does in practice).
Also, distributing the load to do source registration does not justify
the additional complexity required to support
it.[¶](#section-3-1){.pilcrow}
:::

::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Functional Overview](#name-functional-overview){.section-name .selfRef} {#name-functional-overview}

In the PIM DR election as defined in \[[RFC7761](#RFC7761){.xref}\],
when multiple routers are connected to a multi-access LAN (for example,
an Ethernet), one of them is elected to act as PIM DR. The PIM DR is
responsible for sending local Join/Prune messages towards the RP or
source. In order to elect the PIM DR, each PIM router on the LAN
examines the received PIM Hello messages and compares its own DR
priority and IP address with those of its neighbors. The router with the
highest DR priority is the PIM DR. If there are multiple such routers,
their IP addresses are used as the tiebreaker, as described in
\[[RFC7761](#RFC7761){.xref}\].[¶](#section-4-1){.pilcrow}

In order to share forwarding load among last-hop routers, besides the
normal PIM DR election, one or more GDRs are elected on the multi-access
LAN. There is only one PIM DR on the multi-access LAN, but there might
be multiple GDR Candidates.[¶](#section-4-2){.pilcrow}

For each multicast flow, that is, (\*,G) for ASM and (S,G) for SSM, a
hash algorithm ([Section 5.1](#maskalgo){.xref}) is used to select one
of the routers to be the GDR. The new DR Load-Balancing Capability
(DRLB-Cap) PIM Hello Option is used to announce the Capability, as well
as the hash algorithm type. Routers with the new DRLB-Cap Option
advertised in their PIM Hello, using the same GDR election hash
algorithm and the same DR priority as the PIM DR, are considered as GDR
Candidates.[¶](#section-4-3){.pilcrow}

Hash masks are defined for Source, Group, and RP, separately, in order
to handle PIM ASM/SSM. The masks, as well as a sorted list of GDR
Candidate addresses, are announced by the DR in a new DR Load-Balancing
List (DRLB-List) PIM Hello Option.[¶](#section-4-4){.pilcrow}

A hash algorithm based on the announced Source, Group, or RP masks
allows one GDR to be assigned to a corresponding multicast state. That
GDR is responsible for initiating the creation of the multicast
forwarding tree for multicast traffic.[¶](#section-4-5){.pilcrow}

::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [GDR Candidates](#name-gdr-candidates){.section-name .selfRef} {#name-gdr-candidates}

GDR is the new concept introduced by this specification. GDR Candidates
are routers eligible for GDR election on the LAN. To become a GDR
Candidate, a router must have the same DR priority and run the same GDR
election hash algorithm as the DR on the
LAN.[¶](#section-4.1-1){.pilcrow}

For example, assume there are 4 routers on the LAN: R1, R2, R3, and R4,
each announcing a DRLB-Cap Option. R1, R2, and R3 have the same DR
priority, while R4\'s DR priority is less preferred. In this example, R4
will not be eligible for GDR election, because R4 will not become a PIM
DR unless all of R1, R2, and R3 go out of
service.[¶](#section-4.1-2){.pilcrow}

Furthermore, assume router R1 wins the PIM DR election, R1 and R2
advertise the same hash algorithm for GDR election, while R3 advertises
a different one. In this case, only R1 and R2 will be eligible for GDR
election, while R3 will not.[¶](#section-4.1-3){.pilcrow}

As a DR, R1 will include its own Load-Balancing Hash Masks and the
identity of R1 and R2 (the GDR Candidates) in its DRLB-List Hello
Option.[¶](#section-4.1-4){.pilcrow}
:::
:::

::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Protocol Specification](#name-protocol-specification){.section-name .selfRef} {#name-protocol-specification}

::: {#maskalgo}
::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [Hash Mask and Hash Algorithm](#name-hash-mask-and-hash-algorith){.section-name .selfRef} {#name-hash-mask-and-hash-algorith}

A hash mask is used to extract a number of bits from the corresponding
IP address field (32 for IPv4, 128 for IPv6) and calculate a hash value.
A hash value is used to select a GDR from GDR Candidates advertised by
the PIM DR. Hash masks allow for certain flows to always be forwarded by
the same GDR, by ignoring certain bits in the hash value calculation, so
that the hash values are the same. For example, 0.0.255.0 defines a hash
mask for an IPv4 address that masks the first, second, and fourth
octets, which means that only the third octet will influence the hash
value computed. Note that the masks need not be a contiguous set of
bits. For example, for IPv4, 15.15.15.15 would be a valid
mask.[¶](#section-5.1-1){.pilcrow}

In the text below, a hash mask is, in some places, said to be zero. A
hash mask is zero if no bits are set, that is, 0.0.0.0 for IPv4 and ::
for IPv6. Also, a hash mask is said to be an all-bits-set mask if it is
255.255.255.255 for IPv4 or ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff for
IPv6.[¶](#section-5.1-2){.pilcrow}

There are three hash masks defined:[¶](#section-5.1-3){.pilcrow}

-   [RP Hash Mask[¶](#section-5.1-4.1){.pilcrow}]{#section-5.1-4.1}
-   [Source Hash Mask[¶](#section-5.1-4.2){.pilcrow}]{#section-5.1-4.2}
-   [Group Hash Mask[¶](#section-5.1-4.3){.pilcrow}]{#section-5.1-4.3}

The hash masks need to be configured on the PIM routers that can
potentially become a PIM DR, unless the implementation provides default
hash mask values. An implementation [SHOULD]{.bcp14} have default hash
mask values as follows. The default RP Hash Mask [SHOULD]{.bcp14} be
zero (no bits set). The default Source and Group Hash Masks
[SHOULD]{.bcp14} both be all-bits-set masks. These default values are
likely acceptable for most deployments and simplify configuration. There
is only a need to use other masks if one needs to ensure that certain
flows are forwarded by the same GDR.[¶](#section-5.1-5){.pilcrow}

The DRLB-List Hello Option contains a list of GDR Candidates. The first
one listed has ordinal number 0, the second listed ordinal number 1, and
the last one has ordinal number N - 1 if there are N candidates listed.
The hash value computed will be the ordinal number of the GDR Candidate
that is acting as GDR for the flow in
question.[¶](#section-5.1-6){.pilcrow}

The input to be hashed is determined as
follows:[¶](#section-5.1-7){.pilcrow}

-   [If the group is in ASM mode and the RP Hash Mask announced by the
    PIM DR is not zero (at least one bit is set), calculate the value of
    hashvalue_RP ([Section 5.2](#algorithm){.xref}) to determine the
    GDR.[¶](#section-5.1-8.1){.pilcrow}]{#section-5.1-8.1}
-   [If the group is in ASM mode and the RP Hash Mask announced by the
    PIM DR is zero (no bits are set), obtain the value of
    hashvalue_Group ([Section 5.2](#algorithm){.xref}) to determine the
    GDR.[¶](#section-5.1-8.2){.pilcrow}]{#section-5.1-8.2}
-   [If the group is in SSM mode, use hashvalue_SG ([Section
    5.2](#algorithm){.xref}) to determine the
    GDR.[¶](#section-5.1-8.3){.pilcrow}]{#section-5.1-8.3}

A simple modulo hash algorithm is defined in this document. However, to
allow another hash algorithm to be used, a 1-octet \"Hash Algorithm\"
field is included in the DRLB-Cap Hello Option to specify the hash
algorithm used by the router.[¶](#section-5.1-9){.pilcrow}

If different hash algorithms are advertised among the routers on a LAN,
only the routers advertising the same hash algorithm as the DR (as well
as having the same DR priority as the DR) are eligible for GDR
election.[¶](#section-5.1-10){.pilcrow}
:::
:::

::: {#algorithm}
::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [Modulo Hash Algorithm](#name-modulo-hash-algorithm){.section-name .selfRef} {#name-modulo-hash-algorithm}

As part of computing the hash, the notation LSZC(hash_mask) is used to
denote the number of zeroes counted from the least significant bit of a
hash mask hash_mask. As an example, LSZC(255.255.128) is 7 and
LSZC(ffff:8000::) is 111. If all bits are set, LSZC will be 0. If the
mask is zero, then LSZC will be 32 for IPv4 and 128 for
IPv6.[¶](#section-5.2-1){.pilcrow}

The number of GDR Candidates is denoted as
GDRC.[¶](#section-5.2-2){.pilcrow}

The idea behind the modulo hash algorithm is, in simple terms, that the
corresponding mask is applied to a value, then the result is shifted
right LSZC(mask) bits so that the least significant bits that were
masked out are not considered. Then, this result is masked by
0xffffffff, keeping only the last 32 bits of the result (this only makes
a difference for IPv6). Finally, the hash value is this result modulo
the number of GDR Candidates (GDRC).[¶](#section-5.2-3){.pilcrow}

The modulo hash algorithm, for computing the values hashvalue_RP,
hashvalue_Group, and hashvalue_SG, is defined as
follows.[¶](#section-5.2-4){.pilcrow}

hashvalue_RP is calculated as:[¶](#section-5.2-5){.pilcrow}

::: {#section-5.2-6 .artwork .art-text .alignLeft}
       (((RP_address & RP_mask) >> LSZC(RP_mask)) & 0xffffffff) % GDRC

[¶](#section-5.2-6){.pilcrow}
:::

-   [RP_address is the address of the RP defined for the group, and
    RP_mask is the RP Hash
    Mask.[¶](#section-5.2-7.1){.pilcrow}]{#section-5.2-7.1}

hashvalue_Group is calculated as:[¶](#section-5.2-8){.pilcrow}

::: {#section-5.2-9 .artwork .art-text .alignLeft}
       (((Group_address & Group_mask) >> LSZC(Group_mask)) & 0xffffffff)
       % GDRC

[¶](#section-5.2-9){.pilcrow}
:::

-   [Group_address is the group address, and Group_mask is the Group
    Hash Mask.[¶](#section-5.2-10.1){.pilcrow}]{#section-5.2-10.1}

hashvalue_SG is calculated as:[¶](#section-5.2-11){.pilcrow}

::: {#section-5.2-12 .artwork .art-text .alignLeft}
       ((((Source_address & Source_mask) >> LSZC(Source_mask)) &
       0xffffffff) ^ (((Group_address & Group_mask) >> LSZC(Group_mask))
       & 0xffffffff)) % GDRC

[¶](#section-5.2-12){.pilcrow}
:::

-   [Group_address is the group address, and Group_mask is the Group
    Hash Mask.[¶](#section-5.2-13.1){.pilcrow}]{#section-5.2-13.1}

::: {#section-5.2.1 .section}
#### [5.2.1.](#section-5.2.1){.section-number .selfRef} [Modulo Hash Algorithm Examples](#name-modulo-hash-algorithm-examp){.section-name .selfRef} {#name-modulo-hash-algorithm-examp}

To help illustrate the algorithm, consider this example. Router X with
IPv4 address 203.0.113.1 receives a DRLB-List Hello Option from the DR
that announces RP Hash Mask 0.0.255.0 and a list of GDR Candidates,
sorted by IP addresses from high to low: 203.0.113.3, 203.0.113.2, and
203.0.113.1. The ordinal number assigned to those addresses would
be:[¶](#section-5.2.1-1){.pilcrow}

0 for 203.0.113.3; 1 for 203.0.113.2; 2 for 203.0.113.1 (Router
X).[¶](#section-5.2.1-2){.pilcrow}

Assume there are 2 RPs: RP1 192.0.2.1 for Group1 and RP2 198.51.100.2
for Group2. Following the modulo hash
algorithm:[¶](#section-5.2.1-3){.pilcrow}

-   [LSZC(0.0.255.0) is 8, and GDRC is 3. The hashvalue_RP for Group1
    with RP RP1
    is:[¶](#section-5.2.1-4.1){.pilcrow}]{#section-5.2.1-4.1}

```{=html}
<!-- -->
```
-   ::: {#section-5.2.1-5.1}
    ::: {#section-5.2.1-5.1.1 .artwork .art-text .alignLeft}
        (((192.0.2.1 & 0.0.255.0) >> 8) & 0xffffffff % 3)
        = 2 % 3
        = 2

    [¶](#section-5.2.1-5.1.1){.pilcrow}
    :::
    :::

-   [This matches the ordinal number assigned to Router X. Router X will
    be the GDR for
    Group1.[¶](#section-5.2.1-5.2){.pilcrow}]{#section-5.2.1-5.2}

```{=html}
<!-- -->
```
-   [The hashvalue_RP for Group2 with RP RP2
    is:[¶](#section-5.2.1-6.1){.pilcrow}]{#section-5.2.1-6.1}

```{=html}
<!-- -->
```
-   ::: {#section-5.2.1-7.1}
    ::: {#section-5.2.1-7.1.1 .artwork .art-text .alignLeft}
        (((198.51.100.2 & 0.0.255.0) >> 8) & 0xffffffff % 3)
        = 100 % 3
        = 1

    [¶](#section-5.2.1-7.1.1){.pilcrow}
    :::
    :::

-   [This is different from the ordinal number of Router X (2). Hence,
    Router X will not be GDR for
    Group2.[¶](#section-5.2.1-7.2){.pilcrow}]{#section-5.2.1-7.2}

For IPv6, consider this example, similar to the above. Router X with
IPv6 address fe80::1 receives a DRLB-List Hello Option from the DR that
announces RP Hash Mask ::ffff:ffff:ffff:0 and a list of GDR Candidates,
sorted by IP addresses from high to low: fe80::3, fe80::2, and fe80::1.
The ordinal number assigned to those addresses would
be:[¶](#section-5.2.1-8){.pilcrow}

-   [0 for fe80::3; 1 for fe80::2; 2 for fe80::1 (Router
    X).[¶](#section-5.2.1-9.1){.pilcrow}]{#section-5.2.1-9.1}

Assume there are 2 RPs: RP1 2001:db8::1:0:5678:1 for Group1 and RP2
2001:db8::1:0:1234:2 for Group2. Following the modulo hash
algorithm:[¶](#section-5.2.1-10){.pilcrow}

-   [LSZC(::ffff:ffff:ffff:0) is 16, and GDRC is 3. The hashvalue_RP for
    Group1 with RP RP1
    is:[¶](#section-5.2.1-11.1){.pilcrow}]{#section-5.2.1-11.1}

```{=html}
<!-- -->
```
-   ::: {#section-5.2.1-12.1}
    ::: {#section-5.2.1-12.1.1 .artwork .art-text .alignLeft}
        (((2001:db8::1:0:5678:1 & ::ffff:ffff:ffff:0) >> 16) &
         0xffffffff % 3)
        = ((::1:0:5678:0 >> 16) & 0xffffffff % 3)
        = (::1:0:5678 & 0xffffffff % 3)
        = ::5678 % 3
        = 2

    [¶](#section-5.2.1-12.1.1){.pilcrow}
    :::
    :::

-   [This matches the ordinal number assigned to Router X. Router X will
    be the GDR for
    Group1.[¶](#section-5.2.1-12.2){.pilcrow}]{#section-5.2.1-12.2}

```{=html}
<!-- -->
```
-   [The hashvalue_RP for Group2 with RP RP2
    is:[¶](#section-5.2.1-13.1){.pilcrow}]{#section-5.2.1-13.1}

```{=html}
<!-- -->
```
-   ::: {#section-5.2.1-14.1}
    ::: {#section-5.2.1-14.1.1 .artwork .art-text .alignLeft}
        (((2001:db8::1:0:1234:1 & ::ffff:ffff:ffff:0) >> 16) &
         0xffffffff % 3)
        = ((::1:0:1234:0 >> 16) & 0xffffffff % 3)
        = (::1:0:1234 & 0xffffffff % 3)
        = ::1234 % 3
        = 1

    [¶](#section-5.2.1-14.1.1){.pilcrow}
    :::
    :::

-   [This is different from the ordinal number of Router X (2). Hence,
    Router X will not be GDR for
    Group2.[¶](#section-5.2.1-14.2){.pilcrow}]{#section-5.2.1-14.2}
:::

::: {#section-5.2.2 .section}
#### [5.2.2.](#section-5.2.2){.section-number .selfRef} [Limitations](#name-limitations){.section-name .selfRef} {#name-limitations}

The modulo hash algorithm has poor failover characteristics when a
shared LAN has more than two GDRs. In the case of more than two GDRs on
a LAN, when one GDR fails, all of the groups may be reassigned to a
different GDR, even if they were not assigned to the failed GDR.
However, many deployments use only two routers on a shared LAN for
redundancy purposes. Future work may define new hash algorithms where
only groups assigned to the failed GDR get
reassigned.[¶](#section-5.2.2-1){.pilcrow}

The modulo hash algorithm will use, at most, 32 consecutive bits of the
input addresses for its computation. Exactly which bits are used of the
source, group, or RP addresses depend on the respective masks. This
limitation may be an issue for IPv6 deployments, since not all bits of
the IPv6 addresses are considered. If this causes operational issues, a
new hash algorithm would need to be
defined.[¶](#section-5.2.2-2){.pilcrow}
:::
:::
:::

::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [PIM Hello Options](#name-pim-hello-options){.section-name .selfRef} {#name-pim-hello-options}

PIM routers include a new option, called \"Load-Balancing Capability
(DRLB-Cap)\", in their PIM Hello messages.[¶](#section-5.3-1){.pilcrow}

Besides this DRLB-Cap Hello Option, the elected PIM DR also includes a
new \"DR Load-Balancing List (DRLB-List) Hello Option\". The DRLB-List
Hello Option consists of three hash masks, as defined above, and also a
list of GDR Candidate addresses on the LAN. It is recommended that the
GDR Candidate addresses are sorted in descending order. This ensures
that when using algorithms, such as the modulo hash algorithm in this
document, that it is predictable which GDR is responsible for which
groups, regardless of the order the DR learned about the
candidates.[¶](#section-5.3-2){.pilcrow}

::: {#section-5.3.1 .section}
#### [5.3.1.](#section-5.3.1){.section-number .selfRef} [PIM DR Load-Balancing Capability (DRLB-Cap) Hello Option](#name-pim-dr-load-balancing-capab){.section-name .selfRef} {#name-pim-dr-load-balancing-capab}

[]{#name-pim-dr-load-balancing-capabi}

::: {#PIM-CAP}
::: {#section-5.3.1-1.1 .artwork .art-text .alignCenter}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           Type = 34           |         Length = 4            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                     Reserved                  |Hash Algorithm |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:::

[Figure 3](#figure-3){.selfRef}: [PIM DR Load-Balancing Capability Hello
Option](#name-pim-dr-load-balancing-capabi){.selfRef}
:::

Type:
:   34[¶](#section-5.3.1-2.2){.pilcrow}
:   

Length:
:   4[¶](#section-5.3.1-2.4){.pilcrow}
:   

Reserved:
:   Transmitted as zero, ignored on
    receipt.[¶](#section-5.3.1-2.6){.pilcrow}
:   

Hash Algorithm:
:   Hash algorithm type. A value listed in the IANA \"PIM Designated
    Router Load-Balancing Hash Algorithms\" registry. 0 is used for the
    hash algorithm defined in this
    document.[¶](#section-5.3.1-2.8){.pilcrow}
:   

This DRLB-Cap Hello Option [MUST]{.bcp14} be advertised by routers on
all interfaces where DR Load Balancing is enabled. Note that the option
is included, at most, once.[¶](#section-5.3.1-3){.pilcrow}
:::

::: {#section-5.3.2 .section}
#### [5.3.2.](#section-5.3.2){.section-number .selfRef} [PIM DR Load-Balancing List (DRLB-List) Hello Option](#name-pim-dr-load-balancing-list-){.section-name .selfRef} {#name-pim-dr-load-balancing-list-}

[]{#name-pim-dr-load-balancing-list-h}

::: {#PIM-LIST}
::: {#section-5.3.2-1.1 .artwork .art-text .alignCenter}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           Type = 35           |         Length                |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                          Group Mask                           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                          Source Mask                          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                            RP Mask                            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                    GDR Candidate Address(es)                  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:::

[Figure 4](#figure-4){.selfRef}: [PIM DR Load-Balancing List Hello
Option](#name-pim-dr-load-balancing-list-h){.selfRef}
:::

Type:
:   35[¶](#section-5.3.2-2.2){.pilcrow}
:   

Length:
:   (3 + n) x (4 or 16) bytes, where n is the number of GDR
    Candidates.[¶](#section-5.3.2-2.4){.pilcrow}
:   

Group Mask (32/128 bits):
:   Mask applied to group addresses as part of hash
    computation.[¶](#section-5.3.2-2.6){.pilcrow}
:   

Source Mask (32/128 bits):
:   Mask applied to source addresses as part of hash
    computation.[¶](#section-5.3.2-2.8){.pilcrow}
:   

RP Mask (32/128 bits):
:   Mask applied to RP addresses as part of hash
    computation.[¶](#section-5.3.2-2.10){.pilcrow}
:   

All masks [MUST]{.bcp14} have the same number of bits as the IP source
address in the PIM Hello IP header.[¶](#section-5.3.2-3){.pilcrow}

GDR Candidate Address(es) (32/128 bits):

:   List of GDR Candidate(s)[¶](#section-5.3.2-4.2.1){.pilcrow}

    All addresses [MUST]{.bcp14} be in the same address family as the
    PIM Hello IP header. It is recommended that the addresses are sorted
    in descending order.[¶](#section-5.3.2-4.2.2){.pilcrow}

    If the \"Interface ID\" option, as specified in
    \[[RFC6395](#RFC6395){.xref}\], is present in a GDR Candidate\'s PIM
    Hello message and the \"Router Identifier\" portion is
    non-zero:[¶](#section-5.3.2-4.2.3){.pilcrow}

    -   [For IPv4, the \"GDR Candidate Address\" will be set directly to
        the \"Router
        Identifier\".[¶](#section-5.3.2-4.2.4.1){.pilcrow}]{#section-5.3.2-4.2.4.1}
    -   [For IPv6, the \"GDR Candidate Address\" will be 96 bits of
        zeroes, followed by the 32 bit Router
        Identifier.[¶](#section-5.3.2-4.2.4.2){.pilcrow}]{#section-5.3.2-4.2.4.2}

    If the \"Interface ID\" option is not present in a GDR Candidate\'s
    PIM Hello message or if the \"Interface ID\" option is present but
    the \"Router Identifier\" field is zero, the \"GDR Candidate
    Address\" will be the IPv4 or IPv6 source address of the PIM Hello
    message.[¶](#section-5.3.2-4.2.5){.pilcrow}

    This DRLB-List Hello Option [MUST]{.bcp14} only be advertised by the
    elected PIM DR. It [MUST]{.bcp14} be ignored if received from a
    non-DR. The option [MUST]{.bcp14} also be ignored if the hash masks
    are not the correct number of bits or GDR Candidate addresses are in
    the wrong address family.[¶](#section-5.3.2-4.2.6){.pilcrow}

:   
:::
:::

::: {#section-5.4 .section}
### [5.4.](#section-5.4){.section-number .selfRef} [PIM DR Operation](#name-pim-dr-operation){.section-name .selfRef} {#name-pim-dr-operation}

The DR election process is still the same as defined in
\[[RFC7761](#RFC7761){.xref}\]. The DR advertises the new DRLB-List
Hello Option, which contains mask values from user configuration (or
default values), followed by a list of GDR Candidate addresses. Note
that if a router included the \"Interface ID\" option in the hello
message and the Router ID is non-zero, the Router ID will be used to
form the GDR Candidate address of the router, as discussed in the
previous section. It is recommended that the list be sorted from the
highest value to the lowest value. The reason for sorting the list is to
make the behavior deterministic, regardless of the order in which the DR
learns of new candidates. Note that, as for non-DR routers, the DR also
advertises the DRLB-Cap Hello Option to indicate its ability to support
the new functionality and the type of GDR election hash algorithm it
uses.[¶](#section-5.4-1){.pilcrow}

If a PIM DR receives a neighbor DRLB-Cap Hello Option that contains the
same hash algorithm as the DR and the neighbor has the same DR priority
as the DR, PIM DR [SHOULD]{.bcp14} consider the neighbor as a GDR
Candidate and insert the GDR Candidate\'s Address into the list of the
DRLB-List Option. However, the DR may have policies limiting which or
the number of GDR Candidates to include. Likewise, the DR
[SHOULD]{.bcp14} include itself in the list of GDR Candidates, but it is
permissible not to do so, for instance, if there is some policy
restricting the candidate set.[¶](#section-5.4-2){.pilcrow}

If a PIM neighbor included in the list expires, stops announcing the
DRLB-Cap Hello Option, changes DR priority, changes hash algorithm, or
otherwise becomes ineligible as a candidate, the DR [SHOULD]{.bcp14}
immediately send a triggered hello with a new list in the DRLB-List
option, excluding the neighbor.[¶](#section-5.4-3){.pilcrow}

If a new router becomes eligible as a candidate, there is no urgency in
sending out an updated list. An updated list [SHOULD]{.bcp14} be
included in the next hello.[¶](#section-5.4-4){.pilcrow}
:::

::: {#section-5.5 .section}
### [5.5.](#section-5.5){.section-number .selfRef} [PIM GDR Candidate Operation](#name-pim-gdr-candidate-operation){.section-name .selfRef} {#name-pim-gdr-candidate-operation}

When an IGMP/MLD report is received, a hash algorithm is used by the GDR
Candidates to determine which router is going to be responsible for
building forwarding trees on behalf of the
host.[¶](#section-5.5-1){.pilcrow}

The router [MUST]{.bcp14} include the DRLB-Cap Hello Option in all PIM
Hello messages sent on the interface. Note that the presence of the
DRLB-Cap Option in the PIM Hello does not guarantee that the router will
be considered as a GDR Candidate. Once the DR election is done, the
DRLB-List Hello Option is received from the current PIM DR containing a
list of the selected GDR Candidates.[¶](#section-5.5-2){.pilcrow}

A router only acts as a GDR Candidate if it is included in the GDR
Candidate list of the DRLB-List Hello Option. See next section for
details.[¶](#section-5.5-3){.pilcrow}
:::

::: {#section-5.6 .section}
### [5.6.](#section-5.6){.section-number .selfRef} [DRLB-List Hello Option Processing](#name-drlb-list-hello-option-proc){.section-name .selfRef} {#name-drlb-list-hello-option-proc}

This section discusses processing of the DRLB-List Hello Option,
including the case where it was received in the previous hello but not
in the current hello. All routers [MUST]{.bcp14} ignore the DRLB-List
Hello Option if it is received from a PIM router that is not the DR. The
option [MUST]{.bcp14} only be processed by routers that are announcing
the DRLB-Cap Option and only if the hash algorithm announced by the DR
is the same as the local announcement. All GDR Candidates [MUST]{.bcp14}
use the hash masks advertised in the Option, even if they differ from
those the candidate was configured with. The DR [MUST]{.bcp14} also
process its own DRLB-List Hello Option.[¶](#section-5.6-1){.pilcrow}

A router stores the latest option contents that were announced, if any,
and deletes the previous contents. The router [MUST]{.bcp14} also
compare the new contents with any previous contents and, if there are
any changes, continue processing as below. Note that if the option does
not pass the above checks, the below processing [MUST]{.bcp14} be done
as if the option was not announced.[¶](#section-5.6-2){.pilcrow}

If the contents of the DRLB-List Option, the masks, or the candidate
list differ from the previously saved copy, it is received for the first
time, or it is no longer being received or accepted, the option
[MUST]{.bcp14} be processed as below.[¶](#section-5.6-3){.pilcrow}

1.  ::: {#section-5.6-4.1}
    If the local router is included in the \"GDR Candidate Address(es)\"
    field, it will look for its own address, or if it announces a
    non-zero Router ID, its own Router ID. For each of the groups or
    source and group pairs, if the group is in SSM mode with local
    receiver interest, the router [MUST]{.bcp14} run the hash algorithm
    to determine which of them is for the
    GDR.[¶](#section-5.6-4.1.1){.pilcrow}

    -   [If there is no change in the GDR status, then no further action
        is
        required.[¶](#section-5.6-4.1.2.1){.pilcrow}]{#section-5.6-4.1.2.1}
    -   [If the router becomes the new GDR, then a multicast forwarding
        tree [MUST]{.bcp14} be built
        \[[RFC7761](#RFC7761){.xref}\].[¶](#section-5.6-4.1.2.2){.pilcrow}]{#section-5.6-4.1.2.2}
    -   [If the router is no longer the GDR, then it uses an Assert as
        explained in [Section
        5.7](#assert){.xref}.[¶](#section-5.6-4.1.2.3){.pilcrow}]{#section-5.6-4.1.2.3}
    :::

2.  ::: {#section-5.6-4.2}
    If one of the following occurs:[¶](#section-5.6-4.2.1){.pilcrow}

    -   [the local router is not included in the \"GDR Candidate
        Address(es)\"
        field,[¶](#section-5.6-4.2.2.1){.pilcrow}]{#section-5.6-4.2.2.1}
    -   [the DRLB-List Hello Option is no longer included in the DR\'s
        Hello,
        or[¶](#section-5.6-4.2.2.2){.pilcrow}]{#section-5.6-4.2.2.2}
    -   [the DR\'s Neighbor Liveness Timer expires
        \[RFC7761\],[¶](#section-5.6-4.2.2.3){.pilcrow}]{#section-5.6-4.2.2.3}

    then for each group (or each source and group pair if the group is
    in SSM mode) with local receiver interest, for which the router is
    the GDR, the router uses an Assert as explained in [Section
    5.7](#assert){.xref}.[¶](#section-5.6-4.2.3){.pilcrow}
    :::
:::

::: {#assert}
::: {#section-5.7 .section}
### [5.7.](#section-5.7){.section-number .selfRef} [PIM Assert Modification](#name-pim-assert-modification){.section-name .selfRef} {#name-pim-assert-modification}

GDR changes may occur due to configuration change, GDR Candidates going
down, and also new routers coming up and becoming GDR Candidates. This
may occur while flows are being forwarded. If the GDR for an active flow
changes, there is likely to be some disruption, such as packet loss or
duplicates. By using asserts, packet loss is minimized while allowing a
small amount of duplicates.[¶](#section-5.7-1){.pilcrow}

When a router stops acting as the GDR for a group, or source and group
pair if SSM, it [MUST]{.bcp14} set the Assert metric preference to
maximum (0x7fffffff) and the Assert metric to one less than maximum
(0xfffffffe). That is, whenever it sends or receives an Assert for the
group, it must use these values as the metric preference and metric
rather than the values provided by the unicast routing
protocol.[¶](#section-5.7-2){.pilcrow}

The rest of this section is just for illustration purposes and not part
of the protocol definition.[¶](#section-5.7-3){.pilcrow}

To illustrate the behavior when there is a GDR change, consider the
following scenario where there are two flows: G1 and G2. R1 is the GDR
for G1, and R2 is the GDR for G2. When R3 comes up, it is possible that
R3 becomes GDR for both G1 and G2; hence, R3 starts to build the
forwarding tree for G1 and G2. If R1 and R2 stop forwarding before R3
completes the process, packet loss might occur. On the other hand, if R1
and R2 continue forwarding while R3 is building the forwarding trees,
duplicates might occur.[¶](#section-5.7-4){.pilcrow}

When the role of GDR changes as above, instead of immediately stopping
forwarding, R1 and R2 continue forwarding to G1 and G2 respectively,
while, at the same time, R3 build forwarding trees for G1 and G2. This
will lead to PIM Asserts.[¶](#section-5.7-5){.pilcrow}

For G1, using the functionality described in this document, R1 and R3
determine the new GDR, which is R3. With the modified Assert behavior,
R1 sets its Assert metric to the near maximum value, as discussed above.
That will make R3, which has normal metric in its Assert, the Assert
winner.[¶](#section-5.7-6){.pilcrow}
:::
:::

::: {#section-5.8 .section}
### [5.8.](#section-5.8){.section-number .selfRef} [Backward Compatibility](#name-backward-compatibility){.section-name .selfRef} {#name-backward-compatibility}

In the case of a hybrid Ethernet shared LAN (where some PIM routers
support the functionality defined in this document and some do
not):[¶](#section-5.8-1){.pilcrow}

-   [If the DR does not support the new functionality, then there will
    be no load
    balancing.[¶](#section-5.8-2.1){.pilcrow}]{#section-5.8-2.1}
-   [If non-DR routers do not support the new functionality, they will
    not be considered as GDR Candidate and will not take part in load
    balancing. Load balancing may still happen on the
    link.[¶](#section-5.8-2.2){.pilcrow}]{#section-5.8-2.2}
:::
:::

::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Operational Considerations](#name-operational-considerations){.section-name .selfRef} {#name-operational-considerations}

An administrator needs to consider what the total bandwidth requirements
are and find a set of routers that together have enough available
capacity while making sure that each of the routers can handle its part,
assuming that the traffic is distributed roughly equally among the
routers. Ideally, one should also have enough bandwidth to handle the
case where at least one router fails. All routers should have
reachability to the sources and RPs, if applicable, that are not via the
LAN.[¶](#section-6-1){.pilcrow}

Care must be taken when choosing what hash masks to configure. One would
typically configure the same masks on all the routers so that they are
the same, regardless of which router is elected as DR. The default masks
are likely suitable for most deployment. The RP Hash Mask must be
configured (the default is no bits set) if one wishes to hash based on
the RP address rather than the group address for ASM. The default masks
will use the entire group addresses, and source addresses if SSM, as
part of the hash. An administrator may set other masks that mask out
part of the addresses to ensure that certain flows always get hashed to
the same router. How this is achieved depends on how the group addresses
are allocated.[¶](#section-6-2){.pilcrow}

Only the routers announcing the same hash algorithm as the DR would be
considered as GDR Candidates. Network administrators need to make sure
that the desired set of routers announce the same algorithm. Migration
between different algorithms is not considered in this
document.[¶](#section-6-3){.pilcrow}
:::

::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

IANA has made these assignments in the \"PIM-Hello Options\" registry:
value 34 for the PIM DR Load-Balancing Capability (DRLB-Cap) Hello
Option (with Length of 4), and value 35 for the PIM DR Load-Balancing
List (DRLB-List) Hello Option (with variable
Length).[¶](#section-7-1){.pilcrow}

Per this document, IANA has created a registry called \"PIM Designated
Router Load-Balancing Hash Algorithms\" in the \"Protocol Independent
Multicast (PIM)\" branch of the registry tree. The registry lists hash
algorithms for use by PIM Designated Router Load
Balancing.[¶](#section-7-2){.pilcrow}

::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Initial Registry](#name-initial-registry){.section-name .selfRef} {#name-initial-registry}

The initial content of the registry is as
follows.[¶](#section-7.1-1){.pilcrow}

::: {#initial-reg}
  Type    Name         Reference
  ------- ------------ -----------
  0       Modulo       RFC 8775
  1-255   Unassigned   

  : [Table 1](#table-1){.selfRef}
:::
:::

::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [Assignment of New Hash Algorithms](#name-assignment-of-new-hash-algo){.section-name .selfRef} {#name-assignment-of-new-hash-algo}

Assignment of new hash algorithms is done according to the \"IETF
Review\" procedure; see
\[[RFC8126](#RFC8126){.xref}\].[¶](#section-7.2-1){.pilcrow}
:::
:::

::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

Security of the new DR Load-Balancing PIM Hello Options is only
guaranteed by the security of PIM Hello messages, so the security
considerations for PIM Hello messages, as described in PIM-SM
\[[RFC7761](#RFC7761){.xref}\], apply here.[¶](#section-8-1){.pilcrow}

If the DR is subverted, it could omit or add certain GDRs or announce an
unsupported algorithm. If another router is subverted, it could be made
DR and cause similar issues. While these issues are specific to this
specification, they are not that different from existing attacks, such
as subverting a DR and lowering the DR priority, causing a different
router to become the DR.[¶](#section-8-2){.pilcrow}

If, for any reason, the DR includes a GDR in the announced list that
announces a different algorithm from what the DR announces, the GDR is
required to ignore the announcement, and there will be no router acting
as the DR for the flows that hash to that
GDR.[¶](#section-8-3){.pilcrow}

If a GDR is subverted, it could potentially be made to stop forwarding
all the traffic it is expected to forward. This is also similar today to
if a DR is subverted.[¶](#section-8-4){.pilcrow}

An administrator may be able to achieve the desired load balancing of
known flows, but an attacker may send a single high rate flow that is
served by a single GDR or send multiple flows that are expected to be
hashed to the same GDR.[¶](#section-8-5){.pilcrow}
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC6395\]
:   [Gulrajani, S.]{.refAuthor}[ and S. Venaas]{.refAuthor}, [\"An
    Interface Identifier (ID) Hello Option for PIM\"]{.refTitle}, [RFC
    6395]{.seriesInfo}, [DOI 10.17487/RFC6395]{.seriesInfo}, October
    2011, \<<https://www.rfc-editor.org/info/rfc6395>\>.
:   

\[RFC7761\]
:   [Fenner, B.]{.refAuthor}[, Handley, M.]{.refAuthor}[,
    Holbrook, H.]{.refAuthor}[, Kouvelas, I.]{.refAuthor}[,
    Parekh, R.]{.refAuthor}[, Zhang, Z.]{.refAuthor}[, and L.
    Zheng]{.refAuthor}, [\"Protocol Independent Multicast - Sparse Mode
    (PIM-SM): Protocol Specification (Revised)\"]{.refTitle}, [STD
    83]{.seriesInfo}, [RFC 7761]{.seriesInfo}, [DOI
    10.17487/RFC7761]{.seriesInfo}, March 2016,
    \<<https://www.rfc-editor.org/info/rfc7761>\>.
:   

\[RFC8126\]
:   [Cotton, M.]{.refAuthor}[, Leiba, B.]{.refAuthor}[, and T.
    Narten]{.refAuthor}, [\"Guidelines for Writing an IANA
    Considerations Section in RFCs\"]{.refTitle}, [BCP 26]{.seriesInfo},
    [RFC 8126]{.seriesInfo}, [DOI 10.17487/RFC8126]{.seriesInfo}, June
    2017, \<<https://www.rfc-editor.org/info/rfc8126>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   
:::

::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC3376\]
:   [Cain, B.]{.refAuthor}[, Deering, S.]{.refAuthor}[,
    Kouvelas, I.]{.refAuthor}[, Fenner, B.]{.refAuthor}[, and A.
    Thyagarajan]{.refAuthor}, [\"Internet Group Management Protocol,
    Version 3\"]{.refTitle}, [RFC 3376]{.seriesInfo}, [DOI
    10.17487/RFC3376]{.seriesInfo}, October 2002,
    \<<https://www.rfc-editor.org/info/rfc3376>\>.
:   

\[RFC3810\]
:   [Vida, R., Ed.]{.refAuthor}[ and L. Costa, Ed.]{.refAuthor},
    [\"Multicast Listener Discovery Version 2 (MLDv2) for
    IPv6\"]{.refTitle}, [RFC 3810]{.seriesInfo}, [DOI
    10.17487/RFC3810]{.seriesInfo}, June 2004,
    \<<https://www.rfc-editor.org/info/rfc3810>\>.
:   

\[RFC4541\]
:   [Christensen, M.]{.refAuthor}[, Kimball, K.]{.refAuthor}[, and F.
    Solensky]{.refAuthor}, [\"Considerations for Internet Group
    Management Protocol (IGMP) and Multicast Listener Discovery (MLD)
    Snooping Switches\"]{.refTitle}, [RFC 4541]{.seriesInfo}, [DOI
    10.17487/RFC4541]{.seriesInfo}, May 2006,
    \<<https://www.rfc-editor.org/info/rfc4541>\>.
:   

\[RFC4607\]
:   [Holbrook, H.]{.refAuthor}[ and B. Cain]{.refAuthor},
    [\"Source-Specific Multicast for IP\"]{.refTitle}, [RFC
    4607]{.seriesInfo}, [DOI 10.17487/RFC4607]{.seriesInfo}, August
    2006, \<<https://www.rfc-editor.org/info/rfc4607>\>.
:   
:::
:::

::: {#section-appendix.a .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The authors would like to thank [Steve Simlo]{.contact-name} and [Taki
Millonis]{.contact-name} for helping with the original idea; [Alia
Atlas]{.contact-name}, [Bill Atwood]{.contact-name}, [Joe
Clarke]{.contact-name}, [Alissa Cooper]{.contact-name}, [Jake
Holland]{.contact-name}, [Bharat Joshi]{.contact-name}, [Anish
Kachinthaya]{.contact-name}, [Anvitha Kachinthaya]{.contact-name},
[Benjamin Kaduk]{.contact-name}, [Mirja Kühlewind]{.contact-name},
[Barry Leiba]{.contact-name}, [Ben Niven-Jenkins]{.contact-name},
[Alvaro Retana]{.contact-name}, [Adam Roach]{.contact-name}, [Michael
Scharf]{.contact-name}, [Éric Vyncke]{.contact-name}, and [Carl
Wallace]{.contact-name} for reviews and comments; and [Toerless
Eckert]{.contact-name} and [Rishabh Parekh]{.contact-name} for helpful
conversation on the document.[¶](#section-appendix.a-1){.pilcrow}
:::

::: {#authors-addresses}
::: {#section-appendix.b .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Yiqun Cai]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Alibaba Group]{.org}
:::

::: {.left dir="auto"}
[520 Almanor Avenue]{.street-address}
:::

::: {.left dir="auto"}
[Sunnyvale]{.locality}, [CA]{.region} [94085]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <yiqun.cai@alibaba-inc.com>
:::

::: {.left dir="auto"}
[Heidi Ou]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Alibaba Group]{.org}
:::

::: {.left dir="auto"}
[520 Almanor Avenue]{.street-address}
:::

::: {.left dir="auto"}
[Sunnyvale]{.locality}, [CA]{.region} [94085]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <heidi.ou@alibaba-inc.com>
:::

::: {.left dir="auto"}
[Sri Vallepalli]{.fn .nameRole}
:::

::: email
Email: <vallepal@yahoo.com>
:::

::: {.left dir="auto"}
[Mankamana Mishra]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[821 Alder Drive,]{.street-address}
:::

::: {.left dir="auto"}
[Milpitas]{.locality}, [CA]{.region} [95035]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <mankamis@cisco.com>
:::

::: {.left dir="auto"}
[Stig Venaas]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems, Inc.]{.org}
:::

::: {.left dir="auto"}
[Tasman Drive]{.street-address}
:::

::: {.left dir="auto"}
[San Jose]{.locality}, [CA]{.region} [95134]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <stig@cisco.com>
:::

::: {.left dir="auto"}
[Andy Green]{.fn .nameRole}
:::

::: {.left dir="auto"}
[British Telecom]{.org}
:::

::: {.left dir="auto"}
[Adastral Park]{.street-address}
:::

::: {.left dir="auto"}
[Ipswich]{.locality}
:::

::: {.left dir="auto"}
[IP5 2RE]{.postal-code}
:::

::: {.left dir="auto"}
[United Kingdom]{.country-name}
:::

::: email
Email: <andy.da.green@bt.com>
:::
:::
:::
