  RFC 8683         NAT64/464XLAT Deployment   November 2019
  ---------------- -------------------------- ---------------
  Palet Martinez   Informational              \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8683](https://www.rfc-editor.org/rfc/rfc8683){.eref}

Category:
:   Informational

Published:
:   November 2019

ISSN:
:   2070-1721

Author:

:   ::: author
    ::: author-name
    J. Palet Martinez
    :::

    ::: org
    The IPv6 Company
    :::
    :::
:::

# RFC 8683 {#rfcnum}

# Additional Deployment Guidelines for NAT64/464XLAT in Operator and Enterprise Networks {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document describes how Network Address and Protocol Translation
from IPv6 Clients to IPv4 Servers (NAT64) (including 464XLAT) can be
deployed in an IPv6 network \-- whether it\'s cellular ISP, broadband
ISP, or enterprise \-- and the possible optimizations. This document
also discusses issues to be considered when having IPv6-only
connectivity, such as: a) DNS64, b) applications or devices that use
literal IPv4 addresses or non-IPv6-compliant APIs, and c) IPv4-only
hosts or applications.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This document is not an Internet Standards Track specification; it is
published for informational
purposes.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Not all documents approved
by the IESG are candidates for any level of Internet Standard; see
Section 2 of RFC 7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8683>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2019 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Requirements
    Language](#name-requirements-language){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [NAT64 Deployment
    Scenarios](#name-nat64-deployment-scenarios){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}

    -   ::: {#section-toc.1-1.3.2.1}
        [3.1](#section-3.1){.xref}.  [Known to
        Work](#name-known-to-work){.xref}[¶](#section-toc.1-1.3.2.1.1){.pilcrow}

        -   ::: {#section-toc.1-1.3.2.1.2.1}
            [3.1.1](#section-3.1.1){.xref}.  [Service Provider NAT64
            with
            DNS64](#name-service-provider-nat64-with){.xref}[¶](#section-toc.1-1.3.2.1.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.3.2.1.2.2}
            [3.1.2](#section-3.1.2){.xref}.  [Service Provider Offering
            464XLAT Using
            DNS64](#name-service-provider-offering-4){.xref}[¶](#section-toc.1-1.3.2.1.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.3.2.1.2.3}
            [3.1.3](#section-3.1.3){.xref}.  [Service Provider Offering
            464XLAT, without Using
            DNS64](#name-service-provider-offering-46){.xref}[¶](#section-toc.1-1.3.2.1.2.3.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.3.2.2}
        [3.2](#section-3.2){.xref}.  [Known to Work under Special
        Conditions](#name-known-to-work-under-special){.xref}[¶](#section-toc.1-1.3.2.2.1){.pilcrow}

        -   ::: {#section-toc.1-1.3.2.2.2.1}
            [3.2.1](#section-3.2.1){.xref}.  [Service Provider NAT64
            without
            DNS64](#name-service-provider-nat64-witho){.xref}[¶](#section-toc.1-1.3.2.2.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.3.2.2.2.2}
            [3.2.2](#section-3.2.2){.xref}.  [Service-Provider NAT64;
            DNS64 in IPv6
            Hosts](#name-service-provider-nat64-dns6){.xref}[¶](#section-toc.1-1.3.2.2.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.3.2.2.2.3}
            [3.2.3](#section-3.2.3){.xref}.  [Service-Provider NAT64;
            DNS64 in the IPv4-Only Remote
            Network](#name-service-provider-nat64-dns64){.xref}[¶](#section-toc.1-1.3.2.2.2.3.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.3.2.3}
        [3.3](#section-3.3){.xref}.  [Comparing the
        Scenarios](#name-comparing-the-scenarios){.xref}[¶](#section-toc.1-1.3.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Issues to be
    Considered](#name-issues-to-be-considered){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [DNSSEC Considerations and Possible
        Approaches](#name-dnssec-considerations-and-p){.xref}[¶](#section-toc.1-1.4.2.1.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.1.2.1}
            [4.1.1](#section-4.1.1){.xref}.  [Not Using
            DNS64](#name-not-using-dns64){.xref}[¶](#section-toc.1-1.4.2.1.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.2}
            [4.1.2](#section-4.1.2){.xref}.  [DNSSEC Validator Aware of
            DNS64](#name-dnssec-validator-aware-of-d){.xref}[¶](#section-toc.1-1.4.2.1.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.3}
            [4.1.3](#section-4.1.3){.xref}.  [Stub
            Validator](#name-stub-validator){.xref}[¶](#section-toc.1-1.4.2.1.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.4}
            [4.1.4](#section-4.1.4){.xref}.  [CLAT with DNS Proxy and
            Validator](#name-clat-with-dns-proxy-and-val){.xref}[¶](#section-toc.1-1.4.2.1.2.4.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.5}
            [4.1.5](#section-4.1.5){.xref}.  [ACL of
            Clients](#name-acl-of-clients){.xref}[¶](#section-toc.1-1.4.2.1.2.5.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.1.2.6}
            [4.1.6](#section-4.1.6){.xref}.  [Mapping Out IPv4
            Addresses](#name-mapping-out-ipv4-addresses){.xref}[¶](#section-toc.1-1.4.2.1.2.6.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [DNS64 and Reverse
        Mapping](#name-dns64-and-reverse-mapping){.xref}[¶](#section-toc.1-1.4.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [Using 464XLAT with/without
        DNS64](#name-using-464xlat-with-without-){.xref}[¶](#section-toc.1-1.4.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.xref}.  [Foreign
        DNS](#name-foreign-dns){.xref}[¶](#section-toc.1-1.4.2.4.1){.pilcrow}

        -   ::: {#section-toc.1-1.4.2.4.2.1}
            [4.4.1](#section-4.4.1){.xref}.  [Manual Configuration of
            DNS](#name-manual-configuration-of-dns){.xref}[¶](#section-toc.1-1.4.2.4.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.4.2.2}
            [4.4.2](#section-4.4.2){.xref}.  [DNS Privacy/Encryption
            Mechanisms](#name-dns-privacy-encryption-mech){.xref}[¶](#section-toc.1-1.4.2.4.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.4.2.4.2.3}
            [4.4.3](#section-4.4.3){.xref}.  [Split DNS and
            VPNs](#name-split-dns-and-vpns){.xref}[¶](#section-toc.1-1.4.2.4.2.3.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.4.2.5}
        [4.5](#section-4.5){.xref}.  [Well-Known Prefix (WKP) vs.
        Network-Specific Prefix
        (NSP)](#name-well-known-prefix-wkp-vs-ne){.xref}[¶](#section-toc.1-1.4.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.6}
        [4.6](#section-4.6){.xref}.  [IPv4 Literals and
        Non-IPv6-Compliant
        APIs](#name-ipv4-literals-and-non-ipv6-){.xref}[¶](#section-toc.1-1.4.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.7}
        [4.7](#section-4.7){.xref}.  [IPv4-Only Hosts or
        Applications](#name-ipv4-only-hosts-or-applicat){.xref}[¶](#section-toc.1-1.4.2.7.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.8}
        [4.8](#section-4.8){.xref}.  [CLAT Translation
        Considerations](#name-clat-translation-considerat){.xref}[¶](#section-toc.1-1.4.2.8.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.9}
        [4.9](#section-4.9){.xref}.  [EAM
        Considerations](#name-eam-considerations){.xref}[¶](#section-toc.1-1.4.2.9.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.10}
        [4.10](#section-4.10){.xref}. [Incoming
        Connections](#name-incoming-connections){.xref}[¶](#section-toc.1-1.4.2.10.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Summary of Deployment Recommendations for
    NAT64/464XLAT](#name-summary-of-deployment-recom){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Deployment of 464XLAT/NAT64 in Enterprise
    Networks](#name-deployment-of-464xlat-nat64){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [References](#name-references){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.9.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.9.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [Appendix A](#section-appendix.a){.xref}.  [Example of Broadband
    Deployment with
    464XLAT](#name-example-of-broadband-deploy){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.11}
    [Appendix B](#section-appendix.b){.xref}.  [CLAT
    Implementation](#name-clat-implementation){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.12}
    [Appendix
    C](#section-appendix.c){.xref}.  [Benchmarking](#name-benchmarking){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.13}
    [](#section-appendix.d){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.14}
    [](#section-appendix.e){.xref}[Author\'s
    Address](#name-authors-address){.xref}[¶](#section-toc.1-1.14.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

Stateful NAT64 \[[RFC6146](#RFC6146){.xref}\] describes a stateful
IPv6-to-IPv4 translation mechanism that allows IPv6-only hosts to
communicate with IPv4-only servers using unicast UDP, TCP, or ICMP by
means of IPv4 public address sharing among multiple IPv6-only hosts.
Unless otherwise stated, references to NAT64 (function) in this document
should be interpreted as Stateful NAT64.[¶](#section-1-1){.pilcrow}

The translation of the packet headers is done using the IP/ICMP
translation algorithm defined in \[[RFC7915](#RFC7915){.xref}\];
algorithmically translating the IPv4 addresses to IPv6 addresses, and
vice versa, is done following
\[[RFC6052](#RFC6052){.xref}\].[¶](#section-1-2){.pilcrow}

DNS64 \[[RFC6147](#RFC6147){.xref}\] is in charge of the synthesis of
AAAA records from the A records, so it only works for applications
making use of DNS. It was designed to avoid changes in both the
IPv6-only hosts and the IPv4-only server, so they can use a NAT64
function. As discussed in [Section
5.5](https://www.rfc-editor.org/rfc/rfc6147#section-5.5){.relref} of
\[[RFC6147](#RFC6147){.xref}\], a security-aware and validating host has
to perform the DNS64 function locally.[¶](#section-1-3){.pilcrow}

However, the use of NAT64 and/or DNS64 presents three
drawbacks:[¶](#section-1-4){.pilcrow}

1.  [Because DNS64 \[[RFC6147](#RFC6147){.xref}\] modifies DNS answers,
    and DNSSEC is designed to detect such modifications, DNS64
    \[[RFC6147](#RFC6147){.xref}\] may potentially break DNSSEC,
    depending on a number of factors such as the location of the DNS64
    function (at a DNS server or validator, at the end host, \...), how
    it has been configured, if the end hosts are validating,
    etc.[¶](#section-1-5.1){.pilcrow}]{#section-1-5.1}
2.  [Because of the need to use DNS64 \[[RFC6147](#RFC6147){.xref}\] or
    an alternative \"host/application built-in\" mechanism for address
    synthesis, there may be an issue for NAT64
    \[[RFC6146](#RFC6146){.xref}\] because it doesn\'t work when IPv4
    literal addresses or non-IPv6-compliant APIs are being
    used.[¶](#section-1-5.2){.pilcrow}]{#section-1-5.2}
3.  [NAT64 alone was not designed to provide a solution for IPv4-only
    hosts or applications that are located within a network and
    connected to a service provider IPv6-only access link, as it was
    designed for a very specific scenario (see [Section
    2.1](https://www.rfc-editor.org/rfc/rfc6144#section-2.1){.relref} of
    \[[RFC6144](#RFC6144){.xref}\]).[¶](#section-1-5.3){.pilcrow}]{#section-1-5.3}

The drawbacks discussed above may come into play if part of an
enterprise network is connected to other parts of the same network or to
third-party networks by means of IPv6-only connectivity. This is just an
example that may apply to many other similar cases. All of them are
deployment specific.[¶](#section-1-6){.pilcrow}

Accordingly, the use of \"operator\", \"operator network\", \"service
provider\", and similar terms in this document are interchangeable with
equivalent cases of enterprise networks; other cases may be similar as
well. This may be also the case for \"managed end-user
networks\".[¶](#section-1-7){.pilcrow}

Note that if all the hosts in a network were performing address
synthesis, as described in [Section
7.2](https://www.rfc-editor.org/rfc/rfc6147#section-7.2){.relref} of
\[[RFC6147](#RFC6147){.xref}\], some of the drawbacks may not apply.
However, it is unrealistic to expect that in today\'s world, considering
the high number of devices and applications that aren\'t yet IPv6
enabled. In this document, the case in which all hosts provide synthesis
will be considered only for specific scenarios that can guarantee
it.[¶](#section-1-8){.pilcrow}

An analysis of stateful IPv4/IPv6 mechanisms is provided in
\[[RFC6889](#RFC6889){.xref}\].[¶](#section-1-9){.pilcrow}

This document looks into different possible NAT64
\[[RFC6146](#RFC6146){.xref}\] deployment scenarios, including
IPv4-IPv6-IPv4 (464 for short) and similar ones that were not documented
in \[[RFC6144](#RFC6144){.xref}\], such as 464XLAT
\[[RFC6877](#RFC6877){.xref}\] in operator (broadband and cellular) and
enterprise networks; it provides guidelines to avoid operational
issues.[¶](#section-1-10){.pilcrow}

This document also explores the possible NAT64 deployment scenarios
(split in \"known to work\" and \"known to work under special
conditions\"), providing a quick and generic comparison table among
them. Then, the document describes the issues that an operator needs to
understand, which will allow the best approach/scenario to be defined
for each specific network case. A summary provides some recommendations
and decision points. A section with clarifications on the usage of this
document for enterprise networks is also provided. Finally, [Appendix
A](#AppendixA){.xref} provides an example of a broadband deployment
using 464XLAT and hints for a customer-side translator (CLAT)
implementation.[¶](#section-1-11){.pilcrow}

\[[RFC7269](#RFC7269){.xref}\] already provides information about NAT64
deployment options and experiences. This document and
\[[RFC7269](#RFC7269){.xref}\] are complementary; they both look into
different deployment considerations. Furthermore, this document
considers the updated deployment experience and newer
standards.[¶](#section-1-12){.pilcrow}

The target deployment scenarios in this document may also be covered by
other IPv4-as-a-Service (IPv4aaS) transition mechanisms. Note that this
is true only for broadband networks; in the case of cellular networks,
the only supported solution is the use of NAT64/464XLAT. So, it is out
of scope of this document to provide a comparison among the different
IPv4aaS transition mechanisms, which are analyzed in
\[[IPv6-TRANSITION](#I-D.lmhp-v6ops-transition-comparison){.xref}\].[¶](#section-1-13){.pilcrow}

Consequently, this document should not be used as a guide for an
operator or enterprise to decide which IPv4aaS is the best one for its
own network. Instead, it should be used as a tool for understanding all
the implications, including relevant documents (or even specific parts
of them) for the deployment of NAT64/464XLAT and for facilitating the
decision process regarding specific deployment
details.[¶](#section-1-14){.pilcrow}
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::

::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [NAT64 Deployment Scenarios](#name-nat64-deployment-scenarios){.section-name .selfRef} {#name-nat64-deployment-scenarios}

DNS64 (see [Section
7](https://www.rfc-editor.org/rfc/rfc6147#section-7){.relref} of
\[[RFC6147](#RFC6147){.xref}\]) provides three deployment scenarios,
depending on the location of the DNS64 function. However, since the
publication of that document, other deployment scenarios and NAT64 use
cases need to be considered in actual networks, despite the fact that
some of them were specifically ruled out by the original NAT64/DNS64
work.[¶](#section-3-1){.pilcrow}

Consequently, the perspective in this document is to broaden those
scenarios and include a few new ones. However, in order to reduce the
number of possible cases, we work under the assumption that the service
provider wants to make sure that all the customers have a service
without failures. This means considering the following assumptions for
the worst possible case:[¶](#section-3-2){.pilcrow}

a.  [There are hosts that will be validating
    DNSSEC.[¶](#section-3-3.1){.pilcrow}]{#section-3-3.1}
b.  [IPv4 literal addresses and non-IPv6-compliant APIs are being
    used.[¶](#section-3-3.2){.pilcrow}]{#section-3-3.2}
c.  [There are IPv4-only hosts or applications beyond the IPv6-only link
    (e.g., tethering in cellular
    networks).[¶](#section-3-3.3){.pilcrow}]{#section-3-3.3}

This document uses a common set of possible \"participant
entities\":[¶](#section-3-4){.pilcrow}

1.  [An IPv6-only access network
    (IPv6).[¶](#section-3-5.1){.pilcrow}]{#section-3-5.1}
2.  [An IPv4-only remote network/server/service
    (IPv4).[¶](#section-3-5.2){.pilcrow}]{#section-3-5.2}
3.  [A NAT64 function (NAT64) in the service
    provider.[¶](#section-3-5.3){.pilcrow}]{#section-3-5.3}
4.  [A DNS64 function (DNS64) in the service
    provider.[¶](#section-3-5.4){.pilcrow}]{#section-3-5.4}
5.  [An external service provider offering the NAT64 function and/or the
    DNS64 function
    (extNAT64/extDNS64).[¶](#section-3-5.5){.pilcrow}]{#section-3-5.5}
6.  [A 464XLAT customer-side translator
    (CLAT).[¶](#section-3-5.6){.pilcrow}]{#section-3-5.6}

Note that the nomenclature used in parentheses is the one that, for
short, will be used in the figures. Note: for simplicity, the boxes in
the figures don\'t mean they are actually a single device; they
represent one or more functions as located in that part of the network
(i.e., a single box with NAT64 and DNS64 functions can actually be
several devices, not just one).[¶](#section-3-6){.pilcrow}

The possible scenarios are split in two general
categories:[¶](#section-3-7){.pilcrow}

1.  [Known to work.[¶](#section-3-8.1){.pilcrow}]{#section-3-8.1}
2.  [Known to work under special
    conditions.[¶](#section-3-8.2){.pilcrow}]{#section-3-8.2}

::: {#section-3.1 .section}
### [3.1.](#section-3.1){.section-number .selfRef} [Known to Work](#name-known-to-work){.section-name .selfRef} {#name-known-to-work}

The scenarios in this category are known to work, as there are
well-known existing deployments from different operators using them.
Each one may have different pros and cons, and in some cases, the
trade-offs may be acceptable for some
operators.[¶](#section-3.1-1){.pilcrow}

::: {#spnatdns64}
::: {#section-3.1.1 .section}
#### [3.1.1.](#section-3.1.1){.section-number .selfRef} [Service Provider NAT64 with DNS64](#name-service-provider-nat64-with){.section-name .selfRef} {#name-service-provider-nat64-with}

In this scenario ([Figure 1](#sp-nat64-dns64){.xref}), the service
provider offers both the NAT64 and DNS64
functions.[¶](#section-3.1.1-1){.pilcrow}

This is the most common scenario as originally considered by the
designers of NAT64 \[[RFC6146](#RFC6146){.xref}\] and DNS64
\[[RFC6147](#RFC6147){.xref}\]; however, it may also have the
implications related to the DNSSEC.[¶](#section-3.1.1-2){.pilcrow}

This scenario may also fail to solve the issues of IPv4 literal
addresses, non-IPv6-compliant APIs, or IPv4-only hosts or applications
behind the IPv6-only access network.[¶](#section-3.1.1-3){.pilcrow}

[]{#name-nat64-with-dns64}

::: {#sp-nat64-dns64}
::: {#section-3.1.1-4.1 .artwork .art-text .alignCenter}
    +----------+        +----------+        +----------+
    |          |        |  NAT64   |        |          |
    |   IPv6   +--------+    +     +--------+   IPv4   |
    |          |        |  DNS64   |        |          |
    +----------+        +----------+        +----------+
:::

[Figure 1](#figure-1){.selfRef}: [NAT64 with
DNS64](#name-nat64-with-dns64){.selfRef}
:::

A similar scenario ([Figure 2](#sp-dns64-e-nat64){.xref}) exists if the
service provider offers only the DNS64 function; the NAT64 function is
provided by an outsourcing agreement with an external provider. All the
considerations in the previous paragraphs of this section are the same
for this sub-case.[¶](#section-3.1.1-5){.pilcrow}

[]{#name-nat64-in-an-external-servic}

::: {#sp-dns64-e-nat64}
::: {#section-3.1.1-6.1 .artwork .art-text .alignCenter}
                        +----------+        +----------+
                        |          |        |          |
                        | extNAT64 +--------+   IPv4   |
                        |          |        |          |
                        +----+-----+        +----------+
                             |
                             |
    +----------+        +----+-----+
    |          |        |          |
    |   IPv6   +--------+  DNS64   +
    |          |        |          |
    +----------+        +----------+
:::

[Figure 2](#figure-2){.selfRef}: [NAT64 in an External Service
Provider](#name-nat64-in-an-external-servic){.selfRef}
:::

This is equivalent to the scenario ([Figure 3](#e-nat64-dns64){.xref})
where the outsourcing agreement with the external provider is to provide
both the NAT64 and DNS64 functions. Once more, all the considerations in
the previous paragraphs of this section are the same for this
sub-case.[¶](#section-3.1.1-7){.pilcrow}

[]{#name-nat64-and-dns64-in-an-exter}

::: {#e-nat64-dns64}
::: {#section-3.1.1-8.1 .artwork .art-text .alignCenter}
                        +----------+       +----------+
                        | extNAT64 |       |          |
                        |    +     +-------+   IPv4   |
                        | extDNS64 |       |          |
                        +----+-----+       +----------+
                             |
    +----------+             |
    |          |             |
    |   IPv6   +-------------+
    |          |
    +----------+
:::

[Figure 3](#figure-3){.selfRef}: [NAT64 and DNS64 in an External
Provider](#name-nat64-and-dns64-in-an-exter){.selfRef}
:::

One additional equivalent scenario ([Figure
4](#sp-nat64-e-dns64){.xref}) exists if the service provider only offers
the NAT64 function; the DNS64 function is from an external provider with
or without a specific agreement among them. This is a common scenario
today, as several \"global\" service providers provide free DNS/DNS64
services, and users often configure their DNS manually. This will only
work if both the NAT64 and DNS64 functions are using the Well-Known
Prefix (WKP) or the same Network-Specific Prefix (NSP). All the
considerations in the previous paragraphs of this section are the same
for this sub-case.[¶](#section-3.1.1-9){.pilcrow}

Of course, if the external DNS64 function is agreed with the service
provider, then this case is similar to the ones already depicted in this
scenario.[¶](#section-3.1.1-10){.pilcrow}

[]{#name-nat64-dns64-by-an-external-}

::: {#sp-nat64-e-dns64}
::: {#section-3.1.1-11.1 .artwork .art-text .alignCenter}
                        +----------+
                        |          |
                        | extDNS64 |
                        |          |
                        +----+-----+
                             |
                             |
    +----------+        +----+-----+        +----------+
    |          |        |          |        |          |
    |   IPv6   +--------+  NAT64   +--------+   IPv4   |
    |          |        |          |        |          |
    +----------+        +----------+        +----------+
:::

[Figure 4](#figure-4){.selfRef}: [NAT64; DNS64 by an External
Provider](#name-nat64-dns64-by-an-external-){.selfRef}
:::
:::
:::

::: {#section-3.1.2 .section}
#### [3.1.2.](#section-3.1.2){.section-number .selfRef} [Service Provider Offering 464XLAT Using DNS64](#name-service-provider-offering-4){.section-name .selfRef} {#name-service-provider-offering-4}

464XLAT \[[RFC6877](#RFC6877){.xref}\] describes an architecture that
provides IPv4 connectivity across a network, or part of it, when it is
only natively transporting IPv6. The need to support the CLAT function
in order to ensure the IPv4 service continuity in IPv6-only cellular
deployments has been suggested in
\[[RFC7849](#RFC7849){.xref}\].[¶](#section-3.1.2-1){.pilcrow}

In order to do that, 464XLAT \[[RFC6877](#RFC6877){.xref}\] relies on
the combination of existing protocols:[¶](#section-3.1.2-2){.pilcrow}

1.  [The CLAT is a stateless IPv4-to-IPv6 translator (NAT46)
    \[[RFC7915](#RFC7915){.xref}\] implemented in the end-user device or
    Customer Edge Router (CE), located at the \"customer edge\" of the
    network.[¶](#section-3.1.2-3.1){.pilcrow}]{#section-3.1.2-3.1}
2.  [The provider-side translator (PLAT) is a stateful NAT64
    \[[RFC6146](#RFC6146){.xref}\], implemented typically in the
    operator
    network.[¶](#section-3.1.2-3.2){.pilcrow}]{#section-3.1.2-3.2}
3.  [Optionally, DNS64 \[[RFC6147](#RFC6147){.xref}\] may allow an
    optimization: a single translation at the NAT64, instead of two
    translations (NAT46+NAT64), when the application at the end-user
    device supports IPv6 DNS (uses AAAA Resource
    Records).[¶](#section-3.1.2-3.3){.pilcrow}]{#section-3.1.2-3.3}

Note that even if the provider-side translator is referred to as PLAT in
the 464XLAT terminology \[[RFC6877](#RFC6877){.xref}\], for simplicity
and uniformity across this document, it is always referred to as NAT64
(function).[¶](#section-3.1.2-4){.pilcrow}

In this scenario ([Figure 5](#sp-464xlat-dns64){.xref}), the service
provider deploys 464XLAT with a DNS64
function.[¶](#section-3.1.2-5){.pilcrow}

As a consequence, the DNSSEC issues remain, unless the host is doing the
address synthesis.[¶](#section-3.1.2-6){.pilcrow}

464XLAT \[[RFC6877](#RFC6877){.xref}\] is a very simple approach to cope
with the major NAT64+DNS64 drawback: not working with applications or
devices that use literal IPv4 addresses or non-IPv6-compliant
APIs.[¶](#section-3.1.2-7){.pilcrow}

464XLAT \[[RFC6877](#RFC6877){.xref}\] has been used mainly in IPv6-only
cellular networks. By supporting a CLAT function, end-user device
applications can access IPv4-only end networks / applications, despite
the fact that those applications or devices use literal IPv4 addresses
or non-IPv6-compliant APIs.[¶](#section-3.1.2-8){.pilcrow}

In addition, in the cellular network example above, if the User
Equipment (UE) provides tethering, other devices behind it will be
presented with a traditional Network Address Translation from IPv4 to
IPv4 (NAT44), in addition to the native IPv6 support, so clearly it
allows IPv4-only hosts behind the IPv6-only access
network.[¶](#section-3.1.2-9){.pilcrow}

Furthermore, as discussed in \[[RFC6877](#RFC6877){.xref}\], 464XLAT can
be used in broadband IPv6 network architectures, by implementing the
CLAT function at the CE.[¶](#section-3.1.2-10){.pilcrow}

The support of this scenario in a network offers two additional
advantages:[¶](#section-3.1.2-11){.pilcrow}

-   [DNS load optimization: A CLAT should implement a DNS proxy (per
    \[[RFC5625](#RFC5625){.xref}\]) so that only IPv6-native queries and
    AAAA records are sent to the DNS64 server. Otherwise, doubling the
    number of queries may impact the DNS
    infrastructure.[¶](#section-3.1.2-12.1){.pilcrow}]{#section-3.1.2-12.1}
-   [Connection establishment delay optimization: If the UE/CE
    implementation is detecting the presence of a DNS64 function, it may
    issue only the AAAA query, instead of both the AAAA and A
    queries.[¶](#section-3.1.2-12.2){.pilcrow}]{#section-3.1.2-12.2}

In order to understand all the communication possibilities, let\'s
assume the following representation of two dual-stack (DS)
peers:[¶](#section-3.1.2-13){.pilcrow}

::: {#section-3.1.2-14 .artwork .art-text .alignCenter}
                   +-------+     .-----.                     .-----.
                   |       |    /       \                   /       \
       .-----.     | Res./ |   /  IPv6-  \     .-----.     /  IPv4-  \
      / Local \    | SOHO  +--(   only    )---( NAT64 )---(   only    )
     /         \   |       |   \  flow   /\    `-----'     \  flow   /
    (   Dual-   )--+ IPv6  |    \       /  \              / \       /
     \  Stack  /   |  CE   |     `--+--'    \   .-----.  /   `--+--'
      \ Peer  /    | with  |        |        \ / Remote\/       |
       `-----'     | CLAT  |    +---+----+    /         \    +---+----+
                   |       |    |DNS/IPv6|   (   Dual-   )   |DNS/IPv4|
                   +-------+    |  with  |    \  Stack  /    +--------+
                                | DNS64  |     \ Peer  /
                                +--------+      `-----'

      Figure A: Representation of 464XLAT among Two Peers with DNS64

[¶](#section-3.1.2-14){.pilcrow}
:::

In this case, the possible communication paths, among the IPv4/IPv6
stacks of both peers, are as follows:[¶](#section-3.1.2-15){.pilcrow}

a.  [Local-IPv6 to Remote-IPv6: Regular DNS and native IPv6 among
    peers.[¶](#section-3.1.2-16.1){.pilcrow}]{#section-3.1.2-16.1}
b.  [Local-IPv6 to Remote-IPv4: DNS64 and NAT64
    translation.[¶](#section-3.1.2-16.2){.pilcrow}]{#section-3.1.2-16.2}
c.  [Local-IPv4 to Remote-IPv6: Not possible unless the CLAT implements
    Explicit Address Mappings (EAMs) as indicated by [Section
    4.9](#EAM){.xref}. In principle, it is not expected that services
    are deployed in the Internet when using IPv6 only, unless there is
    certainty that peers will also be IPv6
    capable.[¶](#section-3.1.2-16.3){.pilcrow}]{#section-3.1.2-16.3}
d.  [Local-IPv4 to Remote-IPv4: DNS64, CLAT, and NAT64
    translations.[¶](#section-3.1.2-16.4){.pilcrow}]{#section-3.1.2-16.4}
e.  [Local-IPv4 to Remote-dual-stack using EAM optimization: If the CLAT
    implements EAM as indicated by [Section 4.9](#EAM){.xref}, instead
    of using the path d. above, NAT64 translation is avoided, and the
    flow will use IPv6 from the CLAT to the
    destination.[¶](#section-3.1.2-16.5){.pilcrow}]{#section-3.1.2-16.5}

The rest of the figures in this section show different choices for
placing the different elements.[¶](#section-3.1.2-17){.pilcrow}

[]{#name-464xlat-with-dns64}

::: {#sp-464xlat-dns64}
::: {#section-3.1.2-18.1 .artwork .art-text .alignCenter}
    +----------+        +----------+        +----------+
    |   IPv6   |        |  NAT64   |        |          |
    |     +    +--------+    +     +--------+   IPv4   |
    |   CLAT   |        |  DNS64   |        |          |
    +----------+        +----------+        +----------+ 
:::

[Figure 5](#figure-5){.selfRef}: [464XLAT with
DNS64](#name-464xlat-with-dns64){.selfRef}
:::

A similar scenario ([Figure 6](#ext-nat64-464xlatdns64){.xref}) exists
if the service provider only offers the DNS64 function; the NAT64
function is provided by an outsourcing agreement with an external
provider. All the considerations in the previous paragraphs of this
section are the same for this sub-case.[¶](#section-3.1.2-19){.pilcrow}

[]{#name-464xlat-with-dns64-nat64-in}

::: {#ext-nat64-464xlatdns64}
::: {#section-3.1.2-20.1 .artwork .art-text .alignCenter}
                        +----------+        +----------+
                        |          |        |          |
                        | extNAT64 +--------+   IPv4   |
                        |          |        |          |
                        +----+-----+        +----------+
                             |
                             |
    +----------+        +----+-----+
    |   IPv6   |        |          |
    |     +    +--------+  DNS64   +
    |   CLAT   |        |          |
    +----------+        +----------+
:::

[Figure 6](#figure-6){.selfRef}: [464XLAT with DNS64; NAT64 in an
External Provider](#name-464xlat-with-dns64-nat64-in){.selfRef}
:::

In addition, it is equivalent to the scenario ([Figure
7](#ext-nat64-dns64-464xlatdns64){.xref}) where the outsourcing
agreement with the external provider is to provide both the NAT64 and
DNS64 functions. Once more, all the considerations in the previous
paragraphs of this section are the same for this
sub-case.[¶](#section-3.1.2-21){.pilcrow}

[]{#name-464xlat-with-dns64-nat64-an}

::: {#ext-nat64-dns64-464xlatdns64}
::: {#section-3.1.2-22.1 .artwork .art-text .alignCenter}
                        +----------+        +----------+
                        | extNAT64 |        |          |
                        |    +     +--------+   IPv4   |
                        | extDNS64 |        |          |
                        +----+-----+        +----------+
                             |
    +----------+             |
    |   IPv6   |             |
    |     +    +-------------+
    |   CLAT   |
    +----------+
:::

[Figure 7](#figure-7){.selfRef}: [464XLAT with DNS64; NAT64 and DNS64 in
an External Provider](#name-464xlat-with-dns64-nat64-an){.selfRef}
:::
:::

::: {#xlat-dns64}
::: {#section-3.1.3 .section}
#### [3.1.3.](#section-3.1.3){.section-number .selfRef} [Service Provider Offering 464XLAT, without Using DNS64](#name-service-provider-offering-46){.section-name .selfRef} {#name-service-provider-offering-46}

The major advantage of this scenario ([Figure 8](#sp-464xlat){.xref}),
using 464XLAT without DNS64, is that the service provider ensures that
DNSSEC is never broken, even if the user modifies the DNS configuration.
Nevertheless, some CLAT implementations or applications may impose an
extra delay, which is induced by the dual A/AAAA queries (and the wait
for both responses), unless Happy Eyeballs v2
\[[RFC8305](#RFC8305){.xref}\] is also
present.[¶](#section-3.1.3-1){.pilcrow}

A possible variation of this scenario is when DNS64 is used only for the
discovery of the NAT64 prefix. In the rest of the document, it is not
considered a different scenario because once the prefix has been
discovered, the DNS64 function is not used, so it behaves as if the
DNS64 synthesis function is not present.[¶](#section-3.1.3-2){.pilcrow}

In this scenario, as in the previous one, there are no issues related to
IPv4-only hosts (or IPv4-only applications) behind the IPv6-only access
network, as neither are related to the usage of IPv4 literals or
non-IPv6-compliant APIs.[¶](#section-3.1.3-3){.pilcrow}

The support of this scenario in a network offers one
advantage:[¶](#section-3.1.3-4){.pilcrow}

-   [DNS load optimization: A CLAT should implement a DNS proxy (per
    \[[RFC5625](#RFC5625){.xref}\]) so that only IPv6 native queries are
    sent to the DNS64 server. Otherwise, doubling the number of queries
    may impact the DNS
    infrastructure.[¶](#section-3.1.3-5.1){.pilcrow}]{#section-3.1.3-5.1}

As indicated earlier, the connection establishment delay optimization is
achieved only in the case of devices, Operating Systems, or applications
that use Happy Eyeballs v2 \[[RFC8305](#RFC8305){.xref}\], which is very
common.[¶](#section-3.1.3-6){.pilcrow}

As in the previous case, let\'s assume the representation of two
dual-stack peers:[¶](#section-3.1.3-7){.pilcrow}

::: {#section-3.1.3-8 .artwork .art-text .alignCenter}
                   +-------+     .-----.                     .-----.
                   |       |    /       \                   /       \
       .-----.     | Res./ |   /  IPv6-  \     .-----.     /  IPv4-  \
      / Local \    | SOHO  +--(   only    )---( NAT64 )---(   only    )
     /         \   |       |   \  flow   /\    `-----'     \  flow   /
    (   Dual-   )--+ IPv6  |    \       /  \              / \       /
     \  Stack  /   |  CE   |     `--+--'    \   .-----.  /   `--+--'
      \ Peer  /    | with  |        |        \ / Remote\/       |
       `-----'     | CLAT  |    +---+----+    /         \    +---+----+
                   |       |    |DNS/IPv6|   (   Dual-   )   |DNS/IPv4|
                   +-------+    +--------+    \  Stack  /    +--------+
                                               \ Peer  /
                                                `-----'

     Figure B: Representation of 464XLAT among Two Peers without DNS64

[¶](#section-3.1.3-8){.pilcrow}
:::

In this case, the possible communication paths, among the IPv4/IPv6
stacks of both peers, are as follows:[¶](#section-3.1.3-9){.pilcrow}

a.  [Local-IPv6 to Remote-IPv6: Regular DNS and native IPv6 among
    peers.[¶](#section-3.1.3-10.1){.pilcrow}]{#section-3.1.3-10.1}
b.  [Local-IPv6 to Remote-IPv4: Regular DNS, CLAT, and NAT64
    translations.[¶](#section-3.1.3-10.2){.pilcrow}]{#section-3.1.3-10.2}
c.  [Local-IPv4 to Remote-IPv6: Not possible unless the CLAT implements
    EAM as indicated by [Section 4.9](#EAM){.xref}. In principle, it is
    not expected that services are deployed in the Internet using IPv6
    only, unless there is certainty that peers will also be
    IPv6-capable.[¶](#section-3.1.3-10.3){.pilcrow}]{#section-3.1.3-10.3}
d.  [Local-IPv4 to Remote-IPv4: Regular DNS, CLAT, and NAT64
    translations.[¶](#section-3.1.3-10.4){.pilcrow}]{#section-3.1.3-10.4}
e.  [Local-IPv4 to Remote-dual-stack using EAM optimization: If the CLAT
    implements EAM as indicated by [Section 4.9](#EAM){.xref}, instead
    of using the path d. above, NAT64 translation is avoided, and the
    flow will use IPv6 from the CLAT to the
    destination.[¶](#section-3.1.3-10.5){.pilcrow}]{#section-3.1.3-10.5}

Notice that this scenario works while the local hosts/applications are
dual stack (which is the current situation) because the connectivity
from a local IPv6 to a remote IPv4 is not possible without a AAAA
synthesis. This aspect is important only when there are IPv6-only hosts
in the LANs behind the CLAT and they need to communicate with remote
IPv4-only hosts. However, it is not a sensible approach from an
Operating System or application vendor perspective to provide IPv6-only
support unless, similar to case c above, there is certainty of peers
supporting IPv6 as well. An approach to a solution for this is also
presented in
\[[OPT-464XLAT](#I-D.palet-v6ops-464xlat-opt-cdn-caches){.xref}\].[¶](#section-3.1.3-11){.pilcrow}

The following figures show different choices for placing the different
elements.[¶](#section-3.1.3-12){.pilcrow}

[]{#name-464xlat-without-dns64}

::: {#sp-464xlat}
::: {#section-3.1.3-13.1 .artwork .art-text .alignCenter}
    +----------+        +----------+        +----------+
    |   IPv6   |        |          |        |          |
    |     +    +--------+  NAT64   +--------+   IPv4   |
    |   CLAT   |        |          |        |          |
    +----------+        +----------+        +----------+
:::

[Figure 8](#figure-8){.selfRef}: [464XLAT without
DNS64](#name-464xlat-without-dns64){.selfRef}
:::

This is equivalent to the scenario ([Figure
9](#ext-nat64-464xlat){.xref}) where there is an outsourcing agreement
with an external provider for the NAT64 function. All the considerations
in the previous paragraphs of this section are the same for this
sub-case.[¶](#section-3.1.3-14){.pilcrow}

[]{#name-464xlat-without-dns64-nat64}

::: {#ext-nat64-464xlat}
::: {#section-3.1.3-15.1 .artwork .art-text .alignCenter}
                        +----------+        +----------+
                        |          |        |          |
                        | extNAT64 +--------+   IPv4   |
                        |          |        |          |
                        +----+-----+        +----------+
                             |
    +----------+             |
    |   IPv6   |             |
    |     +    +-------------+
    |   CLAT   |
    +----------+
:::

[Figure 9](#figure-9){.selfRef}: [464XLAT without DNS64; NAT64 in an
External Provider](#name-464xlat-without-dns64-nat64){.selfRef}
:::
:::
:::
:::

::: {#section-3.2 .section}
### [3.2.](#section-3.2){.section-number .selfRef} [Known to Work under Special Conditions](#name-known-to-work-under-special){.section-name .selfRef} {#name-known-to-work-under-special}

The scenarios in this category are known not to work unless significant
effort is devoted to solving the issues or they are intended to solve
problems across \"closed\" networks instead of as a general Internet
access usage. Even though some of the different pros, cons, and
trade-offs may be acceptable, operators have implementation
difficulties, as their expectations of NAT64/DNS64 are beyond the
original intent.[¶](#section-3.2-1){.pilcrow}

::: {#onlynat64}
::: {#section-3.2.1 .section}
#### [3.2.1.](#section-3.2.1){.section-number .selfRef} [Service Provider NAT64 without DNS64](#name-service-provider-nat64-witho){.section-name .selfRef} {#name-service-provider-nat64-witho}

In this scenario ([Figure 10](#only-nat64){.xref}), the service provider
offers a NAT64 function; however, there is no DNS64 function support at
all.[¶](#section-3.2.1-1){.pilcrow}

As a consequence, an IPv6 host in the IPv6-only access network will not
be able to detect the presence of DNS64 by means of
\[[RFC7050](#RFC7050){.xref}\] or learn the IPv6 prefix to be used for
the NAT64 function.[¶](#section-3.2.1-2){.pilcrow}

This can be sorted out as indicated in [Section
4.1.1](#nodns64){.xref}.[¶](#section-3.2.1-3){.pilcrow}

Regardless, because of the lack of the DNS64 function, the IPv6 host
will not be able to obtain AAAA synthesized records, so the NAT64
function becomes useless.[¶](#section-3.2.1-4){.pilcrow}

An exception to this \"useless\" scenario is to manually configure
mappings between the A records of each of the IPv4-only remote hosts and
the corresponding AAAA records with the WKP or NSP used by the
service-provider NAT64 function, as if they were synthesized by a DNS64
function.[¶](#section-3.2.1-5){.pilcrow}

This mapping could be done by several means, typically at the
authoritative DNS server or at the service-provider resolvers by means
of DNS Response Policy Zones (RPZs)
\[[DNS-RPZ](#I-D.vixie-dnsop-dns-rpz){.xref}\] or equivalent
functionality. DNS RPZ may have implications in DNSSEC if the zone is
signed. Also, if the service provider is using an NSP, having the
mapping at the authoritative server may create troubles for other
parties trying to use a different NSP or WKP, unless multiple DNS
\"views\" (split-DNS) are also being used at the authoritative
servers.[¶](#section-3.2.1-6){.pilcrow}

Generally, the mappings alternative will only make sense if a few sets
of IPv4-only remote hosts need to be accessed by a single network (or a
small number of them), which supports IPv6 only in the access. This will
require some kind of mutual agreement for using this procedure; this
should not be a problem because it won\'t interfere with Internet use
(which is a \"closed service\").[¶](#section-3.2.1-7){.pilcrow}

In any case, this scenario doesn\'t solve the issue of IPv4 literal
addresses, non-IPv6-compliant APIs, or IPv4-only hosts within that
IPv6-only access network.[¶](#section-3.2.1-8){.pilcrow}

[]{#name-nat64-without-dns64}

::: {#only-nat64}
::: {#section-3.2.1-9.1 .artwork .art-text .alignCenter}
    +----------+        +----------+        +----------+
    |          |        |          |        |          |
    |   IPv6   +--------+  NAT64   +--------+   IPv4   |
    |          |        |          |        |          |
    +----------+        +----------+        +----------+
:::

[Figure 10](#figure-10){.selfRef}: [NAT64 without
DNS64](#name-nat64-without-dns64){.selfRef}
:::
:::
:::

::: {#section-3.2.2 .section}
#### [3.2.2.](#section-3.2.2){.section-number .selfRef} [Service-Provider NAT64; DNS64 in IPv6 Hosts](#name-service-provider-nat64-dns6){.section-name .selfRef} {#name-service-provider-nat64-dns6}

In this scenario ([Figure 11](#sp-nat64-h-dns64){.xref}), the service
provider offers the NAT64 function but not the DNS64 function. However,
the IPv6 hosts have a built-in DNS64
function.[¶](#section-3.2.2-1){.pilcrow}

This may become common if the DNS64 function is implemented in all the
IPv6 hosts/stacks. This is not common at the time of writing but may
become more common in the near future. This way, the DNSSEC validation
is performed on the A record, and then the host can use the DNS64
function in order to use the NAT64 function without any DNSSEC
issues.[¶](#section-3.2.2-2){.pilcrow}

This scenario fails to solve the issue of IPv4 literal addresses or
non-IPv6-compliant APIs, unless the IPv6 hosts also support Happy
Eyeballs v2 ([Section
7.1](https://www.rfc-editor.org/rfc/rfc8305#section-7.1){.relref} of
\[[RFC8305](#RFC8305){.xref}\]).[¶](#section-3.2.2-3){.pilcrow}

Moreover, this scenario also fails to solve the problem of IPv4-only
hosts or applications behind the IPv6-only access
network.[¶](#section-3.2.2-4){.pilcrow}

[]{#name-nat64-dns64-in-ipv6-hosts}

::: {#sp-nat64-h-dns64}
::: {#section-3.2.2-5.1 .artwork .art-text .alignCenter}
    +----------+        +----------+        +----------+
    |   IPv6   |        |          |        |          |
    |     +    +--------+  NAT64   +--------+   IPv4   |
    |   DNS64  |        |          |        |          |
    +----------+        +----------+        +----------+
:::

[Figure 11](#figure-11){.selfRef}: [NAT64; DNS64 in IPv6
Hosts](#name-nat64-dns64-in-ipv6-hosts){.selfRef}
:::
:::

::: {#sprdns64}
::: {#section-3.2.3 .section}
#### [3.2.3.](#section-3.2.3){.section-number .selfRef} [Service-Provider NAT64; DNS64 in the IPv4-Only Remote Network](#name-service-provider-nat64-dns64){.section-name .selfRef} {#name-service-provider-nat64-dns64}

In this scenario ([Figure 12](#sp-nat64-r-dns64){.xref}), the service
provider offers the NAT64 function only. The IPv4-only remote network
offers the DNS64 function.[¶](#section-3.2.3-1){.pilcrow}

This is not common, and it doesn\'t make sense that a remote network,
not deploying IPv6, is providing a DNS64 function. Like the scenario
depicted in [Section 3.2.1](#onlynat64){.xref}, it will only work if
both sides are using the WKP or the same NSP, so the same considerations
apply. It can also be tuned to behave as in [Section
3.1.1](#spnatdns64){.xref}.[¶](#section-3.2.3-2){.pilcrow}

This scenario fails to solve the issue of IPv4 literal addresses or
non-IPv6-compliant APIs.[¶](#section-3.2.3-3){.pilcrow}

Moreover, this scenario also fails to solve the problem of IPv4-only
hosts or applications behind the IPv6-only access
network.[¶](#section-3.2.3-4){.pilcrow}

[]{#name-nat64-dns64-in-ipv4-only-ho}

::: {#sp-nat64-r-dns64}
::: {#section-3.2.3-5.1 .artwork .art-text .alignCenter}
    +----------+        +----------+        +----------+
    |          |        |          |        |   IPv4   |
    |   IPv6   +--------+  NAT64   +--------+     +    |
    |          |        |          |        |   DNS64  |
    +----------+        +----------+        +----------+
:::

[Figure 12](#figure-12){.selfRef}: [NAT64; DNS64 in IPv4-Only
Hosts](#name-nat64-dns64-in-ipv4-only-ho){.selfRef}
:::
:::
:::
:::

::: {#section-3.3 .section}
### [3.3.](#section-3.3){.section-number .selfRef} [Comparing the Scenarios](#name-comparing-the-scenarios){.section-name .selfRef} {#name-comparing-the-scenarios}

This section compares the different scenarios, including possible
variations (each one represented in the previous sections by a different
figure), while considering the following
criteria:[¶](#section-3.3-1){.pilcrow}

a.  [DNSSEC: Are there hosts validating
    DNSSEC?[¶](#section-3.3-2.1){.pilcrow}]{#section-3.3-2.1}
b.  [Literal/APIs: Are there applications using IPv4 literals or
    non-IPv6-compliant
    APIs?[¶](#section-3.3-2.2){.pilcrow}]{#section-3.3-2.2}
c.  [IPv4 only: Are there hosts or applications using IPv4
    only?[¶](#section-3.3-2.3){.pilcrow}]{#section-3.3-2.3}
d.  [Foreign DNS: Does the scenario survive if the user, Operating
    System, applications, or devices change the
    DNS?[¶](#section-3.3-2.4){.pilcrow}]{#section-3.3-2.4}
e.  [DNS load opt. (DNS load optimization): Are there extra queries that
    may impact the DNS
    infrastructure?[¶](#section-3.3-2.5){.pilcrow}]{#section-3.3-2.5}
f.  [Connect. opt. (connection establishment delay optimization): Is the
    UE/CE only issuing the AAAA query or also the A query and waiting
    for both
    responses?[¶](#section-3.3-2.6){.pilcrow}]{#section-3.3-2.6}

In the table below, the columns represent each of the scenarios from the
previous sections by the figure number. The possible values are as
follows:[¶](#section-3.3-3){.pilcrow}

-   ::: {#section-3.3-4.1}

    \"-\"
    :   means the scenario is \"bad\" for that
        criterion.[¶](#section-3.3-4.1.1.2){.pilcrow}

    \"+\"
    :   means the scenario is \"good\" for that
        criterion.[¶](#section-3.3-4.1.1.4){.pilcrow}

    \"\*\"
    :   means the scenario is \"bad\" for that criterion; however, it is
        typically resolved with the support of Happy Eyeballs v2
        \[[RFC8305](#RFC8305){.xref}\].[¶](#section-3.3-4.1.1.6){.pilcrow}
    :::

In some cases, \"countermeasures\", alternative or special
configurations, may be available for the criterion designated as
\"bad\". So, this comparison is considering a generic case as a quick
comparison guide. In some cases, a \"bad\" criterion is not necessarily
a negative aspect; it all depends on the specific needs/characteristics
of the network where the deployment will take place. For instance, in a
network that only has IPv6-only hosts and apps using DNS and
IPv6-compliant APIs, there is no impact using only NAT64 and DNS64, but
if the hosts validate DNSSEC, that criterion is still
relevant.[¶](#section-3.3-5){.pilcrow}

[]{#name-scenario-comparison}

::: {#comparing}
  Item / Figure   1    2    3    4    5    6    7    8    9    10   11   12
  --------------- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
  DNSSEC          \-   \-   \-   \-   \-   \-   \-   \+   \+   \+   \+   \+
  Literal/APIs    \-   \-   \-   \-   \+   \+   \+   \+   \+   \-   \-   \-
  IPv4-only       \-   \-   \-   \-   \+   \+   \+   \+   \+   \-   \-   \-
  Foreign DNS     \-   \-   \-   \-   \+   \+   \+   \+   \+   \-   \+   \-
  DNS load opt.   \+   \+   \+   \+   \+   \+   \+   \+   \+   \+   \+   \+
  Connect. opt.   \+   \+   \+   \+   \+   \+   \+   \*   \*   \+   \+   \+

  : [Table 1](#table-1){.selfRef}: [Scenario
  Comparison](#name-scenario-comparison){.selfRef}
:::

As a general conclusion, we should note if the network must support
applications using any of the following:[¶](#section-3.3-7){.pilcrow}

-   [IPv4 literals[¶](#section-3.3-8.1){.pilcrow}]{#section-3.3-8.1}
-   [non-IPv6-compliant
    APIs[¶](#section-3.3-8.2){.pilcrow}]{#section-3.3-8.2}
-   [IPv4-only hosts or
    applications[¶](#section-3.3-8.3){.pilcrow}]{#section-3.3-8.3}

Then, only the scenarios with 464XLAT, a CLAT function, or equivalent
built-in local address synthesis features will provide a valid solution.
Furthermore, those scenarios will also keep working if the DNS
configuration is modified. Clearly, depending on if DNS64 is used or
not, DNSSEC may be broken for those hosts doing DNSSEC
validation.[¶](#section-3.3-9){.pilcrow}

All the scenarios are good in terms of DNS load optimization, and in the
case of 464XLAT, it may provide an extra degree of optimization.
Finally, all of the scenarios are also good in terms of connection
establishment delay optimization. However, in the case of 464XLAT
without DNS64, the usage of Happy Eyeballs v2 is required. This is not
an issue as it is commonly available in actual Operating
Systems.[¶](#section-3.3-10){.pilcrow}
:::
:::

::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Issues to be Considered](#name-issues-to-be-considered){.section-name .selfRef} {#name-issues-to-be-considered}

This section reviews the different issues that an operator needs to
consider for a NAT64/464XLAT deployment, as they may develop specific
decision points about how to approach that
deployment.[¶](#section-4-1){.pilcrow}

::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [DNSSEC Considerations and Possible Approaches](#name-dnssec-considerations-and-p){.section-name .selfRef} {#name-dnssec-considerations-and-p}

As indicated in the security considerations for DNS64 (see [Section
8](https://www.rfc-editor.org/rfc/rfc6147#section-8){.relref} of
\[[RFC6147](#RFC6147){.xref}\]) because DNS64 modifies DNS answers and
DNSSEC is designed to detect such modifications, DNS64 may break
DNSSEC.[¶](#section-4.1-1){.pilcrow}

When a device connected to an IPv6-only access network queries for a
domain name in a signed zone, by means of a recursive name server that
supports DNS64, the result may be a synthesized AAAA record. In that
case, if the recursive name server is configured to perform DNSSEC
validation and has a valid chain of trust to the zone in question, it
will cryptographically validate the negative response from the
authoritative name server. This is the expected DNS64 behavior: the
recursive name server actually \"lies\" to the client device. However,
in most of the cases, the client will not notice it, because generally,
they don\'t perform validation themselves; instead, they rely on the
recursive name servers.[¶](#section-4.1-2){.pilcrow}

In fact, a validating DNS64 resolver increases the confidence on the
synthetic AAAA, as it has validated that a non-synthetic AAAA doesn\'t
exist. However, if the client device is oblivious to NAT64 (the most
common case) and performs DNSSEC validation on the AAAA record, it will
fail as it is a synthesized record.[¶](#section-4.1-3){.pilcrow}

The best possible scenario from a DNSSEC point of view is when the
client requests that the DNS64 server perform the DNSSEC validation (by
setting the DNSSEC OK (DO) bit to 1 and the CD bit to 0). In this case,
the DNS64 server validates the data; thus, tampering may only happen
inside the DNS64 server (which is considered as a trusted part, thus,
its likelihood is low) or between the DNS64 server and the client. All
other parts of the system (including transmission and caching) are
protected by DNSSEC
\[[Threat-DNS64](#Threat-DNS64){.xref}\].[¶](#section-4.1-4){.pilcrow}

Similarly, if the client querying the recursive name server is another
name server configured to use it as a forwarder, and it is performing
DNSSEC validation, it will also fail on any synthesized AAAA
record.[¶](#section-4.1-5){.pilcrow}

All those considerations are extensively covered in Sections
[3](https://www.rfc-editor.org/rfc/rfc6147#section-3){.relref},
[5.5](https://www.rfc-editor.org/rfc/rfc6147#section-5.5){.relref}, and
[6.2](https://www.rfc-editor.org/rfc/rfc6147#section-6.2){.relref} of
\[[RFC6147](#RFC6147){.xref}\].[¶](#section-4.1-6){.pilcrow}

DNSSEC issues could be avoided if all the signed zones provide IPv6
connectivity together with the corresponding AAAA records. However, this
is out of the control of the operator needing to deploy a NAT64
function. This has been proposed already in
\[[DNS-DNSSEC](#I-D.bp-v6ops-ipv6-ready-dns-dnssec){.xref}\].[¶](#section-4.1-7){.pilcrow}

An alternative solution, which was considered while developing
\[[RFC6147](#RFC6147){.xref}\], is that the validators will be DNS64
aware. Then, they can perform the necessary discovery and do their own
synthesis. Since that was standardized sufficiently early in the
validator deployment curve, the expectation was that it would be okay to
break certain DNSSEC assumptions for networks that were stuck and really
needing NAT64/DNS64.[¶](#section-4.1-8){.pilcrow}

As already indicated, the scenarios in the previous section are
simplified to look at the worst possible case and for the most perfect
approach. A DNSSEC breach will not happen if the end host is not doing
validation.[¶](#section-4.1-9){.pilcrow}

The figures in previous studies indicate that DNSSEC broken by using
DNS64 makes up about 1.7% \[[About-DNS64](#About-DNS64){.xref}\] of the
cases. However, we can\'t negate that this may increase as DNSSEC
deployment grows. Consequently, a decision point for the operator must
depend on the following question: Do I really care about that percentage
of cases and the impact on my help desk, or can I provide alternative
solutions for them? Some possible solutions may be exist, as depicted in
the next sections.[¶](#section-4.1-10){.pilcrow}

::: {#nodns64}
::: {#section-4.1.1 .section}
#### [4.1.1.](#section-4.1.1){.section-number .selfRef} [Not Using DNS64](#name-not-using-dns64){.section-name .selfRef} {#name-not-using-dns64}

One solution is to avoid using DNS64, but as already indicated, this is
not possible in all the scenarios.[¶](#section-4.1.1-1){.pilcrow}

The use of DNS64 is a key component for some networks, in order to
comply with traffic performance metrics, monitored by some governmental
bodies and other institutions \[[FCC](#FCC){.xref}\]
\[[ARCEP](#ARCEP){.xref}\].[¶](#section-4.1.1-2){.pilcrow}

One drawback of not having a DNS64 on the network side is that it\'s not
possible to heuristically discover NAT64 \[[RFC7050](#RFC7050){.xref}\].
Consequently, an IPv6 host behind the IPv6-only access network will not
be able to detect the presence of the NAT64 function, nor learn the IPv6
prefix to be used for it, unless it is configured by alternative
means.[¶](#section-4.1.1-3){.pilcrow}

The discovery of the IPv6 prefix could be solved, as described in
\[[RFC7050](#RFC7050){.xref}\], by means of adding the relevant AAAA
records to the ipv4only.arpa. zone of the service-provider recursive
servers, i.e., if using the WKP
(64:ff9b::/96):[¶](#section-4.1.1-4){.pilcrow}

::: {#section-4.1.1-5 .artwork .art-text .alignCenter}
    ipv4only.arpa.  SOA     . . 0 0 0 0 0
    ipv4only.arpa.  NS      .
    ipv4only.arpa.  AAAA    64:ff9b::192.0.0.170
    ipv4only.arpa.  AAAA    64:ff9b::192.0.0.171
    ipv4only.arpa.  A       192.0.0.170
    ipv4only.arpa.  A       192.0.0.171

[¶](#section-4.1.1-5){.pilcrow}
:::

An alternative option is the use of DNS RPZ
\[[DNS-RPZ](#I-D.vixie-dnsop-dns-rpz){.xref}\] or equivalent
functionalities. Note that this may impact DNSSEC if the zone is
signed.[¶](#section-4.1.1-6){.pilcrow}

Another alternative, only valid in environments with support from the
Port Control Protocol (PCP) (for both the hosts or CEs and for the
service-provider network), is to follow \"Discovering NAT64 IPv6
Prefixes Using the Port Control Protocol (PCP)\"
\[[RFC7225](#RFC7225){.xref}\].[¶](#section-4.1.1-7){.pilcrow}

Other alternatives may be available in the future. All them are
extensively discussed in \[[RFC7051](#RFC7051){.xref}\]; however, due to
the deployment evolution, many considerations from that document have
changed. New options are being documented, such as using Router
Advertising \[[PREF64](#I-D.ietf-6man-ra-pref64){.xref}\] or DHCPv6
options
\[[DHCPv6-OPTIONS](#I-D.li-intarea-nat64-prefix-dhcp-option){.xref}\].[¶](#section-4.1.1-8){.pilcrow}

Simultaneous support of several of the possible approaches is convenient
and will ensure that clients with different ways to configure the NAT64
prefix successfully obtain it. This is also convenient even if DNS64 is
being used.[¶](#section-4.1.1-9){.pilcrow}

Also of special relevance to this section is
\[[IPV4ONLY-ARPA](#I-D.cheshire-sudn-ipv4only-dot-arpa){.xref}\].[¶](#section-4.1.1-10){.pilcrow}
:::
:::

::: {#dns64-aware}
::: {#section-4.1.2 .section}
#### [4.1.2.](#section-4.1.2){.section-number .selfRef} [DNSSEC Validator Aware of DNS64](#name-dnssec-validator-aware-of-d){.section-name .selfRef} {#name-dnssec-validator-aware-of-d}

In general, by default, DNS servers with DNS64 function will not
synthesize AAAA responses if the DO flag was set in the
query.[¶](#section-4.1.2-1){.pilcrow}

In this case, since only an A record is available, if a CLAT function is
present, the CLAT will, as in the case of literal IPv4 addresses, keep
that traffic flow end to end as IPv4 so DNSSEC is not
broken.[¶](#section-4.1.2-2){.pilcrow}

However, this will not work if a CLAT function is not present because
the hosts will not be able to use IPv4 (which is the case for all the
scenarios without 464XLAT).[¶](#section-4.1.2-3){.pilcrow}
:::
:::

::: {#stub}
::: {#section-4.1.3 .section}
#### [4.1.3.](#section-4.1.3){.section-number .selfRef} [Stub Validator](#name-stub-validator){.section-name .selfRef} {#name-stub-validator}

If the DO flag is set and the client device performs DNSSEC validation,
and the Checking Disabled (CD) flag is set for a query, the DNS64
recursive server will not synthesize AAAA responses. In this case, the
client could perform the DNSSEC validation with the A record and then
synthesize the AAAA responses \[[RFC6052](#RFC6052){.xref}\]. For that
to be possible, the client must have learned the NAT64 prefix beforehand
using any of the available methods (see \[[RFC7050](#RFC7050){.xref}\],
\[[RFC7225](#RFC7225){.xref}\],
\[[PREF64](#I-D.ietf-6man-ra-pref64){.xref}\], and
\[[DHCPv6-OPTIONS](#I-D.li-intarea-nat64-prefix-dhcp-option){.xref}\]).
This allows the client device to avoid using the DNS64 function and
still use NAT64 even with DNSSEC.[¶](#section-4.1.3-1){.pilcrow}

If the end host is IPv4 only, this will not work if a CLAT function is
not present (which is the case for all scenarios without
464XLAT).[¶](#section-4.1.3-2){.pilcrow}

Instead of a CLAT, some devices or Operating Systems may implement an
equivalent function by using Bump-in-the-Host
\[[RFC6535](#RFC6535){.xref}\] as part of Happy Eyeballs v2 (see
[Section
7.1](https://www.rfc-editor.org/rfc/rfc8305#section-7.1){.relref} of
\[[RFC8305](#RFC8305){.xref}\]). In this case, the considerations in the
above paragraphs are also applicable.[¶](#section-4.1.3-3){.pilcrow}
:::
:::

::: {#dns-proxy}
::: {#section-4.1.4 .section}
#### [4.1.4.](#section-4.1.4){.section-number .selfRef} [CLAT with DNS Proxy and Validator](#name-clat-with-dns-proxy-and-val){.section-name .selfRef} {#name-clat-with-dns-proxy-and-val}

If a CE includes CLAT support and also a DNS proxy, as indicated in
[Section
6.4](https://www.rfc-editor.org/rfc/rfc6877#section-6.4){.relref} of
\[[RFC6877](#RFC6877){.xref}\], the CE could behave as a stub validator
on behalf of the client devices. Then, following the same approach
described in [Section 4.1.3](#stub){.xref}, the DNS proxy will actually
\"lie\" to the client devices, which, in most cases, will not be noticed
unless they perform validation by themselves. Again, this allows the
client devices to avoid the use of the DNS64 function but to still use
NAT64 with DNSSEC.[¶](#section-4.1.4-1){.pilcrow}

Once more, this will not work without a CLAT function (which is the case
for all scenarios without 464XLAT).[¶](#section-4.1.4-2){.pilcrow}
:::
:::

::: {#acl-client}
::: {#section-4.1.5 .section}
#### [4.1.5.](#section-4.1.5){.section-number .selfRef} [ACL of Clients](#name-acl-of-clients){.section-name .selfRef} {#name-acl-of-clients}

In cases of dual-stack clients, AAAA queries typically take preference
over A queries. If DNS64 is enabled for those clients, it will never get
A records, even for IPv4-only servers.[¶](#section-4.1.5-1){.pilcrow}

As a consequence, in cases where there are IPv4-only servers, and those
are located in the path before the NAT64 function, the clients will not
be able to reach them. If DNSSEC is being used for all those flows,
specific addresses or prefixes can be left out of the DNS64 synthesis by
means of Access Control Lists (ACLs).[¶](#section-4.1.5-2){.pilcrow}

Once more, this will not work without a CLAT function (which is the case
for all scenarios without 464XLAT).[¶](#section-4.1.5-3){.pilcrow}
:::
:::

::: {#mapping-out}
::: {#section-4.1.6 .section}
#### [4.1.6.](#section-4.1.6){.section-number .selfRef} [Mapping Out IPv4 Addresses](#name-mapping-out-ipv4-addresses){.section-name .selfRef} {#name-mapping-out-ipv4-addresses}

If there are well-known specific IPv4 addresses or prefixes using
DNSSEC, they can be mapped out of the DNS64
synthesis.[¶](#section-4.1.6-1){.pilcrow}

Even if this is not related to DNSSEC, this \"mapping-out\" feature is
quite commonly used to ensure that addresses
\[[RFC1918](#RFC1918){.xref}\] (for example, used by LAN servers) are
not synthesized to AAAA.[¶](#section-4.1.6-2){.pilcrow}

Once more, this will not work without a CLAT function (which is the case
for all scenarios without 464XLAT).[¶](#section-4.1.6-3){.pilcrow}
:::
:::
:::

::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [DNS64 and Reverse Mapping](#name-dns64-and-reverse-mapping){.section-name .selfRef} {#name-dns64-and-reverse-mapping}

When a client device using DNS64 tries to reverse-map a synthesized IPv6
address, the name server responds with a CNAME record that points the
domain name used to reverse-map the synthesized IPv6 address (the one
under ip6.arpa) to the domain name corresponding to the embedded IPv4
address (under in-addr.arpa).[¶](#section-4.2-1){.pilcrow}

This is the expected behavior, so no issues need to be considered
regarding DNS reverse mapping.[¶](#section-4.2-2){.pilcrow}
:::

::: {#xlatwwdns64}
::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [Using 464XLAT with/without DNS64](#name-using-464xlat-with-without-){.section-name .selfRef} {#name-using-464xlat-with-without-}

In case the client device is IPv6 only (either because the stack or
application is IPv6 only or because it is connected via an IPv6-only
LAN) and the remote server is IPv4 only (either because the stack is
IPv4 only or because it is connected via an IPv4-only LAN), only NAT64
combined with DNS64 will be able to provide access between both. Because
DNS64 is then required, DNSSEC validation will only be possible if the
recursive name server is validating the negative response from the
authoritative name server, and the client is not performing
validation.[¶](#section-4.3-1){.pilcrow}

Note that at this stage of the transition, it is not expected that
applications, devices, or Operating Systems are IPv6 only. It will not
be a sensible decision for a developer to work on that direction, unless
it is clear that the deployment scenario fully supports
it.[¶](#section-4.3-2){.pilcrow}

On the other hand, an end user or enterprise network may decide to run
IPv6 only in the LANs. In case there is any chance for applications to
be IPv6 only, the Operating System may be responsible for either doing a
local address synthesis or setting up some kind of on-demand VPN
(IPv4-in-IPv6), which needs to be supported by that network. This may
become very common in enterprise networks, where \"Unique IPv6 Prefix
per Host\" \[[RFC8273](#RFC8273){.xref}\] is
supported.[¶](#section-4.3-3){.pilcrow}

However, when the client device is dual stack and/or connected in a
dual-stack LAN by means of a CLAT function (or has a built-in CLAT
function), DNS64 is an option.[¶](#section-4.3-4){.pilcrow}

1.  [With DNS64: If DNS64 is used, most of the IPv4 traffic (except if
    using literal IPv4 addresses or non-IPv6-compliant APIs) will not
    use the CLAT and will instead use the IPv6 path, so only one
    translation will be done at the NAT64. This may break DNSSEC, unless
    measures as described in the previous sections are
    taken.[¶](#section-4.3-5.1){.pilcrow}]{#section-4.3-5.1}
2.  [Without DNS64: If DNS64 is not used, all the IPv4 traffic will make
    use of the CLAT, so two translations are required (NAT46 at the CLAT
    and NAT64 at the PLAT), which adds some overhead in terms of the
    extra NAT46 translation. However, this avoids the AAAA synthesis and
    consequently will never break
    DNSSEC.[¶](#section-4.3-5.2){.pilcrow}]{#section-4.3-5.2}

Note that the extra translation, when DNS64 is not used, takes place at
the CLAT, which means no extra overhead for the operator. However, it
adds potential extra delays to establish the connections and has no
perceptible impact for a CE in a broadband network, but it may have some
impact on a battery-powered device. The cost for a battery-powered
device is possibly comparable to the cost when the device is doing a
local address synthesis (see [Section
7.1](https://www.rfc-editor.org/rfc/rfc8305#section-7.1){.relref} of
\[[RFC8305](#RFC8305){.xref}\]).[¶](#section-4.3-6){.pilcrow}
:::
:::

::: {#foreignDNS}
::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [Foreign DNS](#name-foreign-dns){.section-name .selfRef} {#name-foreign-dns}

Clients, devices, or applications in a service-provider network may use
DNS servers from other networks. This may be the case if individual
applications use their own DNS server, the Operating System itself or
even the CE, or combinations of the above.[¶](#section-4.4-1){.pilcrow}

Those \"foreign\" DNS servers may not support DNS64; as a consequence,
those scenarios that require a DNS64 may not work. However, if a CLAT
function is available, the considerations in [Section
4.3](#xlatwwdns64){.xref} will apply.[¶](#section-4.4-2){.pilcrow}

If the foreign DNS supports the DNS64 function, incorrect configuration
parameters may be provided that, for example, cause WKP or NSP to become
unmatched or result in a case such as the one described in [Section
3.2.3](#sprdns64){.xref}.[¶](#section-4.4-3){.pilcrow}

Having a CLAT function, even if using foreign DNS without a DNS64
function, ensures that everything will work, so the CLAT must be
considered to be an advantage despite user configuration errors. As a
result, all the traffic will use a double translation (NAT46 at the CLAT
and NAT64 at the operator network), unless there is support for EAM
([Section 4.9](#EAM){.xref}).[¶](#section-4.4-4){.pilcrow}

An exception is the case where there is a CLAT function at the CE that
is not able to obtain the correct configuration parameters (again,
causing WKP or NSP to become unmatched).[¶](#section-4.4-5){.pilcrow}

However, it needs to be emphasized that if there is no CLAT function
(which is the case for all scenarios without 464XLAT), an external DNS
without DNS64 support will disallow any access to IPv4-only destination
networks and will not guarantee the correct DNSSEC validation, so it
will behave as in [Section
3.2.1](#onlynat64){.xref}.[¶](#section-4.4-6){.pilcrow}

In summary, the consequences of using foreign DNS depends on each
specific case. However, in general, if a CLAT function is present, most
of the time there will not be any issues. In the other cases, the access
to IPv6-enabled services is still guaranteed for IPv6-enabled hosts, but
it is not guaranteed for IPv4-only hosts nor is the access to IPv4-only
services for any hosts in the network.[¶](#section-4.4-7){.pilcrow}

The causes of \"foreign DNS\" could be classified in three main
categories, as depicted in the following
subsections.[¶](#section-4.4-8){.pilcrow}

::: {#section-4.4.1 .section}
#### [4.4.1.](#section-4.4.1){.section-number .selfRef} [Manual Configuration of DNS](#name-manual-configuration-of-dns){.section-name .selfRef} {#name-manual-configuration-of-dns}

It is becoming increasingly common that end users, or even devices or
applications, configure alternative DNS in their Operating Systems and
sometimes in CEs.[¶](#section-4.4.1-1){.pilcrow}
:::

::: {#dnspriv}
::: {#section-4.4.2 .section}
#### [4.4.2.](#section-4.4.2){.section-number .selfRef} [DNS Privacy/Encryption Mechanisms](#name-dns-privacy-encryption-mech){.section-name .selfRef} {#name-dns-privacy-encryption-mech}

Clients or applications may use mechanisms for DNS privacy/encryption,
such as DNS over TLS (DoT) \[[RFC7858](#RFC7858){.xref}\], DNS over DTLS
\[[RFC8094](#RFC8094){.xref}\], DNS queries over HTTPS (DoH)
\[[RFC8484](#RFC8484){.xref}\], or DNS over QUIC (DoQ)
\[[QUIC-CONNECTIONS](#I-D.huitema-quic-dnsoquic){.xref}\].[¶](#section-4.4.2-1){.pilcrow}

Currently, those DNS privacy/encryption options are typically provided
by the applications, not the Operating System vendors. At the time this
document was written, the DoT and DoH standards have declared DNS64 (and
consequently NAT64) out of their scope, so an application using them may
break NAT64, unless a correctly configured CLAT function is
used.[¶](#section-4.4.2-2){.pilcrow}
:::
:::

::: {#SplitDNS}
::: {#section-4.4.3 .section}
#### [4.4.3.](#section-4.4.3){.section-number .selfRef} [Split DNS and VPNs](#name-split-dns-and-vpns){.section-name .selfRef} {#name-split-dns-and-vpns}

When networks or hosts use \"split-DNS\" (also called Split Horizon, DNS
views, or private DNS), the successful use of DNS64 is not guaranteed.
This case is analyzed in [Section
4](https://www.rfc-editor.org/rfc/rfc6950#section-4){.relref} of
\[[RFC6950](#RFC6950){.xref}\].[¶](#section-4.4.3-1){.pilcrow}

A similar situation may happen with VPNs that force all the DNS queries
through the VPN and ignore the operator DNS64
function.[¶](#section-4.4.3-2){.pilcrow}
:::
:::
:::
:::

::: {#WKP-NSP}
::: {#section-4.5 .section}
### [4.5.](#section-4.5){.section-number .selfRef} [Well-Known Prefix (WKP) vs. Network-Specific Prefix (NSP)](#name-well-known-prefix-wkp-vs-ne){.section-name .selfRef} {#name-well-known-prefix-wkp-vs-ne}

Section 3 of \"IPv6 Addressing of IPv4/IPv6 Translator\"
\[[RFC6052](#RFC6052){.xref}\] discusses some considerations that are
useful to an operator when deciding if a WKP or an NSP should be
used.[¶](#section-4.5-1){.pilcrow}

Considering that discussion and other issues, we can summarize the
possible decision points to as follows:[¶](#section-4.5-2){.pilcrow}

a.  [The WKP [MUST NOT]{.bcp14} be used to represent non-global IPv4
    addresses. If this is required because the network to be translated
    uses non-global addresses, then an NSP is
    required.[¶](#section-4.5-3.1){.pilcrow}]{#section-4.5-3.1}
b.  [The WKP [MAY]{.bcp14} appear in interdomain routing tables, if the
    operator provides a NAT64 function to peers. However, in this case,
    special considerations related to BGP filtering are required, and
    IPv4-embedded IPv6 prefixes longer than the WKP [MUST NOT]{.bcp14}
    be advertised (or accepted) in BGP. An NSP may be a more appropriate
    option in those
    cases.[¶](#section-4.5-3.2){.pilcrow}]{#section-4.5-3.2}
c.  [If several NAT64s use the same prefix, packets from the same flow
    may be routed to a different NAT64 in case of routing changes. This
    can be avoided by either using different prefixes for each NAT64
    function or ensuring that all the NAT64s coordinate their state.
    Using an NSP could simplify
    that.[¶](#section-4.5-3.3){.pilcrow}]{#section-4.5-3.3}
d.  [If DNS64 is required and users, devices, Operating Systems, or
    applications may change their DNS configuration and deliberately
    choose an alternative DNS64 function, the alternative DNS64 will
    most likely use the WKP by default. In that case, if an NSP is used
    by the NAT64 function, clients will not be able to use the operator
    NAT64 function, which will break connectivity to IPv4-only
    destinations.[¶](#section-4.5-3.4){.pilcrow}]{#section-4.5-3.4}
:::
:::

::: {#literals}
::: {#section-4.6 .section}
### [4.6.](#section-4.6){.section-number .selfRef} [IPv4 Literals and Non-IPv6-Compliant APIs](#name-ipv4-literals-and-non-ipv6-){.section-name .selfRef} {#name-ipv4-literals-and-non-ipv6-}

A host or application using literal IPv4 addresses or older APIs, which
aren\'t IPv6 compliant, behind a network with IPv6-only access will not
work unless any of the following alternatives are
provided:[¶](#section-4.6-1){.pilcrow}

-   [CLAT (or an equivalent
    function).[¶](#section-4.6-2.1){.pilcrow}]{#section-4.6-2.1}
-   [Happy Eyeballs v2 (Section 7.1 of
    \[[RFC8305](#RFC8305){.xref}\]).[¶](#section-4.6-2.2){.pilcrow}]{#section-4.6-2.2}
-   [Bump-in-the-Host \[[RFC6535](#RFC6535){.xref}\] with a DNS64
    function.[¶](#section-4.6-2.3){.pilcrow}]{#section-4.6-2.3}

Those alternatives will solve the problem for an end host. However, if
the end host is providing \"tethering\" or an equivalent service to
other hosts, that needs to be considered as well. In other words, in a
cellular network, these alternatives resolve the issue for the UE
itself, but this may not be the case for hosts connected via the
tethering.[¶](#section-4.6-3){.pilcrow}

Otherwise, the support of 464XLAT is the only valid and complete
approach to resolve this issue.[¶](#section-4.6-4){.pilcrow}
:::
:::

::: {#ipv4-only}
::: {#section-4.7 .section}
### [4.7.](#section-4.7){.section-number .selfRef} [IPv4-Only Hosts or Applications](#name-ipv4-only-hosts-or-applicat){.section-name .selfRef} {#name-ipv4-only-hosts-or-applicat}

IPv4-only hosts or an application behind a network with IPv6-only access
will not work unless a CLAT function is
present.[¶](#section-4.7-1){.pilcrow}

464XLAT is the only valid approach to resolve this
issue.[¶](#section-4.7-2){.pilcrow}
:::
:::

::: {#CLAT}
::: {#section-4.8 .section}
### [4.8.](#section-4.8){.section-number .selfRef} [CLAT Translation Considerations](#name-clat-translation-considerat){.section-name .selfRef} {#name-clat-translation-considerat}

As described in \"IPv6 Prefix Handling\" (see [Section
6.3](https://www.rfc-editor.org/rfc/rfc6877#section-6.3){.relref} of
\[[RFC6877](#RFC6877){.xref}\]), if the CLAT function can be configured
with a dedicated /64 prefix for the NAT46 translation, then it will be
possible to do a more efficient stateless
translation.[¶](#section-4.8-1){.pilcrow}

Otherwise, if this dedicated prefix is not available, the CLAT function
will need to do a stateful translation, for example, perform stateful
NAT44 for all the IPv4 LAN packets so they appear as coming from a
single IPv4 address; in turn, the CLAT function will perform a stateless
translation to a single IPv6 address.[¶](#section-4.8-2){.pilcrow}

A possible setup, in order to maximize the CLAT performance, is to
configure the dedicated translation prefix. This can be easily achieved
automatically, if the broadband CE or end-user device is able to obtain
a shorter prefix by means of DHCPv6-PD \[[RFC8415](#RFC8415){.xref}\] or
other alternatives. The CE can then use a specific /64 for the
translation. This is also possible when broadband is provided by a
cellular access.[¶](#section-4.8-3){.pilcrow}

The above recommendation is often not possible for cellular networks,
when connecting smartphones (as UEs): generally they don\'t use
DHCPv6-PD \[[RFC8415](#RFC8415){.xref}\]. Instead, a single /64 is
provided for each Packet Data Protocol (PDP) context, and prefix sharing
\[[RFC6877](#RFC6877){.xref}\] is used. In this case, the UEs typically
have a build-in CLAT function that is performing a stateful NAT44
translation before the stateless NAT46.[¶](#section-4.8-4){.pilcrow}
:::
:::

::: {#EAM}
::: {#section-4.9 .section}
### [4.9.](#section-4.9){.section-number .selfRef} [EAM Considerations](#name-eam-considerations){.section-name .selfRef} {#name-eam-considerations}

\"Explicit Address Mappings for Stateless IP/ICMP Translation\"
\[[RFC7757](#RFC7757){.xref}\] provides a way to configure explicit
mappings between IPv4 and IPv6 prefixes of any length. When this is
used, for example, in a CLAT function, it may provide a simple mechanism
in order to avoid traffic flows between IPv4-only nodes or applications
and dual-stack destinations to be translated twice (NAT46 and NAT64), by
creating mapping entries with the Global Unicast Address (GUA) of the
IPv6-reachable destination. This optimization of NAT64 usage is very
useful in many scenarios, including Content Delivery Networks (CDNs) and
caches, as described in
\[[OPT-464XLAT](#I-D.palet-v6ops-464xlat-opt-cdn-caches){.xref}\].[¶](#section-4.9-1){.pilcrow}

In addition, it may also provide a way for IPv4-only nodes or
applications to communicate with IPv6-only
destinations.[¶](#section-4.9-2){.pilcrow}
:::
:::

::: {#incoming}
::: {#section-4.10 .section}
### [4.10.](#section-4.10){.section-number .selfRef} [Incoming Connections](#name-incoming-connections){.section-name .selfRef} {#name-incoming-connections}

The use of NAT64, in principle, disallows IPv4 incoming connections,
which may still be needed for IPv4-only peer-to-peer applications.
However, there are several alternatives that resolve this
issue:[¶](#section-4.10-1){.pilcrow}

a.  [Session Traversal Utilities for NAT (STUN)
    \[[RFC5389](#RFC5389){.xref}\], Traversal Using Relays around NAT
    (TURN) \[[RFC5766](#RFC5766){.xref}\], and Interactive Connectivity
    Establishment (ICE) \[[RFC8445](#RFC8445){.xref}\] are commonly used
    by peer-to-peer applications in order to allow incoming connections
    with IPv4 NAT. In the case of NAT64, they work as
    well.[¶](#section-4.10-2.1){.pilcrow}]{#section-4.10-2.1}
b.  [The Port Control Protocol (PCP) \[[RFC6887](#RFC6887){.xref}\]
    allows a host to control how incoming IPv4 and IPv6 packets are
    translated and forwarded. A NAT64 may implement PCP to allow this
    service.[¶](#section-4.10-2.2){.pilcrow}]{#section-4.10-2.2}
c.  [EAM \[[RFC7757](#RFC7757){.xref}\] may also be used in order to
    configure explicit mappings for customers that require them. This is
    used, for example, by Stateless IP/ICMP Translation for IPv6 Data
    Center Environments (SIIT-DC) \[[RFC7755](#RFC7755){.xref}\] and
    SIIT-DC Dual Translation Mode (SIIT-DC-DTM)
    \[[RFC7756](#RFC7756){.xref}\].[¶](#section-4.10-2.3){.pilcrow}]{#section-4.10-2.3}
:::
:::
:::

::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Summary of Deployment Recommendations for NAT64/464XLAT](#name-summary-of-deployment-recom){.section-name .selfRef} {#name-summary-of-deployment-recom}

It has been demonstrated that NAT64/464XLAT is a valid choice in several
scenarios (IPv6-IPv4 and IPv4-IPv6-IPv4), being the predominant
mechanism in the majority of the cellular networks, which account for
hundreds of millions of users \[[ISOC](#ISOC){.xref}\]. NAT64/464XLAT
offer different choices of deployment, depending on each network case,
needs, and requirements. Despite that, this document is not an explicit
recommendation for using this choice versus other IPv4aaS transition
mechanisms. Instead, this document is a guide that facilitates
evaluating a possible implementation of NAT64/464XLAT and key decision
points about specific design considerations for its
deployment.[¶](#section-5-1){.pilcrow}

Depending on the specific requirements of each deployment case, DNS64
may be a required function, while in other cases, the adverse effects
may be counterproductive. Similarly, in some cases, a NAT64 function,
together with a DNS64 function, may be a valid solution when there is a
certainty that IPv4-only hosts or applications do not need to be
supported (see Sections [4.6](#literals){.xref} and
[4.7](#ipv4-only){.xref}). However, in other cases (i.e., IPv4-only
devices or applications that need to be supported), the limitations of
NAT64/DNS64 may indicate that the operator needs to look into 464XLAT as
a more complete solution.[¶](#section-5-2){.pilcrow}

For broadband-managed networks (where the CE is provided or
suggested/supported by the operator), in order to fully support the
actual user\'s needs (i.e., IPv4-only devices and applications and the
usage of IPv4 literals and non-IPv6-compliant APIs), the 464XLAT
scenario should be considered. In that case, it must support a CLAT
function.[¶](#section-5-3){.pilcrow}

If the operator provides DNS services, they may support a DNS64 function
to avoid, as much as possible, breaking DNSSEC. This will also increase
performance, by reducing the double translation for all the IPv4
traffic. In this case, if the DNS service is offering DNSSEC validation,
then it must be in such a way that it is aware of the DNS64. This is
considered the simpler and safer approach, and it may be combined with
other recommendations described in this
document:[¶](#section-5-4){.pilcrow}

-   [DNS infrastructure [MUST]{.bcp14} be aware of DNS64 ([Section
    4.1.2](#dns64-aware){.xref}).[¶](#section-5-5.1){.pilcrow}]{#section-5-5.1}
-   [Devices running CLAT [SHOULD]{.bcp14} follow the indications in
    \"Stub Validator\" (see [Section 4.1.3](#stub){.xref}). However,
    this may be out of the control of the
    operator.[¶](#section-5-5.2){.pilcrow}]{#section-5-5.2}
-   [CEs [SHOULD]{.bcp14} include a DNS proxy and validator ([Section
    4.1.4](#dns-proxy){.xref}).[¶](#section-5-5.3){.pilcrow}]{#section-5-5.3}
-   [\"ACL of Clients\" (see [Section 4.1.5](#acl-client){.xref}) and
    \"Mapping Out IPv4 Addresses\" (see [Section
    4.1.6](#mapping-out){.xref}) [MAY]{.bcp14} be considered by
    operators, depending on their own
    infrastructure.[¶](#section-5-5.4){.pilcrow}]{#section-5-5.4}

This \"increased performance\" approach has the disadvantage of
potentially breaking DNSSEC for a small percentage of validating end
hosts versus the small impact of a double translation taking place in
the CE. If CE performance is not an issue, which is the most frequent
case, then a much safer approach is to not use DNS64 at all, and
consequently, ensure that all the IPv4 traffic is translated at the CLAT
([Section 4.3](#xlatwwdns64){.xref}).[¶](#section-5-6){.pilcrow}

If DNS64 is not used, at least one of the alternatives described in
[Section 4.1.1](#nodns64){.xref} must be followed in order to learn the
NAT64 prefix.[¶](#section-5-7){.pilcrow}

The operator needs to consider that if the DNS configuration is modified
(see Sections [4.4](#foreignDNS){.xref}, [4.4.2](#dnspriv){.xref}, and
[4.4.3](#SplitDNS){.xref}), which most likely cannot be avoided, a
foreign non-DNS64 could be used instead of configuring a DNS64. In a
scenario with only a NAT64 function, an IPv4-only remote host will no
longer be accessible. Instead, it will continue to work in the case of
464XLAT.[¶](#section-5-8){.pilcrow}

Similar considerations need to be made regarding the usage of a NAT64
WKP vs. NSP ([Section 4.5](#WKP-NSP){.xref}), as they must match the
configuration of DNS64. When using foreign DNS, they may not match. If
there is a CLAT and the configured foreign DNS is not a DNS64, the
network will keep working only if other means of learning the NAT64
prefix are available.[¶](#section-5-9){.pilcrow}

For broadband networks, as described in [Section 4.8](#CLAT){.xref}, the
CEs supporting a CLAT function [SHOULD]{.bcp14} support DHCPv6-PD
\[[RFC8415](#RFC8415){.xref}\] or alternative means for configuring a
shorter prefix. The CE [SHOULD]{.bcp14} internally reserve one /64 for
the stateless NAT46 translation. The operator must ensure that the
customers are allocated prefixes shorter than /64 in order to support
this optimization. One way or another, this is not impacting the
performance of the operator network.[¶](#section-5-10){.pilcrow}

Operators may follow \"Deployment Considerations\" (Section 7 of
\[[RFC6877](#RFC6877){.xref}\]) for suggestions on how to take advantage
of traffic-engineering requirements.[¶](#section-5-11){.pilcrow}

For cellular networks, the considerations regarding DNSSEC may appear to
be out of scope because UEs\' Operating Systems commonly don\'t support
DNSSEC. However, applications running on them may, or it may be an
Operating System \"built-in\" support in the future. Moreover, if those
devices offer tethering, other client devices behind the UE may be doing
the validation; hence, proper DNSSEC support by the operator network is
relevant.[¶](#section-5-12){.pilcrow}

Furthermore, cellular networks supporting 464XLAT
\[[RFC6877](#RFC6877){.xref}\] and \"Discovery of the IPv6 Prefix Used
for IPv6 Address Synthesis\" \[[RFC7050](#RFC7050){.xref}\] allow a
progressive IPv6 deployment, with a single Access Point Name (APN)
supporting all types of PDP context (IPv4, IPv6, and IPv4v6). This
approach allows the network to automatically serve every possible
combination of UEs.[¶](#section-5-13){.pilcrow}

If the operator chooses to provide validation for the DNS64 prefix
discovery, it must follow the advice from \"Validation of Discovered
Pref64::/n\" (see [Section
3.1](https://www.rfc-editor.org/rfc/rfc7050#section-3.1){.relref} of
\[[RFC7050](#RFC7050){.xref}\]).[¶](#section-5-14){.pilcrow}

One last consideration is that many networks may have a mix of different
complex scenarios at the same time; for example, customers that require
464XLAT and those that don\'t, customers that require DNS64 and those
that don\'t, etc. In general, the different issues and the approaches
described in this document can be implemented at the same time for
different customers or parts of the network. That mix of approaches
doesn\'t present any problem or incompatibility; they work well together
as a matter of appropriate and differentiated provisioning. In fact, the
NAT64/464XLAT approach facilitates an operator offering both cellular
and broadband services to have a single IPv4aaS for both networks while
differentiating the deployment key decisions to optimize each case.
It\'s even possible to use hybrid CEs that have a main broadband access
link and a backup via the cellular network.[¶](#section-5-15){.pilcrow}

In an ideal world, we could safely use DNS64 if the approach proposed in
\[[DNS-DNSSEC](#I-D.bp-v6ops-ipv6-ready-dns-dnssec){.xref}\] were
followed, avoiding the cases where DNSSEC may be broken. However, this
will not solve the issues related to DNS privacy and split
DNS.[¶](#section-5-16){.pilcrow}

The only 100% safe solution that also resolves all the issues is, in
addition to having a CLAT function, not using a DNS64 but instead making
sure that the hosts have a built-in address synthesis feature. Operators
could manage to provide CEs with the CLAT function; however, the
built-in address synthesis feature is out of their control. If the
synthesis is provided by either the Operating System (via its DNS
resolver API) or the application (via its own DNS resolver) in such way
that the prefix used for the NAT64 function is reachable for the host,
the problem goes away.[¶](#section-5-17){.pilcrow}

Whenever feasible, using EAM \[[RFC7757](#RFC7757){.xref}\] as indicated
in [Section 4.9](#EAM){.xref} provides a very relevant optimization,
avoiding double translations.[¶](#section-5-18){.pilcrow}

Applications that require incoming connections typically provide a means
for that already. However, PCP and EAM, as indicated in [Section
4.10](#incoming){.xref}, are valid alternatives, even for creating
explicit mappings for customers that require
them.[¶](#section-5-19){.pilcrow}
:::

::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Deployment of 464XLAT/NAT64 in Enterprise Networks](#name-deployment-of-464xlat-nat64){.section-name .selfRef} {#name-deployment-of-464xlat-nat64}

The recommendations in this document can also be used in enterprise
networks, campuses, and other similar scenarios (including managed
end-user networks).[¶](#section-6-1){.pilcrow}

This includes scenarios where the NAT64 function (and DNS64 function, if
available) are under the control of that network (or can be configured
manually according to that network\'s specific requirements), and there
is a need to provide IPv6-only access to any part of that network, or it
is IPv6 only connected to third-party
networks.[¶](#section-6-2){.pilcrow}

An example is the IETF meeting network itself, where both NAT64 and
DNS64 functions are provided, presenting in this case the same issues as
per [Section 3.1.1](#spnatdns64){.xref}. If there is a CLAT function in
the IETF network, then there is no need to use DNS64, and it falls under
the considerations of [Section 3.1.3](#xlat-dns64){.xref}. Both
scenarios have been tested and verified already in the IETF
network.[¶](#section-6-3){.pilcrow}

The following figures represent a few of the possible
scenarios.[¶](#section-6-4){.pilcrow}

[Figure 13](#enterprise-nat64-dns64){.xref} provides an example of an
IPv6-only enterprise network connected with a dual stack to the Internet
using local NAT64 and DNS64 functions.[¶](#section-6-5){.pilcrow}

[]{#name-ipv6-only-enterprise-with-n}

::: {#enterprise-nat64-dns64}
::: {#section-6-6.1 .artwork .art-text .alignCenter}
    +----------------------------------+
    |       Enterprise Network         |
    | +----------+        +----------+ |       +----------+
    | |   IPv6-  |        |  NAT64   | |       |   IPv4   |
    | |   only   +--------+    +     | +-------+     +    |
    | |   LANs   |        |  DNS64   | |       |   IPv6   |
    | +----------+        +----------+ |       +----------+
    +----------------------------------+
:::

[Figure 13](#figure-13){.selfRef}: [IPv6-Only Enterprise with NAT64 and
DNS64](#name-ipv6-only-enterprise-with-n){.selfRef}
:::

[Figure 14](#enterprise-464xlat){.xref} provides an example of a DS
enterprise network connected with DS to the Internet using a CLAT
function, without a DNS64 function.[¶](#section-6-7){.pilcrow}

[]{#name-ds-enterprise-with-clat-ds-}

::: {#enterprise-464xlat}
::: {#section-6-8.1 .artwork .art-text .alignCenter}
    +----------------------------------+
    |       Enterprise Network         |
    | +----------+        +----------+ |       +----------+
    | |   IPv6   |        |          | |       |   IPv4   |
    | |     +    +--------+  NAT64   | +-------+     +    |
    | |   CLAT   |        |          | |       |   IPv6   |
    | +----------+        +----------+ |       +----------+
    +----------------------------------+
:::

[Figure 14](#figure-14){.selfRef}: [DS Enterprise with CLAT, DS
Internet, without DNS64](#name-ds-enterprise-with-clat-ds-){.selfRef}
:::

Finally, [Figure 15](#enterprise-own-clat){.xref} provides an example of
an IPv6-only provider with a NAT64 function, and a DS enterprise network
by means of their own CLAT function, without a DNS64
function.[¶](#section-6-9){.pilcrow}

[]{#name-ds-enterprise-with-clat-and}

::: {#enterprise-own-clat}
::: {#section-6-10.1 .artwork .art-text .alignCenter}
    +----------------------------------+
    |       Enterprise Network         |
    | +----------+        +----------+ |        +----------+
    | |   IPv6   |        |          | |  IPv6  |          |
    | |     +    +--------+   CLAT   | +--------+   NAT64  |
    | |   IPv4   |        |          | |  only  |          |
    | +----------+        +----------+ |        +----------+
    +----------------------------------+
:::

[Figure 15](#figure-15){.selfRef}: [DS Enterprise with CLAT and
IPv6-Only Access, without
DNS64](#name-ds-enterprise-with-clat-and){.selfRef}
:::
:::

::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

This document does not have new specific security considerations beyond
those already reported by each of the documents cited. For example,
DNS64 \[[RFC6147](#RFC6147){.xref}\] already describes the DNSSEC
issues.[¶](#section-7-1){.pilcrow}

As already described in [Section 4.4](#foreignDNS){.xref}, note that
there may be undesirable interactions, especially if using VPNs or DNS
privacy, which may impact the correct performance of
DNS64/NAT64.[¶](#section-7-2){.pilcrow}

Note that the use of a DNS64 function has privacy considerations that
are equivalent to regular DNS, and they are located in either the
service provider or an external service
provider.[¶](#section-7-3){.pilcrow}
:::

::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-8-1){.pilcrow}
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC1918\]
:   [Rekhter, Y.]{.refAuthor}[, Moskowitz, B.]{.refAuthor}[,
    Karrenberg, D.]{.refAuthor}[, de Groot, G. J.]{.refAuthor}[, and E.
    Lear]{.refAuthor}, [\"Address Allocation for Private
    Internets\"]{.refTitle}, [BCP 5]{.seriesInfo}, [RFC
    1918]{.seriesInfo}, [DOI 10.17487/RFC1918]{.seriesInfo}, February
    1996, \<<https://www.rfc-editor.org/info/rfc1918>\>.

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.

\[RFC5389\]
:   [Rosenberg, J.]{.refAuthor}[, Mahy, R.]{.refAuthor}[,
    Matthews, P.]{.refAuthor}[, and D. Wing]{.refAuthor}, [\"Session
    Traversal Utilities for NAT (STUN)\"]{.refTitle}, [RFC
    5389]{.seriesInfo}, [DOI 10.17487/RFC5389]{.seriesInfo}, October
    2008, \<<https://www.rfc-editor.org/info/rfc5389>\>.

\[RFC5625\]
:   [Bellis, R.]{.refAuthor}, [\"DNS Proxy Implementation
    Guidelines\"]{.refTitle}, [BCP 152]{.seriesInfo}, [RFC
    5625]{.seriesInfo}, [DOI 10.17487/RFC5625]{.seriesInfo}, August
    2009, \<<https://www.rfc-editor.org/info/rfc5625>\>.

\[RFC5766\]
:   [Mahy, R.]{.refAuthor}[, Matthews, P.]{.refAuthor}[, and J.
    Rosenberg]{.refAuthor}, [\"Traversal Using Relays around NAT (TURN):
    Relay Extensions to Session Traversal Utilities for NAT
    (STUN)\"]{.refTitle}, [RFC 5766]{.seriesInfo}, [DOI
    10.17487/RFC5766]{.seriesInfo}, April 2010,
    \<<https://www.rfc-editor.org/info/rfc5766>\>.

\[RFC6052\]
:   [Bao, C.]{.refAuthor}[, Huitema, C.]{.refAuthor}[,
    Bagnulo, M.]{.refAuthor}[, Boucadair, M.]{.refAuthor}[, and X.
    Li]{.refAuthor}, [\"IPv6 Addressing of IPv4/IPv6
    Translators\"]{.refTitle}, [RFC 6052]{.seriesInfo}, [DOI
    10.17487/RFC6052]{.seriesInfo}, October 2010,
    \<<https://www.rfc-editor.org/info/rfc6052>\>.

\[RFC6144\]
:   [Baker, F.]{.refAuthor}[, Li, X.]{.refAuthor}[,
    Bao, C.]{.refAuthor}[, and K. Yin]{.refAuthor}, [\"Framework for
    IPv4/IPv6 Translation\"]{.refTitle}, [RFC 6144]{.seriesInfo}, [DOI
    10.17487/RFC6144]{.seriesInfo}, April 2011,
    \<<https://www.rfc-editor.org/info/rfc6144>\>.

\[RFC6146\]
:   [Bagnulo, M.]{.refAuthor}[, Matthews, P.]{.refAuthor}[, and I. van
    Beijnum]{.refAuthor}, [\"Stateful NAT64: Network Address and
    Protocol Translation from IPv6 Clients to IPv4
    Servers\"]{.refTitle}, [RFC 6146]{.seriesInfo}, [DOI
    10.17487/RFC6146]{.seriesInfo}, April 2011,
    \<<https://www.rfc-editor.org/info/rfc6146>\>.

\[RFC6147\]
:   [Bagnulo, M.]{.refAuthor}[, Sullivan, A.]{.refAuthor}[,
    Matthews, P.]{.refAuthor}[, and I. van Beijnum]{.refAuthor},
    [\"DNS64: DNS Extensions for Network Address Translation from IPv6
    Clients to IPv4 Servers\"]{.refTitle}, [RFC 6147]{.seriesInfo}, [DOI
    10.17487/RFC6147]{.seriesInfo}, April 2011,
    \<<https://www.rfc-editor.org/info/rfc6147>\>.

\[RFC6535\]
:   [Huang, B.]{.refAuthor}[, Deng, H.]{.refAuthor}[, and T.
    Savolainen]{.refAuthor}, [\"Dual-Stack Hosts Using
    \"Bump-in-the-Host\" (BIH)\"]{.refTitle}, [RFC 6535]{.seriesInfo},
    [DOI 10.17487/RFC6535]{.seriesInfo}, February 2012,
    \<<https://www.rfc-editor.org/info/rfc6535>\>.

\[RFC6877\]
:   [Mawatari, M.]{.refAuthor}[, Kawashima, M.]{.refAuthor}[, and C.
    Byrne]{.refAuthor}, [\"464XLAT: Combination of Stateful and
    Stateless Translation\"]{.refTitle}, [RFC 6877]{.seriesInfo}, [DOI
    10.17487/RFC6877]{.seriesInfo}, April 2013,
    \<<https://www.rfc-editor.org/info/rfc6877>\>.

\[RFC6887\]
:   [Wing, D., Ed.]{.refAuthor}[, Cheshire, S.]{.refAuthor}[,
    Boucadair, M.]{.refAuthor}[, Penno, R.]{.refAuthor}[, and P.
    Selkirk]{.refAuthor}, [\"Port Control Protocol (PCP)\"]{.refTitle},
    [RFC 6887]{.seriesInfo}, [DOI 10.17487/RFC6887]{.seriesInfo}, April
    2013, \<<https://www.rfc-editor.org/info/rfc6887>\>.

\[RFC7050\]
:   [Savolainen, T.]{.refAuthor}[, Korhonen, J.]{.refAuthor}[, and D.
    Wing]{.refAuthor}, [\"Discovery of the IPv6 Prefix Used for IPv6
    Address Synthesis\"]{.refTitle}, [RFC 7050]{.seriesInfo}, [DOI
    10.17487/RFC7050]{.seriesInfo}, November 2013,
    \<<https://www.rfc-editor.org/info/rfc7050>\>.

\[RFC7225\]
:   [Boucadair, M.]{.refAuthor}, [\"Discovering NAT64 IPv6 Prefixes
    Using the Port Control Protocol (PCP)\"]{.refTitle}, [RFC
    7225]{.seriesInfo}, [DOI 10.17487/RFC7225]{.seriesInfo}, May 2014,
    \<<https://www.rfc-editor.org/info/rfc7225>\>.

\[RFC7757\]
:   [Anderson, T.]{.refAuthor}[ and A. Leiva Popper]{.refAuthor},
    [\"Explicit Address Mappings for Stateless IP/ICMP
    Translation\"]{.refTitle}, [RFC 7757]{.seriesInfo}, [DOI
    10.17487/RFC7757]{.seriesInfo}, February 2016,
    \<<https://www.rfc-editor.org/info/rfc7757>\>.

\[RFC7915\]
:   [Bao, C.]{.refAuthor}[, Li, X.]{.refAuthor}[,
    Baker, F.]{.refAuthor}[, Anderson, T.]{.refAuthor}[, and F.
    Gont]{.refAuthor}, [\"IP/ICMP Translation Algorithm\"]{.refTitle},
    [RFC 7915]{.seriesInfo}, [DOI 10.17487/RFC7915]{.seriesInfo}, June
    2016, \<<https://www.rfc-editor.org/info/rfc7915>\>.

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.

\[RFC8273\]
:   [Brzozowski, J.]{.refAuthor}[ and G. Van de Velde]{.refAuthor},
    [\"Unique IPv6 Prefix per Host\"]{.refTitle}, [RFC
    8273]{.seriesInfo}, [DOI 10.17487/RFC8273]{.seriesInfo}, December
    2017, \<<https://www.rfc-editor.org/info/rfc8273>\>.

\[RFC8305\]
:   [Schinazi, D.]{.refAuthor}[ and T. Pauly]{.refAuthor}, [\"Happy
    Eyeballs Version 2: Better Connectivity Using
    Concurrency\"]{.refTitle}, [RFC 8305]{.seriesInfo}, [DOI
    10.17487/RFC8305]{.seriesInfo}, December 2017,
    \<<https://www.rfc-editor.org/info/rfc8305>\>.

\[RFC8375\]
:   [Pfister, P.]{.refAuthor}[ and T. Lemon]{.refAuthor}, [\"Special-Use
    Domain \'home.arpa.\'\"]{.refTitle}, [RFC 8375]{.seriesInfo}, [DOI
    10.17487/RFC8375]{.seriesInfo}, May 2018,
    \<<https://www.rfc-editor.org/info/rfc8375>\>.

\[RFC8415\]
:   [Mrugalski, T.]{.refAuthor}[, Siodelski, M.]{.refAuthor}[,
    Volz, B.]{.refAuthor}[, Yourtchenko, A.]{.refAuthor}[,
    Richardson, M.]{.refAuthor}[, Jiang, S.]{.refAuthor}[,
    Lemon, T.]{.refAuthor}[, and T. Winters]{.refAuthor}, [\"Dynamic
    Host Configuration Protocol for IPv6 (DHCPv6)\"]{.refTitle}, [RFC
    8415]{.seriesInfo}, [DOI 10.17487/RFC8415]{.seriesInfo}, November
    2018, \<<https://www.rfc-editor.org/info/rfc8415>\>.

\[RFC8445\]
:   [Keranen, A.]{.refAuthor}[, Holmberg, C.]{.refAuthor}[, and J.
    Rosenberg]{.refAuthor}, [\"Interactive Connectivity Establishment
    (ICE): A Protocol for Network Address Translator (NAT)
    Traversal\"]{.refTitle}, [RFC 8445]{.seriesInfo}, [DOI
    10.17487/RFC8445]{.seriesInfo}, July 2018,
    \<<https://www.rfc-editor.org/info/rfc8445>\>.

\[RFC8484\]
:   [Hoffman, P.]{.refAuthor}[ and P. McManus]{.refAuthor}, [\"DNS
    Queries over HTTPS (DoH)\"]{.refTitle}, [RFC 8484]{.seriesInfo},
    [DOI 10.17487/RFC8484]{.seriesInfo}, October 2018,
    \<<https://www.rfc-editor.org/info/rfc8484>\>.
:::

::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[About-DNS64\]
:   [Linkova, J.]{.refAuthor}, [\"Let\'s talk about IPv6 DNS64 &
    DNSSEC\"]{.refTitle}, June 2016,
    \<<https://blog.apnic.net/2016/06/09/lets-talk-ipv6-dns64-dnssec/>\>.

\[ARCEP\]
:   [ARCEP]{.refAuthor}, [\"Service client des operateurs : les mesures
    de qualite de service\"]{.refTitle}, April 2018,
    \<<https://www.arcep.fr/cartes-et-donnees/nos-publications-chiffrees/service-client-des-operateurs-mesures-de-la-qualite-de-service/service-client-des-operateurs-les-mesures-de-qualite-de-service.html>\>.

\[DHCPv6-OPTIONS\]
:   [Li, L.]{.refAuthor}[, Cui, Y.]{.refAuthor}[, Liu, C.]{.refAuthor}[,
    Wu, J.]{.refAuthor}[, Baker, F.]{.refAuthor}[, and J.
    Palet]{.refAuthor}, [\"DHCPv6 Options for Discovery NAT64
    Prefixes\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft,
    draft-li-intarea-nat64-prefix-dhcp-option-02]{.seriesInfo}, 20 April
    2019,
    \<<https://tools.ietf.org/html/draft-li-intarea-nat64-prefix-dhcp-option-02>\>.

\[DNS-DNSSEC\]
:   [Byrne, C.]{.refAuthor}[ and J. Palet]{.refAuthor}, [\"IPv6-Ready
    DNS/DNSSSEC Infrastructure\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-bp-v6ops-ipv6-ready-dns-dnssec-00]{.seriesInfo}, 10 October
    2018,
    \<<https://tools.ietf.org/html/draft-bp-v6ops-ipv6-ready-dns-dnssec-00>\>.

\[DNS-RPZ\]
:   [Vixie, P.]{.refAuthor}[ and V. Schryver]{.refAuthor}, [\"DNS
    Response Policy Zones (RPZ)\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-vixie-dnsop-dns-rpz-00]{.seriesInfo}, 23 June 2018,
    \<<https://tools.ietf.org/html/draft-vixie-dnsop-dns-rpz-00>\>.

\[DNS64-Benchm\]
:   [Lencse, G.]{.refAuthor}[ and Y. Kadobayashi]{.refAuthor},
    [\"Benchmarking DNS64 Implementations: Theory and
    Practice\"]{.refTitle}, [pp. 61-74, no. 1, vol. 127, Computer
    Communications]{.refContent}, [DOI
    10.1016/j.comcom.2018.05.005]{.seriesInfo}, September 2018,
    \<<https://www.sciencedirect.com/science/article/pii/S0140366418302184?via%3Dihub>\>.

\[DNS64-BM-Meth\]
:   [Lencse, G.]{.refAuthor}[, Georgescu, M.]{.refAuthor}[, and Y.
    Kadobayashi]{.refAuthor}, [\"Benchmarking Methodology for DNS64
    Servers\"]{.refTitle}, [pp. 162-175, no. 1, vol. 109, Computer
    Communications]{.refContent}, [DOI
    10.1016/j.comcom.2017.06.004]{.seriesInfo}, September 2017,
    \<<https://www.sciencedirect.com/science/article/pii/S0140366416305904?via%3Dihub>\>.

\[FCC\]
:   [FCC]{.refAuthor}, [\"Measuring Broadband America Mobile 2013-2018
    Coarsened Data\"]{.refTitle}, December 2018,
    \<<https://www.fcc.gov/reports-research/reports/measuring-broadband-america/measuring-broadband-america-mobile-2013-2018>\>.

\[IPV4ONLY-ARPA\]
:   [Cheshire, S.]{.refAuthor}[ and D. Schinazi]{.refAuthor}, [\"Special
    Use Domain Name \'ipv4only.arpa\'\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-cheshire-sudn-ipv4only-dot-arpa-14]{.seriesInfo}, 3 November
    2018,
    \<<https://tools.ietf.org/html/draft-cheshire-sudn-ipv4only-dot-arpa-14>\>.

\[IPv6-TRANSITION\]
:   [Lencse, G.]{.refAuthor}[, Palet, J.]{.refAuthor}[,
    Howard, L.]{.refAuthor}[, Patterson, R.]{.refAuthor}[, and I.
    Farrer]{.refAuthor}, [\"Pros and Cons of IPv6 Transition
    Technologies for IPv4aaS\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-lmhp-v6ops-transition-comparison-03]{.seriesInfo}, 6 July
    2019,
    \<<https://tools.ietf.org/html/draft-lmhp-v6ops-transition-comparison-03>\>.

\[ISOC\]
:   [ISOC]{.refAuthor}, [\"State of IPv6 Deployment 2018\"]{.refTitle},
    June 2018,
    \<<https://www.internetsociety.org/resources/2018/state-of-ipv6-deployment-2018/>\>.

\[OPT-464XLAT\]
:   [Palet, J.]{.refAuthor}[ and A. D\'Egidio]{.refAuthor}, [\"464XLAT
    Optimization\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft,
    draft-palet-v6ops-464xlat-opt-cdn-caches-03]{.seriesInfo}, 8 July
    2019,
    \<<https://tools.ietf.org/html/draft-palet-v6ops-464xlat-opt-cdn-caches-03>\>.

\[PREF64\]
:   [Colitti, L.]{.refAuthor}[ and J. Linkova]{.refAuthor},
    [\"Discovering PREF64 in Router Advertisements\"]{.refTitle}, [Work
    in Progress]{.refContent}, [Internet-Draft,
    draft-ietf-6man-ra-pref64-06]{.seriesInfo}, 3 October 2019,
    \<<https://tools.ietf.org/html/draft-ietf-6man-ra-pref64-06>\>.

\[QUIC-CONNECTIONS\]
:   [Huitema, C.]{.refAuthor}[, Shore, M.]{.refAuthor}[,
    Mankin, A.]{.refAuthor}[, Dickinson, S.]{.refAuthor}[, and J.
    Iyengar]{.refAuthor}, [\"Specification of DNS over Dedicated QUIC
    Connections\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft, draft-huitema-quic-dnsoquic-07]{.seriesInfo}, 7
    September 2019,
    \<<https://tools.ietf.org/html/draft-huitema-quic-dnsoquic-07>\>.

\[RFC6889\]
:   [Penno, R.]{.refAuthor}[, Saxena, T.]{.refAuthor}[,
    Boucadair, M.]{.refAuthor}[, and S. Sivakumar]{.refAuthor},
    [\"Analysis of Stateful 64 Translation\"]{.refTitle}, [RFC
    6889]{.seriesInfo}, [DOI 10.17487/RFC6889]{.seriesInfo}, April 2013,
    \<<https://www.rfc-editor.org/info/rfc6889>\>.

\[RFC6950\]
:   [Peterson, J.]{.refAuthor}[, Kolkman, O.]{.refAuthor}[,
    Tschofenig, H.]{.refAuthor}[, and B. Aboba]{.refAuthor},
    [\"Architectural Considerations on Application Features in the
    DNS\"]{.refTitle}, [RFC 6950]{.seriesInfo}, [DOI
    10.17487/RFC6950]{.seriesInfo}, October 2013,
    \<<https://www.rfc-editor.org/info/rfc6950>\>.

\[RFC7051\]
:   [Korhonen, J., Ed.]{.refAuthor}[ and T. Savolainen,
    Ed.]{.refAuthor}, [\"Analysis of Solution Proposals for Hosts to
    Learn NAT64 Prefix\"]{.refTitle}, [RFC 7051]{.seriesInfo}, [DOI
    10.17487/RFC7051]{.seriesInfo}, November 2013,
    \<<https://www.rfc-editor.org/info/rfc7051>\>.

\[RFC7269\]
:   [Chen, G.]{.refAuthor}[, Cao, Z.]{.refAuthor}[,
    Xie, C.]{.refAuthor}[, and D. Binet]{.refAuthor}, [\"NAT64
    Deployment Options and Experience\"]{.refTitle}, [RFC
    7269]{.seriesInfo}, [DOI 10.17487/RFC7269]{.seriesInfo}, June 2014,
    \<<https://www.rfc-editor.org/info/rfc7269>\>.

\[RFC7755\]
:   [Anderson, T.]{.refAuthor}, [\"SIIT-DC: Stateless IP/ICMP
    Translation for IPv6 Data Center Environments\"]{.refTitle}, [RFC
    7755]{.seriesInfo}, [DOI 10.17487/RFC7755]{.seriesInfo}, February
    2016, \<<https://www.rfc-editor.org/info/rfc7755>\>.

\[RFC7756\]
:   [Anderson, T.]{.refAuthor}[ and S. Steffann]{.refAuthor},
    [\"Stateless IP/ICMP Translation for IPv6 Internet Data Center
    Environments (SIIT-DC): Dual Translation Mode\"]{.refTitle}, [RFC
    7756]{.seriesInfo}, [DOI 10.17487/RFC7756]{.seriesInfo}, February
    2016, \<<https://www.rfc-editor.org/info/rfc7756>\>.

\[RFC7849\]
:   [Binet, D.]{.refAuthor}[, Boucadair, M.]{.refAuthor}[,
    Vizdal, A.]{.refAuthor}[, Chen, G.]{.refAuthor}[,
    Heatley, N.]{.refAuthor}[, Chandler, R.]{.refAuthor}[,
    Michaud, D.]{.refAuthor}[, Lopez, D.]{.refAuthor}[, and W.
    Haeffner]{.refAuthor}, [\"An IPv6 Profile for 3GPP Mobile
    Devices\"]{.refTitle}, [RFC 7849]{.seriesInfo}, [DOI
    10.17487/RFC7849]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7849>\>.

\[RFC7858\]
:   [Hu, Z.]{.refAuthor}[, Zhu, L.]{.refAuthor}[,
    Heidemann, J.]{.refAuthor}[, Mankin, A.]{.refAuthor}[,
    Wessels, D.]{.refAuthor}[, and P. Hoffman]{.refAuthor},
    [\"Specification for DNS over Transport Layer Security
    (TLS)\"]{.refTitle}, [RFC 7858]{.seriesInfo}, [DOI
    10.17487/RFC7858]{.seriesInfo}, May 2016,
    \<<https://www.rfc-editor.org/info/rfc7858>\>.

\[RFC8094\]
:   [Reddy, T.]{.refAuthor}[, Wing, D.]{.refAuthor}[, and P.
    Patil]{.refAuthor}, [\"DNS over Datagram Transport Layer Security
    (DTLS)\"]{.refTitle}, [RFC 8094]{.seriesInfo}, [DOI
    10.17487/RFC8094]{.seriesInfo}, February 2017,
    \<<https://www.rfc-editor.org/info/rfc8094>\>.

\[RFC8219\]
:   [Georgescu, M.]{.refAuthor}[, Pislaru, L.]{.refAuthor}[, and G.
    Lencse]{.refAuthor}, [\"Benchmarking Methodology for IPv6 Transition
    Technologies\"]{.refTitle}, [RFC 8219]{.seriesInfo}, [DOI
    10.17487/RFC8219]{.seriesInfo}, August 2017,
    \<<https://www.rfc-editor.org/info/rfc8219>\>.

\[RFC8585\]
:   [Palet Martinez, J.]{.refAuthor}[, Liu, H. M.-H.]{.refAuthor}[,
    and M. Kawashima]{.refAuthor}, [\"Requirements for IPv6 Customer
    Edge Routers to Support IPv4-as-a-Service\"]{.refTitle}, [RFC
    8585]{.seriesInfo}, [DOI 10.17487/RFC8585]{.seriesInfo}, May 2019,
    \<<https://www.rfc-editor.org/info/rfc8585>\>.

\[RIPE-690\]
:   [RIPE]{.refAuthor}, [\"Best Current Operational Practice for
    Operators: IPv6 prefix assignment for end-users - persistent vs
    non-persistent, and what size to choose\"]{.refTitle}, October 2017,
    \<<https://www.ripe.net/publications/docs/ripe-690>\>.

\[Threat-DNS64\]
:   [Lencse, G.]{.refAuthor}[ and Y. Kadobayashi]{.refAuthor},
    [\"Methodology for the identification of potential security issues
    of different IPv6 transition technologies: Threat analysis of DNS64
    and stateful NAT64\"]{.refTitle}, [pp. 397-411, no. 1, vol. 77,
    Computers & Security]{.refContent}, [DOI
    10.1016/j.cose.2018.04.012]{.seriesInfo}, August 2018,
    \<<https://www.sciencedirect.com/science/article/pii/S0167404818303663?via%3Dihub>\>.
:::
:::

::: {#AppendixA}
::: {#section-appendix.a .section}
## [Appendix A.](#section-appendix.a){.section-number .selfRef} [Example of Broadband Deployment with 464XLAT](#name-example-of-broadband-deploy){.section-name .selfRef} {#name-example-of-broadband-deploy}

This section summarizes how an operator may deploy an IPv6-only network
for residential/SOHO customers, supporting IPv6 inbound connections, and
IPv4-as-a-Service (IPv4aaS) by using
464XLAT.[¶](#section-appendix.a-1){.pilcrow}

Note that an equivalent setup could also be provided for enterprise
customers. If they need to support IPv4 inbound connections, several
mechanisms, depending on specific customer needs, allow it; see
\[[RFC7757](#RFC7757){.xref}\].[¶](#section-appendix.a-2){.pilcrow}

Conceptually, most of the operator network could be IPv6 only
(represented in the next figures as \"IPv6-only flow\"), or even if part
of the network is actually dual stack, only IPv6 access is available for
some customers (i.e., residential customers). This part of the network
connects the IPv6-only subscribers (by means of IPv6-only access links)
to the IPv6 upstream providers and to the IPv4-Internet by means of
NAT64 (PLAT in the 464XLAT
terminology).[¶](#section-appendix.a-3){.pilcrow}

The traffic flow from and back to the CE to services available in the
IPv6 Internet (or even dual-stack remote services, when IPv6 is being
used) is purely native IPv6 traffic, so there are no special
considerations about it.[¶](#section-appendix.a-4){.pilcrow}

From the DNS perspective, there are remote networks with IPv4 only that
will typically have only IPv4 DNS (DNS/IPv4) or will at least be seen as
IPv4 DNS from the CE perspective. On the operator side, the DNS, as seen
from the CE, is only IPv6 (DNS/IPv6), and it also has a DNS64
function.[¶](#section-appendix.a-5){.pilcrow}

On the customer LANs side, there is actually one network, which of
course could be split into different segments. The most common setup
will be dual-stack segments, using global IPv6 addresses and
\[[RFC1918](#RFC1918){.xref}\] for IPv4, in any regular residential /
Small Office, Home Office (SOHO) IPv4 network. In the figure below, it
is represented as tree segments to show that the three possible setups
are valid (IPv6 only, IPv4 only, and dual
stack).[¶](#section-appendix.a-6){.pilcrow}

[]{#name-ce-setup-with-built-in-clat}

::: {#clat-CE-DNS64}
::: {#section-appendix.a-7.1 .artwork .art-text .alignCenter}
        .-----.    +-------+     .-----.                   .-----.
       / IPv6- \   |       |    /       \                 /       \
      (  only   )--+ Res./ |   /  IPv6-  \    .-----.    /  IPv4-  \
       \ LANs  /   | SOHO  +--(   only    )--( NAT64 )--(   only    )
        `-----'    |       |   \  flow   /    `-----'    \  flow   /
        .-----.    | IPv6  |    \       /                 \       /
       / IPv4- \   |  CE   |     `--+--'                   `--+--'
      (  only   )--+ with  |        |                         |
       \ LANs  /   | CLAT  |    +---+----+                +---+----+
        `-----'    |       |    |DNS/IPv6|                |DNS/IPv4|
        .-----.    +---+---+    |  with  |                +--------+
       / Dual- \       |        | DNS64  |
      (  Stack  )------|        +--------+
       \ LANs  /
        `-----' 
:::

[Figure 16](#figure-16){.selfRef}: [CE Setup with Built-In CLAT, with
DNS64](#name-ce-setup-with-built-in-clat){.selfRef}
:::

In addition to the regular CE setup, which typically will be
access-technology dependent, the steps for the CLAT function
configuration can be summarized as
follows:[¶](#section-appendix.a-8){.pilcrow}

1.  [Discovery of the PLAT (NAT64) prefix: It may be done using
    \[[RFC7050](#RFC7050){.xref}\], \[[RFC7225](#RFC7225){.xref}\] in
    those networks where PCP is supported, or other alternatives that
    may be available in the future, such as Router Advertising
    \[[PREF64](#I-D.ietf-6man-ra-pref64){.xref}\] or DHCPv6 options
    \[[DHCPv6-OPTIONS](#I-D.li-intarea-nat64-prefix-dhcp-option){.xref}\].[¶](#section-appendix.a-9.1){.pilcrow}]{#section-appendix.a-9.1}
2.  [If the CLAT function allows stateless NAT46 translation, a /64 from
    the pool typically provided to the CE by means of DHCPv6-PD
    \[[RFC8415](#RFC8415){.xref}\] needs to be set aside for that
    translation. Otherwise, the CLAT is forced to perform an
    intermediate stateful NAT44 before the stateless NAT46, as described
    in [Section
    4.8](#CLAT){.xref}.[¶](#section-appendix.a-9.2){.pilcrow}]{#section-appendix.a-9.2}

A more detailed configuration approach is described in
\[[RFC8585](#RFC8585){.xref}\].[¶](#section-appendix.a-10){.pilcrow}

The operator network needs to ensure that the correct responses are
provided for the discovery of the PLAT prefix. It is highly recommended
that \[[RIPE-690](#RIPE-690){.xref}\] be followed in order to ensure
that multiple /64s are available, including the one needed for the NAT46
stateless translation.[¶](#section-appendix.a-11){.pilcrow}

The operator needs to understand other issues, as described throughout
this document, in order to make relevant decisions. For example, if
several NAT64 functions are needed in the context of scalability / high
availability, an NSP should be considered (see [Section
4.5](#WKP-NSP){.xref}).[¶](#section-appendix.a-12){.pilcrow}

More complex scenarios are possible, for example, if a network offers
multiple NAT64 prefixes, destination-based NAT64 prefixes,
etc.[¶](#section-appendix.a-13){.pilcrow}

If the operator decides not to provide a DNS64 function, then this setup
will be the same as the following figure. This will also be the setup
that will be seen from the perspective of the CE, if a foreign DNS is
used and consequently is not the operator-provided DNS64
function.[¶](#section-appendix.a-14){.pilcrow}

[]{#name-ce-setup-with-built-in-clat-}

::: {#clat-CE}
::: {#section-appendix.a-15.1 .artwork .art-text .alignCenter}
        .-----.    +-------+     .-----.                   .-----.
       / IPv6- \   |       |    /       \                 /       \
      (  only   )--+ Res./ |   /  IPv6-  \    .-----.    /  IPv4-  \
       \ LANs  /   | SOHO  +--(   only    )--( NAT64 )--(   only    )
        `-----'    |       |   \  flow   /    `-----'    \  flow   /
        .-----.    | IPv6  |    \       /                 \       /
       / IPv4- \   |  CE   |     `--+--'                   `--+--'
      (  only   )--+ with  |        |                         |
       \ LANs  /   | CLAT  |    +---+----+                +---+----+
        `-----'    |       |    |DNS/IPv6|                |DNS/IPv4|
        .-----.    +---+---+    +--------+                +--------+
       / Dual- \       |
      (  Stack  )------|
       \ LANs  /
        `-----'
:::

[Figure 17](#figure-17){.selfRef}: [CE Setup with Built-In CLAT, without
DNS64](#name-ce-setup-with-built-in-clat-){.selfRef}
:::

In this case, the discovery of the PLAT prefix needs to be arranged as
indicated in [Section
4.1.1](#nodns64){.xref}.[¶](#section-appendix.a-16){.pilcrow}

In addition, if the CE doesn\'t have a built-in CLAT function, the
customer can choose to set up the IPv6 operator-managed CE in bridge
mode (and optionally use an external router). Or, for example, if there
is an access technology that requires some kind of media converter
(Optical Network Termination (ONT) for fiber to the home (FTTH), Cable
Modem for Data-Over-Cable Service Interface Specification (DOCSIS),
etc.), the complete setup will look like [Figure
18](#clat-bridge){.xref}. Obviously, there will be some intermediate
configuration steps for the bridge, depending on the specific access
technology/protocols, which should not modify the steps already
described in the previous cases for the CLAT function
configuration.[¶](#section-appendix.a-17){.pilcrow}

[]{#name-ce-setup-with-bridged-clat-}

::: {#clat-bridge}
::: {#section-appendix.a-18.1 .artwork .art-text .alignCenter}
                   +-------+     .-----.                   .-----.
                   |       |    /       \                 /       \
                   | Res./ |   /  IPv6-  \    .-----.    /  IPv4-  \
                   | SOHO  +--(   only    )--( NAT64 )--(   only    )
                   |       |   \  flow   /    `-----'    \  flow   /
                   | IPv6  |    \       /                 \       /
                   |  CE   |     `--+--'                   `--+--'
                   | Bridge|        |                         |
                   |       |    +---+----+                +---+----+
                   |       |    |DNS/IPv6|                |DNS/IPv4|
                   +---+---+    +--------+                +--------+
                       |
        .-----.    +---+---+
       / IPv6- \   |       |
      (  only   )--+ IPv6  |
       \ LANs  /   | Router|
        `-----'    |       |
        .-----.    | with  |
       / IPv4- \   | CLAT  |
      (  only   )--+       |
       \ LANs  /   |       |
        `-----'    |       |
        .-----.    +---+---+
       / Dual- \       |
      (  Stack  )------|
       \ LANs  /
        `-----'
:::

[Figure 18](#figure-18){.selfRef}: [CE Setup with Bridged CLAT, without
DNS64](#name-ce-setup-with-bridged-clat-){.selfRef}
:::

Several routers (i.e., the operator-provided CE and the downstream
user-provided router) that enable simultaneous routing and/or CLAT
should be avoided to ensure that multiple NAT44 and NAT46 levels are not
used and that the operation of multiple IPv6 subnets is correct. In
those cases, the use of the Home Networking Control Protocol (HNCP)
\[[RFC8375](#RFC8375){.xref}\] is
suggested.[¶](#section-appendix.a-19){.pilcrow}

Note that the procedure described here for the CE setup can be
simplified if the CE follows
\[[RFC8585](#RFC8585){.xref}\].[¶](#section-appendix.a-20){.pilcrow}
:::
:::

::: {#section-appendix.b .section}
## [Appendix B.](#section-appendix.b){.section-number .selfRef} [CLAT Implementation](#name-clat-implementation){.section-name .selfRef} {#name-clat-implementation}

In addition to the regular set of features for a CE, a CLAT CE
implementation requires support for:[¶](#section-appendix.b-1){.pilcrow}

-   [\[[RFC7915](#RFC7915){.xref}\] for the NAT46
    function.[¶](#section-appendix.b-2.1){.pilcrow}]{#section-appendix.b-2.1}
-   [\[[RFC7050](#RFC7050){.xref}\] for the PLAT prefix
    discovery.[¶](#section-appendix.b-2.2){.pilcrow}]{#section-appendix.b-2.2}
-   [\[[RFC7225](#RFC7225){.xref}\] for the PLAT prefix discovery if PCP
    is
    supported.[¶](#section-appendix.b-2.3){.pilcrow}]{#section-appendix.b-2.3}
-   [\[[PREF64](#I-D.ietf-6man-ra-pref64){.xref}\] for the PLAT prefix
    discovery by means of Router
    Advertising.[¶](#section-appendix.b-2.4){.pilcrow}]{#section-appendix.b-2.4}
-   [\[[DHCPv6-OPTIONS](#I-D.li-intarea-nat64-prefix-dhcp-option){.xref}\]
    for the PLAT prefix discovery by means of
    DHCP.[¶](#section-appendix.b-2.5){.pilcrow}]{#section-appendix.b-2.5}
-   [If stateless NAT46 is supported, a mechanism to ensure that
    multiple /64 are available, such as DHCPv6-PD
    \[[RFC8415](#RFC8415){.xref}\], must be
    used.[¶](#section-appendix.b-2.6){.pilcrow}]{#section-appendix.b-2.6}

There are several Open Source implementations of CLAT, such
as:[¶](#section-appendix.b-3){.pilcrow}

-   [Android:
    <https://github.com/ddrown/android_external_android-clat>[¶](#section-appendix.b-4.1){.pilcrow}]{#section-appendix.b-4.1}
-   [Jool:
    <https://www.jool.mx>[¶](#section-appendix.b-4.2){.pilcrow}]{#section-appendix.b-4.2}
-   [Linux:
    <https://github.com/toreanderson/clatd>[¶](#section-appendix.b-4.3){.pilcrow}]{#section-appendix.b-4.3}
-   [OpenWRT:
    <https://git.openwrt.org/?p=openwrt%2Fopenwrt.git&a=search&h=refs%2Ftags%2Fv19.07.0-rc1&st=commit&s=464xlat>[¶](#section-appendix.b-4.4){.pilcrow}]{#section-appendix.b-4.4}
-   [VPP:
    <https://git.fd.io/vpp/tree/src/plugins/nat>[¶](#section-appendix.b-4.5){.pilcrow}]{#section-appendix.b-4.5}
:::

::: {#section-appendix.c .section}
## [Appendix C.](#section-appendix.c){.section-number .selfRef} [Benchmarking](#name-benchmarking){.section-name .selfRef} {#name-benchmarking}

A benchmarking methodology for IPv6 transition technologies has been
defined in \[[RFC8219](#RFC8219){.xref}\]. NAT64 and 464XLAT are
addressed among the single- and double-translation technologies,
respectively. DNS64 is addressed in Section
[9](https://www.rfc-editor.org/rfc/rfc8219#section-9){.relref}, and the
methodology is elaborated in \[[DNS64-BM-Meth](#DNS64-BM-Meth){.xref}\]
of that document.[¶](#section-appendix.c-1){.pilcrow}

Several documents provide references to benchmarking results, for
example, for DNS64
\[[DNS64-Benchm](#DNS64-Benchm){.xref}\].[¶](#section-appendix.c-2){.pilcrow}
:::

::: {#section-appendix.d .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The author would like to acknowledge the inputs of Gabor Lencse, Andrew
Sullivan, Lee Howard, Barbara Stark, Fred Baker, Mohamed Boucadair,
Alejandro D\'Egidio, Dan Wing, Mikael Abrahamsson, and Eric
Vyncke.[¶](#section-appendix.d-1){.pilcrow}

Conversations with Marcelo Bagnulo, one of the coauthors of NAT64 and
DNS64, and email correspondence via the IETF mailing lists with Mark
Andrews have been very useful for this
work.[¶](#section-appendix.d-2){.pilcrow}

Work on this document was inspired by Christian Huitema, who suggested
that DNS64 should never be used when deploying CLAT in the IETF
network.[¶](#section-appendix.d-3){.pilcrow}
:::

::: {#authors-addresses}
::: {#section-appendix.e .section}
## [Author\'s Address](#name-authors-address){.section-name .selfRef} {#name-authors-address}

::: {.left dir="auto"}
[Jordi Palet Martinez]{.fn .nameRole}
:::

::: {.left dir="auto"}
[The IPv6 Company]{.org}
:::

::: {.left dir="auto"}
[Molino de la Navata, 75]{.street-address}
:::

::: {.left dir="auto"}
[28420]{.postal-code} [La Navata - Galapagar]{.locality}
[Madrid]{.region}
:::

::: {.left dir="auto"}
[Spain]{.country-name}
:::

::: email
Email: <jordi.palet@theipv6company.com>
:::

::: url
URI: <http://www.theipv6company.com/>
:::
:::
:::
