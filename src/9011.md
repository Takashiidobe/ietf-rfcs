  RFC 9011           SCHC over LoRaWAN   April 2021
  ------------------ ------------------- ------------
  Gimenez & Petrov   Standards Track     \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9011](https://www.rfc-editor.org/rfc/rfc9011){.eref}

Category:
:   Standards Track

Published:
:   April 2021

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    O. Gimenez, [Ed.]{.editor}
    :::

    ::: org
    Semtech
    :::
    :::

    ::: author
    ::: author-name
    I. Petrov, [Ed.]{.editor}
    :::

    ::: org
    Acklio
    :::
    :::
:::

# RFC 9011 {#rfcnum}

# Static Context Header Compression and Fragmentation (SCHC) over LoRaWAN {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

The Static Context Header Compression and fragmentation (SCHC)
specification (RFC 8724) describes generic header compression and
fragmentation techniques for Low-Power Wide Area Network (LPWAN)
technologies. SCHC is a generic mechanism designed for great flexibility
so that it can be adapted for any of the LPWAN
technologies.[¶](#section-abstract-1){.pilcrow}

This document defines a profile of SCHC (RFC 8724) for use in LoRaWAN
networks and provides elements such as efficient parameterization and
modes of operation.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9011>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2021 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Terminology](#name-terminology){.xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [SCHC Overview](#name-schc-overview){.xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [LoRaWAN
    Architecture](#name-lorawan-architecture){.xref}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [Device Classes (A, B, C) and
        Interactions](#name-device-classes-a-b-c-and-in){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [Device
        Addressing](#name-device-addressing){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [General Frame
        Types](#name-general-frame-types){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.xref}.  [LoRaWAN MAC
        Frames](#name-lorawan-mac-frames){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.5}
        [4.5](#section-4.5){.xref}.  [LoRaWAN
        FPort](#name-lorawan-fport){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.6}
        [4.6](#section-4.6){.xref}.  [LoRaWAN Empty
        Frame](#name-lorawan-empty-frame){.xref}
        :::

    -   ::: {#section-toc.1-1.4.2.7}
        [4.7](#section-4.7){.xref}.  [Unicast and Multicast
        Technology](#name-unicast-and-multicast-techn){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [SCHC over
    LoRaWAN](#name-schc-over-lorawan){.xref}

    -   ::: {#section-toc.1-1.5.2.1}
        [5.1](#section-5.1){.xref}.  [LoRaWAN FPort and
        RuleID](#name-lorawan-fport-and-ruleid){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.2}
        [5.2](#section-5.2){.xref}.  [RuleID
        Management](#name-ruleid-management){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.3}
        [5.3](#section-5.3){.xref}.  [Interface IDentifier (IID)
        Computation](#name-interface-identifier-iid-co){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.4}
        [5.4](#section-5.4){.xref}.  [Padding](#name-padding){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.5}
        [5.5](#section-5.5){.xref}.  [Decompression](#name-decompression){.xref}
        :::

    -   ::: {#section-toc.1-1.5.2.6}
        [5.6](#section-5.6){.xref}.  [Fragmentation](#name-fragmentation){.xref}

        -   ::: {#section-toc.1-1.5.2.6.2.1}
            [5.6.1](#section-5.6.1){.xref}.  [DTag](#name-dtag){.xref}
            :::

        -   ::: {#section-toc.1-1.5.2.6.2.2}
            [5.6.2](#section-5.6.2){.xref}.  [Uplink Fragmentation: From
            Device to SCHC
            Gateway](#name-uplink-fragmentation-from-d){.xref}
            :::

        -   ::: {#section-toc.1-1.5.2.6.2.3}
            [5.6.3](#section-5.6.3){.xref}.  [Downlink Fragmentation:
            From SCHC Gateway to
            Device](#name-downlink-fragmentation-from){.xref}
            :::
        :::

    -   ::: {#section-toc.1-1.5.2.7}
        [5.7](#section-5.7){.xref}.  [SCHC Fragment
        Format](#name-schc-fragment-format){.xref}

        -   ::: {#section-toc.1-1.5.2.7.2.1}
            [5.7.1](#section-5.7.1){.xref}.  [All-0 SCHC
            Fragment](#name-all-0-schc-fragment){.xref}
            :::

        -   ::: {#section-toc.1-1.5.2.7.2.2}
            [5.7.2](#section-5.7.2){.xref}.  [All-1 SCHC
            Fragment](#name-all-1-schc-fragment){.xref}
            :::

        -   ::: {#section-toc.1-1.5.2.7.2.3}
            [5.7.3](#section-5.7.3){.xref}.  [Delay after Each LoRaWAN
            Frame to Respect Local
            Regulation](#name-delay-after-each-lorawan-fr){.xref}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [References](#name-references){.xref}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Normative
        References](#name-normative-references){.xref}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [Informative
        References](#name-informative-references){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [Appendix
    A](#section-appendix.a){.xref}.  [Examples](#name-examples){.xref}

    -   ::: {#section-toc.1-1.9.2.1}
        [A.1](#section-a.1){.xref}.  [Uplink - Compression Example - No
        Fragmentation](#name-uplink-compression-example-){.xref}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [A.2](#section-a.2){.xref}.  [Uplink - Compression and
        Fragmentation Example](#name-uplink-compression-and-frag){.xref}
        :::

    -   ::: {#section-toc.1-1.9.2.3}
        [A.3](#section-a.3){.xref}.  [Downlink](#name-downlink){.xref}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [](#section-appendix.b){.xref}[Acknowledgements](#name-acknowledgements){.xref}
    :::

-   ::: {#section-toc.1-1.11}
    [](#section-appendix.c){.xref}[Contributors](#name-contributors){.xref}
    :::

-   ::: {#section-toc.1-1.12}
    [](#section-appendix.d){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}
    :::
:::
:::

::: {#Introduction}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

The SCHC specification \[[RFC8724](#RFC8724){.xref}\] describes generic
header compression and fragmentation techniques that can be used on all
Low-Power Wide Area Network (LPWAN) technologies defined in
\[[RFC8376](#RFC8376){.xref}\]. Even though those technologies share a
great number of common features like star-oriented topologies, network
architecture, devices with communications that are mostly quite
predictable, etc., they do have some slight differences with respect to
payload sizes, reactiveness, etc.[¶](#section-1-1){.pilcrow}

SCHC provides a generic framework that enables those devices to
communicate on IP networks. However, for efficient performance, some
parameters and modes of operation need to be set appropriately for each
of the LPWAN technologies.[¶](#section-1-2){.pilcrow}

This document describes the parameters and modes of operation when SCHC
is used over LoRaWAN networks. The LoRaWAN protocol is specified by the
LoRa Alliance in
\[[LORAWAN-SPEC](#LORAWAN-SPEC){.xref}\].[¶](#section-1-3){.pilcrow}
:::
:::

::: {#terminology}
::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}

This section defines the terminology and abbreviations used in this
document. For all other definitions, please look up the SCHC
specification \[[RFC8724](#RFC8724){.xref}\].[¶](#section-2-2){.pilcrow}

Note: The SCHC acronym is pronounced like \"sheek\" in English (or
\"chic\" in French). Therefore, this document writes \"a SCHC Packet\"
instead of \"an SCHC Packet\".[¶](#section-2-3.1){.pilcrow}

[]{.break}

AppKey:
:   Application Key. An AES-128 root key specific to each
    device.[¶](#section-2-4.2){.pilcrow}
:   

AppSKey:
:   Application Session Key. An AES-128 key derived from the AppKey for
    each new session. It is used to encrypt the payload field of a
    LoRaWAN applicative frame.[¶](#section-2-4.4){.pilcrow}
:   

DevAddr:

:   A 32-bit non-unique identifier assigned to a device
    either:[¶](#section-2-4.6.1){.pilcrow}

    []{.break}

    Statically:
    :   by the device manufacturer in \"Activation-by-Personalization\"
        mode, or[¶](#section-2-4.6.2.2){.pilcrow}
    :   

    Dynamically:
    :   after a LoRaWAN \"Join Procedure\" by the Network Gateway in
        \"Over-the-Air-Activation\"
        mode.[¶](#section-2-4.6.2.4){.pilcrow}
    :   

:   

DevEUI:
:   Device Extended Unique Identifier, an IEEE EUI-64 identifier used to
    identify the device during the procedure while joining the network
    (Join Procedure). It is assigned by the manufacturer or the device
    owner and provisioned on the Network
    Gateway.[¶](#section-2-4.8){.pilcrow}
:   

Downlink:
:   A LoRaWAN term for a frame transmitted by the network and received
    by the device.[¶](#section-2-4.10){.pilcrow}
:   

EUI:
:   Extended Unique Identifier[¶](#section-2-4.12){.pilcrow}
:   

FRMPayload:
:   Application data in a LoRaWAN frame[¶](#section-2-4.14){.pilcrow}
:   

IID:
:   Interface Identifier[¶](#section-2-4.16){.pilcrow}
:   

LoRaWAN:
:   LoRaWAN is a wireless technology based on Industrial, Scientific,
    and Medical (ISM) radio bands that is used for long-range,
    low-power, low-data-rate applications developed by the LoRa
    Alliance, a membership consortium:
    \<<https://www.lora-alliance.org>\>.[¶](#section-2-4.18){.pilcrow}
:   

MSB:
:   Most Significant Byte[¶](#section-2-4.20){.pilcrow}
:   

NGW:
:   Network Gateway[¶](#section-2-4.22){.pilcrow}
:   

OUI:
:   Organizationally Unique Identifier. IEEE-assigned prefix for
    EUI.[¶](#section-2-4.24){.pilcrow}
:   

RCS:
:   Reassembly Check Sequence. Used to verify the integrity of the
    fragmentation-reassembly process.[¶](#section-2-4.26){.pilcrow}
:   

RGW:
:   Radio Gateway[¶](#section-2-4.28){.pilcrow}
:   

RX:
:   A device\'s reception window.[¶](#section-2-4.30){.pilcrow}
:   

RX1/RX2:
:   LoRaWAN class A devices open two RX windows following an uplink,
    called \"RX1\" and \"RX2\".[¶](#section-2-4.32){.pilcrow}
:   

SCHC C/D:
:   SCHC Compression/Decompression[¶](#section-2-4.34){.pilcrow}
:   

SCHC F/R:
:   SCHC Fragmentation/Reassembly[¶](#section-2-4.36){.pilcrow}
:   

SCHC gateway:
:   The LoRaWAN Application Server that manages translation between an
    IPv6 network and the Network Gateway (LoRaWAN Network
    Server).[¶](#section-2-4.38){.pilcrow}
:   

Tile:
:   A piece of a fragmented packet as described in [Section
    8.2.2.1](https://www.rfc-editor.org/rfc/rfc8724#section-8.2.2.1){.relref}
    of \[[RFC8724](#RFC8724){.xref}\].[¶](#section-2-4.40){.pilcrow}
:   

Uplink:
:   LoRaWAN term for a frame transmitted by the device and received by
    the network.[¶](#section-2-4.42){.pilcrow}
:   
:::
:::

::: {#static-context-header-compression-overview}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [SCHC Overview](#name-schc-overview){.section-name .selfRef} {#name-schc-overview}

This section contains a short overview of SCHC. For a detailed
description, refer to the full specification
\[[RFC8724](#RFC8724){.xref}\].[¶](#section-3-1){.pilcrow}

It defines:[¶](#section-3-2){.pilcrow}

1.  [Compression mechanisms to avoid transporting information known by
    both sender and receiver over the air. Known information is part of
    the \"context\". This component is called the \"SCHC
    Compression/Decompression\" (SCHC
    C/D).[¶](#section-3-3.1){.pilcrow}]{#section-3-3.1}
2.  [Fragmentation mechanisms to allow SCHC Packet transportation on a
    small, and potentially variable, MTU. This component is called the
    \"SCHC Fragmentation/Reassembly\" (SCHC
    F/R).[¶](#section-3-3.2){.pilcrow}]{#section-3-3.2}

Context exchange or pre-provisioning is out of scope of this
document.[¶](#section-3-4){.pilcrow}

[]{#name-architecture}

::: {#Fig-archi}
::: {#section-3-5.1 .artwork .art-text .alignLeft}
        Device                                                App
    +----------------+                                +----+ +----+ +----+
    | App1 App2 App3 |                                |App1| |App2| |App3|
    |                |                                |    | |    | |    |
    |       UDP      |                                |UDP | |UDP | |UDP |
    |      IPv6      |                                |IPv6| |IPv6| |IPv6|
    |                |                                |    | |    | |    |
    |SCHC C/D and F/R|                                |    | |    | |    |
    +--------+-------+                                +----+ +----+ +----+
             |  +---+     +----+    +----+    +----+     .      .      .
             +~ |RGW| === |NGW | == |SCHC| == |SCHC|...... Internet ....
                +---+     +----+    |F/R |    |C/D |
                                    +----+    +----+
    |<- - - - LoRaWAN - - ->|
:::

[Figure 1](#figure-1){.selfRef}:
[Architecture](#name-architecture){.selfRef}
:::

[Figure 1](#Fig-archi){.xref} represents the architecture for
compression/decompression; it is based on the terminology from
\[[RFC8376](#RFC8376){.xref}\]. The device is sending application flows
using IPv6 or IPv6/UDP protocols. These flows might be compressed by a
SCHC C/D to reduce header size, and fragmented by the SCHC F/R. The
resulting information is sent on a Layer 2 (L2) frame to an LPWAN Radio
Gateway (RGW) that forwards the frame to a Network Gateway (NGW). The
NGW sends the data to a SCHC F/R for reassembly, if required, then to a
SCHC C/D for decompression. The SCHC C/D shares the same rules with the
device. The SCHC C/D and SCHC F/R can be located on the NGW or in
another place as long as a communication is established between the NGW
and the SCHC F/R, then SCHC F/R and SCHC C/D. The SCHC C/D and SCHC F/R
in the device and the SCHC gateway [MUST]{.bcp14} share the same set of
rules. After decompression, the packet can be sent on the Internet to
one or several LPWAN Application Servers
(App).[¶](#section-3-6){.pilcrow}

The SCHC C/D and SCHC F/R process is bidirectional, so the same
principles can be applied to the other
direction.[¶](#section-3-7){.pilcrow}

In a LoRaWAN network, the RGW is called a \"Gateway\", the NGW is a
\"Network Server\", and the SCHC C/D and SCHC F/R are one or more
\"Application Servers\". Application servers can be provided by the NGW
or any third-party software. [Figure 1](#Fig-archi){.xref} can be mapped
in LoRaWAN terminology to:[¶](#section-3-8){.pilcrow}

[]{#name-schc-architecture-mapped-to}

::: {#Fig-archi-lorawan}
::: {#section-3-9.1 .artwork .art-text .alignLeft}
       End Device                                              App
    +--------------+                                   +----+ +----+ +----+
    |App1 App2 App3|                                   |App1| |App2| |App3|
    |              |                                   |    | |    | |    |
    |      UDP     |                                   |UDP | |UDP | |UDP |
    |     IPv6     |                                   |IPv6| |IPv6| |IPv6|
    |              |                                   |    | |    | |    |
    |SCHC C/D & F/R|                                   |    | |    | |    |
    +-------+------+                                   +----+ +----+ +----+
            |  +-------+    +-------+    +-----------+    .      .      .
            +~ |Gateway| == |Network| == |Application|..... Internet ....
               +-------+    |server |    |server     |
                            +-------+    | F/R - C/D |
                                         +-----------+
    |<- - - - - LoRaWAN - - - ->|
:::

[Figure 2](#figure-2){.selfRef}: [SCHC Architecture Mapped to
LoRaWAN](#name-schc-architecture-mapped-to){.selfRef}
:::
:::
:::

::: {#lorawan-architecture}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [LoRaWAN Architecture](#name-lorawan-architecture){.section-name .selfRef} {#name-lorawan-architecture}

An overview of the LoRaWAN protocol and architecture
\[[LORAWAN-SPEC](#LORAWAN-SPEC){.xref}\] is described in
\[[RFC8376](#RFC8376){.xref}\]. The mapping between the LPWAN
architecture entities as described in \[[RFC8724](#RFC8724){.xref}\] and
the ones in \[[LORAWAN-SPEC](#LORAWAN-SPEC){.xref}\] is as
follows:[¶](#section-4-1){.pilcrow}

-   [Devices are LoRaWAN End Devices (e.g., sensors, actuators, etc.).
    There can be a very high density of devices per radio gateway
    (LoRaWAN gateway). This entity maps to the LoRaWAN end
    device.[¶](#section-4-2.1){.pilcrow}]{#section-4-2.1}
-   [The RGW is the endpoint of the constrained link. This entity maps
    to the LoRaWAN
    Gateway.[¶](#section-4-2.2){.pilcrow}]{#section-4-2.2}
-   [The NGW is the interconnection node between the Radio Gateway and
    the SCHC gateway (LoRaWAN Application Server). This entity maps to
    the LoRaWAN Network
    Server.[¶](#section-4-2.3){.pilcrow}]{#section-4-2.3}
-   [The SCHC C/D and SCHC F/R are handled by the LoRaWAN Application
    Server.[¶](#section-4-2.4){.pilcrow}]{#section-4-2.4}
-   [The LPWAN-AAA Server is the LoRaWAN Join Server. Its role is to
    manage and deliver security keys in a secure way so that the devices
    root key is never
    exposed.[¶](#section-4-2.5){.pilcrow}]{#section-4-2.5}

[]{#name-lpwan-architecture}

::: {#Fig-LPWANarchi}
::: {#section-4-3.1 .artwork .art-text .alignLeft}
                                             (LPWAN-AAA Server)
        ()   ()   ()       |                      +------+
         ()  () () ()     / \       +---------+   | Join |
        () () () () ()   /   \======|    ^    |===|Server|  +-----------+
         () ()  ()      |           | <--|--> |   +------+  |Application|
        () ()  ()  ()  / \==========|    v    |=============|  Server   |
         ()  ()  ()   /   \         +---------+             +-----------+
        End devices  Gateways     Network Server          (SCHC C/D and F/R)
         (devices)    (RGW)            (NGW)
:::

[Figure 3](#figure-3){.selfRef}: [LPWAN
Architecture](#name-lpwan-architecture){.selfRef}
:::

Note: [Figure 3](#Fig-LPWANarchi){.xref} terms are from LoRaWAN, with
\[[RFC8376](#RFC8376){.xref}\] terminology in
brackets.[¶](#section-4-4.1){.pilcrow}

The SCHC C/D and SCHC F/R are performed on the LoRaWAN end device and
the Application Server (called the SCHC gateway). While the
point-to-point link between the device and the Application Server
constitutes a single IP hop, the ultimate endpoint of the IP
communication may be an Internet node beyond the Application Server. In
other words, the LoRaWAN Application Server (SCHC gateway) acts as the
first-hop IP router for the device. The Application Server and Network
Server may be co-located, which effectively turns the
Network/Application Server into the first-hop IP
router.[¶](#section-4-5){.pilcrow}

::: {#device-classes-a-b-c-and-interactions}
::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [Device Classes (A, B, C) and Interactions](#name-device-classes-a-b-c-and-in){.section-name .selfRef} {#name-device-classes-a-b-c-and-in}

The LoRaWAN Medium Access Control (MAC) layer supports three classes of
devices named A, B, and C. All devices implement Class A, and some
devices may implement Class B or Class C. Class B and Class C are
mutually exclusive.[¶](#section-4.1-1){.pilcrow}

[]{.break}

Class A:
:   Class A is the simplest class of devices. The device is allowed to
    transmit at any time, randomly selecting a communication channel.
    The Network Gateway may reply with a downlink in one of the two
    receive windows immediately following the uplinks. Therefore, the
    Network Gateway cannot initiate a downlink; it has to wait for the
    next uplink from the device to get a downlink opportunity. Class A
    is the lowest power consumption
    class.[¶](#section-4.1-2.2){.pilcrow}
:   

Class B:

:   Class B devices implement all the functionalities of Class A devices
    but also schedule periodic listen windows. Therefore, as opposed to
    Class A devices, Class B devices can receive downlinks that are
    initiated by the Network Gateway and not following an uplink. There
    is a trade-off between the periodicity of those scheduled Class B
    listen windows and the power consumption of the
    device:[¶](#section-4.1-2.4.1){.pilcrow}

    []{.break}

    High periodicity:
    :   Downlinks from the NGW will be sent faster but the device wakes
        up more often and power consumption is
        increased.[¶](#section-4.1-2.4.2.2){.pilcrow}
    :   

    Low periodicity:
    :   Downlinks from the NGW will have higher latency but lower power
        consumption.[¶](#section-4.1-2.4.2.4){.pilcrow}
    :   

:   

Class C:
:   Class C devices implement all the functionalities of Class A devices
    but keep their receiver open whenever they are not transmitting.
    Class C devices can receive downlinks at any time at the expense of
    a higher power consumption. Battery-powered devices can only operate
    in Class C for a limited amount of time (for example, for a firmware
    upgrade over-the-air). Most of the Class C devices are grid powered
    (for example, Smart Plugs).[¶](#section-4.1-2.6){.pilcrow}
:   
:::
:::

::: {#device-addressing}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [Device Addressing](#name-device-addressing){.section-name .selfRef} {#name-device-addressing}

LoRaWAN end devices use a 32-bit network address (DevAddr) to
communicate with the Network Gateway over the air; this address might
not be unique in a LoRaWAN network. Devices using the same DevAddr are
distinguished by the Network Gateway based on the cryptographic
signature appended to every LoRaWAN frame.[¶](#section-4.2-1){.pilcrow}

To communicate with the SCHC gateway, the Network Gateway [MUST]{.bcp14}
identify the devices by a unique 64-bit device identifier called the
\"DevEUI\".[¶](#section-4.2-2){.pilcrow}

The DevEUI is assigned to the device during the manufacturing process by
the device\'s manufacturer. It is built like an Ethernet MAC address by
concatenating the manufacturer\'s IEEE OUI field with a vendor unique
number. For example, a 24-bit OUI is concatenated with a 40-bit serial
number. The Network Gateway translates the DevAddr into a DevEUI in the
uplink direction and reciprocally on the downlink
direction.[¶](#section-4.2-3){.pilcrow}

[]{#name-lorawan-addresses}

::: {#Fig-LoRaWANaddresses}
::: {#section-4.2-4.1 .artwork .art-text .alignLeft}
    +--------+         +---------+        +---------+          +----------+
    | Device | <=====> | Network | <====> | SCHC    | <======> | Internet |
    |        | DevAddr | Gateway | DevEUI | Gateway | IPv6/UDP |          |
    +--------+         +---------+        +---------+          +----------+
:::

[Figure 4](#figure-4){.selfRef}: [LoRaWAN
Addresses](#name-lorawan-addresses){.selfRef}
:::
:::
:::

::: {#general-frame-types}
::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [General Frame Types](#name-general-frame-types){.section-name .selfRef} {#name-general-frame-types}

LoRaWAN implements the possibility to send confirmed or unconfirmed
frames:[¶](#section-4.3-1){.pilcrow}

[]{.break}

Confirmed frame:
:   The sender asks the receiver to acknowledge the
    frame.[¶](#section-4.3-2.2){.pilcrow}
:   

Unconfirmed frame:
:   The sender does not ask the receiver to acknowledge the
    frame.[¶](#section-4.3-2.4){.pilcrow}
:   

As SCHC defines its own acknowledgment mechanisms, SCHC does not require
the use of LoRaWAN Confirmed frames (FType = 0b100 as per
\[[LORAWAN-SPEC](#LORAWAN-SPEC){.xref}\]).[¶](#section-4.3-3){.pilcrow}
:::
:::

::: {#lorawan-mac-frames}
::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [LoRaWAN MAC Frames](#name-lorawan-mac-frames){.section-name .selfRef} {#name-lorawan-mac-frames}

In addition to regular data frames, LoRaWAN implements JoinRequest and
JoinAccept frame types, which are used by a device to join a
network:[¶](#section-4.4-1){.pilcrow}

[]{.break}

JoinRequest:
:   This frame is used by a device to join a network. It contains the
    device\'s unique identifier DevEUI and a random nonce that will be
    used for session key derivation.[¶](#section-4.4-2.2){.pilcrow}
:   

JoinAccept:
:   To onboard a device, the Network Gateway responds to the JoinRequest
    issued by a device with a JoinAccept frame. That frame is encrypted
    with the device\'s AppKey and contains (among other fields) the
    network\'s major settings and a random nonce used to derive the
    session keys.[¶](#section-4.4-2.4){.pilcrow}
:   

Data:
:   This refers to MAC and application data. Application data is
    protected with AES-128 encryption. MAC-related data is AES-128
    encrypted with another key.[¶](#section-4.4-2.6){.pilcrow}
:   
:::
:::

::: {#lorawan-fport}
::: {#section-4.5 .section}
### [4.5.](#section-4.5){.section-number .selfRef} [LoRaWAN FPort](#name-lorawan-fport){.section-name .selfRef} {#name-lorawan-fport}

The LoRaWAN MAC layer features a frame port field in all frames. This
field (FPort) is 8 bits long and the values from 1 to 223 can be used.
It allows LoRaWAN networks and applications to identify
data.[¶](#section-4.5-1){.pilcrow}
:::
:::

::: {#lorawan-empty-frame}
::: {#section-4.6 .section}
### [4.6.](#section-4.6){.section-number .selfRef} [LoRaWAN Empty Frame](#name-lorawan-empty-frame){.section-name .selfRef} {#name-lorawan-empty-frame}

A LoRaWAN empty frame is a LoRaWAN frame without FPort (cf. [Section
5.1](#lorawan-schc-payload){.xref}) and
FRMPayload.[¶](#section-4.6-1){.pilcrow}
:::
:::

::: {#unicast-and-multicast-technology}
::: {#section-4.7 .section}
### [4.7.](#section-4.7){.section-number .selfRef} [Unicast and Multicast Technology](#name-unicast-and-multicast-techn){.section-name .selfRef} {#name-unicast-and-multicast-techn}

LoRaWAN technology supports unicast downlinks but also multicast; a
multicast packet sent over a LoRaWAN radio link can be received by
several devices. It is useful to address many devices with the same
content: either a large binary file (firmware upgrade) or the same
command (e.g., lighting control). As IPv6 is also a multicast
technology, this feature can be used to address a group of
devices.[¶](#section-4.7-1){.pilcrow}

Note 1: IPv6 multicast addresses must be defined as per
\[[RFC4291](#RFC4291){.xref}\]. The LoRaWAN multicast group definition
in a Network Gateway and the relation between those groups and IPv6
groupID are out of scope of this
document.[¶](#section-4.7-2.1){.pilcrow}

Note 2: The LoRa Alliance defined
\[[LORAWAN-REMOTE-MULTICAST-SET](#LORAWAN-REMOTE-MULTICAST-SET){.xref}\]
as the [RECOMMENDED]{.bcp14} way to set up multicast groups on devices
and create a synchronized reception
window.[¶](#section-4.7-3.1){.pilcrow}
:::
:::
:::
:::

::: {#schc-over-lorawan}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [SCHC over LoRaWAN](#name-schc-over-lorawan){.section-name .selfRef} {#name-schc-over-lorawan}

::: {#lorawan-schc-payload}
::: {#section-5.1 .section}
### [5.1.](#section-5.1){.section-number .selfRef} [LoRaWAN FPort and RuleID](#name-lorawan-fport-and-ruleid){.section-name .selfRef} {#name-lorawan-fport-and-ruleid}

The FPort field is part of the SCHC Message, as shown in [Figure
5](#Fig-lorawan-schc-payload){.xref}. The SCHC C/D and the SCHC F/R
[SHALL]{.bcp14} concatenate the FPort field with the LoRaWAN payload to
recompose the SCHC Message.[¶](#section-5.1-1){.pilcrow}

[]{#name-schc-message-in-lorawan}

::: {#Fig-lorawan-schc-payload}
::: {#section-5.1-2.1 .artwork .art-text .alignLeft}
    | FPort | LoRaWAN payload  |
    + ------------------------ +
    |       SCHC Message       |
:::

[Figure 5](#figure-5){.selfRef}: [SCHC Message in
LoRaWAN](#name-schc-message-in-lorawan){.selfRef}
:::

Note: The SCHC Message is any datagram sent by the SCHC C/D or F/R
layers.[¶](#section-5.1-3.1){.pilcrow}

A fragmented datagram with application payload transferred from device
to Network Gateway is called an \"uplink-fragmented datagram\". It uses
an FPort for data uplink and its associated SCHC control downlinks,
named \"FPortUp\" in this document. The other way, a fragmented datagram
with application payload transferred from Network Gateway to device is
called a \"downlink-fragmented datagram\". It uses another FPort for
data downlink and its associated SCHC control uplinks, named
\"FPortDown\" in this document.[¶](#section-5.1-4){.pilcrow}

All RuleIDs can use arbitrary values inside the FPort range allowed by
the LoRaWAN specification \[[LORAWAN-SPEC](#LORAWAN-SPEC){.xref}\] and
[MUST]{.bcp14} be shared by the device and SCHC gateway prior to the
communication with the selected rule. The uplink and downlink
fragmentation FPorts [MUST]{.bcp14} be
different.[¶](#section-5.1-5){.pilcrow}
:::
:::

::: {#rule-id-management}
::: {#section-5.2 .section}
### [5.2.](#section-5.2){.section-number .selfRef} [RuleID Management](#name-ruleid-management){.section-name .selfRef} {#name-ruleid-management}

The RuleID [MUST]{.bcp14} be 8 bits and encoded in the LoRaWAN FPort as
described in [Section 5.1](#lorawan-schc-payload){.xref}. LoRaWAN
supports up to 223 application FPorts in the range \[1..223\] as defined
in Section 4.3.2 of \[[LORAWAN-SPEC](#LORAWAN-SPEC){.xref}\]; it implies
that the RuleID MSB [SHOULD]{.bcp14} be inside this range. An
application can send non-SCHC traffic by using FPort values different
from the ones used for SCHC.[¶](#section-5.2-1){.pilcrow}

In order to improve interoperability, [RECOMMENDED]{.bcp14}
fragmentation RuleID values are:[¶](#section-5.2-2){.pilcrow}

-   [RuleID = 20 (8-bit) for uplink fragmentation, named
    FPortUp.[¶](#section-5.2-3.1){.pilcrow}]{#section-5.2-3.1}
-   [RuleID = 21 (8-bit) for downlink fragmentation, named
    FPortDown.[¶](#section-5.2-3.2){.pilcrow}]{#section-5.2-3.2}
-   [RuleID = 22 (8-bit) for which SCHC compression was not possible
    (i.e., no matching compression Rule was found), as described in
    [Section
    6](https://www.rfc-editor.org/rfc/rfc8724#section-6){.relref} of
    \[[RFC8724](#RFC8724){.xref}\].[¶](#section-5.2-3.3){.pilcrow}]{#section-5.2-3.3}

The FPortUp value [MUST]{.bcp14} be different from the FPortDown value.
The remaining RuleIDs are available for compression. RuleIDs are shared
between uplink and downlink sessions. A RuleID not in the set(s) of
FPortUp or FPortDown means that the fragmentation is not used; thus, on
reception, the SCHC Message [MUST]{.bcp14} be sent to the SCHC C/D
layer.[¶](#section-5.2-4){.pilcrow}

The only uplink frames using the FPortDown port are the fragmentation
SCHC control messages of a downlink-fragmented datagram (for example,
SCHC ACKs). Similarly, the only downlink frames using the FPortUp port
are the fragmentation SCHC control messages of an uplink-fragmented
datagram.[¶](#section-5.2-5){.pilcrow}

An application can have multiple fragmented datagrams between a device
and one or several SCHC gateways. A set of FPort values is
[REQUIRED]{.bcp14} for each SCHC gateway instance the device is required
to communicate with. The application can use additional uplinks or
downlink-fragmented parameters but [SHALL]{.bcp14} implement at least
the parameters defined in this document.[¶](#section-5.2-6){.pilcrow}

The mechanism for context distribution across devices and gateways is
outside the scope of this document.[¶](#section-5.2-7){.pilcrow}
:::
:::

::: {#IID}
::: {#section-5.3 .section}
### [5.3.](#section-5.3){.section-number .selfRef} [Interface IDentifier (IID) Computation](#name-interface-identifier-iid-co){.section-name .selfRef} {#name-interface-identifier-iid-co}

In order to mitigate the risks described in
\[[RFC8064](#RFC8064){.xref}\] and \[[RFC8065](#RFC8065){.xref}\],
implementations [MUST]{.bcp14} implement the following algorithm and
[SHOULD]{.bcp14} use it.[¶](#section-5.3-1){.pilcrow}

1.  [key = LoRaWAN
    AppSKey[¶](#section-5.3-2.1){.pilcrow}]{#section-5.3-2.1}
2.  [cmac = aes128_cmac(key,
    DevEUI)[¶](#section-5.3-2.2){.pilcrow}]{#section-5.3-2.2}
3.  [IID =
    cmac\[0..7\][¶](#section-5.3-2.3){.pilcrow}]{#section-5.3-2.3}

The aes128_cmac algorithm is described in
\[[RFC4493](#RFC4493){.xref}\]. It has been chosen as it is already used
by devices for the LoRaWAN protocol.[¶](#section-5.3-3){.pilcrow}

As AppSKey is renewed each time a device joins or rejoins a LoRaWAN
network, the IID will change over time; this mitigates privacy concerns,
for example, location tracking or correlation over time. Join
periodicity is defined at the application
level.[¶](#section-5.3-4){.pilcrow}

Address-scan risk is mitigated thanks to the entropy added to the IID by
the inclusion of AppSKey.[¶](#section-5.3-5){.pilcrow}

Using this algorithm will also ensure that there is no correlation
between the hardware identifier (DevEUI) and the IID, so an attacker
cannot use the manufacturer OUI to target
devices.[¶](#section-5.3-6){.pilcrow}

Example with:[¶](#section-5.3-7){.pilcrow}

-   [DevEUI:
    0x1122334455667788[¶](#section-5.3-8.1){.pilcrow}]{#section-5.3-8.1}
-   [AppSKey:
    0x00AABBCCDDEEFF00AABBCCDDEEFFAABB[¶](#section-5.3-8.2){.pilcrow}]{#section-5.3-8.2}

[]{#name-example-of-iid-computation}

::: {#Fig-iid-computation-example}
::: {#section-5.3-9.1}
``` sourcecode
1. key: 0x00AABBCCDDEEFF00AABBCCDDEEFFAABB
2. cmac: 0x4E822D9775B2649928F82066AF804FEC
3. IID: 0x4E822D9775B26499
```
:::

[Figure 6](#figure-6){.selfRef}: [Example of IID
Computation](#name-example-of-iid-computation){.selfRef}
:::

There is a small probability of IID collision in a LoRaWAN network. If
this occurs, the IID can be changed by rekeying the device at the L2
level (i.e., triggering a LoRaWAN join). The way the device is rekeyed
is out of scope of this document and left to the
implementation.[¶](#section-5.3-10){.pilcrow}

Note: Implementations also using another IID source [MUST]{.bcp14}
ensure that the same IID is shared between the device and the SCHC
gateway in the compression and decompression of the IPv6 address of the
device.[¶](#section-5.3-11.1){.pilcrow}
:::
:::

::: {#padding}
::: {#section-5.4 .section}
### [5.4.](#section-5.4){.section-number .selfRef} [Padding](#name-padding){.section-name .selfRef} {#name-padding}

All padding bits [MUST]{.bcp14} be 0.[¶](#section-5.4-1){.pilcrow}
:::
:::

::: {#Decomp}
::: {#section-5.5 .section}
### [5.5.](#section-5.5){.section-number .selfRef} [Decompression](#name-decompression){.section-name .selfRef} {#name-decompression}

The SCHC C/D [MUST]{.bcp14} concatenate FPort and LoRaWAN payload to
retrieve the SCHC Packet as per [Section
5.1](#lorawan-schc-payload){.xref}.[¶](#section-5.5-1){.pilcrow}

RuleIDs matching FPortUp and FPortDown are reserved for SCHC
fragmentation.[¶](#section-5.5-2){.pilcrow}
:::
:::

::: {#Frag}
::: {#section-5.6 .section}
### [5.6.](#section-5.6){.section-number .selfRef} [Fragmentation](#name-fragmentation){.section-name .selfRef} {#name-fragmentation}

The L2 Word Size used by LoRaWAN is 1 byte (8 bits). The SCHC
fragmentation over LoRaWAN uses the ACK-on-Error mode for uplink
fragmentation and ACK-Always mode for downlink fragmentation. A LoRaWAN
device cannot support simultaneous interleaved fragmented datagrams in
the same direction (uplink or downlink).[¶](#section-5.6-1){.pilcrow}

The fragmentation parameters are different for uplink- and
downlink-fragmented datagrams and are successively described in the next
sections.[¶](#section-5.6-2){.pilcrow}

::: {#DTag}
::: {#section-5.6.1 .section}
#### [5.6.1.](#section-5.6.1){.section-number .selfRef} [DTag](#name-dtag){.section-name .selfRef} {#name-dtag}

[Section
8.2.4](https://www.rfc-editor.org/rfc/rfc8724#section-8.2.4){.relref} of
\[[RFC8724](#RFC8724){.xref}\] describes the possibility to interleave
several fragmented SCHC datagrams for the same RuleID. This is not used
in the SCHC-over-LoRaWAN profile. A device cannot interleave several
fragmented SCHC datagrams on the same FPort. This field is not used, and
its size is 0.[¶](#section-5.6.1-1){.pilcrow}

Note: The device can still have several parallel fragmented datagrams
with more than one SCHC gateway thanks to distinct sets of FPorts, cf.
[Section
5.2](#rule-id-management){.xref}.[¶](#section-5.6.1-2.1){.pilcrow}
:::
:::

::: {#uplink-fragmentation-from-device-to-schc-gateway}
::: {#section-5.6.2 .section}
#### [5.6.2.](#section-5.6.2){.section-number .selfRef} [Uplink Fragmentation: From Device to SCHC Gateway](#name-uplink-fragmentation-from-d){.section-name .selfRef} {#name-uplink-fragmentation-from-d}

In this case, the device is the fragment transmitter and the SCHC
gateway is the fragment receiver. A single fragmentation rule is
defined. The SCHC F/R [MUST]{.bcp14} concatenate FPort and LoRaWAN
payload to retrieve the SCHC Packet, as per [Section
5.1](#lorawan-schc-payload){.xref}.[¶](#section-5.6.2-1){.pilcrow}

[]{.break}

SCHC fragmentation reliability mode:
:   `ACK-on-Error`.[¶](#section-5.6.2-2.2){.pilcrow}
:   

SCHC header size:
:   2 bytes (the FPort byte + 1 additional
    byte).[¶](#section-5.6.2-2.4){.pilcrow}
:   

RuleID:
:   8 bits stored in the LoRaWAN FPort (cf. [Section
    5.2](#rule-id-management){.xref}).[¶](#section-5.6.2-2.6){.pilcrow}
:   

DTag:
:   Size T = 0 bits, not used (cf. [Section
    5.6.1](#DTag){.xref}).[¶](#section-5.6.2-2.8){.pilcrow}
:   

Window index:
:   4 windows are used, encoded on M = 2
    bits.[¶](#section-5.6.2-2.10){.pilcrow}
:   

FCN:
:   The FCN field is encoded on N = 6 bits, so WINDOW_SIZE = 63 tiles
    are allowed in a window.[¶](#section-5.6.2-2.12){.pilcrow}
:   

Last tile:

:   It can be carried in a Regular SCHC Fragment, alone in an All-1 SCHC
    Fragment, or with any of these two methods. Implementations must
    ensure that:[¶](#section-5.6.2-2.14.1){.pilcrow}

    -   [The sender [MUST]{.bcp14} ascertain that the receiver will not
        receive the last tile through both a Regular SCHC Fragment and
        an All-1 SCHC Fragment during the same
        session.[¶](#section-5.6.2-2.14.2.1){.pilcrow}]{#section-5.6.2-2.14.2.1}
    -   [If the last tile is in an All-1 SCHC Message, the current L2
        MTU [MUST]{.bcp14} be big enough to fit the All-1 header and the
        last
        tile.[¶](#section-5.6.2-2.14.2.2){.pilcrow}]{#section-5.6.2-2.14.2.2}

:   

Penultimate tile:
:   [MUST]{.bcp14} be equal to the regular
    size.[¶](#section-5.6.2-2.16){.pilcrow}
:   

RCS:
:   Use the recommended calculation algorithm in [Section
    8.2.3](https://www.rfc-editor.org/rfc/rfc8724#section-8.2.3){.relref}
    of \[[RFC8724](#RFC8724){.xref}\], Integrity
    Checking.[¶](#section-5.6.2-2.18){.pilcrow}
:   

Tile:
:   Size is 10 bytes.[¶](#section-5.6.2-2.20){.pilcrow}
:   

Retransmission timer:
:   Set by the implementation depending on the application requirements.
    The default [RECOMMENDED]{.bcp14} duration of this timer is 12
    hours; this value is mainly driven by application requirements and
    [MAY]{.bcp14} be changed by the
    application.[¶](#section-5.6.2-2.22){.pilcrow}
:   

Inactivity timer:
:   The SCHC gateway implements an \"inactivity timer\". The default
    [RECOMMENDED]{.bcp14} duration of this timer is 12 hours; this value
    is mainly driven by application requirements and [MAY]{.bcp14} be
    changed by the application.[¶](#section-5.6.2-2.24){.pilcrow}
:   

MAX_ACK_REQUESTS:
:   8\. With this set of parameters, the SCHC Fragment Header is 16
    bits, including FPort; payload overhead will be 8 bits as FPort is
    already a part of LoRaWAN payload. MTU is: 4 windows \* 63 tiles \*
    10 bytes per tile = 2520 bytes.[¶](#section-5.6.2-2.26){.pilcrow}
:   

In addition to the per-rule context parameters specified in
\[[RFC8724](#RFC8724){.xref}\], for uplink rules, an additional context
parameter is added: whether or not to ack after each window. For battery
powered devices, it is [RECOMMENDED]{.bcp14} to use the ACK mechanism at
the end of each window instead of waiting until the end of all
windows:[¶](#section-5.6.2-3){.pilcrow}

-   [The SCHC receiver [SHOULD]{.bcp14} send a SCHC ACK after every
    window even if there is no missing
    tile.[¶](#section-5.6.2-4.1){.pilcrow}]{#section-5.6.2-4.1}
-   [The SCHC sender [SHOULD]{.bcp14} wait for the SCHC ACK from the
    SCHC receiver before sending tiles from the next window. If the SCHC
    ACK is not received, it [SHOULD]{.bcp14} send a SCHC ACK REQ up to
    MAX_ACK_REQUESTS times, as described
    previously.[¶](#section-5.6.2-4.2){.pilcrow}]{#section-5.6.2-4.2}

This will avoid useless uplinks if the device has lost network
coverage.[¶](#section-5.6.2-5){.pilcrow}

For non-battery powered devices, the SCHC receiver [MAY]{.bcp14} also
choose to send a SCHC ACK only at the end of all windows. This will
reduce downlink load on the LoRaWAN network by reducing the number of
downlinks.[¶](#section-5.6.2-6){.pilcrow}

SCHC implementations [MUST]{.bcp14} be compatible with both behaviors,
and this selection is part of the rule
context.[¶](#section-5.6.2-7){.pilcrow}

::: {#regular-fragments}
::: {#section-5.6.2.1 .section}
##### [5.6.2.1.](#section-5.6.2.1){.section-number .selfRef} [Regular Fragments](#name-regular-fragments){.section-name .selfRef} {#name-regular-fragments}

[Figure 7](#Fig-fragmentation-header-long-all0){.xref} is an example of
a regular fragment for all fragments except the last one. SCHC Header
Size is 16 Bits, including the LoRaWAN
FPort.[¶](#section-5.6.2.1-1){.pilcrow}

[]{#name-all-fragments-except-the-la}

::: {#Fig-fragmentation-header-long-all0}
::: {#section-5.6.2.1-2.1 .artwork .art-text .alignLeft}
    | FPort  |  LoRaWAN payload          |
    + ------ + ------------------------- +
    | RuleID |   W    | FCN    | Payload |
    + ------ + ------ + ------ + ------- +
    | 8 bits | 2 bits | 6 bits |         |
:::

[Figure 7](#figure-7){.selfRef}: [All Fragments Except the Last
One.](#name-all-fragments-except-the-la){.selfRef}
:::
:::
:::

::: {#last-fragment-all-1}
::: {#section-5.6.2.2 .section}
##### [5.6.2.2.](#section-5.6.2.2){.section-number .selfRef} [Last Fragment (All-1)](#name-last-fragment-all-1){.section-name .selfRef} {#name-last-fragment-all-1}

Following figures are examples of All-1 messages. [Figure
8](#Fig-fragmentation-header-all1-no-tile){.xref} is without the last
tile, [Figure 9](#Fig-fragmentation-header-all1-last-tile){.xref} is
with the last tile.[¶](#section-5.6.2.2-1){.pilcrow}

[]{#name-all-1-schc-message-without-}

::: {#Fig-fragmentation-header-all1-no-tile}
::: {#section-5.6.2.2-2.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload              |
    + ------ + ---------------------------- +
    | RuleID |   W    | FCN=All-1 |  RCS    |
    + ------ + ------ + --------- + ------- +
    | 8 bits | 2 bits | 6 bits    | 32 bits |
:::

[Figure 8](#figure-8){.selfRef}: [All-1 SCHC Message without Last
Tile](#name-all-1-schc-message-without-){.selfRef}
:::

[]{#name-all-1-schc-message-with-las}

::: {#Fig-fragmentation-header-all1-last-tile}
::: {#section-5.6.2.2-3.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload                                            |
    + ------ + ---------------------------------------------------------- +
    | RuleID |   W    | FCN=All-1 |  RCS    |  Last tile   | Opt. padding |
    + ------ + ------ + --------- + ------- + ------------ + ------------ +
    | 8 bits | 2 bits |  6 bits   | 32 bits | 1 to 80 bits | 0 to 7 bits  |
:::

[Figure 9](#figure-9){.selfRef}: [All-1 SCHC Message with Last
Tile](#name-all-1-schc-message-with-las){.selfRef}
:::
:::
:::

::: {#schc-ack}
::: {#section-5.6.2.3 .section}
##### [5.6.2.3.](#section-5.6.2.3){.section-number .selfRef} [SCHC ACK](#name-schc-ack){.section-name .selfRef} {#name-schc-ack}

[]{#name-schc-ack-format-correct-rcs}

::: {#Fig-frag-header-long-schc-ack-rcs-ok}
::: {#section-5.6.2.3-1.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload           |
    + ------ + --------------------------+
    | RuleID |   W   | C = 1 |  padding  |
    |        |       |       | (b'00000) |
    + ------ + ----- + ----- + --------- +
    | 8 bits | 2 bit | 1 bit |  5 bits   |
:::

[Figure 10](#figure-10){.selfRef}: [SCHC ACK Format - Correct RCS
Check](#name-schc-ack-format-correct-rcs){.selfRef}
:::

[]{#name-schc-ack-format-incorrect-r}

::: {#Fig-frag-header-long-schc-ack-rcs-fail}
::: {#section-5.6.2.3-2.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload                                      |
    + ------ + --------------------------------- + ---------------- +
    | RuleID |   W   | C = 0 | Compressed bitmap | Optional padding |
    |        |       |       |      (C = 0)      |    (b'0...0)     |
    + ------ + ----- + ----- + ----------------- + ---------------- +
    | 8 bits | 2 bit | 1 bit |    5 to 63 bits   |  0, 6, or 7 bits |
:::

[Figure 11](#figure-11){.selfRef}: [SCHC ACK Format - Incorrect RCS
Check](#name-schc-ack-format-incorrect-r){.selfRef}
:::

Note: Because of the bitmap compression mechanism and L2 byte alignment,
only the following discrete values are possible for the compressed
bitmap size: 5, 13, 21, 29, 37, 45, 53, 61, 62, and 63. Bitmaps of 63
bits will require 6 bits of padding.[¶](#section-5.6.2.3-3.1){.pilcrow}
:::
:::

::: {#receiver-abort}
::: {#section-5.6.2.4 .section}
##### [5.6.2.4.](#section-5.6.2.4){.section-number .selfRef} [Receiver-Abort](#name-receiver-abort){.section-name .selfRef} {#name-receiver-abort}

[]{#name-receiver-abort-format}

::: {#Fig-fragmentation-receiver-abort}
::: {#section-5.6.2.4-1.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload                              |
    + ------ + -------------------------------------------- +
    | RuleID | W = b'11 | C = 1 | b'11111 | 0xFF (all 1's)  |
    + ------ + -------- + ------+-------- + ----------------+
    | 8 bits |  2 bits  | 1 bit | 5 bits  | 8 bits          |
                  next L2 Word boundary ->| <-- L2 Word --> |
:::

[Figure 12](#figure-12){.selfRef}: [Receiver-Abort
Format](#name-receiver-abort-format){.selfRef}
:::
:::
:::

::: {#schc-acknowledge-request}
::: {#section-5.6.2.5 .section}
##### [5.6.2.5.](#section-5.6.2.5){.section-number .selfRef} [SCHC Acknowledge Request](#name-schc-acknowledge-request){.section-name .selfRef} {#name-schc-acknowledge-request}

[]{#name-schc-ack-req-format}

::: {#Fig-fragmentation-schc-ack-req}
::: {#section-5.6.2.5-1.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload          |
    +------- +------------------------- +
    | RuleID | W      | FCN = b'000000  |
    + ------ + ------ + --------------- +
    | 8 bits | 2 bits | 6 bits          |
:::

[Figure 13](#figure-13){.selfRef}: [SCHC ACK REQ
Format](#name-schc-ack-req-format){.selfRef}
:::
:::
:::
:::
:::

::: {#downlink-fragmentation-from-schc-gateway-to-device}
::: {#section-5.6.3 .section}
#### [5.6.3.](#section-5.6.3){.section-number .selfRef} [Downlink Fragmentation: From SCHC Gateway to Device](#name-downlink-fragmentation-from){.section-name .selfRef} {#name-downlink-fragmentation-from}

In this case, the device is the fragmentation receiver and the SCHC
gateway is the fragmentation transmitter. The following fields are
common to all devices. The SCHC F/R [MUST]{.bcp14} concatenate FPort and
LoRaWAN payload to retrieve the SCHC Packet as described in [Section
5.1](#lorawan-schc-payload){.xref}.[¶](#section-5.6.3-1){.pilcrow}

[]{.break}

SCHC fragmentation reliability mode:

:   -   [[]{.break}]{#section-5.6.3-2.2.1.1}

        Unicast downlinks:
        :   ACK-Always.[¶](#section-5.6.3-2.2.1.1.1.2){.pilcrow}
        :   

        Multicast downlinks:
        :   No-ACK; reliability has to be ensured by the upper layer.
            This feature is [OPTIONAL]{.bcp14} for the SCHC gateway and
            [REQUIRED]{.bcp14} for the
            device.[¶](#section-5.6.3-2.2.1.1.1.4){.pilcrow}
        :   

:   

RuleID:
:   8 bits stored in the LoRaWAN FPort (cf. [Section
    5.2](#rule-id-management){.xref}).[¶](#section-5.6.3-2.4){.pilcrow}
:   

DTag:
:   Size T = 0 bit, not used (cf. [Section
    5.6.1](#DTag){.xref}).[¶](#section-5.6.3-2.6){.pilcrow}
:   

FCN:
:   The FCN field is encoded on N = 1 bit, so WINDOW_SIZE = 1
    tile.[¶](#section-5.6.3-2.8){.pilcrow}
:   

RCS:
:   Use the recommended calculation algorithm in [Section
    8.2.3](https://www.rfc-editor.org/rfc/rfc8724#section-8.2.3){.relref}
    of \[[RFC8724](#RFC8724){.xref}\], Integrity
    Checking.[¶](#section-5.6.3-2.10){.pilcrow}
:   

Inactivity timer:
:   The default [RECOMMENDED]{.bcp14} duration of this timer is 12
    hours; this value is mainly driven by application requirements and
    [MAY]{.bcp14} be changed by the
    application.[¶](#section-5.6.3-2.12){.pilcrow}
:   

The following parameters apply to ACK-Always (Unicast)
only:[¶](#section-5.6.3-3){.pilcrow}

[]{.break}

Retransmission timer:
:   See [Section
    5.6.3.5](#downlink-retransmission-timer){.xref}.[¶](#section-5.6.3-4.2){.pilcrow}
:   

MAX_ACK_REQUESTS:
:   8.[¶](#section-5.6.3-4.4){.pilcrow}
:   

Window index (unicast only):
:   encoded on M = 1 bit, as per
    \[[RFC8724](#RFC8724){.xref}\].[¶](#section-5.6.3-4.6){.pilcrow}
:   

As only one tile is used, its size can change for each downlink and will
be the currently available MTU.[¶](#section-5.6.3-5){.pilcrow}

Class A devices can only receive during an RX slot, following the
transmission of an uplink. Therefore, the SCHC gateway cannot initiate
communication (e.g., start a new SCHC session). In order to create a
downlink opportunity, it is [RECOMMENDED]{.bcp14} for Class A devices to
send an uplink every 24 hours when no SCHC session is started; this is
application specific and can be disabled. The [RECOMMENDED]{.bcp14}
uplink is a LoRaWAN empty frame as defined in [Section
4.6](#lorawan-empty-frame){.xref}. As this uplink is sent only to open
an RX window, any LoRaWAN uplink frame from the device [MAY]{.bcp14}
reset this counter.[¶](#section-5.6.3-6){.pilcrow}

Note: The FPending bit included in the LoRaWAN protocol [SHOULD
NOT]{.bcp14} be used for the SCHC-over-LoRaWAN protocol. It might be set
by the Network Gateway for other purposes but not SCHC
needs.[¶](#section-5.6.3-7.1){.pilcrow}

::: {#regular-fragments-1}
::: {#section-5.6.3.1 .section}
##### [5.6.3.1.](#section-5.6.3.1){.section-number .selfRef} [Regular Fragments](#name-regular-fragments-2){.section-name .selfRef} {#name-regular-fragments-2}

[Figure 14](#Fig-fragmentation-downlink-header-all0){.xref} is an
example of a regular fragment for all fragments except the last one.
SCHC Header Size is 10 Bits, including the LoRaWAN
FPort.[¶](#section-5.6.3.1-1){.pilcrow}

[]{#name-all-fragments-but-the-last-}

::: {#Fig-fragmentation-downlink-header-all0}
::: {#section-5.6.3.1-2.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload                      |
    + ------ + ------------------------------------ +
    | RuleID | W     | FCN = b'0 | Payload          |
    + ------ + ----- + --------- + ---------------- +
    | 8 bits | 1 bit | 1 bit     | X bytes + 6 bits |
:::

[Figure 14](#figure-14){.selfRef}: [All Fragments but the Last
One.](#name-all-fragments-but-the-last-){.selfRef}
:::
:::
:::

::: {#last-fragment-all-1-1}
::: {#section-5.6.3.2 .section}
##### [5.6.3.2.](#section-5.6.3.2){.section-number .selfRef} [Last Fragment (All-1)](#name-last-fragment-all-1-2){.section-name .selfRef} {#name-last-fragment-all-1-2}

[]{#name-all-1-schc-message-the-last}

::: {#Fig-fragmentation-downlink-header-all1}
::: {#section-5.6.3.2-1.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload                                         |
    + ------ + --------------------------- + ------------------------- +
    | RuleID | W     | FCN = b'1 |   RCS   |   Payload   | Opt padding |
    + ------ + ----- + --------- + ------- + ----------- + ----------- +
    | 8 bits | 1 bit | 1 bit     | 32 bits | 6 to X bits | 0 to 7 bits |
:::

[Figure 15](#figure-15){.selfRef}: [All-1 SCHC Message: The Last
Fragment](#name-all-1-schc-message-the-last){.selfRef}
:::
:::
:::

::: {#schc-ack-1}
::: {#section-5.6.3.3 .section}
##### [5.6.3.3.](#section-5.6.3.3){.section-number .selfRef} [SCHC ACK](#name-schc-ack-2){.section-name .selfRef} {#name-schc-ack-2}

[]{#name-schc-ack-format-correct-rcs-}

::: {#Fig-frag-downlink-header-schc-ack-rcs-ok}
::: {#section-5.6.3.3-1.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload                    |
    + ------ + ---------------------------------- +
    | RuleID | W     | C = b'1 | Padding b'000000 |
    + ------ + ----- + ------- + ---------------- +
    | 8 bits | 1 bit | 1 bit   | 6 bits           |
:::

[Figure 16](#figure-16){.selfRef}: [SCHC ACK Format - Correct RCS
Check](#name-schc-ack-format-correct-rcs-){.selfRef}
:::

[]{#name-schc-ack-format-incorrect-rc}

::: {#Fig-frag-downlink-header-schc-ack-rcs-fail}
::: {#section-5.6.3.3-2.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload                                   |
    + ------ + ------------------------------------------------- +
    | RuleID | W     | C = b'0 | Bitmap = b'1 | Padding b'000000 |
    + ------ + ----- + ------- + ------------ + ---------------- +
    | 8 bits | 1 bit | 1 bit   |    1 bit     |      5 bits      |
:::

[Figure 17](#figure-17){.selfRef}: [SCHC ACK Format - Incorrect RCS
Check](#name-schc-ack-format-incorrect-rc){.selfRef}
:::
:::
:::

::: {#receiver-abort-1}
::: {#section-5.6.3.4 .section}
##### [5.6.3.4.](#section-5.6.3.4){.section-number .selfRef} [Receiver-Abort](#name-receiver-abort-2){.section-name .selfRef} {#name-receiver-abort-2}

[Figure 18](#Fig-fragmentation-downlink-header-abort){.xref} is an
example of a Receiver-Abort packet, following an All-1 SCHC Fragment
with incorrect RCS.[¶](#section-5.6.3.4-1){.pilcrow}

[]{#name-receiver-abort-packet}

::: {#Fig-fragmentation-downlink-header-abort}
::: {#section-5.6.3.4-2.1 .artwork .art-text .alignLeft}
    | FPort  | LoRaWAN payload                                |
    + ------ + ---------------------------------------------- +
    | RuleID | W = b'1 | C = b'1 | b'111111 | 0xFF (all 1's)  |
    + ------ + ------- + ------- + -------- + --------------- +
    | 8 bits | 1 bit   | 1 bits  | 6 bits   | 8 bits          |
                    next L2 Word boundary ->| <-- L2 Word --> |
:::

[Figure 18](#figure-18){.selfRef}: [Receiver-Abort
Packet](#name-receiver-abort-packet){.selfRef}
:::
:::
:::

::: {#downlink-retransmission-timer}
::: {#section-5.6.3.5 .section}
##### [5.6.3.5.](#section-5.6.3.5){.section-number .selfRef} [Downlink Retransmission Timer](#name-downlink-retransmission-tim){.section-name .selfRef} {#name-downlink-retransmission-tim}

Class A, Class B, and Class C devices do not manage retransmissions and
timers the same way.[¶](#section-5.6.3.5-1){.pilcrow}

::: {#class-a-devices}
::: {#section-5.6.3.5.1 .section}
###### [5.6.3.5.1.](#section-5.6.3.5.1){.section-number .selfRef} [Class A Devices](#name-class-a-devices){.section-name .selfRef} {#name-class-a-devices}

Class A devices can only receive in an RX slot following the
transmission of an uplink.[¶](#section-5.6.3.5.1-1){.pilcrow}

The SCHC gateway implements an inactivity timer with a
[RECOMMENDED]{.bcp14} duration of 36 hours. For devices with very low
transmission rates (for example, 1 packet a day in normal operation),
that duration may be extended; it is application
specific.[¶](#section-5.6.3.5.1-2){.pilcrow}

RETRANSMISSION_TIMER is application specific and its
[RECOMMENDED]{.bcp14} value is INACTIVITY_TIMER/(MAX_ACK_REQUESTS +
1).[¶](#section-5.6.3.5.1-3){.pilcrow}

**SCHC All-0 (FCN = 0)**[¶](#section-5.6.3.5.1-4){.pilcrow}

All fragments but the last have an FCN = 0 (because the window size is
1). Following an All-0 SCHC Fragment, the device [MUST]{.bcp14} transmit
the SCHC ACK message. It [MUST]{.bcp14} transmit up to MAX_ACK_REQUESTS
SCHC ACK messages before aborting. In order to progress the fragmented
datagram, the SCHC layer should immediately queue for transmission those
SCHC ACK messages if no SCHC downlink has been received during the RX1
and RX2 windows. The LoRaWAN layer will respect the applicable local
spectrum regulation.[¶](#section-5.6.3.5.1-5){.pilcrow}

Note: The ACK bitmap is 1 bit long and is always
1.[¶](#section-5.6.3.5.1-6.1){.pilcrow}

**SCHC All-1 (FCN = 1)**[¶](#section-5.6.3.5.1-7){.pilcrow}

SCHC All-1 is the last fragment of a datagram, and the corresponding
SCHC ACK message might be lost; therefore, the SCHC gateway
[MUST]{.bcp14} request a retransmission of this ACK when the
retransmission timer expires. To open a downlink opportunity, the device
[MUST]{.bcp14} transmit an uplink every interval of
RETRANSMISSION_TIMER/(MAX_ACK_REQUESTS \* SCHC_ACK_REQ_DN_OPPORTUNITY).
The format of this uplink is application specific. It is
[RECOMMENDED]{.bcp14} for a device to send an empty frame (see [Section
4.6](#lorawan-empty-frame){.xref}), but it is application specific and
will be used by the NGW to transmit a potential SCHC ACK REQ.
SCHC_ACK_REQ_DN_OPPORTUNITY is application specific and its recommended
value is 2. It [MUST]{.bcp14} be greater than 1. This allows the opening
of a downlink opportunity to any downlink with higher priority than the
SCHC ACK REQ message.[¶](#section-5.6.3.5.1-8){.pilcrow}

Note: The device [MUST]{.bcp14} keep this SCHC ACK message in memory
until it receives a downlink SCHC Fragmentation Message (with FPort ==
FPortDown) that is not a SCHC ACK REQ; this indicates that the SCHC
gateway has received the SCHC ACK
message.[¶](#section-5.6.3.5.1-9.1){.pilcrow}
:::
:::
:::
:::

::: {#class-b-or-class-c-devices}
::: {#section-5.6.3.6 .section}
##### [5.6.3.6.](#section-5.6.3.6){.section-number .selfRef} [Class B or Class C Devices](#name-class-b-or-class-c-devices){.section-name .selfRef} {#name-class-b-or-class-c-devices}

Class B devices can receive in scheduled RX slots or in RX slots
following the transmission of an uplink. Class C devices are almost in
constant reception.[¶](#section-5.6.3.6-1){.pilcrow}

[RECOMMENDED]{.bcp14} retransmission timer values
are:[¶](#section-5.6.3.6-2){.pilcrow}

[]{.break}

Class B:
:   3 times the ping slot
    periodicity.[¶](#section-5.6.3.6-3.2){.pilcrow}
:   

Class C:
:   30 seconds.[¶](#section-5.6.3.6-3.4){.pilcrow}
:   

The [RECOMMENDED]{.bcp14} inactivity timer value is 12 hours for both
Class B and Class C devices.[¶](#section-5.6.3.6-4){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#schc-fragment-format}
::: {#section-5.7 .section}
### [5.7.](#section-5.7){.section-number .selfRef} [SCHC Fragment Format](#name-schc-fragment-format){.section-name .selfRef} {#name-schc-fragment-format}

::: {#all-0-schc-fragment}
::: {#section-5.7.1 .section}
#### [5.7.1.](#section-5.7.1){.section-number .selfRef} [All-0 SCHC Fragment](#name-all-0-schc-fragment){.section-name .selfRef} {#name-all-0-schc-fragment}

**Uplink Fragmentation (Ack-on-Error)**:[¶](#section-5.7.1-1){.pilcrow}

All-0 is distinguishable from a SCHC ACK REQ, as
\[[RFC8724](#RFC8724){.xref}\] states \"This condition is also met if
the SCHC Fragment Header is a multiple of L2 Words\", the following
condition being met: SCHC header is 2
bytes.[¶](#section-5.7.1-2){.pilcrow}

**Downlink fragmentation (ACK-Always)**:[¶](#section-5.7.1-3){.pilcrow}

As per \[[RFC8724](#RFC8724){.xref}\], SCHC All-1 [MUST]{.bcp14} contain
the last tile, and implementations [MUST]{.bcp14} ensure that SCHC All-0
message Payload will be at least the size of an L2
Word.[¶](#section-5.7.1-4){.pilcrow}
:::
:::

::: {#all-1-schc-fragment}
::: {#section-5.7.2 .section}
#### [5.7.2.](#section-5.7.2){.section-number .selfRef} [All-1 SCHC Fragment](#name-all-1-schc-fragment){.section-name .selfRef} {#name-all-1-schc-fragment}

All-1 is distinguishable from a SCHC Sender-Abort, as
\[[RFC8724](#RFC8724){.xref}\] states \"This condition is met if the RCS
is present and is at least the size of an L2 Word\", the following
condition being met: RCS is 4 bytes.[¶](#section-5.7.2-1){.pilcrow}
:::
:::

::: {#delay-after-each-lorawan-frame-to-respect-local-regulation}
::: {#section-5.7.3 .section}
#### [5.7.3.](#section-5.7.3){.section-number .selfRef} [Delay after Each LoRaWAN Frame to Respect Local Regulation](#name-delay-after-each-lorawan-fr){.section-name .selfRef} {#name-delay-after-each-lorawan-fr}

This profile does not define a delay to be added after each LoRaWAN
frame; local regulation compliance is expected to be enforced by the
LoRaWAN stack.[¶](#section-5.7.3-1){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#security-considerations}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

This document is only providing parameters that are expected to be best
suited for LoRaWAN networks for \[[RFC8724](#RFC8724){.xref}\]. IID
security is discussed in [Section 5.3](#IID){.xref}. As such, this
document does not contribute to any new security issues beyond those
already identified in \[[RFC8724](#RFC8724){.xref}\]. Moreover, SCHC
data (LoRaWAN payload) are protected at the LoRaWAN level by an AES-128
encryption with a session key shared by the device and the SCHC gateway.
These session keys are renewed at each LoRaWAN session (i.e., each join
or rejoin to the LoRaWAN network).[¶](#section-6-1){.pilcrow}
:::
:::

::: {#iana-considerations}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-7-1){.pilcrow}
:::
:::

::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[LORAWAN-SPEC\]
:   [LoRa Alliance]{.refAuthor}, [\"LoRaWAN 1.0.4 Specification
    Package\"]{.refTitle},
    \<<https://lora-alliance.org/resource_hub/lorawan-104-specification-package/>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC4291\]
:   [Hinden, R.]{.refAuthor} and [S. Deering]{.refAuthor}, [\"IP Version
    6 Addressing Architecture\"]{.refTitle}, [RFC 4291]{.seriesInfo},
    [DOI 10.17487/RFC4291]{.seriesInfo}, February 2006,
    \<<https://www.rfc-editor.org/info/rfc4291>\>.
:   

\[RFC4493\]
:   [Song, JH.]{.refAuthor}, [Poovendran, R.]{.refAuthor},
    [Lee, J.]{.refAuthor}, and [T. Iwata]{.refAuthor}, [\"The AES-CMAC
    Algorithm\"]{.refTitle}, [RFC 4493]{.seriesInfo}, [DOI
    10.17487/RFC4493]{.seriesInfo}, June 2006,
    \<<https://www.rfc-editor.org/info/rfc4493>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC8724\]
:   [Minaburo, A.]{.refAuthor}, [Toutain, L.]{.refAuthor},
    [Gomez, C.]{.refAuthor}, [Barthel, D.]{.refAuthor}, and [JC.
    Zúñiga]{.refAuthor}, [\"SCHC: Generic Framework for Static Context
    Header Compression and Fragmentation\"]{.refTitle}, [RFC
    8724]{.seriesInfo}, [DOI 10.17487/RFC8724]{.seriesInfo}, April 2020,
    \<<https://www.rfc-editor.org/info/rfc8724>\>.
:   
:::

::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[LORAWAN-REMOTE-MULTICAST-SET\]
:   [LoRa Alliance]{.refAuthor}, [\"LoRaWAN Remote Multicast Setup
    Specification v1.0.0\"]{.refTitle},
    \<<https://lora-alliance.org/resource_hub/lorawan-remote-multicast-setup-specification-v1-0-0/>\>.
:   

\[RFC8064\]
:   [Gont, F.]{.refAuthor}, [Cooper, A.]{.refAuthor},
    [Thaler, D.]{.refAuthor}, and [W. Liu]{.refAuthor},
    [\"Recommendation on Stable IPv6 Interface
    Identifiers\"]{.refTitle}, [RFC 8064]{.seriesInfo}, [DOI
    10.17487/RFC8064]{.seriesInfo}, February 2017,
    \<<https://www.rfc-editor.org/info/rfc8064>\>.
:   

\[RFC8065\]
:   [Thaler, D.]{.refAuthor}, [\"Privacy Considerations for IPv6
    Adaptation-Layer Mechanisms\"]{.refTitle}, [RFC 8065]{.seriesInfo},
    [DOI 10.17487/RFC8065]{.seriesInfo}, February 2017,
    \<<https://www.rfc-editor.org/info/rfc8065>\>.
:   

\[RFC8376\]
:   [Farrell, S., Ed.]{.refAuthor}, [\"Low-Power Wide Area Network
    (LPWAN) Overview\"]{.refTitle}, [RFC 8376]{.seriesInfo}, [DOI
    10.17487/RFC8376]{.seriesInfo}, May 2018,
    \<<https://www.rfc-editor.org/info/rfc8376>\>.
:   
:::
:::

::: {#examples}
::: {#section-appendix.a .section}
## [Appendix A.](#section-appendix.a){.section-number .selfRef} [Examples](#name-examples){.section-name .selfRef} {#name-examples}

In the following examples, \"applicative data\" refers to the IPv6
payload sent by the application to the SCHC
layer.[¶](#section-appendix.a-1){.pilcrow}

::: {#uplink-compression-example-no-fragmentation}
::: {#section-a.1 .section}
## [A.1.](#section-a.1){.section-number .selfRef} [Uplink - Compression Example - No Fragmentation](#name-uplink-compression-example-){.section-name .selfRef} {#name-uplink-compression-example-}

This example represents an applicative data going through SCHC over
LoRaWAN; no fragmentation required.[¶](#section-a.1-1){.pilcrow}

An applicative data of 78 bytes is passed to the SCHC compression layer.
Rule 1 is used by the SCHC C/D layer, allowing to compress it to 40
bytes and 5 bits: 1 byte RuleID, 21 bits residue + 37 bytes
payload.[¶](#section-a.1-2){.pilcrow}

[]{#name-uplink-example-schc-message}

::: {#Fig-example-uplink-no-fragmentation-payload-schc-message}
::: {#section-a.1-3.1 .artwork .art-text .alignLeft}
    | RuleID | Compression residue |  Payload  | Padding=b'000 |
    + ------ + ------------------- + --------- + ------------- +
    |   1    |       21 bits       |  37 bytes |    3 bits     |
:::

[Figure 19](#figure-19){.selfRef}: [Uplink Example: SCHC
Message](#name-uplink-example-schc-message){.selfRef}
:::

The current LoRaWAN MTU is 51 bytes, although 2-byte FOpts are used by
the LoRaWAN protocol: 49 bytes are available for SCHC payload; no need
for fragmentation. The payload will be transmitted through FPort =
1.[¶](#section-a.1-4){.pilcrow}

[]{#name-uplink-example-lorawan-pack}

::: {#Fig-example-uplink-no-fragmentation-compression}
::: {#section-a.1-5.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header            | LoRaWAN payload (40 bytes)              |
    + ------------------------- + --------------------------------------- +
    |      |  FOpts  | RuleID=1 | Compression | Payload   | Padding=b'000 |
    |      |         |          | residue     |           |               |
    + ---- + ------- + -------- + ----------- + --------- + ------------- +
    | XXXX | 2 bytes | 1 byte   | 21 bits     |  37 bytes |    3 bits     |
:::

[Figure 20](#figure-20){.selfRef}: [Uplink Example: LoRaWAN
Packet](#name-uplink-example-lorawan-pack){.selfRef}
:::
:::
:::

::: {#uplink-compression-and-fragmentation-example}
::: {#section-a.2 .section}
## [A.2.](#section-a.2){.section-number .selfRef} [Uplink - Compression and Fragmentation Example](#name-uplink-compression-and-frag){.section-name .selfRef} {#name-uplink-compression-and-frag}

This example represents an applicative data going through SCHC, with
fragmentation.[¶](#section-a.2-1){.pilcrow}

An applicative data of 300 bytes is passed to the SCHC compression
layer. Rule 1 is used by the SCHC C/D layer, allowing to compress it to
282 bytes and 5 bits: 1 byte RuleID, 21 bits residue + 279 bytes
payload.[¶](#section-a.2-2){.pilcrow}

[]{#name-uplink-example-schc-message-2}

::: {#Fig-example-uplink-fragmentation-schc-message}
::: {#section-a.2-3.1 .artwork .art-text .alignLeft}
    | RuleID | Compression residue |  Payload  |
    + ------ + ------------------- + --------- +
    |   1    |       21 bits       | 279 bytes |
:::

[Figure 21](#figure-21){.selfRef}: [Uplink Example: SCHC
Message](#name-uplink-example-schc-message-2){.selfRef}
:::

The current LoRaWAN MTU is 11 bytes; 0-byte FOpts are used by the
LoRaWAN protocol: 11 bytes are available for SCHC payload + 1 byte FPort
field. The SCHC header is 2 bytes (including FPort), so 1 tile is sent
in the first fragment.[¶](#section-a.2-4){.pilcrow}

[]{#name-uplink-example-lorawan-packe}

::: {#Fig-example-uplink-fragmentation-lorawan-packet-1}
::: {#section-a.2-5.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header             | LoRaWAN payload (11 bytes) |
    + -------------------------- + -------------------------- +
    |                | RuleID=20 |   W   |  FCN   |  1 tile   |
    + -------------- + --------- + ----- + ------ + --------- +
    |       XXXX     | 1 byte    | 0   0 |   62   | 10 bytes  |
:::

[Figure 22](#figure-22){.selfRef}: [Uplink Example: LoRaWAN Packet
1](#name-uplink-example-lorawan-packe){.selfRef}
:::

The tile content is described in [Figure
23](#Fig-example-uplink-fragmentation-lorawan-packet-1-tile-content){.xref}[¶](#section-a.2-6){.pilcrow}

[]{#name-uplink-example-first-tile-c}

::: {#Fig-example-uplink-fragmentation-lorawan-packet-1-tile-content}
::: {#section-a.2-7.1 .artwork .art-text .alignLeft}
    Content of the tile is:
    | RuleID | Compression residue |  Payload          |
    + ------ + ------------------- + ----------------- +
    |   1    |       21 bits       |  6 bytes + 3 bits |
:::

[Figure 23](#figure-23){.selfRef}: [Uplink Example: First Tile
Content](#name-uplink-example-first-tile-c){.selfRef}
:::

Next transmission MTU is 11 bytes, although 2-byte FOpts are used by the
LoRaWAN protocol: 9 bytes are available for SCHC payload + 1 byte FPort
field, a tile does not fit inside so the LoRaWAN stack will send only
FOpts.[¶](#section-a.2-8){.pilcrow}

Next transmission MTU is 242 bytes, 4-byte FOpts. 23 tiles are
transmitted:[¶](#section-a.2-9){.pilcrow}

[]{#name-uplink-example-lorawan-packet}

::: {#Fig-example-uplink-fragmentation-lorawan-packet-2}
::: {#section-a.2-10.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header                        | LoRaWAN payload (231 bytes) |
    + --------------------------------------+ --------------------------- +
    |                |  FOpts  | RuleID=20  |   W   |  FCN  |  23 tiles   |
    + -------------- + ------- + ---------- + ----- + ----- + ----------- +
    |       XXXX     | 4 bytes |  1 byte    | 0   0 |   61  | 230 bytes   |
:::

[Figure 24](#figure-24){.selfRef}: [Uplink Example: LoRaWAN Packet
2](#name-uplink-example-lorawan-packet){.selfRef}
:::

Next transmission MTU is 242 bytes, no FOpts. All 5 remaining tiles are
transmitted, the last tile is only 2 bytes + 5 bits. Padding is added
for the remaining 3 bits.[¶](#section-a.2-11){.pilcrow}

[]{#name-uplink-example-lorawan-packet-}

::: {#Fig-example-uplink-fragmentation-lorawan-packet-3}
::: {#section-a.2-12.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header    | LoRaWAN payload (44 bytes)                      |
    + ---- + ---------- + ----------------------------------------------- +
    |      | RuleID=20  |   W   |  FCN  |    5 tiles      | Padding=b'000 |
    + ---- + ---------- + ----- + ----- + --------------- + ------------- +
    | XXXX | 1 byte     | 0   0 |  38   | 42 bytes+5 bits |    3 bits     |
:::

[Figure 25](#figure-25){.selfRef}: [Uplink Example: LoRaWAN Packet
3](#name-uplink-example-lorawan-packet-){.selfRef}
:::

Then All-1 message can be transmitted:[¶](#section-a.2-13){.pilcrow}

[]{#name-uplink-example-lorawan-packet-4}

::: {#Fig-example-uplink-fragmentation-lorawan-packet-4}
::: {#section-a.2-14.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header    | LoRaWAN payload (44 bytes) |
    + ---- + -----------+ -------------------------- +
    |      | RuleID=20  |   W   |  FCN  |     RCS    |
    + ---- + ---------- + ----- + ----- + ---------- +
    | XXXX | 1 byte     | 0   0 |   63  |  4 bytes   |
:::

[Figure 26](#figure-26){.selfRef}: [Uplink Example: LoRaWAN Packet 4 -
All-1 SCHC Message](#name-uplink-example-lorawan-packet-4){.selfRef}
:::

All packets have been received by the SCHC gateway, computed RCS is
correct so the following ACK is sent to the device by the SCHC
receiver:[¶](#section-a.2-15){.pilcrow}

[]{#name-uplink-example-lorawan-packet-5}

::: {#Fig-example-uplink-fragmentation-lorawan-packet-5}
::: {#section-a.2-16.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header             | LoRaWAN payload     |
    + -------------- + --------- + ------------------- +
    |                | RuleID=20 |   W   | C | Padding |
    + -------------- + --------- + ----- + - + ------- +
    |       XXXX     | 1 byte    | 0   0 | 1 | 5 bits  |
:::

[Figure 27](#figure-27){.selfRef}: [Uplink Example: LoRaWAN Packet 5 -
SCHC ACK](#name-uplink-example-lorawan-packet-5){.selfRef}
:::
:::
:::

::: {#downlink}
::: {#section-a.3 .section}
## [A.3.](#section-a.3){.section-number .selfRef} [Downlink](#name-downlink){.section-name .selfRef} {#name-downlink}

An applicative data of 155 bytes is passed to the SCHC compression
layer. Rule 1 is used by the SCHC C/D layer, allowing to compress it to
130 bytes and 5 bits: 1 byte RuleID, 21 bits residue + 127 bytes
payload.[¶](#section-a.3-1){.pilcrow}

[]{#name-downlink-example-schc-messa}

::: {#Fig-example-downlink-fragmentation-schc-message}
::: {#section-a.3-2.1 .artwork .art-text .alignLeft}
    | RuleID | Compression residue |  Payload  |
    + ------ + ------------------- + --------- +
    |   1    |       21 bits       | 127 bytes |
:::

[Figure 28](#figure-28){.selfRef}: [Downlink Example: SCHC
Message](#name-downlink-example-schc-messa){.selfRef}
:::

The current LoRaWAN MTU is 51 bytes; no FOpts are used by the LoRaWAN
protocol: 51 bytes are available for SCHC payload + FPort field; the
applicative data has to be fragmented.[¶](#section-a.3-3){.pilcrow}

[]{#name-downlink-example-lorawan-pa}

::: {#Fig-example-downlink-fragmentation-lorawan-packet-1}
::: {#section-a.3-4.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header    | LoRaWAN payload (51 bytes)             |
    + ---- + ---------- + -------------------------------------- +
    |      | RuleID=21  |  W = 0 | FCN = 0 |       1 tile        |
    + ---- + ---------- + ------ + ------- + ------------------- +
    | XXXX | 1 byte     |  1 bit |  1 bit  | 50 bytes and 6 bits |
:::

[Figure 29](#figure-29){.selfRef}: [Downlink Example: LoRaWAN Packet 1 -
SCHC Fragment 1](#name-downlink-example-lorawan-pa){.selfRef}
:::

The tile content is described in [Figure
30](#Fig-example-downlink-fragmentation-lorawan-packet-1-tile-content){.xref}[¶](#section-a.3-5){.pilcrow}

[]{#name-downlink-example-first-tile}

::: {#Fig-example-downlink-fragmentation-lorawan-packet-1-tile-content}
::: {#section-a.3-6.1 .artwork .art-text .alignLeft}
    | RuleID | Compression residue |        Payload     |
    + ------ + ------------------- + ------------------ +
    |   1    |       21 bits       | 48 bytes and 1 bit |
:::

[Figure 30](#figure-30){.selfRef}: [Downlink Example: First Tile
Content](#name-downlink-example-first-tile){.selfRef}
:::

The receiver answers with a SCHC ACK:[¶](#section-a.3-7){.pilcrow}

[]{#name-downlink-example-lorawan-pac}

::: {#Fig-example-downlink-fragmentation-lorawan-packet-2}
::: {#section-a.3-8.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header   | LoRaWAN payload                  |
    + ---- + --------- + -------------------------------- +
    |      | RuleID=21 | W = 0 | C = 1 | Padding=b'000000 |
    + ---- + --------- + ----- + ----- + ---------------- +
    | XXXX |  1 byte   | 1 bit | 1 bit |     6 bits       |
:::

[Figure 31](#figure-31){.selfRef}: [Downlink Example: LoRaWAN Packet 2 -
SCHC ACK](#name-downlink-example-lorawan-pac){.selfRef}
:::

The second downlink is sent, two FOpts:[¶](#section-a.3-9){.pilcrow}

[]{#name-downlink-example-lorawan-pack}

::: {#Fig-example-downlink-fragmentation-lorawan-packet-3}
::: {#section-a.3-10.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header              |  LoRaWAN payload (49 bytes)           |
    + --------------------------- + ------------------------------------- +
    |      |  FOpts  | RuleID=21  | W = 1 | FCN = 0 |        1 tile       |
    + ---- + ------- + ---------- + ----- + ------- + ------------------- +
    | XXXX | 2 bytes | 1 byte     | 1 bit |  1 bit  | 48 bytes and 6 bits |
:::

[Figure 32](#figure-32){.selfRef}: [Downlink Example: LoRaWAN Packet 3 -
SCHC Fragment 2](#name-downlink-example-lorawan-pack){.selfRef}
:::

The receiver answers with a SCHC ACK:[¶](#section-a.3-11){.pilcrow}

[]{#name-downlink-example-lorawan-packe}

::: {#Fig-example-downlink-fragmentation-lorawan-packet-4}
::: {#section-a.3-12.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header   | LoRaWAN payload                  |
    + ---- + --------- + -------------------------------- +
    |      | RuleID=21 | W = 1 | C = 1 | Padding=b'000000 |
    + ---- + --------- + ----- + ----- + ---------------- +
    | XXXX |  1 byte   | 1 bit | 1 bit |     6 bits       |
:::

[Figure 33](#figure-33){.selfRef}: [Downlink Example: LoRaWAN Packet 4 -
SCHC ACK](#name-downlink-example-lorawan-packe){.selfRef}
:::

The last downlink is sent, no FOpts:[¶](#section-a.3-13){.pilcrow}

[]{#name-downlink-example-lorawan-packet}

::: {#Fig-example-downlink-fragmentation-lorawan-packet-5}
::: {#section-a.3-14.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header | LoRaWAN payload (37 bytes)                         |
    + ---- + ------- + -------------------------------------------------- +
    |      | RuleID  |   W   |  FCN  |   RCS   |      1 tile    | Padding |
    |      |   21    |   0   |   1   |         |                | b'00000 |
    + ---- + ------- + ----- + ----- + ------- + -------------- + ------- +
    | XXXX | 1 byte  | 1 bit | 1 bit | 4 bytes | 31 bytes+1 bit | 5 bits  |
:::

[Figure 34](#figure-34){.selfRef}: [Downlink Example: LoRaWAN Packet 5 -
All-1 SCHC Message](#name-downlink-example-lorawan-packet){.selfRef}
:::

The receiver answers to the sender with a SCHC
ACK:[¶](#section-a.3-15){.pilcrow}

[]{#name-downlink-example-lorawan-packet-}

::: {#Fig-example-downlink-fragmentation-lorawan-packet-6}
::: {#section-a.3-16.1 .artwork .art-text .alignLeft}
    | LoRaWAN Header   | LoRaWAN payload                  |
    + ---- + --------- + -------------------------------- +
    |      | RuleID=21 | W = 0 | C = 1 | Padding=b'000000 |
    + ---- + --------- + ----- + ----- + ---------------- +
    | XXXX |  1 byte   | 1 bit | 1 bit |     6 bits       |
:::

[Figure 35](#figure-35){.selfRef}: [Downlink Example: LoRaWAN Packet 6 -
SCHC ACK](#name-downlink-example-lorawan-packet-){.selfRef}
:::
:::
:::
:::
:::

::: {#acknowledgements}
::: {#section-appendix.b .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

Thanks to all those listed in the Contributors Section for the excellent
text, insightful discussions, reviews, and suggestions, and also to (in
alphabetical order) [Dominique Barthel]{.contact-name}, [Arunprabhu
Kandasamy]{.contact-name}, [Rodrigo Munoz]{.contact-name}, [Alexander
Pelov]{.contact-name}, [Pascal Thubert]{.contact-name}, and [Laurent
Toutain]{.contact-name} for useful design considerations, reviews, and
comments.[¶](#section-appendix.b-1){.pilcrow}

LoRaWAN is a registered trademark of the LoRa
Alliance.[¶](#section-appendix.b-2){.pilcrow}
:::
:::

::: {#contributors}
::: {#section-appendix.c .section}
## [Contributors](#name-contributors){.section-name .selfRef} {#name-contributors}

Contributors ordered by family name.[¶](#section-appendix.c-1){.pilcrow}

::: {.left dir="auto"}
[Vincent Audebert]{.fn .nameRole}
:::

::: {.left dir="auto"}
[EDF R&D]{.org}
:::

::: email
Email: <vincent.audebert@edf.fr>
:::

::: {.left dir="auto"}
[Julien Catalano]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Kerlink]{.org}
:::

::: email
Email: <j.catalano@kerlink.fr>
:::

::: {.left dir="auto"}
[Michael Coracin]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Semtech]{.org}
:::

::: email
Email: <mcoracin@semtech.com>
:::

::: {.left dir="auto"}
[Marc Le Gourrierec]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Sagemcom]{.org}
:::

::: email
Email: <marc.legourrierec@sagemcom.com>
:::

::: {.left dir="auto"}
[Nicolas Sornin]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Chirp Foundation]{.org}
:::

::: email
Email: <nicolas.sornin@chirpfoundation.org>
:::

::: {.left dir="auto"}
[Alper Yegin]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Actility]{.org}
:::

::: email
Email: <alper.yegin@actility.com>
:::
:::
:::

::: {#authors-addresses}
::: {#section-appendix.d .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Olivier Gimenez ([editor]{.role})]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Semtech]{.org}
:::

::: {.left dir="auto"}
[14 Chemin des Clos]{.street-address}
:::

::: {.left dir="auto"}
[Meylan]{.locality}
:::

::: {.left dir="auto"}
[France]{.country-name}
:::

::: email
Email: <ogimenez@semtech.com>
:::

::: {.left dir="auto"}
[Ivaylo Petrov ([editor]{.role})]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Acklio]{.org}
:::

::: {.left dir="auto"}
[1137A Avenue des Champs Blancs]{.street-address}
:::

::: {.left dir="auto"}
[35510]{.postal-code} [Cesson-Sévigné Cedex]{.locality}
:::

::: {.left dir="auto"}
[France]{.country-name}
:::

::: email
Email: <ivaylo@ackl.io>
:::
:::
:::
