  RFC 9303        LISP-SEC          October 2022
  --------------- ----------------- --------------
  Maino, et al.   Standards Track   \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [9303](https://www.rfc-editor.org/rfc/rfc9303){.eref}

Category:
:   Standards Track

Published:
:   October 2022

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    F. Maino
    :::

    ::: org
    Cisco Systems
    :::
    :::

    ::: author
    ::: author-name
    V. Ermagan
    :::

    ::: org
    Google, Inc.
    :::
    :::

    ::: author
    ::: author-name
    A. Cabellos
    :::

    ::: org
    Universitat Politecnica de Catalunya
    :::
    :::

    ::: author
    ::: author-name
    D. Saucez
    :::

    ::: org
    Inria
    :::
    :::
:::

# RFC 9303 {#rfcnum}

# Locator/ID Separation Protocol Security (LISP-SEC) {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This memo specifies Locator/ID Separation Protocol Security (LISP-SEC),
a set of security mechanisms that provides origin authentication,
integrity, and anti-replay protection to the LISP\'s
Endpoint-ID-to-Routing-Locator (EID-to-RLOC) mapping data conveyed via
the mapping lookup process. LISP-SEC also enables verification of
authorization on EID-Prefix claims in Map-Reply
messages.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc9303>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2022 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Revised BSD License text as described in Section 4.e of the Trust Legal
Provisions and are provided without warranty as described in the Revised
BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.auto .internal
    .xref}.  [Introduction](#name-introduction){.internal .xref}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.auto .internal .xref}.  [Requirements
    Notation](#name-requirements-notation){.internal .xref}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.auto .internal .xref}.  [Definitions of
    Terms](#name-definitions-of-terms){.internal .xref}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.auto .internal .xref}.  [LISP-SEC Threat
    Model](#name-lisp-sec-threat-model){.internal .xref}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.auto .internal .xref}.  [Protocol
    Operations](#name-protocol-operations){.internal .xref}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.auto .internal .xref}.  [LISP-SEC Control Messages
    Details](#name-lisp-sec-control-messages-d){.internal .xref}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.auto .internal .xref}.  [Encapsulated
        Control Message LISP-SEC
        Extensions](#name-encapsulated-control-messag){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.6.2.2}
        [6.2](#section-6.2){.auto .internal .xref}.  [Map-Reply LISP-SEC
        Extensions](#name-map-reply-lisp-sec-extensio){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.6.2.3}
        [6.3](#section-6.3){.auto .internal .xref}.  [Map-Register
        LISP-SEC
        Extensions](#name-map-register-lisp-sec-exten){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.6.2.4}
        [6.4](#section-6.4){.auto .internal .xref}.  [ITR Processing:
        Generating a
        Map-Request](#name-itr-processing-generating-a){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.6.2.5}
        [6.5](#section-6.5){.auto .internal .xref}.  [Encrypting and
        Decrypting an OTK](#name-encrypting-and-decrypting-a){.internal
        .xref}

        -   ::: {#section-toc.1-1.6.2.5.2.1}
            [6.5.1](#section-6.5.1){.auto .internal
            .xref}.  [Unencrypted OTK](#name-unencrypted-otk){.internal
            .xref}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.6}
        [6.6](#section-6.6){.auto .internal .xref}.  [Map-Resolver
        Processing](#name-map-resolver-processing){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.6.2.7}
        [6.7](#section-6.7){.auto .internal .xref}.  [Map-Server
        Processing](#name-map-server-processing){.internal .xref}

        -   ::: {#section-toc.1-1.6.2.7.2.1}
            [6.7.1](#section-6.7.1){.auto .internal .xref}.  [Generating
            a LISP-SEC-Protected Encapsulated
            Map-Request](#name-generating-a-lisp-sec-prote){.internal
            .xref}
            :::

        -   ::: {#section-toc.1-1.6.2.7.2.2}
            [6.7.2](#section-6.7.2){.auto .internal .xref}.  [Generating
            a Proxy
            Map-Reply](#name-generating-a-proxy-map-repl){.internal
            .xref}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.8}
        [6.8](#section-6.8){.auto .internal .xref}.  [ETR
        Processing](#name-etr-processing){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.6.2.9}
        [6.9](#section-6.9){.auto .internal .xref}.  [ITR Processing:
        Receiving a
        Map-Reply](#name-itr-processing-receiving-a-){.internal .xref}

        -   ::: {#section-toc.1-1.6.2.9.2.1}
            [6.9.1](#section-6.9.1){.auto .internal .xref}.  [Map-Reply
            Record
            Validation](#name-map-reply-record-validation){.internal
            .xref}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.auto .internal .xref}.  [Security
    Considerations](#name-security-considerations){.internal .xref}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.auto .internal .xref}.  [Mapping System
        Security](#name-mapping-system-security){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.auto .internal .xref}.  [Random Number
        Generation](#name-random-number-generation){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.7.2.3}
        [7.3](#section-7.3){.auto .internal .xref}.  [Map-Server and ETR
        Colocation](#name-map-server-and-etr-colocati){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.7.2.4}
        [7.4](#section-7.4){.auto .internal .xref}.  [Deploying
        LISP-SEC](#name-deploying-lisp-sec){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.7.2.5}
        [7.5](#section-7.5){.auto .internal .xref}.  [Shared Keys
        Provisioning](#name-shared-keys-provisioning){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.7.2.6}
        [7.6](#section-7.6){.auto .internal .xref}.  [Replay
        Attacks](#name-replay-attacks){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.7.2.7}
        [7.7](#section-7.7){.auto .internal .xref}.  [Message
        Privacy](#name-message-privacy){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.7.2.8}
        [7.8](#section-7.8){.auto .internal .xref}.  [Denial-of-Service
        and Distributed Denial-of-Service
        Attacks](#name-denial-of-service-and-distr){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.auto .internal .xref}.  [IANA
    Considerations](#name-iana-considerations){.internal .xref}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.auto .internal .xref}.  [ECM AD Type
        Registry](#name-ecm-ad-type-registry){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.auto .internal .xref}.  [Map-Reply AD Types
        Registry](#name-map-reply-ad-types-registry){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.8.2.3}
        [8.3](#section-8.3){.auto .internal .xref}.  [HMAC
        Functions](#name-hmac-functions){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.8.2.4}
        [8.4](#section-8.4){.auto .internal .xref}.  [Key Wrap
        Functions](#name-key-wrap-functions){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.8.2.5}
        [8.5](#section-8.5){.auto .internal .xref}.  [Key Derivation
        Functions](#name-key-derivation-functions){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.auto .internal
    .xref}.  [References](#name-references){.internal .xref}

    -   ::: {#section-toc.1-1.9.2.1}
        [9.1](#section-9.1){.auto .internal .xref}.  [Normative
        References](#name-normative-references){.internal .xref}
        :::

    -   ::: {#section-toc.1-1.9.2.2}
        [9.2](#section-9.2){.auto .internal .xref}.  [Informative
        References](#name-informative-references){.internal .xref}
        :::
    :::

-   ::: {#section-toc.1-1.10}
    [](#appendix-A){.auto .internal
    .xref}[Acknowledgments](#name-acknowledgments){.internal .xref}
    :::

-   ::: {#section-toc.1-1.11}
    [](#appendix-B){.auto .internal .xref}[Authors\'
    Addresses](#name-authors-addresses){.internal .xref}
    :::
:::
:::

::: {#intro}
::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

The Locator/ID Separation Protocol (LISP) \[[RFC9300](#RFC9300){.cite
.xref}\] \[[RFC9301](#RFC9301){.cite .xref}\] is a network-layer-based
protocol that enables separation of IP addresses into two new numbering
spaces: Endpoint Identifiers (EIDs) and Routing Locators (RLOCs).
EID-to-RLOC mappings are stored in a database and the LISP Mapping
System, and they are made available via the Map-Request/Map-Reply lookup
process. If these EID-to-RLOC mappings, carried through Map-Reply
messages, are transmitted without integrity protection, an adversary can
manipulate them and hijack the communication, impersonate the requested
EID, or mount Denial-of-Service (DoS) or Distributed Denial-of-Service
(DDoS) attacks. Also, if the Map-Reply message is transported
unauthenticated, an adversarial LISP entity can overclaim an EID-Prefix
and maliciously redirect traffic. The LISP-SEC threat model, described
in [Section 4](#threat-model){.auto .internal .xref}, is built on top of
the LISP threat model defined in \[[RFC7835](#RFC7835){.cite .xref}\],
which includes a detailed description of an \"overclaiming\"
attack.[¶](#section-1-1){.pilcrow}

This memo specifies LISP-SEC, a set of security mechanisms that provides
origin authentication, integrity, and anti-replay protection to LISP\'s
EID-to-RLOC mapping data conveyed via the mapping lookup process.
LISP-SEC also enables verification of authorization on EID-Prefix claims
in Map-Reply messages, ensuring that the sender of a Map-Reply that
provides the location for a given EID-Prefix is entitled to do so
according to the EID-Prefix registered in the associated Map-Server.
Map-Register/Map-Notify security, including the right for a LISP entity
to register an EID-Prefix or to claim presence at an RLOC, is out of the
scope of LISP-SEC, as those protocols are protected by the security
mechanisms specified in \[[RFC9301](#RFC9301){.cite .xref}\]. However,
LISP-SEC extends the Map-Register message to allow an Ingress Tunnel
Router (ITR) to downgrade to non-LISP-SEC Map-Requests. Additional
security considerations are described in [Section 7](#security){.auto
.internal .xref}.[¶](#section-1-2){.pilcrow}
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Requirements Notation](#name-requirements-notation){.section-name .selfRef} {#name-requirements-notation}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.cite .xref}\]
\[[RFC8174](#RFC8174){.cite .xref}\] when, and only when, they appear in
all capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::

::: {#terms}
::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Definitions of Terms](#name-definitions-of-terms){.section-name .selfRef} {#name-definitions-of-terms}

[]{.break}

One-Time Key (OTK):
:   An ephemeral randomly generated key that must be used for a single
    Map-Request/Map-Reply exchange.[¶](#section-3-1.2){.pilcrow}
:   

ITR One-Time Key (ITR-OTK):
:   The One-Time Key generated at the Ingress Tunnel Router
    (ITR).[¶](#section-3-1.4){.pilcrow}
:   

MS One-Time Key (MS-OTK):
:   The One-Time Key generated at the
    Map-Server.[¶](#section-3-1.6){.pilcrow}
:   

Authentication Data (AD):
:   Metadata that is included either in a LISP Encapsulated Control
    Message (ECM) header as defined in \[[RFC9301](#RFC9301){.cite
    .xref}\], or in a Map-Reply message to support confidentiality,
    integrity protection, and verification of EID-Prefix
    authorization.[¶](#section-3-1.8){.pilcrow}
:   

OTK Authentication Data (OTK-AD):
:   The portion of ECM Authentication Data that contains a One-Time
    Key.[¶](#section-3-1.10){.pilcrow}
:   

EID Authentication Data (EID-AD):
:   The portion of ECM and Map-Reply Authentication Data used for
    verification of EID-Prefix
    authorization.[¶](#section-3-1.12){.pilcrow}
:   

Packet Authentication Data (PKT-AD):
:   The portion of Map-Reply Authentication Data used to protect the
    integrity of the Map-Reply message.[¶](#section-3-1.14){.pilcrow}
:   

For definitions of other terms, notably Map-Request, Map-Reply, Ingress
Tunnel Router (ITR), Egress Tunnel Router (ETR), Map-Server (MS), and
Map-Resolver (MR), please consult the LISP specification
\[[RFC9301](#RFC9301){.cite .xref}\].[¶](#section-3-2){.pilcrow}
:::
:::

::: {#threat-model}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [LISP-SEC Threat Model](#name-lisp-sec-threat-model){.section-name .selfRef} {#name-lisp-sec-threat-model}

LISP-SEC addresses the control plane threats, described in Sections
[3.7](https://www.rfc-editor.org/rfc/rfc7835#section-3.7){.relref} and
[3.8](https://www.rfc-editor.org/rfc/rfc7835#section-3.8){.relref} of
\[[RFC7835](#RFC7835){.cite .xref}\], that target EID-to-RLOC mappings,
including manipulations of Map-Request and Map-Reply messages and
malicious ETR EID-Prefix overclaiming. LISP-SEC makes two main
assumptions: (1) the LISP Mapping System is expected to deliver a
Map-Request message to their intended destination ETR as identified by
the EID, and (2) no on-path attack can be mounted within the LISP
Mapping System. How the Mapping System is protected from on-path attacks
depends on the particular Mapping System used and is out of the scope of
this memo. Furthermore, while LISP-SEC enables detection of EID-Prefix
overclaiming attacks, it assumes that Map-Servers can verify the
EID-Prefix authorization at registration
time.[¶](#section-4-1){.pilcrow}

According to the threat model described in \[[RFC7835](#RFC7835){.cite
.xref}\], LISP-SEC assumes that any kind of attack, including on-path
attacks, can be mounted outside of the boundaries of the LISP Mapping
System. An on-path attacker outside of the LISP Mapping System can, for
example, hijack Map-Request and Map-Reply messages, spoofing the
identity of a LISP node. Another example of an on-path attack, called an
overclaiming attack, can be mounted by a malicious ETR by overclaiming
the EID-Prefixes for which it is authoritative. In this way, the ETR can
maliciously redirect traffic.[¶](#section-4-2){.pilcrow}
:::
:::

::: {#operations}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Protocol Operations](#name-protocol-operations){.section-name .selfRef} {#name-protocol-operations}

The goal of the security mechanisms defined in
\[[RFC9301](#RFC9301){.cite .xref}\] is to prevent unauthorized
insertion of mapping data by providing origin authentication and
integrity protection for the Map-Register and by using the nonce to
detect an unsolicited Map-Reply sent by off-path
attackers.[¶](#section-5-1){.pilcrow}

LISP-SEC builds on top of the security mechanisms defined in
\[[RFC9301](#RFC9301){.cite .xref}\] to address the threats described in
[Section 4](#threat-model){.auto .internal .xref} by leveraging the
trust relationships existing among the LISP entities
\[[RFC9301](#RFC9301){.cite .xref}\] participating in the exchange of
the Map-Request/Map-Reply messages. Those trust relationships (see also
[Section 7](#security){.auto .internal .xref} and
\[[RFC9301](#RFC9301){.cite .xref}\]) are used to securely distribute,
as described in [Section 8.4](#wrap){.auto .internal .xref}, a
per-message One-Time Key (OTK) that provides origin authentication,
integrity, and anti-replay protection to mapping data conveyed via the
mapping lookup process and that effectively prevents overclaiming
attacks. The processing of security parameters during the
Map-Request/Map-Reply exchange is as follows:[¶](#section-5-2){.pilcrow}

-   [Per each Map-Request message, a new ITR-OTK is generated and stored
    at the ITR and is securely transported to the
    Map-Server.[¶](#section-5-3.1){.pilcrow}]{#section-5-3.1}
-   [The Map-Server uses the ITR-OTK to compute a Hashed Message
    Authentication Code (HMAC) \[[RFC2104](#RFC2104){.cite .xref}\] that
    protects the integrity of the mapping data known to the Map-Server
    to prevent overclaiming attacks. The Map-Server also derives a new
    OTK, the MS-OTK, that is passed to the ETR by applying a Key
    Derivation Function (KDF) (e.g., \[[RFC5869](#RFC5869){.cite
    .xref}\]) to the
    ITR-OTK.[¶](#section-5-3.2){.pilcrow}]{#section-5-3.2}
-   [The ETR uses the MS-OTK to compute an HMAC that protects the
    integrity of the Map-Reply sent to the
    ITR.[¶](#section-5-3.3){.pilcrow}]{#section-5-3.3}
-   [Finally, the ITR uses the stored ITR-OTK to verify the integrity of
    the mapping data provided by both the Map-Server and the ETR, and to
    verify that no overclaiming attacks were mounted along the path
    between the Map-Server and the
    ITR.[¶](#section-5-3.4){.pilcrow}]{#section-5-3.4}

[Section 6](#encap){.auto .internal .xref} provides the detailed
description of the LISP-SEC control messages and their processing, while
the rest of this section describes the flow of LISP protocol operations
at each entity involved in the Map-Request/Map-Reply
exchange:[¶](#section-5-4){.pilcrow}

1.  [The ITR, upon needing to transmit a Map-Request message, generates
    and stores an OTK (ITR-OTK). This ITR-OTK is encrypted and included
    into the Encapsulated Control Message (ECM) that contains the
    Map-Request sent to the
    Map-Resolver.[¶](#section-5-5.1){.pilcrow}]{#section-5-5.1}
2.  [The Map-Resolver decapsulates the ECM, decrypts the ITR-OTK (if
    needed), and forwards through the Mapping System the received
    Map-Request and the ITR-OTK, as part of a new ECM. The LISP Mapping
    System delivers the ECM to the appropriate Map-Server, as identified
    by the EID destination address of the
    Map-Request.[¶](#section-5-5.2){.pilcrow}]{#section-5-5.2}
3.  [The Map-Server is configured with the location mappings and policy
    information for the ETR responsible for the EID destination address.
    Using this preconfigured information, the Map-Server, after the
    decapsulation of the ECM, finds the longest-match EID-Prefix that
    covers the requested EID in the received Map-Request. The Map-Server
    adds this EID-Prefix, together with an HMAC computed using the
    ITR-OTK, to a new ECM that contains the received
    Map-Request.[¶](#section-5-5.3){.pilcrow}]{#section-5-5.3}
4.  [The Map-Server derives a new OTK, the MS-OTK, by applying a KDF to
    the ITR-OTK. This MS-OTK is included in the ECM that the Map-Server
    uses to forward the Map-Request to the
    ETR.[¶](#section-5-5.4){.pilcrow}]{#section-5-5.4}
5.  [If the Map-Server is acting in proxy mode, as specified in
    \[[RFC9301](#RFC9301){.cite .xref}\], the ETR is not involved in the
    generation of the Map-Reply and steps 6 and 7 are skipped. In this
    case, the Map-Server generates the Map-Reply on behalf of the ETR,
    as described in [Section 6.7.2](#proxy){.auto .internal
    .xref}.[¶](#section-5-5.5){.pilcrow}]{#section-5-5.5}
6.  [The ETR, upon receiving the ECM-Encapsulated Map-Request from the
    Map-Server, decrypts the MS-OTK (if needed), and originates a
    Map-Reply that contains the EID-to-RLOC mapping information as
    specified in \[[RFC9301](#RFC9301){.cite
    .xref}\].[¶](#section-5-5.6){.pilcrow}]{#section-5-5.6}
7.  [The ETR computes an HMAC over the Map-Reply, keyed with MS-OTK to
    protect the integrity of the whole Map-Reply. The ETR also copies
    the EID-Prefix authorization data that the Map-Server included in
    the ECM-Encapsulated Map-Request into the Map-Reply message. The ETR
    then sends the complete Map-Reply message to the requesting
    ITR.[¶](#section-5-5.7){.pilcrow}]{#section-5-5.7}
8.  [The ITR, upon receiving the Map-Reply, uses the locally stored
    ITR-OTK to verify the integrity of the EID-Prefix authorization data
    included in the Map-Reply by the Map-Server. The ITR computes the
    MS-OTK by applying the same KDF (as specified in the
    ECM-Encapsulated Map-Reply) used by the Map-Server and verifies the
    integrity of the
    Map-Reply.[¶](#section-5-5.8){.pilcrow}]{#section-5-5.8}
:::
:::

::: {#encap}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [LISP-SEC Control Messages Details](#name-lisp-sec-control-messages-d){.section-name .selfRef} {#name-lisp-sec-control-messages-d}

LISP-SEC metadata associated with a Map-Request is transported within
the Encapsulated Control Message that contains the
Map-Request.[¶](#section-6-1){.pilcrow}

LISP-SEC metadata associated with the Map-Reply is transported within
the Map-Reply itself.[¶](#section-6-2){.pilcrow}

These specifications use an HMAC in various places (as described in the
following). The HMAC function AUTH-HMAC-SHA-256-128
\[[RFC6234](#RFC6234){.cite .xref}\] [MUST]{.bcp14} be supported in
LISP-SEC implementations. LISP-SEC deployments [SHOULD]{.bcp14} use the
AUTH-HMAC-SHA-256-128 HMAC function, except when communicating with
older implementations that only support AUTH-HMAC-SHA-1-96
\[[RFC2104](#RFC2104){.cite .xref}\].[¶](#section-6-3){.pilcrow}

::: {#ECM_extensions}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [Encapsulated Control Message LISP-SEC Extensions](#name-encapsulated-control-messag){.section-name .selfRef} {#name-encapsulated-control-messag}

LISP-SEC uses the ECM defined in \[[RFC9301](#RFC9301){.cite .xref}\]
with the S-bit set to 1 to indicate that the LISP header includes
Authentication Data (AD). The format of the LISP-SEC ECM AD is defined
in [Figure 1](#fig-AD){.auto .internal .xref}. OTK-AD stands for
One-Time Key Authentication Data and EID-AD stands for EID
Authentication Data.[¶](#section-6.1-1){.pilcrow}

[]{#name-lisp-sec-ecm-authentication}

::: {#fig-AD}
::: {#section-6.1-2.1 .alignCenter .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  ECM AD Type  |   Unassigned  |        Requested HMAC ID      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\
    |              OTK Length       |     Key ID    | OTK Wrap. ID  | |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
    |                       One-Time-Key Preamble ...               | |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+OTK-AD
    |                   ... One-Time-Key Preamble                   | |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
    ~                      One-Time Key (128 bits)                  ~/
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ <---+
    |           EID-AD Length       |           KDF ID              |     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
    | Record Count  |E| Unassigned  |         EID HMAC ID           |EID-AD
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\    |
    |  Unassigned   | EID mask-len  |           EID-AFI             | |   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ Rec |
    ~                          EID-Prefix ...                       ~ |   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+/    |
    ~                            EID HMAC                           ~     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ <---+
:::

[Figure 1](#figure-1){.selfRef}: [LISP-SEC ECM Authentication
Data](#name-lisp-sec-ecm-authentication){.selfRef}
:::

[]{.break}

ECM AD Type:
:   1 (LISP-SEC Authentication Data). See [Section 8](#IANA){.auto
    .internal .xref}.[¶](#section-6.1-3.2){.pilcrow}
:   

Unassigned:
:   Set to 0 on transmission and ignored on
    receipt.[¶](#section-6.1-3.4){.pilcrow}
:   

Requested HMAC ID:
:   The HMAC algorithm, which will be used to protect the mappings,
    requested by the ITR. Permitted values are registered in the
    LISP-SEC Authentication Data HMAC ID (see [Section 8.3](#HMAC){.auto
    .internal .xref}). Refer to [Section 6.4](#itr){.auto .internal
    .xref} for more details.[¶](#section-6.1-3.6){.pilcrow}
:   

OTK Length:
:   The length (in bytes) of the OTK Authentication Data (OTK-AD), which
    contains the OTK Preamble and the
    OTK.[¶](#section-6.1-3.8){.pilcrow}
:   

Key ID:
:   The identifier of the pre-shared secret shared by an ITR and the
    Map-Resolver, and by the Map-Server and an ETR. Per-message keys are
    derived from the pre-shared secret to encrypt, authenticate the
    origin, and protect the integrity of the OTK. The Key ID allows to
    rotate between multiple pre-shared secrets in a nondisruptive
    way.[¶](#section-6.1-3.10){.pilcrow}
:   

OTK Wrapping ID (OTK Wrap. ID):
:   The identifier of the Key Derivation Function and of the key
    wrapping algorithm used to encrypt the One-Time-Key. Permitted
    values are registered in the LISP-SEC Authentication Data Key Wrap
    ID (see [Section 8.4](#wrap){.auto .internal .xref}). Refer to
    [Section 6.5](#encryption){.auto .internal .xref} for more
    details.[¶](#section-6.1-3.12){.pilcrow}
:   

One-Time-Key Preamble:
:   Set to 0 if the OTK is not encrypted. When the OTK is encrypted,
    this field [MAY]{.bcp14} carry additional metadata resulting from
    the key wrapping operation. When a 128-bit OTK is sent unencrypted
    by a Map-Resolver, the OTK Preamble is set to 0x0000000000000000 (64
    bits). See [Section 6.5.1](#null){.auto .internal .xref} for
    details.[¶](#section-6.1-3.14){.pilcrow}
:   

One-Time-Key:
:   The OTK wrapped as specified by OTK Wrapping ID. See [Section
    6.5](#encryption){.auto .internal .xref} for
    details.[¶](#section-6.1-3.16){.pilcrow}
:   

EID-AD Length:
:   Length (in bytes) of the EID Authentication Data (EID-AD). The ITR
    [MUST]{.bcp14} set the EID-AD Length to 4 bytes, as it only fills
    the \'KDF ID\' field, and all the remaining fields part of the
    EID-AD are not present. An EID-AD [MAY]{.bcp14} contain multiple
    EID-Records. Each EID-Record is 4 bytes long, plus the length of the
    AFI-encoded EID-Prefix.[¶](#section-6.1-3.18){.pilcrow}
:   

KDF ID:
:   Identifier of the Key Derivation Function used to derive the MS-OTK.
    Permitted values are registered in the LISP-SEC Authentication Data
    Key Derivation Function ID (see [Section 8.5](#kdf){.auto .internal
    .xref}). Refer to [Section 6.7](#map-server){.auto .internal .xref}
    for more details.[¶](#section-6.1-3.20){.pilcrow}
:   

Record Count:
:   As defined in [Section
    5.2](https://www.rfc-editor.org/rfc/rfc9301#section-5.2){.relref} of
    \[[RFC9301](#RFC9301){.cite
    .xref}\].[¶](#section-6.1-3.22){.pilcrow}
:   

E:
:   ETR-Cant-Sign bit. If this bit is set to 1, it signals to the ITR
    that at least one of the ETRs that is authoritative for the
    EID-Prefixes of this Map-Reply has not enabled LISP-SEC. Only a
    Map-Server can set this bit. See [Section 6.7](#map-server){.auto
    .internal .xref} for more details.[¶](#section-6.1-3.24){.pilcrow}
:   

Unassigned:
:   Set to 0 on transmission and ignored on
    receipt.[¶](#section-6.1-3.26){.pilcrow}
:   

EID HMAC ID:
:   Identifier of the HMAC algorithm used to protect the integrity of
    the EID-AD. This field is filled by the Map-Server that computed the
    EID-Prefix HMAC. See [Section 6.7.1](#EID-AD){.auto .internal .xref}
    for more details.[¶](#section-6.1-3.28){.pilcrow}
:   

EID mask-len:
:   As defined in [Section
    5.2](https://www.rfc-editor.org/rfc/rfc9301#section-5.2){.relref} of
    \[[RFC9301](#RFC9301){.cite
    .xref}\].[¶](#section-6.1-3.30){.pilcrow}
:   

EID-AFI:
:   As defined in [Section
    5.2](https://www.rfc-editor.org/rfc/rfc9301#section-5.2){.relref} of
    \[[RFC9301](#RFC9301){.cite
    .xref}\].[¶](#section-6.1-3.32){.pilcrow}
:   

EID-Prefix:
:   As defined in [Section
    5.2](https://www.rfc-editor.org/rfc/rfc9301#section-5.2){.relref} of
    \[[RFC9301](#RFC9301){.cite
    .xref}\].[¶](#section-6.1-3.34){.pilcrow}
:   

EID HMAC:
:   HMAC of the EID-AD computed and inserted by a Map-Server. See
    [Section 6.7.1](#EID-AD){.auto .internal .xref} for more
    details.[¶](#section-6.1-3.36){.pilcrow}
:   
:::
:::

::: {#MR_extensions}
::: {#section-6.2 .section}
### [6.2.](#section-6.2){.section-number .selfRef} [Map-Reply LISP-SEC Extensions](#name-map-reply-lisp-sec-extensio){.section-name .selfRef} {#name-map-reply-lisp-sec-extensio}

LISP-SEC uses the Map-Reply defined in \[[RFC9301](#RFC9301){.cite
.xref}\], with Type set to 2 and S-bit set to 1 to indicate that the
Map-Reply message includes Authentication Data (AD). The format of the
LISP-SEC Map-Reply Authentication Data is defined in [Figure
2](#map-reply-AD){.auto .internal .xref}. PKT-AD is the Packet
Authentication Data that covers the Map-Reply
payload.[¶](#section-6.2-1){.pilcrow}

[]{#name-lisp-sec-map-reply-authenti}

::: {#map-reply-AD}
::: {#section-6.2-2.1 .alignCenter .art-text .artwork}
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  MR AD Type   |                Unassigned                     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ <---+
    |           EID-AD Length       |           KDF ID              |     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
    | Record Count  |   Unassigned  |         EID HMAC ID           |EID-AD
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\    |
    |  Unassigned   | EID mask-len  |           EID-AFI             | |   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ Rec |
    ~                          EID-Prefix ...                       ~ |   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+/    |
    ~                            EID HMAC                           ~     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ <---+
    |         PKT-AD Length         |         PKT HMAC ID           |\
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
    ~                            PKT HMAC                           ~PKT-AD
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+/
:::

[Figure 2](#figure-2){.selfRef}: [LISP-SEC Map-Reply Authentication
Data](#name-lisp-sec-map-reply-authenti){.selfRef}
:::

[]{.break}

MR AD Type:
:   1 (LISP-SEC Authentication Data). See [Section 8](#IANA){.auto
    .internal .xref}.[¶](#section-6.2-3.2){.pilcrow}
:   

EID-AD Length:
:   Length (in bytes) of the EID-AD (see [Section
    6.1](#ECM_extensions){.auto .internal
    .xref}).[¶](#section-6.2-3.4){.pilcrow}
:   

KDF ID:
:   Identifier of the Key Derivation Function used to derive MS-OTK (see
    [Section 6.1](#ECM_extensions){.auto .internal
    .xref}).[¶](#section-6.2-3.6){.pilcrow}
:   

Record Count:
:   The number of records in this Map-Reply message (see [Section
    6.1](#ECM_extensions){.auto .internal
    .xref}).[¶](#section-6.2-3.8){.pilcrow}
:   

Unassigned:
:   Set to 0 on transmission and ignored on
    receipt.[¶](#section-6.2-3.10){.pilcrow}
:   

EID HMAC ID:
:   Identifier of the HMAC algorithm used to protect the integrity of
    the EID-AD (see [Section 6.1](#ECM_extensions){.auto .internal
    .xref}).[¶](#section-6.2-3.12){.pilcrow}
:   

EID mask-len:
:   Mask length for EID-Prefix (see [Section 6.1](#ECM_extensions){.auto
    .internal .xref}).[¶](#section-6.2-3.14){.pilcrow}
:   

EID-AFI:
:   See [Section 6.1](#ECM_extensions){.auto .internal
    .xref}.[¶](#section-6.2-3.16){.pilcrow}
:   

EID-Prefix:
:   See [Section 6.1](#ECM_extensions){.auto .internal
    .xref}.[¶](#section-6.2-3.18){.pilcrow}
:   

EID HMAC:
:   See [Section 6.1](#ECM_extensions){.auto .internal
    .xref}.[¶](#section-6.2-3.20){.pilcrow}
:   

PKT-AD Length:
:   Length (in bytes) of the Packet Authentication Data
    (PKT-AD).[¶](#section-6.2-3.22){.pilcrow}
:   

PKT HMAC ID:
:   Identifier of the HMAC algorithm used to protect the integrity of
    the Map-Reply (see [Section 6.5](#encryption){.auto .internal
    .xref}).[¶](#section-6.2-3.24){.pilcrow}
:   

PKT HMAC:
:   HMAC of the whole Map-Reply packet to protect its integrity,
    including the LISP-SEC Authentication Data (from the \'Map-Reply
    Type\' field to the \'PKT HMAC\' field), which allow message
    authentication.[¶](#section-6.2-3.26){.pilcrow}
:   
:::
:::

::: {#section-6.3 .section}
### [6.3.](#section-6.3){.section-number .selfRef} [Map-Register LISP-SEC Extensions](#name-map-register-lisp-sec-exten){.section-name .selfRef} {#name-map-register-lisp-sec-exten}

The S-bit in the Map-Register message (see \[[RFC9301](#RFC9301){.cite
.xref}\]) indicates to the Map-Server that the registering ETR is
LISP-SEC enabled. An ETR that supports LISP-SEC [MUST]{.bcp14} set the
S-bit in its Map-Register messages.[¶](#section-6.3-1){.pilcrow}
:::

::: {#itr}
::: {#section-6.4 .section}
### [6.4.](#section-6.4){.section-number .selfRef} [ITR Processing: Generating a Map-Request](#name-itr-processing-generating-a){.section-name .selfRef} {#name-itr-processing-generating-a}

Upon creating a Map-Request, the ITR generates a random ITR-OTK that is
stored locally, until the corresponding Map-Reply is received (see
[Section 6.9](#itr-receive){.auto .internal .xref}), together with the
nonce generated as specified in \[[RFC9301](#RFC9301){.cite
.xref}\].[¶](#section-6.4-1){.pilcrow}

The ITR [MAY]{.bcp14} use the \'KDF ID\' field to indicate the
recommended KDF algorithm according to local policy. The Map-Server can
overwrite the KDF ID if it does not support the KDF ID recommended by
the ITR (see [Section 6.7](#map-server){.auto .internal .xref}). A KDF
value of NOPREF (0) may be used to specify that the ITR has no preferred
KDF ID.[¶](#section-6.4-2){.pilcrow}

ITR-OTK confidentiality and integrity protection [MUST]{.bcp14} be
provided in the path between the ITR and the Map-Resolver. This can be
achieved either by encrypting the ITR-OTK with the pre-shared secret
known to the ITR and the Map-Resolver (see [Section
6.5](#encryption){.auto .internal .xref}) or by enabling DTLS
\[[RFC9147](#RFC9147){.cite .xref}\] between the ITR and the
Map-Resolver.[¶](#section-6.4-3){.pilcrow}

The Map-Request (as defined in \[[RFC9301](#RFC9301){.cite .xref}\])
[MUST]{.bcp14} be encapsulated as a LISP Control Message in an ECM, with
the S-bit set to 1, to indicate the presence of Authentication Data.
Such a message is also called a \"Protected Map-Request\" in this
memo.[¶](#section-6.4-4){.pilcrow}

The ITR-OTK is wrapped with the algorithm specified by the \'OTK
Wrapping ID\' field. See [Section 6.5](#encryption){.auto .internal
.xref} for further details on OTK encryption. If the NULL-KEY-WRAP-128
algorithm (see [Section 8.4](#wrap){.auto .internal .xref}) is selected,
and no other encryption mechanism (e.g., DTLS) is enabled in the path
between the ITR and the Map-Resolver, the Map-Request [MUST]{.bcp14} be
dropped, and an appropriate log action [SHOULD]{.bcp14} be taken.
Implementations may include mechanisms (which are beyond the scope of
this document) to avoid log resource exhaustion
attacks.[¶](#section-6.4-5){.pilcrow}

The \'Requested HMAC ID\' field contains the suggested HMAC algorithm to
be used by the Map-Server and the ETR to protect the integrity of the
ECM Authentication Data and of the Map-Reply. A HMAC ID value of NONE
(0) [MAY]{.bcp14} be used to specify that the ITR has no preferred HMAC
ID.[¶](#section-6.4-6){.pilcrow}

The \'KDF ID\' field specifies the suggested Key Derivation Function to
be used by the Map-Server to derive the MS-OTK. A KDF value of NONE (0)
may be used to specify that the ITR has no preferred KDF
ID.[¶](#section-6.4-7){.pilcrow}

The EID-AD Length is set to 4 bytes, since the Authentication Data does
not contain EID-Prefix Authentication Data, and the EID-AD contains only
the \'KDF ID\' field.[¶](#section-6.4-8){.pilcrow}

If the ITR is directly connected to a Mapping System, such as LISP+ALT
\[[RFC6836](#RFC6836){.cite .xref}\], it performs the functions of both
the ITR and the Map-Resolver, forwarding the Protected Map-Request as
described in [Section 6.6](#map-resolver){.auto .internal
.xref}.[¶](#section-6.4-9){.pilcrow}

The processing performed by Proxy ITRs (PITRs) is equivalent to the
processing of an ITR; hence, the procedure described above
applies.[¶](#section-6.4-10){.pilcrow}
:::
:::

::: {#encryption}
::: {#section-6.5 .section}
### [6.5.](#section-6.5){.section-number .selfRef} [Encrypting and Decrypting an OTK](#name-encrypting-and-decrypting-a){.section-name .selfRef} {#name-encrypting-and-decrypting-a}

MS-OTK confidentiality and integrity protection [MUST]{.bcp14} be
provided in the path between the Map-Server and the ETR. This can be
achieved either by enabling DTLS between the Map-Server and the ETR or
by encrypting the MS-OTK with the pre-shared secret known to the
Map-Server and the ETR \[[RFC9301](#RFC9301){.cite
.xref}\].[¶](#section-6.5-1){.pilcrow}

Similarly, ITR-OTK confidentiality and integrity protection
[MUST]{.bcp14} be provided in the path between the ITR and the
Map-Resolver. This can be achieved either by enabling DTLS between the
Map-Server and the ITR or by encrypting the ITR-OTK with the pre-shared
secret known to the ITR and the Map-Resolver. The ITR/Map-Resolver
pre-shared key is similar to the Map-Server/ETR pre-shared
key.[¶](#section-6.5-2){.pilcrow}

This section describes OTK processing in the ITR/Map-Resolver path, as
well as in the Map-Server/ETR path.[¶](#section-6.5-3){.pilcrow}

It\'s important to note that, to prevent ETR\'s overclaiming attacks,
the ITR/Map-Resolver pre-shared secret [MUST]{.bcp14} be independent
from the Map-Server/ETR pre-shared secret.[¶](#section-6.5-4){.pilcrow}

The OTK is wrapped using the algorithm specified in the \'OTK Wrapping
ID\' field. This field identifies both the:[¶](#section-6.5-5){.pilcrow}

-   [Key Encryption Algorithm used to encrypt the wrapped OTK
    and[¶](#section-6.5-6.1){.pilcrow}]{#section-6.5-6.1}
-   [Key Derivation Function used to derive a per-message encryption
    key.[¶](#section-6.5-6.2){.pilcrow}]{#section-6.5-6.2}

Implementations of this specification [MUST]{.bcp14} support the OTK
Wrapping ID AES-KEY-WRAP-128+HKDF-SHA256, which specifies the use of the
HKDF-SHA256 Key Derivation Function specified in
\[[RFC5869](#RFC5869){.cite .xref}\] to derive a per-message encryption
key (per-msg-key), as well as the AES-KEY-WRAP-128 key wrap algorithm
used to encrypt a 128-bit OTK, according to \[[RFC3394](#RFC3394){.cite
.xref}\].[¶](#section-6.5-7){.pilcrow}

Implementations of this specification [MUST]{.bcp14} support OTK
Wrapping NULL-KEY-WRAP-128. NULL-KEY-WRAP-128 is used to carry an
unencrypted 128-bit OTK, with a 64-bit preamble set to
0x0000000000000000 (64 bits).[¶](#section-6.5-8){.pilcrow}

The key wrapping process for OTK Wrapping ID
AES-KEY-WRAP-128+HKDF-SHA256 is described
below:[¶](#section-6.5-9){.pilcrow}

1.  [The KDF and key wrap algorithms are identified by the value of the
    \'OTK Wrapping ID\' field. The initial values are documented in
    [Table 5](#tableKWF){.auto .internal
    .xref}.[¶](#section-6.5-10.1){.pilcrow}]{#section-6.5-10.1}

2.  [If the NULL-KEY-WRAP-128 algorithm (see [Section 8.4](#wrap){.auto
    .internal .xref}) is selected and DTLS is not enabled, the
    Map-Request [MUST]{.bcp14} be dropped and an appropriate log action
    [SHOULD]{.bcp14} be taken. Implementations may include mechanisms
    (which are beyond the scope of this document) to avoid log resource
    exhaustion
    attacks.[¶](#section-6.5-10.2){.pilcrow}]{#section-6.5-10.2}

3.  [The pre-shared secret used to derive the per-msg-key is represented
    by PSK\[Key ID\], which is the pre-shared secret identified by the
    \'Key ID\'.[¶](#section-6.5-10.3){.pilcrow}]{#section-6.5-10.3}

4.  ::: {#section-6.5-10.4}
    The 128-bit-long per-message encryption key is computed
    as:[¶](#section-6.5-10.4.1){.pilcrow}

    per-msg-key = KDF( nonce + s + PSK\[Key ID\]
    )[¶](#section-6.5-10.4.2){.pilcrow}

    where the nonce is the value in the \'Nonce\' field of the
    Map-Request, \'s\' is the string \"OTK-Key-Wrap\", and the
    operation\'+\' just indicates string
    concatenation.[¶](#section-6.5-10.4.3){.pilcrow}
    :::

5.  [The per-msg-key is then used to wrap the OTK with AES-KEY-WRAP-128,
    as specified in [Section
    2.2.1](https://www.rfc-editor.org/rfc/rfc3394#section-2.2.1){.relref}
    of \[[RFC3394](#RFC3394){.cite .xref}\]. The AES Key Wrap
    Initialization Value [MUST]{.bcp14} be set to 0xA6A6A6A6A6A6A6A6 (64
    bits). The output of the AES key wrap operation is 192 bits long.
    The most significant 64 bits are copied in the \'One-Time Key
    Preamble\' field, while the 128 least significant bits are copied in
    the \'One-Time Key\' field of the LISP-SEC Authentication
    Data.[¶](#section-6.5-10.5){.pilcrow}]{#section-6.5-10.5}

When decrypting an encrypted OTK, the receiver [MUST]{.bcp14} verify
that the Initialization Value resulting from the AES key wrap decryption
operation is equal to 0xA6A6A6A6A6A6A6A6. If this verification fails,
the receiver [MUST]{.bcp14} discard the entire
message.[¶](#section-6.5-11){.pilcrow}

::: {#null}
::: {#section-6.5.1 .section}
#### [6.5.1.](#section-6.5.1){.section-number .selfRef} [Unencrypted OTK](#name-unencrypted-otk){.section-name .selfRef} {#name-unencrypted-otk}

However, when DTLS is enabled, the OTK [MAY]{.bcp14} be sent unencrypted
as transport layer security is providing confidentiality and integrity
protection.[¶](#section-6.5.1-1){.pilcrow}

When a 128-bit OTK is sent unencrypted, the OTK Wrapping ID is set to
NULL_KEY_WRAP_128, and the OTK Preamble is set to 0x0000000000000000 (64
bits).[¶](#section-6.5.1-2){.pilcrow}
:::
:::
:::
:::

::: {#map-resolver}
::: {#section-6.6 .section}
### [6.6.](#section-6.6){.section-number .selfRef} [Map-Resolver Processing](#name-map-resolver-processing){.section-name .selfRef} {#name-map-resolver-processing}

Upon receiving a Protected Map-Request, the Map-Resolver decapsulates
the ECM. The ITR-OTK, if encrypted, is decrypted as specified in
[Section 6.5](#encryption){.auto .internal
.xref}.[¶](#section-6.6-1){.pilcrow}

Protecting the confidentiality of the ITR-OTK and, in general, the
security of how the Map-Request is handed by the Map-Resolver to the
Map-Server is specific to the particular Mapping System used and is
outside of the scope of this memo.[¶](#section-6.6-2){.pilcrow}

In Mapping Systems where the Map-Server is compliant with
\[[RFC9301](#RFC9301){.cite .xref}\], the Map-Resolver originates a new
ECM header with the S-bit set, which contains the unencrypted ITR-OTK,
as specified in [Section 6.5](#encryption){.auto .internal .xref}, and
the other data derived from the ECM Authentication Data of the received
Encapsulated Map-Request.[¶](#section-6.6-3){.pilcrow}

The Map-Resolver then forwards to the Map-Server the received
Map-Request, which is encapsulated in the new ECM header that includes
the newly computed \'Authentication Data\'
fields.[¶](#section-6.6-4){.pilcrow}
:::
:::

::: {#map-server}
::: {#section-6.7 .section}
### [6.7.](#section-6.7){.section-number .selfRef} [Map-Server Processing](#name-map-server-processing){.section-name .selfRef} {#name-map-server-processing}

Upon receiving a Protected Map-Request, the Map-Server processes it
according to the setting of the S-bit and the P-bit in the Map-Register
received from the ETRs authoritative for that prefix, as described
below.[¶](#section-6.7-1){.pilcrow}

While processing the Map-Request, the Map-Server can overwrite the \'KDF
ID\' field if it does not support the KDF ID recommended by the ITR.
Processing of the Map-Request [MUST]{.bcp14} proceed in the order
described in the table below, applying the process corresponding to the
first rule that matches the conditions indicated in the first
column:[¶](#section-6.7-2){.pilcrow}

[]{#name-map-request-processing}

::: {#tableMRP}
  Matching Condition                                                                                                             Processing
  ------------------------------------------------------------------------------------------------------------------------------ ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  1\. At least one of the ETRs authoritative for the EID-Prefix included in the Map-Request registered with the P-bit set to 1   The Map-Server [MUST]{.bcp14} generate a LISP-SEC-protected Map-Reply, as specified in [Section 6.7.2](#proxy){.auto .internal .xref}. The ETR-Cant-Sign E-bit in the EID Authentication Data (EID-AD) [MUST]{.bcp14} be set to 0.
  2\. At least one of the ETRs authoritative for the EID-Prefix included in the Map-Request registered with the S-bit set to 1   The Map-Server [MUST]{.bcp14} generate a LISP-SEC-protected Encapsulated Map-Request (as specified in [Section 6.7.1](#EID-AD){.auto .internal .xref}) to be sent to one of the authoritative ETRs that registered with the S-bit set to 1 (and the P-bit set to 0). If there is at least one ETR that registered with the S-bit set to 0, the ETR-Cant-Sign E-bit of the EID-AD [MUST]{.bcp14} be set to 1 to signal the ITR that a non-LISP-SEC Map-Request might reach additional ETRs that have LISP-SEC disabled.
  3\. All the ETRs authoritative for the EID-Prefix included in the Map-Request registered with the S-bit set to 0               The Map-Server [MUST]{.bcp14} send a Negative Map-Reply protected with LISP-SEC, as described in [Section 6.7.2](#proxy){.auto .internal .xref}. The ETR-Cant-Sign E-bit [MUST]{.bcp14} be set to 1 to signal the ITR that a non-LISP-SEC Map-Request might reach additional ETRs that have LISP-SEC disabled.

  : [Table 1](#table-1){.selfRef}: [Map-Request
  Processing](#name-map-request-processing){.selfRef}
:::

In this way, the ITR that sent a LISP-SEC-protected Map-Request always
receives a LISP-SEC-protected Map-Reply. However, the ETR-Cant-Sign
E-bit set to 1 specifies that a non-LISP-SEC Map-Request might reach
additional ETRs that have LISP-SEC disabled. This mechanism allows the
ITR to downgrade to non-LISP-SEC requests, which does not protect
against threats described in [Section 4](#threat-model){.auto .internal
.xref}.[¶](#section-6.7-4){.pilcrow}

::: {#EID-AD}
::: {#section-6.7.1 .section}
#### [6.7.1.](#section-6.7.1){.section-number .selfRef} [Generating a LISP-SEC-Protected Encapsulated Map-Request](#name-generating-a-lisp-sec-prote){.section-name .selfRef} {#name-generating-a-lisp-sec-prote}

The Map-Server decapsulates the ECM and generates new ECM Authentication
Data. The Authentication Data includes the OTK-AD and the EID-AD, which
contains EID-Prefix authorization information that are eventually
received by the requesting ITR.[¶](#section-6.7.1-1){.pilcrow}

The Map-Server updates the OTK-AD by deriving a new OTK (MS-OTK) from
the ITR-OTK received with the Map-Request. MS-OTK is derived by applying
the Key Derivation Function specified in the \'KDF ID\' field. If the
algorithm specified in the \'KDF ID\' field is not supported, the
Map-Server uses a different algorithm to derive the key and updates the
\'KDF ID\' field accordingly.[¶](#section-6.7.1-2){.pilcrow}

The Map-Request [MUST]{.bcp14} be encapsulated in an ECM, with the S-bit
set to 1, to indicate the presence of Authentication
Data.[¶](#section-6.7.1-3){.pilcrow}

MS-OTK is wrapped with the algorithm specified by the \'OTK Wrapping
ID\' field. See [Section 6.5](#encryption){.auto .internal .xref} for
further details on OTK encryption. If the NULL-KEY-WRAP-128 algorithm is
selected and DTLS is not enabled in the path between the Map-Server and
the ETR, the Map-Request [MUST]{.bcp14} be dropped and an appropriate
log action [SHOULD]{.bcp14} be taken.[¶](#section-6.7.1-4){.pilcrow}

In the EID-AD, the Map-Server includes in the EID-AD the
longest-match-registered EID-Prefix for the destination EID and an HMAC
of this EID-Prefix. The HMAC is keyed with the ITR-OTK contained in the
received ECM Authentication Data, and the HMAC algorithm is chosen
according to the \'Requested HMAC ID\' field. If the Map-Server does not
support this algorithm, the Map-Server uses a different algorithm and
specifies it in the \'EID HMAC ID\' field. The scope of the HMAC
operation [MUST]{.bcp14} cover the entire EID-AD, from the \'EID-AD
Length\' field to the \'EID HMAC\' field, which [MUST]{.bcp14} be set to
0 before the computation.[¶](#section-6.7.1-5){.pilcrow}

The Map-Server then forwards the updated ECM-Encapsulated Map-Request,
which contains the OTK-AD, the EID-AD, and the received Map-Request to
an authoritative ETR as specified in \[[RFC9301](#RFC9301){.cite
.xref}\].[¶](#section-6.7.1-6){.pilcrow}
:::
:::

::: {#proxy}
::: {#section-6.7.2 .section}
#### [6.7.2.](#section-6.7.2){.section-number .selfRef} [Generating a Proxy Map-Reply](#name-generating-a-proxy-map-repl){.section-name .selfRef} {#name-generating-a-proxy-map-repl}

A LISP-SEC proxy Map-Reply is generated according to
\[[RFC9301](#RFC9301){.cite .xref}\], with the Map-Reply S-bit set to 1.
The Map-Reply includes the Authentication Data that contains the EID-AD
computed as specified in [Section 6.7.1](#EID-AD){.auto .internal
.xref}, as well as the PKT-AD computed as specified in [Section
6.8](#etr){.auto .internal .xref}.[¶](#section-6.7.2-1){.pilcrow}
:::
:::
:::
:::

::: {#etr}
::: {#section-6.8 .section}
### [6.8.](#section-6.8){.section-number .selfRef} [ETR Processing](#name-etr-processing){.section-name .selfRef} {#name-etr-processing}

Upon receiving an ECM-Encapsulated Map-Request with the S-bit set, the
ETR decapsulates the ECM. The \'OTK\' field, if encrypted, is decrypted
as specified in [Section 6.5](#encryption){.auto .internal .xref} to
obtain the unencrypted MS-OTK.[¶](#section-6.8-1){.pilcrow}

The ETR then generates a Map-Reply as specified in
\[[RFC9301](#RFC9301){.cite .xref}\] and includes the Authentication
Data that contains the EID-AD, as received in the Encapsulated
Map-Request, as well as the PKT-AD.[¶](#section-6.8-2){.pilcrow}

The EID-AD is copied from the Authentication Data of the received
Encapsulated Map-Request.[¶](#section-6.8-3){.pilcrow}

The PKT-AD contains the HMAC of the whole Map-Reply packet, keyed with
the MS-OTK and computed using the HMAC algorithm specified in the
\'Requested HMAC ID\' field of the received Encapsulated Map-Request. If
the ETR does not support the Requested HMAC ID, it uses a different
algorithm and updates the \'PKT HMAC ID\' field accordingly. The HMAC
operation [MUST]{.bcp14} cover the entire Map-Reply, where the \'PKT
HMAC\' field [MUST]{.bcp14} be set to 0 before the
computation.[¶](#section-6.8-4){.pilcrow}

Finally, the ETR sends the Map-Reply to the requesting ITR as specified
in \[[RFC9301](#RFC9301){.cite .xref}\].[¶](#section-6.8-5){.pilcrow}
:::
:::

::: {#itr-receive}
::: {#section-6.9 .section}
### [6.9.](#section-6.9){.section-number .selfRef} [ITR Processing: Receiving a Map-Reply](#name-itr-processing-receiving-a-){.section-name .selfRef} {#name-itr-processing-receiving-a-}

In response to a Protected Map-Request, an ITR expects a Map-Reply with
the S-bit set to 1, including an EID-AD and a PKT-AD. The ITR
[MUST]{.bcp14} discard the Map-Reply
otherwise.[¶](#section-6.9-1){.pilcrow}

Upon receiving a Map-Reply, the ITR must verify the integrity of both
the EID-AD and the PKT-AD and [MUST]{.bcp14} discard the Map-Reply if
one of the integrity checks fails. After processing the Map-Reply, the
ITR [MUST]{.bcp14} discard the \<nonce,ITR-OTK> pair associated to the
Map-Reply.[¶](#section-6.9-2){.pilcrow}

The integrity of the EID-AD is verified using the ITR-OTK (stored
locally for the duration of this exchange) to recompute the HMAC of the
EID-AD using the algorithm specified in the \'EID HMAC ID\' field. If
the ITR did indicate a Requested HMAC ID in the Map-Request and the PKT
HAMC ID in the corresponding Map-Reply is different, or if the ITR did
not indicate a Requested HMAC ID in the Map-Request and the PKT HMAC ID
in the corresponding Map-Reply is not supported, then the ITR
[MUST]{.bcp14} discard the Map-Reply and send, according to
rate-limitation policies defined in \[[RFC9301](#RFC9301){.cite
.xref}\], a new Map-Request with a different \'Requested HMAC ID\'
field, according to ITR\'s local policy. The scope of the HMAC operation
covers the entire EID-AD, from the \'EID-AD Length\' field to the \'EID
HMAC\' field.[¶](#section-6.9-3){.pilcrow}

ITR [MUST]{.bcp14} set the \'EID HMAC ID\' field to 0 before computing
the HMAC.[¶](#section-6.9-4){.pilcrow}

To verify the integrity of the PKT-AD, first the MS-OTK is derived from
the locally stored ITR-OTK using the algorithm specified in the \'KDF
ID\' field. This is because the PKT-AD is generated by the ETR using the
MS-OTK. If the ITR did indicate a recommended KDF ID in the Map-Request
and the KDF ID in the corresponding Map-Reply is different or if the ITR
did not indicate a recommended KDF ID in the Map-Request and the KDF ID
in the corresponding Map-Reply is not supported, then the ITR
[MUST]{.bcp14} discard the Map-Reply and send, according to
rate-limitation policies defined in \[[RFC9301](#RFC9301){.cite
.xref}\], a new Map-Request with a different KDF ID, according to ITR\'s
local policy. The Key Derivation Function HKDF-SHA256 [MUST]{.bcp14} be
supported in LISP-SEC implementations. LISP-SEC deployments
[SHOULD]{.bcp14} use the HKDF-SHA256 HKDF function, unless older
implementations using HKDF-SHA1-128 are present in the same deployment.
Without consistent configuration of involved entities, extra delays may
be experienced. However, since HKDF-SHA1-128 and HKDF-SHA256 are
supported, the process will eventually
converge.[¶](#section-6.9-5){.pilcrow}

The derived MS-OTK is then used to recompute the HMAC of the PKT-AD
using the algorithm specified in the \'PKT HMAC ID\' field. If the \'PKT
HMAC ID\' field does not match the Requested HMAC ID, the ITR
[MUST]{.bcp14} discard the Map-Reply and send, according to
rate-limitation policies defined in \[[RFC9301](#RFC9301){.cite
.xref}\], a new Map-Request with a different Requested HMAC ID,
according to ITR\'s local policy or until all HMAC IDs supported by the
ITR have been attempted. When the \'PKT HMAC ID\' field does not match
the Requested HMAC ID, it is not possible to validate the
Map-Reply.[¶](#section-6.9-6){.pilcrow}

Each individual Map-Reply EID-Record is considered valid only if: (1)
both EID-AD and PKT-AD are valid and (2) the intersection of the
EID-Prefix in the Map-Reply EID-Record with one of the EID-Prefixes
contained in the EID-AD is not empty. After identifying the Map-Reply
record as valid, the ITR sets the EID-Prefix in the Map-Reply record to
the value of the intersection set computed before and adds the Map-Reply
EID-Record to its EID-to-RLOC Map-Cache, as described in
\[[RFC9301](#RFC9301){.cite .xref}\]. An example of Map-Reply record
validation is provided in [Section 6.9.1](#validation){.auto .internal
.xref}.[¶](#section-6.9-7){.pilcrow}

\[[RFC9301](#RFC9301){.cite .xref}\] allows ETRs to send
Solicit-Map-Requests (SMRs) directly to the ITR. The corresponding
SMR-invoked Map-Request will be sent through the Mapping System, hence,
secured with the specifications of this memo if in use. If an ITR
accepts Map-Replies piggybacked in Map-Requests and its content is not
already present in its EID-to-RLOC Map-Cache, it [MUST]{.bcp14} send a
Map-Request over the Mapping System in order to verify its content with
a secured Map-Reply before using the
content.[¶](#section-6.9-8){.pilcrow}

::: {#validation}
::: {#section-6.9.1 .section}
#### [6.9.1.](#section-6.9.1){.section-number .selfRef} [Map-Reply Record Validation](#name-map-reply-record-validation){.section-name .selfRef} {#name-map-reply-record-validation}

The payload of a Map-Reply may contain multiple EID-Records. The whole
Map-Reply is signed by the ETR, with the PKT HMAC, to provide integrity
protection and origin authentication to the EID-Prefix records claimed
by the ETR. The \'Authentication Data\' field of a Map-Reply may contain
multiple EID-Records in the EID-AD. The EID-AD is signed by the
Map-Server, with the EID HMAC, to provide integrity protection and
origin authentication to the EID-Prefix records inserted by the
Map-Server.[¶](#section-6.9.1-1){.pilcrow}

Upon receiving a Map-Reply with the S-bit set, the ITR first checks the
validity of both the EID HMAC and of the PKT-AD HMAC. If either one of
the HMACs is not valid, a log action [SHOULD]{.bcp14} be taken and the
Map-Reply [MUST NOT]{.bcp14} be processed any further. Implementations
may include mechanisms (which are beyond the scope of this document) to
avoid log resource exhaustion attacks. If both HMACs are valid, the ITR
proceeds with validating each individual EID-Record claimed by the ETR
by computing the intersection of each one of the EID-Prefixes contained
in the payload of the Map-Reply, with each one of the EID-Prefixes
contained in the EID-AD. An EID-Record is valid only if at least one of
the intersections is not the empty set; otherwise, a log action
[MUST]{.bcp14} be taken and the EID-Record [MUST]{.bcp14} be discarded.
Implementations may include mechanisms (which are beyond the scope of
this document) to avoid log resource exhaustion
attacks.[¶](#section-6.9.1-2){.pilcrow}

For instance, the Map-Reply payload contains 3 mapping record
EID-Prefixes:[¶](#section-6.9.1-3){.pilcrow}

-   [2001:db8:102::/48[¶](#section-6.9.1-4.1){.pilcrow}]{#section-6.9.1-4.1}
-   [2001:db8:103::/48[¶](#section-6.9.1-4.2){.pilcrow}]{#section-6.9.1-4.2}
-   [2001:db8:200::/40[¶](#section-6.9.1-4.3){.pilcrow}]{#section-6.9.1-4.3}

The EID-AD contains two EID-Prefixes:[¶](#section-6.9.1-5){.pilcrow}

-   [2001:db8:103::/48[¶](#section-6.9.1-6.1){.pilcrow}]{#section-6.9.1-6.1}
-   [2001:db8:203::/48[¶](#section-6.9.1-6.2){.pilcrow}]{#section-6.9.1-6.2}

The EID-Record with EID-Prefix 2001:db8:102::/48 is not eligible to be
used by the ITR, since it is not included in any of the EID-ADs signed
by the Map-Server. A log action [MUST]{.bcp14} be taken, and the
EID-Record [MUST]{.bcp14} be discarded. Implementations may include
mechanisms (which are beyond the scope of this document) to avoid log
resource exhaustion attacks.[¶](#section-6.9.1-7){.pilcrow}

The EID-Record with EID-Prefix 2001:db8:103::/48 is eligible to be used
by the ITR because it matches the second EID-Prefix contained in the
EID-AD.[¶](#section-6.9.1-8){.pilcrow}

The EID-Record with EID-Prefix 2001:db8:200::/40 is not eligible to be
used by the ITR, since it is not included in any of the EID-ADs signed
by the Map-Server. A log action [MUST]{.bcp14} be taken and the
EID-Record [MUST]{.bcp14} be discarded. Implementations may include
mechanisms (which are beyond the scope of this document) to avoid log
resource exhaustion attacks. In this last example, the ETR is trying to
over claim the EID-Prefix 2001:db8:200::/40, but the Map-Server
authorized only 2001:db8:203::/48; hence, the EID-Record is
discarded.[¶](#section-6.9.1-9){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#security}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

This document extends the LISP control plane defined in
\[[RFC9301](#RFC9301){.cite .xref}\]; hence, its security considerations
apply to this document as well.[¶](#section-7-1){.pilcrow}

::: {#mapping-system}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Mapping System Security](#name-mapping-system-security){.section-name .selfRef} {#name-mapping-system-security}

The LISP-SEC threat model described in [Section 4](#threat-model){.auto
.internal .xref} assumes that the LISP Mapping System is working
properly and delivers Map-Request messages to a Map-Server that is
authoritative for the requested EID.[¶](#section-7.1-1){.pilcrow}

It is assumed that the Mapping System ensures the confidentiality of the
OTK and the integrity of the Map-Reply data. However, how the LISP
Mapping System is secured is out of the scope of this
document.[¶](#section-7.1-2){.pilcrow}

Similarly, Map-Register security, including the right for a LISP entity
to register an EID-Prefix or to claim presence at an RLOC, is out of the
scope of LISP-SEC.[¶](#section-7.1-3){.pilcrow}
:::
:::

::: {#random}
::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [Random Number Generation](#name-random-number-generation){.section-name .selfRef} {#name-random-number-generation}

The ITR-OTK [MUST]{.bcp14} be generated by a properly seeded
pseudo-random (or strong random) source. See \[[RFC4086](#RFC4086){.cite
.xref}\] for advice on generating security-sensitive random
data.[¶](#section-7.2-1){.pilcrow}
:::
:::

::: {#colocation}
::: {#section-7.3 .section}
### [7.3.](#section-7.3){.section-number .selfRef} [Map-Server and ETR Colocation](#name-map-server-and-etr-colocati){.section-name .selfRef} {#name-map-server-and-etr-colocati}

If the Map-Server and the ETR are colocated, LISP-SEC does not provide
protection from overclaiming attacks mounted by the ETR. However, in
this particular case, since the ETR is within the trust boundaries of
the Map-Server, ETR\'s overclaiming attacks are not included in the
threat model.[¶](#section-7.3-1){.pilcrow}
:::
:::

::: {#deploying}
::: {#section-7.4 .section}
### [7.4.](#section-7.4){.section-number .selfRef} [Deploying LISP-SEC](#name-deploying-lisp-sec){.section-name .selfRef} {#name-deploying-lisp-sec}

Those deploying LISP-SEC according to this memo should carefully weigh
how the LISP-SEC threat model applies to their particular use case or
deployment. If they decide to ignore a particular recommendation, they
should make sure the risk associated with the corresponding threats is
well understood.[¶](#section-7.4-1){.pilcrow}

As an example, in certain other deployments, attackers may be very
sophisticated and force the deployers to enforce very strict policies in
terms of HMAC algorithms accepted by an
ITR.[¶](#section-7.4-2){.pilcrow}

Similar considerations apply to the entire LISP-SEC threat model and
should guide the deployers and implementors whenever they encounter the
key word [SHOULD]{.bcp14} across this memo.[¶](#section-7.4-3){.pilcrow}
:::
:::

::: {#provisioning}
::: {#section-7.5 .section}
### [7.5.](#section-7.5){.section-number .selfRef} [Shared Keys Provisioning](#name-shared-keys-provisioning){.section-name .selfRef} {#name-shared-keys-provisioning}

Provisioning of the keys shared between ITR and Map-Resolver pairs as
well as between ETR and Map-Server pairs should be performed via an
orchestration infrastructure, and is out of the scope of this memo. It
is recommended that both shared keys be refreshed at periodical
intervals to address key aging or attackers gaining unauthorized access
to the shared keys. Shared keys should be unpredictable random
values.[¶](#section-7.5-1){.pilcrow}
:::
:::

::: {#reply}
::: {#section-7.6 .section}
### [7.6.](#section-7.6){.section-number .selfRef} [Replay Attacks](#name-replay-attacks){.section-name .selfRef} {#name-replay-attacks}

An attacker can capture a valid Map-Request and/or Map-Reply and replay
it; however, once the ITR receives the original Map-Reply, the
\<nonce,ITR-OTK> pair stored at the ITR will be discarded. If a replayed
Map-Reply arrives at the ITR, there is no \<nonce,ITR-OTK> that matches
the incoming Map-Reply and the replayed Map-Reply will be
discarded.[¶](#section-7.6-1){.pilcrow}

In the case of a replayed Map-Request, the Map-Server, Map-Resolver, and
ETR will have to do a LISP-SEC computation. This is equivalent, in terms
of resources, to a valid LISP-SEC computation and, beyond a risk of DoS
attack, an attacker does not obtain any additional effect, since the
corresponding Map-Reply is discarded as previously
explained.[¶](#section-7.6-2){.pilcrow}
:::
:::

::: {#DTLS}
::: {#section-7.7 .section}
### [7.7.](#section-7.7){.section-number .selfRef} [Message Privacy](#name-message-privacy){.section-name .selfRef} {#name-message-privacy}

DTLS \[[RFC9147](#RFC9147){.cite .xref}\] [SHOULD]{.bcp14} be used
(conforming to \[[RFC7525](#RFC7525){.cite .xref}\]) to provide
communication privacy and to prevent eavesdropping, tampering, or
message forgery to the messages exchanged between the ITR, Map-Resolver,
Map-Server, and ETR, unless the OTK is encrypted in another way, e.g.,
using a pre-shared secret. DTLS has the responder be verified by the
initiator, which enables an ITR to authenticate the Map-Resolver and the
Map-Server to authenticate the responding
ETR.[¶](#section-7.7-1){.pilcrow}
:::
:::

::: {#dos}
::: {#section-7.8 .section}
### [7.8.](#section-7.8){.section-number .selfRef} [Denial-of-Service and Distributed Denial-of-Service Attacks](#name-denial-of-service-and-distr){.section-name .selfRef} {#name-denial-of-service-and-distr}

LISP-SEC mitigates the risks of DoS and DDoS attacks by protecting the
integrity and authenticating the origin of the Map-Request/Map-Reply
messages and by preventing malicious ETRs from overclaiming EID-Prefixes
that could redirect traffic directed to a potentially large number of
hosts.[¶](#section-7.8-1){.pilcrow}
:::
:::
:::
:::

::: {#IANA}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

IANA has created the subregistries listed in the following sections in
the \"Locator/ID Separation Protocol (LISP) Parameters\"
registry.[¶](#section-8-1){.pilcrow}

For all of the subregistries, new values are assigned according to the
Specification Required policy defined in \[[RFC8126](#RFC8126){.cite
.xref}\]. Expert Review should assess the security properties of newly
added functions so that encryption robustness remains strong. For
instance, at the time of this writing, the use of SHA-256-based
functions is considered to provide sufficient protection. Consultation
with security experts may be needed.[¶](#section-8-2){.pilcrow}

::: {#ECM-AD-Type}
::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [ECM AD Type Registry](#name-ecm-ad-type-registry){.section-name .selfRef} {#name-ecm-ad-type-registry}

IANA has created the \"LISP ECM Authentication Data Types\" registry
with values 0-255 for use in the ECM LISP-SEC extensions (see [Section
6.1](#ECM_extensions){.auto .internal .xref}). Initial allocations are
shown in [Table 2](#tableEADT){.auto .internal
.xref}.[¶](#section-8.1-1){.pilcrow}

[]{#name-lisp-ecm-authentication-dat}

::: {#tableEADT}
  Name               Number   Defined in
  ------------------ -------- ------------
  Reserved           0        RFC 9303
  LISP-SEC-ECM-EXT   1        RFC 9303

  : [Table 2](#table-2){.selfRef}: [LISP ECM Authentication Data
  Types](#name-lisp-ecm-authentication-dat){.selfRef}
:::

Values 2-255 are unassigned.[¶](#section-8.1-3){.pilcrow}
:::
:::

::: {#MR-AD-Type}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [Map-Reply AD Types Registry](#name-map-reply-ad-types-registry){.section-name .selfRef} {#name-map-reply-ad-types-registry}

IANA has created the \"LISP Map-Reply Authentication Data Types\"
registry with values 0-255 for use in the Map-Reply LISP-SEC extensions
(see [Section 6.2](#MR_extensions){.auto .internal .xref}). Initial
allocations are shown in [Table 3](#tableADT){.auto .internal
.xref}.[¶](#section-8.2-1){.pilcrow}

[]{#name-map-reply-authentication-da}

::: {#tableADT}
  Name              Number   Defined in
  ----------------- -------- ------------
  Reserved          0        RFC 9303
  LISP-SEC-MR-EXT   1        RFC 9303

  : [Table 3](#table-3){.selfRef}: [Map-Reply Authentication Data
  Types](#name-map-reply-authentication-da){.selfRef}
:::

Values 2-255 are unassigned.[¶](#section-8.2-3){.pilcrow}
:::
:::

::: {#HMAC}
::: {#section-8.3 .section}
### [8.3.](#section-8.3){.section-number .selfRef} [HMAC Functions](#name-hmac-functions){.section-name .selfRef} {#name-hmac-functions}

IANA is requested to create the \"LISP-SEC Preferred Authentication Data
HMAC IDs\" registry with values 0-65535 for use as Requested HMAC IDs,
EID HMAC IDs, and PKT HMAC IDs in the LISP-SEC Authentication Data.
Initial allocations are shown in [Table 4](#tableHMACF){.auto .internal
.xref}.[¶](#section-8.3-1){.pilcrow}

[]{#name-lisp-sec-preferred-authenti}

::: {#tableHMACF}
  Name                    Number   Defined in
  ----------------------- -------- --------------------------------------
  NOPREF                  0        RFC 9303
  AUTH-HMAC-SHA-1-96      1        \[[RFC2104](#RFC2104){.cite .xref}\]
  AUTH-HMAC-SHA-256-128   2        \[[RFC6234](#RFC6234){.cite .xref}\]

  : [Table 4](#table-4){.selfRef}: [LISP-SEC Preferred Authentication
  Data HMAC IDs](#name-lisp-sec-preferred-authenti){.selfRef}
:::

Values 3-65535 are unassigned.[¶](#section-8.3-3){.pilcrow}
:::
:::

::: {#wrap}
::: {#section-8.4 .section}
### [8.4.](#section-8.4){.section-number .selfRef} [Key Wrap Functions](#name-key-wrap-functions){.section-name .selfRef} {#name-key-wrap-functions}

IANA has created the \"LISP-SEC Authentication Data Key Wrap IDs\"
registry with values 0-65535 for use as OTK key wrap algorithm IDs in
the LISP-SEC Authentication Data. Initial allocations are shown in
[Table 5](#tableKWF){.auto .internal
.xref}.[¶](#section-8.4-1){.pilcrow}

[]{#name-lisp-sec-authentication-dat}

::: {#tableKWF}
  Name                           Number   Key Wrap                               KDF                                    Reference
  ------------------------------ -------- -------------------------------------- -------------------------------------- -----------
  Reserved                       0        None                                   None                                   RFC 9303
  NULL-KEY-WRAP-128              1        RFC 9303                               None                                   RFC 9303
  AES-KEY-WRAP-128+HKDF-SHA256   2        \[[RFC3394](#RFC3394){.cite .xref}\]   \[[RFC4868](#RFC4868){.cite .xref}\]   RFC 9303

  : [Table 5](#table-5){.selfRef}: [LISP-SEC Authentication Data Key
  Wrap IDs](#name-lisp-sec-authentication-dat){.selfRef}
:::

Values 3-65535 are unassigned.[¶](#section-8.4-3){.pilcrow}
:::
:::

::: {#kdf}
::: {#section-8.5 .section}
### [8.5.](#section-8.5){.section-number .selfRef} [Key Derivation Functions](#name-key-derivation-functions){.section-name .selfRef} {#name-key-derivation-functions}

IANA has created the \"LISP-SEC Authentication Data Key Derivation
Function IDs\" registry with values 0-65535 for use as KDF IDs. Initial
allocations are shown in [Table 6](#tableKDF){.auto .internal
.xref}.[¶](#section-8.5-1){.pilcrow}

[]{#name-lisp-sec-authentication-data}

::: {#tableKDF}
  Name            Number   Reference
  --------------- -------- --------------------------------------
  NOPREF          0        RFC 9303
  HKDF-SHA1-128   1        \[[RFC5869](#RFC5869){.cite .xref}\]
  HKDF-SHA256     2        \[[RFC5869](#RFC5869){.cite .xref}\]

  : [Table 6](#table-6){.selfRef}: [LISP-SEC Authentication Data Key
  Derivation Function IDs](#name-lisp-sec-authentication-data){.selfRef}
:::

Values 3-65535 are unassigned.[¶](#section-8.5-3){.pilcrow}
:::
:::
:::
:::

::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-9.1 .section}
### [9.1.](#section-9.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2104\]
:   [Krawczyk, H.]{.refAuthor}, [Bellare, M.]{.refAuthor}, and [R.
    Canetti]{.refAuthor}, [\"HMAC: Keyed-Hashing for Message
    Authentication\"]{.refTitle}, [RFC 2104]{.seriesInfo}, [DOI
    10.17487/RFC2104]{.seriesInfo}, February 1997,
    \<<https://www.rfc-editor.org/info/rfc2104>\>.
:   

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC3394\]
:   [Schaad, J.]{.refAuthor} and [R. Housley]{.refAuthor}, [\"Advanced
    Encryption Standard (AES) Key Wrap Algorithm\"]{.refTitle}, [RFC
    3394]{.seriesInfo}, [DOI 10.17487/RFC3394]{.seriesInfo}, September
    2002, \<<https://www.rfc-editor.org/info/rfc3394>\>.
:   

\[RFC4868\]
:   [Kelly, S.]{.refAuthor} and [S. Frankel]{.refAuthor}, [\"Using
    HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512 with
    IPsec\"]{.refTitle}, [RFC 4868]{.seriesInfo}, [DOI
    10.17487/RFC4868]{.seriesInfo}, May 2007,
    \<<https://www.rfc-editor.org/info/rfc4868>\>.
:   

\[RFC5869\]
:   [Krawczyk, H.]{.refAuthor} and [P. Eronen]{.refAuthor},
    [\"HMAC-based Extract-and-Expand Key Derivation Function
    (HKDF)\"]{.refTitle}, [RFC 5869]{.seriesInfo}, [DOI
    10.17487/RFC5869]{.seriesInfo}, May 2010,
    \<<https://www.rfc-editor.org/info/rfc5869>\>.
:   

\[RFC6234\]
:   [Eastlake 3rd, D.]{.refAuthor} and [T. Hansen]{.refAuthor}, [\"US
    Secure Hash Algorithms (SHA and SHA-based HMAC and
    HKDF)\"]{.refTitle}, [RFC 6234]{.seriesInfo}, [DOI
    10.17487/RFC6234]{.seriesInfo}, May 2011,
    \<<https://www.rfc-editor.org/info/rfc6234>\>.
:   

\[RFC7525\]
:   [Sheffer, Y.]{.refAuthor}, [Holz, R.]{.refAuthor}, and [P.
    Saint-Andre]{.refAuthor}, [\"Recommendations for Secure Use of
    Transport Layer Security (TLS) and Datagram Transport Layer Security
    (DTLS)\"]{.refTitle}, [BCP 195]{.seriesInfo}, [RFC
    7525]{.seriesInfo}, [DOI 10.17487/RFC7525]{.seriesInfo}, May 2015,
    \<<https://www.rfc-editor.org/info/rfc7525>\>.
:   

\[RFC7835\]
:   [Saucez, D.]{.refAuthor}, [Iannone, L.]{.refAuthor}, and [O.
    Bonaventure]{.refAuthor}, [\"Locator/ID Separation Protocol (LISP)
    Threat Analysis\"]{.refTitle}, [RFC 7835]{.seriesInfo}, [DOI
    10.17487/RFC7835]{.seriesInfo}, April 2016,
    \<<https://www.rfc-editor.org/info/rfc7835>\>.
:   

\[RFC8126\]
:   [Cotton, M.]{.refAuthor}, [Leiba, B.]{.refAuthor}, and [T.
    Narten]{.refAuthor}, [\"Guidelines for Writing an IANA
    Considerations Section in RFCs\"]{.refTitle}, [BCP 26]{.seriesInfo},
    [RFC 8126]{.seriesInfo}, [DOI 10.17487/RFC8126]{.seriesInfo}, June
    2017, \<<https://www.rfc-editor.org/info/rfc8126>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   

\[RFC9147\]
:   [Rescorla, E.]{.refAuthor}, [Tschofenig, H.]{.refAuthor}, and [N.
    Modadugu]{.refAuthor}, [\"The Datagram Transport Layer Security
    (DTLS) Protocol Version 1.3\"]{.refTitle}, [RFC 9147]{.seriesInfo},
    [DOI 10.17487/RFC9147]{.seriesInfo}, April 2022,
    \<<https://www.rfc-editor.org/info/rfc9147>\>.
:   

\[RFC9300\]
:   [Farinacci, D.]{.refAuthor}, [Fuller, V.]{.refAuthor},
    [Meyer, D.]{.refAuthor}, [Lewis, D.]{.refAuthor}, and [A. Cabellos,
    Ed.]{.refAuthor}, [\"The Locator/ID Separation Protocol
    (LISP)\"]{.refTitle}, [RFC 9300]{.seriesInfo}, [DOI
    10.17487/RFC9300]{.seriesInfo}, October 2022,
    \<<https://www.rfc-editor.org/info/rfc9300>\>.
:   

\[RFC9301\]
:   [Farinacci, D.]{.refAuthor}, [Maino, F.]{.refAuthor},
    [Fuller, V.]{.refAuthor}, and [A. Cabellos, Ed.]{.refAuthor},
    [\"Locator/ID Separation Protocol (LISP) Control
    Plane\"]{.refTitle}, [RFC 9301]{.seriesInfo}, [DOI
    10.17487/RFC9301]{.seriesInfo}, October 2022,
    \<<https://www.rfc-editor.org/info/rfc9301>\>.
:   
:::

::: {#section-9.2 .section}
### [9.2.](#section-9.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC4086\]
:   [Eastlake 3rd, D.]{.refAuthor}, [Schiller, J.]{.refAuthor}, and [S.
    Crocker]{.refAuthor}, [\"Randomness Requirements for
    Security\"]{.refTitle}, [BCP 106]{.seriesInfo}, [RFC
    4086]{.seriesInfo}, [DOI 10.17487/RFC4086]{.seriesInfo}, June 2005,
    \<<https://www.rfc-editor.org/info/rfc4086>\>.
:   

\[RFC6836\]
:   [Fuller, V.]{.refAuthor}, [Farinacci, D.]{.refAuthor},
    [Meyer, D.]{.refAuthor}, and [D. Lewis]{.refAuthor}, [\"Locator/ID
    Separation Protocol Alternative Logical Topology
    (LISP+ALT)\"]{.refTitle}, [RFC 6836]{.seriesInfo}, [DOI
    10.17487/RFC6836]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6836>\>.
:   
:::
:::

::: {#Acknowledgments}
::: {#appendix-A .section}
## [Acknowledgments](#name-acknowledgments){.section-name .selfRef} {#name-acknowledgments}

The authors would like to acknowledge [Luigi Iannone]{.contact-name},
[Pere Monclus]{.contact-name}, [Dave Meyer]{.contact-name}, [Dino
Farinacci]{.contact-name}, [Brian Weis]{.contact-name}, [David
McGrew]{.contact-name}, [Darrel Lewis]{.contact-name}, and [Landon Curt
Noll]{.contact-name} for their valuable suggestions provided during the
preparation of this document.[¶](#appendix-A-1){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#appendix-B .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Fabio Maino]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Cisco Systems]{.org}
:::

::: {.left dir="auto"}
[San Jose]{.locality}, [CA]{.region}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <fmaino@cisco.com>
:::

::: {.left dir="auto"}
[Vina Ermagan]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google, Inc.]{.org}
:::

::: {.left dir="auto"}
[1600 Amphitheatre Parkway]{.street-address}
:::

::: {.left dir="auto"}
[Mountain View]{.locality}, [CA]{.region} [94043]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <ermagan@gmail.com>
:::

::: {.left dir="auto"}
[Albert Cabellos]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Universitat Politecnica de Catalunya]{.org}
:::

::: {.left dir="auto"}
[c/ Jordi Girona s/n]{.street-address}
:::

::: {.left dir="auto"}
[08034]{.postal-code} [Barcelona]{.locality}
:::

::: {.left dir="auto"}
[Spain]{.country-name}
:::

::: email
Email: <acabello@ac.upc.edu>
:::

::: {.left dir="auto"}
[Damien Saucez]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Inria]{.org}
:::

::: {.left dir="auto"}
[2004 route des Lucioles - BP 93]{.street-address}
:::

::: {.left dir="auto"}
[Sophia Antipolis]{.locality}
:::

::: {.left dir="auto"}
[France]{.country-name}
:::

::: email
Email: <damien.saucez@inria.fr>
:::
:::
:::
