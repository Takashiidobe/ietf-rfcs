  RFC 8925          IPv6-Only Preferred Option for DHCPv4   October 2020
  ----------------- --------------------------------------- --------------
  Colitti, et al.   Standards Track                         \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8925](https://www.rfc-editor.org/rfc/rfc8925){.eref}

Updates:
:   [2563](https://www.rfc-editor.org/rfc/rfc2563){.eref}

Category:
:   Standards Track

Published:
:   October 2020

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    L. Colitti
    :::

    ::: org
    Google
    :::
    :::

    ::: author
    ::: author-name
    J. Linkova
    :::

    ::: org
    Google
    :::
    :::

    ::: author
    ::: author-name
    M. Richardson
    :::

    ::: org
    Sandelman
    :::
    :::

    ::: author
    ::: author-name
    T. Mrugalski
    :::

    ::: org
    ISC
    :::
    :::
:::

# RFC 8925 {#rfcnum}

# IPv6-Only Preferred Option for DHCPv4 {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

This document specifies a DHCPv4 option to indicate that a host supports
an IPv6-only mode and is willing to forgo obtaining an IPv4 address if
the network provides IPv6 connectivity. It also updates RFC 2563 to
specify DHCPv4 server behavior when the server receives a DHCPDISCOVER
not containing the Auto-Configure option but containing the new option
defined in this document.[¶](#section-abstract-1){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This is an Internet Standards Track
document.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Further information on
Internet Standards is available in Section 2 of RFC
7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8925>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2020 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}

    -   ::: {#section-toc.1-1.1.2.1}
        [1.1](#section-1.1){.xref}.  [Requirements
        Language](#name-requirements-language){.xref}[¶](#section-toc.1-1.1.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.1.2.2}
        [1.2](#section-1.2){.xref}.  [Terminology](#name-terminology){.xref}[¶](#section-toc.1-1.1.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Reasons to Signal IPv6-Only Support in
    DHCPv4
    Packets](#name-reasons-to-signal-ipv6-only){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [IPv6-Only Preferred
    Option](#name-ipv6-only-preferred-option){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}

    -   ::: {#section-toc.1-1.3.2.1}
        [3.1](#section-3.1){.xref}.  [Option
        Format](#name-option-format){.xref}[¶](#section-toc.1-1.3.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.2}
        [3.2](#section-3.2){.xref}.  [DHCPv4 Client
        Behavior](#name-dhcpv4-client-behavior){.xref}[¶](#section-toc.1-1.3.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.3.2.3}
        [3.3](#section-3.3){.xref}.  [DHCPv4 Server
        Behavior](#name-dhcpv4-server-behavior){.xref}[¶](#section-toc.1-1.3.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.3.2.3.2.1}
            [3.3.1](#section-3.3.1){.xref}.  [Interaction with RFC
            2563](#name-interaction-with-rfc-2563){.xref}[¶](#section-toc.1-1.3.2.3.2.1.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.3.2.4}
        [3.4](#section-3.4){.xref}.  [Constants and Configuration
        Variables](#name-constants-and-configuration){.xref}[¶](#section-toc.1-1.3.2.4.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [IPv6-Only Transition Technology
    Considerations](#name-ipv6-only-transition-techno){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [References](#name-references){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.7.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.7.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [](#section-appendix.a){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.9}
    [](#section-appendix.b){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

One of the biggest challenges of deploying IPv6-only LANs is that such
networks might contain a rather heterogeneous collection of hosts. While
some hosts are capable of operating in IPv6-only mode (either because
the OS and all applications are IPv6-only capable or because the host
has some form of 464XLAT \[[RFC6877](#RFC6877){.xref}\] deployed),
others might still have IPv4 dependencies and need IPv4 addresses to
operate properly. To incrementally roll out IPv6-only, network operators
might need to provide IPv4 on demand, whereby a host receives an IPv4
address if it needs it, while IPv6-only-capable hosts (such as modern
mobile devices) are not allocated IPv4 addresses. Traditionally, that
goal is achieved by placing IPv6-only-capable devices in a dedicated
IPv6-only network segment or Wi-Fi Service Set Identifier (SSID), while
dual-stack devices reside in another network with IPv4 and DHCPv4
enabled. However, such an approach has a number of drawbacks, including,
but not limited to, the following:[¶](#section-1-1){.pilcrow}

-   [Doubling the number of network segments leads to operational
    complexity and impact on performance \-- for instance, due to high
    memory utilization caused by an increased number of Access Control
    List (ACL) entries.[¶](#section-1-2.1){.pilcrow}]{#section-1-2.1}
-   [Placing a host in the correct network segment is problematic. For
    example, in the case of 802.11 Wi-Fi, the user might select the
    wrong SSID. In the case of wired 802.1x authentication, the
    authentication server might not have all the information required to
    make the correct decision and choose between an IPv6-only VLAN and a
    dual-stack VLAN.[¶](#section-1-2.2){.pilcrow}]{#section-1-2.2}

It would be beneficial for IPv6 deployment if operators could implement
IPv6-mostly (or IPv4-on-demand) segments where IPv6-only hosts coexist
with legacy dual-stack devices. The trivial solution of disabling the
IPv4 stack on IPv6-only-capable hosts is not feasible, as those clients
must be able to operate on IPv4-only networks as well. While
IPv6-only-capable devices might use a heuristic approach to learning if
the network provides IPv6-only functionality and stop using IPv4 if it
does, such an approach might be undesirable in practice. One important
reason is that when a host connects to a network, it does not know
whether the network is IPv4-only, dual-stack, or IPv6-only. To ensure
that connectivity over whatever protocol is present becomes available as
soon as possible, the host usually starts configuring both IPv4 and IPv6
immediately. If hosts were to delay requesting IPv4 until IPv6
reachability is confirmed, that would penalize IPv4-only and dual-stack
networks, which does not seem practical. Requesting IPv4 and then
releasing it later, after IPv6 reachability is confirmed, might cause
errors that are visible to users, as it would be disruptive for
applications that have already started using the assigned IPv4 address.
Instead, it would be useful to have a mechanism that would allow a host
to indicate that its request for an IPv4 address is optional and a
network to signal that IPv6-only functionality (such as NAT64
\[[RFC6146](#RFC6146){.xref}\]) is available. This document provides
such a solution via a new DHCPv4 option that a client uses to indicate
that it does not need an IPv4 address if the network provides IPv6-only
connectivity (as NAT64 and DNS64). If the particular network segment
provides IPv4 on demand, such clients would not be supplied with IPv4
addresses, while IPv4 addresses would be provided on IPv4-only or
dual-stack segments without NAT64 services.[¶](#section-1-3){.pilcrow}

\[[RFC2563](#RFC2563){.xref}\] introduced the Auto-Configure DHCPv4
option and describes DHCPv4 server behavior if no address is chosen for
a host. This document updates \[[RFC2563](#RFC2563){.xref}\] to modify
server behavior if the DHCPOFFER contains the IPv6-Only Preferred
option.[¶](#section-1-4){.pilcrow}

::: {#section-1.1 .section}
### [1.1.](#section-1.1){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-1.1-1){.pilcrow}
:::

::: {#section-1.2 .section}
### [1.2.](#section-1.2){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

[]{.break}

Dual-stack network or device:
:   A network or device that has both versions of the Internet Protocol
    (IPv4 and IPv6) enabled and
    operational.[¶](#section-1.2-1.2){.pilcrow}
:   

IPv6-only-capable host:
:   A host that does not require an IPv4 address and can operate on
    IPv6-only networks. More precisely, IPv6-only capability is specific
    to a given interface of the host: if some applications on a host
    require IPv4 and the 464XLAT CLAT (customer-side translator)
    \[[RFC6877](#RFC6877){.xref}\] is only enabled on one interface, the
    host is IPv6-only capable if connected to a NAT64 network via that
    interface. This document implies that IPv6-only-capable hosts reach
    IPv4-only destinations via a NAT64 service provided by the network.
    [Section 4](#v6onlydef){.xref} discusses hypothetical scenarios for
    other transition technologies being
    used.[¶](#section-1.2-1.4){.pilcrow}
:   

IPv4-requiring host:
:   A host that is not IPv6-only capable and cannot operate in an
    IPv6-only network providing NAT64
    service.[¶](#section-1.2-1.6){.pilcrow}
:   

IPv4 on demand:
:   A deployment scenario where end hosts are expected to operate in
    IPv6-only mode by default and IPv4 addresses can be assigned to some
    hosts if those hosts explicitly opt in to receive IPv4
    addresses.[¶](#section-1.2-1.8){.pilcrow}
:   

IPv6-mostly network:
:   A network that provides NAT64 (possibly with DNS64) service as well
    as IPv4 connectivity and allows the coexistence of IPv6-only,
    dual-stack, and IPv4-only hosts on the same segment. Such a
    deployment scenario allows operators to incrementally turn off IPv4
    on end hosts, while still providing IPv4 to devices that require
    IPv4 to operate. But IPv6-only-capable devices need not be assigned
    IPv4 addresses.[¶](#section-1.2-1.10){.pilcrow}
:   

IPv6-only mode:
:   A mode of operation where a host acts as an IPv6-only-capable host
    and does not have IPv4 addresses assigned (except that IPv4
    link-local addresses \[[RFC3927](#RFC3927){.xref}\] may have been
    configured).[¶](#section-1.2-1.12){.pilcrow}
:   

IPv6-only network:
:   A network that does not provide routing functionality for IPv4
    packets. Such networks may or may not allow intra-LAN IPv4
    connectivity. An IPv6-only network usually provides access to
    IPv4-only resources via NAT64
    \[[RFC6146](#RFC6146){.xref}\].[¶](#section-1.2-1.14){.pilcrow}
:   

NAT64:
:   Network Address and Protocol Translation from IPv6 Clients to IPv4
    Servers
    \[[RFC6146](#RFC6146){.xref}\].[¶](#section-1.2-1.16){.pilcrow}
:   

Router Advertisement (RA):
:   A message used by IPv6 routers to advertise their presence, together
    with various link and Internet parameters
    \[[RFC4861](#RFC4861){.xref}\].[¶](#section-1.2-1.18){.pilcrow}
:   

DNS64:
:   A mechanism for synthesizing AAAA records from A records
    \[[RFC6147](#RFC6147){.xref}\].[¶](#section-1.2-1.20){.pilcrow}
:   

Network attachment event:
:   A link up event, as described by \[[RFC4957](#RFC4957){.xref}\],
    that results in a host detecting an available
    network.[¶](#section-1.2-1.22){.pilcrow}
:   

Disabling the IPv4 stack on the host interface:

:   Host behavior when the host[¶](#section-1.2-1.24.1){.pilcrow}

    -   [does not send any IPv4 packets from that
        interface,[¶](#section-1.2-1.24.2.1){.pilcrow}]{#section-1.2-1.24.2.1}
    -   [drops all IPv4 packets received on that interface,
        and[¶](#section-1.2-1.24.2.2){.pilcrow}]{#section-1.2-1.24.2.2}
    -   [does not forward any IPv4 packets to that
        interface.[¶](#section-1.2-1.24.2.3){.pilcrow}]{#section-1.2-1.24.2.3}

:   
:::
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Reasons to Signal IPv6-Only Support in DHCPv4 Packets](#name-reasons-to-signal-ipv6-only){.section-name .selfRef} {#name-reasons-to-signal-ipv6-only}

For networks that contain a mix of both IPv6-only-capable hosts and
IPv4-requiring hosts and that utilize DHCPv4 for configuring the IPv4
network stack on hosts, it seems natural to leverage the same protocol
to signal that IPv4 is discretional on a given segment. An ability to
remotely disable IPv4 on a host can be seen as a new denial-of-service
attack vector. The approach provided in this document limits the attack
surface to DHCPv4-related attacks without introducing new vulnerable
elements.[¶](#section-2-1){.pilcrow}

Another benefit of using DHCPv4 for signaling is that IPv4 will be
disabled only if both the client and the server indicate IPv6-only
capability. It allows IPv6-only-capable hosts to turn off IPv4 only upon
receiving an explicit signal from the network and operate in dual-stack
or IPv4-only mode otherwise. In addition, the mechanism defined in this
document does not introduce any additional delays to the process of
configuring an IP stack on hosts. If the network does not support
IPv6-only/IPv4-on-demand mode, an IPv6-only-capable host would configure
an IPv4 address as quickly as any other host.[¶](#section-2-2){.pilcrow}

Being a client/server protocol, DHCPv4 allows IPv4 to be selectively
disabled on a per-host basis on a given network segment. The coexistence
of IPv6-only, dual-stack, and even IPv4-only hosts on the same LAN would
not only allow network administrators to preserve scarce IPv4 addresses
but would also drastically simplify incremental deployment of IPv6-only
networks, positively impacting IPv6 adoption.[¶](#section-2-3){.pilcrow}
:::

::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [IPv6-Only Preferred Option](#name-ipv6-only-preferred-option){.section-name .selfRef} {#name-ipv6-only-preferred-option}

::: {#Format}
::: {#section-3.1 .section}
### [3.1.](#section-3.1){.section-number .selfRef} [Option Format](#name-option-format){.section-name .selfRef} {#name-option-format}

[]{#name-ipv6-only-preferred-option-}

::: {#fig_Option}
::: {#section-3.1-1.1 .artwork .art-text .alignCenter}
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |     Code      |   Length      |           Value               |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |         Value (cont.)         |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:::

[Figure 1](#figure-1){.selfRef}: [IPv6-Only Preferred Option
Format](#name-ipv6-only-preferred-option-){.selfRef}
:::

Fields:[¶](#section-3.1-2){.pilcrow}

[]{.break}

Code:
:   8-bit identifier of the IPv6-Only Preferred option code as assigned
    by IANA: 108. The client includes the Code in the Parameter Request
    List in DHCPDISCOVER and DHCPREQUEST messages as described in
    [Section 3.2](#v4client){.xref}.[¶](#section-3.1-3.2){.pilcrow}
:   

Length:
:   8-bit unsigned integer. The length of the option, excluding the Code
    and Length Fields. The server [MUST]{.bcp14} set the length field
    to 4. The client [MUST]{.bcp14} ignore the IPv6-Only Preferred
    option if the length field value is not
    4.[¶](#section-3.1-3.4){.pilcrow}
:   

Value:

:   32-bit unsigned integer. The number of seconds for which the client
    should disable DHCPv4 (V6ONLY_WAIT configuration variable). If the
    server pool is explicitly configured with a V6ONLY_WAIT timer, the
    server [MUST]{.bcp14} set the field to that configured value.
    Otherwise, the server [MUST]{.bcp14} set it to zero. The client
    [MUST]{.bcp14} process that field as described in [Section
    3.2](#v4client){.xref}.[¶](#section-3.1-3.6.1){.pilcrow}

    The client never sets this field, as it never sends the full option
    but includes the option code in the Parameter Request List as
    described in [Section
    3.2](#v4client){.xref}.[¶](#section-3.1-3.6.2){.pilcrow}

:   
:::
:::

::: {#v4client}
::: {#section-3.2 .section}
### [3.2.](#section-3.2){.section-number .selfRef} [DHCPv4 Client Behavior](#name-dhcpv4-client-behavior){.section-name .selfRef} {#name-dhcpv4-client-behavior}

A DHCPv4 client [SHOULD]{.bcp14} allow a device administrator to
configure IPv6-only capability either for a specific interface (to
indicate that the device is IPv6-only capable if connected to a NAT64
network via that interface) or for all interfaces. If only a specific
interface is configured as IPv6-only capable, the DHCPv4 client [MUST
NOT]{.bcp14} consider the host an IPv6-only-capable host for the purpose
of sending/receiving DHCPv4 packets over any other
interfaces.[¶](#section-3.2-1){.pilcrow}

The DHCPv4 client on an IPv4-requiring host [MUST NOT]{.bcp14} include
the IPv6-Only Preferred option code in the Parameter Request List of any
DHCPv4 packets and [MUST]{.bcp14} ignore that option in packets received
from DHCPv4 servers.[¶](#section-3.2-2){.pilcrow}

DHCPv4 clients running on IPv6-only-capable hosts [SHOULD]{.bcp14}
include the IPv6-Only Preferred option code in the Parameter Request
List in DHCPDISCOVER and DHCPREQUEST messages for interfaces so enabled
and follow the processing as described below on a per-enabled-interface
basis.[¶](#section-3.2-3){.pilcrow}

If the client did not include the IPv6-Only Preferred option code in the
Parameter Request List in the DHCPDISCOVER or DHCPREQUEST message, it
[MUST]{.bcp14} ignore the IPv6-Only Preferred option in any messages
received from the server.[¶](#section-3.2-4){.pilcrow}

If the client includes the IPv6-Only Preferred option code in the
Parameter Request List and the DHCPOFFER message from the server
contains a valid IPv6-Only Preferred option, the client [SHOULD
NOT]{.bcp14} request the IPv4 address provided in the DHCPOFFER. If the
IPv6-Only Preferred option returned by the server contains a value
greater than or equal to MIN_V6ONLY_WAIT, the client [SHOULD]{.bcp14}
set the V6ONLY_WAIT timer to that value. Otherwise, the client
[SHOULD]{.bcp14} set the V6ONLY_WAIT timer to MIN_V6ONLY_WAIT. The
client [SHOULD]{.bcp14} stop the DHCPv4 configuration process for
V6ONLY_WAIT seconds or until a network attachment event, whichever
happens first. The host [MAY]{.bcp14} disable the IPv4 stack completely
on the affected interface for V6ONLY_WAIT seconds or until the network
attachment event, whichever happens first.[¶](#section-3.2-5){.pilcrow}

The IPv6-Only Preferred option [SHOULD]{.bcp14} be included in the
Parameter Request List in DHCPREQUEST messages (after receiving a
DHCPOFFER without this option, for an INIT-REBOOT, or when renewing or
rebinding a leased address). If the DHCPv4 server responds with a
DHCPACK that includes the IPv6-Only Preferred option, the client\'s
behavior depends on the client\'s state. If the client is in the
INIT-REBOOT state, it [SHOULD]{.bcp14} stop the DHCPv4 configuration
process or disable the IPv4 stack completely for V6ONLY_WAIT seconds or
until the network attachment event, whichever happens first. It also
[MAY]{.bcp14} send a DHCPRELEASE message. If the client is in any other
state, it [SHOULD]{.bcp14} continue to use the assigned IPv4 address
until further DHCPv4 reconfiguration
events.[¶](#section-3.2-6){.pilcrow}

If the client includes the IPv6-Only Preferred option code in the
Parameter Request List and the server responds with a DHCPOFFER message
without a valid IPv6-Only Preferred option, the client [MUST]{.bcp14}
proceed as normal with a DHCPREQUEST.[¶](#section-3.2-7){.pilcrow}

If the client waits for multiple DHCPOFFER responses and selects one of
them, it [MUST]{.bcp14} follow the processing for the IPv6-Only
Preferred option based on the selected response. A client [MAY]{.bcp14}
use the presence of the IPv6-Only Preferred option as a selection
criterion.[¶](#section-3.2-8){.pilcrow}

When an IPv6-only-capable client receives the IPv6-Only Preferred option
from the server, the client [MAY]{.bcp14} configure an IPv4 link-local
address \[[RFC3927](#RFC3927){.xref}\]. In that case, IPv6-only-capable
devices might still be able to communicate over IPv4 to other devices on
the link. The Auto-Configure option \[[RFC2563](#RFC2563){.xref}\] can
be used to control the autoconfiguration of IPv4 link-local addresses.
[Section 3.3.1](#autoconf){.xref} discusses the interaction between the
IPv6-Only Preferred option and the Auto-Configure
option.[¶](#section-3.2-9){.pilcrow}
:::
:::

::: {#v4srv}
::: {#section-3.3 .section}
### [3.3.](#section-3.3){.section-number .selfRef} [DHCPv4 Server Behavior](#name-dhcpv4-server-behavior){.section-name .selfRef} {#name-dhcpv4-server-behavior}

The DHCPv4 server [SHOULD]{.bcp14} be able to configure all or
individual pools to include the IPv6-Only Preferred option in DHCPv4
responses if the client included the option code in the Parameter
Request List. The DHCPv4 server [MAY]{.bcp14} have a configuration
option to specify the V6ONLY_WAIT timer for all or individual
IPv6-mostly pools.[¶](#section-3.3-1){.pilcrow}

The server [MUST NOT]{.bcp14} include the IPv6-Only Preferred option in
the DHCPOFFER or DHCPACK message if the selected pool is not configured
as IPv6-mostly. The server [MUST NOT]{.bcp14} include the IPv6-Only
Preferred option in the DHCPOFFER or DHCPACK message if the option was
not present in the Parameter Request List sent by the
client.[¶](#section-3.3-2){.pilcrow}

If the IPv6-Only Preferred option is present in the Parameter Request
List received from the client and the corresponding DHCPv4 pool is
explicitly configured as belonging to an IPv6-mostly network segment,
the server [MUST]{.bcp14} include the IPv6-Only Preferred option when
responding with the DHCPOFFER or DHCPACK message. If the server responds
with the IPv6-Only Preferred option and the V6ONLY_WAIT timer is
configured for the pool, the server [MUST]{.bcp14} copy the configured
value to the IPv6-Only Preferred option value field. Otherwise, it
[MUST]{.bcp14} set the field to zero. The server [SHOULD NOT]{.bcp14}
assign an address from the pool. Instead, it [SHOULD]{.bcp14} return
0.0.0.0 as the offered address. Alternatively, if offering 0.0.0.0 is
not feasible \-- for example, due to some limitations of the server or
the network infrastructure \-- the server [MAY]{.bcp14} include in the
DHCPOFFER an available IPv4 address from the pool, as per
recommendations in \[[RFC2131](#RFC2131){.xref}\]. In this case, the
offered address [MUST]{.bcp14} be a valid address that is not committed
to any other client. Because the client is not ever expected to request
this address, the server [SHOULD NOT]{.bcp14} reserve the address and
[SHOULD NOT]{.bcp14} verify its uniqueness. If the client then issues a
DHCPREQUEST for the address, the server [MUST]{.bcp14} process it per
\[[RFC2131](#RFC2131){.xref}\], including replying with a DHCPACK for
the address if it has not been committed to another client in the
meantime.[¶](#section-3.3-3){.pilcrow}

If a client includes both a Rapid Commit option
\[[RFC4039](#RFC4039){.xref}\] and an IPv6-Only Preferred option in the
DHCPDISCOVER message, the server [SHOULD NOT]{.bcp14} honor the Rapid
Commit option if the response to the client would contain the IPv6-Only
Preferred option. It [SHOULD]{.bcp14} instead respond with a DHCPOFFER
as indicated above.[¶](#section-3.3-4){.pilcrow}

If the server receives a DHCPREQUEST containing the IPv6-Only Preferred
option for the address from a pool configured as IPv6-mostly, the server
[MUST]{.bcp14} process it per
\[[RFC2131](#RFC2131){.xref}\].[¶](#section-3.3-5){.pilcrow}

::: {#autoconf}
::: {#section-3.3.1 .section}
#### [3.3.1.](#section-3.3.1){.section-number .selfRef} [Interaction with RFC 2563](#name-interaction-with-rfc-2563){.section-name .selfRef} {#name-interaction-with-rfc-2563}

\[[RFC2563](#RFC2563){.xref}\] defines an Auto-Configure DHCPv4 option
to disable IPv4 link-local address configuration for IPv4 clients.
Clients can support both the IPv6-Only Preferred option and the
Auto-Configure option, just one of the options, or neither option. If a
client sends both the IPv6-Only Preferred option and the Auto-Configure
option, the network administrator can prevent the host from configuring
an IPv4 link-local address on an IPv6-mostly network. To achieve this,
the server needs to send a DHCPOFFER that contains a \'yiaddr\' of
0.0.0.0, and the Auto-Configure flag set to
\"DoNotAutoConfigure\".[¶](#section-3.3.1-1){.pilcrow}

However, special care should be taken in a situation where a server
supports both options and receives just an IPv6-Only Preferred option
from a client. [Section
2.3](https://www.rfc-editor.org/rfc/rfc2563#section-2.3){.relref} of
\[[RFC2563](#RFC2563){.xref}\] states that if no address is chosen for
the host (which would be the case for IPv6-only-capable clients on an
IPv6-mostly network), then \"If the DHCPDISCOVER does not contain the
Auto-Configure option, it is not answered.\" Such behavior would be
undesirable for clients supporting the IPv6-Only Preferred option
without supporting the Auto-Configure option, as they would not receive
any response from the server and would keep requesting a response
instead of disabling DHCPv4 for V6ONLY_WAIT seconds. Therefore, the
following update is made to [Section
2.3](https://www.rfc-editor.org/rfc/rfc2563#section-2.3){.relref} of
\[[RFC2563](#RFC2563){.xref}\].[¶](#section-3.3.1-2){.pilcrow}

OLD TEXT:[¶](#section-3.3.1-3){.pilcrow}

> However, if no address is chosen for the host, a few additional steps
> [MUST]{.bcp14} be taken.[¶](#section-3.3.1-4.1){.pilcrow}
>
> If the DHCPDISCOVER does not contain the Auto-Configure option, it is
> not answered.[¶](#section-3.3.1-4.2){.pilcrow}

NEW TEXT:[¶](#section-3.3.1-5){.pilcrow}

> However, if no address is chosen for the host, a few additional steps
> [MUST]{.bcp14} be taken.[¶](#section-3.3.1-6.1){.pilcrow}
>
> If the DHCPDISCOVER does not contain the Auto-Configure option and the
> IPv6-Only Preferred option is not present, it is not answered. If the
> DHCPDISCOVER does not contain the Auto-Configure option but contains
> the IPv6-Only Preferred option, the processing rules for the IPv6-Only
> Preferred option apply.[¶](#section-3.3.1-6.2){.pilcrow}
:::
:::
:::
:::

::: {#vars}
::: {#section-3.4 .section}
### [3.4.](#section-3.4){.section-number .selfRef} [Constants and Configuration Variables](#name-constants-and-configuration){.section-name .selfRef} {#name-constants-and-configuration}

[]{.break}

V6ONLY_WAIT:
:   The time for which the client [SHOULD]{.bcp14} stop the DHCPv4
    configuration process. The value [MUST NOT]{.bcp14} be less than
    MIN_V6ONLY_WAIT seconds. Default: 1800
    seconds[¶](#section-3.4-1.2){.pilcrow}
:   

MIN_V6ONLY_WAIT:
:   The lower boundary for V6ONLY_WAIT. Value: 300
    seconds[¶](#section-3.4-1.4){.pilcrow}
:   
:::
:::
:::

::: {#v6onlydef}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [IPv6-Only Transition Technology Considerations](#name-ipv6-only-transition-techno){.section-name .selfRef} {#name-ipv6-only-transition-techno}

Until IPv6 adoption in the Internet reaches 100%, communication between
an IPv6-only host and an IPv4-only destination requires some form of a
transition mechanism deployed in the network. At the time of writing,
the only such mechanism that is widely supported by end hosts is NAT64
\[[RFC6146](#RFC6146){.xref}\] (either with or without 464XLAT).
Therefore, the IPv6-Only Preferred option is only sent by hosts capable
of operating on NAT64 networks. In a typical deployment scenario, a
network administrator would not configure the DHCPv4 server to return
the IPv6-Only Preferred option unless the network provides NAT64
service.[¶](#section-4-1){.pilcrow}

Hypothetically, it is possible for multiple transition technologies to
coexist. In such a scenario, some form of negotiation would be required
between a client and a server to ensure that the transition technology
supported by the client is the one the network provides. However, it
seems unlikely that any new transition technology would arise and be
widely adopted in the foreseeable future. Therefore, adding support for
non-existing technologies seems to be suboptimal, so this document
implies that NAT64 is used to facilitate connectivity between IPv6 and
IPv4. In the unlikely event that a new transition mechanism becomes
widely deployed, the applicability of the IPv6-Only Preferred option to
that mechanism will depend on the nature of the new mechanism. If the
new mechanism is designed in such a way that it\'s fully transparent for
hosts that support NAT64 and the IPv6-Only Preferred option, then the
option can continue to be used with the new mechanism. If the new
mechanism is not compatible with NAT64 and implementation on the host
side is required to support it, then a new DHCPv4 option needs to be
defined.[¶](#section-4-2){.pilcrow}

It should also be noted that declaring a host (technically, a host
interface) IPv6-only capable is a policy decision. For
example,[¶](#section-4-3){.pilcrow}

-   [An OS vendor may make such a decision and configure their DHCPv4
    clients to send the IPv6-Only Preferred option by default if the OS
    has a 464XLAT CLAT \[[RFC6877](#RFC6877){.xref}\]
    enabled.[¶](#section-4-4.1){.pilcrow}]{#section-4-4.1}
-   [An enterprise network administrator may provision the corporate
    hosts as IPv6-only capable if all applications that users are
    supposed to run have been tested in an IPv6-only environment (or if
    a 464XLAT CLAT is enabled on the
    devices).[¶](#section-4-4.2){.pilcrow}]{#section-4-4.2}
-   [Internet of Things (IoT) devices may be shipped in
    IPv6-only-capable mode if they are designed to connect to an
    IPv6-enabled cloud destination
    only.[¶](#section-4-4.3){.pilcrow}]{#section-4-4.3}
:::
:::

::: {#IANA}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

The IANA has assigned a new DHCPv4 option code for the IPv6-Only
Preferred option from the \"BOOTP Vendor Extensions and DHCP Options\"
registry, located at
\<<https://www.iana.org/assignments/bootp-dhcp-parameters/>\>.[¶](#section-5-1){.pilcrow}

[]{.break}

Tag:
:   108[¶](#section-5-2.2){.pilcrow}
:   

Name:
:   IPv6-Only Preferred[¶](#section-5-2.4){.pilcrow}
:   

Data Length:
:   4[¶](#section-5-2.6){.pilcrow}
:   

Meaning:
:   Number of seconds that DHCPv4 should be
    disabled[¶](#section-5-2.8){.pilcrow}
:   

Reference:
:   RFC 8925[¶](#section-5-2.10){.pilcrow}
:   
:::
:::

::: {#Security}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

An attacker might send a spoofed DHCPOFFER containing an IPv6-Only
Preferred option with the value field set to a large number, such as
0xffffffff, effectively disabling DHCPv4 on clients supporting the
option. If the network is IPv4-only, such clients would lose
connectivity, while on a dual-stack network without NAT64 service, only
connectivity to IPv4-only destinations would be affected. Recovery from
such an attack would require triggering a network attachment event.
However, it should be noted that if the network does not provide
protection from a rogue DHCPv4 server, the similar attack vector can be
executed by offering an invalid address and setting the Lease Time
option \[[RFC2132](#RFC2132){.xref}\] value field to 0xffffffff. The
latter attack would affect all hosts \-- not just hosts that support the
IPv6-Only Preferred option. Therefore, the security measures against
rogue DHCPv4 servers would be sufficient to prevent attacks specific to
the IPv6-Only Preferred option. Additionally, such attacks can only be
executed if the victim prefers the rogue DHCPOFFER over legitimate
offers. Therefore, for the attack to be successful, the attacker needs
to know the selection criteria used by the client and be able to make
its rogue offer preferable to other offers.[¶](#section-6-1){.pilcrow}

It should be noted that disabling IPv4 on a host upon receiving the
IPv6-Only Preferred option from the DHCPv4 server protects the host from
IPv4-related attacks and therefore could be considered a security
feature, as it reduces the attack surface.[¶](#section-6-2){.pilcrow}
:::
:::

::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.
:   

\[RFC2131\]
:   [Droms, R.]{.refAuthor}, [\"Dynamic Host Configuration
    Protocol\"]{.refTitle}, [RFC 2131]{.seriesInfo}, [DOI
    10.17487/RFC2131]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2131>\>.
:   

\[RFC2563\]
:   [Troll, R.]{.refAuthor}, [\"DHCP Option to Disable Stateless
    Auto-Configuration in IPv4 Clients\"]{.refTitle}, [RFC
    2563]{.seriesInfo}, [DOI 10.17487/RFC2563]{.seriesInfo}, May 1999,
    \<<https://www.rfc-editor.org/info/rfc2563>\>.
:   

\[RFC3927\]
:   [Cheshire, S.]{.refAuthor}[, Aboba, B.]{.refAuthor}[, and E.
    Guttman]{.refAuthor}, [\"Dynamic Configuration of IPv4 Link-Local
    Addresses\"]{.refTitle}, [RFC 3927]{.seriesInfo}, [DOI
    10.17487/RFC3927]{.seriesInfo}, May 2005,
    \<<https://www.rfc-editor.org/info/rfc3927>\>.
:   

\[RFC4039\]
:   [Park, S.]{.refAuthor}[, Kim, P.]{.refAuthor}[, and B.
    Volz]{.refAuthor}, [\"Rapid Commit Option for the Dynamic Host
    Configuration Protocol version 4 (DHCPv4)\"]{.refTitle}, [RFC
    4039]{.seriesInfo}, [DOI 10.17487/RFC4039]{.seriesInfo}, March 2005,
    \<<https://www.rfc-editor.org/info/rfc4039>\>.
:   

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.
:   
:::

::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[RFC2132\]
:   [Alexander, S.]{.refAuthor}[ and R. Droms]{.refAuthor}, [\"DHCP
    Options and BOOTP Vendor Extensions\"]{.refTitle}, [RFC
    2132]{.seriesInfo}, [DOI 10.17487/RFC2132]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2132>\>.
:   

\[RFC4861\]
:   [Narten, T.]{.refAuthor}[, Nordmark, E.]{.refAuthor}[,
    Simpson, W.]{.refAuthor}[, and H. Soliman]{.refAuthor}, [\"Neighbor
    Discovery for IP version 6 (IPv6)\"]{.refTitle}, [RFC
    4861]{.seriesInfo}, [DOI 10.17487/RFC4861]{.seriesInfo}, September
    2007, \<<https://www.rfc-editor.org/info/rfc4861>\>.
:   

\[RFC4957\]
:   [Krishnan, S., Ed.]{.refAuthor}[, Montavont, N.]{.refAuthor}[,
    Njedjou, E.]{.refAuthor}[, Veerepalli, S.]{.refAuthor}[, and A.
    Yegin, Ed.]{.refAuthor}, [\"Link-Layer Event Notifications for
    Detecting Network Attachments\"]{.refTitle}, [RFC
    4957]{.seriesInfo}, [DOI 10.17487/RFC4957]{.seriesInfo}, August
    2007, \<<https://www.rfc-editor.org/info/rfc4957>\>.
:   

\[RFC6146\]
:   [Bagnulo, M.]{.refAuthor}[, Matthews, P.]{.refAuthor}[, and I. van
    Beijnum]{.refAuthor}, [\"Stateful NAT64: Network Address and
    Protocol Translation from IPv6 Clients to IPv4
    Servers\"]{.refTitle}, [RFC 6146]{.seriesInfo}, [DOI
    10.17487/RFC6146]{.seriesInfo}, April 2011,
    \<<https://www.rfc-editor.org/info/rfc6146>\>.
:   

\[RFC6147\]
:   [Bagnulo, M.]{.refAuthor}[, Sullivan, A.]{.refAuthor}[,
    Matthews, P.]{.refAuthor}[, and I. van Beijnum]{.refAuthor},
    [\"DNS64: DNS Extensions for Network Address Translation from IPv6
    Clients to IPv4 Servers\"]{.refTitle}, [RFC 6147]{.seriesInfo}, [DOI
    10.17487/RFC6147]{.seriesInfo}, April 2011,
    \<<https://www.rfc-editor.org/info/rfc6147>\>.
:   

\[RFC6877\]
:   [Mawatari, M.]{.refAuthor}[, Kawashima, M.]{.refAuthor}[, and C.
    Byrne]{.refAuthor}, [\"464XLAT: Combination of Stateful and
    Stateless Translation\"]{.refTitle}, [RFC 6877]{.seriesInfo}, [DOI
    10.17487/RFC6877]{.seriesInfo}, April 2013,
    \<<https://www.rfc-editor.org/info/rfc6877>\>.
:   
:::
:::

::: {#Acknowledgements}
::: {#section-appendix.a .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

Thanks to the following people (in alphabetical order) for their review
and feedback: [Mohamed Boucadair]{.contact-name}, [Martin
Duke]{.contact-name}, [Russ Housley]{.contact-name}, [Sheng
Jiang]{.contact-name}, [Benjamin Kaduk]{.contact-name}, [Murray
Kucherawy]{.contact-name}, [Ted Lemon]{.contact-name}, [Roy
Marples]{.contact-name}, [Bjorn Mork]{.contact-name}, [Alvaro
Retana]{.contact-name}, [Peng Shuping]{.contact-name}, [Pascal
Thubert]{.contact-name}, [Bernie Volz]{.contact-name}, [Éric
Vyncke]{.contact-name}, and [Robert Wilton]{.contact-name}. The authors
would like to thank [Bob Hinden]{.contact-name} and [Brian
Carpenter]{.contact-name} for the initial idea of signaling IPv6-only
capability to hosts. Special thanks to [Erik Kline]{.contact-name},
[Mark Townsley]{.contact-name}, and [Maciej Zenczykowski]{.contact-name}
for the discussion that led to the idea of signaling IPv6-only
capability over DHCPv4.[¶](#section-appendix.a-1){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#section-appendix.b .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Lorenzo Colitti]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google]{.org}
:::

::: {.left dir="auto"}
[Shibuya 3-21-3]{.street-address}, [Shibuya, Tokyo]{.region}
:::

::: {.left dir="auto"}
[150-0002]{.postal-code}
:::

::: {.left dir="auto"}
[Japan]{.country-name}
:::

::: email
Email: <lorenzo@google.com>
:::

::: {.left dir="auto"}
[Jen Linkova]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google]{.org}
:::

::: {.left dir="auto"}
[1 Darling Island Rd]{.street-address}
:::

::: {.left dir="auto"}
[Pyrmont]{.locality} [NSW]{.region} [2009]{.postal-code}
:::

::: {.left dir="auto"}
[Australia]{.country-name}
:::

::: email
Email: <furry@google.com>
:::

::: {.left dir="auto"}
[Michael C. Richardson]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Sandelman Software Works]{.org}
:::

::: email
Email: <mcr+ietf@sandelman.ca>
:::

::: url
URI: <https://www.sandelman.ca/>
:::

::: {.left dir="auto"}
[Tomek Mrugalski]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Internet Systems Consortium, Inc.]{.org}
:::

::: {.left dir="auto"}
[PO Box 360]{.street-address}
:::

::: {.left dir="auto"}
[Newmarket]{.locality}, [NH]{.region} [03857]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <tomasz.mrugalski@gmail.com>
:::
:::
:::
