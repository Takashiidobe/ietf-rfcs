  RFC 8678        Enterprise PA Multihoming   December 2019
  --------------- --------------------------- ---------------
  Baker, et al.   Informational               \[Page\]

::: {#external-metadata .document-information}
:::

::: {#internal-metadata .document-information}

Stream:
:   Internet Engineering Task Force (IETF)

RFC:
:   [8678](https://www.rfc-editor.org/rfc/rfc8678){.eref}

Category:
:   Informational

Published:
:   December 2019

ISSN:
:   2070-1721

Authors:

:   ::: author
    ::: author-name
    F. Baker
    :::
    :::

    ::: author
    ::: author-name
    C. Bowers
    :::

    ::: org
    Juniper Networks
    :::
    :::

    ::: author
    ::: author-name
    J. Linkova
    :::

    ::: org
    Google
    :::
    :::
:::

# RFC 8678 {#rfcnum}

# Enterprise Multihoming Using Provider-Assigned IPv6 Addresses without Network Prefix Translation: Requirements and Solutions {#title}

::: {#section-abstract .section}
## [Abstract](#abstract){.selfRef}

Connecting an enterprise site to multiple ISPs over IPv6 using
provider-assigned addresses is difficult without the use of some form of
Network Address Translation (NAT). Much has been written on this topic
over the last 10 to 15 years, but it still remains a problem without a
clearly defined or widely implemented solution. Any multihoming solution
without NAT requires hosts at the site to have addresses from each ISP
and to select the egress ISP by selecting a source address for outgoing
packets. It also requires routers at the site to take into account those
source addresses when forwarding packets out towards the
ISPs.[¶](#section-abstract-1){.pilcrow}

This document examines currently available mechanisms for providing a
solution to this problem for a broad range of enterprise topologies. It
covers the behavior of routers to forward traffic by taking into account
source address, and it covers the behavior of hosts to select
appropriate default source addresses. It also covers any possible role
that routers might play in providing information to hosts to help them
select appropriate source addresses. In the process of exploring
potential solutions, this document also makes explicit requirements for
how the solution would be expected to behave from the perspective of an
enterprise site network administrator.[¶](#section-abstract-2){.pilcrow}
:::

::: {#status-of-memo}
::: {#section-boilerplate.1 .section}
## [Status of This Memo](#name-status-of-this-memo){.section-name .selfRef} {#name-status-of-this-memo}

This document is not an Internet Standards Track specification; it is
published for informational
purposes.[¶](#section-boilerplate.1-1){.pilcrow}

This document is a product of the Internet Engineering Task Force
(IETF). It represents the consensus of the IETF community. It has
received public review and has been approved for publication by the
Internet Engineering Steering Group (IESG). Not all documents approved
by the IESG are candidates for any level of Internet Standard; see
Section 2 of RFC 7841.[¶](#section-boilerplate.1-2){.pilcrow}

Information about the current status of this document, any errata, and
how to provide feedback on it may be obtained at
<https://www.rfc-editor.org/info/rfc8678>.[¶](#section-boilerplate.1-3){.pilcrow}
:::
:::

::: {#copyright}
::: {#section-boilerplate.2 .section}
## [Copyright Notice](#name-copyright-notice){.section-name .selfRef} {#name-copyright-notice}

Copyright (c) 2019 IETF Trust and the persons identified as the document
authors. All rights reserved.[¶](#section-boilerplate.2-1){.pilcrow}

This document is subject to BCP 78 and the IETF Trust\'s Legal
Provisions Relating to IETF Documents
(<https://trustee.ietf.org/license-info>) in effect on the date of
publication of this document. Please review these documents carefully,
as they describe your rights and restrictions with respect to this
document. Code Components extracted from this document must include
Simplified BSD License text as described in Section 4.e of the Trust
Legal Provisions and are provided without warranty as described in the
Simplified BSD License.[¶](#section-boilerplate.2-2){.pilcrow}
:::
:::

::: {#toc}
::: {#section-toc.1 .section}
[▲](#){.toplink}

## [Table of Contents](#name-table-of-contents){.section-name .selfRef} {#name-table-of-contents}

-   ::: {#section-toc.1-1.1}
    [1](#section-1){.xref}.  [Introduction](#name-introduction){.xref}[¶](#section-toc.1-1.1.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.2}
    [2](#section-2){.xref}.  [Requirements
    Language](#name-requirements-language){.xref}[¶](#section-toc.1-1.2.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.3}
    [3](#section-3){.xref}.  [Terminology](#name-terminology){.xref}[¶](#section-toc.1-1.3.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.4}
    [4](#section-4){.xref}.  [Enterprise Multihoming Use
    Cases](#name-enterprise-multihoming-use-){.xref}[¶](#section-toc.1-1.4.1){.pilcrow}

    -   ::: {#section-toc.1-1.4.2.1}
        [4.1](#section-4.1){.xref}.  [Simple ISP Connectivity with
        Connected
        SERs](#name-simple-isp-connectivity-wit){.xref}[¶](#section-toc.1-1.4.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.2}
        [4.2](#section-4.2){.xref}.  [Simple ISP Connectivity Where SERs
        Are Not Directly
        Connected](#name-simple-isp-connectivity-whe){.xref}[¶](#section-toc.1-1.4.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.3}
        [4.3](#section-4.3){.xref}.  [Enterprise Network Operator
        Expectations](#name-enterprise-network-operator){.xref}[¶](#section-toc.1-1.4.2.3.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.4}
        [4.4](#section-4.4){.xref}.  [More Complex ISP
        Connectivity](#name-more-complex-isp-connectivi){.xref}[¶](#section-toc.1-1.4.2.4.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.5}
        [4.5](#section-4.5){.xref}.  [ISPs and Provider-Assigned
        Prefixes](#name-isps-and-provider-assigned-){.xref}[¶](#section-toc.1-1.4.2.5.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.4.2.6}
        [4.6](#section-4.6){.xref}.  [Simplified
        Topologies](#name-simplified-topologies){.xref}[¶](#section-toc.1-1.4.2.6.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.5}
    [5](#section-5){.xref}.  [Generating Source-Prefix-Scoped Forwarding
    Tables](#name-generating-source-prefix-sc){.xref}[¶](#section-toc.1-1.5.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.6}
    [6](#section-6){.xref}.  [Mechanisms for Hosts To Choose Good
    Default Source Addresses in a Multihomed
    Site](#name-mechanisms-for-hosts-to-cho){.xref}[¶](#section-toc.1-1.6.1){.pilcrow}

    -   ::: {#section-toc.1-1.6.2.1}
        [6.1](#section-6.1){.xref}.  [Default Source Address Selection
        Algorithm on
        Hosts](#name-default-source-address-sele){.xref}[¶](#section-toc.1-1.6.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.6.2.2}
        [6.2](#section-6.2){.xref}.  [Selecting Default Source Address
        When Both Uplinks Are
        Working](#name-selecting-default-source-ad){.xref}[¶](#section-toc.1-1.6.2.2.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.2.2.1}
            [6.2.1](#section-6.2.1){.xref}.  [Distributing Default
            Address Selection Policy Table with
            DHCPv6](#name-distributing-default-addres){.xref}[¶](#section-toc.1-1.6.2.2.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.2.2.2}
            [6.2.2](#section-6.2.2){.xref}.  [Controlling Default Source
            Address Selection with Router
            Advertisements](#name-controlling-default-source-){.xref}[¶](#section-toc.1-1.6.2.2.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.2.2.3}
            [6.2.3](#section-6.2.3){.xref}.  [Controlling Default Source
            Address Selection with
            ICMPv6](#name-controlling-default-source-a){.xref}[¶](#section-toc.1-1.6.2.2.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.2.2.4}
            [6.2.4](#section-6.2.4){.xref}.  [Summary of Methods for
            Controlling Default Source Address Selection to Implement
            Routing
            Policy](#name-summary-of-methods-for-cont){.xref}[¶](#section-toc.1-1.6.2.2.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.3}
        [6.3](#section-6.3){.xref}.  [Selecting Default Source Address
        When One Uplink Has
        Failed](#name-selecting-default-source-add){.xref}[¶](#section-toc.1-1.6.2.3.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.3.2.1}
            [6.3.1](#section-6.3.1){.xref}.  [Controlling Default Source
            Address Selection with
            DHCPv6](#name-controlling-default-source-ad){.xref}[¶](#section-toc.1-1.6.2.3.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.3.2.2}
            [6.3.2](#section-6.3.2){.xref}.  [Controlling Default Source
            Address Selection with Router
            Advertisements](#name-controlling-default-source-add){.xref}[¶](#section-toc.1-1.6.2.3.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.3.2.3}
            [6.3.3](#section-6.3.3){.xref}.  [Controlling Default Source
            Address Selection with
            ICMPv6](#name-controlling-default-source-addr){.xref}[¶](#section-toc.1-1.6.2.3.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.3.2.4}
            [6.3.4](#section-6.3.4){.xref}.  [Summary of Methods for
            Controlling Default Source Address Selection on the Failure
            of an
            Uplink](#name-summary-of-methods-for-contr){.xref}[¶](#section-toc.1-1.6.2.3.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.4}
        [6.4](#section-6.4){.xref}.  [Selecting Default Source Address
        upon Failed Uplink
        Recovery](#name-selecting-default-source-addr){.xref}[¶](#section-toc.1-1.6.2.4.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.4.2.1}
            [6.4.1](#section-6.4.1){.xref}.  [Controlling Default Source
            Address Selection with
            DHCPv6](#name-controlling-default-source-addre){.xref}[¶](#section-toc.1-1.6.2.4.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.2}
            [6.4.2](#section-6.4.2){.xref}.  [Controlling Default Source
            Address Selection with Router
            Advertisements](#name-controlling-default-source-addres){.xref}[¶](#section-toc.1-1.6.2.4.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.3}
            [6.4.3](#section-6.4.3){.xref}.  [Controlling Default Source
            Address Selection with
            ICMP](#name-controlling-default-source-address){.xref}[¶](#section-toc.1-1.6.2.4.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.4.2.4}
            [6.4.4](#section-6.4.4){.xref}.  [Summary of Methods for
            Controlling Default Source Address Selection upon Failed
            Uplink
            Recovery](#name-summary-of-methods-for-contro){.xref}[¶](#section-toc.1-1.6.2.4.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.5}
        [6.5](#section-6.5){.xref}.  [Selecting Default Source Address
        When All Uplinks Have
        Failed](#name-selecting-default-source-addre){.xref}[¶](#section-toc.1-1.6.2.5.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.5.2.1}
            [6.5.1](#section-6.5.1){.xref}.  [Controlling Default Source
            Address Selection with
            DHCPv6](#name-controlling-default-source-address-){.xref}[¶](#section-toc.1-1.6.2.5.2.1.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.5.2.2}
            [6.5.2](#section-6.5.2){.xref}.  [Controlling Default Source
            Address Selection with Router
            Advertisements](#name-controlling-default-source-address--2){.xref}[¶](#section-toc.1-1.6.2.5.2.2.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.5.2.3}
            [6.5.3](#section-6.5.3){.xref}.  [Controlling Default Source
            Address Selection with
            ICMPv6](#name-controlling-default-source-address--3){.xref}[¶](#section-toc.1-1.6.2.5.2.3.1){.pilcrow}
            :::

        -   ::: {#section-toc.1-1.6.2.5.2.4}
            [6.5.4](#section-6.5.4){.xref}.  [Summary of Methods for
            Controlling Default Source Address Selection When All
            Uplinks
            Failed](#name-summary-of-methods-for-control){.xref}[¶](#section-toc.1-1.6.2.5.2.4.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.6}
        [6.6](#section-6.6){.xref}.  [Summary of Methods for Controlling
        Default Source Address
        Selection](#name-summary-of-methods-for-controll){.xref}[¶](#section-toc.1-1.6.2.6.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.6.2.7}
        [6.7](#section-6.7){.xref}.  [Solution
        Limitations](#name-solution-limitations){.xref}[¶](#section-toc.1-1.6.2.7.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.7.2.1}
            [6.7.1](#section-6.7.1){.xref}.  [Connections
            Preservation](#name-connections-preservation){.xref}[¶](#section-toc.1-1.6.2.7.2.1.1){.pilcrow}
            :::
        :::

    -   ::: {#section-toc.1-1.6.2.8}
        [6.8](#section-6.8){.xref}.  [Other Configuration
        Parameters](#name-other-configuration-paramet){.xref}[¶](#section-toc.1-1.6.2.8.1){.pilcrow}

        -   ::: {#section-toc.1-1.6.2.8.2.1}
            [6.8.1](#section-6.8.1){.xref}.  [DNS
            Configuration](#name-dns-configuration){.xref}[¶](#section-toc.1-1.6.2.8.2.1.1){.pilcrow}
            :::
        :::
    :::

-   ::: {#section-toc.1-1.7}
    [7](#section-7){.xref}.  [Deployment
    Considerations](#name-deployment-considerations){.xref}[¶](#section-toc.1-1.7.1){.pilcrow}

    -   ::: {#section-toc.1-1.7.2.1}
        [7.1](#section-7.1){.xref}.  [Deploying SADR
        Domain](#name-deploying-sadr-domain){.xref}[¶](#section-toc.1-1.7.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.7.2.2}
        [7.2](#section-7.2){.xref}.  [Hosts-Related
        Considerations](#name-hosts-related-consideration){.xref}[¶](#section-toc.1-1.7.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.8}
    [8](#section-8){.xref}.  [Other
    Solutions](#name-other-solutions){.xref}[¶](#section-toc.1-1.8.1){.pilcrow}

    -   ::: {#section-toc.1-1.8.2.1}
        [8.1](#section-8.1){.xref}.  [Shim6](#name-shim6){.xref}[¶](#section-toc.1-1.8.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.2}
        [8.2](#section-8.2){.xref}.  [IPv6-to-IPv6 Network Prefix
        Translation](#name-ipv6-to-ipv6-network-prefix){.xref}[¶](#section-toc.1-1.8.2.2.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.8.2.3}
        [8.3](#section-8.3){.xref}.  [Multipath
        Transport](#name-multipath-transport){.xref}[¶](#section-toc.1-1.8.2.3.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.9}
    [9](#section-9){.xref}.  [IANA
    Considerations](#name-iana-considerations){.xref}[¶](#section-toc.1-1.9.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.10}
    [10](#section-10){.xref}. [Security
    Considerations](#name-security-considerations){.xref}[¶](#section-toc.1-1.10.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.11}
    [11](#section-11){.xref}. [References](#name-references){.xref}[¶](#section-toc.1-1.11.1){.pilcrow}

    -   ::: {#section-toc.1-1.11.2.1}
        [11.1](#section-11.1){.xref}.  [Normative
        References](#name-normative-references){.xref}[¶](#section-toc.1-1.11.2.1.1){.pilcrow}
        :::

    -   ::: {#section-toc.1-1.11.2.2}
        [11.2](#section-11.2){.xref}.  [Informative
        References](#name-informative-references){.xref}[¶](#section-toc.1-1.11.2.2.1){.pilcrow}
        :::
    :::

-   ::: {#section-toc.1-1.12}
    [](#section-appendix.a){.xref}[Acknowledgements](#name-acknowledgements){.xref}[¶](#section-toc.1-1.12.1){.pilcrow}
    :::

-   ::: {#section-toc.1-1.13}
    [](#section-appendix.b){.xref}[Authors\'
    Addresses](#name-authors-addresses){.xref}[¶](#section-toc.1-1.13.1){.pilcrow}
    :::
:::
:::

::: {#section-1 .section}
## [1.](#section-1){.section-number .selfRef} [Introduction](#name-introduction){.section-name .selfRef} {#name-introduction}

Site multihoming, the connection of a subscriber network to multiple
upstream networks using redundant uplinks, is a common enterprise
architecture for improving the reliability of its Internet connectivity.
If the site uses provider-independent (PI) addresses, all traffic
originating from the enterprise can use source addresses from the PI
address space. Site multihoming with PI addresses is commonly used with
both IPv4 and IPv6, and does not present any new technical
challenges.[¶](#section-1-1){.pilcrow}

It may be desirable for an enterprise site to connect to multiple ISPs
using provider-assigned (PA) addresses instead of PI addresses.
Multihoming with provider-assigned addresses is typically less expensive
for the enterprise relative to using provider-independent addresses as
it does not require obtaining and maintaining PI address space nor does
it require running BGP between the enterprise and the ISPs (for
small/medium networks, running BGP might be not only undesirable but
also impossible, especially if residential-type ISP connections are
used). PA multihoming is also a practice that should be facilitated and
encouraged because it does not add to the size of the Internet routing
table, whereas PI multihoming does. Note that PA is also used to mean
\"provider-aggregatable\". In this document, we assume that
provider-assigned addresses are always
provider-aggregatable.[¶](#section-1-2){.pilcrow}

With PA multihoming, for each ISP connection, the site is assigned a
prefix from within an address block allocated to that ISP by its
National or Regional Internet Registry. In the simple case of two ISPs
(ISP-A and ISP-B), the site will have two different prefixes assigned to
it (prefix-A and prefix-B). This arrangement is problematic. First,
packets with the \"wrong\" source address may be dropped by one of the
ISPs. In order to limit denial-of-service attacks using spoofed source
addresses, \[[BCP38](#RFC2827){.xref}\] recommends that ISPs filter
traffic from customer sites to allow only traffic with a source address
that has been assigned by that ISP. So a packet sent from a multihomed
site on the uplink to ISP-B with a source address in prefix-A may be
dropped by ISP-B.[¶](#section-1-3){.pilcrow}

However, even if ISP-B does not implement BCP 38, or ISP-B adds prefix-A
to its list of allowed source addresses on the uplink from the
multihomed site, two-way communication may still fail. If the packet
with a source address in prefix-A was sent to ISP-B because the uplink
to ISP-A failed, then if ISP-B does not drop the packet, and the packet
reaches its destination somewhere on the Internet, the return packet
will be sent back with a destination address in prefix-A. The return
packet will be routed over the Internet to ISP-A, but it will not be
delivered to the multihomed site because the site uplink with ISP-A has
failed. Two-way communication would require some arrangement for ISP-B
to advertise prefix-A when the uplink to ISP-A
fails.[¶](#section-1-4){.pilcrow}

Note that the same may be true of a provider that does not implement BCP
38, even if his upstream provider does, or of a provider that has no
corresponding route to deliver the ingress traffic to the multihomed
site. The issue is not that the immediate provider implements ingress
filtering; it is that someone upstream does (so egress traffic is
blocked) or lacks a route (causing blackholing of the ingress
traffic).[¶](#section-1-5){.pilcrow}

Another issue with asymmetric traffic flow (when the egress traffic
leaves the site via one ISP, but the return traffic enters the site via
another uplink) is related to stateful firewalls/middleboxes. Keeping
state in that case might be problematic, even
impossible.[¶](#section-1-6){.pilcrow}

With IPv4, this problem is commonly solved by using private address
space described in \[[RFC1918](#RFC1918){.xref}\] within the multihomed
site and Network Address Translation (NAT) or Network Address/Port
Translation (NAPT) \[[RFC2663](#RFC2663){.xref}\] on the uplinks to the
ISPs. However, one of the goals of IPv6 is to eliminate the need for and
the use of NAT or NAPT. Therefore, requiring the use of NAT or NAPT for
an enterprise site to multihome with provider-assigned addresses is not
an attractive solution.[¶](#section-1-7){.pilcrow}

\[[RFC6296](#RFC6296){.xref}\] describes a translation solution
specifically tailored to meet the requirements of multihoming with
provider-assigned IPv6 addresses. With the IPv6-to-IPv6 Network Prefix
Translation (NPTv6) solution, an enterprise can use either Unique Local
Addresses \[[RFC4193](#RFC4193){.xref}\] or the prefix assigned by one
of the ISPs within its site. As traffic leaves the site on an uplink to
an ISP, the source address is translated in a predictable and reversible
manner to an address within the prefix assigned by the ISP on that
uplink. \[[RFC6296](#RFC6296){.xref}\] is currently classified as
Experimental, and it has been implemented by several vendors. See
[Section 8.2](#sec_nptv6){.xref} for more discussion of
NPTv6.[¶](#section-1-8){.pilcrow}

This document defines routing requirements for enterprise multihoming.
This document focuses on the following general class of
solutions.[¶](#section-1-9){.pilcrow}

Each host at the enterprise has multiple addresses, at least one from
each ISP-assigned prefix. As discussed in [Section
6.1](#sec_host_address_selection_algo){.xref} and in
\[[RFC6724](#RFC6724){.xref}\], each host is responsible for choosing
the source address that is applied to each packet it sends. A host is
expected to be able to respond dynamically to the failure of an uplink
to a given ISP by no longer sending packets with the source address
corresponding to that ISP. Potential mechanisms for communicating
network changes to the host are Neighbor Discovery Router Advertisements
\[[RFC4861](#RFC4861){.xref}\], DHCPv6 \[[RFC8415](#RFC8415){.xref}\],
and ICMPv6 \[[RFC4443](#RFC4443){.xref}\].[¶](#section-1-10){.pilcrow}

The routers in the enterprise network are responsible for ensuring that
packets are delivered to the \"correct\" ISP uplink based on source
address. This requires that at least some routers in the site network
are able to take into account the source address of a packet when
deciding how to route it. That is, some routers must be capable of some
form of Source Address Dependent Routing (SADR), if only as described in
[Section
4.3](https://www.rfc-editor.org/rfc/rfc3704#section-4.3){.relref} of
\[[RFC3704](#RFC3704){.xref}\]. At a minimum, the routers connected to
the ISP uplinks (the site exit routers or SERs) must be capable of
Source Address Dependent Routing. Expanding the connected domain of
routers capable of SADR from the site exit routers deeper into the site
network will generally result in more efficient routing of traffic with
external destinations.[¶](#section-1-11){.pilcrow}

This document is organized as follows. [Section
4](#sec_enterprise_req){.xref} looks in more detail at the enterprise
networking environments in which this solution is expected to operate.
The discussion of [Section 4](#sec_enterprise_req){.xref} uses the
concepts of Source-Prefix-Scoped Routing advertisements and forwarding
tables and describes how Source-Prefix-Scoped Routing advertisements are
used to generate source-prefix-scoped forwarding tables. A detailed
description of generating source-prefix-scoped forwarding tables is
provided in [Section 5](#sec_method){.xref}. [Section
6](#sec_host_mechanisms){.xref} discusses existing and proposed
mechanisms for hosts to select the default source address to be used by
applications. It also discusses the requirements for routing that are
needed to support these enterprise network scenarios and the mechanisms
by which hosts are expected to update default source addresses based on
network state. [Section 7](#sec_deployment){.xref} discusses deployment
considerations, while [Section 8](#sec_other_solutions){.xref} discusses
other solutions.[¶](#section-1-12){.pilcrow}
:::

::: {#section-2 .section}
## [2.](#section-2){.section-number .selfRef} [Requirements Language](#name-requirements-language){.section-name .selfRef} {#name-requirements-language}

The key words \"[MUST]{.bcp14}\", \"[MUST NOT]{.bcp14}\",
\"[REQUIRED]{.bcp14}\", \"[SHALL]{.bcp14}\", \"[SHALL NOT]{.bcp14}\",
\"[SHOULD]{.bcp14}\", \"[SHOULD NOT]{.bcp14}\",
\"[RECOMMENDED]{.bcp14}\", \"[NOT RECOMMENDED]{.bcp14}\",
\"[MAY]{.bcp14}\", and \"[OPTIONAL]{.bcp14}\" in this document are to be
interpreted as described in BCP 14 \[[RFC2119](#RFC2119){.xref}\]
\[[RFC8174](#RFC8174){.xref}\] when, and only when, they appear in all
capitals, as shown here.[¶](#section-2-1){.pilcrow}
:::

::: {#section-3 .section}
## [3.](#section-3){.section-number .selfRef} [Terminology](#name-terminology){.section-name .selfRef} {#name-terminology}

PA (provider-assigned or provider-aggregatable) address space:
:   a block of IP addresses assigned by a Regional Internet Registry
    (RIR) to a Local Internet Registry (LIR), used to create allocations
    to end sites. Can be aggregated and present in the routing table as
    one route.[¶](#section-3-1.2){.pilcrow}

PI (provider-independent) address space:
:   a block of IP addresses assigned by a Regional Internet Registry
    (RIR) directly to end site / end
    customer.[¶](#section-3-1.4){.pilcrow}

ISP:
:   Internet Service Provider[¶](#section-3-1.6){.pilcrow}

LIR (Local Internet Registry):
:   an organization (usually an ISP or an enterprise/academic) that
    receives its allocation of IP addresses from its Regional Internet
    Registry, then assigns parts of that allocation to its
    customers.[¶](#section-3-1.8){.pilcrow}

RIR (Regional Internet Registry):
:   an organization that manages the Internet number resources (such as
    IP addresses and autonomous system (AS) numbers) within a
    geographical region of the world.[¶](#section-3-1.10){.pilcrow}

SADR (Source Address Dependent Routing):
:   routing that takes into account the source address of a packet in
    addition to the packet destination
    address.[¶](#section-3-1.12){.pilcrow}

SADR domain:
:   a routing domain in which some (or all) routers exchange
    source-dependent routing information.[¶](#section-3-1.14){.pilcrow}

Source-Prefix-Scoped Routing/Forwarding Table:
:   a routing (or forwarding) table that contains routing (or
    forwarding) information only applicable to packets with source
    addresses from the specific prefix.[¶](#section-3-1.16){.pilcrow}

Unscoped Routing/Forwarding Table:
:   a routing (or forwarding) table that can be used to route/forward
    packets with any source address.[¶](#section-3-1.18){.pilcrow}

SER (Site Edge Router):
:   a router that connects the site to an ISP (terminates an ISP
    uplink).[¶](#section-3-1.20){.pilcrow}

LLA (Link-Local Address):
:   an IPv6 unicast address from the fe80::/10 prefix
    \[[RFC4291](#RFC4291){.xref}\].[¶](#section-3-1.22){.pilcrow}

ULA (Unique Local IPv6 Unicast Address):
:   an IPv6 unicast address from the FC00::/7 prefix. They are globally
    unique and intended for local communications
    \[[RFC4193](#RFC4193){.xref}\].[¶](#section-3-1.24){.pilcrow}

GUA (Global Unicast Address):
:   a globally routable IPv6 address of the global scope
    \[[RFC4291](#RFC4291){.xref}\].[¶](#section-3-1.26){.pilcrow}

SLAAC (IPv6 Stateless Address Autoconfiguration):
:   a stateless process of configuring the network stack on IPv6 hosts
    \[[RFC4862](#RFC4862){.xref}\].[¶](#section-3-1.28){.pilcrow}

RA (Router Advertisement):
:   a message sent by an IPv6 router to advertise its presence to hosts
    together with various network-related parameters required for hosts
    to perform SLAAC
    \[[RFC4861](#RFC4861){.xref}\].[¶](#section-3-1.30){.pilcrow}

PIO (Prefix Information Option):
:   a part of an RA message containing information about IPv6 prefixes
    that could be used by hosts to generate global IPv6 addresses
    \[[RFC4862](#RFC4862){.xref}\].[¶](#section-3-1.32){.pilcrow}

RIO (Route Information Option):
:   a part of an RA message containing information about more specific
    IPv6 prefixes reachable via the advertising router
    \[[RFC4191](#RFC4191){.xref}\].[¶](#section-3-1.34){.pilcrow}
:::

::: {#sec_enterprise_req}
::: {#section-4 .section}
## [4.](#section-4){.section-number .selfRef} [Enterprise Multihoming Use Cases](#name-enterprise-multihoming-use-){.section-name .selfRef} {#name-enterprise-multihoming-use-}

::: {#sec_simple_scenario}
::: {#section-4.1 .section}
### [4.1.](#section-4.1){.section-number .selfRef} [Simple ISP Connectivity with Connected SERs](#name-simple-isp-connectivity-wit){.section-name .selfRef} {#name-simple-isp-connectivity-wit}

We start by looking at a scenario in which a site has connections to two
ISPs, as shown in [Figure 1](#fig_simple_scenario){.xref}. The site is
assigned the prefix 2001:db8:0:a000::/52 by ISP-A and prefix
2001:db8:0:b000::/52 by ISP-B. We consider three hosts in the site. H31
and H32 are on a LAN that has been assigned subnets 2001:db8:0:a010::/64
and 2001:db8:0:b010::/64. H31 has been assigned the addresses
2001:db8:0:a010::31 and 2001:db8:0:b010::31. H32 has been assigned
2001:db8:0:a010::32 and 2001:db8:0:b010::32. H41 is on a different
subnet that has been assigned 2001:db8:0:a020::/64 and
2001:db8:0:b020::/64.[¶](#section-4.1-1){.pilcrow}

[]{#name-simple-isp-connectivity-with}

::: {#fig_simple_scenario}
::: {#section-4.1-2.1 .artwork .art-text .alignCenter}
                                          2001:db8:0:1234::101   H101
                                                                   |
                                                                   |
    2001:db8:0:a010::31                                        --------
    2001:db8:0:b010::31                          ,-----.      /        \
                     +--+   +--+       +----+  ,'       `.   :          :
                 +---|R1|---|R4|---+---|SERa|-+   ISP-A   +--+--        :
            H31--+   +--+   +--+   |   +----+  `.       ,'   :          :
                 |                 |             `-----'     : Internet :
                 |                 |                         :          :
                 |                 |                         :          :
                 |                 |                         :          :
                 |                 |             ,-----.     :          :
            H32--+   +--+          |   +----+  ,'       `.   :          :
                 +---|R2|----------+---|SERb|-+   ISP-B   +--+--        :
                     +--+          |   +----+  `.       ,'   :          :
                                   |             `-----'     :          :
                                   |                         :          :
                     +--+  +--+  +--+                         \        /
            H41------|R3|--|R5|--|R6|                          --------
                     +--+  +--+  +--+

    2001:db8:0:a020::41
    2001:db8:0:b020::41
:::

[Figure 1](#figure-1){.selfRef}: [Simple ISP Connectivity with Connected
SERs](#name-simple-isp-connectivity-with){.selfRef}
:::

We refer to a router that connects the site to an ISP as a site edge
router (SER). Several other routers provide connectivity among the
internal hosts (H31, H32, and H41), as well as connect the internal
hosts to the Internet through SERa and SERb. In this example, SERa and
SERb share a direct connection to each other. In [Section
4.2](#sec_simple_not_dir_conn){.xref}, we consider a scenario in which
this is not the case.[¶](#section-4.1-3){.pilcrow}

For the moment, we assume that the hosts are able to select suitable
source addresses through some mechanism that doesn\'t involve the
routers in the site network. Here, we focus on the primary task of the
routed site network, which is to get packets efficiently to their
destinations, while sending a packet to the ISP that assigned the prefix
that matches the source address of the packet. In [Section
6](#sec_host_mechanisms){.xref}, we examine what role the routed network
may play in helping hosts select suitable source addresses for
packets.[¶](#section-4.1-4){.pilcrow}

With this solution, routers will need some form of Source Address
Dependent Routing, which will be new functionality. It would be useful
if an enterprise site does not need to upgrade all routers to support
the new SADR functionality in order to support PA multihoming. We
consider whether this is possible and examine the trade-offs of not
having all routers in the site support SADR
functionality.[¶](#section-4.1-5){.pilcrow}

In the topology in [Figure 1](#fig_simple_scenario){.xref}, it is
possible to support PA multihoming with only SERa and SERb being capable
of SADR. The other routers can continue to forward based only on
destination address, and exchange routes that only consider destination
address. In this scenario, SERa and SERb communicate source-scoped
routing information across their shared connection. When SERa receives a
packet with a source address matching prefix 2001:db8:0:b000::/52, it
forwards the packet to SERb, which forwards it on the uplink to ISP-B.
The analogous behavior holds for traffic that SERb receives with a
source address matching prefix
2001:db8:0:a000::/52.[¶](#section-4.1-6){.pilcrow}

In [Figure 1](#fig_simple_scenario){.xref}, when only SERa and SERb are
capable of source address dependent routing, PA multihoming will work.
However, the paths over which the packets are sent will generally not be
the shortest paths. The forwarding paths will generally be more
efficient when more routers are capable of SADR. For example, if R4, R2,
and R6 are upgraded to support SADR, then they can exchange
source-scoped routes with SERa and SERb. They will then know to send
traffic with a source address matching prefix 2001:db8:0:b000::/52
directly to SERb, without sending it to SERa
first.[¶](#section-4.1-7){.pilcrow}
:::
:::

::: {#sec_simple_not_dir_conn}
::: {#section-4.2 .section}
### [4.2.](#section-4.2){.section-number .selfRef} [Simple ISP Connectivity Where SERs Are Not Directly Connected](#name-simple-isp-connectivity-whe){.section-name .selfRef} {#name-simple-isp-connectivity-whe}

In [Figure 2](#fig_simple_not_dir_conn){.xref}, we modify the topology
slightly by inserting R7, so that SERa and SERb are no longer directly
connected. With this topology, it is not enough to just enable SADR
routing on SERa and SERb to support PA multihoming. There are two
solutions to enable PA multihoming in this
topology.[¶](#section-4.2-1){.pilcrow}

[]{#name-simple-isp-connectivity-wher}

::: {#fig_simple_not_dir_conn}
::: {#section-4.2-2.1 .artwork .art-text .alignCenter}
                                          2001:db8:0:1234::101    H101
                                                                   |
                                                                   |
    2001:db8:0:a010::31                                        --------
    2001:db8:0:b010::31                          ,-----.      /        \
                     +--+   +--+       +----+  ,'       `.   :          :
                 +---|R1|---|R4|---+---|SERa|-+   ISP-A   +--+--        :
            H31--+   +--+   +--+   |   +----+  `.       ,'   :          :
                 |                 |             `-----'     : Internet :
                 |               +--+                        :          :
                 |               |R7|                        :          :
                 |               +--+                        :          :
                 |                 |             ,-----.     :          :
            H32--+   +--+          |   +----+  ,'       `.   :          :
                 +---|R2|----------+---|SERb|-+   ISP-B   +--+--        :
                     +--+          |   +----+  `.       ,'   :          :
                                   |             `-----'     :          :
                                   |                         :          :
                     +--+  +--+  +--+                         \        /
            H41------|R3|--|R5|--|R6|                          --------
                     +--+  +--+  +--+                              |
                                                                   |
    2001:db8:0:a020::41                   2001:db8:0:5678::501    H501
    2001:db8:0:b020::41
:::

[Figure 2](#figure-2){.selfRef}: [Simple ISP Connectivity Where SERs Are
Not Directly Connected](#name-simple-isp-connectivity-wher){.selfRef}
:::

One option is to effectively modify the topology by creating a logical
tunnel between SERa and SERb by using Generic Routing Encapsulation
(GRE) \[[RFC7676](#RFC7676){.xref}\], for example. Although SERa and
SERb are not directly connected physically in this topology, they can be
directly connected logically by a tunnel.[¶](#section-4.2-3){.pilcrow}

The other option is to enable SADR functionality on R7. In this way, R7
will exchange source-scoped routes with SERa and SERb, making the three
routers act as a single SADR domain. This illustrates the basic
principle that the minimum requirement for the routed site network to
support PA multihoming is having all of the site exit routers be part of
a connected SADR domain. Extending the connected SADR domain beyond that
point can produce more efficient forwarding
paths.[¶](#section-4.2-4){.pilcrow}
:::
:::

::: {#sec_network_operator_expectations}
::: {#section-4.3 .section}
### [4.3.](#section-4.3){.section-number .selfRef} [Enterprise Network Operator Expectations](#name-enterprise-network-operator){.section-name .selfRef} {#name-enterprise-network-operator}

Before considering a more complex scenario, let\'s look in more detail
at the reasonably simple multihoming scenario in [Figure
2](#fig_simple_not_dir_conn){.xref} to understand what can reasonably be
expected from this solution. As a general guiding principle, we assume
an enterprise network operator will expect a multihomed network to
behave as close to a single-homed network as possible. So a solution
that meets those expectations where possible is a good
thing.[¶](#section-4.3-1){.pilcrow}

For traffic between internal hosts and for traffic from outside the site
to internal hosts, an enterprise network operator would expect there to
be no visible change in the path taken by this traffic, since this
traffic does not need to be routed in a way that depends on source
address. It is also reasonable to expect that internal hosts should be
able to communicate with each other using either of their source
addresses without restriction. For example, H31 should be able to
communicate with H41 using a packet with S=2001:db8:0:a010::31,
D=2001:db8:0:b020::41, regardless of the state of uplink to
ISP-B.[¶](#section-4.3-2){.pilcrow}

These goals can be accomplished by having all of the routers in the
network continue to originate normal unscoped destination routes for
their connected networks. If we can arrange it so that these unscoped
destination routes are used for forwarding this traffic, then we will
have accomplished multihoming\'s goal of not affecting the forwarding of
traffic destined for internal hosts.[¶](#section-4.3-3){.pilcrow}

For traffic destined for external hosts, it is reasonable to expect that
traffic with a source address from the prefix assigned by ISP-A to
follow the path that the traffic would follow if there were no
connection to ISP-B. This can be accomplished by having SERa originate a
source-scoped route of the form (S=2001:db8:0:a000::/52, D=::/0). If all
of the routers in the site support SADR, then the path of traffic
exiting via ISP-A can match that expectation. If some routers don\'t
support SADR, then it is reasonable to expect that the path for traffic
exiting via ISP-A may be different within the site. This is a trade-off
that the enterprise network operator may decide to
make.[¶](#section-4.3-4){.pilcrow}

It is important to understand the behavior of this multihoming solution
when an uplink to one of the ISPs fails. To simplify this discussion, we
assume that all routers in the site support SADR. We start by looking at
the operation of the network when the uplinks to both ISP-A and ISP-B
are functioning properly. SERa originates a source-scoped route of the
form (S=2001:db8:0:a000::/52, D=::/0), and SERb originates a
source-scoped route of the form (S=2001:db8:0:b000::/52, D=::/0). These
routes are distributed through the routers in the site, and they
establish within the routers two sets of forwarding paths for traffic
leaving the site. One set of forwarding paths is for packets with source
addresses in 2001:db8:0:a000::/52. The other set of forwarding paths is
for packets with source addresses in 2001:db8:0:b000::/52. The normal
destination routes, which are not scoped to these two source prefixes,
play no role in the forwarding. Whether a packet exits the site via SERa
or via SERb is completely determined by the source address applied to
the packet by the host. So for example, when host H31 sends a packet to
host H101 with (S=2001:db8:0:a010::31, D=2001:db8:0:1234::101), the
packet will only be sent out the link from SERa to
ISP-A.[¶](#section-4.3-5){.pilcrow}

Now consider what happens when the uplink from SERa to ISP-A fails. The
only way for the packets from H31 to reach H101 is for H31 to start
using the source address for ISP-B. H31 needs to send the following
packet: (S=2001:db8:0:b010::31,
D=2001:db8:0:1234::101).[¶](#section-4.3-6){.pilcrow}

This behavior is very different from the behavior that occurs with site
multihoming using PI addresses or with PA addresses using NAT. In these
other multihoming solutions, hosts do not need to react to network
failures several hops away in order to regain Internet access. Instead,
a host can be largely unaware of the failure of an uplink to an ISP.
When multihoming with PA addresses and NAT, existing sessions generally
need to be reestablished after a failure since the external host will
receive packets from the internal host with a new source address.
However, new sessions can be established without any action on the part
of the hosts. Multihoming with PA addresses and NAT has created the
expectation of a fairly quick and simple recovery from network failures.
Alternatives should to be evaluated in terms of the speed and complexity
of the recovery mechanism.[¶](#section-4.3-7){.pilcrow}

Another significant difference between this multihoming solution and
multihoming with either PI addresses or with PA addresses using NAT is
the ability of the enterprise network operator to route traffic over
different ISPs based on destination address. We still consider the
fairly simple network of [Figure 2](#fig_simple_not_dir_conn){.xref} and
assume that uplinks to both ISPs are functioning. Assume that the site
is multihomed using PA addresses and NAT, and that SERa and SERb each
originate a normal destination route for D=::/0, with the route
origination dependent on the state of the uplink to the respective
ISP.[¶](#section-4.3-8){.pilcrow}

Now suppose it is observed that an important application running between
internal hosts and external host H101 experiences much better
performance when the traffic passes through ISP-A (perhaps because ISP-A
provides lower latency to H101). When multihoming this site with PI
addresses or with PA addresses and NAT, the enterprise network operator
can configure SERa to originate into the site network a normal
destination route for D=2001:db8:0:1234::/64 (the destination prefix to
reach H101) that depends on the state of the uplink to ISP-A. When the
link to ISP-A is functioning, the destination route
D=2001:db8:0:1234::/64 will be originated by SERa, so traffic from all
hosts will use ISP-A to reach H101 based on the longest destination
prefix match in the route lookup.[¶](#section-4.3-9){.pilcrow}

Implementing the same routing policy is more difficult with the PA
multihoming solution described in this document since it doesn\'t use
NAT. By design, the only way to control where a packet exits this
network is by setting the source address of the packet. Since the
network cannot modify the source address without NAT, the host must set
it. To implement this routing policy, each host needs to use the source
address from the prefix assigned by ISP-A to send traffic destined for
H101. Mechanisms have been proposed to allow hosts to choose the source
address for packets in a fine-grained manner. We will discuss these
proposals in [Section 6](#sec_host_mechanisms){.xref}. However, an
enterprise network administrator would not expect to interact with host
operating systems to ensure that a particular source address is chosen
for a particular destination prefix in order to implement this routing
policy.[¶](#section-4.3-10){.pilcrow}
:::
:::

::: {#sec_more_complex_isp_connectivity}
::: {#section-4.4 .section}
### [4.4.](#section-4.4){.section-number .selfRef} [More Complex ISP Connectivity](#name-more-complex-isp-connectivi){.section-name .selfRef} {#name-more-complex-isp-connectivi}

The previous sections considered two variations of a simple multihoming
scenario in which the site is connected to two ISPs offering only
Internet connectivity. It is likely that many actual enterprise
multihoming scenarios will be similar to this simple example. However,
there are more complex multihoming scenarios that we would like this
solution to address as well.[¶](#section-4.4-1){.pilcrow}

It is fairly common for an ISP to offer a service in addition to
Internet access over the same uplink. Two variations of this are
reflected in [Figure 3](#fig_isp_service){.xref}. In addition to
Internet access, ISP-A offers a service that requires the site to access
host H51 at 2001:db8:0:5555::51. The site has a single physical and
logical connection with ISP-A, and ISP-A only allows access to H51 over
that connection. So when H32 needs to access the service at H51, it
needs to send packets with (S=2001:db8:0:a010::32,
D=2001:db8:0:5555::51), and those packets need to be forwarded out the
link from SERa to ISP-A.[¶](#section-4.4-2){.pilcrow}

[]{#name-internet-access-and-service}

::: {#fig_isp_service}
::: {#section-4.4-3.1 .artwork .art-text .alignCenter}
                                          2001:db8:0:1234::101    H101
                                                                   |
                                                                   |
    2001:db8:0:a010::31                                        --------
    2001:db8:0:b010::31                          ,-----.      /        \
                     +--+   +--+       +----+  ,'       `.   :          :
                 +---|R1|---|R4|---+---|SERa|-+   ISP-A   +--+--        :
            H31--+   +--+   +--+   |   +----+  `.       ,'   :          :
                 |                 |             `-----'     : Internet :
                 |                 |                |        :          :
                 |                 |               H51       :          :
                 |                 |     2001:db8:0:5555::51 :          :
                 |               +--+                        :          :
                 |               |R7|                        :          :
                 |               +--+                        :          :
                 |                 |                         :          :
                 |                 |             ,-----.     :          :
            H32--+   +--+          |  +-----+  ,'       `.   :          :
                 +---|R2|-----+----+--|SERb1|-+   ISP-B   +--+--        :
                     +--+     |       +-----+  `.       ,'   :          :
                            +--+                 `--|--'     :          :
    2001:db8:0:a010::32     |R8|                    |         \        /
                            +--+                 ,--|--.       --------
                              |       +-----+  ,'       `.         |
                              +-------|SERb2|-+   ISP-B   |        |
                              |       +-----+  `.       ,'       H501
                              |                  `-----'  2001:db8:0:5678
                              |                     |               ::501
                      +--+  +--+                   H61
             H41------|R3|--|R5|           2001:db8:0:6666::61
                      +--+  +--+

    2001:db8:0:a020::41
    2001:db8:0:b020::41
:::

[Figure 3](#figure-3){.selfRef}: [Internet Access and Services Offered
by ISP-A and ISP-B](#name-internet-access-and-service){.selfRef}
:::

ISP-B illustrates a variation on this scenario. In addition to Internet
access, ISP-B also offers a service that requires the site to access
host H61. The site has two connections to two different parts of ISP-B
(shown as SERb1 and SERb2 in [Figure 3](#fig_isp_service){.xref}). ISP-B
expects Internet traffic to use the uplink from SERb1, while it expects
traffic destined for the service at H61 to use the uplink from SERb2.
For either uplink, ISP-B expects the ingress traffic to have a source
address matching the prefix that it assigned to the site,
2001:db8:0:b000::/52.[¶](#section-4.4-4){.pilcrow}

As discussed before, we rely completely on the internal host to set the
source address of the packet properly. In the case of a packet sent by
H31 to access the service in ISP-B at H61, we expect the packet to have
the following addresses: (S=2001:db8:0:b010::31, D=2001:db8:0:6666::61).
The routed network has two potential ways of distributing routes so that
this packet exits the site on the uplink at
SERb2.[¶](#section-4.4-5){.pilcrow}

We could just rely on normal destination routes, without using
source-prefix-scoped routes. If we have SERb2 originate a normal
unscoped destination route for D=2001:db8:0:6666::/64, the packets from
H31 to H61 will exit the site at SERb2 as desired. We should not have to
worry about SERa needing to originate the same route, because ISP-B
should choose a globally unique prefix for the service at
H61.[¶](#section-4.4-6){.pilcrow}

The alternative is to have SERb2 originate a source-prefix-scoped
destination route of the form (S=2001:db8:0:b000::/52,
D=2001:db8:0:6666::/64). From a forwarding point of view, the use of the
source-prefix-scoped destination route would result in traffic with
source addresses corresponding only to ISP-B being sent to SERb2.
Instead, the use of the unscoped destination route would result in
traffic with source addresses corresponding to ISP-A and ISP-B being
sent to SERb2, as long as the destination address matches the
destination prefix. It seems like either forwarding behavior would be
acceptable.[¶](#section-4.4-7){.pilcrow}

However, from the point of view of the enterprise network administrator
trying to configure, maintain, and troubleshoot this multihoming
solution, it seems much clearer to have SERb2 originate the
source-prefix-scoped destination route corresponding to the service
offered by ISP-B. In this way, all of the traffic leaving the site is
determined by the source-prefix-scoped routes, and all of the traffic
within the site or arriving from external hosts is determined by the
unscoped destination routes. Therefore, for this multihoming solution we
choose to originate source-prefix-scoped routes for all traffic leaving
the site.[¶](#section-4.4-8){.pilcrow}
:::
:::

::: {#sec_isps_and_pa_prefixes}
::: {#section-4.5 .section}
### [4.5.](#section-4.5){.section-number .selfRef} [ISPs and Provider-Assigned Prefixes](#name-isps-and-provider-assigned-){.section-name .selfRef} {#name-isps-and-provider-assigned-}

While we expect that most site multihoming involves connecting to only
two ISPs, this solution allows for connections to an arbitrary number of
ISPs. However, when evaluating scalable implementations of the solution,
it would be reasonable to assume that the maximum number of ISPs that a
site would connect to is five (topologies with two redundant routers,
each having two uplinks to different ISPs, plus a tunnel to a head
office acting as fifth one are not unheard
of).[¶](#section-4.5-1){.pilcrow}

It is also useful to note that the prefixes assigned to the site by
different ISPs will not overlap. This must be the case, since the
provider-assigned addresses have to be globally
unique.[¶](#section-4.5-2){.pilcrow}
:::
:::

::: {#sec_simpler_topologies}
::: {#section-4.6 .section}
### [4.6.](#section-4.6){.section-number .selfRef} [Simplified Topologies](#name-simplified-topologies){.section-name .selfRef} {#name-simplified-topologies}

The topologies of many enterprise sites using this multihoming solution
may in practice be simpler than the examples that we have used. The
topology in [Figure 1](#fig_simple_scenario){.xref} could be further
simplified by directly connecting all hosts to the LAN that connects the
two site exit routers, SERa and SERb. The topology could also be
simplified by connecting both uplinks to ISP-A and ISP-B to the same
site exit router. However, it is the aim of this document to provide a
solution that applies to a broad range of enterprise site network
topologies, so this document focuses on providing a solution to the more
general case. The simplified cases will also be supported by this
solution, and there may even be optimizations that can be made for
simplified cases. This solution, however, needs to support more complex
topologies.[¶](#section-4.6-1){.pilcrow}

We are starting with the basic assumption that enterprise site networks
can be quite complex from a routing perspective. However, even a complex
site network can be multihomed to different ISPs with PA addresses using
IPv4 and NAT. It is not reasonable to expect an enterprise network
operator to change the routing topology of the site in order to deploy
IPv6.[¶](#section-4.6-2){.pilcrow}
:::
:::
:::
:::

::: {#sec_method}
::: {#section-5 .section}
## [5.](#section-5){.section-number .selfRef} [Generating Source-Prefix-Scoped Forwarding Tables](#name-generating-source-prefix-sc){.section-name .selfRef} {#name-generating-source-prefix-sc}

So far, we have described in general terms how the SADR-capable routers
in this solution forward traffic by using both normal unscoped
destination routes and source-prefix-scoped destination routes. Here we
give a precise method for generating a source-prefix-scoped forwarding
table on a router that supports SADR.[¶](#section-5-1){.pilcrow}

1.  [Compute the next-hops for the source-prefix-scoped destination
    prefixes using only routers in the connected SADR domain. These are
    the initial source-prefix-scoped forwarding table
    entries.[¶](#section-5-2.1){.pilcrow}]{#section-5-2.1}
2.  [Compute the next-hops for the unscoped destination prefixes using
    all routers in the IGP. This is the unscoped forwarding
    table.[¶](#section-5-2.2){.pilcrow}]{#section-5-2.2}
3.  [For a given source-prefix-scoped forwarding table T (scoped to
    source prefix P), consider a source-prefix-scoped forwarding table
    T\', whose source prefix P\' contains P. We call T the more specific
    source-prefix-scoped forwarding table, and T\' the less specific
    source-prefix-scoped forwarding table. We select entries in
    forwarding table T\' to augment forwarding table T based on the
    following rules. If a destination prefix of an entry in forwarding
    table T\' exactly matches the destination prefix of an existing
    entry in forwarding table T (including destination prefix length),
    then do not add the entry to forwarding table T. If the destination
    prefix does NOT match an existing entry, then add the entry to
    forwarding table T. As the unscoped forwarding table is considered
    to be scoped to ::/0, this process will propagate routes from the
    unscoped forwarding table to forwarding table T. If there exist
    multiple source-prefix-scoped forwarding tables whose source
    prefixes contain P, these source-prefix-scoped forwarding tables
    should be processed in order from most specific to least
    specific.[¶](#section-5-2.3){.pilcrow}]{#section-5-2.3}

The forwarding tables produced by this process are used in the following
way to forward packets.[¶](#section-5-3){.pilcrow}

1.  [Select the most specific (longest prefix match)
    source-prefix-scoped forwarding table that matches the source
    address of the packet (again, the unscoped forwarding table is
    considered to be scoped to
    ::/0).[¶](#section-5-4.1){.pilcrow}]{#section-5-4.1}
2.  [Look up the destination address of the packet in the selected
    forwarding table to determine the next-hop for the
    packet.[¶](#section-5-4.2){.pilcrow}]{#section-5-4.2}

The following example illustrates how this process is used to create a
forwarding table for each provider-assigned source prefix. We consider
the multihomed site network in [Figure 3](#fig_isp_service){.xref}.
Initially we assume that all of the routers in the site network support
SADR. [Figure 4](#fig_routes_originated){.xref} shows the routes that
are originated by the routers in the site
network.[¶](#section-5-5){.pilcrow}

[]{#name-routes-originated-by-router}

::: {#fig_routes_originated}
::: {#section-5-6.1 .artwork .art-text .alignLeft}
    Routes originated by SERa:
    (S=2001:db8:0:a000::/52, D=2001:db8:0:5555/64)
    (S=2001:db8:0:a000::/52, D=::/0)
    (D=2001:db8:0:5555::/64)
    (D=::/0)

    Routes originated by SERb1:
    (S=2001:db8:0:b000::/52, D=::/0)
    (D=::/0)

    Routes originated by SERb2:
    (S=2001:db8:0:b000::/52, D=2001:db8:0:6666::/64)
    (D=2001:db8:0:6666::/64)

    Routes originated by R1:
    (D=2001:db8:0:a010::/64)
    (D=2001:db8:0:b010::/64)

    Routes originated by R2:
    (D=2001:db8:0:a010::/64)
    (D=2001:db8:0:b010::/64)

    Routes originated by R3:
    (D=2001:db8:0:a020::/64)
    (D=2001:db8:0:b020::/64)
:::

[Figure 4](#figure-4){.selfRef}: [Routes Originated by Routers in the
Site Network](#name-routes-originated-by-router){.selfRef}
:::

Each SER originates destination routes that are scoped to the source
prefix assigned by the ISP to which the SER connects. Note that the SERs
also originate the corresponding unscoped destination route. This is not
needed when all of the routers in the site support SADR. However, it is
required when some routers do not support SADR. This will be discussed
in more detail later.[¶](#section-5-7){.pilcrow}

We focus on how R8 constructs its source-prefix-scoped forwarding tables
from these route advertisements. R8 computes the next hops for
destination routes that are scoped to the source prefix
2001:db8:0:a000::/52. The results are shown in the first table in
[Figure 5](#fig_forwarding_entries){.xref}. (In this example, the next
hops are computed assuming that all links have the same metric.) Then,
R8 computes the next hops for destination routes that are scoped to the
source prefix 2001:db8:0:b000::/52. The results are shown in the second
table in [Figure 5](#fig_forwarding_entries){.xref}. Finally, R8
computes the next hops for the unscoped destination prefixes. The
results are shown in the third table in [Figure
5](#fig_forwarding_entries){.xref}.[¶](#section-5-8){.pilcrow}

[]{#name-forwarding-entries-computed}

::: {#fig_forwarding_entries}
::: {#section-5-9.1 .artwork .art-text .alignLeft}
    forwarding entries scoped to
    source prefix = 2001:db8:0:a000::/52
    ============================================
    D=2001:db8:0:5555/64      NH=R7
    D=::/0                    NH=R7

    forwarding entries scoped to
    source prefix = 2001:db8:0:b000::/52
    ============================================
    D=2001:db8:0:6666/64      NH=SERb2
    D=::/0                    NH=SERb1

    unscoped forwarding entries
    ============================================
    D=2001:db8:0:a010::/64    NH=R2
    D=2001:db8:0:b010::/64    NH=R2
    D=2001:db8:0:a020::/64    NH=R5
    D=2001:db8:0:b020::/64    NH=R5
    D=2001:db8:0:5555::/64    NH=R7
    D=2001:db8:0:6666::/64    NH=SERb2
    D=::/0                    NH=SERb1
:::

[Figure 5](#figure-5){.selfRef}: [Forwarding Entries Computed at
R8](#name-forwarding-entries-computed){.selfRef}
:::

The final step is for R8 to augment the more specific
source-prefix-scoped forwarding tables with entries from less specific
source-prefix-scoped forwarding tables. The unscoped forwarding table is
considered as being scoped to ::/0, so both 2001:db8:0:a000::/52 and
2001:db8:0:b000::/52 are more specific prefixes of ::/0. Therefore,
entries in the unscoped forwarding table will be evaluated to be added
to these two more specific source-prefix-scoped forwarding tables. If a
forwarding entry from the less specific source-prefix-scoped forwarding
table has the exact same destination prefix (including destination
prefix length) as the forwarding entry from the more specific
source-prefix-scoped forwarding table, then the existing forwarding
entry in the more specific source-prefix-scoped forwarding table
wins.[¶](#section-5-10){.pilcrow}

As an example of how the source-prefix-scoped forwarding entries are
augmented, we consider how the two entries in the first table in [Figure
5](#fig_forwarding_entries){.xref} (the table for source prefix =
2001:db8:0:a000::/52) are augmented with entries from the third table in
[Figure 5](#fig_forwarding_entries){.xref} (the table of unscoped or
scoped to ::/0 forwarding entries). The first four unscoped forwarding
entries (D=2001:db8:0:a010::/64, D=2001:db8:0:b010::/64,
D=2001:db8:0:a020::/64, and D=2001:db8:0:b020::/64) are not an exact
match for any of the existing entries in the forwarding table for source
prefix 2001:db8:0:a000::/52. Therefore, these four entries are added to
the final forwarding table for source prefix 2001:db8:0:a000::/52. The
result of adding these entries is reflected in the first four entries
the first table in [Figure
6](#fig_forwarding_tables){.xref}.[¶](#section-5-11){.pilcrow}

The next less specific source-prefix-scoped (scope is ::/0) forwarding
table entry is for D=2001:db8:0:5555::/64. This entry is an exact match
for the existing entry in the forwarding table for the more specific
source prefix 2001:db8:0:a000::/52. Therefore, we do not replace the
existing entry with the entry from the unscoped forwarding table. This
is reflected in the fifth entry in the first table in [Figure
6](#fig_forwarding_tables){.xref}. (Note that since both scoped and
unscoped entries have R7 as the next hop, the result of applying this
rule is not visible.)[¶](#section-5-12){.pilcrow}

The next less specific source-prefix-scoped (scope is ::/0) forwarding
table entry is for D=2001:db8:0:6666::/64. This entry is not an exact
match for any existing entries in the forwarding table for source prefix
2001:db8:0:a000::/52. Therefore, we add this entry. This is reflected in
the sixth entry in the first table in [Figure
6](#fig_forwarding_tables){.xref}.[¶](#section-5-13){.pilcrow}

The next less specific source-prefix-scoped (scope is ::/0) forwarding
table entry is for D=::/0. This entry is an exact match for the existing
entry in the forwarding table for the more specific source prefix
2001:db8:0:a000::/52. Therefore, we do not overwrite the existing
source-prefix-scoped entry, as can be seen in the last entry in the
first table in [Figure
6](#fig_forwarding_tables){.xref}.[¶](#section-5-14){.pilcrow}

[]{#name-complete-forwarding-tables-}

::: {#fig_forwarding_tables}
::: {#section-5-15.1 .artwork .art-text .alignLeft}
    if source address matches 2001:db8:0:a000::/52
    then use this forwarding table
    ============================================
    D=2001:db8:0:a010::/64    NH=R2
    D=2001:db8:0:b010::/64    NH=R2
    D=2001:db8:0:a020::/64    NH=R5
    D=2001:db8:0:b020::/64    NH=R5
    D=2001:db8:0:5555::/64    NH=R7
    D=2001:db8:0:6666::/64    NH=SERb2
    D=::/0                    NH=R7

    else if source address matches 2001:db8:0:b000::/52
    then use this forwarding table
    ============================================
    D=2001:db8:0:a010::/64    NH=R2
    D=2001:db8:0:b010::/64    NH=R2
    D=2001:db8:0:a020::/64    NH=R5
    D=2001:db8:0:b020::/64    NH=R5
    D=2001:db8:0:5555::/64    NH=R7
    D=2001:db8:0:6666::/64    NH=SERb2
    D=::/0                    NH=SERb1

    else if source address matches ::/0 use this forwarding table
    ============================================
    D=2001:db8:0:a010::/64    NH=R2
    D=2001:db8:0:b010::/64    NH=R2
    D=2001:db8:0:a020::/64    NH=R5
    D=2001:db8:0:b020::/64    NH=R5
    D=2001:db8:0:5555::/64    NH=R7
    D=2001:db8:0:6666::/64    NH=SERb2
    D=::/0                    NH=SERb1
:::

[Figure 6](#figure-6){.selfRef}: [Complete Forwarding Tables Computed at
R8](#name-complete-forwarding-tables-){.selfRef}
:::

The forwarding tables produced by this process at R8 have the desired
properties. A packet with a source address in 2001:db8:0:a000::/52 will
be forwarded based on the first table in [Figure
6](#fig_forwarding_tables){.xref}. If the packet is destined for the
Internet at large or the service at D=2001:db8:0:5555/64, it will be
sent to R7 in the direction of SERa. If the packet is destined for an
internal host, then the first four entries will send it to R2 or R5 as
expected. Note that if this packet has a destination address
corresponding to the service offered by ISP-B (D=2001:db8:0:5555::/64),
then it will get forwarded to SERb2. It will be dropped by SERb2 or by
ISP-B, since the packet has a source address that was not assigned by
ISP-B. However, this is expected behavior. In order to use the service
offered by ISP-B, the host needs to originate the packet with a source
address assigned by ISP-B.[¶](#section-5-16){.pilcrow}

In this example, a packet with a source address that doesn\'t match
2001:db8:0:a000::/52 or 2001:db8:0:b000::/52 must have originated from
an external host. Such a packet will use the unscoped forwarding table
(the last table in [Figure 6](#fig_forwarding_tables){.xref}). These
packets will flow exactly as they would in absence of
multihoming.[¶](#section-5-17){.pilcrow}

We can also modify this example to illustrate how it supports
deployments in which not all routers in the site support SADR.
Continuing with the topology shown in [Figure
3](#fig_isp_service){.xref}, suppose that R3 and R5 do not support SADR.
Instead they are only capable of understanding unscoped route
advertisements. The SADR routers in the network will still originate the
routes shown in [Figure 4](#fig_routes_originated){.xref}. However, R3
and R5 will only understand the unscoped routes as shown in [Figure
7](#fig_routes_understood_by_non_SADR){.xref}.[¶](#section-5-18){.pilcrow}

[]{#name-route-advertisements-unders}

::: {#fig_routes_understood_by_non_SADR}
::: {#section-5-19.1 .artwork .art-text .alignLeft}
    Routes originated by SERa:
    (D=2001:db8:0:5555::/64)
    (D=::/0)

    Routes originated by SERb1:
    (D=::/0)

    Routes originated by SERb2:
    (D=2001:db8:0:6666::/64)

    Routes originated by R1:
    (D=2001:db8:0:a010::/64)
    (D=2001:db8:0:b010::/64)

    Routes originated by R2:
    (D=2001:db8:0:a010::/64)
    (D=2001:db8:0:b010::/64)

    Routes originated by R3:
    (D=2001:db8:0:a020::/64)
    (D=2001:db8:0:b020::/64)
:::

[Figure 7](#figure-7){.selfRef}: [Route Advertisements Understood by
Routers That Do Not Support
SADR](#name-route-advertisements-unders){.selfRef}
:::

With these unscoped route advertisements, R5 will produce the forwarding
table shown in [Figure
8](#fig_R5_forwarding_table){.xref}.[¶](#section-5-20){.pilcrow}

[]{#name-forwarding-table-for-r5-whi}

::: {#fig_R5_forwarding_table}
::: {#section-5-21.1 .artwork .art-text .alignLeft}
    forwarding table
    ============================================
    D=2001:db8:0:a010::/64    NH=R8
    D=2001:db8:0:b010::/64    NH=R8
    D=2001:db8:0:a020::/64    NH=R3
    D=2001:db8:0:b020::/64    NH=R3
    D=2001:db8:0:5555::/64    NH=R8
    D=2001:db8:0:6666::/64    NH=SERb2
    D=::/0                    NH=R8
:::

[Figure 8](#figure-8){.selfRef}: [Forwarding Table for R5, Which
Doesn\'t Understand Source-Prefix-Scoped
Routes](#name-forwarding-table-for-r5-whi){.selfRef}
:::

As all SERs belong to the SADR domain, any traffic that needs to exit
the site will eventually hit a SADR-capable router. To prevent routing
loops involving SADR-capable and non-SADR-capable routers, traffic that
enters the SADR-capable domain does not leave the domain until it exits
the site. Therefore all SADR-capable routers within the domain
[MUST]{.bcp14} be logically connected.[¶](#section-5-22){.pilcrow}

Note that the mechanism described here for converting
source-prefix-scoped destination prefix routing advertisements into
forwarding state is somewhat different from that proposed in
\[[DST-SRC-RTG](#I-D.ietf-rtgwg-dst-src-routing){.xref}\]. The method
described in this document is functionally equivalent, but it is based
on application of existing mechanisms for the described
scenarios.[¶](#section-5-23){.pilcrow}
:::
:::

::: {#sec_host_mechanisms}
::: {#section-6 .section}
## [6.](#section-6){.section-number .selfRef} [Mechanisms for Hosts To Choose Good Default Source Addresses in a Multihomed Site](#name-mechanisms-for-hosts-to-cho){.section-name .selfRef} {#name-mechanisms-for-hosts-to-cho}

Until this point, we have made the assumption that hosts are able to
choose the correct source address using some unspecified mechanism. This
has allowed us to focus on what the routers in a multihomed site network
need to do in order to forward packets to the correct ISP based on
source address. Now we look at possible mechanisms for hosts to choose
the correct source address. We also look at what role, if any, the
routers may play in providing information that helps hosts to choose
source addresses.[¶](#section-6-1){.pilcrow}

It should be noted that this section discusses how hosts could select
the default source address for new connections. Any connection that
already exists on a host is bound to a specific source address that
cannot be changed. [Section 6.7](#sec_conn_pre){.xref} discusses the
connections preservation issue in more
detail.[¶](#section-6-2){.pilcrow}

Any host that needs to be able to send traffic using the uplinks to a
given ISP is expected to be configured with an address from the prefix
assigned by that ISP. The host will control which ISP is used for its
traffic by selecting one of the addresses configured on the host as the
source address for outgoing traffic. It is the responsibility of the
site network to ensure that a packet with the source address from an ISP
is now sent on an uplink to that ISP.[¶](#section-6-3){.pilcrow}

If all of the ISP uplinks are working, then the host\'s choice of source
address may be driven by the desire to load share across ISP uplinks, or
it may be driven by the desire to take advantage of certain properties
of a particular uplink or ISP (if some information about various path
properties has been made available to the host somehow. See
\[[PROV-DOMAINS](#I-D.ietf-intarea-provisioning-domains){.xref}\] as an
example). If any of the ISP uplinks is not working, then the choice of
source address by the host can cause packets to get
dropped.[¶](#section-6-4){.pilcrow}

How a host selects a suitable source address in a multihomed site is not
a solved problem. We do not attempt to solve this problem in this
document. Instead we discuss the current state of affairs with respect
to standardized solutions and the implementation of those solutions. We
also look at proposed solutions for this
problem.[¶](#section-6-5){.pilcrow}

An external host initiating communication with a host internal to a
PA-multihomed site will need to know multiple addresses for that host in
order to communicate with it using different ISPs to the multihomed site
(knowing just one address would undermine all benefits of redundant
connectivity provided by multihoming). These addresses are typically
learned through DNS. (For simplicity, we assume that the external host
is single-homed.) The external host chooses the ISP that will be used at
the remote multihomed site by setting the destination address on the
packets it transmits. For a session originated from an external host to
an internal host, the choice of source address used by the internal host
is simple. The internal host has no choice but to use the destination
address in the received packet as the source address of the transmitted
packet.[¶](#section-6-6){.pilcrow}

For a session originated by a host inside the multihomed site, the
decision of which source address to select is more complicated. We
consider three main methods for hosts to get information about the
network. The two proactive methods are Neighbor Discovery Router
Advertisements and DHCPv6. The one reactive method we consider is
ICMPv6. Note that we are explicitly excluding the possibility of having
hosts participate in, or even listen directly to, routing protocol
advertisements.[¶](#section-6-7){.pilcrow}

First we look at how a host is currently expected to select the default
source and destination addresses to be used for a new
connection.[¶](#section-6-8){.pilcrow}

::: {#sec_host_address_selection_algo}
::: {#section-6.1 .section}
### [6.1.](#section-6.1){.section-number .selfRef} [Default Source Address Selection Algorithm on Hosts](#name-default-source-address-sele){.section-name .selfRef} {#name-default-source-address-sele}

\[[RFC6724](#RFC6724){.xref}\] defines the algorithms that hosts are
expected to use to select source and destination addresses for packets.
It defines an algorithm for selecting a source address and a separate
algorithm for selecting a destination address. Both of these algorithms
depend on a policy table. \[[RFC6724](#RFC6724){.xref}\] defines a
default policy that produces certain
behavior.[¶](#section-6.1-1){.pilcrow}

The rules in the two algorithms in \[[RFC6724](#RFC6724){.xref}\] depend
on many different properties of addresses. While these are needed for
understanding how a host should choose addresses in an arbitrary
environment, most of the rules are not relevant for understanding how a
host should choose among multiple source addresses in a multihomed
environment when sending a packet to a remote host. Returning to the
example in [Figure 3](#fig_isp_service){.xref}, we look at what the
default algorithms in \[[RFC6724](#RFC6724){.xref}\] say about the
source address that internal host H31 should use to send traffic to
external host H101, somewhere on the
Internet.[¶](#section-6.1-2){.pilcrow}

There is no choice to be made with respect to destination address. H31
needs to send a packet with D=2001:db8:0:1234::101 in order to reach
H101. So H31 has to choose between using S=2001:db8:0:a010::31 or
S=2001:db8:0:b010::31 as the source address for this packet. We go
through the rules for source address selection in [Section
5](https://www.rfc-editor.org/rfc/rfc6724#section-5){.relref} of
\[[RFC6724](#RFC6724){.xref}\].[¶](#section-6.1-3){.pilcrow}

Rule 1 (Prefer same address) is not useful to break the tie between
source addresses because neither one of the candidate source addresses
equals the destination address.[¶](#section-6.1-4){.pilcrow}

Rule 2 (Prefer appropriate scope) is also not useful in this scenario
because both source addresses and the destination address have global
scope.[¶](#section-6.1-5){.pilcrow}

Rule 3 (Avoid deprecated addresses) applies to an address that has been
autoconfigured by a host using stateless address autoconfiguration as
defined in \[[RFC4862](#RFC4862){.xref}\]. An address autoconfigured by
a host has a preferred lifetime and a valid lifetime. The address is
preferred until the preferred lifetime expires, after which it becomes
deprecated. A deprecated address is not used if there is a preferred
address of the appropriate scope available. When the valid lifetime
expires, the address cannot be used at all. The preferred and valid
lifetimes for an autoconfigured address are set based on the
corresponding lifetimes in the Prefix Information Option in Neighbor
Discovery Router Advertisements. In this scenario, a possible tool to
control source address selection in this scenario would be for a host to
deprecate an address by having routers on that link, R1 and R2 in
[Figure 3](#fig_isp_service){.xref}, send Router Advertisement messages
containing PIOs with the Preferred Lifetime value for the deprecated
source prefix set to zero. This is a rather blunt tool, because it
discourages or prohibits the use of that source prefix for all
destinations. However, it may be useful in some scenarios. For example,
if all uplinks to a particular ISP fail, it is desirable to prevent
hosts from using source addresses from that ISP address
space.[¶](#section-6.1-6){.pilcrow}

Rule 4 (Avoid home addresses) does not apply here because we are not
considering Mobile IP.[¶](#section-6.1-7){.pilcrow}

Rule 5 (Prefer outgoing interface) is not useful in this scenario
because both source addresses are assigned to the same
interface.[¶](#section-6.1-8){.pilcrow}

Rule 5.5 (Prefer addresses in a prefix advertised by the next-hop) is
not useful in the scenario when both R1 and R2 will advertise both
source prefixes. However, this rule may potentially allow a host to
select the correct source prefix by selecting a next-hop. The most
obvious way would be to make R1 advertise itself as a default router and
send PIO for 2001:db8:0:a010::/64, while R2 advertises itself as a
default router and sends PIO for 2001:db8:0:b010::/64. We\'ll discuss
later how Rule 5.5 can be used to influence a source address selection
in single-router topologies (e.g., when H41 is sending traffic using R3
as a default gateway).[¶](#section-6.1-9){.pilcrow}

Rule 6 (Prefer matching label) refers to the label value determined for
each source and destination prefix as a result of applying the policy
table to the prefix. With the default policy table defined in [Section
2.1](https://www.rfc-editor.org/rfc/rfc6724#section-2.1){.relref} of
\[[RFC6724](#RFC6724){.xref}\], Label(2001:db8:0:a010::31) = 5,
Label(2001:db8:0:b010::31) = 5, and Label(2001:db8:0:1234::101) = 5. So
with the default policy, Rule 6 does not break the tie. However, the
algorithms in \[[RFC6724](#RFC6724){.xref}\] are defined in such a way
that non-default address selection policy tables can be used.
\[[RFC7078](#RFC7078){.xref}\] defines a way to distribute a non-default
address selection policy table to hosts using DHCPv6. So even though the
application of Rule 6 to this scenario using the default policy table is
not useful, Rule 6 may still be a useful
tool.[¶](#section-6.1-10){.pilcrow}

Rule 7 (Prefer temporary addresses) has to do with the technique
described in \[[RFC4941](#RFC4941){.xref}\] to periodically randomize
the interface portion of an IPv6 address that has been generated using
stateless address autoconfiguration. In general, if H31 were using this
technique, it would use it for both source addresses, for example,
creating temporary addresses 2001:db8:0:a010:2839:9938:ab58:830f and
2001:db8:0:b010:4838:f483:8384:3208, in addition to 2001:db8:0:a010::31
and 2001:db8:0:b010::31. So this rule would prefer the two temporary
addresses, but it would not break the tie between the two source
prefixes from ISP-A and ISP-B.[¶](#section-6.1-11){.pilcrow}

Rule 8 (Use longest matching prefix) dictates that, between two
candidate source addresses, the host selects the one that has longest
common prefix length with the destination address. For example, if H31
were selecting the source address for sending packets to H101, this rule
would not break the tie between candidate source addresses
2001:db8:0:a101::31 and 2001:db8:0:b101::31 since the common prefix
length with the destination is 48. However, if H31 were selecting the
source address for sending packets to H41 address 2001:db8:0:a020::41,
then this rule would result in using 2001:db8:0:a101::31 as a source
(2001:db8:0:a101::31 and 2001:db8:0:a020::41 share the common prefix
2001:db8:0:a000::/58, while for 2001:db8:0:b101::31 and
2001:db8:0:a020::41, the common prefix is 2001:db8:0:a000::/51).
Therefore Rule 8 might be useful for selecting the correct source
address in some, but not all, scenarios (for example if ISP-B services
belong to 2001:db8:0:b000::/59, then H31 would always use
2001:db8:0:b010::31 to access those
destinations).[¶](#section-6.1-12){.pilcrow}

So we can see that of the eight source address selection rules from
\[[RFC6724](#RFC6724){.xref}\], four actually apply to our basic site
multihoming scenario. The rules that are relevant to this scenario are
summarized below.[¶](#section-6.1-13){.pilcrow}

-   [Rule 3: Avoid deprecated
    addresses.[¶](#section-6.1-14.1){.pilcrow}]{#section-6.1-14.1}
-   [Rule 5.5: Prefer addresses in a prefix advertised by the
    next-hop.[¶](#section-6.1-14.2){.pilcrow}]{#section-6.1-14.2}
-   [Rule 6: Prefer matching
    label.[¶](#section-6.1-14.3){.pilcrow}]{#section-6.1-14.3}
-   [Rule 8: Prefer longest matching
    prefix.[¶](#section-6.1-14.4){.pilcrow}]{#section-6.1-14.4}

The two methods that we discuss for controlling the source address
selection through the four relevant rules above are SLAAC Router
Advertisement messages and DHCPv6.[¶](#section-6.1-15){.pilcrow}

We also consider a possible role for ICMPv6 for getting traffic-driven
feedback from the network. With the source address selection algorithm
discussed above, the goal is to choose the correct source address on the
first try, before any traffic is sent. However, another strategy is to
choose a source address, send the packet, get feedback from the network
about whether or not the source address is correct, and try another
source address if it is not.[¶](#section-6.1-16){.pilcrow}

We consider four scenarios in which a host needs to select the correct
source address. In the first scenario, both uplinks are working. In the
second scenario, one uplink has failed. The third scenario is a
situation in which one failed uplink has recovered. The last scenario is
failure of both (all) uplinks.[¶](#section-6.1-17){.pilcrow}

It should be noted that \[[RFC6724](#RFC6724){.xref}\] only defines the
behavior of IPv6 hosts to select default addresses that applications and
upper-layer protocols can use. Applications and upper-layer protocols
can make their own choices on selecting source addresses. The mechanism
proposed in this document attempts to ensure that the subset of source
addresses available for applications and upper-layer protocols is
selected with the up-to-date network state in mind. The rest of the
document discusses various aspects of the default source address
selection defined in \[[RFC6724](#RFC6724){.xref}\], calling it for the
sake of brevity \"the source address
selection\".[¶](#section-6.1-18){.pilcrow}
:::
:::

::: {#sec_both_uplinks_working}
::: {#section-6.2 .section}
### [6.2.](#section-6.2){.section-number .selfRef} [Selecting Default Source Address When Both Uplinks Are Working](#name-selecting-default-source-ad){.section-name .selfRef} {#name-selecting-default-source-ad}

Again we return to the topology in [Figure 3](#fig_isp_service){.xref}.
Suppose that the site administrator wants to implement a policy by which
all hosts need to use ISP-A to reach H101 at D=2001:db8:0:1234::101. So
for example, H31 needs to select
S=2001:db8:0:a010::31.[¶](#section-6.2-1){.pilcrow}

::: {#sec_both_working_dhcpv6}
::: {#section-6.2.1 .section}
#### [6.2.1.](#section-6.2.1){.section-number .selfRef} [Distributing Default Address Selection Policy Table with DHCPv6](#name-distributing-default-addres){.section-name .selfRef} {#name-distributing-default-addres}

This policy can be implemented by using DHCPv6 to distribute an address
selection policy table that assigns the same label to destination
addresses that match 2001:db8:0:1234::/64 as it does to source addresses
that match 2001:db8:0:a000::/52. The following two entries accomplish
this.[¶](#section-6.2.1-1){.pilcrow}

[]{#name-policy-table-entries-to-imp}

::: {#fig_policy_table}
::: {#section-6.2.1-2.1 .artwork .art-text .alignLeft}
    Prefix                 Precedence       Label
    2001:db8:0:1234::/64   50               33
    2001:db8:0:a000::/52   50               33
:::

[Figure 9](#figure-9){.selfRef}: [Policy Table Entries to Implement a
Routing Policy](#name-policy-table-entries-to-imp){.selfRef}
:::

This requires that the hosts implement \[[RFC6724](#RFC6724){.xref}\],
the basic source and destination address framework, along with
\[[RFC7078](#RFC7078){.xref}\], the DHCPv6 extension for distributing a
non-default policy table. Note that it does NOT require that the hosts
use DHCPv6 for address assignment. The hosts could still use stateless
address autoconfiguration for address configuration, while using DHCPv6
only for policy table distribution (see \[[RFC8415](#RFC8415){.xref}\]).
However this method has a number of
disadvantages:[¶](#section-6.2.1-3){.pilcrow}

-   [DHCPv6 support is not a mandatory requirement for IPv6 hosts
    \[[RFC8504](#RFC8504){.xref}\], so this method might not work for
    all devices.[¶](#section-6.2.1-4.1){.pilcrow}]{#section-6.2.1-4.1}
-   [Network administrators are required to explicitly configure the
    desired network access policies on DHCPv6 servers. While it might be
    feasible in the scenario of a single multihomed network, such
    approach might have some scalability issues, especially if the
    centralized DHCPv6 solution is deployed to serve a large number of
    multihomed
    sites.[¶](#section-6.2.1-4.2){.pilcrow}]{#section-6.2.1-4.2}
:::
:::

::: {#sec_both_working_ra}
::: {#section-6.2.2 .section}
#### [6.2.2.](#section-6.2.2){.section-number .selfRef} [Controlling Default Source Address Selection with Router Advertisements](#name-controlling-default-source-){.section-name .selfRef} {#name-controlling-default-source-}

Neighbor Discovery currently has two mechanisms to communicate prefix
information to hosts. The base specification for Neighbor Discovery (see
\[[RFC4861](#RFC4861){.xref}\]) defines the Prefix Information Option
(PIO) in the Router Advertisement (RA) message. When a host receives a
PIO with the A-flag \[[RFC8425](#RFC8425){.xref}\] set, it can use the
prefix in the PIO as the source prefix from which it assigns itself an
IP address using stateless address autoconfiguration (SLAAC) procedures
described in \[[RFC4862](#RFC4862){.xref}\]. In the example of [Figure
3](#fig_isp_service){.xref}, if the site network is using SLAAC, we
would expect both R1 and R2 to send RA messages with PIOs with the
A-flag set for both source prefixes 2001:db8:0:a010::/64 and
2001:db8:0:b010::/64. H31 would then use the SLAAC procedure to
configure itself with 2001:db8:0:a010::31 and
2001:db8:0:b010::31.[¶](#section-6.2.2-1){.pilcrow}

Whereas a host learns about source prefixes from PIO messages, hosts can
learn about a destination prefix from a Router Advertisement containing
a Route Information Option (RIO), as specified in
\[[RFC4191](#RFC4191){.xref}\]. The destination prefixes in RIOs are
intended to allow a host to choose the router that it uses as its first
hop to reach a particular destination
prefix.[¶](#section-6.2.2-2){.pilcrow}

As currently standardized, neither PIO nor RIO options contained in
Neighbor Discovery Router Advertisements can communicate the information
needed to implement the desired routing policy. PIOs communicate source
prefixes, and RIOs communicate destination prefixes. However, there is
currently no standardized way to directly associate a particular
destination prefix with a particular source
prefix.[¶](#section-6.2.2-3){.pilcrow}

\[[SADR-RA](#I-D.pfister-6man-sadr-ra){.xref}\] proposes a Source
Address Dependent Route Information option for Neighbor Discovery Router
Advertisements that would associate a source prefix with a destination
prefix. The details of \[[SADR-RA](#I-D.pfister-6man-sadr-ra){.xref}\]
might need tweaking to address this use case. However, in order to be
able to use Neighbor Discovery Router Advertisements to implement this
routing policy, an extension is needed that would allow R1 and R2 to
explicitly communicate to H31 an association between
S=2001:db8:0:a000::/52 and
D=2001:db8:0:1234::/64.[¶](#section-6.2.2-4){.pilcrow}

However, Rule 5.5 of the default source address selection algorithm
(discussed in [Section 6.1](#sec_host_address_selection_algo){.xref}),
together with default router preference (specified in
\[[RFC4191](#RFC4191){.xref}\]) and RIO, can be used to influence a
source address selection on a host as described below. Let\'s look at
source address selection on the host H41. It receives RAs from R3 with
PIOs for 2001:db8:0:a020::/64 and 2001:db8:0:b020::/64. At that point,
all traffic would use the same next-hop (R3 link-local address) so Rule
5.5 does not apply. Now let\'s assume that R3 supports SADR and has two
scoped forwarding tables, one scoped to S=2001:db8:0:a000::/52 and
another scoped to S=2001:db8:0:b000::/52. If R3 generates two different
link-local addresses for its interface facing H41 (one for each scoped
forwarding table, LLA_A and LLA_B), R3 will send two different RAs: one
from LLA_A that includes a PIO for 2001:db8:0:a020::/64, and another
from LLA_B that includes a PIO for 2001:db8:0:b020::/64. Now it is
possible to influence H41 source address selection for destinations that
follow the default route by setting the default router preference in
RAs. If it is desired that H41 reaches H101 (or any destination in the
Internet) via ISP-A, then RAs sent from LLA_A should have the default
router preference set to 01 (high priority), while RAs sent from LLA_B
should have the preference set to 11 (low). LLA_A would then be chosen
as a next-hop for H101, and therefore (per Rule 5.5) 2001:db8:0:a020::41
would be selected as the source address. If, at the same time, it is
desired that H61 is accessible via ISP-B, then R3 should include a RIO
for 2001:db8:0:6666::/64 in its RA sent from LLA_B. H41 would choose
LLA_B as a next-hop for all traffic to H61, and then per Rule 5.5,
2001:db8:0:b020::41 would be selected as a source
address.[¶](#section-6.2.2-5){.pilcrow}

If in the above-mentioned scenario it is desirable that all Internet
traffic leaves the network via ISP-A, and the link to ISP-B is used for
accessing ISP-B services only (not as an ISP-A link backup), then RAs
sent by R3 from LLA_B should have their Router Lifetime values set to
zero and should include RIOs for ISP-B address space. It would instruct
H41 to use LLA_A for all Internet traffic but to use LLA_B as a next-hop
while sending traffic to ISP-B addresses.[¶](#section-6.2.2-6){.pilcrow}

The description of the mechanism above assumes SADR support by the
first-hop routers as well as SERs. However, a first-hop router can still
provide a less flexible version of this mechanism even without
implementing SADR. This could be done by providing configuration knobs
on the first-hop router that allow it to generate different link-local
addresses and to send individual RAs for each
prefix.[¶](#section-6.2.2-7){.pilcrow}

The mechanism described above relies on Rule 5.5 of the default source
address selection algorithm defined in \[[RFC6724](#RFC6724){.xref}\].
\[[RFC8028](#RFC8028){.xref}\] states that \"A host [SHOULD]{.bcp14}
select default routers for each prefix it is assigned an address in.\"
It also recommends that hosts should implement Rule 5.5. of
\[[RFC6724](#RFC6724){.xref}\]. Hosts following the recommendations
specified in \[[RFC8028](#RFC8028){.xref}\] therefore should be able to
benefit from the solution described in this document. No standards need
to be updated in regards to host
behavior.[¶](#section-6.2.2-8){.pilcrow}
:::
:::

::: {#sec_both_working_icmpv6}
::: {#section-6.2.3 .section}
#### [6.2.3.](#section-6.2.3){.section-number .selfRef} [Controlling Default Source Address Selection with ICMPv6](#name-controlling-default-source-a){.section-name .selfRef} {#name-controlling-default-source-a}

We now discuss how one might use ICMPv6 to implement the routing policy
to send traffic destined for H101 out the uplink to ISP-A, even when
uplinks to both ISPs are working. If H31 started sending traffic to H101
with S=2001:db8:0:b010::31 and D=2001:db8:0:1234::101, it would be
routed through SER-b1 and out the uplink to ISP-B. SERb1 could recognize
that this traffic is not following the desired routing policy and react
by sending an ICMPv6 message back to H31.[¶](#section-6.2.3-1){.pilcrow}

In this example, we could arrange things so that SERb1 drops the packet
with S=2001:db8:0:b010::31 and D=2001:db8:0:1234::101, and then sends to
H31 an ICMPv6 Destination Unreachable message with Code 5 (Source
address failed ingress/egress policy). When H31 receives this packet, it
would then be expected to try another source address to reach the
destination. In this example, H31 would then send a packet with
S=2001:db8:0:a010::31 and D=2001:db8:0:1234::101, which will reach SERa
and be forwarded out the uplink to ISP-A.[¶](#section-6.2.3-2){.pilcrow}

However, we would also want it to be the case that SERb1 does not
enforce this routing policy when the uplink from SERa to ISP-A has
failed. This could be accomplished by having SERa originate a
source-prefix-scoped route for (S=2001:db8:0:a000::/52,
D=2001:db8:0:1234::/64), and have SERb1 monitor the presence of that
route. If that route is not present (because SERa has stopped
originating it), then SERb1 will not enforce the routing policy, and it
will forward packets with S=2001:db8:0:b010::31 and
D=2001:db8:0:1234::101 out its uplink to
ISP-B.[¶](#section-6.2.3-3){.pilcrow}

We can also use this source-prefix-scoped route originated by SERa to
communicate the desired routing policy to SERb1. We can define an
EXCLUSIVE flag to be advertised together with the IGP route for
(S=2001:db8:0:a000::/52, D=2001:db8:0:1234::/64). This would allow SERa
to communicate to SERb that SERb should reject traffic for
D=2001:db8:0:1234::/64 and respond with an ICMPv6 Destination
Unreachable Code 5 message, as long as the route for
(S=2001:db8:0:a000::/52, D=2001:db8:0:1234::/64) is present. The
definition of an EXCLUSIVE flag for SADR advertisements in IGPs would
require future standardization work.[¶](#section-6.2.3-4){.pilcrow}

Finally, if we are willing to extend ICMPv6 to support this solution,
then we could create a mechanism for SERb1 to tell the host which source
address it should be using to successfully forward packets that meet the
policy. In its current form, when SERb1 sends an ICMPv6 Destination
Unreachable Code 5 message, it is basically saying, \"This source
address is wrong. Try another source address.\" In the absence of a
clear indication which address to try next, the host will iterate over
all addresses assigned to the interface (e.g., various privacy
addresses), which would lead to significant delays and degraded user
experience. It would be better if the ICMPv6 message could say, \"This
source address is wrong. Instead use a source address in
S=2001:db8:0:a000::/52\".[¶](#section-6.2.3-5){.pilcrow}

However, using ICMPv6 for signaling source address information back to
hosts introduces new challenges. Most routers currently have software or
hardware limits on generating ICMP messages. A site administrator
deploying a solution that relies on the SERs generating ICMP messages
could try to improve the performance of SERs for generating ICMP
messages. However, in a large network, it is still likely that ICMP
message generation limits will be reached. As a result, hosts would not
receive ICMPv6 back, which in turn leads to traffic blackholing and poor
user experience. To improve the scalability of ICMPv6-based signaling,
hosts [SHOULD]{.bcp14} cache the preferred source address (or prefix)
for the given destination (which in turn might cause issues in the case
of the corresponding ISP uplink failure - see [Section
6.3](#sec_one_uplink_failed){.xref}). In addition, the same source
prefix [SHOULD]{.bcp14} be used for other destinations in the same /64
as the original destination address. The source prefix to the
destination mapping [SHOULD]{.bcp14} have a specific lifetime.
Expiration of the lifetime [SHOULD]{.bcp14} trigger the source address
selection algorithm again.[¶](#section-6.2.3-6){.pilcrow}

Using ICMPv6 Destination Unreachable Messages with Code 5 to influence
source address selection introduces some security challenges, which are
discussed in [Section
10](#Security){.xref}.[¶](#section-6.2.3-7){.pilcrow}

As currently standardized in \[[RFC4443](#RFC4443){.xref}\], the ICMPv6
Destination Unreachable Message with Code 5 would allow for the
iterative approach to retransmitting packets using different source
addresses. As currently defined, the ICMPv6 message does not provide a
mechanism to communicate information about which source prefix should be
used for a retransmitted packet. The current document does not define
such a mechanism, but it might be a useful extension to define in a
different document. However, this approach has some security
implications, such as an ability for an attacker to send spoofed ICMPv6
messages to signal an invalid/unreachable source prefix, causing a
DoS-type attack.[¶](#section-6.2.3-8){.pilcrow}
:::
:::

::: {#sec_both_working_summary}
::: {#section-6.2.4 .section}
#### [6.2.4.](#section-6.2.4){.section-number .selfRef} [Summary of Methods for Controlling Default Source Address Selection to Implement Routing Policy](#name-summary-of-methods-for-cont){.section-name .selfRef} {#name-summary-of-methods-for-cont}

So to summarize this section, we have looked at three methods for
implementing a simple routing policy where all traffic for a given
destination on the Internet needs to use a particular ISP, even when the
uplinks to both ISPs are working.[¶](#section-6.2.4-1){.pilcrow}

The default source address selection policy cannot distinguish between
the source addresses needed to enforce this policy, so a non-default
policy table using associating source and destination prefixes using
label values would need to be installed on each host. A mechanism exists
for DHCPv6 to distribute a non-default policy table, but such solution
would heavily rely on DHCPv6 support by the host operating system.
Moreover, there is no mechanism to translate desired routing/traffic
engineering policies into policy tables on DHCPv6 servers. Therefore
using DHCPv6 for controlling the address selection policy table is not
recommended and [SHOULD NOT]{.bcp14} be
used.[¶](#section-6.2.4-2){.pilcrow}

At the same time, Router Advertisements provide a reliable mechanism to
influence the source address selection process via PIO, RIO, and default
router preferences. As all those options have been standardized by the
IETF and are supported by various operating systems, no changes are
required on hosts. First-hop routers in the enterprise network need to
be capable of sending different RAs for different SLAAC prefixes (either
based on scoped forwarding tables or based on preconfigured
policies).[¶](#section-6.2.4-3){.pilcrow}

SERs can enforce the routing policy by sending ICMPv6 Destination
Unreachable messages with Code 5 (Source address failed ingress/egress
policy) for traffic sent with the wrong source address. The policy
distribution could be automated by defining an EXCLUSIVE flag for the
source-prefix-scoped route, which could then be set on the SER that
originates the route. As ICMPv6 message generation can be rate limited
on routers, it [SHOULD NOT]{.bcp14} be used as the only mechanism to
influence source address selection on hosts. While hosts
[SHOULD]{.bcp14} select the correct source address for a given
destination, the network [SHOULD]{.bcp14} signal any source address
issues back to hosts using ICMPv6 error
messages.[¶](#section-6.2.4-4){.pilcrow}
:::
:::
:::
:::

::: {#sec_one_uplink_failed}
::: {#section-6.3 .section}
### [6.3.](#section-6.3){.section-number .selfRef} [Selecting Default Source Address When One Uplink Has Failed](#name-selecting-default-source-add){.section-name .selfRef} {#name-selecting-default-source-add}

Now we discuss whether DHCPv6, Neighbor Discovery Router Advertisements,
and ICMPv6 can help a host choose the right source address when an
uplink to one of the ISPs has failed. Again we look at the scenario in
[Figure 3](#fig_isp_service){.xref}. This time we look at traffic from
H31 destined for external host H501 at D=2001:db8:0:5678::501. We
initially assume that the uplink from SERa to ISP-A is working and that
the uplink from SERb1 to ISP-B is working.[¶](#section-6.3-1){.pilcrow}

We assume there is no particular routing policy desired, so H31 is free
to send packets with S=2001:db8:0:a010::31 or S=2001:db8:0:b010::31 and
have them delivered to H501. For this example, we assume that H31 has
chosen S=2001:db8:0:b010::31 so that the packets exit via SERb to ISP-B.
Now we see what happens when the link from SERb1 to ISP-B fails. How
should H31 learn that it needs to start sending packets to H501 with
S=2001:db8:0:a010::31 in order to start using the uplink to ISP-A? We
need to do this in a way that doesn\'t prevent H31 from still sending
packets with S=2001:db8:0:b010::31 in order to reach H61 at
D=2001:db8:0:6666::61.[¶](#section-6.3-2){.pilcrow}

::: {#sec_one_uplink_failed_dhcpv6}
::: {#section-6.3.1 .section}
#### [6.3.1.](#section-6.3.1){.section-number .selfRef} [Controlling Default Source Address Selection with DHCPv6](#name-controlling-default-source-ad){.section-name .selfRef} {#name-controlling-default-source-ad}

For this example, we assume that the site network in [Figure
3](#fig_isp_service){.xref} has a centralized DHCP server and that all
routers act as DHCP relay agents. We assume that both of the addresses
assigned to H31 were assigned via DHCP.[¶](#section-6.3.1-1){.pilcrow}

We could try to have the DHCP server monitor the state of the uplink
from SERb1 to ISP-B in some manner and then tell H31 that it can no
longer use S=2001:db8:0:b010::31 by setting its valid lifetime to zero.
The DHCP server could initiate this process by sending a Reconfigure
message to H31 as described in [Section
18.3](https://www.rfc-editor.org/rfc/rfc8415#section-18.3){.relref} of
\[[RFC8415](#RFC8415){.xref}\]. Or the DHCP server can assign addresses
with short lifetimes in order to force clients to renew them
often.[¶](#section-6.3.1-2){.pilcrow}

This approach would prevent H31 from using S=2001:db8:0:b010::31 to
reach a host on the Internet. However, it would also prevent H31 from
using S=2001:db8:0:b010::31 to reach H61 at D=2001:db8:0:6666::61, which
is not desirable.[¶](#section-6.3.1-3){.pilcrow}

Another potential approach is to have the DHCP server monitor the uplink
from SERb1 to ISP-B and control the choice of source address on H31 by
updating its address selection policy table via the mechanism in
\[[RFC7078](#RFC7078){.xref}\]. The DHCP server could initiate this
process by sending a Reconfigure message to H31. Note that
\[[RFC8415](#RFC8415){.xref}\] requires that Reconfigure messages use
DHCP authentication. DHCP authentication could be avoided by using short
address lifetimes to force clients to send Renew messages to the server
often. If the host does not obtain its IP addresses from the DHCP
server, then it would need to use the Information Refresh Time option
defined in
\[[RFC8415](#RFC8415){.xref}\].[¶](#section-6.3.1-4){.pilcrow}

If the following policy table can be installed on H31 after the failure
of the uplink from SERb1, then the desired routing behavior should be
achieved based on source and destination prefix being matched with label
values.[¶](#section-6.3.1-5){.pilcrow}

[]{#name-policy-table-needed-on-fail}

::: {#fig_policy_table_failed_uplink}
::: {#section-6.3.1-6.1 .artwork .art-text .alignLeft}
    Prefix                 Precedence       Label
    ::/0                   50               44
    2001:db8:0:a000::/52   50               44
    2001:db8:0:6666::/64   50               55
    2001:db8:0:b000::/52   50               55
:::

[Figure 10](#figure-10){.selfRef}: [Policy Table Needed on Failure of
Uplink from SERb1](#name-policy-table-needed-on-fail){.selfRef}
:::

The described solution has a number of significant drawbacks, some of
them already discussed in [Section
6.2.1](#sec_both_working_dhcpv6){.xref}.[¶](#section-6.3.1-7){.pilcrow}

-   [DHCPv6 support is not required for an IPv6 host, and there are
    operating systems that do not support DHCPv6. Besides that, it does
    not appear that \[[RFC7078](#RFC7078){.xref}\] has been widely
    implemented on host operating
    systems.[¶](#section-6.3.1-8.1){.pilcrow}]{#section-6.3.1-8.1}
-   [\[[RFC7078](#RFC7078){.xref}\] does not clearly specify this kind
    of a dynamic use case in which the address selection policy needs to
    be updated quickly in response to the failure of a link. In a large
    network, it would present scalability issues as many hosts need to
    be reconfigured in a very short period of
    time.[¶](#section-6.3.1-8.2){.pilcrow}]{#section-6.3.1-8.2}
-   [Updating DHCPv6 server configuration each time an ISP\'s uplink
    changes its state introduces some scalability issues, especially for
    mid/large distributed-scale enterprise networks. In addition to
    that, the policy table needs to be manually configured by
    administrators, which makes that solution prone to human
    error.[¶](#section-6.3.1-8.3){.pilcrow}]{#section-6.3.1-8.3}
-   [No mechanism exists for making DHCPv6 servers aware of network
    topology/routing changes in the network. In general, having DHCPv6
    servers monitor network-related events sounds like a bad idea as it
    requires completely new functionality beyond the scope of the DHCPv6
    role.[¶](#section-6.3.1-8.4){.pilcrow}]{#section-6.3.1-8.4}
:::
:::

::: {#sec_one_uplink_failed_ra}
::: {#section-6.3.2 .section}
#### [6.3.2.](#section-6.3.2){.section-number .selfRef} [Controlling Default Source Address Selection with Router Advertisements](#name-controlling-default-source-add){.section-name .selfRef} {#name-controlling-default-source-add}

The same mechanism as discussed in [Section
6.2.2](#sec_both_working_ra){.xref} can be used to control the source
address selection in the case of an uplink failure. If a particular
prefix should not be used as a source for any destination, then the
router needs to send an RA with the Preferred Lifetime field for that
prefix set to zero.[¶](#section-6.3.2-1){.pilcrow}

Let\'s consider a scenario in which all uplinks are operational, and H41
receives two different RAs from R3: one from LLA_A with a PIO for
2001:db8:0:a020::/64 and the default router preference set to 11 (low),
and another one from LLA_B with a PIO for 2001:db8:0:a020::/64, the
default router preference set to 01 (high), and a RIO for
2001:db8:0:6666::/64. As a result, H41 uses 2001:db8:0:b020::41 as a
source address for all Internet traffic, and those packets are sent by
SERs to ISP-B. If SERb1\'s uplink to ISP-B fails, the desired behavior
is that H41 stops using 2001:db8:0:b020::41 as a source address for all
destinations but H61. To achieve that, R3 should react to SERb1\'s
uplink failure (which could be detected as the disappearance of scoped
route (S=2001:db8:0:b000::/52, D=::/0)) by withdrawing itself as a
default router. R3 sends a new RA from LLA_B with the Router Lifetime
value set to zero (which means that it should not be used as the default
router). That RA still contains a PIO for 2001:db8:0:b020::/64 (for
SLAAC purposes) and a RIO for 2001:db8:0:6666::/64 so that H41 can reach
H61 using LLA_B as a next-hop and 2001:db8:0:b020::41 as a source
address. For all traffic following the default route, LLA_A will be used
as a next-hop and 2001:db8:0:a020::41 as a source
address.[¶](#section-6.3.2-2){.pilcrow}

If all of the uplinks to ISP-B have failed, source addresses from ISP-B
address space should not be used. In such a failure scenario, the
forwarding table scoped S=2001:db8:0:b000::/52 contains no entries,
indicating that R3 can instruct hosts to stop using source addresses
from 2001:db8:0:b000::/52 by sending RAs containing PIOs with Preferred
Lifetime values set to zero.[¶](#section-6.3.2-3){.pilcrow}
:::
:::

::: {#sec_one_uplink_failed_icmp}
::: {#section-6.3.3 .section}
#### [6.3.3.](#section-6.3.3){.section-number .selfRef} [Controlling Default Source Address Selection with ICMPv6](#name-controlling-default-source-addr){.section-name .selfRef} {#name-controlling-default-source-addr}

Now we look at how ICMPv6 messages can provide information back to H31.
We assume again that, at the time of the failure, H31 is sending packets
to H501 using (S=2001:db8:0:b010::31, D=2001:db8:0:5678::501). When the
uplink from SERb1 to ISP-B fails, SERb1 would stop originating its
source-prefix-scoped route for the default destination
(S=2001:db8:0:b000::/52, D=::/0) as well as its unscoped default
destination route. With these routes no longer in the IGP, traffic with
(S=2001:db8:0:b010::31, D=2001:db8:0:5678::501) would end up at SERa
based on the unscoped default destination route being originated by
SERa. Since that traffic has the wrong source address to be forwarded to
ISP-A, SERa would drop it and send a Destination Unreachable message
with Code 5 (Source address failed ingress/egress policy) back to H31.
H31 would then know to use another source address for that destination
and would try with (S=2001:db8:0:a010::31, D=2001:db8:0:5678::501). This
would be forwarded to SERa based on the source-prefix-scoped default
destination route still being originated by SERa, and SERa would forward
it to ISP-A. As discussed above, if we are willing to extend ICMPv6,
SERa can even tell H31 what source address it should use to reach that
destination. The expected host behavior has been discussed in [Section
6.2.3](#sec_both_working_icmpv6){.xref}. Using ICMPv6 would have the
same scalability/rate limiting issues that are discussed in [Section
6.2.3](#sec_both_working_icmpv6){.xref}. An ISP-B uplink failure
immediately makes source addresses from 2001:db8:0:b000::/52 unsuitable
for external communication and might trigger a large number of ICMPv6
packets being sent to hosts in that
subnet.[¶](#section-6.3.3-1){.pilcrow}
:::
:::

::: {#sec_uplink_failed_summary}
::: {#section-6.3.4 .section}
#### [6.3.4.](#section-6.3.4){.section-number .selfRef} [Summary of Methods for Controlling Default Source Address Selection on the Failure of an Uplink](#name-summary-of-methods-for-contr){.section-name .selfRef} {#name-summary-of-methods-for-contr}

It appears that DHCPv6 is not particularly well suited to quickly
changing the source address used by a host when an uplink fails, which
eliminates DHCPv6 from the list of potential solutions. On the other
hand, Router Advertisements provide a reliable mechanism to dynamically
provide hosts with a list of valid prefixes to use as source addresses
as well as to prevent the use of particular prefixes. While no
additional new features are required to be implemented on hosts, routers
need to be able to send RAs based on the state of scoped forwarding
table entries and to react to network topology changes by sending RAs
with particular parameters set.[¶](#section-6.3.4-1){.pilcrow}

It seems that the use of ICMPv6 Destination Unreachable messages
generated by the SER (or any SADR-capable) routers, together with the
use of RAs to signal source address selection errors back to hosts, has
the potential to provide a support mechanism. However, scalability
issues may arise in large networks when topology suddenly changes.
Therefore, it is highly desirable that hosts are able to select the
correct source address in the case of uplink failure, with ICMPv6 being
an additional mechanism to signal unexpected failures back to
hosts.[¶](#section-6.3.4-2){.pilcrow}

The current behaviors of different host operating systems upon receipt
of an ICMPv6 Destination Unreachable message with Code 5 (Source address
failed ingress/egress policy) is not clear to the authors. Information
from implementers, users, and testing would be quite helpful in
evaluating this approach.[¶](#section-6.3.4-3){.pilcrow}
:::
:::
:::
:::

::: {#sec_uplink_recover}
::: {#section-6.4 .section}
### [6.4.](#section-6.4){.section-number .selfRef} [Selecting Default Source Address upon Failed Uplink Recovery](#name-selecting-default-source-addr){.section-name .selfRef} {#name-selecting-default-source-addr}

The next logical step is to look at the scenario when a failed uplink on
SERb1 to ISP-B comes back up, so the hosts can start using source
addresses belonging to 2001:db8:0:b000::/52
again.[¶](#section-6.4-1){.pilcrow}

::: {#sec_uplink_recover_dhcpv6}
::: {#section-6.4.1 .section}
#### [6.4.1.](#section-6.4.1){.section-number .selfRef} [Controlling Default Source Address Selection with DHCPv6](#name-controlling-default-source-addre){.section-name .selfRef} {#name-controlling-default-source-addre}

The mechanism to use DHCPv6 to instruct the hosts (H31 in our example)
to start using prefixes from ISP-B space (e.g., S=2001:db8:0:b010::31
for H31) to reach hosts on the Internet is quite similar to one
discussed in [Section 6.3.1](#sec_one_uplink_failed_dhcpv6){.xref} and
shares the same drawbacks.[¶](#section-6.4.1-1){.pilcrow}
:::
:::

::: {#sec_uplink_recover_ra}
::: {#section-6.4.2 .section}
#### [6.4.2.](#section-6.4.2){.section-number .selfRef} [Controlling Default Source Address Selection with Router Advertisements](#name-controlling-default-source-addres){.section-name .selfRef} {#name-controlling-default-source-addres}

Let\'s look at the scenario discussed in [Section
6.3.2](#sec_one_uplink_failed_ra){.xref}. If the uplink(s) failure
caused the complete withdrawal of prefixes from the 2001:db8:0:b000::/52
address space by setting the Preferred Lifetime value to zero, then the
recovery of the link should just trigger the sending of a new RA with a
non-zero Preferred Lifetime. In another scenario discussed in [Section
6.3.2](#sec_one_uplink_failed_ra){.xref}, the failure of the SERb1
uplink to ISP-B leads to the disappearance of the
(S=2001:db8:0:b000::/52, D=::/0) entry from the forwarding table scoped
to S=2001:db8:0:b000::/52 and, in turn, causes R3 to send RAs with the
Router Lifetime set to zero from LLA_B. The recovery of the SERb1 uplink
to ISP-B leads to the reappearance of the scoped forwarding entry
(S=2001:db8:0:b000::/52, D=::/0). That reappearance acts as a signal for
R3 to advertise itself as a default router for ISP-B address space
domain (to send RAs from LLA_B with non-zero Router
Lifetime).[¶](#section-6.4.2-1){.pilcrow}
:::
:::

::: {#sec_uplink_recover_icmp}
::: {#section-6.4.3 .section}
#### [6.4.3.](#section-6.4.3){.section-number .selfRef} [Controlling Default Source Address Selection with ICMP](#name-controlling-default-source-address){.section-name .selfRef} {#name-controlling-default-source-address}

It looks like ICMPv6 provides a rather limited functionality to signal
back to hosts that particular source addresses have become valid again.
Unless the changes in the uplink specify a particular (S,D) pair, hosts
can keep using the same source address even after an ISP uplink has come
back up. For example, after the uplink from SERb1 to ISP-B had failed,
H31 received ICMPv6 Code 5 message (as described in [Section
6.3.3](#sec_one_uplink_failed_icmp){.xref}) and allegedly started using
(S=2001:db8:0:a010::31, D=2001:db8:0:5678::501) to reach H501. Now when
the SERb1 uplink comes back up, the packets with that (S,D) pair are
still routed to SERa1 and sent to the Internet. Therefore, H31 is not
informed that it should stop using 2001:db8:0:a010::31 and start using
2001:db8:0:b010::31 again. Unless SERa has a policy configured to drop
packets (S=2001:db8:0:a010::31, D=2001:db8:0:5678::501) and send ICMPv6
back if the SERb1 uplink to ISP-B is up, H31 will be unaware of the
network topology change and keep using S=2001:db8:0:a010::31 for
Internet destinations, including H51.[¶](#section-6.4.3-1){.pilcrow}

One of the possible options may be using a scoped route with an
EXCLUSIVE flag as described in [Section
6.2.3](#sec_both_working_icmpv6){.xref}. SERa1 uplink recovery would
cause the (S=2001:db8:0:a000::/52, D=2001:db8:0:1234::/64) route to
reappear in the routing table. In the absence of that, route packets to
H101 are sent to ISP-B (as ISP-A uplink was down) with source addresses
from 2001:db8:0:b000::/52. When the route reappears, SERb1 rejects those
packets and sends ICMPv6 back as discussed in [Section
6.2.3](#sec_both_working_icmpv6){.xref}. Practically, it might lead to
scalability issues, which have been already discussed in
[6.2.3](#sec_both_working_icmpv6){.xref} and
[6.4.3](#sec_uplink_recover_icmp){.xref}.[¶](#section-6.4.3-2){.pilcrow}
:::
:::

::: {#sec_uplink_recover_summary}
::: {#section-6.4.4 .section}
#### [6.4.4.](#section-6.4.4){.section-number .selfRef} [Summary of Methods for Controlling Default Source Address Selection upon Failed Uplink Recovery](#name-summary-of-methods-for-contro){.section-name .selfRef} {#name-summary-of-methods-for-contro}

Once again, DHCPv6 does not look like a reasonable choice to manipulate
the source address selection process on a host in the case of network
topology changes. Using Router Advertisement provides the flexible
mechanism to dynamically react to network topology changes (if routers
are able to use routing changes as a trigger for sending out RAs with
specific parameters). ICMPv6 could be considered as a supporting
mechanism to signal incorrect source address back to hosts, but it
should not be considered as the only mechanism to control the address
selection in multihomed environments.[¶](#section-6.4.4-1){.pilcrow}
:::
:::
:::
:::

::: {#sec_all_uplinks_failed}
::: {#section-6.5 .section}
### [6.5.](#section-6.5){.section-number .selfRef} [Selecting Default Source Address When All Uplinks Have Failed](#name-selecting-default-source-addre){.section-name .selfRef} {#name-selecting-default-source-addre}

One particular tricky case is a scenario when all uplinks have failed.
In that case, there is no valid source address to be used for any
external destinations when it might be desirable to have intra-site
connectivity.[¶](#section-6.5-1){.pilcrow}

::: {#sec_all_uplinks_failed_dhcpv6}
::: {#section-6.5.1 .section}
#### [6.5.1.](#section-6.5.1){.section-number .selfRef} [Controlling Default Source Address Selection with DHCPv6](#name-controlling-default-source-address-){.section-name .selfRef} {#name-controlling-default-source-address-}

From the DHCPv6 perspective, uplinks failure should be treated as two
independent failures and processed as described in [Section
6.3.1](#sec_one_uplink_failed_dhcpv6){.xref}. At this stage, it is quite
obvious that it would result in a quite complicated policy table that
would need to be explicitly configured by administrators and therefore
seems to be impractical.[¶](#section-6.5.1-1){.pilcrow}
:::
:::

::: {#sec_all_uplinks_failed_ra}
::: {#section-6.5.2 .section}
#### [6.5.2.](#section-6.5.2){.section-number .selfRef} [Controlling Default Source Address Selection with Router Advertisements](#name-controlling-default-source-address--2){.section-name .selfRef} {#name-controlling-default-source-address--2}

As discussed in [Section 6.3.2](#sec_one_uplink_failed_ra){.xref}, an
uplink failure causes the scoped default entry to disappear from the
scoped forwarding table and triggers RAs with zero Router Lifetimes.
Complete disappearance of all scoped entries for a given source prefix
would cause the prefix to be withdrawn from hosts by setting the
Preferred Lifetime value to zero in the PIO. If all uplinks (SERa, SERb1
and SERb2) fail, hosts either lose their default routers and/or have no
global IPv6 addresses to use as a source. (Note that \'uplink failure\'
might mean \'IPv6 connectivity failure with IPv4 still being
reachable\', in which case, hosts might fall back to IPv4 if there is
IPv4 connectivity to destinations). As a result, intra-site connectivity
is broken. One of the possible ways to solve it is to use
ULAs.[¶](#section-6.5.2-1){.pilcrow}

In addition to GUAs, all hosts have ULA addresses assigned, and these
addresses are used for intra-site communication even if there is no GUA
assigned to a host. To avoid accidental leaking of packets with ULA
sources, SADR-capable routers [SHOULD]{.bcp14} have a scoped forwarding
table for ULA source for internal routes but [MUST NOT]{.bcp14} have an
entry for D=::/0 in that table. In the absence of (S=ULA_Prefix;
D=::/0), first-hop routers will send dedicated RAs from a unique
link-local source LLA_ULA with a PIO from ULA address space, a RIO for
the ULA prefix, and Router Lifetime set to zero. The behavior is
consistent with the situation when SERb1 lost the uplink to ISP-B (so
there is no Internet connectivity from 2001:db8:0:b000::/52 sources),
but those sources can be used to reach some specific destinations. In
the case of ULA, there is no Internet connectivity from ULA sources, but
they can be used to reach other ULA destinations. Note that ULA usage
could be particularly useful if all ISPs assign prefixes via DHCP prefix
delegation. In the absence of ULAs, upon the failure of all uplinks,
hosts would lose all their GUAs upon prefix-lifetime expiration, which
again makes intra-site communication
impossible.[¶](#section-6.5.2-2){.pilcrow}

It should be noted that Rule 5.5 (prefer a prefix advertised by the
selected next-hop) takes precedence over the Rule 6 (prefer matching
label, which ensures that GUA source addresses are preferred over ULAs
for GUA destinations). Therefore if ULAs are used, the network
administrator needs to ensure that, while the site has Internet
connectivity, hosts do not select a router that advertises ULA prefixes
as their default router.[¶](#section-6.5.2-3){.pilcrow}
:::
:::

::: {#sec_all_uplinks_failed_icmp}
::: {#section-6.5.3 .section}
#### [6.5.3.](#section-6.5.3){.section-number .selfRef} [Controlling Default Source Address Selection with ICMPv6](#name-controlling-default-source-address--3){.section-name .selfRef} {#name-controlling-default-source-address--3}

In the case of the failure of all uplinks, all SERs will drop outgoing
IPv6 traffic and respond with ICMPv6 error messages. In a large network
in which many hosts attempt to reach Internet destinations, the SERs
need to generate an ICMPv6 error for every packet they receive from
hosts, which presents the same scalability issues discussed in [Section
6.3.3](#sec_one_uplink_failed_icmp){.xref}.[¶](#section-6.5.3-1){.pilcrow}
:::
:::

::: {#sec_all_uplinks_failed_summary}
::: {#section-6.5.4 .section}
#### [6.5.4.](#section-6.5.4){.section-number .selfRef} [Summary of Methods for Controlling Default Source Address Selection When All Uplinks Failed](#name-summary-of-methods-for-control){.section-name .selfRef} {#name-summary-of-methods-for-control}

Again, combining SADR with Router Advertisements seems to be the most
flexible and scalable way to control the source address selection on
hosts.[¶](#section-6.5.4-1){.pilcrow}
:::
:::
:::
:::

::: {#sec_sas_summary}
::: {#section-6.6 .section}
### [6.6.](#section-6.6){.section-number .selfRef} [Summary of Methods for Controlling Default Source Address Selection](#name-summary-of-methods-for-controll){.section-name .selfRef} {#name-summary-of-methods-for-controll}

This section summarizes the scenarios and options discussed
above.[¶](#section-6.6-1){.pilcrow}

While DHCPv6 allows administrators to manipulate source address
selection policy tables, this method has a number of significant
disadvantages that eliminate DHCPv6 from a list of potential
solutions:[¶](#section-6.6-2){.pilcrow}

1.  [It requires hosts to support DHCPv6 and its extension
    \[[RFC7078](#RFC7078){.xref}\].[¶](#section-6.6-3.1){.pilcrow}]{#section-6.6-3.1}
2.  [A DHCPv6 server needs to monitor network state and detect routing
    changes.[¶](#section-6.6-3.2){.pilcrow}]{#section-6.6-3.2}
3.  [The use of policy tables requires manual configuration and might be
    extremely complicated, especially in the case of a distributed
    network in which a large number of remote sites are being served by
    centralized DHCPv6
    servers.[¶](#section-6.6-3.3){.pilcrow}]{#section-6.6-3.3}
4.  [Network topology/routing policy changes could trigger simultaneous
    reconfiguration of large number of hosts, which presents serious
    scalability
    issues.[¶](#section-6.6-3.4){.pilcrow}]{#section-6.6-3.4}

The use of Router Advertisements to influence the source address
selection on hosts seem to be the most reliable, flexible, and scalable
solution. It has the following benefits:[¶](#section-6.6-4){.pilcrow}

1.  [No new (non-standard) functionality needs to be implemented on
    hosts (except for RIO support \[[RFC4191](#RFC4191){.xref}\], which
    is not widely implemented at the time of this
    writing).[¶](#section-6.6-5.1){.pilcrow}]{#section-6.6-5.1}
2.  [No changes in RA
    format.[¶](#section-6.6-5.2){.pilcrow}]{#section-6.6-5.2}
3.  [Routers can react to routing table changes by sending RAs, which
    would minimize the failover time in the case of network topology
    changes.[¶](#section-6.6-5.3){.pilcrow}]{#section-6.6-5.3}
4.  [Information required for source address selection is broadcast to
    all affected hosts in the case of a topology change event, which
    improves the scalability of the solution (compared to DHCPv6
    reconfiguration or ICMPv6 error
    messages).[¶](#section-6.6-5.4){.pilcrow}]{#section-6.6-5.4}

To fully benefit from the RA-based solution, first-hop routers need to
implement SADR, belong to the SADR domain, and be able to send dedicated
RAs per scoped forwarding table as discussed above, reacting to network
changes by sending new RAs. It should be noted that the proposed
solution would work even if first-hop routers are not SADR-capable but
still able to send individual RAs for each ISP prefix and react to
topology changes as discussed above (e.g., via configuration
knobs).[¶](#section-6.6-6){.pilcrow}

The RA-based solution relies heavily on hosts correctly implementing the
default address selection algorithm as defined in
\[[RFC6724](#RFC6724){.xref}\]. While the basic, and the most common,
multihoming scenario (two or more Internet uplinks, no \'walled
gardens\') would work for any host supporting the minimal implementation
of \[[RFC6724](#RFC6724){.xref}\], more complex use cases (such as
\'walled garden\' and other scenarios when some ISP resources can only
be reached from that ISP address space) require that hosts support Rule
5.5 of the default address selection algorithm. There is some evidence
that not all host OSes have that rule implemented currently. However, it
should be noted that \[[RFC8028](#RFC8028){.xref}\] states that Rule 5.5
should be implemented.[¶](#section-6.6-7){.pilcrow}

The ICMPv6 Code 5 error message [SHOULD]{.bcp14} be used to complement
an RA-based solution to signal incorrect source address selection back
to hosts, but it [SHOULD NOT]{.bcp14} be considered as the standalone
solution. To prevent scenarios when hosts in multihomed environments
incorrectly identify on-link/off-link destinations, hosts
[SHOULD]{.bcp14} treat ICMPv6 Redirects as discussed in
\[[RFC8028](#RFC8028){.xref}\].[¶](#section-6.6-8){.pilcrow}
:::
:::

::: {#sec_conn_pre}
::: {#section-6.7 .section}
### [6.7.](#section-6.7){.section-number .selfRef} [Solution Limitations](#name-solution-limitations){.section-name .selfRef} {#name-solution-limitations}

::: {#sec_conn_pre_1}
::: {#section-6.7.1 .section}
#### [6.7.1.](#section-6.7.1){.section-number .selfRef} [Connections Preservation](#name-connections-preservation){.section-name .selfRef} {#name-connections-preservation}

The proposed solution is not designed to preserve connection state in
the case of an uplink failure. When all uplinks to an ISP go down, all
transport connections established to/from that ISP address space will be
interrupted (unless the transport protocol has specific multihoming
support). That behavior is similar to the scenario of IPv4 multihoming
with NAT when an uplink failure causes all connections to be NATed to
completely different public IPv4 addresses. While it does sound
suboptimal, it is determined by the nature of PA address space: if all
uplinks to the particular ISP have failed, there is no path for the
ingress traffic to reach the site, and the egress traffic is supposed to
be dropped by the ingress filters \[[BCP38](#RFC2827){.xref}\]. The only
potential way to overcome this limitation would be to run BGP with all
ISPs and to advertise all site prefixes to all uplinks - a solution that
shares all the drawbacks of using the PI address space without sharing
its benefits. Networks willing and capable of running BGP and using PI
are out of scope of this document.[¶](#section-6.7.1-1){.pilcrow}

It should be noted that in the case of IPv4 NAT-based multihoming,
uplink recovery could cause connection interruptions as well (unless
packet forwarding is integrated with the tracking of existing NAT
sessions so that the egress interface for the existing sessions is not
changed). However, the proposed solution has the benefit of preserving
the existing sessions during and after the restoration of the failed
uplink. Unlike the uplink failure event, which causes all addresses from
the affected prefix to be deprecated, the recovery would just add new,
preferred addresses to a host without making any addresses unavailable.
Therefore, connections established to and from those addresses do not
have to be interrupted.[¶](#section-6.7.1-2){.pilcrow}

While it\'s desirable for active connections to survive ISP failover
events, such events affect the reachability of IP addresses assigned to
hosts in sites using PA address space. Unless the transport (or
higher-level protocols) is capable of surviving the host renumbering,
the active connections will be broken. The proposed solution focuses on
minimizing the impact of failover on new connections and on
multipath-aware protocols.[¶](#section-6.7.1-3){.pilcrow}

Another way to preserve connection state is to use multipath transport
as discussed in [Section
8.3](#sec_mpath){.xref}.[¶](#section-6.7.1-4){.pilcrow}
:::
:::
:::
:::

::: {#sec_other_params}
::: {#section-6.8 .section}
### [6.8.](#section-6.8){.section-number .selfRef} [Other Configuration Parameters](#name-other-configuration-paramet){.section-name .selfRef} {#name-other-configuration-paramet}

::: {#sec_dns}
::: {#section-6.8.1 .section}
#### [6.8.1.](#section-6.8.1){.section-number .selfRef} [DNS Configuration](#name-dns-configuration){.section-name .selfRef} {#name-dns-configuration}

In a multihomed environment, each ISP might provide their own list of
DNS servers. For example, in the topology shown in [Figure
3](#fig_isp_service){.xref}, ISP-A might provide H51 2001:db8:0:5555::51
as a recursive DNS server, while ISP-B might provide H61
2001:db8:0:6666::61 as a recursive DNS server (RDNSS).
\[[RFC8106](#RFC8106){.xref}\] defines IPv6 Router Advertisement options
to allow IPv6 routers to advertise a list of RDNSS addresses and a DNS
Search List (DNSSL) to IPv6 hosts. Using RDNSS together with \'scoped\'
RAs as described above would allow a first-hop router (R3 in [Figure
3](#fig_isp_service){.xref}) to send DNS server addresses and search
lists provided by each ISP (or the corporate DNS server addresses if the
enterprise is running its own DNS servers. As discussed below, the DNS
split-horizon problem is too hard to solve without running a local DNS
server).[¶](#section-6.8.1-1){.pilcrow}

As discussed in [Section 6.5.2](#sec_all_uplinks_failed_ra){.xref},
failure of all ISP uplinks would cause deprecation of all addresses
assigned to a host from the address space of all ISPs. If any intra-site
IPv6 connectivity is still desirable (most likely to be the case for any
mid/large-scale network), then ULAs should be used as discussed in
[Section 6.5.2](#sec_all_uplinks_failed_ra){.xref}. In such a scenario,
the enterprise network should run its own recursive DNS server(s) and
provide its ULA addresses to hosts via RDNSS in RAs sent for ULA-scoped
forwarding table as described in [Section
6.5.2](#sec_all_uplinks_failed_ra){.xref}.[¶](#section-6.8.1-2){.pilcrow}

There are some scenarios in which the final outcome of the name
resolution might be different depending
on:[¶](#section-6.8.1-3){.pilcrow}

-   [which DNS server is
    used;[¶](#section-6.8.1-4.1){.pilcrow}]{#section-6.8.1-4.1}
-   [which source address the client uses to send a DNS query to the
    server (DNS split
    horizon).[¶](#section-6.8.1-4.2){.pilcrow}]{#section-6.8.1-4.2}

There is no way currently to instruct a host to use a particular DNS
server from the configured servers list for resolving a particular name.
Therefore, it does not seem feasible to solve the problem of DNS server
selection on the host (it should be noted that this particular issue is
protocol-agnostic and happens for IPv4 as well). In such a scenario, it
is recommended that the enterprise run its own local recursive DNS
server.[¶](#section-6.8.1-5){.pilcrow}

To influence host source address selection for packets sent to a
particular DNS server, the following requirements must be
met:[¶](#section-6.8.1-6){.pilcrow}

-   [The host supports RIO as defined in
    \[[RFC4191](#RFC4191){.xref}\].[¶](#section-6.8.1-7.1){.pilcrow}]{#section-6.8.1-7.1}
-   [The routers send RIOs for routes to DNS server
    addresses.[¶](#section-6.8.1-7.2){.pilcrow}]{#section-6.8.1-7.2}

For example, if it is desirable that host H31 reaches the ISP-A DNS
server H51 2001:db8:0:5555::51 using its source address
2001:db8:0:a010::31, then both R1 and R2 should send RIOs containing the
route to 2001:db8:0:5555::51 (or covering route) in their \'scoped\'
RAs, containing LLA_A as the default router address and the PIO for
SLAAC prefix 2001:db8:0:a010::/64. In that case, host H31 (if it
supports Rule 5.5) would select LLA_A as a next-hop and then choose
2001:db8:0:a010::31 as the source address for packets to the DNS
server.[¶](#section-6.8.1-8){.pilcrow}

It should be noted that \[[RFC6106](#RFC6106){.xref}\] explicitly
prohibits using DNS information if the RA Router Lifetime has
expired:[¶](#section-6.8.1-9){.pilcrow}

> An RDNSS address or a DNSSL domain name [MUST]{.bcp14} be used only as
> long as both the RA router Lifetime (advertised by a Router
> Advertisement message) and the corresponding option Lifetime have not
> expired.[¶](#section-6.8.1-10){.pilcrow}

Therefore, hosts might ignore RDNSS information provided in ULA-scoped
RAs, as those RAs would have Router Lifetime values set to zero.
However, \[[RFC8106](#RFC8106){.xref}\], which obsoletes RFC 6106, has
removed that requirement.[¶](#section-6.8.1-11){.pilcrow}

As discussed above, the DNS split-horizon problem and the selection of
the correct DNS server in a multihomed environment are not easy problems
to solve. The proper solution would require hosts to support the concept
of multiple provisioning domains (PvD, a set of configuration
information associated with a network,
\[[RFC7556](#RFC7556){.xref}\]).[¶](#section-6.8.1-12){.pilcrow}
:::
:::
:::
:::
:::
:::

::: {#sec_deployment}
::: {#section-7 .section}
## [7.](#section-7){.section-number .selfRef} [Deployment Considerations](#name-deployment-considerations){.section-name .selfRef} {#name-deployment-considerations}

The solution described in this document requires certain mechanisms to
be supported by the network infrastructure and hosts. It requires some
routers in the enterprise site to support some form of SADR. It also
requires hosts to be able to learn when the uplink to an ISP changes its
state so that the hosts can use appropriate source addresses. Ongoing
work to create mechanisms to accomplish this are discussed in this
document, but they are still works in
progress.[¶](#section-7-1){.pilcrow}

::: {#sec_sadr_depl}
::: {#section-7.1 .section}
### [7.1.](#section-7.1){.section-number .selfRef} [Deploying SADR Domain](#name-deploying-sadr-domain){.section-name .selfRef} {#name-deploying-sadr-domain}

The proposed solution does not prescribe particular details regarding
deploying an SADR domain within a multihomed enterprise network. However
the following guidelines could be applied:[¶](#section-7.1-1){.pilcrow}

-   [The SADR domain is usually limited by the multihomed site
    border.[¶](#section-7.1-2.1){.pilcrow}]{#section-7.1-2.1}
-   [The minimal deployable scenario requires enabling SADR on all SERs
    and including them into a single SADR
    domain.[¶](#section-7.1-2.2){.pilcrow}]{#section-7.1-2.2}
-   [As discussed in [Section 4.2](#sec_simple_not_dir_conn){.xref},
    extending the connected SADR domain beyond the SERs to the first-hop
    routers can produce more efficient forwarding paths and allow the
    network to fully benefit from SADR. It would also simplify the
    operation of the SADR
    domain.[¶](#section-7.1-2.3){.pilcrow}]{#section-7.1-2.3}
-   [During the incremental SADR domain expansion from the SERs down
    towards first-hop routers, it\'s important to ensure that, at any
    given moment, all SADR-capable routers within the domain are
    logically connected (see [Section
    5](#sec_method){.xref}).[¶](#section-7.1-2.4){.pilcrow}]{#section-7.1-2.4}
:::
:::

::: {#sec_host}
::: {#section-7.2 .section}
### [7.2.](#section-7.2){.section-number .selfRef} [Hosts-Related Considerations](#name-hosts-related-consideration){.section-name .selfRef} {#name-hosts-related-consideration}

The solution discussed in this document relies on the default address
selection algorithm, Rule 5.5 \[[RFC6724](#RFC6724){.xref}\]. While
\[[RFC6724](#RFC6724){.xref}\] considers this rule as optional, the more
recent \[[RFC8028](#RFC8028){.xref}\] states that \"A host
[SHOULD]{.bcp14} select default routers for each prefix it is assigned
an address in.\" It also recommends that hosts should implement Rule
5.5. of \[[RFC6724](#RFC6724){.xref}\]. Therefore, while hosts compliant
with RFC 8028 already have a mechanism to learn about state changes to
ISP uplinks and to select the source addresses accordingly, many hosts
do not support such a mechanism yet.[¶](#section-7.2-1){.pilcrow}

It should be noted that a multihomed enterprise network utilizing
multiple ISP prefixes can be considered as a typical multiple
provisioning domain (mPvD) scenario, as described in
\[[RFC7556](#RFC7556){.xref}\]. This document defines a way for the
network to provide the PvD information to hosts indirectly, using the
existing mechanisms. At the same time,
\[[PROV-DOMAINS](#I-D.ietf-intarea-provisioning-domains){.xref}\] takes
one step further and describes a comprehensive mechanism for hosts to
discover the whole set of configuration information associated with
different PvDs/ISPs.
\[[PROV-DOMAINS](#I-D.ietf-intarea-provisioning-domains){.xref}\]
complements this document in terms of enabling hosts to learn about ISP
uplink states and to select the corresponding source
addresses.[¶](#section-7.2-2){.pilcrow}
:::
:::
:::
:::

::: {#sec_other_solutions}
::: {#section-8 .section}
## [8.](#section-8){.section-number .selfRef} [Other Solutions](#name-other-solutions){.section-name .selfRef} {#name-other-solutions}

::: {#sec_shim6}
::: {#section-8.1 .section}
### [8.1.](#section-8.1){.section-number .selfRef} [Shim6](#name-shim6){.section-name .selfRef} {#name-shim6}

The Shim6 protocol \[[RFC5533](#RFC5533){.xref}\], specified by the
Shim6 working group, allows a host at a multihomed site to communicate
with an external host and to exchange information about possible source
and destination address pairs that they can use to communicate. The
Shim6 working group also specified the REAchability Protocol (REAP)
\[[RFC5534](#RFC5534){.xref}\] to detect failures in the path between
working address pairs and to find new working address pairs. A
fundamental requirement for Shim6 is that both internal and external
hosts need to support Shim6. That is, both the host internal to the
multihomed site and the host external to the multihomed site need to
support Shim6 in order for there to be any benefit for the internal host
to run Shim6. The Shim6 protocol specification was published in 2009,
but it has not been widely implemented. Therefore Shim6 is not
considered as a viable solution for enterprise
multihoming.[¶](#section-8.1-1){.pilcrow}
:::
:::

::: {#sec_nptv6}
::: {#section-8.2 .section}
### [8.2.](#section-8.2){.section-number .selfRef} [IPv6-to-IPv6 Network Prefix Translation](#name-ipv6-to-ipv6-network-prefix){.section-name .selfRef} {#name-ipv6-to-ipv6-network-prefix}

IPv6-to-IPv6 Network Prefix Translation (NPTv6)
\[[RFC6296](#RFC6296){.xref}\] is not the focus of this document. NPTv6
suffers from the same fundamental issue as any other approaches to
address translation: it breaks end-to-end connectivity. Therefore NPTv6
is not considered as a desirable solution, and this document
intentionally focuses on solving the enterprise multihoming problem
without any form of address translation.[¶](#section-8.2-1){.pilcrow}

With increasing interest and ongoing work in bringing path awareness to
transport- and application-layer protocols, hosts might be able to
determine the properties of the various network paths and choose among
the paths that are available to them. As selecting the correct source
address is one of the possible mechanisms that path-aware hosts may
utilize, address translation negatively affects hosts\' path-awareness,
which makes NTPv6 an even more undesirable
solution.[¶](#section-8.2-2){.pilcrow}
:::
:::

::: {#sec_mpath}
::: {#section-8.3 .section}
### [8.3.](#section-8.3){.section-number .selfRef} [Multipath Transport](#name-multipath-transport){.section-name .selfRef} {#name-multipath-transport}

Using multipath transport (such as Multipath TCP (MPTCP)
\[[RFC6824](#RFC6824){.xref}\] or multipath capabilities in QUIC) might
solve the problems discussed in [Section 6](#sec_host_mechanisms){.xref}
since a multipath transport would allow hosts to use multiple source
addresses for a single connection and to switch between those source
addresses when a particular address becomes unavailable or a new address
is assigned to the host interface. Therefore, if all hosts in the
enterprise network use only multipath transport for all connections, the
signaling solution described in [Section 6](#sec_host_mechanisms){.xref}
might not be needed (it should be noted that Source Address Dependent
Routing would still be required to deliver packets to the correct
uplinks). At the time this document was written, multipath transport
alone could not be considered a solution for the problem of selecting
the source address in a multihomed environment. There are a significant
number of hosts that do not use multipath transport currently, and it
seems unlikely that the situation will change in the foreseeable future
(even if new releases of operating systems support multipath protocols,
there will be a long tail of legacy hosts). The solution for enterprise
multihoming needs to work for the least common denominator: hosts
without multipath transport support. In addition, not all protocols are
using multipath transport. While multipath transport would complement
the solution described in [Section 6](#sec_host_mechanisms){.xref}, it
could not be considered as a sole solution to the problem of source
address selection in multihomed
environments.[¶](#section-8.3-1){.pilcrow}

On the other hand, PA-based multihoming could provide additional
benefits to multipath protocols, should those protocols be deployed in
the network. Multipath protocols could leverage source address selection
to achieve maximum path diversity (and potentially improved
performance).[¶](#section-8.3-2){.pilcrow}

Therefore, the deployment of multipath protocols should not be
considered as an alternative to the approach proposed in this document.
Instead, both solutions complement each other, so deploying multipath
protocols in a PA-based multihomed network proves mutually
beneficial.[¶](#section-8.3-3){.pilcrow}
:::
:::
:::
:::

::: {#IANA}
::: {#section-9 .section}
## [9.](#section-9){.section-number .selfRef} [IANA Considerations](#name-iana-considerations){.section-name .selfRef} {#name-iana-considerations}

This document has no IANA actions.[¶](#section-9-1){.pilcrow}
:::
:::

::: {#Security}
::: {#section-10 .section}
## [10.](#section-10){.section-number .selfRef} [Security Considerations](#name-security-considerations){.section-name .selfRef} {#name-security-considerations}

[Section 6.2.3](#sec_both_working_icmpv6){.xref} discusses a mechanism
for controlling source address selection on hosts using ICMPv6 messages.
Using ICMPv6 to influence source address selection allows an attacker to
exhaust the list of candidate source addresses on the host by sending
spoofed ICMPv6 Code 5 for all prefixes known on the network (therefore
preventing a victim from establishing communication with the destination
host). Another possible attack vector is using ICMPv6 Destination
Unreachable Messages with Code 5 to steer the egress traffic towards the
particular ISP, so the attacker can benefit from their ability doing
traffic sniffing/interception in that ISP
network.[¶](#section-10-1){.pilcrow}

To prevent those attacks, hosts [SHOULD]{.bcp14} verify that the
original packet header included in the ICMPv6 error message was actually
sent by the host (to ensure that the ICMPv6 message was triggered by a
packet sent by the host).[¶](#section-10-2){.pilcrow}

As ICMPv6 Destination Unreachable Messages with Code 5 could be
originated by any SADR-capable router within the domain (or even come
from the Internet), the Generalized TTL Security Mechanism (GTSM)
\[[RFC5082](#RFC5082){.xref}\] cannot be applied. Filtering such ICMPv6
messages at the site border cannot be recommended as it would break the
legitimate end-to-end error signaling mechanism for which ICMPv6 was
designed.[¶](#section-10-3){.pilcrow}

The security considerations of using stateless address autoconfiguration
are discussed in
\[[RFC4862](#RFC4862){.xref}\].[¶](#section-10-4){.pilcrow}
:::
:::

::: {#section-11 .section}
## [11.](#section-11){.section-number .selfRef} [References](#name-references){.section-name .selfRef} {#name-references}

::: {#section-11.1 .section}
### [11.1.](#section-11.1){.section-number .selfRef} [Normative References](#name-normative-references){.section-name .selfRef} {#name-normative-references}

\[BCP38\]
:   [Ferguson, P.]{.refAuthor}[ and D. Senie]{.refAuthor}, [\"Network
    Ingress Filtering: Defeating Denial of Service Attacks which employ
    IP Source Address Spoofing\"]{.refTitle}, [BCP 38]{.seriesInfo},
    [RFC 2827]{.seriesInfo}, [DOI 10.17487/RFC2827]{.seriesInfo}, May
    2000, \<<https://www.rfc-editor.org/info/rfc2827>\>.

\[RFC1918\]
:   [Rekhter, Y.]{.refAuthor}[, Moskowitz, B.]{.refAuthor}[,
    Karrenberg, D.]{.refAuthor}[, de Groot, G. J.]{.refAuthor}[, and E.
    Lear]{.refAuthor}, [\"Address Allocation for Private
    Internets\"]{.refTitle}, [BCP 5]{.seriesInfo}, [RFC
    1918]{.seriesInfo}, [DOI 10.17487/RFC1918]{.seriesInfo}, February
    1996, \<<https://www.rfc-editor.org/info/rfc1918>\>.

\[RFC2119\]
:   [Bradner, S.]{.refAuthor}, [\"Key words for use in RFCs to Indicate
    Requirement Levels\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    2119]{.seriesInfo}, [DOI 10.17487/RFC2119]{.seriesInfo}, March 1997,
    \<<https://www.rfc-editor.org/info/rfc2119>\>.

\[RFC4191\]
:   [Draves, R.]{.refAuthor}[ and D. Thaler]{.refAuthor}, [\"Default
    Router Preferences and More-Specific Routes\"]{.refTitle}, [RFC
    4191]{.seriesInfo}, [DOI 10.17487/RFC4191]{.seriesInfo}, November
    2005, \<<https://www.rfc-editor.org/info/rfc4191>\>.

\[RFC4193\]
:   [Hinden, R.]{.refAuthor}[ and B. Haberman]{.refAuthor}, [\"Unique
    Local IPv6 Unicast Addresses\"]{.refTitle}, [RFC 4193]{.seriesInfo},
    [DOI 10.17487/RFC4193]{.seriesInfo}, October 2005,
    \<<https://www.rfc-editor.org/info/rfc4193>\>.

\[RFC4291\]
:   [Hinden, R.]{.refAuthor}[ and S. Deering]{.refAuthor}, [\"IP Version
    6 Addressing Architecture\"]{.refTitle}, [RFC 4291]{.seriesInfo},
    [DOI 10.17487/RFC4291]{.seriesInfo}, February 2006,
    \<<https://www.rfc-editor.org/info/rfc4291>\>.

\[RFC4443\]
:   [Conta, A.]{.refAuthor}[, Deering, S.]{.refAuthor}[, and M. Gupta,
    Ed.]{.refAuthor}, [\"Internet Control Message Protocol (ICMPv6) for
    the Internet Protocol Version 6 (IPv6) Specification\"]{.refTitle},
    [STD 89]{.seriesInfo}, [RFC 4443]{.seriesInfo}, [DOI
    10.17487/RFC4443]{.seriesInfo}, March 2006,
    \<<https://www.rfc-editor.org/info/rfc4443>\>.

\[RFC4861\]
:   [Narten, T.]{.refAuthor}[, Nordmark, E.]{.refAuthor}[,
    Simpson, W.]{.refAuthor}[, and H. Soliman]{.refAuthor}, [\"Neighbor
    Discovery for IP version 6 (IPv6)\"]{.refTitle}, [RFC
    4861]{.seriesInfo}, [DOI 10.17487/RFC4861]{.seriesInfo}, September
    2007, \<<https://www.rfc-editor.org/info/rfc4861>\>.

\[RFC4862\]
:   [Thomson, S.]{.refAuthor}[, Narten, T.]{.refAuthor}[, and T.
    Jinmei]{.refAuthor}, [\"IPv6 Stateless Address
    Autoconfiguration\"]{.refTitle}, [RFC 4862]{.seriesInfo}, [DOI
    10.17487/RFC4862]{.seriesInfo}, September 2007,
    \<<https://www.rfc-editor.org/info/rfc4862>\>.

\[RFC6106\]
:   [Jeong, J.]{.refAuthor}[, Park, S.]{.refAuthor}[,
    Beloeil, L.]{.refAuthor}[, and S. Madanapalli]{.refAuthor}, [\"IPv6
    Router Advertisement Options for DNS Configuration\"]{.refTitle},
    [RFC 6106]{.seriesInfo}, [DOI 10.17487/RFC6106]{.seriesInfo},
    November 2010, \<<https://www.rfc-editor.org/info/rfc6106>\>.

\[RFC6296\]
:   [Wasserman, M.]{.refAuthor}[ and F. Baker]{.refAuthor},
    [\"IPv6-to-IPv6 Network Prefix Translation\"]{.refTitle}, [RFC
    6296]{.seriesInfo}, [DOI 10.17487/RFC6296]{.seriesInfo}, June 2011,
    \<<https://www.rfc-editor.org/info/rfc6296>\>.

\[RFC6724\]
:   [Thaler, D., Ed.]{.refAuthor}[, Draves, R.]{.refAuthor}[,
    Matsumoto, A.]{.refAuthor}[, and T. Chown]{.refAuthor}, [\"Default
    Address Selection for Internet Protocol Version 6
    (IPv6)\"]{.refTitle}, [RFC 6724]{.seriesInfo}, [DOI
    10.17487/RFC6724]{.seriesInfo}, September 2012,
    \<<https://www.rfc-editor.org/info/rfc6724>\>.

\[RFC7078\]
:   [Matsumoto, A.]{.refAuthor}[, Fujisaki, T.]{.refAuthor}[, and T.
    Chown]{.refAuthor}, [\"Distributing Address Selection Policy Using
    DHCPv6\"]{.refTitle}, [RFC 7078]{.seriesInfo}, [DOI
    10.17487/RFC7078]{.seriesInfo}, January 2014,
    \<<https://www.rfc-editor.org/info/rfc7078>\>.

\[RFC7556\]
:   [Anipko, D., Ed.]{.refAuthor}, [\"Multiple Provisioning Domain
    Architecture\"]{.refTitle}, [RFC 7556]{.seriesInfo}, [DOI
    10.17487/RFC7556]{.seriesInfo}, June 2015,
    \<<https://www.rfc-editor.org/info/rfc7556>\>.

\[RFC8028\]
:   [Baker, F.]{.refAuthor}[ and B. Carpenter]{.refAuthor}, [\"First-Hop
    Router Selection by Hosts in a Multi-Prefix Network\"]{.refTitle},
    [RFC 8028]{.seriesInfo}, [DOI 10.17487/RFC8028]{.seriesInfo},
    November 2016, \<<https://www.rfc-editor.org/info/rfc8028>\>.

\[RFC8106\]
:   [Jeong, J.]{.refAuthor}[, Park, S.]{.refAuthor}[,
    Beloeil, L.]{.refAuthor}[, and S. Madanapalli]{.refAuthor}, [\"IPv6
    Router Advertisement Options for DNS Configuration\"]{.refTitle},
    [RFC 8106]{.seriesInfo}, [DOI 10.17487/RFC8106]{.seriesInfo}, March
    2017, \<<https://www.rfc-editor.org/info/rfc8106>\>.

\[RFC8174\]
:   [Leiba, B.]{.refAuthor}, [\"Ambiguity of Uppercase vs Lowercase in
    RFC 2119 Key Words\"]{.refTitle}, [BCP 14]{.seriesInfo}, [RFC
    8174]{.seriesInfo}, [DOI 10.17487/RFC8174]{.seriesInfo}, May 2017,
    \<<https://www.rfc-editor.org/info/rfc8174>\>.

\[RFC8415\]
:   [Mrugalski, T.]{.refAuthor}[, Siodelski, M.]{.refAuthor}[,
    Volz, B.]{.refAuthor}[, Yourtchenko, A.]{.refAuthor}[,
    Richardson, M.]{.refAuthor}[, Jiang, S.]{.refAuthor}[,
    Lemon, T.]{.refAuthor}[, and T. Winters]{.refAuthor}, [\"Dynamic
    Host Configuration Protocol for IPv6 (DHCPv6)\"]{.refTitle}, [RFC
    8415]{.seriesInfo}, [DOI 10.17487/RFC8415]{.seriesInfo}, November
    2018, \<<https://www.rfc-editor.org/info/rfc8415>\>.
:::

::: {#section-11.2 .section}
### [11.2.](#section-11.2){.section-number .selfRef} [Informative References](#name-informative-references){.section-name .selfRef} {#name-informative-references}

\[DST-SRC-RTG\]
:   [Lamparter, D.]{.refAuthor}[ and A. Smirnov]{.refAuthor},
    [\"Destination/Source Routing\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-ietf-rtgwg-dst-src-routing-07]{.seriesInfo}, 10 March 2019,
    \<<https://tools.ietf.org/html/draft-ietf-rtgwg-dst-src-routing-07>\>.

\[PROV-DOMAINS\]
:   [Pfister, P.]{.refAuthor}[, Vyncke, E.]{.refAuthor}[,
    Pauly, T.]{.refAuthor}[, Schinazi, D.]{.refAuthor}[, and W.
    Shao]{.refAuthor}, [\"Discovering Provisioning Domain Names and
    Data\"]{.refTitle}, [Work in Progress]{.refContent},
    [Internet-Draft,
    draft-ietf-intarea-provisioning-domains-09]{.seriesInfo}, 6 December
    2019,
    \<<https://tools.ietf.org/html/draft-ietf-intarea-provisioning-domains-09>\>.

\[RFC2663\]
:   [Srisuresh, P.]{.refAuthor}[ and M. Holdrege]{.refAuthor}, [\"IP
    Network Address Translator (NAT) Terminology and
    Considerations\"]{.refTitle}, [RFC 2663]{.seriesInfo}, [DOI
    10.17487/RFC2663]{.seriesInfo}, August 1999,
    \<<https://www.rfc-editor.org/info/rfc2663>\>.

\[RFC3704\]
:   [Baker, F.]{.refAuthor}[ and P. Savola]{.refAuthor}, [\"Ingress
    Filtering for Multihomed Networks\"]{.refTitle}, [BCP
    84]{.seriesInfo}, [RFC 3704]{.seriesInfo}, [DOI
    10.17487/RFC3704]{.seriesInfo}, March 2004,
    \<<https://www.rfc-editor.org/info/rfc3704>\>.

\[RFC4941\]
:   [Narten, T.]{.refAuthor}[, Draves, R.]{.refAuthor}[, and S.
    Krishnan]{.refAuthor}, [\"Privacy Extensions for Stateless Address
    Autoconfiguration in IPv6\"]{.refTitle}, [RFC 4941]{.seriesInfo},
    [DOI 10.17487/RFC4941]{.seriesInfo}, September 2007,
    \<<https://www.rfc-editor.org/info/rfc4941>\>.

\[RFC5082\]
:   [Gill, V.]{.refAuthor}[, Heasley, J.]{.refAuthor}[,
    Meyer, D.]{.refAuthor}[, Savola, P., Ed.]{.refAuthor}[, and C.
    Pignataro]{.refAuthor}, [\"The Generalized TTL Security Mechanism
    (GTSM)\"]{.refTitle}, [RFC 5082]{.seriesInfo}, [DOI
    10.17487/RFC5082]{.seriesInfo}, October 2007,
    \<<https://www.rfc-editor.org/info/rfc5082>\>.

\[RFC5533\]
:   [Nordmark, E.]{.refAuthor}[ and M. Bagnulo]{.refAuthor}, [\"Shim6:
    Level 3 Multihoming Shim Protocol for IPv6\"]{.refTitle}, [RFC
    5533]{.seriesInfo}, [DOI 10.17487/RFC5533]{.seriesInfo}, June 2009,
    \<<https://www.rfc-editor.org/info/rfc5533>\>.

\[RFC5534\]
:   [Arkko, J.]{.refAuthor}[ and I. van Beijnum]{.refAuthor}, [\"Failure
    Detection and Locator Pair Exploration Protocol for IPv6
    Multihoming\"]{.refTitle}, [RFC 5534]{.seriesInfo}, [DOI
    10.17487/RFC5534]{.seriesInfo}, June 2009,
    \<<https://www.rfc-editor.org/info/rfc5534>\>.

\[RFC6824\]
:   [Ford, A.]{.refAuthor}[, Raiciu, C.]{.refAuthor}[,
    Handley, M.]{.refAuthor}[, and O. Bonaventure]{.refAuthor}, [\"TCP
    Extensions for Multipath Operation with Multiple
    Addresses\"]{.refTitle}, [RFC 6824]{.seriesInfo}, [DOI
    10.17487/RFC6824]{.seriesInfo}, January 2013,
    \<<https://www.rfc-editor.org/info/rfc6824>\>.

\[RFC7676\]
:   [Pignataro, C.]{.refAuthor}[, Bonica, R.]{.refAuthor}[, and S.
    Krishnan]{.refAuthor}, [\"IPv6 Support for Generic Routing
    Encapsulation (GRE)\"]{.refTitle}, [RFC 7676]{.seriesInfo}, [DOI
    10.17487/RFC7676]{.seriesInfo}, October 2015,
    \<<https://www.rfc-editor.org/info/rfc7676>\>.

\[RFC8425\]
:   [Troan, O.]{.refAuthor}, [\"IANA Considerations for IPv6 Neighbor
    Discovery Prefix Information Option Flags\"]{.refTitle}, [RFC
    8425]{.seriesInfo}, [DOI 10.17487/RFC8425]{.seriesInfo}, July 2018,
    \<<https://www.rfc-editor.org/info/rfc8425>\>.

\[RFC8504\]
:   [Chown, T.]{.refAuthor}[, Loughney, J.]{.refAuthor}[, and T.
    Winters]{.refAuthor}, [\"IPv6 Node Requirements\"]{.refTitle}, [BCP
    220]{.seriesInfo}, [RFC 8504]{.seriesInfo}, [DOI
    10.17487/RFC8504]{.seriesInfo}, January 2019,
    \<<https://www.rfc-editor.org/info/rfc8504>\>.

\[SADR-RA\]
:   [Pfister, P.]{.refAuthor}, [\"Source Address Dependent Route
    Information Option for Router Advertisements\"]{.refTitle}, [Work in
    Progress]{.refContent}, [Internet-Draft,
    draft-pfister-6man-sadr-ra-01]{.seriesInfo}, 22 June 2015,
    \<<https://tools.ietf.org/html/draft-pfister-6man-sadr-ra-01>\>.
:::
:::

::: {#Acknowledgements}
::: {#section-appendix.a .section}
## [Acknowledgements](#name-acknowledgements){.section-name .selfRef} {#name-acknowledgements}

The original outline was suggested by [Ole
Trøan]{.contact-name}.[¶](#section-appendix.a-1){.pilcrow}

The authors would like to thank the following people (in alphabetical
order) for their review and feedback: [Olivier
Bonaventure]{.contact-name}, [Deborah Brungard]{.contact-name}, [Brian
E. Carpenter]{.contact-name}, [Lorenzo Colitti]{.contact-name}, [Roman
Danyliw]{.contact-name}, [Benjamin Kaduk]{.contact-name}, [Suresh
Krishnan]{.contact-name}, [Mirja Kühlewind]{.contact-name}, [David
Lamparter]{.contact-name}, [Nicolai Leymann]{.contact-name}, [Acee
Lindem]{.contact-name}, [Philip Matthews]{.contact-name}, [Robert
Raszuk]{.contact-name}, [Pete Resnick]{.contact-name}, [Alvaro
Retana]{.contact-name}, [Dave Thaler]{.contact-name}, [Michael
Tüxen]{.contact-name}, [Martin Vigoureux]{.contact-name}, [Éric
Vyncke]{.contact-name}, [Magnus
Westerlund]{.contact-name}.[¶](#section-appendix.a-2){.pilcrow}
:::
:::

::: {#authors-addresses}
::: {#section-appendix.b .section}
## [Authors\' Addresses](#name-authors-addresses){.section-name .selfRef} {#name-authors-addresses}

::: {.left dir="auto"}
[Fred Baker]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Santa Barbara]{.locality}, [California]{.region} [93117]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <FredBaker.IETF@gmail.com>
:::

::: {.left dir="auto"}
[Chris Bowers]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Juniper Networks]{.org}
:::

::: {.left dir="auto"}
[Sunnyvale]{.locality}, [California]{.region} [94089]{.postal-code}
:::

::: {.left dir="auto"}
[United States of America]{.country-name}
:::

::: email
Email: <cbowers@juniper.net>
:::

::: {.left dir="auto"}
[Jen Linkova]{.fn .nameRole}
:::

::: {.left dir="auto"}
[Google]{.org}
:::

::: {.left dir="auto"}
[1 Darling Island Rd]{.street-address}
:::

::: {.left dir="auto"}
[Pyrmont]{.locality} [NSW]{.region} [2009]{.postal-code}
:::

::: {.left dir="auto"}
[Australia]{.country-name}
:::

::: email
Email: <furry@google.com>
:::
:::
:::
